KIDS Distribution saved on Jul 18, 2015@08:55:50
IHS STANDARD TERMINOLOGY 1.0
**KIDS**:IHS STANDARD TERMINOLOGY 1.0^

**INSTALL NAME**
IHS STANDARD TERMINOLOGY 1.0
"BLD",8516,0)
IHS STANDARD TERMINOLOGY 1.0^IHS STANDARD TERMINOLOGY^0^3150718^y
"BLD",8516,4,0)
^9.64PA^9002318.2^6
"BLD",8516,4,9002318,0)
9002318
"BLD",8516,4,9002318,222)
y^y^f^^^^n
"BLD",8516,4,9002318.1,0)
9002318.1
"BLD",8516,4,9002318.1,222)
y^y^f^^^^n^^
"BLD",8516,4,9002318.1,224)

"BLD",8516,4,9002318.2,0)
9002318.2
"BLD",8516,4,9002318.2,222)
y^y^f^^^^n
"BLD",8516,4,9002318.3,0)
9002318.3
"BLD",8516,4,9002318.3,222)
y^y^f^^^^n^^
"BLD",8516,4,9002318.3,224)

"BLD",8516,4,9002318.4,0)
9002318.4
"BLD",8516,4,9002318.4,222)
y^y^f^^^^n^^
"BLD",8516,4,9002318.4,224)

"BLD",8516,4,9002318.5,0)
9002318.5
"BLD",8516,4,9002318.5,222)
y^y^f^^^^n^^
"BLD",8516,4,9002318.5,224)

"BLD",8516,4,"B",9002318,9002318)

"BLD",8516,4,"B",9002318.1,9002318.1)

"BLD",8516,4,"B",9002318.2,9002318.2)

"BLD",8516,4,"B",9002318.3,9002318.3)

"BLD",8516,4,"B",9002318.4,9002318.4)

"BLD",8516,4,"B",9002318.5,9002318.5)

"BLD",8516,6.3)
116
"BLD",8516,"INI")
PRE^BSTS1POS
"BLD",8516,"INIT")
EN^BSTS1POS
"BLD",8516,"KRN",0)
^9.67PA^9002226^21
"BLD",8516,"KRN",.4,0)
.4
"BLD",8516,"KRN",.401,0)
.401
"BLD",8516,"KRN",.402,0)
.402
"BLD",8516,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",8516,"KRN",.402,"NM",1,0)
BSTS ADD/EDIT WEB SERVICE    FILE #9002318.2^9002318.2^0
"BLD",8516,"KRN",.402,"NM",2,0)
BSTS EDIT SITE PARAMETERS    FILE #9002318^9002318^0
"BLD",8516,"KRN",.402,"NM","B","BSTS ADD/EDIT WEB SERVICE    FILE #9002318.2",1)

"BLD",8516,"KRN",.402,"NM","B","BSTS EDIT SITE PARAMETERS    FILE #9002318",2)

"BLD",8516,"KRN",.403,0)
.403
"BLD",8516,"KRN",.5,0)
.5
"BLD",8516,"KRN",.84,0)
.84
"BLD",8516,"KRN",3.6,0)
3.6
"BLD",8516,"KRN",3.8,0)
3.8
"BLD",8516,"KRN",9.2,0)
9.2
"BLD",8516,"KRN",9.8,0)
9.8
"BLD",8516,"KRN",9.8,"NM",0)
^9.68A^23^23
"BLD",8516,"KRN",9.8,"NM",1,0)
BSTSAPI^^0^B5009810
"BLD",8516,"KRN",9.8,"NM",2,0)
BSTSAPIA^^0^B81943812
"BLD",8516,"KRN",9.8,"NM",3,0)
BSTSCMCL^^0^B11199204
"BLD",8516,"KRN",9.8,"NM",4,0)
BSTSDTS0^^0^B162610162
"BLD",8516,"KRN",9.8,"NM",5,0)
BSTSUTIL^^0^B114103788
"BLD",8516,"KRN",9.8,"NM",6,0)
BSTSWSV^^0^B144465700
"BLD",8516,"KRN",9.8,"NM",7,0)
BSTSUPD^^0^B840054
"BLD",8516,"KRN",9.8,"NM",8,0)
BSTSSRCH^^0^B42118106
"BLD",8516,"KRN",9.8,"NM",9,0)
BSTSAPIB^^0^B94662954
"BLD",8516,"KRN",9.8,"NM",10,0)
BSTSCLAS^^0^B22293545
"BLD",8516,"KRN",9.8,"NM",11,0)
BSTSLKP^^0^B16303885
"BLD",8516,"KRN",9.8,"NM",12,0)
BSTSDTS1^^0^B192539951
"BLD",8516,"KRN",9.8,"NM",13,0)
BSTSTST^^0^B7200964
"BLD",8516,"KRN",9.8,"NM",14,0)
BSTSVRSN^^0^B83343499
"BLD",8516,"KRN",9.8,"NM",15,0)
BSTSRPC^^0^B166146804
"BLD",8516,"KRN",9.8,"NM",16,0)
BSTSDTS2^^0^B114308433
"BLD",8516,"KRN",9.8,"NM",17,0)
BSTSAPIC^^0^B89594169
"BLD",8516,"KRN",9.8,"NM",18,0)
BSTSAPIF^^0^B72075068
"BLD",8516,"KRN",9.8,"NM",19,0)
BSTSAPID^^0^B42675010
"BLD",8516,"KRN",9.8,"NM",20,0)
BSTSWSV1^^0^B6736795
"BLD",8516,"KRN",9.8,"NM",21,0)
BSTSDTS3^^0^B81596605
"BLD",8516,"KRN",9.8,"NM",22,0)
BSTSCDET^^0^B99865117
"BLD",8516,"KRN",9.8,"NM",23,0)
BSTSLSRC^^0^B21199851
"BLD",8516,"KRN",9.8,"NM","B","BSTSAPI",1)

"BLD",8516,"KRN",9.8,"NM","B","BSTSAPIA",2)

"BLD",8516,"KRN",9.8,"NM","B","BSTSAPIB",9)

"BLD",8516,"KRN",9.8,"NM","B","BSTSAPIC",17)

"BLD",8516,"KRN",9.8,"NM","B","BSTSAPID",19)

"BLD",8516,"KRN",9.8,"NM","B","BSTSAPIF",18)

"BLD",8516,"KRN",9.8,"NM","B","BSTSCDET",22)

"BLD",8516,"KRN",9.8,"NM","B","BSTSCLAS",10)

"BLD",8516,"KRN",9.8,"NM","B","BSTSCMCL",3)

"BLD",8516,"KRN",9.8,"NM","B","BSTSDTS0",4)

"BLD",8516,"KRN",9.8,"NM","B","BSTSDTS1",12)

"BLD",8516,"KRN",9.8,"NM","B","BSTSDTS2",16)

"BLD",8516,"KRN",9.8,"NM","B","BSTSDTS3",21)

"BLD",8516,"KRN",9.8,"NM","B","BSTSLKP",11)

"BLD",8516,"KRN",9.8,"NM","B","BSTSLSRC",23)

"BLD",8516,"KRN",9.8,"NM","B","BSTSRPC",15)

"BLD",8516,"KRN",9.8,"NM","B","BSTSSRCH",8)

"BLD",8516,"KRN",9.8,"NM","B","BSTSTST",13)

"BLD",8516,"KRN",9.8,"NM","B","BSTSUPD",7)

"BLD",8516,"KRN",9.8,"NM","B","BSTSUTIL",5)

"BLD",8516,"KRN",9.8,"NM","B","BSTSVRSN",14)

"BLD",8516,"KRN",9.8,"NM","B","BSTSWSV",6)

"BLD",8516,"KRN",9.8,"NM","B","BSTSWSV1",20)

"BLD",8516,"KRN",19,0)
19
"BLD",8516,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",8516,"KRN",19,"NM",1,0)
BSTS EDIT SITE PARAMETERS^^0
"BLD",8516,"KRN",19,"NM",2,0)
BSTS WEB SERVICE^^0
"BLD",8516,"KRN",19,"NM",3,0)
BSTSMENU^^0
"BLD",8516,"KRN",19,"NM",4,0)
BSTS TEST WEB SERVICE^^0
"BLD",8516,"KRN",19,"NM",5,0)
BSTSRPC^^0
"BLD",8516,"KRN",19,"NM",6,0)
BSTS REFRESH SUBSETS^^0
"BLD",8516,"KRN",19,"NM","B","BSTS EDIT SITE PARAMETERS",1)

"BLD",8516,"KRN",19,"NM","B","BSTS REFRESH SUBSETS",6)

"BLD",8516,"KRN",19,"NM","B","BSTS TEST WEB SERVICE",4)

"BLD",8516,"KRN",19,"NM","B","BSTS WEB SERVICE",2)

"BLD",8516,"KRN",19,"NM","B","BSTSMENU",3)

"BLD",8516,"KRN",19,"NM","B","BSTSRPC",5)

"BLD",8516,"KRN",19.1,0)
19.1
"BLD",8516,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",8516,"KRN",19.1,"NM",1,0)
BSTSZMENU^^0
"BLD",8516,"KRN",19.1,"NM","B","BSTSZMENU",1)

"BLD",8516,"KRN",101,0)
101
"BLD",8516,"KRN",409.61,0)
409.61
"BLD",8516,"KRN",771,0)
771
"BLD",8516,"KRN",779.2,0)
779.2
"BLD",8516,"KRN",870,0)
870
"BLD",8516,"KRN",8989.51,0)
8989.51
"BLD",8516,"KRN",8989.52,0)
8989.52
"BLD",8516,"KRN",8994,0)
8994
"BLD",8516,"KRN",8994,"NM",0)
^9.68A^5^5
"BLD",8516,"KRN",8994,"NM",1,0)
BSTS GET SUBSET LIST^^0
"BLD",8516,"KRN",8994,"NM",2,0)
BSTS SNOMED SEARCH^^0
"BLD",8516,"KRN",8994,"NM",3,0)
BSTS ICD9 TO SNOMED^^0
"BLD",8516,"KRN",8994,"NM",4,0)
BSTS SNOMED UNIVERSE SEARCH^^0
"BLD",8516,"KRN",8994,"NM",5,0)
BSTS GET CODESETS^^0
"BLD",8516,"KRN",8994,"NM","B","BSTS GET CODESETS",5)

"BLD",8516,"KRN",8994,"NM","B","BSTS GET SUBSET LIST",1)

"BLD",8516,"KRN",8994,"NM","B","BSTS ICD9 TO SNOMED",3)

"BLD",8516,"KRN",8994,"NM","B","BSTS SNOMED SEARCH",2)

"BLD",8516,"KRN",8994,"NM","B","BSTS SNOMED UNIVERSE SEARCH",4)

"BLD",8516,"KRN",9002226,0)
9002226
"BLD",8516,"KRN","B",.4,.4)

"BLD",8516,"KRN","B",.401,.401)

"BLD",8516,"KRN","B",.402,.402)

"BLD",8516,"KRN","B",.403,.403)

"BLD",8516,"KRN","B",.5,.5)

"BLD",8516,"KRN","B",.84,.84)

"BLD",8516,"KRN","B",3.6,3.6)

"BLD",8516,"KRN","B",3.8,3.8)

"BLD",8516,"KRN","B",9.2,9.2)

"BLD",8516,"KRN","B",9.8,9.8)

"BLD",8516,"KRN","B",19,19)

"BLD",8516,"KRN","B",19.1,19.1)

"BLD",8516,"KRN","B",101,101)

"BLD",8516,"KRN","B",409.61,409.61)

"BLD",8516,"KRN","B",771,771)

"BLD",8516,"KRN","B",779.2,779.2)

"BLD",8516,"KRN","B",870,870)

"BLD",8516,"KRN","B",8989.51,8989.51)

"BLD",8516,"KRN","B",8989.52,8989.52)

"BLD",8516,"KRN","B",8994,8994)

"BLD",8516,"KRN","B",9002226,9002226)

"BLD",8516,"PRE")
BSTS1POS
"BLD",8516,"QDEF")
^^^^YES^^^^NO^^NO
"BLD",8516,"QUES",0)
^9.62^^
"FIA",9002318)
BSTS SITE PARAMETERS
"FIA",9002318,0)
^BSTS(9002318,
"FIA",9002318,0,0)
9002318P
"FIA",9002318,0,1)
y^y^f^^^^n
"FIA",9002318,0,10)

"FIA",9002318,0,11)

"FIA",9002318,0,"RLRO")

"FIA",9002318,0,"VR")
1.0^IHS STANDARD TERMINOLOGY
"FIA",9002318,9002318)
0
"FIA",9002318,9002318.01)
0
"FIA",9002318.1)
BSTS CODESET
"FIA",9002318.1,0)
^BSTS(9002318.1,
"FIA",9002318.1,0,0)
9002318.1I
"FIA",9002318.1,0,1)
y^y^f^^^^n^^
"FIA",9002318.1,0,10)

"FIA",9002318.1,0,11)

"FIA",9002318.1,0,"RLRO")

"FIA",9002318.1,0,"VR")
1.0^IHS STANDARD TERMINOLOGY
"FIA",9002318.1,9002318.1)
0
"FIA",9002318.1,9002318.11)
0
"FIA",9002318.2)
BSTS WEB SERVICE ENDPOINT
"FIA",9002318.2,0)
^BSTS(9002318.2,
"FIA",9002318.2,0,0)
9002318.2
"FIA",9002318.2,0,1)
y^y^f^^^^n
"FIA",9002318.2,0,10)

"FIA",9002318.2,0,11)

"FIA",9002318.2,0,"RLRO")

"FIA",9002318.2,0,"VR")
1.0^IHS STANDARD TERMINOLOGY
"FIA",9002318.2,9002318.2)
0
"FIA",9002318.2,9002318.21)
0
"FIA",9002318.3)
BSTS TERMINOLOGY
"FIA",9002318.3,0)
^BSTS(9002318.3,
"FIA",9002318.3,0,0)
9002318.3
"FIA",9002318.3,0,1)
y^y^f^^^^n^^
"FIA",9002318.3,0,10)

"FIA",9002318.3,0,11)

"FIA",9002318.3,0,"RLRO")

"FIA",9002318.3,0,"VR")
1.0^IHS STANDARD TERMINOLOGY
"FIA",9002318.3,9002318.3)
0
"FIA",9002318.4)
BSTS CONCEPT
"FIA",9002318.4,0)
^BSTS(9002318.4,
"FIA",9002318.4,0,0)
9002318.4
"FIA",9002318.4,0,1)
y^y^f^^^^n^^
"FIA",9002318.4,0,10)

"FIA",9002318.4,0,11)

"FIA",9002318.4,0,"RLRO")

"FIA",9002318.4,0,"VR")
1.0^IHS STANDARD TERMINOLOGY
"FIA",9002318.4,9002318.4)
0
"FIA",9002318.4,9002318.411)
0
"FIA",9002318.4,9002318.412)
0
"FIA",9002318.4,9002318.413)
0
"FIA",9002318.4,9002318.42)
0
"FIA",9002318.4,9002318.421)
0
"FIA",9002318.4,9002318.422)
0
"FIA",9002318.4,9002318.423)
0
"FIA",9002318.4,9002318.424)
0
"FIA",9002318.4,9002318.43)
0
"FIA",9002318.4,9002318.44)
0
"FIA",9002318.4,9002318.45)
0
"FIA",9002318.4,9002318.46)
0
"FIA",9002318.4,9002318.47)
0
"FIA",9002318.4,9002318.48)
0
"FIA",9002318.4,9002318.49)
0
"FIA",9002318.5)
BSTS CACHE CLASS TRANSPORT
"FIA",9002318.5,0)
^BSTSCLS(
"FIA",9002318.5,0,0)
9002318.5
"FIA",9002318.5,0,1)
y^y^f^^^^n^^
"FIA",9002318.5,0,10)

"FIA",9002318.5,0,11)

"FIA",9002318.5,0,"RLRO")

"FIA",9002318.5,0,"VR")
1.0^IHS STANDARD TERMINOLOGY
"FIA",9002318.5,9002318.5)
0
"FIA",9002318.5,9002318.51)
0
"FIA",9002318.5,9002318.511)
0
"INI")
PRE^BSTS1POS
"INIT")
EN^BSTS1POS
"IX",9002318.3,9002318.3,"C",0)
9002318.3^C^codeset,concept id,ien^R^^R^IR^I^9002318.3^^^^^LS
"IX",9002318.3,9002318.3,"C",1)
S ^BSTS(9002318.3,"C",$E(X(1),1,20),$E(X(2),1,20),DA)=""
"IX",9002318.3,9002318.3,"C",2)
K ^BSTS(9002318.3,"C",$E(X(1),1,20),$E(X(2),1,20),DA)
"IX",9002318.3,9002318.3,"C",2.5)
K ^BSTS(9002318.3,"C")
"IX",9002318.3,9002318.3,"C",11.1,0)
^.114IA^2^2
"IX",9002318.3,9002318.3,"C",11.1,1,0)
1^F^9002318.3^.08^20^1^F
"IX",9002318.3,9002318.3,"C",11.1,1,2)
S X=$P(^BSTS(9002318.1,X,0),"^",1)
"IX",9002318.3,9002318.3,"C",11.1,1,3)

"IX",9002318.3,9002318.3,"C",11.1,2,0)
2^F^9002318.3^.03^20^2^F
"IX",9002318.3,9002318.3,"C",11.1,2,3)

"IX",9002318.3,9002318.3,"D",0)
9002318.3^D^INDEX BY CODESET AND DESCRIPTION ID^R^^R^IR^I^9002318.3^^^^^LS
"IX",9002318.3,9002318.3,"D",1)
S ^BSTS(9002318.3,"D",X(1),$E(X(2),1,30),DA)=""
"IX",9002318.3,9002318.3,"D",2)
K ^BSTS(9002318.3,"D",X(1),$E(X(2),1,30),DA)
"IX",9002318.3,9002318.3,"D",2.5)
K ^BSTS(9002318.3,"D")
"IX",9002318.3,9002318.3,"D",11.1,0)
^.114IA^2^2
"IX",9002318.3,9002318.3,"D",11.1,1,0)
1^F^9002318.3^.08^^1^F
"IX",9002318.3,9002318.3,"D",11.1,1,3)

"IX",9002318.3,9002318.3,"D",11.1,2,0)
2^F^9002318.3^.02^30^2^F
"IX",9002318.3,9002318.3,"D",11.1,2,3)

"IX",9002318.4,9002318.4,"C",0)
9002318.4^C^codeset,concept id,ien ^R^^R^IR^I^9002318.4^^^^^LS
"IX",9002318.4,9002318.4,"C",1)
S ^BSTS(9002318.4,"C",$E(X(1),1,20),$E(X(2),1,30),DA)=""
"IX",9002318.4,9002318.4,"C",2)
K ^BSTS(9002318.4,"C",$E(X(1),1,20),$E(X(2),1,30),DA)
"IX",9002318.4,9002318.4,"C",2.5)
K ^BSTS(9002318.4,"C")
"IX",9002318.4,9002318.4,"C",11.1,0)
^.114IA^2^2
"IX",9002318.4,9002318.4,"C",11.1,1,0)
1^F^9002318.4^.07^20^1^F
"IX",9002318.4,9002318.4,"C",11.1,1,2)
S X=$P(^BSTS(9002318.1,X,0),"^",1)
"IX",9002318.4,9002318.4,"C",11.1,1,3)

"IX",9002318.4,9002318.4,"C",11.1,2,0)
2^F^9002318.4^.02^30^2^F
"IX",9002318.4,9002318.4,"C",11.1,2,3)

"IX",9002318.4,9002318.4,"D",0)
9002318.4^D^codeset,dts id,ien^R^^R^IR^I^9002318.4^^^^^LS
"IX",9002318.4,9002318.4,"D",1)
S ^BSTS(9002318.4,"D",$E(X(1),1,20),$E(X(2),1,30),DA)=""
"IX",9002318.4,9002318.4,"D",2)
K ^BSTS(9002318.4,"D",$E(X(1),1,20),$E(X(2),1,30),DA)
"IX",9002318.4,9002318.4,"D",2.5)
K ^BSTS(9002318.4,"D")
"IX",9002318.4,9002318.4,"D",11.1,0)
^.114IA^2^2
"IX",9002318.4,9002318.4,"D",11.1,1,0)
1^F^9002318.4^.07^20^1^F
"IX",9002318.4,9002318.4,"D",11.1,1,2)
S X=$P(^BSTS(9002318.1,X,0),"^",1)
"IX",9002318.4,9002318.4,"D",11.1,1,3)

"IX",9002318.4,9002318.4,"D",11.1,2,0)
2^F^9002318.4^.08^30^2^F
"IX",9002318.4,9002318.4,"D",11.1,2,3)

"KRN",.402,1761,-1)
0^1
"KRN",.402,1761,0)
BSTS ADD/EDIT WEB SERVICE^3140703.1429^@^9002318.2^^@^3140703
"KRN",.402,1761,"DR",1,9002318.2)
.02;.03;.04;.05;.12;.07;.08;.11;2.01;
"KRN",.402,1762,-1)
0^2
"KRN",.402,1762,0)
BSTS EDIT SITE PARAMETERS^3140409.2129^@^9002318^^@^3140814
"KRN",.402,1762,"DIAB",1,1,9002318.01,0)
ALL
"KRN",.402,1762,"DR",1,9002318)
.02;1;
"KRN",.402,1762,"DR",2,9002318.01)
.01:.03
"KRN",19,11331,-1)
0^2
"KRN",19,11331,0)
BSTS WEB SERVICE^Add/Edit Terminology Web Service^^R^^^^^^^^IHS STANDARD TERMINOLOGY
"KRN",19,11331,1,0)
^^2^2^3121119^
"KRN",19,11331,1,1,0)
Add the path and other information needed to connect to a Terminology Web 
"KRN",19,11331,1,2,0)
Service.
"KRN",19,11331,25)
WEB^BSTSUPD
"KRN",19,11331,"U")
ADD/EDIT TERMINOLOGY WEB SERVI
"KRN",19,11332,-1)
0^1
"KRN",19,11332,0)
BSTS EDIT SITE PARAMETERS^Edit Terminology Site Parameters^^R^^BSTSZMENU^^^^^^IHS STANDARD TERMINOLOGY
"KRN",19,11332,1,0)
^^1^1^3121119^
"KRN",19,11332,1,1,0)
Edit a site's parameters which include the web service endpoints.
"KRN",19,11332,25)
SIT^BSTSUPD
"KRN",19,11332,"U")
EDIT TERMINOLOGY SITE PARAMETE
"KRN",19,11333,-1)
0^3
"KRN",19,11333,0)
BSTSMENU^IHS Standard Terminology Management^^M^^BSTSZMENU^^^^^^IHS STANDARD TERMINOLOGY
"KRN",19,11333,1,0)
^19.06^1^1^3130321^^^^
"KRN",19,11333,1,1,0)
Manage IHS Standard Terminology
"KRN",19,11333,10,0)
^19.01IP^4^4
"KRN",19,11333,10,1,0)
11331^WEB^1
"KRN",19,11333,10,1,"^")
BSTS WEB SERVICE
"KRN",19,11333,10,2,0)
11332^ESP^2
"KRN",19,11333,10,2,"^")
BSTS EDIT SITE PARAMETERS
"KRN",19,11333,10,3,0)
11334^TST^3
"KRN",19,11333,10,3,"^")
BSTS TEST WEB SERVICE
"KRN",19,11333,10,4,0)
11336^REF
"KRN",19,11333,10,4,"^")
BSTS REFRESH SUBSETS
"KRN",19,11333,99)
63745,73354
"KRN",19,11333,"U")
IHS STANDARD TERMINOLOGY MANAG
"KRN",19,11334,-1)
0^4
"KRN",19,11334,0)
BSTS TEST WEB SERVICE^Terminology Web Service Test^^R^^BSTSZMENU^^^^^^IHS STANDARD TERMINOLOGY
"KRN",19,11334,1,0)
^19.06^3^3^3130321^^
"KRN",19,11334,1,1,0)
This option allows users to test a BSTS terminology web service to verify 
"KRN",19,11334,1,2,0)
that it connects properly and also to determine how fast the service 
"KRN",19,11334,1,3,0)
returns results.
"KRN",19,11334,25)
TEST^BSTSTST
"KRN",19,11334,"U")
TERMINOLOGY WEB SERVICE TEST
"KRN",19,11335,-1)
0^5
"KRN",19,11335,0)
BSTSRPC^BSTS RPC Calls^^B^^^^^^^^IHS STANDARD TERMINOLOGY^y
"KRN",19,11335,1,0)
^^1^1^3130121^
"KRN",19,11335,1,1,0)
This list holds all of the RPC calls to be used for the BSTS package.
"KRN",19,11335,"RPC",0)
^19.05P^5^5
"KRN",19,11335,"RPC",1,0)
BSTS SNOMED SEARCH
"KRN",19,11335,"RPC",2,0)
BSTS GET SUBSET LIST
"KRN",19,11335,"RPC",3,0)
BSTS ICD9 TO SNOMED
"KRN",19,11335,"RPC",4,0)
BSTS SNOMED UNIVERSE SEARCH
"KRN",19,11335,"RPC",5,0)
BSTS GET CODESETS
"KRN",19,11335,"U")
BSTS RPC CALLS
"KRN",19,11336,-1)
0^6
"KRN",19,11336,0)
BSTS REFRESH SUBSETS^Refresh IHS Standard Terminology Subsets^^R^^BSTSZMENU^^^^^^IHS STANDARD TERMINOLOGY
"KRN",19,11336,1,0)
^19.06^3^3^3130321^^
"KRN",19,11336,1,1,0)
This option will clear out all the subsets assigned to concepts for a 
"KRN",19,11336,1,2,0)
specified codeset. It will then poll the DTS server to set up the 
"KRN",19,11336,1,3,0)
concepts with the latest subset list.
"KRN",19,11336,25)
SBRSET^BSTSVRSN
"KRN",19,11336,"U")
REFRESH IHS STANDARD TERMINOLO
"KRN",19.1,516,-1)
0^1
"KRN",19.1,516,0)
BSTSZMENU^Terminology menu access^^n
"KRN",19.1,516,1,0)
^19.11^2^2^3130823^^
"KRN",19.1,516,1,1,0)
Assign this key to the site manager who would keep the IHS Standard 
"KRN",19.1,516,1,2,0)
Terminology information up-to-date.
"KRN",8994,2777,-1)
0^2
"KRN",8994,2777,0)
BSTS SNOMED SEARCH^SEARCH^BSTSRPC^4
"KRN",8994,2778,-1)
0^1
"KRN",8994,2778,0)
BSTS GET SUBSET LIST^SUBSET^BSTSRPC^4
"KRN",8994,2779,-1)
0^3
"KRN",8994,2779,0)
BSTS ICD9 TO SNOMED^ICD2SMD^BSTSRPC^4
"KRN",8994,2780,-1)
0^4
"KRN",8994,2780,0)
BSTS SNOMED UNIVERSE SEARCH^USEARCH^BSTSRPC^4
"KRN",8994,2781,-1)
0^5
"KRN",8994,2781,0)
BSTS GET CODESETS^CDSET^BSTSRPC^4
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",226,-1)
1^1
"PKG",226,0)
IHS STANDARD TERMINOLOGY^BSTS^IHS STANDARD TERMINOLOGY - SNOMED
"PKG",226,22,0)
^9.49I^1^1
"PKG",226,22,1,0)
1.0^3150718^3150712^1
"PKG",226,"VERSION")
1.0
"PRE")
BSTS1POS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
24
"RTN","BSTS1POS")
0^^B6613646
"RTN","BSTS1POS",1,0)
BSTS1POS ;GDIT/HS/BEE-Version 1.0 Post (and Pre) Install ;12-Jul-2015 17:17;DKM
"RTN","BSTS1POS",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTS1POS",3,0)
 ;
"RTN","BSTS1POS",4,0)
ENV ;EP - Environmental Checking Routine
"RTN","BSTS1POS",5,0)
 ; Run pre-install checks
"RTN","BSTS1POS",6,0)
 N VERSION,EXEC,BMWDT
"RTN","BSTS1POS",7,0)
 ;
"RTN","BSTS1POS",8,0)
 ;Check for Ensemble version greater or equal to 2012
"RTN","BSTS1POS",9,0)
 S VERSION=$$VERSION^%ZOSV
"RTN","BSTS1POS",10,0)
 ;I VERSION<2012 D BMES^XPDUTL("Ensemble 2012 or later is required!") S XPDQUIT=2 Q
"RTN","BSTS1POS",11,0)
 ;
"RTN","BSTS1POS",12,0)
 ;Make sure a refresh is not running already
"RTN","BSTS1POS",13,0)
 L +^BSTS(9002318.1,0):0 E  D BMES^XPDUTL("A Local BSTS Cache Refresh is Already Running. Please Try Later") S XPDQUIT=2 Q
"RTN","BSTS1POS",14,0)
 L -^BSTS(9002318.1,0)
"RTN","BSTS1POS",15,0)
 ;
"RTN","BSTS1POS",16,0)
 ;Make sure an ICD9 to SNOMED compile isn't running
"RTN","BSTS1POS",17,0)
 L +^TMP("BSTSICD2SMD"):0 E  D BMES^XPDUTL("An ICD9 to SNOMED Background Compile is Running.  Please Try later") S XPDQUIT=2 Q
"RTN","BSTS1POS",18,0)
 L -^TMP("BSTSICD2SMD")
"RTN","BSTS1POS",19,0)
 ;
"RTN","BSTS1POS",20,0)
 ;Make sure another install isn't running
"RTN","BSTS1POS",21,0)
 L +^TMP("BSTSINSTALL"):3 E  D BMES^XPDUTL("A BSTS Install is Already Running") S XPDQUIT=2 Q
"RTN","BSTS1POS",22,0)
 L -^TMP("BSTSINSTALL")
"RTN","BSTS1POS",23,0)
 ;
"RTN","BSTS1POS",24,0)
 Q
"RTN","BSTS1POS",25,0)
 ;
"RTN","BSTS1POS",26,0)
EN ;EP
"RTN","BSTS1POS",27,0)
 NEW DA,DIC,X,Y,ZTRTN,ZTDESC,ZTIO,ZTSAVE,DLAYGO,NMID,NMIEN
"RTN","BSTS1POS",28,0)
 S DIC(0)="LNZ",DIC="^BSTS(9002318,",DLAYGO=9002318,X=$P($G(^AUTTSITE(1,0)),U,1)
"RTN","BSTS1POS",29,0)
 I X="" S X=$O(^BGPSITE(0))
"RTN","BSTS1POS",30,0)
 I X'="" S X=$P(^DIC(4,X,0),U,1)
"RTN","BSTS1POS",31,0)
 D ^DIC
"RTN","BSTS1POS",32,0)
 ;
"RTN","BSTS1POS",33,0)
 ;Load the classes
"RTN","BSTS1POS",34,0)
 ;
"RTN","BSTS1POS",35,0)
 N TRIEN,EXEC,ERR
"RTN","BSTS1POS",36,0)
 ;
"RTN","BSTS1POS",37,0)
 ;For each build, set this to the 9002318.5 entry to load
"RTN","BSTS1POS",38,0)
 S:$ZVERSION["Cache" TRIEN=1
"RTN","BSTS1POS",39,0)
 ;
"RTN","BSTS1POS",40,0)
 ;Delete existing BSTS Classes
"RTN","BSTS1POS",41,0)
 I $D(TRIEN) S EXEC="DO $SYSTEM.OBJ.DeletePackage(""BSTS"")" X EXEC
"RTN","BSTS1POS",42,0)
 ;
"RTN","BSTS1POS",43,0)
 ; Import BSTS classes
"RTN","BSTS1POS",44,0)
 K ERR
"RTN","BSTS1POS",45,0)
 I $G(TRIEN)'="" D IMPORT^BSTSCLAS(TRIEN,.ERR)
"RTN","BSTS1POS",46,0)
 I $G(ERR) Q
"RTN","BSTS1POS",47,0)
 ;
"RTN","BSTS1POS",48,0)
 ;Update LAST SUBSET CHECK now so process won't keep getting called
"RTN","BSTS1POS",49,0)
 D
"RTN","BSTS1POS",50,0)
 . NEW BSTS,ERROR,NMIEN
"RTN","BSTS1POS",51,0)
 . S NMIEN=$O(^BSTS(9002318.1,"B",36,"")) Q:NMIEN=""
"RTN","BSTS1POS",52,0)
 . S BSTS(9002318.1,NMIEN_",",.06)=DT
"RTN","BSTS1POS",53,0)
 . D FILE^DIE("","BSTS","ERROR")
"RTN","BSTS1POS",54,0)
 ;
"RTN","BSTS1POS",55,0)
 ;Unlock installation entry
"RTN","BSTS1POS",56,0)
 L -^TMP("BSTSINSTALL")
"RTN","BSTS1POS",57,0)
 ;
"RTN","BSTS1POS",58,0)
 Q
"RTN","BSTS1POS",59,0)
 ;
"RTN","BSTS1POS",60,0)
PRE ;Pre-Install Front End
"RTN","BSTS1POS",61,0)
 ;
"RTN","BSTS1POS",62,0)
 ;Perform Lock so only one install can run and DTS calls will be switched to local
"RTN","BSTS1POS",63,0)
 L +^TMP("BSTSINSTALL"):3 E  D BMES^XPDUTL("A BSTS Install is Already Running - Aborting Installation") S XPDABORT=1 Q
"RTN","BSTS1POS",64,0)
 ;
"RTN","BSTS1POS",65,0)
 N DIU
"RTN","BSTS1POS",66,0)
 ;
"RTN","BSTS1POS",67,0)
 ;Clear out existing entries
"RTN","BSTS1POS",68,0)
 S DIU="^BSTS(9002318.1,",DIU(0)="DST" D EN^DIU2
"RTN","BSTS1POS",69,0)
 S DIU="^BSTS(9002318.3,",DIU(0)="DST" D EN^DIU2
"RTN","BSTS1POS",70,0)
 S DIU="^BSTS(9002318.4,",DIU(0)="DST" D EN^DIU2
"RTN","BSTS1POS",71,0)
 S DIU="^BSTSCLS(",DIU(0)="DST" D EN^DIU2
"RTN","BSTS1POS",72,0)
 ;
"RTN","BSTS1POS",73,0)
 Q
"RTN","BSTSAPI")
0^1^B5009810
"RTN","BSTSAPI",1,0)
BSTSAPI ;GDIT/HS/BEE-Standard Terminology API Program ;26-Jun-2015 18:12;DKM
"RTN","BSTSAPI",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSAPI",3,0)
 ;
"RTN","BSTSAPI",4,0)
 Q
"RTN","BSTSAPI",5,0)
 ;
"RTN","BSTSAPI",6,0)
SEARCH(OUT,IN) ;PEP - Perform Codeset Search
"RTN","BSTSAPI",7,0)
 ;
"RTN","BSTSAPI",8,0)
 ; See SEARCH^BSTSAPIA for a detailed description of the input parameters
"RTN","BSTSAPI",9,0)
 ; and the output format.
"RTN","BSTSAPI",10,0)
 ;
"RTN","BSTSAPI",11,0)
 Q $$SEARCH^BSTSAPIA(OUT,$G(IN))
"RTN","BSTSAPI",12,0)
 ;
"RTN","BSTSAPI",13,0)
CODESETS(OUT,IN) ;PEP - Return list of available code sets
"RTN","BSTSAPI",14,0)
 ;
"RTN","BSTSAPI",15,0)
 ; See CODESETS^BSTSAPIA for a detailed description of the input parameters
"RTN","BSTSAPI",16,0)
 ; and the output format.
"RTN","BSTSAPI",17,0)
 ;
"RTN","BSTSAPI",18,0)
 Q $$CODESETS^BSTSAPIA(OUT,$G(IN))
"RTN","BSTSAPI",19,0)
 ;
"RTN","BSTSAPI",20,0)
VERSIONS(OUT,IN) ;PEP - Return a list of available versions for a code set
"RTN","BSTSAPI",21,0)
 ;
"RTN","BSTSAPI",22,0)
 ; See VERSIONS^BSTSAPIA for a detailed description of the input parameters
"RTN","BSTSAPI",23,0)
 ; and the output format.
"RTN","BSTSAPI",24,0)
 ;
"RTN","BSTSAPI",25,0)
 Q $$VERSIONS^BSTSAPIA(OUT,$G(IN))
"RTN","BSTSAPI",26,0)
 ;
"RTN","BSTSAPI",27,0)
CVRSN(OUT,IN) ;PEP - Return the Current Version For the Code Set
"RTN","BSTSAPI",28,0)
 ;
"RTN","BSTSAPI",29,0)
 ; See CVRSN^BSTSAPID for a detailed description of the input parameters
"RTN","BSTSAPI",30,0)
 ; and the output format.
"RTN","BSTSAPI",31,0)
 ;
"RTN","BSTSAPI",32,0)
 Q $$CVRSN^BSTSAPID(OUT,$G(IN))
"RTN","BSTSAPI",33,0)
 ;
"RTN","BSTSAPI",34,0)
SUBSET(OUT,IN) ;PEP - Return the list of subsets available for a Code Set
"RTN","BSTSAPI",35,0)
 ;
"RTN","BSTSAPI",36,0)
 ; See SUBSET^BSTSAPIA for a detailed description of the input parameters
"RTN","BSTSAPI",37,0)
 ; and the output format.
"RTN","BSTSAPI",38,0)
 ;
"RTN","BSTSAPI",39,0)
 Q $$SUBSET^BSTSAPIA(OUT,$G(IN))
"RTN","BSTSAPI",40,0)
 ;
"RTN","BSTSAPI",41,0)
VALTERM(OUT,IN) ;PEP - Returns whether a given term is a valid
"RTN","BSTSAPI",42,0)
 ;
"RTN","BSTSAPI",43,0)
 ; See VALTERM^BSTSAPIB for a detailed description of the input parameters
"RTN","BSTSAPI",44,0)
 ; and the output format.
"RTN","BSTSAPI",45,0)
 ;
"RTN","BSTSAPI",46,0)
 Q $$VALTERM^BSTSAPIB(OUT,$G(IN))
"RTN","BSTSAPI",47,0)
 ;
"RTN","BSTSAPI",48,0)
DSCLKP(OUT,IN) ;PEP - Returns detail information for a specified Description Id
"RTN","BSTSAPI",49,0)
 ;
"RTN","BSTSAPI",50,0)
 ; See DSCLKP^BSTSAPIB for a detailed description of the input parameters
"RTN","BSTSAPI",51,0)
 ; and the output format.
"RTN","BSTSAPI",52,0)
 ;
"RTN","BSTSAPI",53,0)
 Q $$DSCLKP^BSTSAPIB(OUT,$G(IN))
"RTN","BSTSAPI",54,0)
 ;
"RTN","BSTSAPI",55,0)
DTSLKP(OUT,IN) ;PEP - Returns detail information for a specified DTS Id
"RTN","BSTSAPI",56,0)
 ;
"RTN","BSTSAPI",57,0)
 ; See DTSLKP^BSTSAPIB for a detailed description of the input parameters
"RTN","BSTSAPI",58,0)
 ; and the output format.
"RTN","BSTSAPI",59,0)
 ;
"RTN","BSTSAPI",60,0)
 Q $$DTSLKP^BSTSAPIB(OUT,$G(IN))
"RTN","BSTSAPI",61,0)
 ;
"RTN","BSTSAPI",62,0)
CNCLKP(OUT,IN) ;PEP - Returns detail information for a specified Concept Id
"RTN","BSTSAPI",63,0)
 ;
"RTN","BSTSAPI",64,0)
 ; See CNCLKP^BSTSAPIB for a detailed description of the input parameters
"RTN","BSTSAPI",65,0)
 ; and the output format.
"RTN","BSTSAPI",66,0)
 ;
"RTN","BSTSAPI",67,0)
 Q $$CNCLKP^BSTSAPIB(OUT,$G(IN))
"RTN","BSTSAPI",68,0)
 ;
"RTN","BSTSAPI",69,0)
ASSOC(IN) ;PEP - Returns the associations for each type (SMD, RxNorm, UNII)
"RTN","BSTSAPI",70,0)
 ;
"RTN","BSTSAPI",71,0)
 ; See ASSOC^BSTSAPIF for a detailed description of the input parameters
"RTN","BSTSAPI",72,0)
 ; and the output format.
"RTN","BSTSAPI",73,0)
 ;
"RTN","BSTSAPI",74,0)
 Q $$ASSOC^BSTSAPIF($G(IN))
"RTN","BSTSAPI",75,0)
 ;
"RTN","BSTSAPI",76,0)
DI2RX(IN) ;PEP - Performs a drug ingredient lookup on a specified value
"RTN","BSTSAPI",77,0)
 ;
"RTN","BSTSAPI",78,0)
 ; Returns only the first RxNorm mapping as a function call output
"RTN","BSTSAPI",79,0)
 ; See DI2RX^BSTSAPIF for a detailed description of the input parameters
"RTN","BSTSAPI",80,0)
 ; and the output format.
"RTN","BSTSAPI",81,0)
 ;
"RTN","BSTSAPI",82,0)
 Q $$DI2RX^BSTSAPIF($G(IN))
"RTN","BSTSAPI",83,0)
 ;
"RTN","BSTSAPI",84,0)
MPADVICE(OUT,IN) ;PEP - Returns ICD-10 mapping information for a specified Concept Id
"RTN","BSTSAPI",85,0)
 ;
"RTN","BSTSAPI",86,0)
 ; See MPADVICE^BSTSAPIC for a detailed description of the input parameters
"RTN","BSTSAPI",87,0)
 ; and the output format.
"RTN","BSTSAPI",88,0)
 ;
"RTN","BSTSAPI",89,0)
 Q $$MPADVICE^BSTSAPIC(OUT,$G(IN))
"RTN","BSTSAPI",90,0)
 ;
"RTN","BSTSAPI",91,0)
SUBLST(OUT,IN) ;PEP - Returns a list of concepts in a specified subset
"RTN","BSTSAPI",92,0)
 ;
"RTN","BSTSAPI",93,0)
 ; See SUBLST^BSTSAPIC for a detailed description of the input parameters
"RTN","BSTSAPI",94,0)
 ; and the output format.
"RTN","BSTSAPI",95,0)
 ;
"RTN","BSTSAPI",96,0)
 Q $$SUBLST^BSTSAPIC(OUT,$G(IN))
"RTN","BSTSAPI",97,0)
 ;
"RTN","BSTSAPI",98,0)
VALSBTRM(OUT,IN) ;PEP - Returns whether a given term is in a particular subset
"RTN","BSTSAPI",99,0)
 ;
"RTN","BSTSAPI",100,0)
 ; See VALSBTRM^BSTSAPIB for a detailed description of the input parameters
"RTN","BSTSAPI",101,0)
 ; and the output format.
"RTN","BSTSAPI",102,0)
 ;
"RTN","BSTSAPI",103,0)
 Q $$VALSBTRM^BSTSAPIB(OUT,IN)
"RTN","BSTSAPI",104,0)
 ;
"RTN","BSTSAPI",105,0)
ICD2SMD(OUT,IN) ;PEP - Returns the SNOMED terms which map to a given ICD9 code
"RTN","BSTSAPI",106,0)
 ;
"RTN","BSTSAPI",107,0)
 ; See ICD2SMD^BSTSAPID for a detailed description of the input parameters
"RTN","BSTSAPI",108,0)
 ; and the output format.
"RTN","BSTSAPI",109,0)
 ;
"RTN","BSTSAPI",110,0)
 Q $$ICD2SMD^BSTSAPID(OUT,IN)
"RTN","BSTSAPI",111,0)
 ;
"RTN","BSTSAPI",112,0)
DILKP(OUT,IN) ;PEP - Performs a drug ingredient lookup on a specified value
"RTN","BSTSAPI",113,0)
 ;
"RTN","BSTSAPI",114,0)
 ; See DILKP^BSTSAPIF for a detailed description of the input parameters
"RTN","BSTSAPI",115,0)
 ; and the output format.
"RTN","BSTSAPI",116,0)
 Q $$DILKP^BSTSAPIF(OUT,IN)
"RTN","BSTSAPI",117,0)
 ;
"RTN","BSTSAPI",118,0)
VSBTRMF(IN) ;PEP - Function Call: Returns whether a given term is in a particular subset
"RTN","BSTSAPI",119,0)
 ;
"RTN","BSTSAPI",120,0)
 ;Input
"RTN","BSTSAPI",121,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPI",122,0)
 ;  IN - P1 - Description Id of term to check
"RTN","BSTSAPI",123,0)
 ;     - P2 - The subset to look in
"RTN","BSTSAPI",124,0)
 ;     - P3 (Optional) - The code set Id (default SNOMED '36')
"RTN","BSTSAPI",125,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPI",126,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPI",127,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPI",128,0)
 ;
"RTN","BSTSAPI",129,0)
 ;Output
"RTN","BSTSAPI",130,0)
 ;
"RTN","BSTSAPI",131,0)
 ; VAR = 1:Term is in the provided subset
"RTN","BSTSAPI",132,0)
 ;       0:Term is not in the provided subset
"RTN","BSTSAPI",133,0)
 ;
"RTN","BSTSAPI",134,0)
 NEW FOUT,STS,%D
"RTN","BSTSAPI",135,0)
 ;
"RTN","BSTSAPI",136,0)
 S STS=$$VALSBTRM^BSTSAPIB("FOUT",IN)
"RTN","BSTSAPI",137,0)
 Q FOUT
"RTN","BSTSAPI",138,0)
 ;
"RTN","BSTSAPI",139,0)
DESC(IN) ;PEP - Function Call: Returns detail information for a specified Description Id
"RTN","BSTSAPI",140,0)
 ;
"RTN","BSTSAPI",141,0)
 ;Input
"RTN","BSTSAPI",142,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPI",143,0)
 ;  IN - P1 - The Description Id to look up
"RTN","BSTSAPI",144,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED '36')
"RTN","BSTSAPI",145,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPI",146,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPI",147,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPI",148,0)
 ;
"RTN","BSTSAPI",149,0)
 ;Output
"RTN","BSTSAPI",150,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPI",151,0)
 ; [1] - Concept Id
"RTN","BSTSAPI",152,0)
 ; [2] - Term Description
"RTN","BSTSAPI",153,0)
 ;
"RTN","BSTSAPI",154,0)
 Q $$DESC^BSTSAPIA($G(IN))
"RTN","BSTSAPI",155,0)
 ;
"RTN","BSTSAPI",156,0)
CONC(IN) ;PEP - Returns detail information for a specified Concept Id
"RTN","BSTSAPI",157,0)
 ;
"RTN","BSTSAPI",158,0)
 ;Input
"RTN","BSTSAPI",159,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPI",160,0)
 ;  IN - P1 - The Concept Id to look up
"RTN","BSTSAPI",161,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED '36')
"RTN","BSTSAPI",162,0)
 ;     - P3 (Optional) - Snapshot Date to check (default DT)
"RTN","BSTSAPI",163,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPI",164,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPI",165,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPI",166,0)
 ;
"RTN","BSTSAPI",167,0)
 ;Output
"RTN","BSTSAPI",168,0)
 ; Function returns - [1]^[2]^[3]^[4]
"RTN","BSTSAPI",169,0)
 ; [1] - Description Id of Fully Specified Name
"RTN","BSTSAPI",170,0)
 ; [2] - Fully Specified Name
"RTN","BSTSAPI",171,0)
 ; [3] - Description Id of Preferred Term
"RTN","BSTSAPI",172,0)
 ; [4] - Preferred Term
"RTN","BSTSAPI",173,0)
 ;
"RTN","BSTSAPI",174,0)
 Q $$CONC^BSTSAPIA($G(IN))
"RTN","BSTSAPIA")
0^2^B81943812
"RTN","BSTSAPIA",1,0)
BSTSAPIA ;GDIT/HS/BEE-Standard Terminology API Program ;26-Jun-2015 18:12;DKM
"RTN","BSTSAPIA",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSAPIA",3,0)
 ;
"RTN","BSTSAPIA",4,0)
 Q
"RTN","BSTSAPIA",5,0)
 ;
"RTN","BSTSAPIA",6,0)
SEARCH(OUT,IN) ;EP - Perform Codeset Search
"RTN","BSTSAPIA",7,0)
 ;
"RTN","BSTSAPIA",8,0)
 ;Input
"RTN","BSTSAPIA",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIA",10,0)
 ;  IN - P1 - Search string
"RTN","BSTSAPIA",11,0)
 ;     - P2 - Search Type - (F-Fully specified name, S-Synonyms)
"RTN","BSTSAPIA",12,0)
 ;     - P3 (Optional) - Namespace ID - Default to SNOMED US EXT (#36)
"RTN","BSTSAPIA",13,0)
 ;                     ID      NAME
"RTN","BSTSAPIA",14,0)
 ;                     5180    FDA UNII
"RTN","BSTSAPIA",15,0)
 ;                     32773   GMRA Allergies with Maps
"RTN","BSTSAPIA",16,0)
 ;                     32772   GMRA Signs Symptoms
"RTN","BSTSAPIA",17,0)
 ;                     32771   IHS VANDF
"RTN","BSTSAPIA",18,0)
 ;                     32774   IHS Med Route
"RTN","BSTSAPIA",19,0)
 ;                     1552    RxNorm R
"RTN","BSTSAPIA",20,0)
 ;                     36      SNOMED CT US Extension
"RTN","BSTSAPIA",21,0)
 ;
"RTN","BSTSAPIA",22,0)
 ;     - P4 (Optional) - Subset(s) to filter on (delimited by "~")
"RTN","BSTSAPIA",23,0)
 ;                       If blank default to "IHS Problem List". For SNOMED lookups
"RTN","BSTSAPIA",24,0)
 ;                       passing "ALL" searches on all available SNOMED terms.
"RTN","BSTSAPIA",25,0)
 ;     - P5 (Optional) - Date to check (default to T+2)
"RTN","BSTSAPIA",26,0)
 ;     - P6 (Optional) - Maximum number of concepts/terms to return (default 25)
"RTN","BSTSAPIA",27,0)
 ;     - P7 (Optional) - Return Info (P-Preferred,S-Synonym,B-Subset,I-IsA
"RTN","BSTSAPIA",28,0)
 ;                       X-ICD9/ICD10,C-Children,A-Associations,V-Inv Assoc)
"RTN","BSTSAPIA",29,0)
 ;                       (Default is all - "PSBIXCAV")
"RTN","BSTSAPIA",30,0)
 ;     - P8 (Optional) - Pass 1 to NOT return Add/Retire date info
"RTN","BSTSAPIA",31,0)
 ;     - P9 (Optional) - Batch Return - Start at record #
"RTN","BSTSAPIA",32,0)
 ;                       (used in conjunction with P7)
"RTN","BSTSAPIA",33,0)
 ;     - P10 (Optional) - Batch Return - # of concepts to return per batch
"RTN","BSTSAPIA",34,0)
 ;                       (used in conjunction with P6)
"RTN","BSTSAPIA",35,0)
 ;     - P11 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIA",36,0)
 ;                        blank for remote listing
"RTN","BSTSAPIA",37,0)
 ;     - P12 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIA",38,0)
 ;
"RTN","BSTSAPIA",39,0)
 ;Output
"RTN","BSTSAPIA",40,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIA",41,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIA",42,0)
 ;       1:Local information returned
"RTN","BSTSAPIA",43,0)
 ;       0:No Information Returned
"RTN","BSTSAPIA",44,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIA",45,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIA",46,0)
 ;
"RTN","BSTSAPIA",47,0)
 ; VAR(#) - List of Records
"RTN","BSTSAPIA",48,0)
 ;
"RTN","BSTSAPIA",49,0)
 ; The VAR(#) list of records returns the following sections
"RTN","BSTSAPIA",50,0)
 ; (based on the input piece 6 and 7 values):
"RTN","BSTSAPIA",51,0)
 ;
"RTN","BSTSAPIA",52,0)
 ;Concept ID/DTSID
"RTN","BSTSAPIA",53,0)
 ; VAR(#,"CON")=Concept Id
"RTN","BSTSAPIA",54,0)
 ; VAR(#,"DTS")=Internal DTS Id
"RTN","BSTSAPIA",55,0)
 ;
"RTN","BSTSAPIA",56,0)
 ;Fully Specified Name
"RTN","BSTSAPIA",57,0)
 ; VAR(#,"FSN","DSC")=Description Id of the FSN
"RTN","BSTSAPIA",58,0)
 ; VAR(#,"FSN","TRM")=Fully Specified Name
"RTN","BSTSAPIA",59,0)
 ; VAR(#,"FSN","XADT")=Date Added
"RTN","BSTSAPIA",60,0)
 ; VAR(#,"FSN","XRDT")=Date Retired
"RTN","BSTSAPIA",61,0)
 ;
"RTN","BSTSAPIA",62,0)
 ;ICD9 Information - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",63,0)
 ; VAR(#,"ICD",CTR,"COD")=ICD9 Code
"RTN","BSTSAPIA",64,0)
 ; VAR(#,"ICD",CTR,"TYP")=Code Type(ICD)
"RTN","BSTSAPIA",65,0)
 ; VAR(#,"ICD",CTR,"XADT")=Date Added
"RTN","BSTSAPIA",66,0)
 ; VAR(#,"ICD",CTR,"XRDT")=Date Retired
"RTN","BSTSAPIA",67,0)
 ;
"RTN","BSTSAPIA",68,0)
 ;IsA Information - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",69,0)
 ; VAR(#,"ISA",CTR,"CON")=Concept Id of IsA Term (may be blank prior to detail lookup)
"RTN","BSTSAPIA",70,0)
 ; VAR(#,"ISA",CTR,"DTS")=DTSId of the IsA Term
"RTN","BSTSAPIA",71,0)
 ; VAR(#,"ISA",CTR,"TRM")=IsA Term Name
"RTN","BSTSAPIA",72,0)
 ; VAR(#,"ISA",CTR,"XADT")=Date Added
"RTN","BSTSAPIA",73,0)
 ; VAR(#,"ISA",CTR,"XRDT")=Date Retired
"RTN","BSTSAPIA",74,0)
 ;
"RTN","BSTSAPIA",75,0)
 ;Association Information (SNOMED) - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",76,0)
 ; VAR(#,"ASM",CTR,"CON")=SNOMED Concept CT Association
"RTN","BSTSAPIA",77,0)
 ; VAR(#,"ASM",CTR,"DTS")=DTSId of the SNOMED Concept
"RTN","BSTSAPIA",78,0)
 ;
"RTN","BSTSAPIA",79,0)
 ;Association Information (RxNorm) - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",80,0)
 ; VAR(#,"ARX",CTR,"CON")=RxNorm Code Value Association
"RTN","BSTSAPIA",81,0)
 ; VAR(#,"ARX",CTR,"DTS")=DTSId of the RxNorm Concept
"RTN","BSTSAPIA",82,0)
 ;
"RTN","BSTSAPIA",83,0)
 ;Association Information (UNII) - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",84,0)
 ; VAR(#,"ASN",CTR,"CON")=UNII Code Value Association
"RTN","BSTSAPIA",85,0)
 ; VAR(#,"ASN",CTR,"DTS")=DTSId of the UNII Concept
"RTN","BSTSAPIA",86,0)
 ;
"RTN","BSTSAPIA",87,0)
 ;Inverse Association Information (RxNorm) - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",88,0)
 ; VAR(#,"IAR",CTR,"CON")=RxNorm Code Value of Inverse Association
"RTN","BSTSAPIA",89,0)
 ; VAR(#,"IAR",CTR,"DTS")=DTSId of the RxNorm Concept
"RTN","BSTSAPIA",90,0)
 ; VAR(#,"IAR",CTR,"TRM")=Inverse Association Term
"RTN","BSTSAPIA",91,0)
 ;
"RTN","BSTSAPIA",92,0)
 ;Child Information - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",93,0)
 ; VAR(#,"CHD",CTR,"CON")=Concept Id of Child Term (may be blank prior to detail lookup)
"RTN","BSTSAPIA",94,0)
 ; VAR(#,"CHD",CTR,"DTS")=DTSId of the Child Term
"RTN","BSTSAPIA",95,0)
 ; VAR(#,"CHD",CTR,"TRM")=IsA Term Name
"RTN","BSTSAPIA",96,0)
 ; VAR(#,"CHD",CTR,"XADT")=Date Added
"RTN","BSTSAPIA",97,0)
 ; VAR(#,"CHD",CTR,"XRDT")=Date Retired
"RTN","BSTSAPIA",98,0)
 ;
"RTN","BSTSAPIA",99,0)
 ;Lookup Problem Column Value (Preferred Term Information for concept for Search Type
"RTN","BSTSAPIA",100,0)
 ;[F] or Synonym or Preferred Term Information for Search Type [S])
"RTN","BSTSAPIA",101,0)
 ;(Based on Search Type parameter - F/S)
"RTN","BSTSAPIA",102,0)
 ; VAR(#,"PRB","DSC")=Description Id of a Pref Term (Type F) or Synonym/Pref Term (S)
"RTN","BSTSAPIA",103,0)
 ; VAR(#,"PRB","TRM")=Preferred Name of a Concept (F) or a Synonym/Preferred Name (S)
"RTN","BSTSAPIA",104,0)
 ;
"RTN","BSTSAPIA",105,0)
 ;Preferred Term Information
"RTN","BSTSAPIA",106,0)
 ; VAR(#,"PRE","DSC")=Description ID of Preferred Term
"RTN","BSTSAPIA",107,0)
 ; VAR(#,"PRE","TRM")=Preferred Term
"RTN","BSTSAPIA",108,0)
 ; VAR(#,"PRE","XADT")=Date Added
"RTN","BSTSAPIA",109,0)
 ; VAR(#,"PRE","XRDT")=Date Retired
"RTN","BSTSAPIA",110,0)
 ;
"RTN","BSTSAPIA",111,0)
 ;Subset Information - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",112,0)
 ; VAR(#,"SUB",CTR,"SUB")=Subset Name
"RTN","BSTSAPIA",113,0)
 ; VAR(#,"SUB",CTR,"XADT")=Date Added
"RTN","BSTSAPIA",114,0)
 ; VAR(#,"SUB",CTR,"XRDT")=Date Retired
"RTN","BSTSAPIA",115,0)
 ;
"RTN","BSTSAPIA",116,0)
 ;Synonym Information - Multiple Records Returned (CTR)
"RTN","BSTSAPIA",117,0)
 ; VAR(#,"SYN",CTR,"DSC")=Description ID of Synonym
"RTN","BSTSAPIA",118,0)
 ; VAR(#,"SYN",CTR,"TRM")=Synonym Term
"RTN","BSTSAPIA",119,0)
 ; VAR(#,"SYN",CTR,"XADT")=Date Added
"RTN","BSTSAPIA",120,0)
 ; VAR(#,"SYN",CTR,"XRDT")=Date Retired
"RTN","BSTSAPIA",121,0)
 ;
"RTN","BSTSAPIA",122,0)
 ;Date Concept Added/Retired
"RTN","BSTSAPIA",123,0)
 ; VAR(#,"XADT")=Date Added
"RTN","BSTSAPIA",124,0)
 ; VAR(#,"XRDT")=Date Retired
"RTN","BSTSAPIA",125,0)
 ;
"RTN","BSTSAPIA",126,0)
 ;RxNorm Only - TTY
"RTN","BSTSAPIA",127,0)
 ; VAR(#,"TTY",CTR,"TTY")=TTY Code
"RTN","BSTSAPIA",128,0)
 ; VAR(#,"TTY",CTR,"XADT")=Date Added
"RTN","BSTSAPIA",129,0)
 ; VAR(#,"TTY",CTR,"XRDT")=Date Retired
"RTN","BSTSAPIA",130,0)
 ;
"RTN","BSTSAPIA",131,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIA D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIA",132,0)
 ;
"RTN","BSTSAPIA",133,0)
 N SEARCH,STYPE,NMID,SUB,SNAPDT,MAX,BCTCHRC,BCTCHCT,LOCAL
"RTN","BSTSAPIA",134,0)
 N RESULT,DEBUG,BSTSR,BSTSI,RET,DAT,BSTSWS,BSTSD,X,%,%H,%D
"RTN","BSTSAPIA",135,0)
 K @OUT
"RTN","BSTSAPIA",136,0)
 ;
"RTN","BSTSAPIA",137,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIA",138,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIA",139,0)
 S SEARCH=$P(IN,U) Q:($TR(SEARCH," ")="") "0^Invalid Search String"
"RTN","BSTSAPIA",140,0)
 S STYPE=$P(IN,U,2) I STYPE'="F",STYPE'="S" Q "0^Invalid Search Type"
"RTN","BSTSAPIA",141,0)
 S NMID=$P(IN,U,3) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIA",142,0)
 S SUB=$P(IN,U,4)
"RTN","BSTSAPIA",143,0)
 S SNAPDT=$P(IN,U,5) S:SNAPDT]"" SNAPDT=$$DATE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIA",144,0)
 S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)_".0001"
"RTN","BSTSAPIA",145,0)
 S SNAPDT=$$FMTE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIA",146,0)
 S MAX=$P(IN,U,6) S:'MAX MAX=25
"RTN","BSTSAPIA",147,0)
 S RET=$P(IN,U,7) S:RET="" RET="PSBIXCAV"
"RTN","BSTSAPIA",148,0)
 S DAT=$P(IN,U,8)
"RTN","BSTSAPIA",149,0)
 S BCTCHRC=$P(IN,U,9)
"RTN","BSTSAPIA",150,0)
 S BCTCHCT=$P(IN,U,10) I BCTCHRC,'BCTCHCT S BCTCHCT=MAX
"RTN","BSTSAPIA",151,0)
 S LOCAL=$P(IN,U,11),LOCAL=$S(LOCAL=1:"1",1:"")
"RTN","BSTSAPIA",152,0)
 S DEBUG=$P(IN,U,12),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIA",153,0)
 ;
"RTN","BSTSAPIA",154,0)
 ;Check for new version
"RTN","BSTSAPIA",155,0)
 D VCHK^BSTSVRSN(NMID)
"RTN","BSTSAPIA",156,0)
 ;
"RTN","BSTSAPIA",157,0)
 ;Periodic subset check
"RTN","BSTSAPIA",158,0)
 D SCHK^BSTSVRSN(NMID)
"RTN","BSTSAPIA",159,0)
 ;
"RTN","BSTSAPIA",160,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIA",161,0)
 S BSTSWS("STYPE")=STYPE
"RTN","BSTSAPIA",162,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIA",163,0)
 S BSTSWS("SUBSET")=SUB
"RTN","BSTSAPIA",164,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIA",165,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIA",166,0)
 S BSTSWS("BCTCHRC")=BCTCHRC
"RTN","BSTSAPIA",167,0)
 S BSTSWS("BCTCHCT")=BCTCHCT
"RTN","BSTSAPIA",168,0)
 S BSTSWS("RET")=RET
"RTN","BSTSAPIA",169,0)
 S BSTSWS("DAT")=DAT
"RTN","BSTSAPIA",170,0)
 ;
"RTN","BSTSAPIA",171,0)
 S BSTSI=0
"RTN","BSTSAPIA",172,0)
 ;
"RTN","BSTSAPIA",173,0)
 ;Make DTS search call
"RTN","BSTSAPIA",174,0)
 S BSTSR=1
"RTN","BSTSAPIA",175,0)
 ;
"RTN","BSTSAPIA",176,0)
 ;DTS Call
"RTN","BSTSAPIA",177,0)
 I LOCAL'=1 S BSTSR=$$SEARCH^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIA",178,0)
 ;
"RTN","BSTSAPIA",179,0)
 ;If no results, try performing local search
"RTN","BSTSAPIA",180,0)
 I $D(RESULT)<10 S BSTSD=$$SRC^BSTSSRCH("RESULT",.BSTSWS)
"RTN","BSTSAPIA",181,0)
 ;
"RTN","BSTSAPIA",182,0)
 ;Loop through search results and retrieve detail
"RTN","BSTSAPIA",183,0)
 S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIA",184,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIA",185,0)
 Q BSTSR
"RTN","BSTSAPIA",186,0)
 ;
"RTN","BSTSAPIA",187,0)
CODESETS(OUT,IN) ;EP - Return list of available codesets
"RTN","BSTSAPIA",188,0)
 ;
"RTN","BSTSAPIA",189,0)
 ;Input
"RTN","BSTSAPIA",190,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIA",191,0)
 ;  IN - P1 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIA",192,0)
 ;                       blank for remote listing
"RTN","BSTSAPIA",193,0)
 ;     - P2 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIA",194,0)
 ;
"RTN","BSTSAPIA",195,0)
 ;Output
"RTN","BSTSAPIA",196,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIA",197,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIA",198,0)
 ;       1:Local information returned
"RTN","BSTSAPIA",199,0)
 ;       0:No Information Returned
"RTN","BSTSAPIA",200,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIA",201,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIA",202,0)
 ;
"RTN","BSTSAPIA",203,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSAPIA",204,0)
 ; [1] - Codeset Id
"RTN","BSTSAPIA",205,0)
 ; [2] - Codeset Code
"RTN","BSTSAPIA",206,0)
 ; [3] - Codeset Name
"RTN","BSTSAPIA",207,0)
 ;
"RTN","BSTSAPIA",208,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIA D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIA",209,0)
 ;
"RTN","BSTSAPIA",210,0)
 N LOCAL,DEBUG,BSTSR,CDCD,CDIEN,BSTSI,X,%,%H,%D
"RTN","BSTSAPIA",211,0)
 K @OUT
"RTN","BSTSAPIA",212,0)
 ;
"RTN","BSTSAPIA",213,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIA",214,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIA",215,0)
 S LOCAL=$P(IN,U),LOCAL=$S(LOCAL=1:"1",1:"")
"RTN","BSTSAPIA",216,0)
 S DEBUG=$P(IN,U,2),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIA",217,0)
 ;
"RTN","BSTSAPIA",218,0)
 S BSTSI=0
"RTN","BSTSAPIA",219,0)
 ;
"RTN","BSTSAPIA",220,0)
 ;Make update call
"RTN","BSTSAPIA",221,0)
 S BSTSR=1
"RTN","BSTSAPIA",222,0)
 I LOCAL'=1 S BSTSR=$$GCDSET^BSTSWSV(DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIA",223,0)
 ;
"RTN","BSTSAPIA",224,0)
 ;Loop through files and retrieve results
"RTN","BSTSAPIA",225,0)
 S CDCD="" F  S CDCD=$O(^BSTS(9002318.1,"C",CDCD)) Q:CDCD=""  D
"RTN","BSTSAPIA",226,0)
 . S CDIEN="" F  S CDIEN=$O(^BSTS(9002318.1,"C",CDCD,CDIEN)) Q:CDIEN=""  D
"RTN","BSTSAPIA",227,0)
 .. NEW CDID,CDCODE,CDNAME
"RTN","BSTSAPIA",228,0)
 .. S CDID=$$GET1^DIQ(9002318.1,CDIEN_",",.01,"E") Q:CDID=""
"RTN","BSTSAPIA",229,0)
 .. S CDCODE=$$GET1^DIQ(9002318.1,CDIEN_",",.02,"E") Q:CDCODE=""
"RTN","BSTSAPIA",230,0)
 .. S CDNAME=$$GET1^DIQ(9002318.1,CDIEN_",",.03,"E")
"RTN","BSTSAPIA",231,0)
 .. S BSTSI=BSTSI+1,@OUT@(BSTSI)=CDID_U_CDCODE_U_CDNAME
"RTN","BSTSAPIA",232,0)
 S $P(BSTSR,U)=$S(BSTSI=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIA",233,0)
 Q BSTSR
"RTN","BSTSAPIA",234,0)
 ;
"RTN","BSTSAPIA",235,0)
VERSIONS(OUT,IN) ;EP - Return a list of available versions for a code set
"RTN","BSTSAPIA",236,0)
 ;
"RTN","BSTSAPIA",237,0)
 ;Input
"RTN","BSTSAPIA",238,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIA",239,0)
 ;  IN - P1 (Optional) - Namespace ID - Default to SNOMED US EXT (#36)
"RTN","BSTSAPIA",240,0)
 ;     - P2 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIA",241,0)
 ;                       blank for remote listing
"RTN","BSTSAPIA",242,0)
 ;     - P3 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIA",243,0)
 ;
"RTN","BSTSAPIA",244,0)
 ;Output
"RTN","BSTSAPIA",245,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIA",246,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIA",247,0)
 ;       1:Local information returned
"RTN","BSTSAPIA",248,0)
 ;       0:No Information Returned
"RTN","BSTSAPIA",249,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIA",250,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIA",251,0)
 ;
"RTN","BSTSAPIA",252,0)
 ; VAR(#) - [1]^[2]^[3]^[4]
"RTN","BSTSAPIA",253,0)
 ; [1] - Version Id
"RTN","BSTSAPIA",254,0)
 ; [2] - Version Name
"RTN","BSTSAPIA",255,0)
 ; [3] - Version Release Date
"RTN","BSTSAPIA",256,0)
 ; [4] - Version Install Date (if available)
"RTN","BSTSAPIA",257,0)
 ;
"RTN","BSTSAPIA",258,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIA D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIA",259,0)
 ;
"RTN","BSTSAPIA",260,0)
 N LOCAL,DEBUG,BSTSR,NMID,NMIEN,BSTSI,VRID,X,%,%H,%D
"RTN","BSTSAPIA",261,0)
 K @OUT
"RTN","BSTSAPIA",262,0)
 ;
"RTN","BSTSAPIA",263,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIA",264,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIA",265,0)
 S NMID=$P(IN,U) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIA",266,0)
 S LOCAL=$P(IN,U,2),LOCAL=$S(LOCAL=1:"1",1:"")
"RTN","BSTSAPIA",267,0)
 S DEBUG=$P(IN,U,3),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIA",268,0)
 ;
"RTN","BSTSAPIA",269,0)
 S BSTSI=0
"RTN","BSTSAPIA",270,0)
 ;
"RTN","BSTSAPIA",271,0)
 ;Make update call
"RTN","BSTSAPIA",272,0)
 S BSTSR=1
"RTN","BSTSAPIA",273,0)
 I LOCAL'=1,NMID S BSTSR=$$GVRSET^BSTSWSV(NMID,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIA",274,0)
 ;
"RTN","BSTSAPIA",275,0)
 ;Loop through files and retrieve results
"RTN","BSTSAPIA",276,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,""))
"RTN","BSTSAPIA",277,0)
 I NMIEN]"" S VRID="" F  S VRID=$O(^BSTS(9002318.1,NMIEN,1,"B",VRID)) Q:VRID=""  D
"RTN","BSTSAPIA",278,0)
 . N VRIEN
"RTN","BSTSAPIA",279,0)
 . S VRIEN="" F  S VRIEN=$O(^BSTS(9002318.1,NMIEN,1,"B",VRID,VRIEN)) Q:VRIEN=""  D
"RTN","BSTSAPIA",280,0)
 .. NEW VRNAME,VRRLDT,VRINDT,DA,IENS
"RTN","BSTSAPIA",281,0)
 .. S DA(1)=NMIEN,DA=VRIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSAPIA",282,0)
 .. S VRNAME=$$GET1^DIQ(9002318.11,IENS,.02,"E") Q:VRNAME=""
"RTN","BSTSAPIA",283,0)
 .. S VRRLDT=$$FMTE^XLFDT($$GET1^DIQ(9002318.11,IENS,.03,"I"),"5D")
"RTN","BSTSAPIA",284,0)
 .. S VRINDT=$$FMTE^XLFDT($$GET1^DIQ(9002318.11,IENS,.04,"I"),"5D")
"RTN","BSTSAPIA",285,0)
 .. S BSTSI=BSTSI+1,@OUT@(BSTSI)=VRID_U_VRNAME_U_VRRLDT_U_VRINDT
"RTN","BSTSAPIA",286,0)
 S $P(BSTSR,U)=$S(BSTSI=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIA",287,0)
 Q BSTSR
"RTN","BSTSAPIA",288,0)
 ;
"RTN","BSTSAPIA",289,0)
SUBSET(OUT,IN) ;EP - Return the list of subsets available for a Code Set
"RTN","BSTSAPIA",290,0)
 ;
"RTN","BSTSAPIA",291,0)
 ;
"RTN","BSTSAPIA",292,0)
 ;Input
"RTN","BSTSAPIA",293,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIA",294,0)
 ;  IN - P1 (Optional) - Namespace ID - Default to SNOMED US EXT (#36)
"RTN","BSTSAPIA",295,0)
 ;     - P2 (Optional) - LOCAL - Pass 1 OR leave blank to perform local listing,
"RTN","BSTSAPIA",296,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIA",297,0)
 ;     - P3 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIA",298,0)
 ;
"RTN","BSTSAPIA",299,0)
 ;Output
"RTN","BSTSAPIA",300,0)
 ; Function returns - [1]^[2]
"RTN","BSTSAPIA",301,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIA",302,0)
 ;       1:Local information returned
"RTN","BSTSAPIA",303,0)
 ;       0:No Information Returned
"RTN","BSTSAPIA",304,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIA",305,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIA",306,0)
 ;
"RTN","BSTSAPIA",307,0)
 ; VAR(#) - [1]
"RTN","BSTSAPIA",308,0)
 ; [1] - Subset
"RTN","BSTSAPIA",309,0)
 ;
"RTN","BSTSAPIA",310,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIA D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIA",311,0)
 ;
"RTN","BSTSAPIA",312,0)
 N SUB,NMID,CNT,X,%,%H,RESULT,NMIEN,BSTSR,LOCAL,DEBUG,%D
"RTN","BSTSAPIA",313,0)
 K @OUT
"RTN","BSTSAPIA",314,0)
 ;
"RTN","BSTSAPIA",315,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIA",316,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIA",317,0)
 S NMID=$P(IN,U) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIA",318,0)
 S LOCAL=$P(IN,U,2),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIA",319,0)
 S DEBUG=$P(IN,U,3),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIA",320,0)
 ;
"RTN","BSTSAPIA",321,0)
 ;Make sure we have a codeset (namespace)
"RTN","BSTSAPIA",322,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,"")) Q:NMIEN=""
"RTN","BSTSAPIA",323,0)
 ;
"RTN","BSTSAPIA",324,0)
 ;Make update call
"RTN","BSTSAPIA",325,0)
 S BSTSR=1
"RTN","BSTSAPIA",326,0)
 I LOCAL'=1,NMID S BSTSR=$$SUBSET^BSTSWSV("RESULT",NMID,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIA",327,0)
 I $D(RESULT)>9 M @OUT=RESULT
"RTN","BSTSAPIA",328,0)
 ;
"RTN","BSTSAPIA",329,0)
 ;If no results from call get from local
"RTN","BSTSAPIA",330,0)
 I $D(RESULT)<10 S $P(BSTSR,U)=1,SUB="",CNT=0 F  S SUB=$O(^BSTS(9002318.4,"E",NMIEN,SUB)) Q:SUB=""  D
"RTN","BSTSAPIA",331,0)
 . S CNT=CNT+1
"RTN","BSTSAPIA",332,0)
 . S @OUT@(CNT)=SUB
"RTN","BSTSAPIA",333,0)
 ;
"RTN","BSTSAPIA",334,0)
 ;Mark if no results
"RTN","BSTSAPIA",335,0)
 I $D(@OUT)<10 S $P(BSTSR,U)=0
"RTN","BSTSAPIA",336,0)
 Q BSTSR
"RTN","BSTSAPIA",337,0)
 ;
"RTN","BSTSAPIA",338,0)
DESC(IN) ;PEP - Returns detail information for a specified Description Id
"RTN","BSTSAPIA",339,0)
 ;
"RTN","BSTSAPIA",340,0)
 ;Input
"RTN","BSTSAPIA",341,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIA",342,0)
 ;  IN - P1 - The Description Id to look up
"RTN","BSTSAPIA",343,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIA",344,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIA",345,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIA",346,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIA",347,0)
 ;
"RTN","BSTSAPIA",348,0)
 ;Output
"RTN","BSTSAPIA",349,0)
 ; Function returns - [1]^[2]
"RTN","BSTSAPIA",350,0)
 ; [1] - Concept Id
"RTN","BSTSAPIA",351,0)
 ; [2] - Term Description
"RTN","BSTSAPIA",352,0)
 ;
"RTN","BSTSAPIA",353,0)
 NEW VAR,RES,STS,ICD,IC,%D
"RTN","BSTSAPIA",354,0)
 S STS=$$DSCLKP^BSTSAPIB("VAR",$G(IN))
"RTN","BSTSAPIA",355,0)
 S RES=$G(VAR(1,"CON"))_U_$G(VAR(1,"PRB","TRM"))
"RTN","BSTSAPIA",356,0)
 ;
"RTN","BSTSAPIA",357,0)
 ;Tack on ICD9
"RTN","BSTSAPIA",358,0)
 S ICD="",IC="" S IC="" F  S IC=$O(VAR(1,"ICD",IC)) Q:IC=""  D
"RTN","BSTSAPIA",359,0)
 . NEW ICTYP,ICCOD
"RTN","BSTSAPIA",360,0)
 . S ICCOD=$G(VAR(1,"ICD",IC,"COD")) Q:IC=""
"RTN","BSTSAPIA",361,0)
 . S ICTYP=$G(VAR(1,"ICD",IC,"TYP")) Q:ICTYP'="IC9"
"RTN","BSTSAPIA",362,0)
 . S ICD=ICD_$S(ICD]"":";",1:"")_ICCOD
"RTN","BSTSAPIA",363,0)
 S RES=RES_U_ICD
"RTN","BSTSAPIA",364,0)
 ;
"RTN","BSTSAPIA",365,0)
 Q RES
"RTN","BSTSAPIA",366,0)
 ;
"RTN","BSTSAPIA",367,0)
CONC(IN) ;PEP - Returns basic information for a specified Concept Id
"RTN","BSTSAPIA",368,0)
 ;
"RTN","BSTSAPIA",369,0)
 ;Input
"RTN","BSTSAPIA",370,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIA",371,0)
 ;  IN - P1 - The Concept Id to look up
"RTN","BSTSAPIA",372,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED '36')
"RTN","BSTSAPIA",373,0)
 ;     - P3 (Optional) - Snapshot Date to check (default DT)
"RTN","BSTSAPIA",374,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIA",375,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIA",376,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIA",377,0)
 ;
"RTN","BSTSAPIA",378,0)
 ;Output
"RTN","BSTSAPIA",379,0)
 ; Function returns - [1]^[2]^[3]^[4]
"RTN","BSTSAPIA",380,0)
 ; [1] - Description Id of Fully Specified Name
"RTN","BSTSAPIA",381,0)
 ; [2] - Fully Specified Name
"RTN","BSTSAPIA",382,0)
 ; [3] - Description Id of Preferred Term
"RTN","BSTSAPIA",383,0)
 ; [4] - Preferred Term
"RTN","BSTSAPIA",384,0)
 ;
"RTN","BSTSAPIA",385,0)
 NEW VAR,RES,STS,ICD,IC,%D
"RTN","BSTSAPIA",386,0)
 S STS=$$CNCLKP^BSTSAPIB("VAR",$G(IN))
"RTN","BSTSAPIA",387,0)
 S RES=$G(VAR(1,"FSN","DSC"))_U_$G(VAR(1,"FSN","TRM"))_U_$G(VAR(1,"PRE","DSC"))_U_$G(VAR(1,"PRE","TRM"))
"RTN","BSTSAPIA",388,0)
 ;
"RTN","BSTSAPIA",389,0)
 ;Tack on ICD9
"RTN","BSTSAPIA",390,0)
 S ICD="",IC="" S IC="" F  S IC=$O(VAR(1,"ICD",IC)) Q:IC=""  D
"RTN","BSTSAPIA",391,0)
 . NEW ICTYP,ICCOD
"RTN","BSTSAPIA",392,0)
 . S ICCOD=$G(VAR(1,"ICD",IC,"COD")) Q:IC=""
"RTN","BSTSAPIA",393,0)
 . S ICTYP=$G(VAR(1,"ICD",IC,"TYP")) Q:ICTYP'="IC9"
"RTN","BSTSAPIA",394,0)
 . S ICD=ICD_$S(ICD]"":";",1:"")_ICCOD
"RTN","BSTSAPIA",395,0)
 S RES=RES_U_ICD
"RTN","BSTSAPIA",396,0)
 ;
"RTN","BSTSAPIA",397,0)
 Q RES
"RTN","BSTSAPIA",398,0)
 ;
"RTN","BSTSAPIA",399,0)
ERR ;
"RTN","BSTSAPIA",400,0)
 D ^%ZTER
"RTN","BSTSAPIA",401,0)
 Q
"RTN","BSTSAPIB")
0^9^B94662954
"RTN","BSTSAPIB",1,0)
BSTSAPIB ;GDIT/HS/BEE-Standard Terminology API Program ;26-Jun-2015 18:12;DKM
"RTN","BSTSAPIB",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSAPIB",3,0)
 ;
"RTN","BSTSAPIB",4,0)
 Q
"RTN","BSTSAPIB",5,0)
 ;
"RTN","BSTSAPIB",6,0)
VALTERM(OUT,IN) ;PEP - Returns whether a given term is a valid
"RTN","BSTSAPIB",7,0)
 ;
"RTN","BSTSAPIB",8,0)
 ;Input
"RTN","BSTSAPIB",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIB",10,0)
 ;  IN - P1 - The exact term to lookup
"RTN","BSTSAPIB",11,0)
 ;     - P2 (Optional) - The code set Id or Name (default SNOMED US EXT '36')
"RTN","BSTSAPIB",12,0)
 ;                          ID      NAME
"RTN","BSTSAPIB",13,0)
 ;                          32770   ECLIPS
"RTN","BSTSAPIB",14,0)
 ;                          5180    FDA UNII
"RTN","BSTSAPIB",15,0)
 ;                          32773   GMRA Allergies with Maps
"RTN","BSTSAPIB",16,0)
 ;                          32772   GMRA Signs Symptoms
"RTN","BSTSAPIB",17,0)
 ;                          32771   IHS VANDF
"RTN","BSTSAPIB",18,0)
 ;                          32774   IHS Med Route
"RTN","BSTSAPIB",19,0)
 ;                          1552    RxNorm R
"RTN","BSTSAPIB",20,0)
 ;                          36      SNOMED CT US Extension
"RTN","BSTSAPIB",21,0)
 ;
"RTN","BSTSAPIB",22,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2)
"RTN","BSTSAPIB",23,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIB",24,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIB",25,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIB",26,0)
 ;
"RTN","BSTSAPIB",27,0)
 ;Output
"RTN","BSTSAPIB",28,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIB",29,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIB",30,0)
 ;       1:Local information returned
"RTN","BSTSAPIB",31,0)
 ;       0:No Information Returned
"RTN","BSTSAPIB",32,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIB",33,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIB",34,0)
 ;
"RTN","BSTSAPIB",35,0)
 ; VAR(#) record(s) returned for any exact match
"RTN","BSTSAPIB",36,0)
 ; Information returned is in the same (full detail) format
"RTN","BSTSAPIB",37,0)
 ; as the detail returned for each record in the
"RTN","BSTSAPIB",38,0)
 ; search API
"RTN","BSTSAPIB",39,0)
 ;
"RTN","BSTSAPIB",40,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIB D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIB",41,0)
 ;
"RTN","BSTSAPIB",42,0)
 N SEARCH,NMID,SNAPDT,MAX,LOCAL,NMIEN,RLIST,I,NSEARCH,C,%D
"RTN","BSTSAPIB",43,0)
 N RESULT,DEBUG,BSTSR,BSTSI,BSTSWS,RES,BSTSD,X,%,%H,UPSRCH
"RTN","BSTSAPIB",44,0)
 K @OUT
"RTN","BSTSAPIB",45,0)
 ;
"RTN","BSTSAPIB",46,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIB",47,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIB",48,0)
 S SEARCH=$P(IN,U) I $TR(SEARCH," ")="" Q "0^Invalid Search String"
"RTN","BSTSAPIB",49,0)
 S UPSRCH=$$UP^XLFSTR(SEARCH)
"RTN","BSTSAPIB",50,0)
 S NMID=$P(IN,U,2) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIB",51,0)
 ;
"RTN","BSTSAPIB",52,0)
 ;Convert namespace to number if needed
"RTN","BSTSAPIB",53,0)
 I NMID'?1N.N D  I NMID="" Q "0^Invalid Namespace"
"RTN","BSTSAPIB",54,0)
 . S NMID=$O(^BSTS(9002318.1,"D",NMID,"")) Q:NMID=""
"RTN","BSTSAPIB",55,0)
 . S NMID=$$GET1^DIQ(9002318.1,NMID_",",".01","I")
"RTN","BSTSAPIB",56,0)
 ;
"RTN","BSTSAPIB",57,0)
 S SNAPDT=$P(IN,U,3) S:SNAPDT]"" SNAPDT=$$DATE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIB",58,0)
 S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)_".0001"
"RTN","BSTSAPIB",59,0)
 S SNAPDT=$$FMTE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIB",60,0)
 S MAX=50
"RTN","BSTSAPIB",61,0)
 S LOCAL=$P(IN,U,4),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIB",62,0)
 S DEBUG=$P(IN,U,5),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIB",63,0)
 ;
"RTN","BSTSAPIB",64,0)
 ;Handle strings with "'"
"RTN","BSTSAPIB",65,0)
 S NSEARCH="" F I=1:1:$L(SEARCH) S C=$E(SEARCH,I),NSEARCH=NSEARCH_$S(C="'":"'",1:"")_C
"RTN","BSTSAPIB",66,0)
 S BSTSWS("SEARCH")=NSEARCH
"RTN","BSTSAPIB",67,0)
 S BSTSWS("STYPE")="S"
"RTN","BSTSAPIB",68,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIB",69,0)
 S BSTSWS("SUBSET")=""
"RTN","BSTSAPIB",70,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIB",71,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIB",72,0)
 S BSTSWS("BCTCHRC")=""
"RTN","BSTSAPIB",73,0)
 S BSTSWS("BCTCHCT")=""
"RTN","BSTSAPIB",74,0)
 S BSTSWS("RET")="PSCBIXAV"
"RTN","BSTSAPIB",75,0)
 S BSTSWS("DAT")=""
"RTN","BSTSAPIB",76,0)
 S BSTSWS("EXACTMATCH")="T"
"RTN","BSTSAPIB",77,0)
 ;
"RTN","BSTSAPIB",78,0)
 ;Check for new version
"RTN","BSTSAPIB",79,0)
 D VCHK^BSTSVRSN(NMID)
"RTN","BSTSAPIB",80,0)
 ;
"RTN","BSTSAPIB",81,0)
 ;Make DTS Lookup call
"RTN","BSTSAPIB",82,0)
 S BSTSR=1
"RTN","BSTSAPIB",83,0)
 I LOCAL'=1 S BSTSR=$$SEARCH^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",84,0)
 ;
"RTN","BSTSAPIB",85,0)
 ;If no results, try performing local search
"RTN","BSTSAPIB",86,0)
 I $D(RESULT)<10 S BSTSD=$$SRC^BSTSSRCH("RESULT",.BSTSWS)
"RTN","BSTSAPIB",87,0)
 ;
"RTN","BSTSAPIB",88,0)
 ;If local search and no results try doing DTS lookup
"RTN","BSTSAPIB",89,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$SEARCH^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",90,0)
 ;
"RTN","BSTSAPIB",91,0)
 ;Now loop through and find exact term - Combine like terms
"RTN","BSTSAPIB",92,0)
 ;
"RTN","BSTSAPIB",93,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,""))
"RTN","BSTSAPIB",94,0)
 S RES="" F  S RES=$O(RESULT(RES)) Q:RES=""  D
"RTN","BSTSAPIB",95,0)
 . N REC,DIEN,TIEN,TERM,MATCH
"RTN","BSTSAPIB",96,0)
 . S MATCH=0
"RTN","BSTSAPIB",97,0)
 . S REC=RESULT(RES)
"RTN","BSTSAPIB",98,0)
 . S DIEN=$P(REC,U,3) Q:DIEN=""
"RTN","BSTSAPIB",99,0)
 . S TIEN=$O(^BSTS(9002318.3,"D",NMIEN,DIEN,"")) Q:TIEN=""
"RTN","BSTSAPIB",100,0)
 . S TERM=$$GET1^DIQ(9002318.3,TIEN_",",1,"E") Q:TERM=""
"RTN","BSTSAPIB",101,0)
 . ;
"RTN","BSTSAPIB",102,0)
 . ;Perform regular match
"RTN","BSTSAPIB",103,0)
 . I UPSRCH=($$UP^XLFSTR(TERM)) S MATCH=1
"RTN","BSTSAPIB",104,0)
 . ;
"RTN","BSTSAPIB",105,0)
 . ;Perform special concept search for UNII
"RTN","BSTSAPIB",106,0)
 . I MATCH=0,NMID=5180 D
"RTN","BSTSAPIB",107,0)
 .. N FSN,CIEN,DSC,CON
"RTN","BSTSAPIB",108,0)
 .. S CIEN=$$GET1^DIQ(9002318.3,TIEN_",",.03,"I") Q:CIEN=""
"RTN","BSTSAPIB",109,0)
 .. S FSN=$$GET1^DIQ(9002318.4,CIEN_",",1,"I") Q:FSN=""
"RTN","BSTSAPIB",110,0)
 .. I UPSRCH'=($$UP^XLFSTR(FSN)) Q
"RTN","BSTSAPIB",111,0)
 .. S CON=$$GET1^DIQ(9002318.4,CIEN_",",.02,"I") Q:CON=""
"RTN","BSTSAPIB",112,0)
 .. S DSC=$P($$CONC^BSTSAPI(CON_"^5180"),"^") Q:DSC=""
"RTN","BSTSAPIB",113,0)
 .. S $P(RESULT(RES),U,3)=DSC
"RTN","BSTSAPIB",114,0)
 .. S MATCH=1
"RTN","BSTSAPIB",115,0)
 . ;
"RTN","BSTSAPIB",116,0)
 . I MATCH=0 K RESULT(RES) Q
"RTN","BSTSAPIB",117,0)
 . ;
"RTN","BSTSAPIB",118,0)
 . Q:$D(RLIST($P(RESULT(RES),U,1,2)))
"RTN","BSTSAPIB",119,0)
 . S RLIST($P(RESULT(RES),U,1,2))=$P(RESULT(RES),U,3)
"RTN","BSTSAPIB",120,0)
 K RESULT S RES="" F I=1:1 S RES=$O(RLIST(RES)) Q:RES=""  S RESULT(I)=RES_U_RLIST(RES)
"RTN","BSTSAPIB",121,0)
 ;
"RTN","BSTSAPIB",122,0)
 ;Get the detail for the record
"RTN","BSTSAPIB",123,0)
 S BSTSD=0
"RTN","BSTSAPIB",124,0)
 I $D(RESULT)>1 D
"RTN","BSTSAPIB",125,0)
 . S BSTSWS("STYPE")="S"
"RTN","BSTSAPIB",126,0)
 . S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIB",127,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIB",128,0)
 Q BSTSR
"RTN","BSTSAPIB",129,0)
 ;
"RTN","BSTSAPIB",130,0)
DSCLKP(OUT,IN) ;EP - Returns detail information for a specified Description Id
"RTN","BSTSAPIB",131,0)
 ;
"RTN","BSTSAPIB",132,0)
 ;Input
"RTN","BSTSAPIB",133,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIB",134,0)
 ;  IN - P1 - The Description Id to look up
"RTN","BSTSAPIB",135,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIB",136,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIB",137,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIB",138,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIB",139,0)
 ;
"RTN","BSTSAPIB",140,0)
 ;Output
"RTN","BSTSAPIB",141,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIB",142,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIB",143,0)
 ;       1:Local information returned
"RTN","BSTSAPIB",144,0)
 ;       0:No Information Returned
"RTN","BSTSAPIB",145,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIB",146,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIB",147,0)
 ;
"RTN","BSTSAPIB",148,0)
 ; VAR(#) record is returned for any exact match
"RTN","BSTSAPIB",149,0)
 ; Information returned is in the same (full detail) format
"RTN","BSTSAPIB",150,0)
 ; as the detail returned for each record in the
"RTN","BSTSAPIB",151,0)
 ; search API
"RTN","BSTSAPIB",152,0)
 ;
"RTN","BSTSAPIB",153,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIB D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIB",154,0)
 ;
"RTN","BSTSAPIB",155,0)
 K @OUT
"RTN","BSTSAPIB",156,0)
 ;
"RTN","BSTSAPIB",157,0)
 N RESULT,SEARCH,NMID,SNAPDT,MAX,LOCAL,DEBUG,BSTSWS,BSTSR,BSTSD,X,%,%H,DIFILE,%D
"RTN","BSTSAPIB",158,0)
 ;
"RTN","BSTSAPIB",159,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIB",160,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIB",161,0)
 S SEARCH=$P(IN,U) I SEARCH="" Q "0^Invalid Description Id"
"RTN","BSTSAPIB",162,0)
 S NMID=$P(IN,U,2) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIB",163,0)
 ;S SNAPDT=0
"RTN","BSTSAPIB",164,0)
 S SNAPDT=$$DTCHG^BSTSUTIL(DT,2)
"RTN","BSTSAPIB",165,0)
 S SNAPDT=SNAPDT_".2400"
"RTN","BSTSAPIB",166,0)
 S SNAPDT=$$FMDT2XML^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIB",167,0)
 S MAX=100
"RTN","BSTSAPIB",168,0)
 S LOCAL=$P(IN,U,3),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIB",169,0)
 S DEBUG=$P(IN,U,4),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIB",170,0)
 ;
"RTN","BSTSAPIB",171,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIB",172,0)
 S BSTSWS("STYPE")="S"
"RTN","BSTSAPIB",173,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIB",174,0)
 S BSTSWS("SUBSET")=""
"RTN","BSTSAPIB",175,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIB",176,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIB",177,0)
 S BSTSWS("BCTCHRC")=""
"RTN","BSTSAPIB",178,0)
 S BSTSWS("BCTCHCT")=""
"RTN","BSTSAPIB",179,0)
 S BSTSWS("RET")="PSCBIXAV"
"RTN","BSTSAPIB",180,0)
 S BSTSWS("DAT")=""
"RTN","BSTSAPIB",181,0)
 ;
"RTN","BSTSAPIB",182,0)
 ;Make DTS Lookup call
"RTN","BSTSAPIB",183,0)
 S BSTSR=1
"RTN","BSTSAPIB",184,0)
 I LOCAL'=1 S BSTSR=$$DSCLKP^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",185,0)
 ;
"RTN","BSTSAPIB",186,0)
 ;If no results, try performing local search
"RTN","BSTSAPIB",187,0)
 I $D(RESULT)<10 S BSTSD=$$DSC^BSTSLKP("RESULT",.BSTSWS)
"RTN","BSTSAPIB",188,0)
 ;
"RTN","BSTSAPIB",189,0)
 ;If local search and no record try DTS Lookup
"RTN","BSTSAPIB",190,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$DSCLKP^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",191,0)
 ;
"RTN","BSTSAPIB",192,0)
 ;Get the detail for the record
"RTN","BSTSAPIB",193,0)
 S BSTSD=0
"RTN","BSTSAPIB",194,0)
 I $D(RESULT)>1 D
"RTN","BSTSAPIB",195,0)
 . S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIB",196,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIB",197,0)
 Q BSTSR
"RTN","BSTSAPIB",198,0)
 ;
"RTN","BSTSAPIB",199,0)
DTSLKP(OUT,IN) ;EP - Returns detail information for a specified DTS Id
"RTN","BSTSAPIB",200,0)
 ;
"RTN","BSTSAPIB",201,0)
 ;Input
"RTN","BSTSAPIB",202,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIB",203,0)
 ;  IN - P1 - The DTS Id to look up
"RTN","BSTSAPIB",204,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIB",205,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2) - Not implemented this build
"RTN","BSTSAPIB",206,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIB",207,0)
 ;                       blank for remote listing
"RTN","BSTSAPIB",208,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIB",209,0)
 ;
"RTN","BSTSAPIB",210,0)
 ;Output
"RTN","BSTSAPIB",211,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIB",212,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIB",213,0)
 ;       1:Local information returned
"RTN","BSTSAPIB",214,0)
 ;       0:No Information Returned
"RTN","BSTSAPIB",215,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIB",216,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIB",217,0)
 ;
"RTN","BSTSAPIB",218,0)
 ; VAR(#) record is returned for a match
"RTN","BSTSAPIB",219,0)
 ; Information returned is in the same (full detail) format
"RTN","BSTSAPIB",220,0)
 ; as the detail returned for each record in the
"RTN","BSTSAPIB",221,0)
 ; search API
"RTN","BSTSAPIB",222,0)
 ;
"RTN","BSTSAPIB",223,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIB D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIB",224,0)
 ;
"RTN","BSTSAPIB",225,0)
 K @OUT
"RTN","BSTSAPIB",226,0)
 ;
"RTN","BSTSAPIB",227,0)
 N RESULT,SEARCH,NMID,SNAPDT,MAX,LOCAL,DEBUG,BSTSWS,BSTSR,BSTSD,X,%,%H,DIFILE,%D
"RTN","BSTSAPIB",228,0)
 ;
"RTN","BSTSAPIB",229,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIB",230,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIB",231,0)
 S SEARCH=$P(IN,U) I 'SEARCH Q "0^Invalid DTS Id"
"RTN","BSTSAPIB",232,0)
 S NMID=$P(IN,U,2) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIB",233,0)
 S SNAPDT=$P(IN,U,3) S:SNAPDT]"" SNAPDT=$$DATE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIB",234,0)
 S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)_".0001"
"RTN","BSTSAPIB",235,0)
 S SNAPDT=$$FMTE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIB",236,0)
 S MAX=100
"RTN","BSTSAPIB",237,0)
 S LOCAL=$P(IN,U,4),LOCAL=$S(LOCAL=1:"1",1:"")
"RTN","BSTSAPIB",238,0)
 S DEBUG=$P(IN,U,5),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIB",239,0)
 ;
"RTN","BSTSAPIB",240,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIB",241,0)
 S BSTSWS("STYPE")="F"
"RTN","BSTSAPIB",242,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIB",243,0)
 S BSTSWS("SUBSET")=""
"RTN","BSTSAPIB",244,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIB",245,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIB",246,0)
 S BSTSWS("BCTCHRC")=""
"RTN","BSTSAPIB",247,0)
 S BSTSWS("BCTCHCT")=""
"RTN","BSTSAPIB",248,0)
 S BSTSWS("RET")="PSCBIXAV"
"RTN","BSTSAPIB",249,0)
 S BSTSWS("DAT")=""
"RTN","BSTSAPIB",250,0)
 ;
"RTN","BSTSAPIB",251,0)
 ;Make DTS Lookup call
"RTN","BSTSAPIB",252,0)
 S BSTSR=1
"RTN","BSTSAPIB",253,0)
 ;
"RTN","BSTSAPIB",254,0)
 I LOCAL'=1 S BSTSR=$$DTSSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",255,0)
 ;
"RTN","BSTSAPIB",256,0)
 ;If no results, try performing local search
"RTN","BSTSAPIB",257,0)
 I $D(RESULT)<10 S BSTSD=$$DTS^BSTSLKP("RESULT",.BSTSWS)
"RTN","BSTSAPIB",258,0)
 ;
"RTN","BSTSAPIB",259,0)
 ;If no results and local, make DTS call
"RTN","BSTSAPIB",260,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$DTSSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",261,0)
 ;
"RTN","BSTSAPIB",262,0)
 ;Get the detail for the record
"RTN","BSTSAPIB",263,0)
 S BSTSD=0
"RTN","BSTSAPIB",264,0)
 I $D(RESULT)>1 D
"RTN","BSTSAPIB",265,0)
 . S BSTSWS("STYPE")="F"
"RTN","BSTSAPIB",266,0)
 . S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIB",267,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIB",268,0)
 Q BSTSR
"RTN","BSTSAPIB",269,0)
 ;
"RTN","BSTSAPIB",270,0)
CNCLKP(OUT,IN) ;EP - Returns detail information for a specified Concept Id
"RTN","BSTSAPIB",271,0)
 ;
"RTN","BSTSAPIB",272,0)
 ;Input
"RTN","BSTSAPIB",273,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIB",274,0)
 ;  IN - P1 - The Concept Id to look up
"RTN","BSTSAPIB",275,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIB",276,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2)
"RTN","BSTSAPIB",277,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIB",278,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIB",279,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIB",280,0)
 ;
"RTN","BSTSAPIB",281,0)
 ;Output
"RTN","BSTSAPIB",282,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIB",283,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIB",284,0)
 ;       1:Local information returned
"RTN","BSTSAPIB",285,0)
 ;       0:No Information Returned
"RTN","BSTSAPIB",286,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIB",287,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIB",288,0)
 ;
"RTN","BSTSAPIB",289,0)
 ; VAR(#) record is returned for a match
"RTN","BSTSAPIB",290,0)
 ; Information returned is in the same (full detail) format
"RTN","BSTSAPIB",291,0)
 ; as the detail returned for each record in the
"RTN","BSTSAPIB",292,0)
 ; search API
"RTN","BSTSAPIB",293,0)
 ;
"RTN","BSTSAPIB",294,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIB D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIB",295,0)
 ;
"RTN","BSTSAPIB",296,0)
 K @OUT
"RTN","BSTSAPIB",297,0)
 ;
"RTN","BSTSAPIB",298,0)
 N RESULT,SEARCH,NMID,SNAPDT,MAX,LOCAL,DEBUG,BSTSWS,BSTSR,BSTSD,X,%,%H,DIFILE,%D
"RTN","BSTSAPIB",299,0)
 ;
"RTN","BSTSAPIB",300,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIB",301,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIB",302,0)
 S SEARCH=$P(IN,U) I SEARCH="" Q "0^Invalid Concept Id"
"RTN","BSTSAPIB",303,0)
 S NMID=$P(IN,U,2) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIB",304,0)
 S SNAPDT=$P(IN,U,3) S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)
"RTN","BSTSAPIB",305,0)
 S SNAPDT=SNAPDT_".2400"
"RTN","BSTSAPIB",306,0)
 S SNAPDT=$$FMDT2XML^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIB",307,0)
 S MAX=100
"RTN","BSTSAPIB",308,0)
 S LOCAL=$P(IN,U,4),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIB",309,0)
 S DEBUG=$P(IN,U,5),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIB",310,0)
 ;
"RTN","BSTSAPIB",311,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIB",312,0)
 S BSTSWS("STYPE")="F"
"RTN","BSTSAPIB",313,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIB",314,0)
 S BSTSWS("SUBSET")=""
"RTN","BSTSAPIB",315,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIB",316,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIB",317,0)
 S BSTSWS("BCTCHRC")=""
"RTN","BSTSAPIB",318,0)
 S BSTSWS("BCTCHCT")=""
"RTN","BSTSAPIB",319,0)
 S BSTSWS("RET")="PSCBIXAV"
"RTN","BSTSAPIB",320,0)
 S BSTSWS("DAT")=""
"RTN","BSTSAPIB",321,0)
 ;
"RTN","BSTSAPIB",322,0)
 ;Make DTS Lookup call
"RTN","BSTSAPIB",323,0)
 S BSTSR=1
"RTN","BSTSAPIB",324,0)
 I LOCAL'=1 S BSTSR=$$CNCSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",325,0)
 ;
"RTN","BSTSAPIB",326,0)
 ;If no results, try performing local search
"RTN","BSTSAPIB",327,0)
 I $D(RESULT)<10 S BSTSD=$$CNC^BSTSLKP("RESULT",.BSTSWS)
"RTN","BSTSAPIB",328,0)
 ;
"RTN","BSTSAPIB",329,0)
 ;If local search and no results try doing DTS lookup
"RTN","BSTSAPIB",330,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$CNCSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIB",331,0)
 ;
"RTN","BSTSAPIB",332,0)
 ;Get the detail for the record
"RTN","BSTSAPIB",333,0)
 S BSTSD=0
"RTN","BSTSAPIB",334,0)
 I $D(RESULT)>1 D
"RTN","BSTSAPIB",335,0)
 . S BSTSWS("STYPE")="F"
"RTN","BSTSAPIB",336,0)
 . S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIB",337,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIB",338,0)
 Q BSTSR
"RTN","BSTSAPIB",339,0)
 ;
"RTN","BSTSAPIB",340,0)
VALSBTRM(OUT,IN) ;EP - Returns whether a given term is in a particular subset
"RTN","BSTSAPIB",341,0)
 ;
"RTN","BSTSAPIB",342,0)
 ;Input
"RTN","BSTSAPIB",343,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIB",344,0)
 ;  IN - P1 - Description Id of term to check
"RTN","BSTSAPIB",345,0)
 ;     - P2 - The subset to look in
"RTN","BSTSAPIB",346,0)
 ;     - P3 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIB",347,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIB",348,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIB",349,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIB",350,0)
 ;
"RTN","BSTSAPIB",351,0)
 ;Output
"RTN","BSTSAPIB",352,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIB",353,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIB",354,0)
 ;       1:Local information returned
"RTN","BSTSAPIB",355,0)
 ;       0:No Information Returned
"RTN","BSTSAPIB",356,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIB",357,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIB",358,0)
 ;
"RTN","BSTSAPIB",359,0)
 ; Single VAR record is returned
"RTN","BSTSAPIB",360,0)
 ; VAR = 1:Term is in the provided subset, 0:Term is not in the provided subset
"RTN","BSTSAPIB",361,0)
 ;
"RTN","BSTSAPIB",362,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIB D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIB",363,0)
 ;
"RTN","BSTSAPIB",364,0)
 NEW NMID,DSC,SUB,LOCAL,DEBUG,DIN,SBVAR,BSTSR,SB,%D
"RTN","BSTSAPIB",365,0)
 ;
"RTN","BSTSAPIB",366,0)
 K @OUT
"RTN","BSTSAPIB",367,0)
 ;
"RTN","BSTSAPIB",368,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIB",369,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIB",370,0)
 S NMID=$P(IN,U,3) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIB",371,0)
 S DSC=$P(IN,U) I DSC="" S @OUT=0 Q "0^Missing Description Id"
"RTN","BSTSAPIB",372,0)
 S SUB=$P(IN,U,2) I SUB="" S @OUT=0 Q "0^Missing Subset"
"RTN","BSTSAPIB",373,0)
 S LOCAL=$P(IN,U,4)
"RTN","BSTSAPIB",374,0)
 S DEBUG=$P(IN,U,5)
"RTN","BSTSAPIB",375,0)
 S DIN=DSC_U_NMID_U_LOCAL_U_DEBUG
"RTN","BSTSAPIB",376,0)
 ;
"RTN","BSTSAPIB",377,0)
 ;Retrieve the detail for the term
"RTN","BSTSAPIB",378,0)
 S BSTSR=$$DSCLKP^BSTSAPI("SBVAR",DIN)
"RTN","BSTSAPIB",379,0)
 ;
"RTN","BSTSAPIB",380,0)
 S @OUT=0
"RTN","BSTSAPIB",381,0)
 ;
"RTN","BSTSAPIB",382,0)
 ;Loop through subsets for a match
"RTN","BSTSAPIB",383,0)
 S SB="" F  S SB=$O(SBVAR(1,"SUB",SB)) Q:SB=""  I $G(SBVAR(1,"SUB",SB,"SUB"))=SUB S @OUT=1 Q
"RTN","BSTSAPIB",384,0)
 ;
"RTN","BSTSAPIB",385,0)
 Q BSTSR
"RTN","BSTSAPIB",386,0)
 ;
"RTN","BSTSAPIB",387,0)
ERR ;
"RTN","BSTSAPIB",388,0)
 D ^%ZTER
"RTN","BSTSAPIB",389,0)
 Q
"RTN","BSTSAPIC")
0^17^B89594169
"RTN","BSTSAPIC",1,0)
BSTSAPIC ;GDIT/HS/BEE-Standard Terminology API Program ;26-Jun-2015 18:12;DKM
"RTN","BSTSAPIC",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSAPIC",3,0)
 ;
"RTN","BSTSAPIC",4,0)
 Q
"RTN","BSTSAPIC",5,0)
 ;
"RTN","BSTSAPIC",6,0)
MPADVICE(OUT,IN) ;EP - Returns ICD-10 mapping information for a specified Concept Id
"RTN","BSTSAPIC",7,0)
 ;
"RTN","BSTSAPIC",8,0)
 ;Input
"RTN","BSTSAPIC",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIC",10,0)
 ;  IN - P1 - The Concept Id to look up
"RTN","BSTSAPIC",11,0)
 ;     - P2 (Optional) - LOCAL - Pass 1 to perform local listing,
"RTN","BSTSAPIC",12,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIC",13,0)
 ;     - P3 (Optional) - Exclude add/retired date information
"RTN","BSTSAPIC",14,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIC",15,0)
 ;
"RTN","BSTSAPIC",16,0)
 ;Output
"RTN","BSTSAPIC",17,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIC",18,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIC",19,0)
 ;       1:Local information returned
"RTN","BSTSAPIC",20,0)
 ;       0:No Information Returned
"RTN","BSTSAPIC",21,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIC",22,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIC",23,0)
 ;
"RTN","BSTSAPIC",24,0)
 ; VAR(#) record is returned for a match
"RTN","BSTSAPIC",25,0)
 ; Information returned is in the same (full detail) format
"RTN","BSTSAPIC",26,0)
 ; as the detail returned for each record in the
"RTN","BSTSAPIC",27,0)
 ; search API
"RTN","BSTSAPIC",28,0)
 ;
"RTN","BSTSAPIC",29,0)
 ; The VAR(#) list of records returns the mapping information on file for
"RTN","BSTSAPIC",30,0)
 ; the specified concept. Multiple records per concept could be returned.
"RTN","BSTSAPIC",31,0)
 ;
"RTN","BSTSAPIC",32,0)
 ;Format:
"RTN","BSTSAPIC",33,0)
 ; VAR(#,"MPADV","VAL")=Mapping Advice
"RTN","BSTSAPIC",34,0)
 ; VAR(#,"MPADV","XADT")=Mapping Advice add date
"RTN","BSTSAPIC",35,0)
 ; VAR(#,"MPADV","XRDT")=Mapping Advice retire date
"RTN","BSTSAPIC",36,0)
 ; VAR(#,"MPCVL","VAL")=Mapping Category Value
"RTN","BSTSAPIC",37,0)
 ; VAR(#,"MPCVL","XADT")="Mapping Category Value add date
"RTN","BSTSAPIC",38,0)
 ; VAR(#,"MPCVL","XRDT")="Mapping Category Value retire date
"RTN","BSTSAPIC",39,0)
 ; VAR(#,"MPGRP","VAL")=Map Group
"RTN","BSTSAPIC",40,0)
 ; VAR(#,"MPGRP","XADT")=Map Group add date
"RTN","BSTSAPIC",41,0)
 ; VAR(#,"MPGRP","XRDT")=Map Group retire date
"RTN","BSTSAPIC",42,0)
 ; VAR(#,"MPPRI","VAL")=Map Priority
"RTN","BSTSAPIC",43,0)
 ; VAR(#,"MPPRI","XADT")=Map Priority add date
"RTN","BSTSAPIC",44,0)
 ; VAR(#,"MPPRI","XRDT")=Map Priority retire date
"RTN","BSTSAPIC",45,0)
 ; VAR(#,"MPRUL","VAL")=Map Rule
"RTN","BSTSAPIC",46,0)
 ; VAR(#,"MPRUL","XADT")=Map Rule add date
"RTN","BSTSAPIC",47,0)
 ; VAR(#,"MPRUL","XRDT")=Map Rule retire date
"RTN","BSTSAPIC",48,0)
 ; VAR(#,"MPTGN","VAL")=Map Target Name
"RTN","BSTSAPIC",49,0)
 ; VAR(#,"MPTGN","XADT")=Map Target Name add date
"RTN","BSTSAPIC",50,0)
 ; VAR(#,"MPTGN","XRDT")=Map Target Name retire date
"RTN","BSTSAPIC",51,0)
 ; VAR(#,"MPTGT","VAL")=Map Target
"RTN","BSTSAPIC",52,0)
 ; VAR(#,"MPTGT","XADT")=Map Target add date
"RTN","BSTSAPIC",53,0)
 ; VAR(#,"MPTGT","XRDT")=Map Target retire date
"RTN","BSTSAPIC",54,0)
 ;
"RTN","BSTSAPIC",55,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIC",56,0)
 ;
"RTN","BSTSAPIC",57,0)
 K @OUT
"RTN","BSTSAPIC",58,0)
 ;
"RTN","BSTSAPIC",59,0)
 N RESULT,SEARCH,NMID,SNAPDT,MAX,LOCAL,DEBUG,BSTSWS,BSTSR,BSTSD,X,%,%H,DAT,%D
"RTN","BSTSAPIC",60,0)
 ;
"RTN","BSTSAPIC",61,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIC",62,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIC",63,0)
 S SEARCH=$P(IN,U) I 'SEARCH Q "0^Invalid Concept Id"
"RTN","BSTSAPIC",64,0)
 S NMID=36
"RTN","BSTSAPIC",65,0)
 S SNAPDT=""
"RTN","BSTSAPIC",66,0)
 S MAX=100
"RTN","BSTSAPIC",67,0)
 S LOCAL=$P(IN,U,2),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIC",68,0)
 S DAT=$P(IN,U,3)
"RTN","BSTSAPIC",69,0)
 S DEBUG=$P(IN,U,4),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIC",70,0)
 ;
"RTN","BSTSAPIC",71,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIC",72,0)
 S BSTSWS("STYPE")="F"
"RTN","BSTSAPIC",73,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIC",74,0)
 S BSTSWS("SUBSET")=""
"RTN","BSTSAPIC",75,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIC",76,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIC",77,0)
 S BSTSWS("DAT")=DAT
"RTN","BSTSAPIC",78,0)
 ;
"RTN","BSTSAPIC",79,0)
 ;Make DTS Lookup call
"RTN","BSTSAPIC",80,0)
 S BSTSR=1
"RTN","BSTSAPIC",81,0)
 I LOCAL'=1 S BSTSR=$$CNCSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIC",82,0)
 ;
"RTN","BSTSAPIC",83,0)
 ;If no results, try performing local search
"RTN","BSTSAPIC",84,0)
 I $D(RESULT)<10 S BSTSD=$$CNC^BSTSLKP("RESULT",.BSTSWS)
"RTN","BSTSAPIC",85,0)
 ;
"RTN","BSTSAPIC",86,0)
 ;If no results and local, try a DTS search
"RTN","BSTSAPIC",87,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$CNCSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIC",88,0)
 ;
"RTN","BSTSAPIC",89,0)
 ;Get the detail for the record
"RTN","BSTSAPIC",90,0)
 S BSTSD=""
"RTN","BSTSAPIC",91,0)
 I $D(RESULT)>1 D
"RTN","BSTSAPIC",92,0)
 . S BSTSD=$$ICDMAP(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIC",93,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIC",94,0)
 Q BSTSR
"RTN","BSTSAPIC",95,0)
 ;
"RTN","BSTSAPIC",96,0)
ICDMAP(OUT,BSTSWS,RESULT) ;EP - Set up mapping output information
"RTN","BSTSAPIC",97,0)
 ;
"RTN","BSTSAPIC",98,0)
 ;Input
"RTN","BSTSAPIC",99,0)
 ; BSTSWS Array
"RTN","BSTSAPIC",100,0)
 ; RESULT - [1]^[2]^[3]
"RTN","BSTSAPIC",101,0)
 ;          [1] - Concept ID
"RTN","BSTSAPIC",102,0)
 ;          [2] - DTS ID
"RTN","BSTSAPIC",103,0)
 ;          [3] - Description Id
"RTN","BSTSAPIC",104,0)
 ;
"RTN","BSTSAPIC",105,0)
 ;Output
"RTN","BSTSAPIC",106,0)
 ; Function returns - # Records Returned
"RTN","BSTSAPIC",107,0)
 ;
"RTN","BSTSAPIC",108,0)
 ; VAR(#) - List of Records - See above call for format
"RTN","BSTSAPIC",109,0)
 ;
"RTN","BSTSAPIC",110,0)
 N CNT,INMID,XNMID,MCNT,DFLD,%D
"RTN","BSTSAPIC",111,0)
 ;
"RTN","BSTSAPIC",112,0)
 ;Get the Namespace ID
"RTN","BSTSAPIC",113,0)
 S XNMID=$G(BSTSWS("NAMESPACEID"))
"RTN","BSTSAPIC",114,0)
 ;
"RTN","BSTSAPIC",115,0)
 ;Determine whether to return date fields
"RTN","BSTSAPIC",116,0)
 S DFLD=$G(BSTSWS("DAT")) S DFLD=1
"RTN","BSTSAPIC",117,0)
 ;
"RTN","BSTSAPIC",118,0)
 ;Pull return request
"RTN","BSTSAPIC",119,0)
 S INMID=$O(^BSTS(9002318.1,"B",XNMID,""))
"RTN","BSTSAPIC",120,0)
 ;
"RTN","BSTSAPIC",121,0)
 S MCNT=0,CNT="" F  S CNT=$O(RESULT(CNT)) Q:CNT=""  D
"RTN","BSTSAPIC",122,0)
 . ;
"RTN","BSTSAPIC",123,0)
 . N CONC,CIEN,MIEN
"RTN","BSTSAPIC",124,0)
 . ;
"RTN","BSTSAPIC",125,0)
 . ;Get Concept IEN
"RTN","BSTSAPIC",126,0)
 . S CONC=$P(RESULT(CNT),U)
"RTN","BSTSAPIC",127,0)
 . S CIEN=$O(^BSTS(9002318.4,"C",NMID,CONC,"")) Q:CIEN=""
"RTN","BSTSAPIC",128,0)
 . ;
"RTN","BSTSAPIC",129,0)
 . ;Pull Mapping Information
"RTN","BSTSAPIC",130,0)
 . S (MCNT,MIEN)=0 F  S MIEN=$O(^BSTS(9002318.4,CIEN,2,MIEN)) Q:'MIEN  D
"RTN","BSTSAPIC",131,0)
 .. ;
"RTN","BSTSAPIC",132,0)
 .. NEW MG,MGRIN,MGROUT,DA,IENS,MP,MPRIN,MPROUT
"RTN","BSTSAPIC",133,0)
 .. NEW MT,MTRIN,MTROUT
"RTN","BSTSAPIC",134,0)
 .. ;
"RTN","BSTSAPIC",135,0)
 .. S DA(1)=CIEN,DA=MIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSAPIC",136,0)
 .. ;
"RTN","BSTSAPIC",137,0)
 .. ;Pull Map Group
"RTN","BSTSAPIC",138,0)
 .. S MG=$$GET1^DIQ(9002318.42,IENS,.02,"I")
"RTN","BSTSAPIC",139,0)
 .. S MGRIN=$$GET1^DIQ(9002318.42,IENS,.03,"I")
"RTN","BSTSAPIC",140,0)
 .. S MGROUT=$$GET1^DIQ(9002318.42,IENS,.04,"I")
"RTN","BSTSAPIC",141,0)
 .. S MCNT=MCNT+1
"RTN","BSTSAPIC",142,0)
 .. S @OUT@(MCNT,"MPGRP","VAL")=MG
"RTN","BSTSAPIC",143,0)
 .. I 'DFLD S @OUT@(MCNT,"MPGRP","XADT")=MGRIN
"RTN","BSTSAPIC",144,0)
 .. I 'DFLD S @OUT@(MCNT,"MPGRP","XRDT")=MGROUT
"RTN","BSTSAPIC",145,0)
 .. ;
"RTN","BSTSAPIC",146,0)
 .. ;Pull Map Priority
"RTN","BSTSAPIC",147,0)
 .. S MP=$$GET1^DIQ(9002318.42,IENS,.05,"I")
"RTN","BSTSAPIC",148,0)
 .. S MPRIN=$$GET1^DIQ(9002318.42,IENS,.06,"I")
"RTN","BSTSAPIC",149,0)
 .. S MPROUT=$$GET1^DIQ(9002318.42,IENS,.07,"I")
"RTN","BSTSAPIC",150,0)
 .. S @OUT@(MCNT,"MPPRI","VAL")=MP
"RTN","BSTSAPIC",151,0)
 .. I 'DFLD S @OUT@(MCNT,"MPPRI","XADT")=MGRIN
"RTN","BSTSAPIC",152,0)
 .. I 'DFLD S @OUT@(MCNT,"MPPRI","XRDT")=MGROUT
"RTN","BSTSAPIC",153,0)
 .. ;
"RTN","BSTSAPIC",154,0)
 .. ;Pull Map Target
"RTN","BSTSAPIC",155,0)
 .. S MT=$$GET1^DIQ(9002318.42,IENS,.08,"I")
"RTN","BSTSAPIC",156,0)
 .. S MTRIN=$$GET1^DIQ(9002318.42,IENS,.09,"I")
"RTN","BSTSAPIC",157,0)
 .. S MTROUT=$$GET1^DIQ(9002318.42,IENS,.1,"I")
"RTN","BSTSAPIC",158,0)
 .. S @OUT@(MCNT,"MPTGT","VAL")=MT
"RTN","BSTSAPIC",159,0)
 .. I 'DFLD S @OUT@(MCNT,"MPTGT","XADT")=MTRIN
"RTN","BSTSAPIC",160,0)
 .. I 'DFLD S @OUT@(MCNT,"MPTGT","XRDT")=MTROUT
"RTN","BSTSAPIC",161,0)
 .. ;
"RTN","BSTSAPIC",162,0)
 .. ;Pull Map Advice
"RTN","BSTSAPIC",163,0)
 .. D
"RTN","BSTSAPIC",164,0)
 ... NEW X,WP,II,MA,LINE,MARIN,MAROUT
"RTN","BSTSAPIC",165,0)
 ... S X=$$GET1^DIQ(9002318.42,IENS,1,"","WP")
"RTN","BSTSAPIC",166,0)
 ... S MA=""
"RTN","BSTSAPIC",167,0)
 ... S II="" F  S II=$O(WP(II)) Q:II=""  S LINE=WP(II) I LINE]"" D
"RTN","BSTSAPIC",168,0)
 .... S MA=MA_$S(MA]"":" ",1:"")_LINE
"RTN","BSTSAPIC",169,0)
 ... S MARIN=$$GET1^DIQ(9002318.42,IENS,5.01,"I")
"RTN","BSTSAPIC",170,0)
 ... S MAROUT=$$GET1^DIQ(9002318.42,IENS,5.02,"I")
"RTN","BSTSAPIC",171,0)
 ... S @OUT@(MCNT,"MPADV","VAL")=MA
"RTN","BSTSAPIC",172,0)
 ... I 'DFLD S @OUT@(MCNT,"MPADV","XADT")=MARIN
"RTN","BSTSAPIC",173,0)
 ... I 'DFLD S @OUT@(MCNT,"MPADV","XRDT")=MAROUT
"RTN","BSTSAPIC",174,0)
 .. ;
"RTN","BSTSAPIC",175,0)
 .. ;Pull Map Target Name
"RTN","BSTSAPIC",176,0)
 .. D
"RTN","BSTSAPIC",177,0)
 ... NEW X,WP,II,MT,LINE,MTRIN,MTROUT
"RTN","BSTSAPIC",178,0)
 ... S X=$$GET1^DIQ(9002318.42,IENS,2,"","WP")
"RTN","BSTSAPIC",179,0)
 ... S MT=""
"RTN","BSTSAPIC",180,0)
 ... S II="" F  S II=$O(WP(II)) Q:II=""  S LINE=WP(II) I LINE]"" D
"RTN","BSTSAPIC",181,0)
 .... S MT=MT_$S(MT]"":" ",1:"")_LINE
"RTN","BSTSAPIC",182,0)
 ... S MTRIN=$$GET1^DIQ(9002318.42,IENS,5.05,"I")
"RTN","BSTSAPIC",183,0)
 ... S MTROUT=$$GET1^DIQ(9002318.42,IENS,5.06,"I")
"RTN","BSTSAPIC",184,0)
 ... S @OUT@(MCNT,"MPTGN","VAL")=MT
"RTN","BSTSAPIC",185,0)
 ... I 'DFLD S @OUT@(MCNT,"MPTGN","XADT")=MTRIN
"RTN","BSTSAPIC",186,0)
 ... I 'DFLD S @OUT@(MCNT,"MPTFN","XRDT")=MTROUT
"RTN","BSTSAPIC",187,0)
 .. ;
"RTN","BSTSAPIC",188,0)
 .. ;Pull Map Rule
"RTN","BSTSAPIC",189,0)
 .. D
"RTN","BSTSAPIC",190,0)
 ... NEW X,WP,II,MR,LINE,MRRIN,MRROUT
"RTN","BSTSAPIC",191,0)
 ... S X=$$GET1^DIQ(9002318.42,IENS,3,"","WP")
"RTN","BSTSAPIC",192,0)
 ... S MR=""
"RTN","BSTSAPIC",193,0)
 ... S II="" F  S II=$O(WP(II)) Q:II=""  S LINE=WP(II) I LINE]"" D
"RTN","BSTSAPIC",194,0)
 .... S MR=MR_$S(MR]"":" ",1:"")_LINE
"RTN","BSTSAPIC",195,0)
 ... S MRRIN=$$GET1^DIQ(9002318.42,IENS,5.03,"I")
"RTN","BSTSAPIC",196,0)
 ... S MRROUT=$$GET1^DIQ(9002318.42,IENS,5.04,"I")
"RTN","BSTSAPIC",197,0)
 ... S @OUT@(MCNT,"MPRUL","VAL")=MR
"RTN","BSTSAPIC",198,0)
 ... I 'DFLD S @OUT@(MCNT,"MPRUL","XADT")=MRRIN
"RTN","BSTSAPIC",199,0)
 ... I 'DFLD S @OUT@(MCNT,"MPRUL","XRDT")=MRROUT
"RTN","BSTSAPIC",200,0)
 .. ;
"RTN","BSTSAPIC",201,0)
 .. ;Pull Map Category Value
"RTN","BSTSAPIC",202,0)
 .. D
"RTN","BSTSAPIC",203,0)
 ... NEW X,WP,II,MCV,LINE,MCVRIN,MCVROUT
"RTN","BSTSAPIC",204,0)
 ... S X=$$GET1^DIQ(9002318.42,IENS,4,"","WP")
"RTN","BSTSAPIC",205,0)
 ... S MCV=""
"RTN","BSTSAPIC",206,0)
 ... S II="" F  S II=$O(WP(II)) Q:II=""  S LINE=WP(II) I LINE]"" D
"RTN","BSTSAPIC",207,0)
 .... S MCV=MCV_$S(MCV]"":" ",1:"")_LINE
"RTN","BSTSAPIC",208,0)
 ... S MCVRIN=$$GET1^DIQ(9002318.42,IENS,5.07,"I")
"RTN","BSTSAPIC",209,0)
 ... S MCVROUT=$$GET1^DIQ(9002318.42,IENS,5.08,"I")
"RTN","BSTSAPIC",210,0)
 ... S @OUT@(MCNT,"MPCVL","VAL")=MCV
"RTN","BSTSAPIC",211,0)
 ... I 'DFLD S @OUT@(MCNT,"MPCVL","XADT")=MCVRIN
"RTN","BSTSAPIC",212,0)
 ... I 'DFLD S @OUT@(MCNT,"MPCVL","XRDT")=MCVROUT
"RTN","BSTSAPIC",213,0)
 ;
"RTN","BSTSAPIC",214,0)
 Q MCNT
"RTN","BSTSAPIC",215,0)
 ;
"RTN","BSTSAPIC",216,0)
SUBLST(OUT,IN) ;EP - Retrieve a subset listing
"RTN","BSTSAPIC",217,0)
 ;
"RTN","BSTSAPIC",218,0)
 ;Input
"RTN","BSTSAPIC",219,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIC",220,0)
 ;  IN - P1 - The subset to list
"RTN","BSTSAPIC",221,0)
 ;     - P2 - The namespace id (default to SNOMED US EXT '36')
"RTN","BSTSAPIC",222,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIC",223,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIC",224,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIC",225,0)
 ;
"RTN","BSTSAPIC",226,0)
 ;Output
"RTN","BSTSAPIC",227,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIC",228,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIC",229,0)
 ;       1:Local information returned
"RTN","BSTSAPIC",230,0)
 ;       0:No Information Returned
"RTN","BSTSAPIC",231,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIC",232,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIC",233,0)
 ;
"RTN","BSTSAPIC",234,0)
 ;
"RTN","BSTSAPIC",235,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIC",236,0)
 ;
"RTN","BSTSAPIC",237,0)
 N SUB,LOCAL,DEBUG,BSTSWS,BSTSR,DLIST,SBCNT,SBNCNT,SLIST,%D
"RTN","BSTSAPIC",238,0)
 ;
"RTN","BSTSAPIC",239,0)
 K @OUT
"RTN","BSTSAPIC",240,0)
 ;
"RTN","BSTSAPIC",241,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIC",242,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIC",243,0)
 S SUB=$P(IN,U)
"RTN","BSTSAPIC",244,0)
 S NMID=$P(IN,U,2) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIC",245,0)
 S LOCAL=$P(IN,U,3),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIC",246,0)
 S DEBUG=$P(IN,U,4),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIC",247,0)
 ;
"RTN","BSTSAPIC",248,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIC",249,0)
 S BSTSWS("SUBSET")=SUB
"RTN","BSTSAPIC",250,0)
 ;
"RTN","BSTSAPIC",251,0)
 ;Set up scratch global
"RTN","BSTSAPIC",252,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSAPIC",253,0)
 S SLIST=$NA(^TMP("BSTSSUB",$J))
"RTN","BSTSAPIC",254,0)
 K @DLIST,@SLIST,@OUT
"RTN","BSTSAPIC",255,0)
 ;
"RTN","BSTSAPIC",256,0)
 ;Make DTS search call
"RTN","BSTSAPIC",257,0)
 S BSTSR=1
"RTN","BSTSAPIC",258,0)
 ;
"RTN","BSTSAPIC",259,0)
 ;Perform DTS Search
"RTN","BSTSAPIC",260,0)
 I LOCAL'=1 S BSTSR=$$SUBLST^BSTSWSV(DLIST,.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIC",261,0)
 ;
"RTN","BSTSAPIC",262,0)
 ;Perform local search
"RTN","BSTSAPIC",263,0)
 I $D(@DLIST)<10 D
"RTN","BSTSAPIC",264,0)
 . ;
"RTN","BSTSAPIC",265,0)
 . NEW CIEN,CTR,NMIEN
"RTN","BSTSAPIC",266,0)
 . ;
"RTN","BSTSAPIC",267,0)
 . ;Make sure we have a codeset (namespace)
"RTN","BSTSAPIC",268,0)
 . S NMIEN=$O(^BSTS(9002318.1,"B",NMID,"")) Q:NMIEN=""
"RTN","BSTSAPIC",269,0)
 . ;
"RTN","BSTSAPIC",270,0)
 . S CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"E",NMIEN,SUB,CIEN)) Q:CIEN=""  D
"RTN","BSTSAPIC",271,0)
 .. NEW DTSID
"RTN","BSTSAPIC",272,0)
 .. S DTSID=$$GET1^DIQ(9002318.4,CIEN_",",.08,"I") Q:DTSID=""
"RTN","BSTSAPIC",273,0)
 .. S CTR=$G(CTR)+1,@DLIST@(CTR)=DTSID
"RTN","BSTSAPIC",274,0)
 ;
"RTN","BSTSAPIC",275,0)
 ;If no results and local, do a DTS lookup
"RTN","BSTSAPIC",276,0)
 I $D(@DLIST)<10,LOCAL=1 S BSTSR=$$SUBLST^BSTSWSV(DLIST,.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIC",277,0)
 ;
"RTN","BSTSAPIC",278,0)
 M @SLIST=@DLIST
"RTN","BSTSAPIC",279,0)
 ;
"RTN","BSTSAPIC",280,0)
 ;Loop through results and retrieve info
"RTN","BSTSAPIC",281,0)
 S SBCNT=0,SBNCNT=0 F  S SBCNT=$O(@SLIST@(SBCNT)) Q:'SBCNT  D
"RTN","BSTSAPIC",282,0)
 . NEW CONC,DESC,DTSID,CIEN,PRE,OOD,PRDATA,TERM
"RTN","BSTSAPIC",283,0)
 . S DTSID=$G(@SLIST@(SBCNT)) Q:DTSID=""
"RTN","BSTSAPIC",284,0)
 . ;
"RTN","BSTSAPIC",285,0)
 . ;Pull the concept IEN
"RTN","BSTSAPIC",286,0)
 . S CIEN=$O(^BSTS(9002318.4,"D",NMID,DTSID,"")),CONC="",PRE="",TERM=""
"RTN","BSTSAPIC",287,0)
 . ;
"RTN","BSTSAPIC",288,0)
 . ;Pull the Concept ID
"RTN","BSTSAPIC",289,0)
 . I CIEN]"" S CONC=$$GET1^DIQ(9002318.4,CIEN_",",".02","E")
"RTN","BSTSAPIC",290,0)
 . ;
"RTN","BSTSAPIC",291,0)
 . ;Pull the Preferred Term Description Id
"RTN","BSTSAPIC",292,0)
 . S PRDATA="" I CIEN]"" S PRDATA=$$PDESC^BSTSSRCH(CIEN)
"RTN","BSTSAPIC",293,0)
 . ;
"RTN","BSTSAPIC",294,0)
 . ;See if the concept has already been updated
"RTN","BSTSAPIC",295,0)
 . S OOD=0 I CIEN]"" D
"RTN","BSTSAPIC",296,0)
 .. NEW LMOD
"RTN","BSTSAPIC",297,0)
 .. S LMOD=$$GET1^DIQ(9002318.4,CIEN_",",".12","I")
"RTN","BSTSAPIC",298,0)
 .. I LMOD="" S OOD=1
"RTN","BSTSAPIC",299,0)
 . ;
"RTN","BSTSAPIC",300,0)
 . ;If not found or out of date, retrieve detail from server
"RTN","BSTSAPIC",301,0)
 . S PRE=$P(PRDATA,U),TERM=$P(PRDATA,U,2)
"RTN","BSTSAPIC",302,0)
 . I CIEN=""!(CONC="")!(PRE="")!(OOD) D
"RTN","BSTSAPIC",303,0)
 .. N STS,SBVAR
"RTN","BSTSAPIC",304,0)
 .. I 'LOCAL S STS=$$DTSLKP^BSTSAPI("SBVAR",DTSID_"^"_NMID)
"RTN","BSTSAPIC",305,0)
 . ;
"RTN","BSTSAPIC",306,0)
 . ;Look again
"RTN","BSTSAPIC",307,0)
 . I CIEN="" S CIEN=$O(^BSTS(9002318.4,"D",NMID,DTSID,"")) Q:CIEN=""
"RTN","BSTSAPIC",308,0)
 . ;
"RTN","BSTSAPIC",309,0)
 . ;Pull concept id and preferred term description id
"RTN","BSTSAPIC",310,0)
 . S CONC=$$GET1^DIQ(9002318.4,CIEN_",",".02","E") Q:CONC=""
"RTN","BSTSAPIC",311,0)
 . S PRDATA=$$PDESC^BSTSSRCH(CIEN)
"RTN","BSTSAPIC",312,0)
 . S PRE=$P(PRDATA,U) Q:PRE=""
"RTN","BSTSAPIC",313,0)
 . S TERM=$P(PRDATA,U,2) Q:TERM=""
"RTN","BSTSAPIC",314,0)
 . S SBNCNT=SBNCNT+1,@OUT@(SBNCNT)=CONC_U_PRE_U_TERM
"RTN","BSTSAPIC",315,0)
 ;
"RTN","BSTSAPIC",316,0)
 S $P(BSTSR,U)=$S(SBNCNT=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIC",317,0)
 Q BSTSR
"RTN","BSTSAPIC",318,0)
 ;
"RTN","BSTSAPIC",319,0)
ERR ;
"RTN","BSTSAPIC",320,0)
 D ^%ZTER
"RTN","BSTSAPIC",321,0)
 Q
"RTN","BSTSAPID")
0^19^B42675010
"RTN","BSTSAPID",1,0)
BSTSAPID ;GDIT/HS/BEE-Standard Terminology API Program ;26-Jun-2015 18:12;DKM
"RTN","BSTSAPID",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSAPID",3,0)
 ;
"RTN","BSTSAPID",4,0)
 Q
"RTN","BSTSAPID",5,0)
 ;
"RTN","BSTSAPID",6,0)
ICD2SMD(OUT,IN) ;EP - Return ICD9 to SNOMED mappings
"RTN","BSTSAPID",7,0)
 ;
"RTN","BSTSAPID",8,0)
 ;Input
"RTN","BSTSAPID",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPID",10,0)
 ;  IN - P1 - ICD9 Code
"RTN","BSTSAPID",11,0)
 ;     - P2 (Optional) - Return Info (P-Preferred,S-Synonym,B-Subset,I-IsA
"RTN","BSTSAPID",12,0)
 ;                       X-ICD9/ICD10,C-Children) (Default is all - "CI")
"RTN","BSTSAPID",13,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPID",14,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPID",15,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPID",16,0)
 ;     - P5 (Optional) - Date to search on (FileMan format - Default to T+2)
"RTN","BSTSAPID",17,0)
 ;
"RTN","BSTSAPID",18,0)
 ;Output
"RTN","BSTSAPID",19,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPID",20,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPID",21,0)
 ;       1:Local information returned
"RTN","BSTSAPID",22,0)
 ;       0:No Information Returned
"RTN","BSTSAPID",23,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPID",24,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPID",25,0)
 ;
"RTN","BSTSAPID",26,0)
 ; VAR(#) - List of Records
"RTN","BSTSAPID",27,0)
 ;
"RTN","BSTSAPID",28,0)
 ; The VAR(#) list of records returns the following sections
"RTN","BSTSAPID",29,0)
 ; (based on the input piece 6 and 7 values):
"RTN","BSTSAPID",30,0)
 ;
"RTN","BSTSAPID",31,0)
 ;Concept ID/DTSID
"RTN","BSTSAPID",32,0)
 ; VAR(#,"CON")=Concept Id
"RTN","BSTSAPID",33,0)
 ; VAR(#,"DTS")=Internal DTS Id
"RTN","BSTSAPID",34,0)
 ;
"RTN","BSTSAPID",35,0)
 ;Fully Specified Name
"RTN","BSTSAPID",36,0)
 ; VAR(#,"FSN","DSC")=Description Id of the FSN
"RTN","BSTSAPID",37,0)
 ; VAR(#,"FSN","TRM")=Fully Specified Name
"RTN","BSTSAPID",38,0)
 ; VAR(#,"FSN","XADT")=Date Added
"RTN","BSTSAPID",39,0)
 ; VAR(#,"FSN","XRDT")=Date Retired
"RTN","BSTSAPID",40,0)
 ;
"RTN","BSTSAPID",41,0)
 ;ICD9 Information - Multiple Records Returned (CTR)
"RTN","BSTSAPID",42,0)
 ; VAR(#,"ICD",CTR,"COD")=ICD9 Code
"RTN","BSTSAPID",43,0)
 ; VAR(#,"ICD",CTR,"TYP")=Code Type(ICD)
"RTN","BSTSAPID",44,0)
 ; VAR(#,"ICD",CTR,"XADT")=Date Added
"RTN","BSTSAPID",45,0)
 ; VAR(#,"ICD",CTR,"XRDT")=Date Retired
"RTN","BSTSAPID",46,0)
 ;
"RTN","BSTSAPID",47,0)
 ;IsA Information - Multiple Records Returned (CTR)
"RTN","BSTSAPID",48,0)
 ; VAR(#,"ISA",CTR,"CON")=Concept Id of IsA Term (may be blank prior to detail lookup)
"RTN","BSTSAPID",49,0)
 ; VAR(#,"ISA",CTR,"DTS")=DTSId of the IsA Term
"RTN","BSTSAPID",50,0)
 ; VAR(#,"ISA",CTR,"TRM")=IsA Term Name
"RTN","BSTSAPID",51,0)
 ; VAR(#,"ISA",CTR,"XADT")=Date Added
"RTN","BSTSAPID",52,0)
 ; VAR(#,"ISA",CTR,"XRDT")=Date Retired
"RTN","BSTSAPID",53,0)
 ;
"RTN","BSTSAPID",54,0)
 ;Child Information - Multiple Records Returned (CTR)
"RTN","BSTSAPID",55,0)
 ; VAR(#,"CHD",CTR,"CON")=Concept Id of Child Term (may be blank prior to detail lookup)
"RTN","BSTSAPID",56,0)
 ; VAR(#,"CHD",CTR,"DTS")=DTSId of the Child Term
"RTN","BSTSAPID",57,0)
 ; VAR(#,"CHD",CTR,"TRM")=IsA Term Name
"RTN","BSTSAPID",58,0)
 ; VAR(#,"CHD",CTR,"XADT")=Date Added
"RTN","BSTSAPID",59,0)
 ; VAR(#,"CHD",CTR,"XRDT")=Date Retired
"RTN","BSTSAPID",60,0)
 ;
"RTN","BSTSAPID",61,0)
 ;Lookup Problem Column Value (Preferred Term Information for concept for Search Type
"RTN","BSTSAPID",62,0)
 ;[F] or Synonym or Preferred Term Information for Search Type [S])
"RTN","BSTSAPID",63,0)
 ;(Based on Search Type parameter - F/S)
"RTN","BSTSAPID",64,0)
 ; VAR(#,"PRB","DSC")=Description Id of a Pref Term (Type F) or Synonym/Pref Term (S)
"RTN","BSTSAPID",65,0)
 ; VAR(#,"PRB","TRM")=Preferred Name of a Concept (F) or a Synonym/Preferred Name (S)
"RTN","BSTSAPID",66,0)
 ;
"RTN","BSTSAPID",67,0)
 ;Preferred Term Information
"RTN","BSTSAPID",68,0)
 ; VAR(#,"PRE","DSC")=Description ID of Preferred Term
"RTN","BSTSAPID",69,0)
 ; VAR(#,"PRE","TRM")=Preferred Term
"RTN","BSTSAPID",70,0)
 ; VAR(#,"PRE","XADT")=Date Added
"RTN","BSTSAPID",71,0)
 ; VAR(#,"PRE","XRDT")=Date Retired
"RTN","BSTSAPID",72,0)
 ;
"RTN","BSTSAPID",73,0)
 ;Subset Information - Multiple Records Returned (CTR)
"RTN","BSTSAPID",74,0)
 ; VAR(#,"SUB",CTR,"SUB")=Subset Name
"RTN","BSTSAPID",75,0)
 ; VAR(#,"SUB",CTR,"XADT")=Date Added
"RTN","BSTSAPID",76,0)
 ; VAR(#,"SUB",CTR,"XRDT")=Date Retired
"RTN","BSTSAPID",77,0)
 ;
"RTN","BSTSAPID",78,0)
 ;Synonym Information - Multiple Records Returned (CTR)
"RTN","BSTSAPID",79,0)
 ; VAR(#,"SYN",CTR,"DSC")=Description ID of Synonym
"RTN","BSTSAPID",80,0)
 ; VAR(#,"SYN",CTR,"TRM")=Synonym Term
"RTN","BSTSAPID",81,0)
 ; VAR(#,"SYN",CTR,"XADT")=Date Added
"RTN","BSTSAPID",82,0)
 ; VAR(#,"SYN",CTR,"XRDT")=Date Retired
"RTN","BSTSAPID",83,0)
 ;
"RTN","BSTSAPID",84,0)
 ;Date Concept Added/Retired
"RTN","BSTSAPID",85,0)
 ; VAR(#,"XADT")=Date Added
"RTN","BSTSAPID",86,0)
 ; VAR(#,"XRDT")=Date Retired
"RTN","BSTSAPID",87,0)
 ;
"RTN","BSTSAPID",88,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPID",89,0)
 ;
"RTN","BSTSAPID",90,0)
 N SEARCH,STYPE,NMID,SUB,SNAPDT,MAX,BCTCHRC,BCTCHCT,LOCAL,%D
"RTN","BSTSAPID",91,0)
 N RESULT,DEBUG,BSTSR,BSTSI,RET,DAT,BSTSWS,BSTSD,X,%,%H
"RTN","BSTSAPID",92,0)
 K @OUT
"RTN","BSTSAPID",93,0)
 ;
"RTN","BSTSAPID",94,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPID",95,0)
 S IN=$G(IN,"")
"RTN","BSTSAPID",96,0)
 S SEARCH=$P(IN,U) Q:($TR(SEARCH," ")="") "0^Invalid Search String"
"RTN","BSTSAPID",97,0)
 S NMID=36
"RTN","BSTSAPID",98,0)
 S SNAPDT=$P(IN,U,5) S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)
"RTN","BSTSAPID",99,0)
 S SNAPDT=SNAPDT_".2400"
"RTN","BSTSAPID",100,0)
 S SNAPDT=$$FMDT2XML^BSTSUTIL(SNAPDT)
"RTN","BSTSAPID",101,0)
 S MAX=100000
"RTN","BSTSAPID",102,0)
 S RET=$P(IN,U,2) S:RET="" RET="BCI"
"RTN","BSTSAPID",103,0)
 S DAT=1
"RTN","BSTSAPID",104,0)
 S BCTCHRC=""
"RTN","BSTSAPID",105,0)
 S BCTCHCT=""
"RTN","BSTSAPID",106,0)
 S LOCAL=$P(IN,U,3),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPID",107,0)
 S DEBUG=$P(IN,U,4),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPID",108,0)
 ;
"RTN","BSTSAPID",109,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPID",110,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPID",111,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPID",112,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPID",113,0)
 S BSTSWS("BCTCHRC")=BCTCHRC
"RTN","BSTSAPID",114,0)
 S BSTSWS("BCTCHCT")=BCTCHCT
"RTN","BSTSAPID",115,0)
 S BSTSWS("RET")=RET
"RTN","BSTSAPID",116,0)
 S BSTSWS("DAT")=DAT
"RTN","BSTSAPID",117,0)
 ;
"RTN","BSTSAPID",118,0)
 S BSTSI=0
"RTN","BSTSAPID",119,0)
 ;
"RTN","BSTSAPID",120,0)
 ;Make DTS search call
"RTN","BSTSAPID",121,0)
 S BSTSR=1
"RTN","BSTSAPID",122,0)
 ;
"RTN","BSTSAPID",123,0)
 ;DTS Call
"RTN","BSTSAPID",124,0)
 I LOCAL'=1 S BSTSR=$$ICD2SMD^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPID",125,0)
 ;
"RTN","BSTSAPID",126,0)
 ;If no results, try performing local search
"RTN","BSTSAPID",127,0)
 I $D(RESULT)<10 S BSTSR=$$ICD2SMD^BSTSAPIF("RESULT",BSTSWS("SEARCH"))
"RTN","BSTSAPID",128,0)
 ;
"RTN","BSTSAPID",129,0)
 ;Loop through search results and retrieve detail
"RTN","BSTSAPID",130,0)
 S BSTSWS("STYPE")="F"
"RTN","BSTSAPID",131,0)
 S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPID",132,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPID",133,0)
 Q BSTSR
"RTN","BSTSAPID",134,0)
 ;
"RTN","BSTSAPID",135,0)
CVRSN(OUT,IN) ;EP - Return the Current Version For the Code Set
"RTN","BSTSAPID",136,0)
 ;
"RTN","BSTSAPID",137,0)
 ;Input
"RTN","BSTSAPID",138,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPID",139,0)
 ;  IN - P1 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPID",140,0)
 ;  IN - P2 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPID",141,0)
 ;                       blank for remote listing
"RTN","BSTSAPID",142,0)
 ;     - P3 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPID",143,0)
 ;
"RTN","BSTSAPID",144,0)
 ;Output
"RTN","BSTSAPID",145,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPID",146,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPID",147,0)
 ;       1:Local information returned
"RTN","BSTSAPID",148,0)
 ;       0:No Information Returned
"RTN","BSTSAPID",149,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPID",150,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPID",151,0)
 ;
"RTN","BSTSAPID",152,0)
 ; Single VAR record is returned
"RTN","BSTSAPID",153,0)
 ; @VAR = [1]^[2]^[3]^[4]
"RTN","BSTSAPID",154,0)
 ; [1] - Version Id
"RTN","BSTSAPID",155,0)
 ; [2] - Version Name
"RTN","BSTSAPID",156,0)
 ; [3] - Version Release Date
"RTN","BSTSAPID",157,0)
 ; [4] - Version Install Date (if available)
"RTN","BSTSAPID",158,0)
 ;
"RTN","BSTSAPID",159,0)
 N LOCAL,DEBUG,BSTSR,NMID,NMIEN,BSTSI,VRID,X,%,%H,%D
"RTN","BSTSAPID",160,0)
 K @OUT
"RTN","BSTSAPID",161,0)
 ;
"RTN","BSTSAPID",162,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPID D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPID",163,0)
 ;
"RTN","BSTSAPID",164,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPID",165,0)
 S IN=$G(IN,"")
"RTN","BSTSAPID",166,0)
 S NMID=$P(IN,U) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPID",167,0)
 S LOCAL=$P(IN,U,2),LOCAL=$S(LOCAL=1:"1",1:"")
"RTN","BSTSAPID",168,0)
 S DEBUG=$P(IN,U,3),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPID",169,0)
 ;
"RTN","BSTSAPID",170,0)
 S BSTSI=0
"RTN","BSTSAPID",171,0)
 ;
"RTN","BSTSAPID",172,0)
 ;Make update call
"RTN","BSTSAPID",173,0)
 S BSTSR=1
"RTN","BSTSAPID",174,0)
 I LOCAL'=1,NMID S BSTSR=$$GVRSET^BSTSWSV(NMID,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPID",175,0)
 ;
"RTN","BSTSAPID",176,0)
 ;Loop through files and retrieve result
"RTN","BSTSAPID",177,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,""))
"RTN","BSTSAPID",178,0)
 I NMIEN]"" S VRID=$O(^BSTS(9002318.1,NMIEN,1,"B",""),-1) I VRID]"" D
"RTN","BSTSAPID",179,0)
 . N VRIEN
"RTN","BSTSAPID",180,0)
 . S VRIEN=$O(^BSTS(9002318.1,NMIEN,1,"B",VRID,""),-1) I VRIEN]"" D
"RTN","BSTSAPID",181,0)
 .. NEW VRNAME,VRRLDT,VRINDT,DA,IENS
"RTN","BSTSAPID",182,0)
 .. S DA(1)=NMIEN,DA=VRIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSAPID",183,0)
 .. S VRNAME=$$GET1^DIQ(9002318.11,IENS,.02,"E") Q:VRNAME=""
"RTN","BSTSAPID",184,0)
 .. S VRRLDT=$$FMTE^XLFDT($$GET1^DIQ(9002318.11,IENS,.03,"I"),"5D")
"RTN","BSTSAPID",185,0)
 .. S VRINDT=$$FMTE^XLFDT($$GET1^DIQ(9002318.11,IENS,.04,"I"),"5D")
"RTN","BSTSAPID",186,0)
 .. S @OUT=VRID_U_VRNAME_U_VRRLDT_U_VRINDT
"RTN","BSTSAPID",187,0)
 S $P(BSTSR,U)=$S(@OUT="":0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPID",188,0)
 Q BSTSR
"RTN","BSTSAPID",189,0)
 ;
"RTN","BSTSAPID",190,0)
DTSLKP(OUT,IN) ;Returns detail information for a specified DTS Id
"RTN","BSTSAPID",191,0)
 ;
"RTN","BSTSAPID",192,0)
 ;This tag is only called by the ICD2SMD tag in the ICD2SMD tag in BSTSAPIB
"RTN","BSTSAPID",193,0)
 ;Only required data is returned
"RTN","BSTSAPID",194,0)
 ;
"RTN","BSTSAPID",195,0)
 ;Input
"RTN","BSTSAPID",196,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPID",197,0)
 ;  IN - P1 - The DTS Id to look up
"RTN","BSTSAPID",198,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPID",199,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2) - Not implemented this build
"RTN","BSTSAPID",200,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPID",201,0)
 ;                       blank for remote listing
"RTN","BSTSAPID",202,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPID",203,0)
 ;
"RTN","BSTSAPID",204,0)
 ;Output
"RTN","BSTSAPID",205,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPID",206,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPID",207,0)
 ;       1:Local information returned
"RTN","BSTSAPID",208,0)
 ;       0:No Information Returned
"RTN","BSTSAPID",209,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPID",210,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPID",211,0)
 ;
"RTN","BSTSAPID",212,0)
 ; VAR(#) record is returned for a match
"RTN","BSTSAPID",213,0)
 ; Information returned is in the same (full detail) format
"RTN","BSTSAPID",214,0)
 ; as the detail returned for each record in the
"RTN","BSTSAPID",215,0)
 ; search API
"RTN","BSTSAPID",216,0)
 ;
"RTN","BSTSAPID",217,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIB D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPID",218,0)
 ;
"RTN","BSTSAPID",219,0)
 K @OUT
"RTN","BSTSAPID",220,0)
 ;
"RTN","BSTSAPID",221,0)
 N RESULT,SEARCH,NMID,SNAPDT,MAX,LOCAL,DEBUG,BSTSWS,BSTSR,BSTSD,X,%,%H,DIFILE,%D
"RTN","BSTSAPID",222,0)
 ;
"RTN","BSTSAPID",223,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPID",224,0)
 S IN=$G(IN,"")
"RTN","BSTSAPID",225,0)
 S SEARCH=$P(IN,U) I 'SEARCH Q "0^Invalid DTS Id"
"RTN","BSTSAPID",226,0)
 S NMID=$P(IN,U,2) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPID",227,0)
 S SNAPDT=$P(IN,U,3) S:SNAPDT]"" SNAPDT=$$DATE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPID",228,0)
 S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)_".0001"
"RTN","BSTSAPID",229,0)
 S SNAPDT=$$FMTE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPID",230,0)
 S MAX=100
"RTN","BSTSAPID",231,0)
 S LOCAL=$P(IN,U,4),LOCAL=$S(LOCAL=1:"1",1:"")
"RTN","BSTSAPID",232,0)
 S DEBUG=$P(IN,U,5),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPID",233,0)
 ;
"RTN","BSTSAPID",234,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPID",235,0)
 S BSTSWS("STYPE")="F"
"RTN","BSTSAPID",236,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPID",237,0)
 S BSTSWS("SUBSET")=""
"RTN","BSTSAPID",238,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPID",239,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPID",240,0)
 S BSTSWS("BCTCHRC")=""
"RTN","BSTSAPID",241,0)
 S BSTSWS("BCTCHCT")=""
"RTN","BSTSAPID",242,0)
 S BSTSWS("RET")="PCBIX"
"RTN","BSTSAPID",243,0)
 S BSTSWS("DAT")=""
"RTN","BSTSAPID",244,0)
 ;
"RTN","BSTSAPID",245,0)
 ;Make DTS Lookup call
"RTN","BSTSAPID",246,0)
 S BSTSR=1
"RTN","BSTSAPID",247,0)
 ;
"RTN","BSTSAPID",248,0)
 I LOCAL'=1 S BSTSR=$$DTSSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPID",249,0)
 ;
"RTN","BSTSAPID",250,0)
 ;If no results, try performing local search
"RTN","BSTSAPID",251,0)
 I $D(RESULT)<10 S BSTSD=$$DTS^BSTSLKP("RESULT",.BSTSWS)
"RTN","BSTSAPID",252,0)
 ;
"RTN","BSTSAPID",253,0)
 ;If no results and local, make DTS call
"RTN","BSTSAPID",254,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$DTSSR^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPID",255,0)
 ;
"RTN","BSTSAPID",256,0)
 ;Get the detail for the record
"RTN","BSTSAPID",257,0)
 S BSTSD=0
"RTN","BSTSAPID",258,0)
 I $D(RESULT)>1 D
"RTN","BSTSAPID",259,0)
 . S BSTSWS("STYPE")="F"
"RTN","BSTSAPID",260,0)
 . S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPID",261,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPID",262,0)
 Q BSTSR
"RTN","BSTSAPID",263,0)
 ;
"RTN","BSTSAPID",264,0)
ERR ;
"RTN","BSTSAPID",265,0)
 D ^%ZTER
"RTN","BSTSAPID",266,0)
 Q
"RTN","BSTSAPIF")
0^18^B72075068
"RTN","BSTSAPIF",1,0)
BSTSAPIF ;GDIT/HS/BEE-Standard Terminology API Function Calls ;26-Jun-2015 18:12;DKM
"RTN","BSTSAPIF",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSAPIF",3,0)
 ;
"RTN","BSTSAPIF",4,0)
 Q
"RTN","BSTSAPIF",5,0)
 ;
"RTN","BSTSAPIF",6,0)
VSBTRMF(IN) ;PEP - Returns whether a given term is in a particular subset
"RTN","BSTSAPIF",7,0)
 ;
"RTN","BSTSAPIF",8,0)
 ;Input
"RTN","BSTSAPIF",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIF",10,0)
 ;  IN - P1 - Description Id of term to check
"RTN","BSTSAPIF",11,0)
 ;     - P2 - The subset to look in
"RTN","BSTSAPIF",12,0)
 ;     - P3 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIF",13,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIF",14,0)
 ;                       blank for remote listing
"RTN","BSTSAPIF",15,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",16,0)
 ;
"RTN","BSTSAPIF",17,0)
 ;Output
"RTN","BSTSAPIF",18,0)
 ;
"RTN","BSTSAPIF",19,0)
 ; VAR = 1:Term is in the provided subset
"RTN","BSTSAPIF",20,0)
 ;       0:Term is not in the provided subset
"RTN","BSTSAPIF",21,0)
 ;
"RTN","BSTSAPIF",22,0)
 NEW FOUT,STS,%D
"RTN","BSTSAPIF",23,0)
 ;
"RTN","BSTSAPIF",24,0)
 S STS=$$VALSBTRM^BSTSAPIB("FOUT",IN)
"RTN","BSTSAPIF",25,0)
 Q FOUT
"RTN","BSTSAPIF",26,0)
 ;
"RTN","BSTSAPIF",27,0)
DESC(IN) ;PEP - Returns detail information for a specified Description Id
"RTN","BSTSAPIF",28,0)
 ;
"RTN","BSTSAPIF",29,0)
 ;Input
"RTN","BSTSAPIF",30,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIF",31,0)
 ;  IN - P1 - The Description Id to look up
"RTN","BSTSAPIF",32,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIF",33,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2) - Not implemented this build
"RTN","BSTSAPIF",34,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIF",35,0)
 ;                       blank for remote listing
"RTN","BSTSAPIF",36,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",37,0)
 ;
"RTN","BSTSAPIF",38,0)
 ;Output
"RTN","BSTSAPIF",39,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIF",40,0)
 ; [1] - Concept Id
"RTN","BSTSAPIF",41,0)
 ; [2] - Term Description
"RTN","BSTSAPIF",42,0)
 ;
"RTN","BSTSAPIF",43,0)
 Q $$DESC^BSTSAPIA($G(IN))
"RTN","BSTSAPIF",44,0)
 ;
"RTN","BSTSAPIF",45,0)
CONC(IN) ;PEP - Returns detail information for a specified Concept Id
"RTN","BSTSAPIF",46,0)
 ;
"RTN","BSTSAPIF",47,0)
 ;Input
"RTN","BSTSAPIF",48,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIF",49,0)
 ;  IN - P1 - The Concept Id to look up
"RTN","BSTSAPIF",50,0)
 ;     - P2 (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSAPIF",51,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2) - Not implemented this build
"RTN","BSTSAPIF",52,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSAPIF",53,0)
 ;                       blank for remote listing
"RTN","BSTSAPIF",54,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",55,0)
 ;
"RTN","BSTSAPIF",56,0)
 ;Output
"RTN","BSTSAPIF",57,0)
 ; Function returns - [1]^[2]^[3]^[4]
"RTN","BSTSAPIF",58,0)
 ; [1] - Description Id of Fully Specified Name
"RTN","BSTSAPIF",59,0)
 ; [2] - Fully Specified Name
"RTN","BSTSAPIF",60,0)
 ; [3] - Description Id of Preferred Term
"RTN","BSTSAPIF",61,0)
 ; [4] - Preferred Term
"RTN","BSTSAPIF",62,0)
 ; [5] - Delimited list of mapped ICD9 codes (';' delimiter)
"RTN","BSTSAPIF",63,0)
 ;
"RTN","BSTSAPIF",64,0)
 Q $$CONC^BSTSAPIA($G(IN))
"RTN","BSTSAPIF",65,0)
 ;
"RTN","BSTSAPIF",66,0)
ICD2SMD(OUT,IN) ;EP - Returns a list of SMOMED codes for the specified ICD9 code
"RTN","BSTSAPIF",67,0)
 ;
"RTN","BSTSAPIF",68,0)
 ;Input
"RTN","BSTSAPIF",69,0)
 ; OUT - OUTPUT array of SNOMED concepts to return
"RTN","BSTSAPIF",70,0)
 ;  IN - The ICD9 Code to search on
"RTN","BSTSAPIF",71,0)
 ;
"RTN","BSTSAPIF",72,0)
 I $G(IN)="" Q
"RTN","BSTSAPIF",73,0)
 ;
"RTN","BSTSAPIF",74,0)
 NEW NMID,CIEN,RCNT,%D
"RTN","BSTSAPIF",75,0)
 ;
"RTN","BSTSAPIF",76,0)
 ;Get IEN for SNOMED
"RTN","BSTSAPIF",77,0)
 S NMID=$O(^BSTS(9002318.1,"B",36,"")) Q:NMID=""
"RTN","BSTSAPIF",78,0)
 ;
"RTN","BSTSAPIF",79,0)
 ;Loop through entries and find matches
"RTN","BSTSAPIF",80,0)
 S RCNT=0,CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"I",NMID,IN,CIEN)) Q:CIEN=""  D
"RTN","BSTSAPIF",81,0)
 . ;
"RTN","BSTSAPIF",82,0)
 . NEW DTSID,CONC
"RTN","BSTSAPIF",83,0)
 . ;
"RTN","BSTSAPIF",84,0)
 . S DTSID=$$GET1^DIQ(9002318.4,CIEN_",",.08,"I") Q:DTSID=""
"RTN","BSTSAPIF",85,0)
 . ;
"RTN","BSTSAPIF",86,0)
 . S CONC=$$GET1^DIQ(9002318.4,CIEN_",",.02,"I") Q:CONC=""
"RTN","BSTSAPIF",87,0)
 . ;
"RTN","BSTSAPIF",88,0)
 . ;Set up return entry
"RTN","BSTSAPIF",89,0)
 . S RCNT=RCNT+1 S @OUT@(RCNT)=CONC_U_DTSID
"RTN","BSTSAPIF",90,0)
 Q 1
"RTN","BSTSAPIF",91,0)
 ;
"RTN","BSTSAPIF",92,0)
DILKP(OUT,IN) ;EP - Performs a drug ingredient lookup on a specified value
"RTN","BSTSAPIF",93,0)
 ;
"RTN","BSTSAPIF",94,0)
 ;Input
"RTN","BSTSAPIF",95,0)
 ;  IN - P1 - The exact term to lookup
"RTN","BSTSAPIF",96,0)
 ;     - P2 - Lookup Type (N-NDC,V-VUID)
"RTN","BSTSAPIF",97,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing
"RTN","BSTSAPIF",98,0)
 ;                       Pass 2 for a remote DTS listing
"RTN","BSTSAPIF",99,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",100,0)
 ;
"RTN","BSTSAPIF",101,0)
 ;Output
"RTN","BSTSAPIF",102,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIF",103,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIF",104,0)
 ;       1:Local information returned
"RTN","BSTSAPIF",105,0)
 ;       0:No Information Returned
"RTN","BSTSAPIF",106,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIF",107,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIF",108,0)
 ;
"RTN","BSTSAPIF",109,0)
 ; VAR(#) record is returned for any exact match
"RTN","BSTSAPIF",110,0)
 ;
"RTN","BSTSAPIF",111,0)
 ; VAR(1,"RXN","CON")=RxNorm Code
"RTN","BSTSAPIF",112,0)
 ; VAR(1,"RXN","TRM")=RxNorm Term
"RTN","BSTSAPIF",113,0)
 ; VAR(1,"RXN","TDC")=RxNorm Tradename code
"RTN","BSTSAPIF",114,0)
 ; VAR(1,"RXN","TDT")=RxNorm Tradename term
"RTN","BSTSAPIF",115,0)
 ; VAR(1,"RXN","TTY")=First TTY value for the RxNorm
"RTN","BSTSAPIF",116,0)
 ;
"RTN","BSTSAPIF",117,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIF D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIF",118,0)
 ;
"RTN","BSTSAPIF",119,0)
 N SEARCH,NMID,SNAPDT,MAX,LOCAL,NMIEN,RLIST,I,LTYPE,RXSTR,UNSTR,%D
"RTN","BSTSAPIF",120,0)
 N RESULT,DEBUG,BSTSR,BSTSI,BSTSWS,RES,BSTSD,X,%,%H,UPSRCH,CONC,CONCDT
"RTN","BSTSAPIF",121,0)
 K @OUT
"RTN","BSTSAPIF",122,0)
 ;
"RTN","BSTSAPIF",123,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIF",124,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIF",125,0)
 S SEARCH=$P(IN,U) I $TR(SEARCH," ")="" Q "0^Invalid Search String"
"RTN","BSTSAPIF",126,0)
 S LTYPE=$P(IN,U,2) I LTYPE'="N",LTYPE'="V" Q "0^Invalid Lookup Type"
"RTN","BSTSAPIF",127,0)
 S SNAPDT=DT_".2400"
"RTN","BSTSAPIF",128,0)
 S SNAPDT=$$FMDT2XML^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIF",129,0)
 S LOCAL=$P(IN,U,3),LOCAL=$S(LOCAL=2:"",1:"1")
"RTN","BSTSAPIF",130,0)
 S DEBUG=$P(IN,U,4),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIF",131,0)
 ;
"RTN","BSTSAPIF",132,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIF",133,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIF",134,0)
 S BSTSWS("MAXRECS")=100
"RTN","BSTSAPIF",135,0)
 ;
"RTN","BSTSAPIF",136,0)
 S BSTSWS("NAMESPACEID")=1552
"RTN","BSTSAPIF",137,0)
 I LTYPE="N" S BSTSWS("PROPERTY")=110,BSTSWS("LTYPE")="N"
"RTN","BSTSAPIF",138,0)
 E  S BSTSWS("PROPERTY")=209,BSTSWS("LTYPE")="V"
"RTN","BSTSAPIF",139,0)
 S NMID=1552
"RTN","BSTSAPIF",140,0)
 ;
"RTN","BSTSAPIF",141,0)
 ;Perform RxNorm DTS Lookup
"RTN","BSTSAPIF",142,0)
 ;
"RTN","BSTSAPIF",143,0)
 ;Make DTS Lookup call
"RTN","BSTSAPIF",144,0)
 S BSTSR=1,BSTSD=""
"RTN","BSTSAPIF",145,0)
 I LOCAL'=1 S BSTSR=$$DILKP^BSTSWSV1("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIF",146,0)
 ;
"RTN","BSTSAPIF",147,0)
 ;If no results, try performing local search
"RTN","BSTSAPIF",148,0)
 I $D(RESULT)<10 S BSTSD=$$VNLKP^BSTSLKP("RESULT",.BSTSWS)
"RTN","BSTSAPIF",149,0)
 ;
"RTN","BSTSAPIF",150,0)
 ;If local search and no record try DTS Lookup
"RTN","BSTSAPIF",151,0)
 I $D(RESULT)<10,LOCAL S BSTSR=$$DILKP^BSTSWSV1("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2,BSTSD=""
"RTN","BSTSAPIF",152,0)
 ;
"RTN","BSTSAPIF",153,0)
 ;Define output for no results
"RTN","BSTSAPIF",154,0)
 S:$D(RESULT)<10 BSTSD=0
"RTN","BSTSAPIF",155,0)
 ;
"RTN","BSTSAPIF",156,0)
 ;Get the concept information
"RTN","BSTSAPIF",157,0)
 S CONC=$P($G(RESULT(1)),U)
"RTN","BSTSAPIF",158,0)
 S RXSTR=""
"RTN","BSTSAPIF",159,0)
 ;
"RTN","BSTSAPIF",160,0)
 S:CONC]"" RXSTR=$$CNCLKP^BSTSAPI("CONCDT",CONC_"^"_BSTSWS("NAMESPACEID")_"^^1")
"RTN","BSTSAPIF",161,0)
 S @OUT@(1,"RXN","CON")=CONC
"RTN","BSTSAPIF",162,0)
 S @OUT@(1,"RXN","TRM")=$G(CONCDT(1,"FSN","TRM"))
"RTN","BSTSAPIF",163,0)
 S @OUT@(1,"RXN","TDC")=$G(CONCDT(1,"IAR",1,"CON"))
"RTN","BSTSAPIF",164,0)
 S @OUT@(1,"RXN","TDT")=$G(CONCDT(1,"IAR",1,"TRM"))
"RTN","BSTSAPIF",165,0)
 S @OUT@(1,"RXN","TTY")=$G(CONCDT(1,"TTY",1,"TTY"))
"RTN","BSTSAPIF",166,0)
 ;
"RTN","BSTSAPIF",167,0)
 S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIF",168,0)
 Q BSTSR
"RTN","BSTSAPIF",169,0)
 ;
"RTN","BSTSAPIF",170,0)
ASSOC(IN) ;EP - Returns the associations for each type (SMD, RxNorm, UNII)
"RTN","BSTSAPIF",171,0)
 ;
"RTN","BSTSAPIF",172,0)
 ;Input
"RTN","BSTSAPIF",173,0)
 ;  IN - P1 - The exact term to lookup
"RTN","BSTSAPIF",174,0)
 ;     - P2 (Optional) - The code set Id or Name (default SNOMED US EXT '36')
"RTN","BSTSAPIF",175,0)
 ;                          ID      NAME
"RTN","BSTSAPIF",176,0)
 ;                          32770   ECLIPS
"RTN","BSTSAPIF",177,0)
 ;                          5180    FDA UNII
"RTN","BSTSAPIF",178,0)
 ;                          32773   GMRA Allergies with Maps
"RTN","BSTSAPIF",179,0)
 ;                          32772   GMRA Signs Symptoms
"RTN","BSTSAPIF",180,0)
 ;                          32771   IHS VANDF
"RTN","BSTSAPIF",181,0)
 ;                          32774   IHS Med Route
"RTN","BSTSAPIF",182,0)
 ;                          1552    RxNorm R
"RTN","BSTSAPIF",183,0)
 ;                          36      SNOMED CT US Extension
"RTN","BSTSAPIF",184,0)
 ;     - P3 (Optional) - Snapshot Date to check (default T+2)
"RTN","BSTSAPIF",185,0)
 ;     - P4 (Optional) - LOCAL - Pass 1 or blank to perform local listing
"RTN","BSTSAPIF",186,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIF",187,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",188,0)
 ;
"RTN","BSTSAPIF",189,0)
 ;Output
"RTN","BSTSAPIF",190,0)
 ;Function returns - [1]^[2]^[3]
"RTN","BSTSAPIF",191,0)
 ; Where:
"RTN","BSTSAPIF",192,0)
 ; [1] - SNOMED Association(s) - ";" Delimited
"RTN","BSTSAPIF",193,0)
 ; [2] - RxNorm Association(s) - ";" Delimited
"RTN","BSTSAPIF",194,0)
 ; [3] - UNII Association(s) - ";" Delimited
"RTN","BSTSAPIF",195,0)
 ;
"RTN","BSTSAPIF",196,0)
 NEW RES,BSTSVAR,%D
"RTN","BSTSAPIF",197,0)
 ;
"RTN","BSTSAPIF",198,0)
 S RES=$$VALTERM^BSTSAPI("BSTSVAR",$G(IN))
"RTN","BSTSAPIF",199,0)
 I +RES D  Q RES
"RTN","BSTSAPIF",200,0)
 . ;
"RTN","BSTSAPIF",201,0)
 . NEW CNT,SMD,RXN,UNI,CON
"RTN","BSTSAPIF",202,0)
 . ;
"RTN","BSTSAPIF",203,0)
 . ;SNOMED
"RTN","BSTSAPIF",204,0)
 . S (SMD,CNT)="" F  S CNT=$O(BSTSVAR(1,"ASM",CNT)) Q:CNT=""  D
"RTN","BSTSAPIF",205,0)
 .. S CON=$G(BSTSVAR(1,"ASM",CNT,"CON")) Q:CON=""
"RTN","BSTSAPIF",206,0)
 .. S SMD=SMD_$S(SMD]"":";",1:"")_CON
"RTN","BSTSAPIF",207,0)
 . ;
"RTN","BSTSAPIF",208,0)
 . ;RxNorm
"RTN","BSTSAPIF",209,0)
 . S (RXN,CNT)="" F  S CNT=$O(BSTSVAR(1,"ARX",CNT)) Q:CNT=""  D
"RTN","BSTSAPIF",210,0)
 .. S CON=$G(BSTSVAR(1,"ARX",CNT,"CON")) Q:CON=""
"RTN","BSTSAPIF",211,0)
 .. S RXN=RXN_$S(RXN]"":";",1:"")_CON
"RTN","BSTSAPIF",212,0)
 . ;
"RTN","BSTSAPIF",213,0)
 . ;UNII
"RTN","BSTSAPIF",214,0)
 . S (UNI,CNT)="" F  S CNT=$O(BSTSVAR(1,"AUN",CNT)) Q:CNT=""  D
"RTN","BSTSAPIF",215,0)
 .. S CON=$G(BSTSVAR(1,"AUN",CNT,"CON")) Q:CON=""
"RTN","BSTSAPIF",216,0)
 .. S UNI=UNI_$S(UNI]"":";",1:"")_CON
"RTN","BSTSAPIF",217,0)
 .;
"RTN","BSTSAPIF",218,0)
 . S RES=SMD_U_RXN_U_UNI
"RTN","BSTSAPIF",219,0)
 ;
"RTN","BSTSAPIF",220,0)
 Q ""
"RTN","BSTSAPIF",221,0)
 ;
"RTN","BSTSAPIF",222,0)
DI2RX(IN) ;EP - Performs a drug ingredient lookup on a specified value
"RTN","BSTSAPIF",223,0)
 ; Returns only the first RxNorm mapping as a function call output
"RTN","BSTSAPIF",224,0)
 ;
"RTN","BSTSAPIF",225,0)
 ;Input
"RTN","BSTSAPIF",226,0)
 ;  IN - P1 - The exact term to lookup
"RTN","BSTSAPIF",227,0)
 ;     - P2 - Lookup Type (N-NDC,V-VUID)
"RTN","BSTSAPIF",228,0)
 ;     - P3 (Optional) - LOCAL - Pass 1 or blank to perform local listing,
"RTN","BSTSAPIF",229,0)
 ;                       Pass 2 for remote DTS listing
"RTN","BSTSAPIF",230,0)
 ;     - P4 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",231,0)
 ;
"RTN","BSTSAPIF",232,0)
 ;Output
"RTN","BSTSAPIF",233,0)
 ; Function returns - [1]^[2]
"RTN","BSTSAPIF",234,0)
 ; [1] - The RxNorm Code of the first RxNorm mapping (if more than one)
"RTN","BSTSAPIF",235,0)
 ; [2] - The RxNorm Term of the first RxNorm mapping
"RTN","BSTSAPIF",236,0)
 ; [3] - The RxNorm Tradename code
"RTN","BSTSAPIF",237,0)
 ; [4] - The RxNorm Tradename term
"RTN","BSTSAPIF",238,0)
 ; [5] - The first TTY value for the RxNorm
"RTN","BSTSAPIF",239,0)
 ;
"RTN","BSTSAPIF",240,0)
 ;
"RTN","BSTSAPIF",241,0)
 NEW DOUT,STS,RES,%D
"RTN","BSTSAPIF",242,0)
 ;
"RTN","BSTSAPIF",243,0)
 S STS=$$DILKP^BSTSAPI("DOUT",IN)
"RTN","BSTSAPIF",244,0)
 I 'STS Q ""
"RTN","BSTSAPIF",245,0)
 S $P(RES,U)=$G(DOUT(1,"RXN","CON"))
"RTN","BSTSAPIF",246,0)
 S $P(RES,U,2)=$G(DOUT(1,"RXN","TRM"))
"RTN","BSTSAPIF",247,0)
 S $P(RES,U,3)=$G(DOUT(1,"RXN","TDC"))
"RTN","BSTSAPIF",248,0)
 S $P(RES,U,4)=$G(DOUT(1,"RXN","TDT"))
"RTN","BSTSAPIF",249,0)
 S $P(RES,U,5)=$G(DOUT(1,"RXN","TTY"))
"RTN","BSTSAPIF",250,0)
 Q RES
"RTN","BSTSAPIF",251,0)
 ;
"RTN","BSTSAPIF",252,0)
USEARCH(OUT,IN) ;EP - Perform Codeset Universe Search
"RTN","BSTSAPIF",253,0)
 ;
"RTN","BSTSAPIF",254,0)
 ;Input
"RTN","BSTSAPIF",255,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSAPIF",256,0)
 ;  IN - P1 - Search string
"RTN","BSTSAPIF",257,0)
 ;     - P2 - Search Type - (F-Fully specified name, S-Synonyms)
"RTN","BSTSAPIF",258,0)
 ;     - P3 (Optional) - Namespace ID - Default to SNOMED US EXT (#36)
"RTN","BSTSAPIF",259,0)
 ;                     ID      NAME
"RTN","BSTSAPIF",260,0)
 ;                     5180    FDA UNII
"RTN","BSTSAPIF",261,0)
 ;                     32773   GMRA Allergies with Maps
"RTN","BSTSAPIF",262,0)
 ;                     32772   GMRA Signs Symptoms
"RTN","BSTSAPIF",263,0)
 ;                     32771   IHS VANDF
"RTN","BSTSAPIF",264,0)
 ;                     1552    RxNorm R
"RTN","BSTSAPIF",265,0)
 ;                     36      SNOMED CT US Extension
"RTN","BSTSAPIF",266,0)
 ;
"RTN","BSTSAPIF",267,0)
 ;     - P4 (Optional) - Maximum number of concepts/terms to return (default 25)
"RTN","BSTSAPIF",268,0)
 ;     - P5 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSAPIF",269,0)
 ;
"RTN","BSTSAPIF",270,0)
 ;Output
"RTN","BSTSAPIF",271,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSAPIF",272,0)
 ; [1] - 2:Remote information returned
"RTN","BSTSAPIF",273,0)
 ;       1:Local information returned
"RTN","BSTSAPIF",274,0)
 ;       0:No Information Returned
"RTN","BSTSAPIF",275,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSAPIF",276,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSAPIF",277,0)
 ;
"RTN","BSTSAPIF",278,0)
 ; VAR(#) - List of Records
"RTN","BSTSAPIF",279,0)
 ;
"RTN","BSTSAPIF",280,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSAPIF D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSAPIF",281,0)
 ;
"RTN","BSTSAPIF",282,0)
 N SEARCH,STYPE,NMID,SUB,SNAPDT,MAX,BCTCHRC,BCTCHCT,LOCAL,SLIST,%D
"RTN","BSTSAPIF",283,0)
 N RESULT,DEBUG,BSTSR,BSTSI,RET,DAT,BSTSWS,BSTSD,X,%,%H
"RTN","BSTSAPIF",284,0)
 K @OUT
"RTN","BSTSAPIF",285,0)
 ;
"RTN","BSTSAPIF",286,0)
 I $G(U)="" S U="^"
"RTN","BSTSAPIF",287,0)
 I $G(DT)="" D DT^DICRW
"RTN","BSTSAPIF",288,0)
 S IN=$G(IN,"")
"RTN","BSTSAPIF",289,0)
 S SEARCH=$P(IN,U) Q:($TR(SEARCH," ")="") "0^Invalid Search String"
"RTN","BSTSAPIF",290,0)
 S STYPE=$P(IN,U,2) I STYPE'="F",STYPE'="S" Q "0^Invalid Search Type"
"RTN","BSTSAPIF",291,0)
 S NMID=$P(IN,U,3) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSAPIF",292,0)
 S SUB="" S:NMID=36 SUB="UNIVERSE"
"RTN","BSTSAPIF",293,0)
 S SNAPDT="" S:SNAPDT]"" SNAPDT=$$DATE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIF",294,0)
 S:SNAPDT="" SNAPDT=$$DTCHG^BSTSUTIL(DT,2)_".0001"
"RTN","BSTSAPIF",295,0)
 S SNAPDT=$$FMTE^BSTSUTIL(SNAPDT)
"RTN","BSTSAPIF",296,0)
 S MAX=$P(IN,U,5) S:'MAX MAX=25
"RTN","BSTSAPIF",297,0)
 S RET="PSBIXCA"
"RTN","BSTSAPIF",298,0)
 S DAT=""
"RTN","BSTSAPIF",299,0)
 S BCTCHRC=""
"RTN","BSTSAPIF",300,0)
 S BCTCHCT="" I BCTCHRC,'BCTCHCT S BCTCHCT=MAX
"RTN","BSTSAPIF",301,0)
 S LOCAL=""
"RTN","BSTSAPIF",302,0)
 S DEBUG=$P(IN,U,6),DEBUG=$S(DEBUG=1:"1",1:"")
"RTN","BSTSAPIF",303,0)
 ;
"RTN","BSTSAPIF",304,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSAPIF",305,0)
 S BSTSWS("STYPE")=STYPE
"RTN","BSTSAPIF",306,0)
 S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSAPIF",307,0)
 S BSTSWS("SUBSET")=SUB
"RTN","BSTSAPIF",308,0)
 S BSTSWS("SNAPDT")=SNAPDT
"RTN","BSTSAPIF",309,0)
 S BSTSWS("MAXRECS")=MAX
"RTN","BSTSAPIF",310,0)
 S BSTSWS("BCTCHRC")=BCTCHRC
"RTN","BSTSAPIF",311,0)
 S BSTSWS("BCTCHCT")=BCTCHCT
"RTN","BSTSAPIF",312,0)
 S BSTSWS("RET")=RET
"RTN","BSTSAPIF",313,0)
 S BSTSWS("DAT")=DAT
"RTN","BSTSAPIF",314,0)
 S BSTSWS("DEBUG")=DEBUG
"RTN","BSTSAPIF",315,0)
 ;
"RTN","BSTSAPIF",316,0)
 S BSTSI=0
"RTN","BSTSAPIF",317,0)
 ;
"RTN","BSTSAPIF",318,0)
 ;Make DTS search call
"RTN","BSTSAPIF",319,0)
 S BSTSR=1
"RTN","BSTSAPIF",320,0)
 ;
"RTN","BSTSAPIF",321,0)
 ;DTS Call
"RTN","BSTSAPIF",322,0)
 S BSTSR=$$USEARCH^BSTSWSV1(OUT,.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSAPIF",323,0)
 ;
"RTN","BSTSAPIF",324,0)
 ;Now loop through and get the detail
"RTN","BSTSAPIF",325,0)
 I $D(RESULT) D
"RTN","BSTSAPIF",326,0)
 . ;
"RTN","BSTSAPIF",327,0)
 . NEW DLIST,ERSLT
"RTN","BSTSAPIF",328,0)
 . ;
"RTN","BSTSAPIF",329,0)
 . ;Define scratch global
"RTN","BSTSAPIF",330,0)
 . S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSAPIF",331,0)
 . ;
"RTN","BSTSAPIF",332,0)
 . NEW RCNT
"RTN","BSTSAPIF",333,0)
 . ;
"RTN","BSTSAPIF",334,0)
 . S RCNT="" F  S RCNT=$O(RESULT(RCNT)) Q:RCNT=""  D
"RTN","BSTSAPIF",335,0)
 .. ;
"RTN","BSTSAPIF",336,0)
 .. NEW REC,CONCID,DTSID,DSCID,STATUS
"RTN","BSTSAPIF",337,0)
 .. S REC=RESULT(RCNT)
"RTN","BSTSAPIF",338,0)
 .. ;
"RTN","BSTSAPIF",339,0)
 .. S CONCID=$P(RESULT(RCNT),"^")
"RTN","BSTSAPIF",340,0)
 .. S DTSID=$P(RESULT(RCNT),"^",2)
"RTN","BSTSAPIF",341,0)
 .. S DSCID=$P(RESULT(RCNT),"^",3)
"RTN","BSTSAPIF",342,0)
 .. ;
"RTN","BSTSAPIF",343,0)
 .. ;Not Found or in need of update
"RTN","BSTSAPIF",344,0)
 .. S BSTSWS("DTSID")=DTSID
"RTN","BSTSAPIF",345,0)
 .. ;
"RTN","BSTSAPIF",346,0)
 .. ;Clear result file
"RTN","BSTSAPIF",347,0)
 .. K @DLIST
"RTN","BSTSAPIF",348,0)
 .. ;
"RTN","BSTSAPIF",349,0)
 .. ;Get Detail for concept
"RTN","BSTSAPIF",350,0)
 .. S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSAPIF",351,0)
 .. ;
"RTN","BSTSAPIF",352,0)
 .. ;Assemble output for RPC
"RTN","BSTSAPIF",353,0)
 .. S @SLIST@(RCNT)=$P($G(@DLIST@(1,"CONCEPTID")),U)
"RTN","BSTSAPIF",354,0)
 ;
"RTN","BSTSAPIF",355,0)
 ;Loop through search results and retrieve detail
"RTN","BSTSAPIF",356,0)
 ;S BSTSD=$$DETAIL^BSTSSRCH(OUT,.BSTSWS,.RESULT)
"RTN","BSTSAPIF",357,0)
 ;S $P(BSTSR,U)=$S(BSTSD=0:0,(+BSTSR)>0:+BSTSR,1:1)
"RTN","BSTSAPIF",358,0)
 Q BSTSR
"RTN","BSTSAPIF",359,0)
 ;
"RTN","BSTSAPIF",360,0)
ERR ;
"RTN","BSTSAPIF",361,0)
 D ^%ZTER
"RTN","BSTSAPIF",362,0)
 Q
"RTN","BSTSCDET")
0^22^B99865117
"RTN","BSTSCDET",1,0)
BSTSCDET ;GDIT/HS/BEE-Get Concept Detail ;26-Jun-2015 18:12;DKM
"RTN","BSTSCDET",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSCDET",3,0)
 Q
"RTN","BSTSCDET",4,0)
 ;
"RTN","BSTSCDET",5,0)
DETAIL(OUT,BSTSWS,RESULT) ;EP - Return Details for each Concept/Term
"RTN","BSTSCDET",6,0)
 ;
"RTN","BSTSCDET",7,0)
 ;Input
"RTN","BSTSCDET",8,0)
 ; BSTSWS Array
"RTN","BSTSCDET",9,0)
 ; RESULT - [1]^[2]^[3]
"RTN","BSTSCDET",10,0)
 ;          [1] - Concept ID
"RTN","BSTSCDET",11,0)
 ;          [2] - DTS ID
"RTN","BSTSCDET",12,0)
 ;          [3] - Description Id
"RTN","BSTSCDET",13,0)
 ;
"RTN","BSTSCDET",14,0)
 ;Output
"RTN","BSTSCDET",15,0)
 ; Function returns - # Records Returned
"RTN","BSTSCDET",16,0)
 ;
"RTN","BSTSCDET",17,0)
 ; VAR(#) - List of Records
"RTN","BSTSCDET",18,0)
 ;
"RTN","BSTSCDET",19,0)
 ; The VAR(#) list of records returns the following sections
"RTN","BSTSCDET",20,0)
 ; (based on the input piece 6 and 7 values):
"RTN","BSTSCDET",21,0)
 ;
"RTN","BSTSCDET",22,0)
 ;Concept ID/DTSID
"RTN","BSTSCDET",23,0)
 ; VAR(#,"CON")=Concept Id
"RTN","BSTSCDET",24,0)
 ; VAR(#,"DTS")=Internal DTS Id
"RTN","BSTSCDET",25,0)
 ;
"RTN","BSTSCDET",26,0)
 ;Fully Specified Name
"RTN","BSTSCDET",27,0)
 ; VAR(#,"FSN","DSC")=Description Id of the FSN
"RTN","BSTSCDET",28,0)
 ; VAR(#,"FSN","TRM")=Fully Specified Name
"RTN","BSTSCDET",29,0)
 ; VAR(#,"FSN","XADT")=Date Added
"RTN","BSTSCDET",30,0)
 ; VAR(#,"FSN","XRDT")=Date Retired
"RTN","BSTSCDET",31,0)
 ;
"RTN","BSTSCDET",32,0)
 ;ICD9 Information - Multiple Records Returned (CTR)
"RTN","BSTSCDET",33,0)
 ; VAR(#,"ICD",CTR,"COD")=ICD9 Code
"RTN","BSTSCDET",34,0)
 ; VAR(#,"ICD",CTR,"TYP")=Code Type(ICD)
"RTN","BSTSCDET",35,0)
 ; VAR(#,"ICD",CTR,"XADT")=Date Added
"RTN","BSTSCDET",36,0)
 ; VAR(#,"ICD",CTR,"XRDT")=Date Retired
"RTN","BSTSCDET",37,0)
 ;
"RTN","BSTSCDET",38,0)
 ;IsA Information - Multiple Records Returned (CTR)
"RTN","BSTSCDET",39,0)
 ; VAR(#,"ISA",CTR,"CON")=Concept Id of IsA Term (may be blank prior to detail lookup)
"RTN","BSTSCDET",40,0)
 ; VAR(#,"ISA",CTR,"DTS")=DTSId of the IsA Term
"RTN","BSTSCDET",41,0)
 ; VAR(#,"ISA",CTR,"TRM")=IsA Term Name
"RTN","BSTSCDET",42,0)
 ; VAR(#,"ISA",CTR,"XADT")=Date Added
"RTN","BSTSCDET",43,0)
 ; VAR(#,"ISA",CTR,"XRDT")=Date Retired
"RTN","BSTSCDET",44,0)
 ;
"RTN","BSTSCDET",45,0)
 ;Association Information (SNOMED) - Multiple Records Returned (CTR)
"RTN","BSTSCDET",46,0)
 ; VAR(#,"ASM",CTR,"CON")=SNOMED Concept CT Association
"RTN","BSTSCDET",47,0)
 ; VAR(#,"ASM",CTR,"DTS")=DTSId of the SNOMED Concept
"RTN","BSTSCDET",48,0)
 ;
"RTN","BSTSCDET",49,0)
 ;Association Information (RxNorm) - Multiple Records Returned (CTR)
"RTN","BSTSCDET",50,0)
 ; VAR(#,"ARX",CTR,"CON")=RxNorm Code Value Association
"RTN","BSTSCDET",51,0)
 ; VAR(#,"ARX",CTR,"DTS")=DTSId of the RxNorm Concept
"RTN","BSTSCDET",52,0)
 ;
"RTN","BSTSCDET",53,0)
 ;Association Information (UNII) - Multiple Records Returned (CTR)
"RTN","BSTSCDET",54,0)
 ; VAR(#,"ASN",CTR,"CON")=UNII Code Value Association
"RTN","BSTSCDET",55,0)
 ; VAR(#,"ASN",CTR,"DTS")=DTSId of the UNII Concept
"RTN","BSTSCDET",56,0)
 ;
"RTN","BSTSCDET",57,0)
 ;Inverse Association Information (RxNorm) - Multiple Records Returned (CTR)
"RTN","BSTSCDET",58,0)
 ; VAR(#,"IAR",CTR,"CON")=RxNorm Code Value of Inverse Association
"RTN","BSTSCDET",59,0)
 ; VAR(#,"IAR",CTR,"DTS")=DTSId of the RxNorm Concept
"RTN","BSTSCDET",60,0)
 ; VAR(#,"IAR",CTR,"TRM")=Inverse Association Term
"RTN","BSTSCDET",61,0)
 ;
"RTN","BSTSCDET",62,0)
 ;Child Information - Multiple Records Returned (CTR)
"RTN","BSTSCDET",63,0)
 ; VAR(#,"CHD",CTR,"CON")=Concept Id of Child Term (may be blank prior to detail lookup)
"RTN","BSTSCDET",64,0)
 ; VAR(#,"CHD",CTR,"DTS")=DTSId of the Child Term
"RTN","BSTSCDET",65,0)
 ; VAR(#,"CHD",CTR,"TRM")=Child Term Name
"RTN","BSTSCDET",66,0)
 ; VAR(#,"CHD",CTR,"XADT")=Date Added
"RTN","BSTSCDET",67,0)
 ; VAR(#,"CHD",CTR,"XRDT")=Date Retired
"RTN","BSTSCDET",68,0)
 ;
"RTN","BSTSCDET",69,0)
 ;Lookup Problem Column Value (Fully Specified Name or a Synonym/Preferred Term)
"RTN","BSTSCDET",70,0)
 ;(Based on Search Type parameter - F/S)
"RTN","BSTSCDET",71,0)
 ; VAR(#,"PRB","DSC")=Description Id of a Pref Term (Type F) or Synonym/Pref Term (S)
"RTN","BSTSCDET",72,0)
 ; VAR(#,"PRB","TRM")=Preferred term of a Concept (F) or a Synonym (S)
"RTN","BSTSCDET",73,0)
 ;
"RTN","BSTSCDET",74,0)
 ;Preferred Term Information
"RTN","BSTSCDET",75,0)
 ; VAR(#,"PRE","DSC")=Description ID of Preferred Term
"RTN","BSTSCDET",76,0)
 ; VAR(#,"PRE","TRM")=Preferred Term
"RTN","BSTSCDET",77,0)
 ; VAR(#,"PRE","XADT")=Date Added
"RTN","BSTSCDET",78,0)
 ; VAR(#,"PRE","XRDT")=Date Retired
"RTN","BSTSCDET",79,0)
 ;
"RTN","BSTSCDET",80,0)
 ;Subset Information - Multiple Records Returned (CTR)
"RTN","BSTSCDET",81,0)
 ; VAR(#,"SUB",CTR,"SUB")=Subset Name
"RTN","BSTSCDET",82,0)
 ; VAR(#,"SUB",CTR,"XADT")=Date Added
"RTN","BSTSCDET",83,0)
 ; VAR(#,"SUB",CTR,"XRDT")=Date Retired
"RTN","BSTSCDET",84,0)
 ;
"RTN","BSTSCDET",85,0)
 ;Synonym Information - Multiple Records Returned (CTR)
"RTN","BSTSCDET",86,0)
 ; VAR(#,"SYN",CTR,"DSC")=Description ID of Synonym
"RTN","BSTSCDET",87,0)
 ; VAR(#,"SYN",CTR,"TRM")=Synonym Term
"RTN","BSTSCDET",88,0)
 ; VAR(#,"SYN",CTR,"XADT")=Date Added
"RTN","BSTSCDET",89,0)
 ; VAR(#,"SYN",CTR,"XRDT")=Date Retired
"RTN","BSTSCDET",90,0)
 ;
"RTN","BSTSCDET",91,0)
 ;Date Concept Added/Retired
"RTN","BSTSCDET",92,0)
 ; VAR(#,"XADT")=Date Added
"RTN","BSTSCDET",93,0)
 ; VAR(#,"XRDT")=Date Retired
"RTN","BSTSCDET",94,0)
 ;
"RTN","BSTSCDET",95,0)
 ;RxNorm Only - TTY
"RTN","BSTSCDET",96,0)
 ; VAR(#,"TTY",CTR,"TTY")=TTY Code
"RTN","BSTSCDET",97,0)
 ; VAR(#,"TTY",CTR,"XADT")=Date Added
"RTN","BSTSCDET",98,0)
 ; VAR(#,"TTY",CTR,"XRDT")=Date Retired
"RTN","BSTSCDET",99,0)
 ;
"RTN","BSTSCDET",100,0)
 N CNT,INMID,XNMID,NCNT,RET,DAT,STYPE
"RTN","BSTSCDET",101,0)
 ;
"RTN","BSTSCDET",102,0)
 ;Get the Namespace ID
"RTN","BSTSCDET",103,0)
 S XNMID=$G(BSTSWS("NAMESPACEID"))
"RTN","BSTSCDET",104,0)
 ;
"RTN","BSTSCDET",105,0)
 ;Pull return request
"RTN","BSTSCDET",106,0)
 S RET=$G(BSTSWS("RET"))
"RTN","BSTSCDET",107,0)
 S DAT=$G(BSTSWS("DAT"))
"RTN","BSTSCDET",108,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSCDET",109,0)
 S INMID=$O(^BSTS(9002318.1,"B",XNMID,""))
"RTN","BSTSCDET",110,0)
 ;
"RTN","BSTSCDET",111,0)
 S NCNT=0,CNT="" F  S CNT=$O(RESULT(CNT)) Q:CNT=""  D
"RTN","BSTSCDET",112,0)
 . ;
"RTN","BSTSCDET",113,0)
 . N CONC,DESC,CIEN,ADT,RDT,PRB,PRBIEN,ICNT,ISIEN
"RTN","BSTSCDET",114,0)
 . N BCNT,SBIEN,ICIEN,SCNT,TIEN,DTSID,ACNT,PDESC,CHIEN
"RTN","BSTSCDET",115,0)
 . N ASCNT,ASIEN,ARCNT,ARIEN,AUCNT,AUIEN,IARCNT,IASIEN,TTCNT,TTIEN
"RTN","BSTSCDET",116,0)
 . ;
"RTN","BSTSCDET",117,0)
 . S CONC=$P(RESULT(CNT),U)
"RTN","BSTSCDET",118,0)
 . S DTSID=$P(RESULT(CNT),U,2)
"RTN","BSTSCDET",119,0)
 . S DESC=$P(RESULT(CNT),U,3)
"RTN","BSTSCDET",120,0)
 . ;
"RTN","BSTSCDET",121,0)
 . ;Get Concept IEN
"RTN","BSTSCDET",122,0)
 . S CIEN=$$CIEN^BSTSLKP(CONC,XNMID) Q:CIEN=""
"RTN","BSTSCDET",123,0)
 . S ADT=$$GET1^DIQ(9002318.4,CIEN,".05","I")
"RTN","BSTSCDET",124,0)
 . S RDT=$$GET1^DIQ(9002318.4,CIEN,".06","I")
"RTN","BSTSCDET",125,0)
 . ;
"RTN","BSTSCDET",126,0)
 . ;If FSN Search retrieve Description ID for Preferred Term
"RTN","BSTSCDET",127,0)
 . S PDESC=$P($$PDESC^BSTSSRCH(CIEN),U) Q:PDESC=""
"RTN","BSTSCDET",128,0)
 . I STYPE="F" S DESC=PDESC
"RTN","BSTSCDET",129,0)
 . ;
"RTN","BSTSCDET",130,0)
 . ;Determine PRB value - For now use FSN or SYN/PRE
"RTN","BSTSCDET",131,0)
 . S PRB=DESC
"RTN","BSTSCDET",132,0)
 . S PRBIEN=$O(^BSTS(9002318.3,"D",INMID,PRB,"")) Q:PRBIEN=""
"RTN","BSTSCDET",133,0)
 . S NCNT=NCNT+1
"RTN","BSTSCDET",134,0)
 . S @OUT@(NCNT,"PRB","TRM")=$$GET1^DIQ(9002318.3,PRBIEN_",",1)
"RTN","BSTSCDET",135,0)
 . S @OUT@(NCNT,"PRB","DSC")=DESC
"RTN","BSTSCDET",136,0)
 . S @OUT@(NCNT,"CON")=CONC
"RTN","BSTSCDET",137,0)
 . S @OUT@(NCNT,"DTS")=DTSID
"RTN","BSTSCDET",138,0)
 . I 'DAT S @OUT@(NCNT,"XADT")=ADT
"RTN","BSTSCDET",139,0)
 . I 'DAT S @OUT@(NCNT,"XRDT")=RDT
"RTN","BSTSCDET",140,0)
 . ;
"RTN","BSTSCDET",141,0)
 . ;Pull IsA Relationships
"RTN","BSTSCDET",142,0)
 . I RET["I" S (ACNT,ISIEN)=0 F  S ISIEN=$O(^BSTS(9002318.4,CIEN,5,ISIEN)) Q:'ISIEN  D
"RTN","BSTSCDET",143,0)
 .. ;
"RTN","BSTSCDET",144,0)
 .. N ISA,DA,IENS,ICONC,ADT,RDT,DTS,FSN
"RTN","BSTSCDET",145,0)
 .. S DA(1)=CIEN,DA=ISIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",146,0)
 .. S ISA=$$GET1^DIQ(9002318.45,IENS,".01","I") Q:ISA=""
"RTN","BSTSCDET",147,0)
 .. S ADT=$$GET1^DIQ(9002318.45,IENS,".02","I")
"RTN","BSTSCDET",148,0)
 .. S RDT=$$GET1^DIQ(9002318.45,IENS,".03","I")
"RTN","BSTSCDET",149,0)
 .. S ICONC=$$GET1^DIQ(9002318.4,ISA,".02","I")
"RTN","BSTSCDET",150,0)
 .. S DTS=$$GET1^DIQ(9002318.4,ISA,".08","I")
"RTN","BSTSCDET",151,0)
 .. S FSN=$$GET1^DIQ(9002318.4,ISA,1,"I")
"RTN","BSTSCDET",152,0)
 .. S ACNT=ACNT+1
"RTN","BSTSCDET",153,0)
 .. S @OUT@(NCNT,"ISA",ACNT,"TRM")=FSN
"RTN","BSTSCDET",154,0)
 .. S @OUT@(NCNT,"ISA",ACNT,"CON")=ICONC
"RTN","BSTSCDET",155,0)
 .. S @OUT@(NCNT,"ISA",ACNT,"DTS")=DTS
"RTN","BSTSCDET",156,0)
 .. Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",157,0)
 .. S @OUT@(NCNT,"ISA",ACNT,"XADT")=ADT
"RTN","BSTSCDET",158,0)
 .. S @OUT@(NCNT,"ISA",ACNT,"XRDT")=RDT
"RTN","BSTSCDET",159,0)
 . ;
"RTN","BSTSCDET",160,0)
 . ;RxNorm - Pull TTY
"RTN","BSTSCDET",161,0)
 . I XNMID=1552 S (TTCNT,TTIEN)=0 F  S TTIEN=$O(^BSTS(9002318.4,CIEN,12,TTIEN)) Q:'TTIEN  D
"RTN","BSTSCDET",162,0)
 .. ;
"RTN","BSTSCDET",163,0)
 .. N TTY,DA,IENS,ICONC,ADT,RDT,DTS,FSN
"RTN","BSTSCDET",164,0)
 .. S DA(1)=CIEN,DA=TTIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",165,0)
 .. S TTY=$$GET1^DIQ(9002318.412,IENS,".01","I") Q:TTY=""
"RTN","BSTSCDET",166,0)
 .. S ADT=$$GET1^DIQ(9002318.412,IENS,".02","I")
"RTN","BSTSCDET",167,0)
 .. S RDT=$$GET1^DIQ(9002318.412,IENS,".03","I")
"RTN","BSTSCDET",168,0)
 .. S TTCNT=TTCNT+1
"RTN","BSTSCDET",169,0)
 .. S @OUT@(NCNT,"TTY",TTCNT,"TTY")=TTY
"RTN","BSTSCDET",170,0)
 .. Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",171,0)
 .. S @OUT@(NCNT,"TTY",TTCNT,"XADT")=ADT
"RTN","BSTSCDET",172,0)
 .. S @OUT@(NCNT,"TTY",TTCNT,"XRDT")=RDT
"RTN","BSTSCDET",173,0)
 . ;
"RTN","BSTSCDET",174,0)
 . ;Pull Child Relationships
"RTN","BSTSCDET",175,0)
 . I RET["C" S (ACNT,CHIEN)=0 F  S CHIEN=$O(^BSTS(9002318.4,CIEN,6,CHIEN)) Q:'CHIEN  D
"RTN","BSTSCDET",176,0)
 .. ;
"RTN","BSTSCDET",177,0)
 .. N CHD,DA,IENS,ICONC,ADT,RDT,DTS,FSN
"RTN","BSTSCDET",178,0)
 .. S DA(1)=CIEN,DA=CHIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",179,0)
 .. S CHD=$$GET1^DIQ(9002318.46,IENS,".01","I") Q:CHD=""
"RTN","BSTSCDET",180,0)
 .. S ADT=$$GET1^DIQ(9002318.46,IENS,".02","I")
"RTN","BSTSCDET",181,0)
 .. S RDT=$$GET1^DIQ(9002318.46,IENS,".03","I")
"RTN","BSTSCDET",182,0)
 .. S ICONC=$$GET1^DIQ(9002318.4,CHD,".02","I")
"RTN","BSTSCDET",183,0)
 .. S DTS=$$GET1^DIQ(9002318.4,CHD,".08","I")
"RTN","BSTSCDET",184,0)
 .. S FSN=$$GET1^DIQ(9002318.4,CHD,1,"I")
"RTN","BSTSCDET",185,0)
 .. S ACNT=ACNT+1
"RTN","BSTSCDET",186,0)
 .. S @OUT@(NCNT,"CHD",ACNT,"TRM")=FSN
"RTN","BSTSCDET",187,0)
 .. S @OUT@(NCNT,"CHD",ACNT,"CON")=ICONC
"RTN","BSTSCDET",188,0)
 .. S @OUT@(NCNT,"CHD",ACNT,"DTS")=DTS
"RTN","BSTSCDET",189,0)
 .. Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",190,0)
 .. S @OUT@(NCNT,"CHD",ACNT,"XADT")=ADT
"RTN","BSTSCDET",191,0)
 .. S @OUT@(NCNT,"CHD",ACNT,"XRDT")=RDT
"RTN","BSTSCDET",192,0)
 . ;
"RTN","BSTSCDET",193,0)
 . ;Pull Associations
"RTN","BSTSCDET",194,0)
 . I RET["A" S (ASCNT,ARCNT,AUCNT,ASIEN)=0 F  S ASIEN=$O(^BSTS(9002318.4,CIEN,9,ASIEN)) Q:'ASIEN  D
"RTN","BSTSCDET",195,0)
 .. ;
"RTN","BSTSCDET",196,0)
 .. N COD,DA,IENS,NAM,DTS
"RTN","BSTSCDET",197,0)
 .. S DA(1)=CIEN,DA=ASIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",198,0)
 .. S COD=$$GET1^DIQ(9002318.49,IENS,".01","I") Q:COD=""
"RTN","BSTSCDET",199,0)
 .. S NAM=$$GET1^DIQ(9002318.49,IENS,".02","I")
"RTN","BSTSCDET",200,0)
 .. S DTS=$$GET1^DIQ(9002318.49,IENS,".03","I")
"RTN","BSTSCDET",201,0)
 .. ;
"RTN","BSTSCDET",202,0)
 .. ;Define SNOMED, RxNorm, and UNII
"RTN","BSTSCDET",203,0)
 .. I (NAM=36)!(NAM=1552)!(NAM=5180) D
"RTN","BSTSCDET",204,0)
 ... NEW CNT,NOD
"RTN","BSTSCDET",205,0)
 ... S (CNT,NOD)=""
"RTN","BSTSCDET",206,0)
 ... I NAM=36 S ASCNT=ASCNT+1,CNT=ASCNT,NOD="ASM"
"RTN","BSTSCDET",207,0)
 ... I NAM=1552 S ARCNT=ARCNT+1,CNT=ARCNT,NOD="ARX"
"RTN","BSTSCDET",208,0)
 ... I NAM=5180 S AUCNT=AUCNT+1,CNT=AUCNT,NOD="AUN"
"RTN","BSTSCDET",209,0)
 ... Q:CNT=""
"RTN","BSTSCDET",210,0)
 ... S @OUT@(NCNT,NOD,CNT,"CON")=COD
"RTN","BSTSCDET",211,0)
 ... S @OUT@(NCNT,NOD,CNT,"DTS")=DTS
"RTN","BSTSCDET",212,0)
 . ;
"RTN","BSTSCDET",213,0)
 . ;Pull Inverse Associations
"RTN","BSTSCDET",214,0)
 . I RET["V" S (IARCNT,IASIEN)=0 F  S IASIEN=$O(^BSTS(9002318.4,CIEN,11,IASIEN)) Q:'IASIEN  D
"RTN","BSTSCDET",215,0)
 .. ;
"RTN","BSTSCDET",216,0)
 .. N COD,DA,IENS,NAM,DTS,TRM
"RTN","BSTSCDET",217,0)
 .. S DA(1)=CIEN,DA=IASIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",218,0)
 .. S COD=$$GET1^DIQ(9002318.411,IENS,".01","I") Q:COD=""
"RTN","BSTSCDET",219,0)
 .. S NAM=$$GET1^DIQ(9002318.411,IENS,".02","I")
"RTN","BSTSCDET",220,0)
 .. S DTS=$$GET1^DIQ(9002318.411,IENS,".03","I")
"RTN","BSTSCDET",221,0)
 .. S TRM=$$GET1^DIQ(9002318.411,IENS,".04","I")
"RTN","BSTSCDET",222,0)
 .. ;
"RTN","BSTSCDET",223,0)
 .. ;Define RxNorm
"RTN","BSTSCDET",224,0)
 .. I (NAM=1552) D
"RTN","BSTSCDET",225,0)
 ... NEW CNT,NOD
"RTN","BSTSCDET",226,0)
 ... S (CNT,NOD)=""
"RTN","BSTSCDET",227,0)
 ... I NAM=1552 S IARCNT=IARCNT+1,CNT=IARCNT,NOD="IAR"
"RTN","BSTSCDET",228,0)
 ... Q:CNT=""
"RTN","BSTSCDET",229,0)
 ... S @OUT@(NCNT,NOD,CNT,"CON")=COD
"RTN","BSTSCDET",230,0)
 ... S @OUT@(NCNT,NOD,CNT,"DTS")=DTS
"RTN","BSTSCDET",231,0)
 ... S @OUT@(NCNT,NOD,CNT,"TRM")=TRM
"RTN","BSTSCDET",232,0)
 . ;
"RTN","BSTSCDET",233,0)
 . ;Pull Subsets
"RTN","BSTSCDET",234,0)
 . I RET["B" S (BCNT,SBIEN)=0 F  S SBIEN=$O(^BSTS(9002318.4,CIEN,4,SBIEN)) Q:'SBIEN  D
"RTN","BSTSCDET",235,0)
 .. ;
"RTN","BSTSCDET",236,0)
 .. N SUB,DA,IENS,ADT,RDT
"RTN","BSTSCDET",237,0)
 .. S DA(1)=CIEN,DA=SBIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",238,0)
 .. S SUB=$$GET1^DIQ(9002318.44,IENS,".01","I") Q:SUB=""
"RTN","BSTSCDET",239,0)
 .. S ADT=$$GET1^DIQ(9002318.44,IENS,".02","I")
"RTN","BSTSCDET",240,0)
 .. S RDT=$$GET1^DIQ(9002318.44,IENS,".03","I")
"RTN","BSTSCDET",241,0)
 .. S BCNT=BCNT+1
"RTN","BSTSCDET",242,0)
 .. S @OUT@(NCNT,"SUB",BCNT,"SUB")=SUB
"RTN","BSTSCDET",243,0)
 .. Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",244,0)
 .. S @OUT@(NCNT,"SUB",BCNT,"XADT")=ADT
"RTN","BSTSCDET",245,0)
 .. S @OUT@(NCNT,"SUB",BCNT,"XRDT")=RDT
"RTN","BSTSCDET",246,0)
 . ;
"RTN","BSTSCDET",247,0)
 . ;Pull ICD9
"RTN","BSTSCDET",248,0)
 . I XNMID=36,RET["X" D
"RTN","BSTSCDET",249,0)
 .. S ICIEN=0 F  S ICIEN=$O(^BSTS(9002318.4,CIEN,3,ICIEN)) Q:'ICIEN  D
"RTN","BSTSCDET",250,0)
 ... ;
"RTN","BSTSCDET",251,0)
 ... N ICD,DA,IENS,ADT,RDT,ICDT
"RTN","BSTSCDET",252,0)
 ... S DA(1)=CIEN,DA=ICIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSCDET",253,0)
 ... S ICD=$$GET1^DIQ(9002318.43,IENS,".02","I") Q:ICD=""
"RTN","BSTSCDET",254,0)
 ... S ICDT=$$GET1^DIQ(9002318.43,IENS,".03","I")
"RTN","BSTSCDET",255,0)
 ... S ADT=$$GET1^DIQ(9002318.43,IENS,".04","I")
"RTN","BSTSCDET",256,0)
 ... S RDT=$$GET1^DIQ(9002318.43,IENS,".05","I")
"RTN","BSTSCDET",257,0)
 ... ;
"RTN","BSTSCDET",258,0)
 ... ;Save Current Mapped value
"RTN","BSTSCDET",259,0)
 ... I ICDT="IC9" D
"RTN","BSTSCDET",260,0)
 .... S ICNT("ICD")=$G(ICNT("ICD"))+1
"RTN","BSTSCDET",261,0)
 .... S @OUT@(NCNT,"ICD",ICNT("ICD"),"COD")=ICD
"RTN","BSTSCDET",262,0)
 .... S @OUT@(NCNT,"ICD",ICNT("ICD"),"TYP")=ICDT
"RTN","BSTSCDET",263,0)
 .... Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",264,0)
 .... S @OUT@(NCNT,"ICD",ICNT("ICD"),"XADT")=ADT
"RTN","BSTSCDET",265,0)
 .... S @OUT@(NCNT,"ICD",ICNT("ICD"),"XRDT")=RDT
"RTN","BSTSCDET",266,0)
 . ;
"RTN","BSTSCDET",267,0)
 . ;Set up FSN, Synonyms, Preferred
"RTN","BSTSCDET",268,0)
 . S SCNT=0,TIEN="" F  S TIEN=$O(^BSTS(9002318.3,"C",XNMID,CIEN,TIEN),-1) Q:TIEN=""  D
"RTN","BSTSCDET",269,0)
 .. N TRM,TYP,ADT,RDT,DSC
"RTN","BSTSCDET",270,0)
 .. ;
"RTN","BSTSCDET",271,0)
 .. S TYP=$$GET1^DIQ(9002318.3,TIEN_",",.09,"I") Q:TYP=""
"RTN","BSTSCDET",272,0)
 .. S TRM=$$GET1^DIQ(9002318.3,TIEN_",",1) Q:TRM=""
"RTN","BSTSCDET",273,0)
 .. S DSC=$$GET1^DIQ(9002318.3,TIEN_",",.02,"I") Q:DSC=""
"RTN","BSTSCDET",274,0)
 .. S ADT=$$GET1^DIQ(9002318.3,TIEN_",",.06,"I")
"RTN","BSTSCDET",275,0)
 .. S RDT=$$GET1^DIQ(9002318.3,TIEN_",",.07,"I")
"RTN","BSTSCDET",276,0)
 .. ;
"RTN","BSTSCDET",277,0)
 .. ;Handle multiple preferred terms - switch to synonym
"RTN","BSTSCDET",278,0)
 .. I $D(@OUT@(NCNT,"PRE")),TYP="P" S TYP="S"
"RTN","BSTSCDET",279,0)
 .. ;
"RTN","BSTSCDET",280,0)
 .. ;Synonyms
"RTN","BSTSCDET",281,0)
 .. I RET["S",TYP="S" D
"RTN","BSTSCDET",282,0)
 ... S SCNT=SCNT+1,@OUT@(NCNT,"SYN",SCNT,"TRM")=TRM
"RTN","BSTSCDET",283,0)
 ... S @OUT@(NCNT,"SYN",SCNT,"DSC")=DSC
"RTN","BSTSCDET",284,0)
 ... Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",285,0)
 ... S @OUT@(NCNT,"SYN",SCNT,"XADT")=ADT
"RTN","BSTSCDET",286,0)
 ... S @OUT@(NCNT,"SYN",SCNT,"XRDT")=RDT
"RTN","BSTSCDET",287,0)
 .. ;
"RTN","BSTSCDET",288,0)
 .. ;Fully specified name
"RTN","BSTSCDET",289,0)
 .. I TYP="F"!((XNMID=1552)&(TYP="P")) D
"RTN","BSTSCDET",290,0)
 ... S @OUT@(NCNT,"FSN","TRM")=TRM
"RTN","BSTSCDET",291,0)
 ... S @OUT@(NCNT,"FSN","DSC")=DSC
"RTN","BSTSCDET",292,0)
 ... Q:DAT  ;Exclude ADT/RDt
"RTN","BSTSCDET",293,0)
 ... S @OUT@(NCNT,"FSN","XADT")=ADT
"RTN","BSTSCDET",294,0)
 ... S @OUT@(NCNT,"FSN","XRDT")=RDT
"RTN","BSTSCDET",295,0)
 .. ;
"RTN","BSTSCDET",296,0)
 .. ;Preferred term
"RTN","BSTSCDET",297,0)
 .. I RET["P",TYP="P" D
"RTN","BSTSCDET",298,0)
 ... S @OUT@(NCNT,"PRE","TRM")=TRM
"RTN","BSTSCDET",299,0)
 ... S @OUT@(NCNT,"PRE","DSC")=DSC
"RTN","BSTSCDET",300,0)
 ... Q:DAT  ;Exclude ADT/RDT
"RTN","BSTSCDET",301,0)
 ... S @OUT@(NCNT,"PRE","XADT")=ADT
"RTN","BSTSCDET",302,0)
 ... S @OUT@(NCNT,"PRE","XRDT")=RDT
"RTN","BSTSCDET",303,0)
 ... ;
"RTN","BSTSCDET",304,0)
 ... ;If STYPE="F" switch problem value to preferred values
"RTN","BSTSCDET",305,0)
 .. I TYP="P",STYPE="F" D
"RTN","BSTSCDET",306,0)
 ... S @OUT@(NCNT,"PRB","TRM")=TRM
"RTN","BSTSCDET",307,0)
 ... S @OUT@(NCNT,"PRB","DSC")=DSC
"RTN","BSTSCDET",308,0)
 ;
"RTN","BSTSCDET",309,0)
 Q NCNT
"RTN","BSTSCLAS")
0^10^B22293545
"RTN","BSTSCLAS",1,0)
BSTSCLAS ;GDIT/HS/BEE-Post Install ;26-Jun-2015 18:12;DKM
"RTN","BSTSCLAS",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSCLAS",3,0)
 ;
"RTN","BSTSCLAS",4,0)
EN Q
"RTN","BSTSCLAS",5,0)
 ;
"RTN","BSTSCLAS",6,0)
 ; Main entry point - interactive
"RTN","BSTSCLAS",7,0)
EXPORT ;
"RTN","BSTSCLAS",8,0)
 N CNT,ERR,EXEC,I,MASK,STREAM,XML,NAME,B64
"RTN","BSTSCLAS",9,0)
 K CLASSES
"RTN","BSTSCLAS",10,0)
 W !,"Enter class(es) to distribute, one at a time.  Wildcards OK."
"RTN","BSTSCLAS",11,0)
 W !,"E.g, PACKAGE.CLASS.G*.CLS.   Hit <ENTER> when finished"
"RTN","BSTSCLAS",12,0)
 S MASK="" F  D  Q:$G(MASK)=""
"RTN","BSTSCLAS",13,0)
 . NEW DIR,X,Y
"RTN","BSTSCLAS",14,0)
 . S DIR(0)="F"
"RTN","BSTSCLAS",15,0)
 . S DIR("A")="Class: "
"RTN","BSTSCLAS",16,0)
 . D ^DIR
"RTN","BSTSCLAS",17,0)
 . S MASK=$S(X="^":"",1:X)
"RTN","BSTSCLAS",18,0)
 . Q:MASK=""
"RTN","BSTSCLAS",19,0)
 . S:MASK'?1.E1".CLS"&(MASK'?1.E1".cls") MASK=MASK_".CLS"
"RTN","BSTSCLAS",20,0)
 . S CLASSES(MASK)=""
"RTN","BSTSCLAS",21,0)
 ;
"RTN","BSTSCLAS",22,0)
 Q:'$D(CLASSES)
"RTN","BSTSCLAS",23,0)
 ; Create a new global-based character stream
"RTN","BSTSCLAS",24,0)
EXPGO ;
"RTN","BSTSCLAS",25,0)
 ; Create new record in 9002318.5 with IEN of REC
"RTN","BSTSCLAS",26,0)
 ; Populate Name (not sure what it should be), Date/Time, and set status to I
"RTN","BSTSCLAS",27,0)
 K DO,DA S DIC=9002318.5,DLAYGO=9002318.5,DIC(0)="L",X=$S($G(NAME)'="":NAME,1:"New Record for "_$H)
"RTN","BSTSCLAS",28,0)
 S DIC("DR")=".01////"_X_";1.02////I"
"RTN","BSTSCLAS",29,0)
 ; Do we need date on the Export?
"RTN","BSTSCLAS",30,0)
 ;Set DIC("DR")=DIC("DR")_";1.03////"_$G(DT)
"RTN","BSTSCLAS",31,0)
 D ^DIC
"RTN","BSTSCLAS",32,0)
 I Y=-1 S ERR=1,ERR(1)="Failed to create a record" D ERROR Q
"RTN","BSTSCLAS",33,0)
 S REC=+Y
"RTN","BSTSCLAS",34,0)
 ; populate the new record
"RTN","BSTSCLAS",35,0)
 S ERR=0,U="^"
"RTN","BSTSCLAS",36,0)
 S EXEC="SET STREAM=##class(%Stream.GlobalCharacter).%New()"
"RTN","BSTSCLAS",37,0)
 X EXEC
"RTN","BSTSCLAS",38,0)
 ; Export a list of classes/routines/etc to the stream as XML
"RTN","BSTSCLAS",39,0)
 S EXEC="DO $system.OBJ.ExportToStream(.CLASSES,.STREAM,.qlist,.ERR)"
"RTN","BSTSCLAS",40,0)
 X EXEC
"RTN","BSTSCLAS",41,0)
 ; ADD ERROR LOG
"RTN","BSTSCLAS",42,0)
 I ERR D ERROR Q
"RTN","BSTSCLAS",43,0)
 F  S EXEC="S STR=STREAM.Read(1000000)" X EXEC Q:STR=""  D  Q:ERR
"RTN","BSTSCLAS",44,0)
 . S EXEC="S COMP=$system.Util.Compress(STR)" X EXEC
"RTN","BSTSCLAS",45,0)
 . S EXEC="S B64=$system.Encryption.Base64Encode(COMP)" X EXEC
"RTN","BSTSCLAS",46,0)
 . I $L(B64)="" S ERR=1,ERR(1)="Failed to create encrypted stream" D ERROR Q
"RTN","BSTSCLAS",47,0)
 . S B64=$TR(B64,$C(10))
"RTN","BSTSCLAS",48,0)
 . F I=1:1 SET XML=$P(B64,$C(13),I) Q:XML=""  D POPULATE^BSTSCLAS(REC,XML) Q:ERR
"RTN","BSTSCLAS",49,0)
 . I ERR D ERROR
"RTN","BSTSCLAS",50,0)
 . D POPULATE^BSTSCLAS(REC,"------------------------- SEGMENT END ------------------------")
"RTN","BSTSCLAS",51,0)
 S DIE="^BSTSCLS("
"RTN","BSTSCLAS",52,0)
 K DA S DA=REC
"RTN","BSTSCLAS",53,0)
 ; Set Status to READY
"RTN","BSTSCLAS",54,0)
 S DR="1.02////R"
"RTN","BSTSCLAS",55,0)
 D ^DIE
"RTN","BSTSCLAS",56,0)
 W !,"Record ",REC," created"
"RTN","BSTSCLAS",57,0)
 Q
"RTN","BSTSCLAS",58,0)
 ;
"RTN","BSTSCLAS",59,0)
IMPORT(REC,ERR) ;
"RTN","BSTSCLAS",60,0)
 ; Returns ERR if there are any errors.
"RTN","BSTSCLAS",61,0)
 NEW EXEC,I,STREAM,STRING,B64,COMP,LOADED
"RTN","BSTSCLAS",62,0)
 NEW %,DIE,DA,CLASS,DIWF,DIWL,DIWR,DLAYGO,DR,ERRTEXT,ERRTXT
"RTN","BSTSCLAS",63,0)
 NEW J,MASK,NAME,STR,X,Y
"RTN","BSTSCLAS",64,0)
 S ERR=0
"RTN","BSTSCLAS",65,0)
 I $G(REC)="" Q
"RTN","BSTSCLAS",66,0)
 I '$D(^BSTSCLS(REC)) Q
"RTN","BSTSCLAS",67,0)
 I $G(DT)'?7N.E S DT=$$DT^XLFDT
"RTN","BSTSCLAS",68,0)
 ; Change the value of field RPMS STATUS in 9002318.5 to "I"
"RTN","BSTSCLAS",69,0)
 K DA S DA=REC,DIE="^BSTSCLS(",DR="1.02////I" D ^DIE
"RTN","BSTSCLAS",70,0)
 ; Erase old errors
"RTN","BSTSCLAS",71,0)
 ;S IEN=0 F  S IEN=$O(^BJMDS(90607,1,2,IEN)) Q:'IEN  K DA S DA=IEN,DA(1)=1,DIK="^BJMDS(90607,1,2," D ^DIK
"RTN","BSTSCLAS",72,0)
 ;
"RTN","BSTSCLAS",73,0)
 ; Create a new global-based character stream
"RTN","BSTSCLAS",74,0)
 SET EXEC="S STREAM=##class(%Stream.GlobalCharacter).%New()"
"RTN","BSTSCLAS",75,0)
 X EXEC
"RTN","BSTSCLAS",76,0)
 ;
"RTN","BSTSCLAS",77,0)
 ; Copy the XML from the distribution global to a stream
"RTN","BSTSCLAS",78,0)
 S I=0
"RTN","BSTSCLAS",79,0)
 F  D  Q:B64=""
"RTN","BSTSCLAS",80,0)
 . S B64=""
"RTN","BSTSCLAS",81,0)
 . F  S I=$O(^BSTSCLS(REC,10,I)) Q:'I  S STR=^BSTSCLS(REC,10,I,0) Q:STR["SEGMENT END"  S B64=B64_STR_$C(13,10)
"RTN","BSTSCLAS",82,0)
 . I B64="" Q
"RTN","BSTSCLAS",83,0)
 . S EXEC="S COMP=$system.Encryption.Base64Decode(B64)" X EXEC
"RTN","BSTSCLAS",84,0)
 . S EXEC="S STRING=$system.Util.Decompress(COMP)" X EXEC
"RTN","BSTSCLAS",85,0)
 . S EXEC="D STREAM.Write(STRING)" X EXEC
"RTN","BSTSCLAS",86,0)
 ;
"RTN","BSTSCLAS",87,0)
 ; First check that the received classes are OK. Pass "1" in the 5th parameter
"RTN","BSTSCLAS",88,0)
 ; so that the import won't actualy happen. Then analyze the value of "ERR"
"RTN","BSTSCLAS",89,0)
 S EXEC="D $system.OBJ.LoadStream(STREAM,""ck/lock=0"",.ERR,.LOADED,1)"
"RTN","BSTSCLAS",90,0)
 X EXEC
"RTN","BSTSCLAS",91,0)
 ; Error processing after the dry run
"RTN","BSTSCLAS",92,0)
 I ERR D BGERROR G EXIT
"RTN","BSTSCLAS",93,0)
 ;
"RTN","BSTSCLAS",94,0)
 ; Actually load and compile the classes.
"RTN","BSTSCLAS",95,0)
 ; "c" means "compile" and "k" means "keep source code"
"RTN","BSTSCLAS",96,0)
 S EXEC="D $system.OBJ.LoadStream(STREAM,""ck/lock=0"",.ERR,.LOADED)"
"RTN","BSTSCLAS",97,0)
 X EXEC
"RTN","BSTSCLAS",98,0)
 ; Error processing after the actual load
"RTN","BSTSCLAS",99,0)
 I ERR D BGERROR G EXIT
"RTN","BSTSCLAS",100,0)
 ;
"RTN","BSTSCLAS",101,0)
 S CLASS="" F  S CLASS=$O(LOADED(CLASS)) Q:CLASS=""  D
"RTN","BSTSCLAS",102,0)
 . S DIC="^BSTSCLS("_REC_",11,",DIC(0)="L",DLAYGO=9002318.511
"RTN","BSTSCLAS",103,0)
 . S DA(1)=REC
"RTN","BSTSCLAS",104,0)
 . S X=CLASS
"RTN","BSTSCLAS",105,0)
 . D ^DIC
"RTN","BSTSCLAS",106,0)
 ; Change the value of the field RPMS STATUS in 9002318.5 to "R"
"RTN","BSTSCLAS",107,0)
 ; and populate RPMS DATE/TIME INSTALLED
"RTN","BSTSCLAS",108,0)
 S DIE="^BSTSCLS("
"RTN","BSTSCLAS",109,0)
 K DA S DA=REC
"RTN","BSTSCLAS",110,0)
 ; Set Status to READY
"RTN","BSTSCLAS",111,0)
 W !,"Updating 9002318.5 Record"
"RTN","BSTSCLAS",112,0)
 D NOW^%DTC
"RTN","BSTSCLAS",113,0)
 S DR="1.02////C;1.03////"_%
"RTN","BSTSCLAS",114,0)
 D ^DIE
"RTN","BSTSCLAS",115,0)
EXIT ;
"RTN","BSTSCLAS",116,0)
 Q
"RTN","BSTSCLAS",117,0)
 ;
"RTN","BSTSCLAS",118,0)
POPULATE(REC,XML) ;
"RTN","BSTSCLAS",119,0)
 S DA(1)=REC
"RTN","BSTSCLAS",120,0)
 K DIC S DIC="^BSTSCLS("_DA(1)_",10," ;XML Subfile
"RTN","BSTSCLAS",121,0)
 S DIC(0)="L",DLAYGO=9002318.51 ;LAYGO to the subfile
"RTN","BSTSCLAS",122,0)
 S X=XML
"RTN","BSTSCLAS",123,0)
 ; S X=$$ENCODE(XML)
"RTN","BSTSCLAS",124,0)
 ; Add XML Data as the .01 field
"RTN","BSTSCLAS",125,0)
 D FILE^DICN
"RTN","BSTSCLAS",126,0)
 I Y=-1 S ERR="Failed to create XML subfield entry" Q
"RTN","BSTSCLAS",127,0)
 Q
"RTN","BSTSCLAS",128,0)
ERROR ;
"RTN","BSTSCLAS",129,0)
 S ERRTEXT=""
"RTN","BSTSCLAS",130,0)
 I $D(ERR)=1,ERR'=0 S ERRTXT=ERR
"RTN","BSTSCLAS",131,0)
 I $D(ERR)>10 S I="",ERRTXT="" F  S I=$O(ERR(I)) Q:'I  S ERRTXT=ERRTXT_$G(ERR(I))_" "
"RTN","BSTSCLAS",132,0)
 W !,!,ERRTXT
"RTN","BSTSCLAS",133,0)
 Q
"RTN","BSTSCLAS",134,0)
BGERROR ;
"RTN","BSTSCLAS",135,0)
 ;W !,"Class import process errored out with error ",$G(ERR)
"RTN","BSTSCLAS",136,0)
 ;W !,"Please contact IHS National."
"RTN","BSTSCLAS",137,0)
 ; Change the value of the field RPMS STATUS in 9002318.5 to "E"
"RTN","BSTSCLAS",138,0)
 ; S ERRTEXT=""
"RTN","BSTSCLAS",139,0)
 I $D(ERR)=1 S I=ERR K ERR S ERR=1,ERR(1)=I
"RTN","BSTSCLAS",140,0)
 I $D(ERR)>10 S I="" D
"RTN","BSTSCLAS",141,0)
 . F  S I=$O(ERR(I)) Q:'I  S ERR(I)=$TR(ERR(I),$C(10,13),"  ")
"RTN","BSTSCLAS",142,0)
 S DIE="^BSTSCLS("
"RTN","BSTSCLAS",143,0)
 I '$G(REC) Q
"RTN","BSTSCLAS",144,0)
 I '$D(^BSTSCLS(REC)) Q
"RTN","BSTSCLAS",145,0)
 K DA S DA=REC
"RTN","BSTSCLAS",146,0)
 ; Set Status to ERROR
"RTN","BSTSCLAS",147,0)
 S DR="1.02////E"
"RTN","BSTSCLAS",148,0)
 D ^DIE
"RTN","BSTSCLAS",149,0)
 K ^UTILITY($J,"W")
"RTN","BSTSCLAS",150,0)
 S DIWF="C80",DIWL=1,DIWR=80,I=""
"RTN","BSTSCLAS",151,0)
 F  S I=$O(ERR(I)) Q:'I  S X=ERR(I) D ^DIWP
"RTN","BSTSCLAS",152,0)
 S I="" K ERR1 S ERR1=0
"RTN","BSTSCLAS",153,0)
 F  S I=$O(^UTILITY($J,"W",I)) Q:'I  S J="" F  S J=$O(^UTILITY($J,"W",I,J)) Q:'J  S ERR1=ERR1+1,ERR1(ERR1)=$G(^UTILITY($J,"W",I,J,0))
"RTN","BSTSCLAS",154,0)
 ;D WP^DIE(90607,"1,",2,"","ERR1")
"RTN","BSTSCLAS",155,0)
 Q
"RTN","BSTSCMCL")
0^3^B11199204
"RTN","BSTSCMCL",1,0)
BSTSCMCL ;GDIT/HS/BEE-Standard Terminology Cache Method Calls ;26-Jun-2015 18:12;DKM
"RTN","BSTSCMCL",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSCMCL",3,0)
 ;
"RTN","BSTSCMCL",4,0)
 Q
"RTN","BSTSCMCL",5,0)
 ;
"RTN","BSTSCMCL",6,0)
FSNSRCH(BSTSWS,RSLT) ;EP - DTS4 Fully Specified Name Search
"RTN","BSTSCMCL",7,0)
 ;
"RTN","BSTSCMCL",8,0)
 ;Perform Concept Search
"RTN","BSTSCMCL",9,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",10,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).FindConceptsWithNameMatching(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",11,0)
 Q STS
"RTN","BSTSCMCL",12,0)
 ;
"RTN","BSTSCMCL",13,0)
CONSRCH(BSTSWS,RSLT) ;EP - DTS4 Concept Search
"RTN","BSTSCMCL",14,0)
 ;
"RTN","BSTSCMCL",15,0)
 ;Perform Concept Search
"RTN","BSTSCMCL",16,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",17,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).executeConceptTextSearch(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",18,0)
 Q STS
"RTN","BSTSCMCL",19,0)
 ;
"RTN","BSTSCMCL",20,0)
DSCSRCH(BSTSWS,RSLT) ;EP - DTS4 Description Id Search
"RTN","BSTSCMCL",21,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",22,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).findDescWithIdMatch(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",23,0)
 Q STS
"RTN","BSTSCMCL",24,0)
 ;
"RTN","BSTSCMCL",25,0)
TRMSRCH(BSTSWS,RSLT) ;EP - DTS4 Term Search
"RTN","BSTSCMCL",26,0)
 ;
"RTN","BSTSCMCL",27,0)
 ;Perform Concept Search
"RTN","BSTSCMCL",28,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",29,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).FullTextSearch(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",30,0)
 Q STS
"RTN","BSTSCMCL",31,0)
 ;
"RTN","BSTSCMCL",32,0)
SUBLST(BSTSWS,RSLT) ;EP - DTS4 Retrieve Subset List
"RTN","BSTSCMCL",33,0)
 ;
"RTN","BSTSCMCL",34,0)
 ;Retrieve list of concepts in a specified subset
"RTN","BSTSCMCL",35,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",36,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).getSubsetList(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",37,0)
 Q STS
"RTN","BSTSCMCL",38,0)
 ;
"RTN","BSTSCMCL",39,0)
ICD2SMD(BSTSWS,RSLT) ;EP - DTS4 Retrieve ICD9 to SNOMED mappings
"RTN","BSTSCMCL",40,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",41,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).getICD9toSNOMED(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",42,0)
 Q STS
"RTN","BSTSCMCL",43,0)
 ;
"RTN","BSTSCMCL",44,0)
CNCSR(BSTSWS,RSLT) ;EP - DTS4 Lookup on Concept Id
"RTN","BSTSCMCL",45,0)
 ;
"RTN","BSTSCMCL",46,0)
 ;Perform Concept Id Search
"RTN","BSTSCMCL",47,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",48,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).findConceptsWithPropMatch(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",49,0)
 Q STS
"RTN","BSTSCMCL",50,0)
 ;
"RTN","BSTSCMCL",51,0)
DETAIL(BSTSWS,RSLT) ;EP - DTS4 Retrieve Concept Detail
"RTN","BSTSCMCL",52,0)
 ;
"RTN","BSTSCMCL",53,0)
 ;Place call to retrieve detail for a concept
"RTN","BSTSCMCL",54,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",55,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).GetConceptDetail(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",56,0)
 Q STS
"RTN","BSTSCMCL",57,0)
 ;
"RTN","BSTSCMCL",58,0)
FDESC(BSTSWS) ;EP - DTS4 Retrieve FSN Description Id
"RTN","BSTSCMCL",59,0)
 ;
"RTN","BSTSCMCL",60,0)
 NEW RSLT,STS,EXEC
"RTN","BSTSCMCL",61,0)
 ;
"RTN","BSTSCMCL",62,0)
 ;Place call to retrieve the description id for a FSN
"RTN","BSTSCMCL",63,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).findTermsByName(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",64,0)
 Q STS
"RTN","BSTSCMCL",65,0)
 ;
"RTN","BSTSCMCL",66,0)
GCDSDTS4(BSTSWS,RESULT) ;EP - DTS4 update codesets
"RTN","BSTSCMCL",67,0)
 ;
"RTN","BSTSCMCL",68,0)
 ;Place call to retrieve codesets (namespaces)
"RTN","BSTSCMCL",69,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",70,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).GetNamespaces(.BSTSWS,.RESULT)" X EXEC
"RTN","BSTSCMCL",71,0)
 Q STS
"RTN","BSTSCMCL",72,0)
 ;
"RTN","BSTSCMCL",73,0)
GVRDTS4(BSTSWS) ;EP - DTS4 update versions
"RTN","BSTSCMCL",74,0)
 ;
"RTN","BSTSCMCL",75,0)
 ;Place call to retrieve versions
"RTN","BSTSCMCL",76,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",77,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).GetVersions(.BSTSWS)" X EXEC
"RTN","BSTSCMCL",78,0)
 Q STS
"RTN","BSTSCMCL",79,0)
 ;
"RTN","BSTSCMCL",80,0)
PTYDTS4(BSTSWS,RSLT) ;EP - DTS4 Perform Property Search
"RTN","BSTSCMCL",81,0)
 ;
"RTN","BSTSCMCL",82,0)
 ;Search based on property value
"RTN","BSTSCMCL",83,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",84,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).propertyLookup(.BSTSWS,.RSLT)" X EXEC
"RTN","BSTSCMCL",85,0)
 Q STS
"RTN","BSTSCMCL",86,0)
 ;
"RTN","BSTSCMCL",87,0)
SUBSET(BSTSWS,RESULT) ;EP - DTS4 get subset list
"RTN","BSTSCMCL",88,0)
 ;
"RTN","BSTSCMCL",89,0)
 ;Place call to retrieve list of subsets
"RTN","BSTSCMCL",90,0)
 NEW STS,EXEC
"RTN","BSTSCMCL",91,0)
 S STS="",EXEC="S STS=##class(BSTS.SOAP.WebFunctions).getListofSubsets(.BSTSWS,.RESULT)" X EXEC
"RTN","BSTSCMCL",92,0)
 Q STS
"RTN","BSTSDTS0")
0^4^B162610162
"RTN","BSTSDTS0",1,0)
BSTSDTS0 ;GDIT/HS/BEE-Standard Terminology DTS Calls/Processing ;26-Jun-2015 18:12;DKM
"RTN","BSTSDTS0",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSDTS0",3,0)
 ;
"RTN","BSTSDTS0",4,0)
 Q
"RTN","BSTSDTS0",5,0)
 ;
"RTN","BSTSDTS0",6,0)
CNCSR(OUT,BSTSWS) ;EP - DTS4 Search Call - Concept Lookup
"RTN","BSTSDTS0",7,0)
 ;
"RTN","BSTSDTS0",8,0)
 N II,STS,SEARCH,STYPE,MAX,DTSID,NMID
"RTN","BSTSDTS0",9,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,ST
"RTN","BSTSDTS0",10,0)
 ;
"RTN","BSTSDTS0",11,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS0",12,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS0",13,0)
 S SLIST=$NA(^TMP("BSTSPDET",$J)) ;Sorted List
"RTN","BSTSDTS0",14,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS0",15,0)
 K @SLIST,@DLIST,@OUT
"RTN","BSTSDTS0",16,0)
 ;
"RTN","BSTSDTS0",17,0)
 ;Determine maximum to return
"RTN","BSTSDTS0",18,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS0",19,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS0",20,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS0",21,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS0",22,0)
 ;
"RTN","BSTSDTS0",23,0)
 ;Perform Lookup on Concept Id
"RTN","BSTSDTS0",24,0)
 S STS=$$CNCSR^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS0",25,0)
 ;
"RTN","BSTSDTS0",26,0)
 ;Sort results (though there should only be one)
"RTN","BSTSDTS0",27,0)
 S DTSID="" F  S DTSID=$O(@DLIST@(DTSID)) Q:DTSID=""  S @SLIST@(@DLIST@(DTSID),DTSID)=""
"RTN","BSTSDTS0",28,0)
 ;
"RTN","BSTSDTS0",29,0)
 ;Loop through results and retrieve detail
"RTN","BSTSDTS0",30,0)
 S II="",RCNT=0 F  S II=$O(@SLIST@(II),-1) Q:II=""  D  Q:RCNT
"RTN","BSTSDTS0",31,0)
 . S DTSID="" F  S DTSID=$O(@SLIST@(II,DTSID)) Q:DTSID=""  D  Q:RCNT
"RTN","BSTSDTS0",32,0)
 .. ;
"RTN","BSTSDTS0",33,0)
 .. N STATUS,CONC,ERSLT
"RTN","BSTSDTS0",34,0)
 .. ;
"RTN","BSTSDTS0",35,0)
 .. ;Update entry
"RTN","BSTSDTS0",36,0)
 .. S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS0",37,0)
 .. ;
"RTN","BSTSDTS0",38,0)
 .. ;Clear result file
"RTN","BSTSDTS0",39,0)
 .. K @DLIST
"RTN","BSTSDTS0",40,0)
 .. ;
"RTN","BSTSDTS0",41,0)
 .. ;Get Detail for concept
"RTN","BSTSDTS0",42,0)
 .. S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS0",43,0)
 .. I $G(BSTSWS("DEBUG")) W !!,"Detail Call Status: ",STATUS
"RTN","BSTSDTS0",44,0)
 .. ;
"RTN","BSTSDTS0",45,0)
 .. ;File the Detail
"RTN","BSTSDTS0",46,0)
 .. S STATUS=$$UPDATE(NMID)
"RTN","BSTSDTS0",47,0)
 .. I $G(BSTSWS("DEBUG")) W !!,"Update Call Status: ",STATUS
"RTN","BSTSDTS0",48,0)
 .. ;
"RTN","BSTSDTS0",49,0)
 .. ;Look again to see if concept now logged
"RTN","BSTSDTS0",50,0)
 .. S CONC=$$CONC(DTSID,.BSTSWS,1,1)
"RTN","BSTSDTS0",51,0)
 .. I CONC]"" D  Q
"RTN","BSTSDTS0",52,0)
 ... I CONC'=BSTSWS("SEARCH") Q
"RTN","BSTSDTS0",53,0)
 ... S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID
"RTN","BSTSDTS0",54,0)
 ;
"RTN","BSTSDTS0",55,0)
 Q STS
"RTN","BSTSDTS0",56,0)
 ;
"RTN","BSTSDTS0",57,0)
UPDATE(NMID,ROUT) ;EP - Add/Update Concept and Term(s)
"RTN","BSTSDTS0",58,0)
 ;
"RTN","BSTSDTS0",59,0)
 ;Update UNII
"RTN","BSTSDTS0",60,0)
 I $G(NMID)=5180 Q $$UUPDATE^BSTSDTS1(NMID,$G(ROUT))
"RTN","BSTSDTS0",61,0)
 ;
"RTN","BSTSDTS0",62,0)
 ;Update RxNorm
"RTN","BSTSDTS0",63,0)
 I $G(NMID)=1552 Q $$RUPDATE^BSTSDTS1(NMID,$G(ROUT))
"RTN","BSTSDTS0",64,0)
 ;
"RTN","BSTSDTS0",65,0)
 ;This update section only applies to SNOMED
"RTN","BSTSDTS0",66,0)
 I $G(NMID)'=36 Q $$SUPDATE^BSTSDTS3(NMID,$G(ROUT))
"RTN","BSTSDTS0",67,0)
 ;
"RTN","BSTSDTS0",68,0)
 N GL,CONCDA,BSTSC,INMID,ERROR,TCNT,I,CVRSN,ST,NROUT
"RTN","BSTSDTS0",69,0)
 ;
"RTN","BSTSDTS0",70,0)
 S GL=$NA(^TMP("BSTSCMCL",$J,1))
"RTN","BSTSDTS0",71,0)
 S ROUT=$G(ROUT,"")
"RTN","BSTSDTS0",72,0)
 ;
"RTN","BSTSDTS0",73,0)
 ;Look for Concept Id
"RTN","BSTSDTS0",74,0)
 I $P($G(@GL@("CONCEPTID")),U)="" Q 0
"RTN","BSTSDTS0",75,0)
 ;
"RTN","BSTSDTS0",76,0)
 ;Look for existing entry
"RTN","BSTSDTS0",77,0)
 I $G(@GL@("DTSID"))="" Q 0
"RTN","BSTSDTS0",78,0)
 S CONCDA=$O(^BSTS(9002318.4,"D",NMID,@GL@("DTSID"),""))
"RTN","BSTSDTS0",79,0)
 ;
"RTN","BSTSDTS0",80,0)
 ;None found - create new entry
"RTN","BSTSDTS0",81,0)
 I CONCDA="" S CONCDA=$$NEWC()
"RTN","BSTSDTS0",82,0)
 ;
"RTN","BSTSDTS0",83,0)
 ;Verify entry found/created
"RTN","BSTSDTS0",84,0)
 I +CONCDA<0 Q 0
"RTN","BSTSDTS0",85,0)
 ;
"RTN","BSTSDTS0",86,0)
 ;Pull internal Code Set ID
"RTN","BSTSDTS0",87,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) Q:INMID="" "0"
"RTN","BSTSDTS0",88,0)
 ;
"RTN","BSTSDTS0",89,0)
 ;Pull the current version
"RTN","BSTSDTS0",90,0)
 S CVRSN=$$GET1^DIQ(9002318.1,INMID_",",.04,"I")
"RTN","BSTSDTS0",91,0)
 ;
"RTN","BSTSDTS0",92,0)
 ;Get Revision Out
"RTN","BSTSDTS0",93,0)
 S NROUT=$P(@GL@("CONCEPTID"),U,3) S:NROUT="" NROUT=ROUT
"RTN","BSTSDTS0",94,0)
 ;
"RTN","BSTSDTS0",95,0)
 ;Set up top level concept fields
"RTN","BSTSDTS0",96,0)
 S BSTSC(9002318.4,CONCDA_",",.02)=$P(@GL@("CONCEPTID"),U) ;Concept ID
"RTN","BSTSDTS0",97,0)
 S BSTSC(9002318.4,CONCDA_",",.08)=@GL@("DTSID") ;DTS ID
"RTN","BSTSDTS0",98,0)
 S BSTSC(9002318.4,CONCDA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS0",99,0)
 S BSTSC(9002318.4,CONCDA_",",.03)="N"
"RTN","BSTSDTS0",100,0)
 S BSTSC(9002318.4,CONCDA_",",.05)=$$DTS2FMDT^BSTSUTIL($P(@GL@("CONCEPTID"),U,2),1)
"RTN","BSTSDTS0",101,0)
 S BSTSC(9002318.4,CONCDA_",",.06)=$$DTS2FMDT^BSTSUTIL(NROUT,1)
"RTN","BSTSDTS0",102,0)
 S BSTSC(9002318.4,CONCDA_",",.11)="N"
"RTN","BSTSDTS0",103,0)
 S BSTSC(9002318.4,CONCDA_",",.04)=CVRSN
"RTN","BSTSDTS0",104,0)
 S BSTSC(9002318.4,CONCDA_",",.12)=DT
"RTN","BSTSDTS0",105,0)
 S BSTSC(9002318.4,CONCDA_",",1)=$G(@GL@("FSN",1))
"RTN","BSTSDTS0",106,0)
 ;
"RTN","BSTSDTS0",107,0)
 ;Save ISA
"RTN","BSTSDTS0",108,0)
 I $D(@GL@("ISA"))>1 D
"RTN","BSTSDTS0",109,0)
 . ;
"RTN","BSTSDTS0",110,0)
 . N ISACT
"RTN","BSTSDTS0",111,0)
 . S ISACT="" F  S ISACT=$O(@GL@("ISA",ISACT)) Q:ISACT=""  D
"RTN","BSTSDTS0",112,0)
 .. ;
"RTN","BSTSDTS0",113,0)
 .. ;Save/update each ISA entry
"RTN","BSTSDTS0",114,0)
 .. ;
"RTN","BSTSDTS0",115,0)
 .. ;First see if IsA code has been saved
"RTN","BSTSDTS0",116,0)
 .. N DAISA,DA,IENS,DTSID,ISACD,NEWISA,DIC,Y,X,DLAYGO
"RTN","BSTSDTS0",117,0)
 .. S ISACD=$P($G(@GL@("ISA",ISACT,0)),U) Q:ISACD=""
"RTN","BSTSDTS0",118,0)
 .. S (NEWISA,DAISA)=$O(^BSTS(9002318.4,"D",NMID,ISACD,""))
"RTN","BSTSDTS0",119,0)
 .. ;
"RTN","BSTSDTS0",120,0)
 .. ;Not found - add partial entry to concept file
"RTN","BSTSDTS0",121,0)
 .. I DAISA="" S DAISA=$$NEWC()
"RTN","BSTSDTS0",122,0)
 .. S BSTSC(9002318.4,DAISA_",",.08)=$G(ISACD)
"RTN","BSTSDTS0",123,0)
 .. I NEWISA="" S BSTSC(9002318.4,DAISA_",",.03)="P"
"RTN","BSTSDTS0",124,0)
 .. S BSTSC(9002318.4,DAISA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS0",125,0)
 .. S BSTSC(9002318.4,DAISA_",",.04)=CVRSN ;Version
"RTN","BSTSDTS0",126,0)
 .. S BSTSC(9002318.4,DAISA_",",.11)="N" ;Up to Date
"RTN","BSTSDTS0",127,0)
 .. S BSTSC(9002318.4,DAISA_",",.12)=DT  ;Update date
"RTN","BSTSDTS0",128,0)
 .. S BSTSC(9002318.4,DAISA_",",1)=$G(@GL@("ISA",ISACT,1))
"RTN","BSTSDTS0",129,0)
 .. ;
"RTN","BSTSDTS0",130,0)
 .. ;Now add IsA pointer in current concept entry
"RTN","BSTSDTS0",131,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS0",132,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",5,",X=DAISA
"RTN","BSTSDTS0",133,0)
 .. S DLAYGO=9002318.45 D ^DIC I +Y<0 Q
"RTN","BSTSDTS0",134,0)
 .. ;
"RTN","BSTSDTS0",135,0)
 .. ;Save additional IsA fields
"RTN","BSTSDTS0",136,0)
 .. S DA(1)=CONCDA,DA=+Y,IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS0",137,0)
 .. S BSTSC(9002318.45,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("ISA",ISACT,1,0)),U,2))
"RTN","BSTSDTS0",138,0)
 ;
"RTN","BSTSDTS0",139,0)
 ;Save Children (subconcepts)
"RTN","BSTSDTS0",140,0)
 I $D(@GL@("SUBC"))>1 D
"RTN","BSTSDTS0",141,0)
 . ;
"RTN","BSTSDTS0",142,0)
 . N SUBCCT
"RTN","BSTSDTS0",143,0)
 . S SUBCCT="" F  S SUBCCT=$O(@GL@("SUBC",SUBCCT)) Q:SUBCCT=""  D
"RTN","BSTSDTS0",144,0)
 .. ;
"RTN","BSTSDTS0",145,0)
 .. ;Save/update each SubConcept entry
"RTN","BSTSDTS0",146,0)
 .. ;
"RTN","BSTSDTS0",147,0)
 .. ;First see if Subconcept code has been saved
"RTN","BSTSDTS0",148,0)
 .. N DASUBC,DA,IENS,DTSID,SUBCCD,NEWSUBC,DIC,Y,X,DLAYGO
"RTN","BSTSDTS0",149,0)
 .. S SUBCCD=$P($G(@GL@("SUBC",SUBCCT,0)),U) Q:SUBCCD=""
"RTN","BSTSDTS0",150,0)
 .. S (NEWSUBC,DASUBC)=$O(^BSTS(9002318.4,"D",NMID,SUBCCD,""))
"RTN","BSTSDTS0",151,0)
 .. ;
"RTN","BSTSDTS0",152,0)
 .. ;Not found - add partial entry to concept file
"RTN","BSTSDTS0",153,0)
 .. I DASUBC="" S DASUBC=$$NEWC()
"RTN","BSTSDTS0",154,0)
 .. S BSTSC(9002318.4,DASUBC_",",.08)=$G(SUBCCD)
"RTN","BSTSDTS0",155,0)
 .. I NEWSUBC="" S BSTSC(9002318.4,DASUBC_",",.03)="P"
"RTN","BSTSDTS0",156,0)
 .. S BSTSC(9002318.4,DASUBC_",",.07)=INMID ;Code Set
"RTN","BSTSDTS0",157,0)
 .. S BSTSC(9002318.4,DASUBC_",",.04)=CVRSN ;Version
"RTN","BSTSDTS0",158,0)
 .. S BSTSC(9002318.4,DASUBC_",",.11)="N" ;Up to Date
"RTN","BSTSDTS0",159,0)
 .. S BSTSC(9002318.4,DASUBC_",",.12)=DT ;Update Date
"RTN","BSTSDTS0",160,0)
 .. S BSTSC(9002318.4,DASUBC_",",1)=$G(@GL@("SUBC",SUBCCT,1))
"RTN","BSTSDTS0",161,0)
 .. ;
"RTN","BSTSDTS0",162,0)
 .. ;Now add SUBC pointer in current concept entry
"RTN","BSTSDTS0",163,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS0",164,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",6,",X=DASUBC
"RTN","BSTSDTS0",165,0)
 .. S DLAYGO=9002318.46 D ^DIC I +Y<0 Q
"RTN","BSTSDTS0",166,0)
 .. ;
"RTN","BSTSDTS0",167,0)
 .. ;Save additional SUBC fields
"RTN","BSTSDTS0",168,0)
 .. S DA(1)=CONCDA,DA=+Y,IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS0",169,0)
 .. S BSTSC(9002318.46,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("SUB",SUBCCT,1,0)),U,2))
"RTN","BSTSDTS0",170,0)
 ;
"RTN","BSTSDTS0",171,0)
 ;Need to interim save because subsets look at .07
"RTN","BSTSDTS0",172,0)
 I $D(BSTSC) D FILE^DIE("","BSTSC","ERROR")
"RTN","BSTSDTS0",173,0)
 ;
"RTN","BSTSDTS0",174,0)
 ;Save Subsets
"RTN","BSTSDTS0",175,0)
 ;
"RTN","BSTSDTS0",176,0)
 ;Clear out existing entries
"RTN","BSTSDTS0",177,0)
 D
"RTN","BSTSDTS0",178,0)
 . NEW SB
"RTN","BSTSDTS0",179,0)
 . S SB=0 F  S SB=$O(^BSTS(9002318.4,CONCDA,4,SB)) Q:'SB  D
"RTN","BSTSDTS0",180,0)
 .. NEW DA,DIK
"RTN","BSTSDTS0",181,0)
 .. S DA(1)=CONCDA,DA=SB
"RTN","BSTSDTS0",182,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",4," D ^DIK
"RTN","BSTSDTS0",183,0)
 I $D(@GL@("SUB"))>1 D
"RTN","BSTSDTS0",184,0)
 . ;
"RTN","BSTSDTS0",185,0)
 . NEW SB
"RTN","BSTSDTS0",186,0)
 . S SB="" F  S SB=$O(@GL@("SUB",SB)) Q:SB=""  D
"RTN","BSTSDTS0",187,0)
 .. ;
"RTN","BSTSDTS0",188,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS0",189,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS0",190,0)
 .. S DIC(0)="LX",DIC="^BSTS(9002318.4,"_DA(1)_",4,"
"RTN","BSTSDTS0",191,0)
 .. S X=$P($G(@GL@("SUB",SB)),U) Q:X=""
"RTN","BSTSDTS0",192,0)
 .. S DLAYGO=9002318.44 D ^DIC
"RTN","BSTSDTS0",193,0)
 .. I +Y<0 Q
"RTN","BSTSDTS0",194,0)
 .. S DA=+Y
"RTN","BSTSDTS0",195,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS0",196,0)
 .. S BSTSC(9002318.44,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("SUB",SB)),U,2))
"RTN","BSTSDTS0",197,0)
 ;
"RTN","BSTSDTS0",198,0)
 ;Save ICD Mapping
"RTN","BSTSDTS0",199,0)
 ;
"RTN","BSTSDTS0",200,0)
 ;Clear out existing entries
"RTN","BSTSDTS0",201,0)
 D
"RTN","BSTSDTS0",202,0)
 . NEW IC
"RTN","BSTSDTS0",203,0)
 . S IC=0 F  S IC=$O(^BSTS(9002318.4,CONCDA,3,IC)) Q:'IC  D
"RTN","BSTSDTS0",204,0)
 .. NEW DA,DIK
"RTN","BSTSDTS0",205,0)
 .. S DA(1)=CONCDA,DA=IC
"RTN","BSTSDTS0",206,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",3," D ^DIK
"RTN","BSTSDTS0",207,0)
 ;
"RTN","BSTSDTS0",208,0)
 ;Save ICD9 first
"RTN","BSTSDTS0",209,0)
 I $D(@GL@("ICD9"))>1 D
"RTN","BSTSDTS0",210,0)
 . N ICD
"RTN","BSTSDTS0",211,0)
 . S ICD="" F  S ICD=$O(@GL@("ICD9",ICD)) Q:ICD=""  D
"RTN","BSTSDTS0",212,0)
 .. N DA,IENS,ICDCD
"RTN","BSTSDTS0",213,0)
 .. ;
"RTN","BSTSDTS0",214,0)
 .. ;Look up entry
"RTN","BSTSDTS0",215,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS0",216,0)
 .. S ICDCD=$P($G(@GL@("ICD9",ICD)),U) Q:ICDCD=""
"RTN","BSTSDTS0",217,0)
 .. S DA=$O(^BSTS(9002318.4,DA(1),3,"C",ICDCD,""))
"RTN","BSTSDTS0",218,0)
 .. ;
"RTN","BSTSDTS0",219,0)
 .. ;Create new entry
"RTN","BSTSDTS0",220,0)
 .. I DA="" S DA=$$NEWI(CONCDA)
"RTN","BSTSDTS0",221,0)
 .. Q:DA<0
"RTN","BSTSDTS0",222,0)
 .. ;
"RTN","BSTSDTS0",223,0)
 .. ;Add in additional fields
"RTN","BSTSDTS0",224,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS0",225,0)
 .. S BSTSC(9002318.43,IENS,".02")=ICDCD
"RTN","BSTSDTS0",226,0)
 .. S BSTSC(9002318.43,IENS,".03")="IC9"
"RTN","BSTSDTS0",227,0)
 .. S BSTSC(9002318.43,IENS,".04")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("ICD9",ICD)),U,2))
"RTN","BSTSDTS0",228,0)
 .. S BSTSC(9002318.43,IENS,".05")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("ICD9",ICD)),U,3))
"RTN","BSTSDTS0",229,0)
 ;
"RTN","BSTSDTS0",230,0)
 ;Save ICD10 Mapping Next
"RTN","BSTSDTS0",231,0)
 I $D(@GL@("A10"))>1 D
"RTN","BSTSDTS0",232,0)
 . N ICD
"RTN","BSTSDTS0",233,0)
 . S ICD="" F  S ICD=$O(@GL@("A10",ICD)) Q:ICD=""  D
"RTN","BSTSDTS0",234,0)
 .. N DA,IENS,ICDCD
"RTN","BSTSDTS0",235,0)
 .. ;
"RTN","BSTSDTS0",236,0)
 .. ;Look up entry
"RTN","BSTSDTS0",237,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS0",238,0)
 .. S ICDCD=$P($G(@GL@("A10",ICD)),U) Q:ICDCD=""
"RTN","BSTSDTS0",239,0)
 .. S DA=$O(^BSTS(9002318.4,DA(1),3,"C",ICDCD,""))
"RTN","BSTSDTS0",240,0)
 .. ;
"RTN","BSTSDTS0",241,0)
 .. ;Create new entry
"RTN","BSTSDTS0",242,0)
 .. I DA="" S DA=$$NEWI(CONCDA)
"RTN","BSTSDTS0",243,0)
 .. Q:DA<0
"RTN","BSTSDTS0",244,0)
 .. ;
"RTN","BSTSDTS0",245,0)
 .. ;Add in additional fields
"RTN","BSTSDTS0",246,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS0",247,0)
 .. S BSTSC(9002318.43,IENS,".02")=ICDCD
"RTN","BSTSDTS0",248,0)
 .. S BSTSC(9002318.43,IENS,".03")="10D"
"RTN","BSTSDTS0",249,0)
 .. S BSTSC(9002318.43,IENS,".04")=$$DTS2FMDT^BSTSUTIL($P($P($G(@GL@("A10",ICD)),U,5)," "))
"RTN","BSTSDTS0",250,0)
 .. S BSTSC(9002318.43,IENS,".05")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("A10",ICD)),U,6))
"RTN","BSTSDTS0",251,0)
 ;
"RTN","BSTSDTS0",252,0)
 ;Save ICD9 to SNOMED Mapping
"RTN","BSTSDTS0",253,0)
 ;
"RTN","BSTSDTS0",254,0)
 ;Clear out existing entries
"RTN","BSTSDTS0",255,0)
 D
"RTN","BSTSDTS0",256,0)
 . NEW SB
"RTN","BSTSDTS0",257,0)
 . S SB=0 F  S SB=$O(^BSTS(9002318.4,CONCDA,13,SB)) Q:'SB  D
"RTN","BSTSDTS0",258,0)
 .. NEW DA,DIK
"RTN","BSTSDTS0",259,0)
 .. S DA(1)=CONCDA,DA=SB
"RTN","BSTSDTS0",260,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",13," D ^DIK
"RTN","BSTSDTS0",261,0)
 ;
"RTN","BSTSDTS0",262,0)
 ;Now save mappings
"RTN","BSTSDTS0",263,0)
 I $D(@GL@("RICD9"))>1 D
"RTN","BSTSDTS0",264,0)
 . ;
"RTN","BSTSDTS0",265,0)
 . NEW SB
"RTN","BSTSDTS0",266,0)
 . S SB="" F  S SB=$O(@GL@("RICD9",SB)) Q:SB=""  D
"RTN","BSTSDTS0",267,0)
 .. ;
"RTN","BSTSDTS0",268,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS0",269,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS0",270,0)
 .. S DIC(0)="LX",DIC="^BSTS(9002318.4,"_DA(1)_",13,"
"RTN","BSTSDTS0",271,0)
 .. S X=$P($G(@GL@("RICD9",SB)),U) Q:X=""
"RTN","BSTSDTS0",272,0)
 .. S DLAYGO=9002318.413 D ^DIC
"RTN","BSTSDTS0",273,0)
 ;
"RTN","BSTSDTS0",274,0)
 I $D(BSTSC) D FILE^DIE("","BSTSC","ERROR")
"RTN","BSTSDTS0",275,0)
 ;
"RTN","BSTSDTS0",276,0)
 ;Now save Terminology entries
"RTN","BSTSDTS0",277,0)
 ;
"RTN","BSTSDTS0",278,0)
 ;Synonyms/Preferred/FSN
"RTN","BSTSDTS0",279,0)
 ;
"RTN","BSTSDTS0",280,0)
 S TCNT="" F  S TCNT=$O(@GL@("SYN",TCNT)) Q:TCNT=""  D
"RTN","BSTSDTS0",281,0)
 . ;
"RTN","BSTSDTS0",282,0)
 . N TERM,TYPE,DESC,BSTST,ERROR,TMIEN,AIN
"RTN","BSTSDTS0",283,0)
 . ;
"RTN","BSTSDTS0",284,0)
 . ;Pull values
"RTN","BSTSDTS0",285,0)
 . S TERM=$G(@GL@("SYN",TCNT,1)) Q:TERM=""
"RTN","BSTSDTS0",286,0)
 . S TYPE=$P($G(@GL@("SYN",TCNT,0)),U,2)
"RTN","BSTSDTS0",287,0)
 . S TYPE=$S(TYPE=1:"P",1:"S")
"RTN","BSTSDTS0",288,0)
 . I TERM=$G(@GL@("FSN",1)) S TYPE="F"
"RTN","BSTSDTS0",289,0)
 . S DESC=$P($G(@GL@("SYN",TCNT,0)),U) Q:DESC=""
"RTN","BSTSDTS0",290,0)
 . S AIN=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("SYN",TCNT,0)),U,3))
"RTN","BSTSDTS0",291,0)
 . ;
"RTN","BSTSDTS0",292,0)
 . ;Look up entry
"RTN","BSTSDTS0",293,0)
 . S TMIEN=$O(^BSTS(9002318.3,"D",INMID,DESC,""))
"RTN","BSTSDTS0",294,0)
 . ;
"RTN","BSTSDTS0",295,0)
 . ;Entry not found - create new one
"RTN","BSTSDTS0",296,0)
 . I TMIEN="" S TMIEN=$$NEWT()
"RTN","BSTSDTS0",297,0)
 . I TMIEN<0 Q
"RTN","BSTSDTS0",298,0)
 . ;
"RTN","BSTSDTS0",299,0)
 . ;Save/update other fields
"RTN","BSTSDTS0",300,0)
 . S BSTST(9002318.3,TMIEN_",",.02)=DESC
"RTN","BSTSDTS0",301,0)
 . S BSTST(9002318.3,TMIEN_",",.09)=TYPE
"RTN","BSTSDTS0",302,0)
 . S BSTST(9002318.3,TMIEN_",",1)=TERM
"RTN","BSTSDTS0",303,0)
 . S BSTST(9002318.3,TMIEN_",",.04)="N"
"RTN","BSTSDTS0",304,0)
 . S BSTST(9002318.3,TMIEN_",",.05)=CVRSN
"RTN","BSTSDTS0",305,0)
 . S BSTST(9002318.3,TMIEN_",",.08)=INMID
"RTN","BSTSDTS0",306,0)
 . S BSTST(9002318.3,TMIEN_",",.03)=CONCDA
"RTN","BSTSDTS0",307,0)
 . S BSTST(9002318.3,TMIEN_",",.06)=AIN
"RTN","BSTSDTS0",308,0)
 . S BSTST(9002318.3,TMIEN_",",.1)=DT
"RTN","BSTSDTS0",309,0)
 . S BSTST(9002318.3,TMIEN_",",.11)="N"
"RTN","BSTSDTS0",310,0)
 . D FILE^DIE("","BSTST","ERROR")
"RTN","BSTSDTS0",311,0)
 . ;
"RTN","BSTSDTS0",312,0)
 . ;Reindex - needed for custom indices
"RTN","BSTSDTS0",313,0)
 . D
"RTN","BSTSDTS0",314,0)
 .. NEW DIK,DA
"RTN","BSTSDTS0",315,0)
 .. S DIK="^BSTS(9002318.3,",DA=TMIEN
"RTN","BSTSDTS0",316,0)
 .. D IX^DIK
"RTN","BSTSDTS0",317,0)
 ;
"RTN","BSTSDTS0",318,0)
 ;Save ICD Mapping information
"RTN","BSTSDTS0",319,0)
 I '$D(ERROR) S STS=$$ICDMAP^BSTSDTS2(CONCDA,GL)
"RTN","BSTSDTS0",320,0)
 ;
"RTN","BSTSDTS0",321,0)
 Q $S($D(ERROR):"0^Update Failed",1:1)
"RTN","BSTSDTS0",322,0)
 ;
"RTN","BSTSDTS0",323,0)
CONC(DTSID,BSTSWS,SKPOD,SKPDT) ;EP - Determine if Code on File (and up to date)
"RTN","BSTSDTS0",324,0)
 ;
"RTN","BSTSDTS0",325,0)
 N CONC,CIEN,CONC,SNAPDT,NMID,BEGDT,ENDDT
"RTN","BSTSDTS0",326,0)
 ;
"RTN","BSTSDTS0",327,0)
 S SKPOD=$G(SKPOD) ;Set to 1 to skip out of date checking
"RTN","BSTSDTS0",328,0)
 S SKPDT=$G(SKPDT) ;Set to 1 to skip date checking
"RTN","BSTSDTS0",329,0)
 ;
"RTN","BSTSDTS0",330,0)
 ;Get namespace
"RTN","BSTSDTS0",331,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS0",332,0)
 ;
"RTN","BSTSDTS0",333,0)
 ;Pull the concept IEN
"RTN","BSTSDTS0",334,0)
 S CIEN=$O(^BSTS(9002318.4,"D",NMID,DTSID,"")) Q:CIEN="" ""
"RTN","BSTSDTS0",335,0)
 ;
"RTN","BSTSDTS0",336,0)
 ;Quit if out of date
"RTN","BSTSDTS0",337,0)
 I 'SKPOD,$$GET1^DIQ(9002318.4,CIEN_",",".11","I")="Y" Q ""
"RTN","BSTSDTS0",338,0)
 ;
"RTN","BSTSDTS0",339,0)
 ;Look in date range
"RTN","BSTSDTS0",340,0)
 S SNAPDT=$G(BSTSWS("SNAPDT")) S:SNAPDT]"" SNAPDT=$$DATE^BSTSUTIL(SNAPDT)
"RTN","BSTSDTS0",341,0)
 S:SNAPDT="" SNAPDT=DT
"RTN","BSTSDTS0",342,0)
 ;
"RTN","BSTSDTS0",343,0)
 I 'SKPDT S BEGDT=$$GET1^DIQ(9002318.4,CIEN_",",".05","I") I BEGDT]"",SNAPDT<BEGDT Q ""
"RTN","BSTSDTS0",344,0)
 ;S ENDDT=$$GET1^DIQ(9002318.4,CIEN_",",".06","I") I ENDDT]"",SNAPDT>ENDDT Q ""
"RTN","BSTSDTS0",345,0)
 ;
"RTN","BSTSDTS0",346,0)
 S CONC=$$GET1^DIQ(9002318.4,CIEN_",",".02","E")
"RTN","BSTSDTS0",347,0)
 ;
"RTN","BSTSDTS0",348,0)
 Q CONC
"RTN","BSTSDTS0",349,0)
 ;
"RTN","BSTSDTS0",350,0)
GCDSDTS4(BSTSWS) ;EP - DTS4 update codeset
"RTN","BSTSDTS0",351,0)
 ;
"RTN","BSTSDTS0",352,0)
 N RESULT,STS,II,BSTSUP,ERROR
"RTN","BSTSDTS0",353,0)
 ;
"RTN","BSTSDTS0",354,0)
 S STS=$$GCDSDTS4^BSTSCMCL(.BSTSWS,.RESULT)
"RTN","BSTSDTS0",355,0)
 ;
"RTN","BSTSDTS0",356,0)
 ;Update Local BSTS CODESET file (9002318.1)
"RTN","BSTSDTS0",357,0)
 S II="" F  S II=$O(RESULT(II),-1) Q:II=""  D
"RTN","BSTSDTS0",358,0)
 . ;
"RTN","BSTSDTS0",359,0)
 . N DIC,X,Y,DLAYGO,DIC
"RTN","BSTSDTS0",360,0)
 . S X=$G(RESULT(II,"NAMESPACE","ID")) Q:'X
"RTN","BSTSDTS0",361,0)
 . S DIC(0)="XL",DIC="^BSTS(9002318.1,",DLAYGO=9002318.1 D ^DIC
"RTN","BSTSDTS0",362,0)
 . I +Y<0 Q
"RTN","BSTSDTS0",363,0)
 . S BSTSUP(9002318.1,+Y_",",.02)=$G(RESULT(II,"NAMESPACE","CODE"))
"RTN","BSTSDTS0",364,0)
 . S BSTSUP(9002318.1,+Y_",",.03)=$G(RESULT(II,"NAMESPACE","NAME"))
"RTN","BSTSDTS0",365,0)
 I $D(BSTSUP) D FILE^DIE("","BSTSUP","ERROR")
"RTN","BSTSDTS0",366,0)
 ;
"RTN","BSTSDTS0",367,0)
 Q STS
"RTN","BSTSDTS0",368,0)
 ;
"RTN","BSTSDTS0",369,0)
GVRDTS4(BSTSWS) ;EP - DTS4 update versions
"RTN","BSTSDTS0",370,0)
 ;
"RTN","BSTSDTS0",371,0)
 N RESULT,STS
"RTN","BSTSDTS0",372,0)
 ;
"RTN","BSTSDTS0",373,0)
 ;Reset Scratch global and make call to DTS
"RTN","BSTSDTS0",374,0)
 S RESULT=$NA(^TMP("BSTSCMCL",$J))
"RTN","BSTSDTS0",375,0)
 K @RESULT
"RTN","BSTSDTS0",376,0)
 S STS=$$GVRDTS4^BSTSCMCL(.BSTSWS)
"RTN","BSTSDTS0",377,0)
 ;
"RTN","BSTSDTS0",378,0)
 ;Update file with results
"RTN","BSTSDTS0",379,0)
 I STS D
"RTN","BSTSDTS0",380,0)
 . N NMID,NMIEN,VDT,CNT,VRID,BSTS,ERR,CVID
"RTN","BSTSDTS0",381,0)
 . S NMID=$G(BSTSWS("NAMESPACEID"))
"RTN","BSTSDTS0",382,0)
 . S NMIEN=$O(^BSTS(9002318.1,"B",NMID,""),-1) Q:NMIEN=""
"RTN","BSTSDTS0",383,0)
 . S (VRID,CNT)="" F  S CNT=$O(@RESULT@(CNT),-1) Q:'CNT  D
"RTN","BSTSDTS0",384,0)
 .. S VDT="" F  S VDT=$O(@RESULT@(CNT,"VERSION",VDT)) Q:VDT=""  D
"RTN","BSTSDTS0",385,0)
 ... N RDT,NAME,DA,IENS,BSTSUP,ERROR
"RTN","BSTSDTS0",386,0)
 ... S RDT=$G(@RESULT@(CNT,"VERSION",VDT,"RELEASEDATE"))
"RTN","BSTSDTS0",387,0)
 ... S NAME=$G(@RESULT@(CNT,"VERSION",VDT,"NAME"))
"RTN","BSTSDTS0",388,0)
 ... ;
"RTN","BSTSDTS0",389,0)
 ... ;Look for existing entry
"RTN","BSTSDTS0",390,0)
 ... S DA=$O(^BSTS(9002318.1,NMIEN,1,"B",VDT,""))
"RTN","BSTSDTS0",391,0)
 ... ;
"RTN","BSTSDTS0",392,0)
 ... ;Create new record
"RTN","BSTSDTS0",393,0)
 ... S:DA="" DA=$$NEWV(NMIEN,VDT)
"RTN","BSTSDTS0",394,0)
 ... I +DA<0 Q
"RTN","BSTSDTS0",395,0)
 ... S VRID=VDT
"RTN","BSTSDTS0",396,0)
 ... S DA(1)=NMIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS0",397,0)
 ... ;
"RTN","BSTSDTS0",398,0)
 ... ;Add/Update remaining fields
"RTN","BSTSDTS0",399,0)
 ... S BSTSUP(9002318.11,IENS,".02")=NAME
"RTN","BSTSDTS0",400,0)
 ... S BSTSUP(9002318.11,IENS,".03")=RDT
"RTN","BSTSDTS0",401,0)
 ... D FILE^DIE("","BSTSUP","ERROR")
"RTN","BSTSDTS0",402,0)
 ;
"RTN","BSTSDTS0",403,0)
 Q STS
"RTN","BSTSDTS0",404,0)
 ;
"RTN","BSTSDTS0",405,0)
NEWV(NMIEN,VDT) ;Create new ICD Mapping entry
"RTN","BSTSDTS0",406,0)
 N DIC,X,Y,DA,DLAYGO
"RTN","BSTSDTS0",407,0)
 S DIC(0)="L",DA(1)=NMIEN
"RTN","BSTSDTS0",408,0)
 S DLAYGO=9002318.11,DIC="^BSTS(9002318.1,"_DA(1)_",1,"
"RTN","BSTSDTS0",409,0)
 S X=VDT
"RTN","BSTSDTS0",410,0)
 D ^DIC
"RTN","BSTSDTS0",411,0)
 Q +Y
"RTN","BSTSDTS0",412,0)
 ;
"RTN","BSTSDTS0",413,0)
 ;
"RTN","BSTSDTS0",414,0)
NEWC() ;Create new concept entry
"RTN","BSTSDTS0",415,0)
 N DIC,X,Y,DLAYGO
"RTN","BSTSDTS0",416,0)
 S DIC(0)="L",DIC=9002318.4
"RTN","BSTSDTS0",417,0)
 L +^BSTS(9002318.4,0):1 E  Q ""
"RTN","BSTSDTS0",418,0)
 S X=$P($G(^BSTS(9002318.4,0)),U,3)+1
"RTN","BSTSDTS0",419,0)
 S DLAYGO=9002318.4 D ^DIC
"RTN","BSTSDTS0",420,0)
 L -^BSTS(9002318.4,0)
"RTN","BSTSDTS0",421,0)
 Q +Y
"RTN","BSTSDTS0",422,0)
 ;
"RTN","BSTSDTS0",423,0)
NEWT() ;Create new terminology entry
"RTN","BSTSDTS0",424,0)
 N DIC,X,Y,DLAYGO
"RTN","BSTSDTS0",425,0)
 S DIC(0)="L",DIC=9002318.3
"RTN","BSTSDTS0",426,0)
 L +^BSTS(9002318.3,0):1 E  Q ""
"RTN","BSTSDTS0",427,0)
 S X=$P($G(^BSTS(9002318.3,0)),U,3)+1
"RTN","BSTSDTS0",428,0)
 S DLAYGO=9002318.3 D ^DIC
"RTN","BSTSDTS0",429,0)
 L -^BSTS(9002318.3,0)
"RTN","BSTSDTS0",430,0)
 Q +Y
"RTN","BSTSDTS0",431,0)
 ;
"RTN","BSTSDTS0",432,0)
NEWI(CIEN) ;Create new ICD Mapping entry
"RTN","BSTSDTS0",433,0)
 N DIC,X,Y,DA,DLAYGO
"RTN","BSTSDTS0",434,0)
 S DIC(0)="L",DA(1)=CIEN
"RTN","BSTSDTS0",435,0)
 S DIC="^BSTS(9002318.4,"_DA(1)_",3,"
"RTN","BSTSDTS0",436,0)
 L +^BSTS(9002318.4,CIEN,3,0):1 E  Q ""
"RTN","BSTSDTS0",437,0)
 S X=$P($G(^BSTS(9002318.4,CIEN,3,0)),U,3)+1
"RTN","BSTSDTS0",438,0)
 S DLAYGO=9002318.43 D ^DIC
"RTN","BSTSDTS0",439,0)
 L -^BSTS(9002318.4,CIEN,3,0)
"RTN","BSTSDTS0",440,0)
 Q +Y
"RTN","BSTSDTS1")
0^12^B192539951
"RTN","BSTSDTS1",1,0)
BSTSDTS1 ;GDIT/HS/BEE-Standard Terminology DTS Calls/Processing ;26-Jun-2015 18:12;DKM
"RTN","BSTSDTS1",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSDTS1",3,0)
 ;
"RTN","BSTSDTS1",4,0)
 Q
"RTN","BSTSDTS1",5,0)
 ;
"RTN","BSTSDTS1",6,0)
DTSSR(OUT,BSTSWS) ;EP - DTS4 Call - DTS Id Lookup
"RTN","BSTSDTS1",7,0)
 ;
"RTN","BSTSDTS1",8,0)
 N STYPE,DLIST,NMID,DTSID,STATUS,STS,CONC,RSLT,ERSLT
"RTN","BSTSDTS1",9,0)
 ;
"RTN","BSTSDTS1",10,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS1",11,0)
 ;
"RTN","BSTSDTS1",12,0)
 ;Set up and reset return list
"RTN","BSTSDTS1",13,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J))
"RTN","BSTSDTS1",14,0)
 K @DLIST
"RTN","BSTSDTS1",15,0)
 ;
"RTN","BSTSDTS1",16,0)
 ;Determine maximum to return
"RTN","BSTSDTS1",17,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS1",18,0)
 ;
"RTN","BSTSDTS1",19,0)
 ;Loop through results and retrieve detail
"RTN","BSTSDTS1",20,0)
 S DTSID=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS1",21,0)
 ;
"RTN","BSTSDTS1",22,0)
 ;Update entry
"RTN","BSTSDTS1",23,0)
 S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS1",24,0)
 ;
"RTN","BSTSDTS1",25,0)
 ;Get Detail for concept
"RTN","BSTSDTS1",26,0)
 S STS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS1",27,0)
 I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS1",28,0)
 ;
"RTN","BSTSDTS1",29,0)
 ;File the Detail
"RTN","BSTSDTS1",30,0)
 S STATUS=$$UPDATE^BSTSDTS0(NMID)
"RTN","BSTSDTS1",31,0)
 ;
"RTN","BSTSDTS1",32,0)
 ;Look again to see if concept now logged
"RTN","BSTSDTS1",33,0)
 S CONC=$$CONC^BSTSDTS0(DTSID,NMID)
"RTN","BSTSDTS1",34,0)
 I CONC]"" S @OUT@(1)=CONC_U_DTSID
"RTN","BSTSDTS1",35,0)
 ;
"RTN","BSTSDTS1",36,0)
 Q STS
"RTN","BSTSDTS1",37,0)
 ;
"RTN","BSTSDTS1",38,0)
TSRCH(OUT,BSTSWS) ;EP - DTS4 Test Search Call
"RTN","BSTSDTS1",39,0)
 ;
"RTN","BSTSDTS1",40,0)
 N II,STS,SEARCH,STYPE,WORD,MAX,DTSID,NMID,CSTS
"RTN","BSTSDTS1",41,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,TIME,ERR
"RTN","BSTSDTS1",42,0)
 ;
"RTN","BSTSDTS1",43,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS1",44,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS1",45,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS1",46,0)
 K @DLIST
"RTN","BSTSDTS1",47,0)
 ;
"RTN","BSTSDTS1",48,0)
 ;Determine maximum to return
"RTN","BSTSDTS1",49,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS1",50,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS1",51,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS1",52,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS1",53,0)
 S BSTSWS("SNAPDT")=$$FMTE^BSTSUTIL(DT_".2400")
"RTN","BSTSDTS1",54,0)
 ;
"RTN","BSTSDTS1",55,0)
 ;Perform search
"RTN","BSTSDTS1",56,0)
 S TIME=0,ERR=0,STS=""
"RTN","BSTSDTS1",57,0)
 ;
"RTN","BSTSDTS1",58,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSDTS1",59,0)
 ;
"RTN","BSTSDTS1",60,0)
 ;FSN Search
"RTN","BSTSDTS1",61,0)
 S CSTS=$$TRMSRCH^BSTSCMCL(.BSTSWS,.RES)
"RTN","BSTSDTS1",62,0)
 ;
"RTN","BSTSDTS1",63,0)
 I $P(CSTS,U,2)]"" S ERR=1
"RTN","BSTSDTS1",64,0)
 S $P(STS,U)=$P(CSTS,U)
"RTN","BSTSDTS1",65,0)
 S $P(STS,U,2)=$P(CSTS,U,2)
"RTN","BSTSDTS1",66,0)
 S $P(STS,U,3)=$P(STS,U,3)+$P(CSTS,U,3)
"RTN","BSTSDTS1",67,0)
 ;
"RTN","BSTSDTS1",68,0)
 Q STS
"RTN","BSTSDTS1",69,0)
 ;
"RTN","BSTSDTS1",70,0)
UUPDATE(NMID,ROUT) ;EP - Add/Update UNII Concept and Term(s)
"RTN","BSTSDTS1",71,0)
 ;
"RTN","BSTSDTS1",72,0)
 ;This update section only applies to UNII
"RTN","BSTSDTS1",73,0)
 I $G(NMID)'=5180 Q 1
"RTN","BSTSDTS1",74,0)
 ;
"RTN","BSTSDTS1",75,0)
 N GL,CONCDA,BSTSC,INMID,ERROR,TCNT,I,CVRSN,ST,NROUT
"RTN","BSTSDTS1",76,0)
 ;
"RTN","BSTSDTS1",77,0)
 S GL=$NA(^TMP("BSTSCMCL",$J,1))
"RTN","BSTSDTS1",78,0)
 S ROUT=$G(ROUT,"")
"RTN","BSTSDTS1",79,0)
 ;
"RTN","BSTSDTS1",80,0)
 ;Look for Concept Id
"RTN","BSTSDTS1",81,0)
 I $P($G(@GL@("CONCEPTID")),U)="" Q 0
"RTN","BSTSDTS1",82,0)
 ;
"RTN","BSTSDTS1",83,0)
 ;Look for existing entry
"RTN","BSTSDTS1",84,0)
 I $G(@GL@("DTSID"))="" Q 0
"RTN","BSTSDTS1",85,0)
 S CONCDA=$O(^BSTS(9002318.4,"D",NMID,@GL@("DTSID"),""))
"RTN","BSTSDTS1",86,0)
 ;
"RTN","BSTSDTS1",87,0)
 ;None found - create new entry
"RTN","BSTSDTS1",88,0)
 I CONCDA="" S CONCDA=$$NEWC^BSTSDTS0()
"RTN","BSTSDTS1",89,0)
 ;
"RTN","BSTSDTS1",90,0)
 ;Verify entry found/created
"RTN","BSTSDTS1",91,0)
 I +CONCDA<0 Q 0
"RTN","BSTSDTS1",92,0)
 ;
"RTN","BSTSDTS1",93,0)
 ;Pull internal Code Set ID
"RTN","BSTSDTS1",94,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) Q:INMID="" "0"
"RTN","BSTSDTS1",95,0)
 ;
"RTN","BSTSDTS1",96,0)
 ;Pull the current version
"RTN","BSTSDTS1",97,0)
 S CVRSN=$$GET1^DIQ(9002318.1,INMID_",",.04,"I")
"RTN","BSTSDTS1",98,0)
 ;
"RTN","BSTSDTS1",99,0)
 ;Get Revision Out
"RTN","BSTSDTS1",100,0)
 S NROUT=$P(@GL@("CONCEPTID"),U,3) S:NROUT="" NROUT=ROUT
"RTN","BSTSDTS1",101,0)
 ;
"RTN","BSTSDTS1",102,0)
 ;Set up top level concept fields
"RTN","BSTSDTS1",103,0)
 S BSTSC(9002318.4,CONCDA_",",.02)=$P(@GL@("CONCEPTID"),U) ;Concept ID
"RTN","BSTSDTS1",104,0)
 S BSTSC(9002318.4,CONCDA_",",.08)=@GL@("DTSID") ;DTS ID
"RTN","BSTSDTS1",105,0)
 S BSTSC(9002318.4,CONCDA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS1",106,0)
 S BSTSC(9002318.4,CONCDA_",",.03)="N"
"RTN","BSTSDTS1",107,0)
 S BSTSC(9002318.4,CONCDA_",",.05)=$$EP2FMDT^BSTSUTIL($P(@GL@("CONCEPTID"),U,2),1)
"RTN","BSTSDTS1",108,0)
 S BSTSC(9002318.4,CONCDA_",",.06)=$$EP2FMDT^BSTSUTIL(NROUT,1)
"RTN","BSTSDTS1",109,0)
 S BSTSC(9002318.4,CONCDA_",",.11)="N"
"RTN","BSTSDTS1",110,0)
 S BSTSC(9002318.4,CONCDA_",",.04)=CVRSN
"RTN","BSTSDTS1",111,0)
 S BSTSC(9002318.4,CONCDA_",",.12)=DT
"RTN","BSTSDTS1",112,0)
 S BSTSC(9002318.4,CONCDA_",",1)=$G(@GL@("FSN",1))
"RTN","BSTSDTS1",113,0)
 ;
"RTN","BSTSDTS1",114,0)
 ;Save ISA
"RTN","BSTSDTS1",115,0)
 I $D(@GL@("ISA"))>1 D
"RTN","BSTSDTS1",116,0)
 . ;
"RTN","BSTSDTS1",117,0)
 . N ISACT
"RTN","BSTSDTS1",118,0)
 . S ISACT="" F  S ISACT=$O(@GL@("ISA",ISACT)) Q:ISACT=""  D
"RTN","BSTSDTS1",119,0)
 .. ;
"RTN","BSTSDTS1",120,0)
 .. ;Save/update each ISA entry
"RTN","BSTSDTS1",121,0)
 .. ;
"RTN","BSTSDTS1",122,0)
 .. ;First see if IsA code has been saved
"RTN","BSTSDTS1",123,0)
 .. N DAISA,DA,IENS,DTSID,ISACD,NEWISA,DIC,Y,X,DLAYGO
"RTN","BSTSDTS1",124,0)
 .. S ISACD=$P($G(@GL@("ISA",ISACT,0)),U) Q:ISACD=""
"RTN","BSTSDTS1",125,0)
 .. S (NEWISA,DAISA)=$O(^BSTS(9002318.4,"D",NMID,ISACD,""))
"RTN","BSTSDTS1",126,0)
 .. ;
"RTN","BSTSDTS1",127,0)
 .. ;Not found - add partial entry to concept file
"RTN","BSTSDTS1",128,0)
 .. I DAISA="" S DAISA=$$NEWC^BSTSDTS0()
"RTN","BSTSDTS1",129,0)
 .. S BSTSC(9002318.4,DAISA_",",.08)=$G(ISACD)
"RTN","BSTSDTS1",130,0)
 .. I NEWISA="" S BSTSC(9002318.4,DAISA_",",.03)="P"
"RTN","BSTSDTS1",131,0)
 .. S BSTSC(9002318.4,DAISA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS1",132,0)
 .. S BSTSC(9002318.4,DAISA_",",.04)=CVRSN ;Version
"RTN","BSTSDTS1",133,0)
 .. S BSTSC(9002318.4,DAISA_",",.11)="N" ;Up to Date
"RTN","BSTSDTS1",134,0)
 .. S BSTSC(9002318.4,DAISA_",",.12)=DT ;Update Date
"RTN","BSTSDTS1",135,0)
 .. S BSTSC(9002318.4,DAISA_",",1)=$G(@GL@("ISA",ISACT,1))
"RTN","BSTSDTS1",136,0)
 .. ;
"RTN","BSTSDTS1",137,0)
 .. ;Now add IsA pointer in current concept entry
"RTN","BSTSDTS1",138,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS1",139,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",5,",X=DAISA
"RTN","BSTSDTS1",140,0)
 .. S DLAYGO=9002318.45 D ^DIC I +Y<0 Q
"RTN","BSTSDTS1",141,0)
 .. ;
"RTN","BSTSDTS1",142,0)
 .. ;Save additional IsA fields
"RTN","BSTSDTS1",143,0)
 .. S DA(1)=CONCDA,DA=+Y,IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS1",144,0)
 .. S BSTSC(9002318.45,IENS,".02")=$$EP2FMDT^BSTSUTIL($P($G(@GL@("ISA",ISACT,1,0)),U,2))
"RTN","BSTSDTS1",145,0)
 ;
"RTN","BSTSDTS1",146,0)
 I $D(BSTSC) D FILE^DIE("","BSTSC","ERROR")
"RTN","BSTSDTS1",147,0)
 ;
"RTN","BSTSDTS1",148,0)
 ;Now save Terminology entries
"RTN","BSTSDTS1",149,0)
 ;
"RTN","BSTSDTS1",150,0)
 ;Synonyms/Preferred/FSN
"RTN","BSTSDTS1",151,0)
 ;
"RTN","BSTSDTS1",152,0)
 S TCNT="" F  S TCNT=$O(@GL@("SYN",TCNT)) Q:TCNT=""  D
"RTN","BSTSDTS1",153,0)
 . ;
"RTN","BSTSDTS1",154,0)
 . N TERM,TYPE,DESC,BSTST,ERROR,TMIEN,AIN
"RTN","BSTSDTS1",155,0)
 . ;
"RTN","BSTSDTS1",156,0)
 . ;Pull values
"RTN","BSTSDTS1",157,0)
 . S TERM=$G(@GL@("SYN",TCNT,1)) Q:TERM=""
"RTN","BSTSDTS1",158,0)
 . S TYPE=$P($G(@GL@("SYN",TCNT,0)),U,2)
"RTN","BSTSDTS1",159,0)
 . S TYPE=$S(TYPE=1:"P",1:"S")
"RTN","BSTSDTS1",160,0)
 . I TERM=$G(@GL@("FSN",1)) S TYPE="F"
"RTN","BSTSDTS1",161,0)
 . S DESC=$P($G(@GL@("SYN",TCNT,0)),U) Q:DESC=""
"RTN","BSTSDTS1",162,0)
 . S AIN=$$EP2FMDT^BSTSUTIL($P($G(@GL@("SYN",TCNT,0)),U,3))
"RTN","BSTSDTS1",163,0)
 . ;
"RTN","BSTSDTS1",164,0)
 . ;Look up entry
"RTN","BSTSDTS1",165,0)
 . S TMIEN=$O(^BSTS(9002318.3,"D",INMID,DESC,""))
"RTN","BSTSDTS1",166,0)
 . ;
"RTN","BSTSDTS1",167,0)
 . ;Entry not found - create new one
"RTN","BSTSDTS1",168,0)
 . I TMIEN="" S TMIEN=$$NEWT^BSTSDTS0()
"RTN","BSTSDTS1",169,0)
 . I TMIEN<0 Q
"RTN","BSTSDTS1",170,0)
 . ;
"RTN","BSTSDTS1",171,0)
 . ;Save/update other fields
"RTN","BSTSDTS1",172,0)
 . S BSTST(9002318.3,TMIEN_",",.02)=DESC
"RTN","BSTSDTS1",173,0)
 . S BSTST(9002318.3,TMIEN_",",.09)=TYPE
"RTN","BSTSDTS1",174,0)
 . S BSTST(9002318.3,TMIEN_",",1)=TERM
"RTN","BSTSDTS1",175,0)
 . S BSTST(9002318.3,TMIEN_",",.04)="N"
"RTN","BSTSDTS1",176,0)
 . S BSTST(9002318.3,TMIEN_",",.05)=CVRSN
"RTN","BSTSDTS1",177,0)
 . S BSTST(9002318.3,TMIEN_",",.08)=INMID
"RTN","BSTSDTS1",178,0)
 . S BSTST(9002318.3,TMIEN_",",.03)=CONCDA
"RTN","BSTSDTS1",179,0)
 . S BSTST(9002318.3,TMIEN_",",.06)=AIN
"RTN","BSTSDTS1",180,0)
 . S BSTST(9002318.3,TMIEN_",",.1)=DT
"RTN","BSTSDTS1",181,0)
 . S BSTST(9002318.3,TMIEN_",",.11)="N"
"RTN","BSTSDTS1",182,0)
 . D FILE^DIE("","BSTST","ERROR")
"RTN","BSTSDTS1",183,0)
 . ;
"RTN","BSTSDTS1",184,0)
 . ;Reindex - needed for custom indices
"RTN","BSTSDTS1",185,0)
 . D
"RTN","BSTSDTS1",186,0)
 .. NEW DIK,DA
"RTN","BSTSDTS1",187,0)
 .. S DIK="^BSTS(9002318.3,",DA=TMIEN
"RTN","BSTSDTS1",188,0)
 .. D IX^DIK
"RTN","BSTSDTS1",189,0)
 ;
"RTN","BSTSDTS1",190,0)
 Q $S($D(ERROR):"0^Update Failed",1:1)
"RTN","BSTSDTS1",191,0)
 ;
"RTN","BSTSDTS1",192,0)
RUPDATE(NMID,ROUT) ;EP - Add/Update RXNORM Concept and Term(s)
"RTN","BSTSDTS1",193,0)
 ;
"RTN","BSTSDTS1",194,0)
 ;This update section only applies to RXNORM
"RTN","BSTSDTS1",195,0)
 I $G(NMID)'=1552 Q 1
"RTN","BSTSDTS1",196,0)
 ;
"RTN","BSTSDTS1",197,0)
 N GL,CONCDA,BSTSC,INMID,ERROR,TCNT,I,CVRSN,ST,NROUT
"RTN","BSTSDTS1",198,0)
 ;
"RTN","BSTSDTS1",199,0)
 S GL=$NA(^TMP("BSTSCMCL",$J,1))
"RTN","BSTSDTS1",200,0)
 S ROUT=$G(ROUT,"")
"RTN","BSTSDTS1",201,0)
 ;
"RTN","BSTSDTS1",202,0)
 ;Look for Concept Id
"RTN","BSTSDTS1",203,0)
 I $P($G(@GL@("CONCEPTID")),U)="" Q 0
"RTN","BSTSDTS1",204,0)
 ;
"RTN","BSTSDTS1",205,0)
 ;Look for existing entry
"RTN","BSTSDTS1",206,0)
 I $G(@GL@("DTSID"))="" Q 0
"RTN","BSTSDTS1",207,0)
 S CONCDA=$O(^BSTS(9002318.4,"D",NMID,@GL@("DTSID"),""))
"RTN","BSTSDTS1",208,0)
 ;
"RTN","BSTSDTS1",209,0)
 ;None found - create new entry
"RTN","BSTSDTS1",210,0)
 I CONCDA="" S CONCDA=$$NEWC^BSTSDTS0()
"RTN","BSTSDTS1",211,0)
 ;
"RTN","BSTSDTS1",212,0)
 ;Verify entry found/created
"RTN","BSTSDTS1",213,0)
 I +CONCDA<0 Q 0
"RTN","BSTSDTS1",214,0)
 ;
"RTN","BSTSDTS1",215,0)
 ;Pull internal Code Set ID
"RTN","BSTSDTS1",216,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) Q:INMID="" "0"
"RTN","BSTSDTS1",217,0)
 ;
"RTN","BSTSDTS1",218,0)
 ;Pull the current version
"RTN","BSTSDTS1",219,0)
 S CVRSN=$$GET1^DIQ(9002318.1,INMID_",",.04,"I")
"RTN","BSTSDTS1",220,0)
 ;
"RTN","BSTSDTS1",221,0)
 ;Get Revision Out
"RTN","BSTSDTS1",222,0)
 S NROUT=$P(@GL@("CONCEPTID"),U,3) S:NROUT="" NROUT=ROUT
"RTN","BSTSDTS1",223,0)
 ;
"RTN","BSTSDTS1",224,0)
 ;Set up top level concept fields
"RTN","BSTSDTS1",225,0)
 S BSTSC(9002318.4,CONCDA_",",.02)=$P(@GL@("CONCEPTID"),U) ;Concept ID
"RTN","BSTSDTS1",226,0)
 S BSTSC(9002318.4,CONCDA_",",.08)=@GL@("DTSID") ;DTS ID
"RTN","BSTSDTS1",227,0)
 S BSTSC(9002318.4,CONCDA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS1",228,0)
 S BSTSC(9002318.4,CONCDA_",",.03)="N"
"RTN","BSTSDTS1",229,0)
 S BSTSC(9002318.4,CONCDA_",",.05)=$$EP2FMDT^BSTSUTIL($P(@GL@("CONCEPTID"),U,2),1)
"RTN","BSTSDTS1",230,0)
 S BSTSC(9002318.4,CONCDA_",",.06)=$$EP2FMDT^BSTSUTIL(NROUT,1)
"RTN","BSTSDTS1",231,0)
 S BSTSC(9002318.4,CONCDA_",",.11)="N"
"RTN","BSTSDTS1",232,0)
 S BSTSC(9002318.4,CONCDA_",",.04)=CVRSN
"RTN","BSTSDTS1",233,0)
 S BSTSC(9002318.4,CONCDA_",",.12)=DT
"RTN","BSTSDTS1",234,0)
 S BSTSC(9002318.4,CONCDA_",",1)=$G(@GL@("FSN",1))
"RTN","BSTSDTS1",235,0)
 ;
"RTN","BSTSDTS1",236,0)
 ;Save ISA
"RTN","BSTSDTS1",237,0)
 I $D(@GL@("ISA"))>1 D
"RTN","BSTSDTS1",238,0)
 . ;
"RTN","BSTSDTS1",239,0)
 . N ISACT
"RTN","BSTSDTS1",240,0)
 . S ISACT="" F  S ISACT=$O(@GL@("ISA",ISACT)) Q:ISACT=""  D
"RTN","BSTSDTS1",241,0)
 .. ;
"RTN","BSTSDTS1",242,0)
 .. ;Save/update each ISA entry
"RTN","BSTSDTS1",243,0)
 .. ;
"RTN","BSTSDTS1",244,0)
 .. ;First see if IsA code has been saved
"RTN","BSTSDTS1",245,0)
 .. N DAISA,DA,IENS,DTSID,ISACD,NEWISA,DIC,Y,X,DLAYGO
"RTN","BSTSDTS1",246,0)
 .. S ISACD=$P($G(@GL@("ISA",ISACT,0)),U) Q:ISACD=""
"RTN","BSTSDTS1",247,0)
 .. S (NEWISA,DAISA)=$O(^BSTS(9002318.4,"D",NMID,ISACD,""))
"RTN","BSTSDTS1",248,0)
 .. ;
"RTN","BSTSDTS1",249,0)
 .. ;Not found - add partial entry to concept file
"RTN","BSTSDTS1",250,0)
 .. I DAISA="" S DAISA=$$NEWC^BSTSDTS0()
"RTN","BSTSDTS1",251,0)
 .. S BSTSC(9002318.4,DAISA_",",.08)=$G(ISACD)
"RTN","BSTSDTS1",252,0)
 .. I NEWISA="" S BSTSC(9002318.4,DAISA_",",.03)="P"
"RTN","BSTSDTS1",253,0)
 .. S BSTSC(9002318.4,DAISA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS1",254,0)
 .. S BSTSC(9002318.4,DAISA_",",.04)=CVRSN ;Version
"RTN","BSTSDTS1",255,0)
 .. S BSTSC(9002318.4,DAISA_",",.11)="N" ;Up to Date
"RTN","BSTSDTS1",256,0)
 .. S BSTSC(9002318.4,DAISA_",",.12)=DT ;Update Date
"RTN","BSTSDTS1",257,0)
 .. S BSTSC(9002318.4,DAISA_",",1)=$G(@GL@("ISA",ISACT,1))
"RTN","BSTSDTS1",258,0)
 .. ;
"RTN","BSTSDTS1",259,0)
 .. ;Now add IsA pointer in current concept entry
"RTN","BSTSDTS1",260,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS1",261,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",5,",X=DAISA
"RTN","BSTSDTS1",262,0)
 .. S DLAYGO=9002318.45 D ^DIC I +Y<0 Q
"RTN","BSTSDTS1",263,0)
 .. ;
"RTN","BSTSDTS1",264,0)
 .. ;Save additional IsA fields
"RTN","BSTSDTS1",265,0)
 .. S DA(1)=CONCDA,DA=+Y,IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS1",266,0)
 .. S BSTSC(9002318.45,IENS,".02")=$$EP2FMDT^BSTSUTIL($P($G(@GL@("ISA",ISACT,1,0)),U,2))
"RTN","BSTSDTS1",267,0)
 ;
"RTN","BSTSDTS1",268,0)
 ;Save Inverse Associations
"RTN","BSTSDTS1",269,0)
 ;
"RTN","BSTSDTS1",270,0)
 ;Clear out existing entries
"RTN","BSTSDTS1",271,0)
 D
"RTN","BSTSDTS1",272,0)
 . NEW AS
"RTN","BSTSDTS1",273,0)
 . S AS=0 F  S AS=$O(^BSTS(9002318.4,CONCDA,11,AS)) Q:'AS  D
"RTN","BSTSDTS1",274,0)
 .. NEW DA,DIK
"RTN","BSTSDTS1",275,0)
 .. S DA(1)=CONCDA,DA=AS
"RTN","BSTSDTS1",276,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",11," D ^DIK
"RTN","BSTSDTS1",277,0)
 I $D(@GL@("IAS"))>1 D
"RTN","BSTSDTS1",278,0)
 . ;
"RTN","BSTSDTS1",279,0)
 . ;
"RTN","BSTSDTS1",280,0)
 . NEW AS
"RTN","BSTSDTS1",281,0)
 . S AS="" F  S AS=$O(@GL@("IAS",AS)) Q:AS=""  D
"RTN","BSTSDTS1",282,0)
 .. ;
"RTN","BSTSDTS1",283,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS1",284,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS1",285,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",11,"
"RTN","BSTSDTS1",286,0)
 .. S X=$P($G(@GL@("IAS",AS)),U) Q:X=""
"RTN","BSTSDTS1",287,0)
 .. S DLAYGO=9002318.411 D ^DIC
"RTN","BSTSDTS1",288,0)
 .. I +Y<0 Q
"RTN","BSTSDTS1",289,0)
 .. S DA=+Y
"RTN","BSTSDTS1",290,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS1",291,0)
 .. S BSTSC(9002318.411,IENS,".02")=$P($G(@GL@("IAS",AS)),U,2)
"RTN","BSTSDTS1",292,0)
 .. S BSTSC(9002318.411,IENS,".03")=$P($G(@GL@("IAS",AS)),U,3)
"RTN","BSTSDTS1",293,0)
 .. S BSTSC(9002318.411,IENS,".04")=$P($G(@GL@("IAS",AS)),U,4)
"RTN","BSTSDTS1",294,0)
 ;
"RTN","BSTSDTS1",295,0)
 ;Save NDC
"RTN","BSTSDTS1",296,0)
 ;
"RTN","BSTSDTS1",297,0)
 ;Clear out existing entries
"RTN","BSTSDTS1",298,0)
 D
"RTN","BSTSDTS1",299,0)
 . NEW NDC
"RTN","BSTSDTS1",300,0)
 . S NDC=0 F  S NDC=$O(^BSTS(9002318.4,CONCDA,7,NDC)) Q:'NDC  D
"RTN","BSTSDTS1",301,0)
 .. NEW DA,DIK
"RTN","BSTSDTS1",302,0)
 .. S DA(1)=CONCDA,DA=NDC
"RTN","BSTSDTS1",303,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",7," D ^DIK
"RTN","BSTSDTS1",304,0)
 I $D(@GL@("NDC"))>1 D
"RTN","BSTSDTS1",305,0)
 . ;
"RTN","BSTSDTS1",306,0)
 . NEW NDC
"RTN","BSTSDTS1",307,0)
 . S NDC="" F  S NDC=$O(@GL@("NDC",NDC)) Q:NDC=""  D
"RTN","BSTSDTS1",308,0)
 .. ;
"RTN","BSTSDTS1",309,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS1",310,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS1",311,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",7,"
"RTN","BSTSDTS1",312,0)
 .. S X=$P($G(@GL@("NDC",NDC)),U) Q:X=""
"RTN","BSTSDTS1",313,0)
 .. S DLAYGO=9002318.47 D ^DIC
"RTN","BSTSDTS1",314,0)
 .. I +Y<0 Q
"RTN","BSTSDTS1",315,0)
 .. S DA=+Y
"RTN","BSTSDTS1",316,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS1",317,0)
 .. S BSTSC(9002318.47,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("NDC",NDC)),U,2))
"RTN","BSTSDTS1",318,0)
 .. S BSTSC(9002318.47,IENS,".03")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("NDC",NDC)),U,3))
"RTN","BSTSDTS1",319,0)
 ;
"RTN","BSTSDTS1",320,0)
 ;Save VUID
"RTN","BSTSDTS1",321,0)
 ;
"RTN","BSTSDTS1",322,0)
 ;Clear out existing entries
"RTN","BSTSDTS1",323,0)
 D
"RTN","BSTSDTS1",324,0)
 . NEW VD
"RTN","BSTSDTS1",325,0)
 . S VD=0 F  S VD=$O(^BSTS(9002318.4,CONCDA,8,VD)) Q:'VD  D
"RTN","BSTSDTS1",326,0)
 .. NEW DA,DIK
"RTN","BSTSDTS1",327,0)
 .. S DA(1)=CONCDA,DA=VD
"RTN","BSTSDTS1",328,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",8," D ^DIK
"RTN","BSTSDTS1",329,0)
 I $D(@GL@("VUID"))>1 D
"RTN","BSTSDTS1",330,0)
 . ;
"RTN","BSTSDTS1",331,0)
 . NEW VD
"RTN","BSTSDTS1",332,0)
 . S VD="" F  S VD=$O(@GL@("VUID",VD)) Q:VD=""  D
"RTN","BSTSDTS1",333,0)
 .. ;
"RTN","BSTSDTS1",334,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS1",335,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS1",336,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",8,"
"RTN","BSTSDTS1",337,0)
 .. S X=$P($G(@GL@("VUID",VD)),U) Q:X=""
"RTN","BSTSDTS1",338,0)
 .. S DLAYGO=9002318.48 D ^DIC
"RTN","BSTSDTS1",339,0)
 .. I +Y<0 Q
"RTN","BSTSDTS1",340,0)
 .. S DA=+Y
"RTN","BSTSDTS1",341,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS1",342,0)
 .. S BSTSC(9002318.48,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("VUID",VD)),U,2))
"RTN","BSTSDTS1",343,0)
 .. S BSTSC(9002318.48,IENS,".03")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("VUID",VD)),U,3))
"RTN","BSTSDTS1",344,0)
 ;
"RTN","BSTSDTS1",345,0)
 ;Save TTY
"RTN","BSTSDTS1",346,0)
 ;
"RTN","BSTSDTS1",347,0)
 ;Clear out existing entries
"RTN","BSTSDTS1",348,0)
 D
"RTN","BSTSDTS1",349,0)
 . NEW TTY
"RTN","BSTSDTS1",350,0)
 . S TTY=0 F  S NDC=$O(^BSTS(9002318.4,CONCDA,12,TTY)) Q:'TTY  D
"RTN","BSTSDTS1",351,0)
 .. NEW DA,DIK
"RTN","BSTSDTS1",352,0)
 .. S DA(1)=CONCDA,DA=TTY
"RTN","BSTSDTS1",353,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",12," D ^DIK
"RTN","BSTSDTS1",354,0)
 I $D(@GL@("TTY"))>1 D
"RTN","BSTSDTS1",355,0)
 . ;
"RTN","BSTSDTS1",356,0)
 . NEW TTY
"RTN","BSTSDTS1",357,0)
 . S TTY="" F  S TTY=$O(@GL@("TTY",TTY)) Q:TTY=""  D
"RTN","BSTSDTS1",358,0)
 .. ;
"RTN","BSTSDTS1",359,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS1",360,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS1",361,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",12,"
"RTN","BSTSDTS1",362,0)
 .. S X=$P($G(@GL@("TTY",TTY)),U) Q:X=""
"RTN","BSTSDTS1",363,0)
 .. S DLAYGO=9002318.412 D ^DIC
"RTN","BSTSDTS1",364,0)
 .. I +Y<0 Q
"RTN","BSTSDTS1",365,0)
 .. S DA=+Y
"RTN","BSTSDTS1",366,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS1",367,0)
 .. S BSTSC(9002318.412,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("TTY",TTY)),U,2))
"RTN","BSTSDTS1",368,0)
 .. S BSTSC(9002318.412,IENS,".03")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("TTY",TTY)),U,3))
"RTN","BSTSDTS1",369,0)
 ;
"RTN","BSTSDTS1",370,0)
 I $D(BSTSC) D FILE^DIE("","BSTSC","ERROR")
"RTN","BSTSDTS1",371,0)
 ;
"RTN","BSTSDTS1",372,0)
 ;Reindex - needed for custom indices
"RTN","BSTSDTS1",373,0)
 D
"RTN","BSTSDTS1",374,0)
 . NEW DIK,DA
"RTN","BSTSDTS1",375,0)
 . S DIK="^BSTS(9002318.4,",DA=CONCDA
"RTN","BSTSDTS1",376,0)
 . D IX^DIK
"RTN","BSTSDTS1",377,0)
 ;
"RTN","BSTSDTS1",378,0)
 ;Now save Terminology entries
"RTN","BSTSDTS1",379,0)
 ;
"RTN","BSTSDTS1",380,0)
 ;Synonyms/Preferred/FSN
"RTN","BSTSDTS1",381,0)
 ;
"RTN","BSTSDTS1",382,0)
 S TCNT="" F  S TCNT=$O(@GL@("SYN",TCNT)) Q:TCNT=""  D
"RTN","BSTSDTS1",383,0)
 . ;
"RTN","BSTSDTS1",384,0)
 . N TERM,TYPE,DESC,BSTST,ERROR,TMIEN,AIN
"RTN","BSTSDTS1",385,0)
 . ;
"RTN","BSTSDTS1",386,0)
 . ;Pull values
"RTN","BSTSDTS1",387,0)
 . S TERM=$G(@GL@("SYN",TCNT,1)) Q:TERM=""
"RTN","BSTSDTS1",388,0)
 . S TYPE=$P($G(@GL@("SYN",TCNT,0)),U,2)
"RTN","BSTSDTS1",389,0)
 . S TYPE=$S(TYPE=1:"P",1:"S")
"RTN","BSTSDTS1",390,0)
 . I TERM=$G(@GL@("FSN",1)) S TYPE="F"
"RTN","BSTSDTS1",391,0)
 . S DESC=$P($G(@GL@("SYN",TCNT,0)),U) Q:DESC=""
"RTN","BSTSDTS1",392,0)
 . S AIN=$$EP2FMDT^BSTSUTIL($P($G(@GL@("SYN",TCNT,0)),U,3))
"RTN","BSTSDTS1",393,0)
 . ;
"RTN","BSTSDTS1",394,0)
 . ;Look up entry
"RTN","BSTSDTS1",395,0)
 . S TMIEN=$O(^BSTS(9002318.3,"D",INMID,DESC,""))
"RTN","BSTSDTS1",396,0)
 . ;
"RTN","BSTSDTS1",397,0)
 . ;Entry not found - create new one
"RTN","BSTSDTS1",398,0)
 . I TMIEN="" S TMIEN=$$NEWT^BSTSDTS0()
"RTN","BSTSDTS1",399,0)
 . I TMIEN<0 Q
"RTN","BSTSDTS1",400,0)
 . ;
"RTN","BSTSDTS1",401,0)
 . ;Save/update other fields
"RTN","BSTSDTS1",402,0)
 . S BSTST(9002318.3,TMIEN_",",.02)=DESC
"RTN","BSTSDTS1",403,0)
 . S BSTST(9002318.3,TMIEN_",",.09)=TYPE
"RTN","BSTSDTS1",404,0)
 . S BSTST(9002318.3,TMIEN_",",1)=TERM
"RTN","BSTSDTS1",405,0)
 . S BSTST(9002318.3,TMIEN_",",.04)="N"
"RTN","BSTSDTS1",406,0)
 . S BSTST(9002318.3,TMIEN_",",.05)=CVRSN
"RTN","BSTSDTS1",407,0)
 . S BSTST(9002318.3,TMIEN_",",.08)=INMID
"RTN","BSTSDTS1",408,0)
 . S BSTST(9002318.3,TMIEN_",",.03)=CONCDA
"RTN","BSTSDTS1",409,0)
 . S BSTST(9002318.3,TMIEN_",",.06)=AIN
"RTN","BSTSDTS1",410,0)
 . S BSTST(9002318.3,TMIEN_",",.1)=DT
"RTN","BSTSDTS1",411,0)
 . S BSTST(9002318.3,TMIEN_",",.11)="N"
"RTN","BSTSDTS1",412,0)
 . D FILE^DIE("","BSTST","ERROR")
"RTN","BSTSDTS1",413,0)
 ;
"RTN","BSTSDTS1",414,0)
 Q $S($D(ERROR):"0^Update Failed",1:1)
"RTN","BSTSDTS1",415,0)
 ;
"RTN","BSTSDTS1",416,0)
DILKP(OUT,BSTSWS) ;EP - DTS4 Search Call - Drug Ingredient Lookup
"RTN","BSTSDTS1",417,0)
 ;
"RTN","BSTSDTS1",418,0)
 N II,STS,SEARCH,STYPE,MAX,DTSID,NMID
"RTN","BSTSDTS1",419,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,ST
"RTN","BSTSDTS1",420,0)
 ;
"RTN","BSTSDTS1",421,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS1",422,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS1",423,0)
 S SLIST=$NA(^TMP("BSTSPDET",$J)) ;Sorted List
"RTN","BSTSDTS1",424,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS1",425,0)
 K @SLIST,@DLIST,@OUT
"RTN","BSTSDTS1",426,0)
 ;
"RTN","BSTSDTS1",427,0)
 ;Determine maximum to return
"RTN","BSTSDTS1",428,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS1",429,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS1",430,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS1",431,0)
 S NMID=$G(BSTSWS("NAMESPACEID"))
"RTN","BSTSDTS1",432,0)
 ;
"RTN","BSTSDTS1",433,0)
 ;Perform Lookup on Concept Id
"RTN","BSTSDTS1",434,0)
 S STS=$$PTYDTS4^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS1",435,0)
 ;
"RTN","BSTSDTS1",436,0)
 ;Sort results (though there should only be one)
"RTN","BSTSDTS1",437,0)
 S DTSID="" F  S DTSID=$O(@DLIST@(DTSID)) Q:DTSID=""  S @SLIST@(@DLIST@(DTSID),DTSID)=""
"RTN","BSTSDTS1",438,0)
 ;
"RTN","BSTSDTS1",439,0)
 ;Loop through results and retrieve detail
"RTN","BSTSDTS1",440,0)
 S II="",RCNT=0 F  S II=$O(@SLIST@(II),-1) Q:II=""  D  Q:RCNT
"RTN","BSTSDTS1",441,0)
 . S DTSID="" F  S DTSID=$O(@SLIST@(II,DTSID)) Q:DTSID=""  D  Q:RCNT
"RTN","BSTSDTS1",442,0)
 .. ;
"RTN","BSTSDTS1",443,0)
 .. N STATUS,CONC,ERSLT
"RTN","BSTSDTS1",444,0)
 .. ;
"RTN","BSTSDTS1",445,0)
 .. ;Update entry
"RTN","BSTSDTS1",446,0)
 .. S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS1",447,0)
 .. ;
"RTN","BSTSDTS1",448,0)
 .. ;Clear result file
"RTN","BSTSDTS1",449,0)
 .. K @DLIST
"RTN","BSTSDTS1",450,0)
 .. ;
"RTN","BSTSDTS1",451,0)
 .. ;Get Detail for concept
"RTN","BSTSDTS1",452,0)
 .. S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS1",453,0)
 .. I $G(BSTSWS("DEBUG")) W !!,"Detail Call Status: ",STATUS
"RTN","BSTSDTS1",454,0)
 .. ;
"RTN","BSTSDTS1",455,0)
 .. ;File the Detail
"RTN","BSTSDTS1",456,0)
 .. S STATUS=$$UPDATE^BSTSDTS0(NMID)
"RTN","BSTSDTS1",457,0)
 .. I $G(BSTSWS("DEBUG")) W !!,"Update Call Status: ",STATUS
"RTN","BSTSDTS1",458,0)
 .. ;
"RTN","BSTSDTS1",459,0)
 .. ;Look to see if concept now logged
"RTN","BSTSDTS1",460,0)
 .. S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS,1,1)
"RTN","BSTSDTS1",461,0)
 .. I CONC]"" D  Q
"RTN","BSTSDTS1",462,0)
 ... S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID
"RTN","BSTSDTS1",463,0)
 ;
"RTN","BSTSDTS1",464,0)
 Q STS
"RTN","BSTSDTS2")
0^16^B114308433
"RTN","BSTSDTS2",1,0)
BSTSDTS2 ;GDIT/HS/BEE-Standard Terminology DTS Calls/Processing ;26-Jun-2015 18:12;DKM
"RTN","BSTSDTS2",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSDTS2",3,0)
 ;
"RTN","BSTSDTS2",4,0)
 Q
"RTN","BSTSDTS2",5,0)
 ;
"RTN","BSTSDTS2",6,0)
SEARCH(OUT,BSTSWS) ;EP - DTS4 Search Call
"RTN","BSTSDTS2",7,0)
 ;
"RTN","BSTSDTS2",8,0)
 N II,STS,SEARCH,STYPE,WORD,MAX,DTSID,NMID
"RTN","BSTSDTS2",9,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,DUPLST
"RTN","BSTSDTS2",10,0)
 ;
"RTN","BSTSDTS2",11,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS2",12,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS2",13,0)
 S SLIST=$NA(^TMP("BSTSSLST",$J)) ;Sorted List
"RTN","BSTSDTS2",14,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS2",15,0)
 K @SLIST,@DLIST,@OUT
"RTN","BSTSDTS2",16,0)
 ;
"RTN","BSTSDTS2",17,0)
 ;Determine maximum to return
"RTN","BSTSDTS2",18,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS2",19,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS2",20,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS2",21,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS2",22,0)
 ;
"RTN","BSTSDTS2",23,0)
 ;Loop through each word
"RTN","BSTSDTS2",24,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSDTS2",25,0)
 ;
"RTN","BSTSDTS2",26,0)
 ;Perform DTS Search
"RTN","BSTSDTS2",27,0)
 I STYPE="S" S STS=$$TRMSRCH^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS2",28,0)
 ;
"RTN","BSTSDTS2",29,0)
 ;Perform DTS concept search
"RTN","BSTSDTS2",30,0)
 I STYPE="F" S STS=$$CONSRCH^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS2",31,0)
 ;
"RTN","BSTSDTS2",32,0)
 ;Loop through results and retrieve detail
"RTN","BSTSDTS2",33,0)
 M @SLIST=@DLIST
"RTN","BSTSDTS2",34,0)
 ;
"RTN","BSTSDTS2",35,0)
 I $O(@SLIST@(""))]"" S II="",CNT=0 F  S II=$O(@SLIST@(II)) Q:II=""  D
"RTN","BSTSDTS2",36,0)
 . NEW STATUS,CONC,ROUT,ERSLT,DSCID
"RTN","BSTSDTS2",37,0)
 . ;
"RTN","BSTSDTS2",38,0)
 . S DTSID=$P(@SLIST@(II),U) Q:DTSID=""
"RTN","BSTSDTS2",39,0)
 . S DSCID=$P(@SLIST@(II),U,2) I STYPE="S",DSCID="" Q
"RTN","BSTSDTS2",40,0)
 . ;
"RTN","BSTSDTS2",41,0)
 . I $G(BSTSWS("DEBUG")) W !,"DTSID: ",DTSID
"RTN","BSTSDTS2",42,0)
 . ;
"RTN","BSTSDTS2",43,0)
 . ;Check for batch count
"RTN","BSTSDTS2",44,0)
 . I $G(RCNT)'<BSCNT Q
"RTN","BSTSDTS2",45,0)
 . ;
"RTN","BSTSDTS2",46,0)
 . ;Check for maximum
"RTN","BSTSDTS2",47,0)
 . I $G(RCNT)'<MAX Q
"RTN","BSTSDTS2",48,0)
 . ;
"RTN","BSTSDTS2",49,0)
 . ;Look for detail stored locally
"RTN","BSTSDTS2",50,0)
 . ;
"RTN","BSTSDTS2",51,0)
 . S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS)
"RTN","BSTSDTS2",52,0)
 . I CONC]"" D  Q
"RTN","BSTSDTS2",53,0)
 .. S CNT=CNT+1 I CNT<BSTRT Q  ;Check for starting point
"RTN","BSTSDTS2",54,0)
 .. S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID_U_DSCID
"RTN","BSTSDTS2",55,0)
 . ;
"RTN","BSTSDTS2",56,0)
 . ;Not Found or in need of update
"RTN","BSTSDTS2",57,0)
 . S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS2",58,0)
 . ;
"RTN","BSTSDTS2",59,0)
 . ;Clear result file
"RTN","BSTSDTS2",60,0)
 . K @DLIST
"RTN","BSTSDTS2",61,0)
 . ;
"RTN","BSTSDTS2",62,0)
 . ;Get Detail for concept
"RTN","BSTSDTS2",63,0)
 . S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS2",64,0)
 . ;
"RTN","BSTSDTS2",65,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DETAIL STATUS: ",STATUS
"RTN","BSTSDTS2",66,0)
 . ;
"RTN","BSTSDTS2",67,0)
 . ;File the Detail
"RTN","BSTSDTS2",68,0)
 . S STATUS=$$UPDATE^BSTSDTS0(NMID)
"RTN","BSTSDTS2",69,0)
 . ;
"RTN","BSTSDTS2",70,0)
 . I $G(BSTSWS("DEBUG")) W !!,"UPDATE STATUS: ",STATUS
"RTN","BSTSDTS2",71,0)
 . ;
"RTN","BSTSDTS2",72,0)
 . ;Look again to see if concept now logged
"RTN","BSTSDTS2",73,0)
 . S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS)
"RTN","BSTSDTS2",74,0)
 . I $G(BSTSWS("DEBUG")) W !!,"CONC: ",CONC
"RTN","BSTSDTS2",75,0)
 . I CONC]"" D  Q
"RTN","BSTSDTS2",76,0)
 .. S CNT=CNT+1 I CNT<BSTRT Q  ;Check for start point
"RTN","BSTSDTS2",77,0)
 .. S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID_U_DSCID
"RTN","BSTSDTS2",78,0)
 K @DLIST,@SLIST
"RTN","BSTSDTS2",79,0)
 ;
"RTN","BSTSDTS2",80,0)
 Q STS
"RTN","BSTSDTS2",81,0)
 ;
"RTN","BSTSDTS2",82,0)
ICD2SMD(OUT,BSTSWS) ;EP - DTS4 ICD9 to SNOMED mapping retrieval
"RTN","BSTSDTS2",83,0)
 ;
"RTN","BSTSDTS2",84,0)
 N II,STS,SEARCH,STYPE,WORD,MAX,DTSID,NMID
"RTN","BSTSDTS2",85,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,DUPLST
"RTN","BSTSDTS2",86,0)
 ;
"RTN","BSTSDTS2",87,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS2",88,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS2",89,0)
 S SLIST=$NA(^TMP("BSTSPDET",$J)) ;Sorted List
"RTN","BSTSDTS2",90,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS2",91,0)
 K @SLIST,@DLIST,@OUT
"RTN","BSTSDTS2",92,0)
 ;
"RTN","BSTSDTS2",93,0)
 ;Determine maximum to return
"RTN","BSTSDTS2",94,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS2",95,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS2",96,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS2",97,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS2",98,0)
 ;
"RTN","BSTSDTS2",99,0)
 ;Loop through each word
"RTN","BSTSDTS2",100,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSDTS2",101,0)
 ;
"RTN","BSTSDTS2",102,0)
 ;Perform DTS Call
"RTN","BSTSDTS2",103,0)
 S STS=$$ICD2SMD^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS2",104,0)
 ;
"RTN","BSTSDTS2",105,0)
 ;Loop through results and retrieve detail
"RTN","BSTSDTS2",106,0)
 M @SLIST=@DLIST
"RTN","BSTSDTS2",107,0)
 I $O(@SLIST@(""))]"" S II="",CNT=0 F  S II=$O(@SLIST@(II)) Q:II=""  D
"RTN","BSTSDTS2",108,0)
 . NEW STATUS,CONC,ROUT,ERSLT,DSCID
"RTN","BSTSDTS2",109,0)
 . S DTSID=$P(@SLIST@(II),U) Q:DTSID=""
"RTN","BSTSDTS2",110,0)
 . S DSCID=$P(@SLIST@(II),U,2) I STYPE="S",DSCID="" Q
"RTN","BSTSDTS2",111,0)
 . ;
"RTN","BSTSDTS2",112,0)
 . I $G(BSTSWS("DEBUG")) W !,"DTSID: ",DTSID
"RTN","BSTSDTS2",113,0)
 . ;
"RTN","BSTSDTS2",114,0)
 . ;Check for maximum
"RTN","BSTSDTS2",115,0)
 . I $G(RCNT)'<MAX Q
"RTN","BSTSDTS2",116,0)
 . ;
"RTN","BSTSDTS2",117,0)
 . ;Look for detail stored locally
"RTN","BSTSDTS2",118,0)
 . ;
"RTN","BSTSDTS2",119,0)
 . S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS)
"RTN","BSTSDTS2",120,0)
 . I CONC]"" D  Q
"RTN","BSTSDTS2",121,0)
 .. S CNT=CNT+1 I CNT<BSTRT Q  ;Check for starting point
"RTN","BSTSDTS2",122,0)
 .. S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID_U_DSCID
"RTN","BSTSDTS2",123,0)
 . ;
"RTN","BSTSDTS2",124,0)
 . ;Not Found or in need of update
"RTN","BSTSDTS2",125,0)
 . S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS2",126,0)
 . ;
"RTN","BSTSDTS2",127,0)
 . ;Clear result file
"RTN","BSTSDTS2",128,0)
 . K @DLIST
"RTN","BSTSDTS2",129,0)
 . ;
"RTN","BSTSDTS2",130,0)
 . ;Get Detail for concept
"RTN","BSTSDTS2",131,0)
 . S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS2",132,0)
 . ;
"RTN","BSTSDTS2",133,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DETAIL STATUS: ",STATUS
"RTN","BSTSDTS2",134,0)
 . ;
"RTN","BSTSDTS2",135,0)
 . ;File the Detail
"RTN","BSTSDTS2",136,0)
 . S STATUS=$$UPDATE^BSTSDTS0(NMID)
"RTN","BSTSDTS2",137,0)
 . ;
"RTN","BSTSDTS2",138,0)
 . I $G(BSTSWS("DEBUG")) W !!,"UPDATE STATUS: ",STATUS
"RTN","BSTSDTS2",139,0)
 . ;
"RTN","BSTSDTS2",140,0)
 . ;Look again to see if concept now logged
"RTN","BSTSDTS2",141,0)
 . S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS)
"RTN","BSTSDTS2",142,0)
 . I $G(BSTSWS("DEBUG")) W !!,"CONC: ",CONC
"RTN","BSTSDTS2",143,0)
 . I CONC]"" D  Q
"RTN","BSTSDTS2",144,0)
 .. S CNT=CNT+1 I CNT<BSTRT Q  ;Check for start point
"RTN","BSTSDTS2",145,0)
 .. S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID_U_DSCID
"RTN","BSTSDTS2",146,0)
 K @DLIST,@SLIST
"RTN","BSTSDTS2",147,0)
 ;
"RTN","BSTSDTS2",148,0)
 Q STS
"RTN","BSTSDTS2",149,0)
 ;
"RTN","BSTSDTS2",150,0)
ICDMAP(CONCDA,GL) ;EP - Save ICD Mapping information
"RTN","BSTSDTS2",151,0)
 ;
"RTN","BSTSDTS2",152,0)
 NEW DA,DIK,II
"RTN","BSTSDTS2",153,0)
 ;
"RTN","BSTSDTS2",154,0)
 ;Clear existing entries
"RTN","BSTSDTS2",155,0)
 S DA(1)=CONCDA
"RTN","BSTSDTS2",156,0)
 S II=0 F  S II=$O(^BSTS(9002318.4,DA(1),2,II)) Q:'II  S DA=II,DIK="^BSTS(9002318.4,"_DA(1)_",2," D ^DIK
"RTN","BSTSDTS2",157,0)
 ;
"RTN","BSTSDTS2",158,0)
 ;Save ICD Mapping Information
"RTN","BSTSDTS2",159,0)
 I $D(@GL@("ICDM"))>1 D
"RTN","BSTSDTS2",160,0)
 . NEW IMCNT
"RTN","BSTSDTS2",161,0)
 . S IMCNT="" F  S IMCNT=$O(@GL@("ICDM",IMCNT)) Q:IMCNT=""  D
"RTN","BSTSDTS2",162,0)
 .. NEW DA,IENS,MATND,MAT,MATRIN,MATROUT,BSTSICD
"RTN","BSTSDTS2",163,0)
 .. NEW MAND,MA,MARIN,MAROUT
"RTN","BSTSDTS2",164,0)
 .. NEW MCVND,MCV,MCVRIN,MCVROUT
"RTN","BSTSDTS2",165,0)
 .. NEW MGND,MG,MGRIN,MGROUT
"RTN","BSTSDTS2",166,0)
 .. NEW MRND,MR,MRRIN,MRROUT
"RTN","BSTSDTS2",167,0)
 .. NEW MTND,MT,MTRIN,MTROUT
"RTN","BSTSDTS2",168,0)
 .. NEW MTNND,MTN,MTNRIN,MTNROUT
"RTN","BSTSDTS2",169,0)
 .. NEW MPND,MP,MPRIN,MPROUT
"RTN","BSTSDTS2",170,0)
 .. ;
"RTN","BSTSDTS2",171,0)
 .. ;Get new entry
"RTN","BSTSDTS2",172,0)
 .. S DA=$$NEWM(CONCDA) I 'DA Q
"RTN","BSTSDTS2",173,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS2",174,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS2",175,0)
 .. ;
"RTN","BSTSDTS2",176,0)
 .. ;Map Group
"RTN","BSTSDTS2",177,0)
 .. S MGND=$G(@GL@("ICDM",IMCNT,"mapGroup"))
"RTN","BSTSDTS2",178,0)
 .. S MG=$P(MGND,U)
"RTN","BSTSDTS2",179,0)
 .. S MGRIN=$P(MGND,U,2)
"RTN","BSTSDTS2",180,0)
 .. S MGROUT=$P(MGND,U,3)
"RTN","BSTSDTS2",181,0)
 .. I MG]"" D
"RTN","BSTSDTS2",182,0)
 ... S BSTSICD(9002318.42,IENS,.02)=MG
"RTN","BSTSDTS2",183,0)
 ... S BSTSICD(9002318.42,IENS,.03)=$$EP2FMDT^BSTSUTIL(MGRIN)
"RTN","BSTSDTS2",184,0)
 ... S BSTSICD(9002318.42,IENS,.04)=$$EP2FMDT^BSTSUTIL(MGROUT)
"RTN","BSTSDTS2",185,0)
 .. ;
"RTN","BSTSDTS2",186,0)
 .. ;Map Priority
"RTN","BSTSDTS2",187,0)
 .. S MPND=$G(@GL@("ICDM",IMCNT,"mapPriority"))
"RTN","BSTSDTS2",188,0)
 .. S MP=$P(MPND,U)
"RTN","BSTSDTS2",189,0)
 .. S MPRIN=$P(MPND,U,2)
"RTN","BSTSDTS2",190,0)
 .. S MPROUT=$P(MPND,U,3)
"RTN","BSTSDTS2",191,0)
 .. I MP]"" D
"RTN","BSTSDTS2",192,0)
 ... S BSTSICD(9002318.42,IENS,.05)=MP
"RTN","BSTSDTS2",193,0)
 ... S BSTSICD(9002318.42,IENS,.06)=$$EP2FMDT^BSTSUTIL(MPRIN)
"RTN","BSTSDTS2",194,0)
 ... S BSTSICD(9002318.42,IENS,.07)=$$EP2FMDT^BSTSUTIL(MPROUT)
"RTN","BSTSDTS2",195,0)
 .. ;
"RTN","BSTSDTS2",196,0)
 .. ;Map Target
"RTN","BSTSDTS2",197,0)
 .. S MTND=$G(@GL@("ICDM",IMCNT,"mapTarget"))
"RTN","BSTSDTS2",198,0)
 .. S MT=$P(MTND,U)
"RTN","BSTSDTS2",199,0)
 .. S MTRIN=$P(MTND,U,2)
"RTN","BSTSDTS2",200,0)
 .. S MTROUT=$P(MTND,U,3)
"RTN","BSTSDTS2",201,0)
 .. I MTND]"" D
"RTN","BSTSDTS2",202,0)
 ... S BSTSICD(9002318.42,IENS,.08)=MT
"RTN","BSTSDTS2",203,0)
 ... S BSTSICD(9002318.42,IENS,.09)=$$EP2FMDT^BSTSUTIL(MTRIN)
"RTN","BSTSDTS2",204,0)
 ... S BSTSICD(9002318.42,IENS,.1)=$$EP2FMDT^BSTSUTIL(MTROUT)
"RTN","BSTSDTS2",205,0)
 .. ;
"RTN","BSTSDTS2",206,0)
 .. ;Map Advice
"RTN","BSTSDTS2",207,0)
 .. S MAND=$G(@GL@("ICDM",IMCNT,"mapAdvice"))
"RTN","BSTSDTS2",208,0)
 .. S MA=$P(MAND,U)
"RTN","BSTSDTS2",209,0)
 .. S MATRIN=$P(MAND,U,2)
"RTN","BSTSDTS2",210,0)
 .. S MATROUT=$P(MAND,U,3)
"RTN","BSTSDTS2",211,0)
 .. I MA]"" D
"RTN","BSTSDTS2",212,0)
 ... N TXT,VAR
"RTN","BSTSDTS2",213,0)
 ... D WRAP^BSTSUTIL(.TXT,MA,220)
"RTN","BSTSDTS2",214,0)
 ... S VAR="TXT"
"RTN","BSTSDTS2",215,0)
 ... D WP^DIE(9002318.42,IENS,1,"",VAR)
"RTN","BSTSDTS2",216,0)
 ... S BSTSICD(9002318.42,IENS,5.01)=$$EP2FMDT^BSTSUTIL(MATRIN)
"RTN","BSTSDTS2",217,0)
 ... S BSTSICD(9002318.42,IENS,5.02)=$$EP2FMDT^BSTSUTIL(MATROUT)
"RTN","BSTSDTS2",218,0)
 .. ;
"RTN","BSTSDTS2",219,0)
 .. ;Map Target Name
"RTN","BSTSDTS2",220,0)
 .. S MTNND=$G(@GL@("ICDM",IMCNT,"mapTargetName"))
"RTN","BSTSDTS2",221,0)
 .. S MTN=$P(MTNND,U)
"RTN","BSTSDTS2",222,0)
 .. S MTNRIN=$P(MTND,U,2)
"RTN","BSTSDTS2",223,0)
 .. S MTNROUT=$P(MTND,U,3)
"RTN","BSTSDTS2",224,0)
 .. I MTN]"" D
"RTN","BSTSDTS2",225,0)
 ... N TXT,VAR
"RTN","BSTSDTS2",226,0)
 ... D WRAP^BSTSUTIL(.TXT,MTN,220)
"RTN","BSTSDTS2",227,0)
 ... S VAR="TXT"
"RTN","BSTSDTS2",228,0)
 ... D WP^DIE(9002318.42,IENS,2,"",VAR)
"RTN","BSTSDTS2",229,0)
 ... S BSTSICD(9002318.42,IENS,5.05)=$$EP2FMDT^BSTSUTIL(MTNRIN)
"RTN","BSTSDTS2",230,0)
 ... S BSTSICD(9002318.42,IENS,5.06)=$$EP2FMDT^BSTSUTIL(MTNROUT)
"RTN","BSTSDTS2",231,0)
 .. ;
"RTN","BSTSDTS2",232,0)
 .. ;Map Rule
"RTN","BSTSDTS2",233,0)
 .. S MRND=$G(@GL@("ICDM",IMCNT,"mapRule"))
"RTN","BSTSDTS2",234,0)
 .. S MR=$P(MRND,U)
"RTN","BSTSDTS2",235,0)
 .. S MRRIN=$P(MRND,U,2)
"RTN","BSTSDTS2",236,0)
 .. S MRROUT=$P(MRND,U,3)
"RTN","BSTSDTS2",237,0)
 .. I MR]"" D
"RTN","BSTSDTS2",238,0)
 ... N TXT,VAR
"RTN","BSTSDTS2",239,0)
 ... D WRAP^BSTSUTIL(.TXT,MR,220)
"RTN","BSTSDTS2",240,0)
 ... S VAR="TXT"
"RTN","BSTSDTS2",241,0)
 ... D WP^DIE(9002318.42,IENS,3,"",VAR)
"RTN","BSTSDTS2",242,0)
 ... S BSTSICD(9002318.42,IENS,5.03)=$$EP2FMDT^BSTSUTIL(MRRIN)
"RTN","BSTSDTS2",243,0)
 ... S BSTSICD(9002318.42,IENS,5.04)=$$EP2FMDT^BSTSUTIL(MRROUT)
"RTN","BSTSDTS2",244,0)
 .. ;
"RTN","BSTSDTS2",245,0)
 .. ;Map Category Value
"RTN","BSTSDTS2",246,0)
 .. S MCVND=$G(@GL@("ICDM",IMCNT,"mapCategoryValue"))
"RTN","BSTSDTS2",247,0)
 .. S MCV=$P(MCVND,U)
"RTN","BSTSDTS2",248,0)
 .. S MCVRIN=$P(MCVND,U,2)
"RTN","BSTSDTS2",249,0)
 .. S MCVROUT=$P(MCVND,U,3)
"RTN","BSTSDTS2",250,0)
 .. I MCV]"" D
"RTN","BSTSDTS2",251,0)
 ... N TXT,VAR
"RTN","BSTSDTS2",252,0)
 ... D WRAP^BSTSUTIL(.TXT,MCV,220)
"RTN","BSTSDTS2",253,0)
 ... S VAR="TXT"
"RTN","BSTSDTS2",254,0)
 ... D WP^DIE(9002318.42,IENS,4,"",VAR)
"RTN","BSTSDTS2",255,0)
 ... S BSTSICD(9002318.42,IENS,5.07)=$$EP2FMDT^BSTSUTIL(MCVRIN)
"RTN","BSTSDTS2",256,0)
 ... S BSTSICD(9002318.42,IENS,5.08)=$$EP2FMDT^BSTSUTIL(MCVROUT)
"RTN","BSTSDTS2",257,0)
 .. ;
"RTN","BSTSDTS2",258,0)
 .. ;File information
"RTN","BSTSDTS2",259,0)
 .. I $D(BSTSICD) D FILE^DIE("","BSTSICD","ERROR")
"RTN","BSTSDTS2",260,0)
 ;
"RTN","BSTSDTS2",261,0)
 Q 1
"RTN","BSTSDTS2",262,0)
 ;
"RTN","BSTSDTS2",263,0)
NEWM(CIEN) ;Create new ICD Mapping entry
"RTN","BSTSDTS2",264,0)
 N DIC,X,Y,DA,DLAYGO
"RTN","BSTSDTS2",265,0)
 S DIC(0)="L",DA(1)=CIEN
"RTN","BSTSDTS2",266,0)
 S DIC="^BSTS(9002318.4,"_DA(1)_",2,"
"RTN","BSTSDTS2",267,0)
 L +^BSTS(9002318.4,CIEN,2,0):1 E  Q ""
"RTN","BSTSDTS2",268,0)
 S X=$P($G(^BSTS(9002318.4,CIEN,2,0)),U,3)+1
"RTN","BSTSDTS2",269,0)
 S DLAYGO=9002318.42 D ^DIC
"RTN","BSTSDTS2",270,0)
 L -^BSTS(9002318.4,CIEN,2,0)
"RTN","BSTSDTS2",271,0)
 Q +Y
"RTN","BSTSDTS2",272,0)
 ;
"RTN","BSTSDTS2",273,0)
 ;
"RTN","BSTSDTS2",274,0)
SUBLST(DLIST,BSTSWS) ;EP - Perform a Web Service Subset Listing
"RTN","BSTSDTS2",275,0)
 ;
"RTN","BSTSDTS2",276,0)
 N II,STS,SEARCH,STYPE,MAX,DTSID,NMID
"RTN","BSTSDTS2",277,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,ST
"RTN","BSTSDTS2",278,0)
 ;
"RTN","BSTSDTS2",279,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS2",280,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS2",281,0)
 ;
"RTN","BSTSDTS2",282,0)
 ;Determine maximum to return
"RTN","BSTSDTS2",283,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS2",284,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS2",285,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS2",286,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS2",287,0)
 ;
"RTN","BSTSDTS2",288,0)
 ;Perform Lookup on Concept Id
"RTN","BSTSDTS2",289,0)
 S STS=$$SUBLST^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS2",290,0)
 ;
"RTN","BSTSDTS2",291,0)
 Q STS
"RTN","BSTSDTS2",292,0)
 ;
"RTN","BSTSDTS2",293,0)
DSCSRCH(OUT,BSTSWS) ;EP - DTS4 Search Call - Description Id Lookup
"RTN","BSTSDTS2",294,0)
 ;
"RTN","BSTSDTS2",295,0)
 N II,STS,SEARCH,STYPE,MAX,DTSID,NMID
"RTN","BSTSDTS2",296,0)
 N BSTRT,BSCNT,SLIST,DLIST,RES,RCNT,CNT,ST
"RTN","BSTSDTS2",297,0)
 ;
"RTN","BSTSDTS2",298,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS2",299,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS2",300,0)
 S SLIST=$NA(^TMP("BSTSPDET",$J)) ;Sorted List
"RTN","BSTSDTS2",301,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS2",302,0)
 K @DLIST,@OUT
"RTN","BSTSDTS2",303,0)
 ;
"RTN","BSTSDTS2",304,0)
 ;Determine maximum to return
"RTN","BSTSDTS2",305,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS2",306,0)
 S BSTRT=+$G(BSTSWS("BCTCHRC")) S:BSTRT=0 BSTRT=1
"RTN","BSTSDTS2",307,0)
 S BSCNT=+$G(BSTSWS("BCTCHCT")) S:BSCNT=0 BSCNT=MAX
"RTN","BSTSDTS2",308,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS2",309,0)
 ;
"RTN","BSTSDTS2",310,0)
 ;Perform Lookup on Concept Id
"RTN","BSTSDTS2",311,0)
 S STS=$$DSCSRCH^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS2",312,0)
 ;
"RTN","BSTSDTS2",313,0)
 S DTSID=$P($G(@DLIST@(1)),U) I DTSID D
"RTN","BSTSDTS2",314,0)
 . ;
"RTN","BSTSDTS2",315,0)
 . ;Loop through results and retrieve detail
"RTN","BSTSDTS2",316,0)
 . ;
"RTN","BSTSDTS2",317,0)
 . N STATUS,CONC,ERSLT
"RTN","BSTSDTS2",318,0)
 . ;
"RTN","BSTSDTS2",319,0)
 . ;Update entry
"RTN","BSTSDTS2",320,0)
 . S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS2",321,0)
 . ;
"RTN","BSTSDTS2",322,0)
 . ;Clear result file
"RTN","BSTSDTS2",323,0)
 . K @DLIST
"RTN","BSTSDTS2",324,0)
 . ;
"RTN","BSTSDTS2",325,0)
 . ;Get Detail for concept
"RTN","BSTSDTS2",326,0)
 . S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS2",327,0)
 . I $G(BSTSWS("DEBUG")) W !!,"Detail Call Status: ",STATUS
"RTN","BSTSDTS2",328,0)
 . ;
"RTN","BSTSDTS2",329,0)
 . ;File the Detail
"RTN","BSTSDTS2",330,0)
 . S STATUS=$$UPDATE^BSTSDTS0(NMID)
"RTN","BSTSDTS2",331,0)
 . I $G(BSTSWS("DEBUG")) W !!,"Update Call Status: ",STATUS
"RTN","BSTSDTS2",332,0)
 . ;
"RTN","BSTSDTS2",333,0)
 . ;Look to see if concept now logged
"RTN","BSTSDTS2",334,0)
 . S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS,1,1)
"RTN","BSTSDTS2",335,0)
 . I CONC]"" D  Q
"RTN","BSTSDTS2",336,0)
 .. S RCNT=$G(RCNT)+1,@OUT@(RCNT)=CONC_U_DTSID_U_SEARCH
"RTN","BSTSDTS2",337,0)
 ;
"RTN","BSTSDTS2",338,0)
 Q STS
"RTN","BSTSDTS2",339,0)
 ;
"RTN","BSTSDTS2",340,0)
SUBSET(OUT,BSTSWS) ;EP - DTS4 Get subset list
"RTN","BSTSDTS2",341,0)
 ;
"RTN","BSTSDTS2",342,0)
 NEW PRESULT,STS,II,SLIST
"RTN","BSTSDTS2",343,0)
 ;
"RTN","BSTSDTS2",344,0)
 ;Set up scratch global
"RTN","BSTSDTS2",345,0)
 S SLIST=$NA(^TMP("BSTSCMCL",$J)) K @SLIST
"RTN","BSTSDTS2",346,0)
 ;
"RTN","BSTSDTS2",347,0)
 ;Call DTS
"RTN","BSTSDTS2",348,0)
 S STS=$$SUBSET^BSTSCMCL(.BSTSWS,.PRESULT)
"RTN","BSTSDTS2",349,0)
 ;
"RTN","BSTSDTS2",350,0)
 S II="" F  S II=$O(@SLIST@(II)) Q:II=""  S @OUT@(II)=@SLIST@(II)
"RTN","BSTSDTS2",351,0)
 K @SLIST
"RTN","BSTSDTS2",352,0)
 ;
"RTN","BSTSDTS2",353,0)
 Q STS
"RTN","BSTSDTS3")
0^21^B81596605
"RTN","BSTSDTS3",1,0)
BSTSDTS3 ;GDIT/HS/BEE-Standard Terminology DTS Calls/Processing ;26-Jun-2015 18:12;DKM
"RTN","BSTSDTS3",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSDTS3",3,0)
 ;
"RTN","BSTSDTS3",4,0)
 Q
"RTN","BSTSDTS3",5,0)
 ;
"RTN","BSTSDTS3",6,0)
SUPDATE(NMID,ROUT) ;EP - Add/Update Special Codeset Entries
"RTN","BSTSDTS3",7,0)
 ;
"RTN","BSTSDTS3",8,0)
 ;This update section only applies to special codesets
"RTN","BSTSDTS3",9,0)
 I ($G(NMID)=5180)!($G(NMID)=1552)!($G(NMID)=36) Q 1
"RTN","BSTSDTS3",10,0)
 ;
"RTN","BSTSDTS3",11,0)
 N GL,CONCDA,BSTSC,INMID,ERROR,TCNT,I,CVRSN,ST,NROUT
"RTN","BSTSDTS3",12,0)
 ;
"RTN","BSTSDTS3",13,0)
 S GL=$NA(^TMP("BSTSCMCL",$J,1))
"RTN","BSTSDTS3",14,0)
 S ROUT=$G(ROUT,"")
"RTN","BSTSDTS3",15,0)
 ;
"RTN","BSTSDTS3",16,0)
 ;Look for Concept Id
"RTN","BSTSDTS3",17,0)
 I $P($G(@GL@("CONCEPTID")),U)="" Q 0
"RTN","BSTSDTS3",18,0)
 ;
"RTN","BSTSDTS3",19,0)
 ;Look for existing entry
"RTN","BSTSDTS3",20,0)
 I $G(@GL@("DTSID"))="" Q 0
"RTN","BSTSDTS3",21,0)
 S CONCDA=$O(^BSTS(9002318.4,"D",NMID,@GL@("DTSID"),""))
"RTN","BSTSDTS3",22,0)
 ;
"RTN","BSTSDTS3",23,0)
 ;None found - create new entry
"RTN","BSTSDTS3",24,0)
 I CONCDA="" S CONCDA=$$NEWC^BSTSDTS0()
"RTN","BSTSDTS3",25,0)
 ;
"RTN","BSTSDTS3",26,0)
 ;Verify entry found/created
"RTN","BSTSDTS3",27,0)
 I +CONCDA<0 Q 0
"RTN","BSTSDTS3",28,0)
 ;
"RTN","BSTSDTS3",29,0)
 ;Pull internal Code Set ID
"RTN","BSTSDTS3",30,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) Q:INMID="" "0"
"RTN","BSTSDTS3",31,0)
 ;
"RTN","BSTSDTS3",32,0)
 ;Pull the current version
"RTN","BSTSDTS3",33,0)
 S CVRSN=$$GET1^DIQ(9002318.1,INMID_",",.04,"I")
"RTN","BSTSDTS3",34,0)
 ;
"RTN","BSTSDTS3",35,0)
 ;Get Revision Out
"RTN","BSTSDTS3",36,0)
 S NROUT=$P(@GL@("CONCEPTID"),U,3) S:NROUT="" NROUT=ROUT
"RTN","BSTSDTS3",37,0)
 ;
"RTN","BSTSDTS3",38,0)
 ;Set up top level concept fields
"RTN","BSTSDTS3",39,0)
 S BSTSC(9002318.4,CONCDA_",",.02)=$P(@GL@("CONCEPTID"),U) ;Concept ID
"RTN","BSTSDTS3",40,0)
 S BSTSC(9002318.4,CONCDA_",",.08)=@GL@("DTSID") ;DTS ID
"RTN","BSTSDTS3",41,0)
 S BSTSC(9002318.4,CONCDA_",",.07)=INMID ;Code Set
"RTN","BSTSDTS3",42,0)
 S BSTSC(9002318.4,CONCDA_",",.03)="N"
"RTN","BSTSDTS3",43,0)
 S BSTSC(9002318.4,CONCDA_",",.05)=$$EP2FMDT^BSTSUTIL($P(@GL@("CONCEPTID"),U,2),1)
"RTN","BSTSDTS3",44,0)
 S BSTSC(9002318.4,CONCDA_",",.06)=$$EP2FMDT^BSTSUTIL(NROUT,1)
"RTN","BSTSDTS3",45,0)
 S BSTSC(9002318.4,CONCDA_",",.11)="N"
"RTN","BSTSDTS3",46,0)
 S BSTSC(9002318.4,CONCDA_",",.04)=CVRSN
"RTN","BSTSDTS3",47,0)
 S BSTSC(9002318.4,CONCDA_",",.12)=DT
"RTN","BSTSDTS3",48,0)
 S BSTSC(9002318.4,CONCDA_",",1)=$G(@GL@("FSN",1))
"RTN","BSTSDTS3",49,0)
 ;
"RTN","BSTSDTS3",50,0)
 ;Need to interim save because subsets look at .07
"RTN","BSTSDTS3",51,0)
 I $D(BSTSC) D FILE^DIE("","BSTSC","ERROR")
"RTN","BSTSDTS3",52,0)
 ;
"RTN","BSTSDTS3",53,0)
 ;Save Subsets
"RTN","BSTSDTS3",54,0)
 ;
"RTN","BSTSDTS3",55,0)
 ;Clear out existing entries
"RTN","BSTSDTS3",56,0)
 D
"RTN","BSTSDTS3",57,0)
 . NEW SB
"RTN","BSTSDTS3",58,0)
 . S SB=0 F  S SB=$O(^BSTS(9002318.4,CONCDA,4,SB)) Q:'SB  D
"RTN","BSTSDTS3",59,0)
 .. NEW DA,DIK
"RTN","BSTSDTS3",60,0)
 .. S DA(1)=CONCDA,DA=SB
"RTN","BSTSDTS3",61,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",4," D ^DIK
"RTN","BSTSDTS3",62,0)
 I $D(@GL@("SUB"))>1 D
"RTN","BSTSDTS3",63,0)
 . ;
"RTN","BSTSDTS3",64,0)
 . NEW SB
"RTN","BSTSDTS3",65,0)
 . S SB="" F  S SB=$O(@GL@("SUB",SB)) Q:SB=""  D
"RTN","BSTSDTS3",66,0)
 .. ;
"RTN","BSTSDTS3",67,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS3",68,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS3",69,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",4,"
"RTN","BSTSDTS3",70,0)
 .. S X=$P($G(@GL@("SUB",SB)),U) Q:X=""
"RTN","BSTSDTS3",71,0)
 .. S DLAYGO=9002318.44 D ^DIC
"RTN","BSTSDTS3",72,0)
 .. I +Y<0 Q
"RTN","BSTSDTS3",73,0)
 .. S DA=+Y
"RTN","BSTSDTS3",74,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS3",75,0)
 .. S BSTSC(9002318.44,IENS,".02")=$$DTS2FMDT^BSTSUTIL($P($G(@GL@("SUB",SB)),U,2))
"RTN","BSTSDTS3",76,0)
 ;
"RTN","BSTSDTS3",77,0)
 ;Save Associations
"RTN","BSTSDTS3",78,0)
 ;
"RTN","BSTSDTS3",79,0)
 ;Clear out existing entries
"RTN","BSTSDTS3",80,0)
 D
"RTN","BSTSDTS3",81,0)
 . NEW AS
"RTN","BSTSDTS3",82,0)
 . S AS=0 F  S AS=$O(^BSTS(9002318.4,CONCDA,9,AS)) Q:'AS  D
"RTN","BSTSDTS3",83,0)
 .. NEW DA,DIK
"RTN","BSTSDTS3",84,0)
 .. S DA(1)=CONCDA,DA=AS
"RTN","BSTSDTS3",85,0)
 .. S DIK="^BSTS(9002318.4,"_DA(1)_",9," D ^DIK
"RTN","BSTSDTS3",86,0)
 I $D(@GL@("ASC"))>1 D
"RTN","BSTSDTS3",87,0)
 . ;
"RTN","BSTSDTS3",88,0)
 . ;
"RTN","BSTSDTS3",89,0)
 . NEW AS
"RTN","BSTSDTS3",90,0)
 . S AS="" F  S AS=$O(@GL@("ASC",AS)) Q:AS=""  D
"RTN","BSTSDTS3",91,0)
 .. ;
"RTN","BSTSDTS3",92,0)
 .. NEW DIC,X,Y,DA,X,Y,IENS,DLAYGO
"RTN","BSTSDTS3",93,0)
 .. S DA(1)=CONCDA
"RTN","BSTSDTS3",94,0)
 .. S DIC(0)="L",DIC="^BSTS(9002318.4,"_DA(1)_",9,"
"RTN","BSTSDTS3",95,0)
 .. S X=$P($G(@GL@("ASC",AS)),U) Q:X=""
"RTN","BSTSDTS3",96,0)
 .. S DLAYGO=9002318.49 D ^DIC
"RTN","BSTSDTS3",97,0)
 .. I +Y<0 Q
"RTN","BSTSDTS3",98,0)
 .. S DA=+Y
"RTN","BSTSDTS3",99,0)
 .. S IENS=$$IENS^DILF(.DA)
"RTN","BSTSDTS3",100,0)
 .. S BSTSC(9002318.49,IENS,".02")=$P($G(@GL@("ASC",AS)),U,2)
"RTN","BSTSDTS3",101,0)
 .. S BSTSC(9002318.49,IENS,".03")=$P($G(@GL@("ASC",AS)),U,3)
"RTN","BSTSDTS3",102,0)
 ;
"RTN","BSTSDTS3",103,0)
 I $D(BSTSC) D FILE^DIE("","BSTSC","ERROR")
"RTN","BSTSDTS3",104,0)
 ;
"RTN","BSTSDTS3",105,0)
 ;Now save Terminology entries
"RTN","BSTSDTS3",106,0)
 ;
"RTN","BSTSDTS3",107,0)
 ;Synonyms/Preferred/FSN
"RTN","BSTSDTS3",108,0)
 ;
"RTN","BSTSDTS3",109,0)
 S TCNT="" F  S TCNT=$O(@GL@("SYN",TCNT)) Q:TCNT=""  D
"RTN","BSTSDTS3",110,0)
 . ;
"RTN","BSTSDTS3",111,0)
 . N TERM,TYPE,DESC,BSTST,ERROR,TMIEN,AIN
"RTN","BSTSDTS3",112,0)
 . ;
"RTN","BSTSDTS3",113,0)
 . ;Pull values
"RTN","BSTSDTS3",114,0)
 . S TERM=$G(@GL@("SYN",TCNT,1)) Q:TERM=""
"RTN","BSTSDTS3",115,0)
 . S TYPE=$P($G(@GL@("SYN",TCNT,0)),U,2)
"RTN","BSTSDTS3",116,0)
 . S TYPE=$S(TYPE=1:"P",1:"S")
"RTN","BSTSDTS3",117,0)
 . I TERM=$G(@GL@("FSN",1)) S TYPE="F"
"RTN","BSTSDTS3",118,0)
 . S DESC=$P($G(@GL@("SYN",TCNT,0)),U) Q:DESC=""
"RTN","BSTSDTS3",119,0)
 . S AIN=$$EP2FMDT^BSTSUTIL($P($G(@GL@("SYN",TCNT,0)),U,3))
"RTN","BSTSDTS3",120,0)
 . ;
"RTN","BSTSDTS3",121,0)
 . ;Look up entry
"RTN","BSTSDTS3",122,0)
 . S TMIEN=$O(^BSTS(9002318.3,"D",INMID,DESC,""))
"RTN","BSTSDTS3",123,0)
 . ;
"RTN","BSTSDTS3",124,0)
 . ;Entry not found - create new one
"RTN","BSTSDTS3",125,0)
 . I TMIEN="" S TMIEN=$$NEWT^BSTSDTS0()
"RTN","BSTSDTS3",126,0)
 . I TMIEN<0 Q
"RTN","BSTSDTS3",127,0)
 . ;
"RTN","BSTSDTS3",128,0)
 . ;Save/update other fields
"RTN","BSTSDTS3",129,0)
 . S BSTST(9002318.3,TMIEN_",",.02)=DESC
"RTN","BSTSDTS3",130,0)
 . S BSTST(9002318.3,TMIEN_",",.09)=TYPE
"RTN","BSTSDTS3",131,0)
 . S BSTST(9002318.3,TMIEN_",",1)=TERM
"RTN","BSTSDTS3",132,0)
 . S BSTST(9002318.3,TMIEN_",",.04)="N"
"RTN","BSTSDTS3",133,0)
 . S BSTST(9002318.3,TMIEN_",",.05)=CVRSN
"RTN","BSTSDTS3",134,0)
 . S BSTST(9002318.3,TMIEN_",",.08)=INMID
"RTN","BSTSDTS3",135,0)
 . S BSTST(9002318.3,TMIEN_",",.03)=CONCDA
"RTN","BSTSDTS3",136,0)
 . S BSTST(9002318.3,TMIEN_",",.06)=AIN
"RTN","BSTSDTS3",137,0)
 . S BSTST(9002318.3,TMIEN_",",.1)=DT
"RTN","BSTSDTS3",138,0)
 . S BSTST(9002318.3,TMIEN_",",.11)="N"
"RTN","BSTSDTS3",139,0)
 . D FILE^DIE("","BSTST","ERROR")
"RTN","BSTSDTS3",140,0)
 . ;
"RTN","BSTSDTS3",141,0)
 . ;Reindex - needed for custom indices
"RTN","BSTSDTS3",142,0)
 . D
"RTN","BSTSDTS3",143,0)
 .. NEW DIK,DA
"RTN","BSTSDTS3",144,0)
 .. S DIK="^BSTS(9002318.3,",DA=TMIEN
"RTN","BSTSDTS3",145,0)
 .. D IX^DIK
"RTN","BSTSDTS3",146,0)
 ;
"RTN","BSTSDTS3",147,0)
 Q $S($D(ERROR):"0^Update Failed",1:1)
"RTN","BSTSDTS3",148,0)
 ;
"RTN","BSTSDTS3",149,0)
USEARCH(OUT,BSTSWS) ;EP - DTS4 UNIVERSE Search Call
"RTN","BSTSDTS3",150,0)
 ;
"RTN","BSTSDTS3",151,0)
 NEW STS,II,SEARCH,STYPE,SLIST,DLIST,OCNT,MAX,NMID,RES
"RTN","BSTSDTS3",152,0)
 ;
"RTN","BSTSDTS3",153,0)
 S SEARCH=$G(BSTSWS("SEARCH"))
"RTN","BSTSDTS3",154,0)
 S STYPE=$G(BSTSWS("STYPE"))
"RTN","BSTSDTS3",155,0)
 S SLIST=$NA(^TMP("BSTSSLST",$J)) ;Sorted List
"RTN","BSTSDTS3",156,0)
 S DLIST=$NA(^TMP("BSTSCMCL",$J)) ;DTS Return List
"RTN","BSTSDTS3",157,0)
 K @SLIST,@DLIST,@OUT
"RTN","BSTSDTS3",158,0)
 S OCNT=0
"RTN","BSTSDTS3",159,0)
 ;
"RTN","BSTSDTS3",160,0)
 ;Determine maximum to return
"RTN","BSTSDTS3",161,0)
 S MAX=$G(BSTSWS("MAXRECS")) S:MAX="" MAX=25
"RTN","BSTSDTS3",162,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSDTS3",163,0)
 ;
"RTN","BSTSDTS3",164,0)
 ;Loop through each word
"RTN","BSTSDTS3",165,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSDTS3",166,0)
 ;
"RTN","BSTSDTS3",167,0)
 ;Perform DTS Search
"RTN","BSTSDTS3",168,0)
 I STYPE="S" S STS=$$TRMSRCH^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS3",169,0)
 ;
"RTN","BSTSDTS3",170,0)
 ;Perform DTS concept search
"RTN","BSTSDTS3",171,0)
 I STYPE="F" S STS=$$CONSRCH^BSTSCMCL(.BSTSWS,.RES) I $G(BSTSWS("DEBUG")) W !!,STS
"RTN","BSTSDTS3",172,0)
 ;
"RTN","BSTSDTS3",173,0)
 ;Loop through results and retrieve detail
"RTN","BSTSDTS3",174,0)
 M @SLIST=@DLIST
"RTN","BSTSDTS3",175,0)
 ;
"RTN","BSTSDTS3",176,0)
 I $O(@SLIST@(""))]"" S II="" F  S II=$O(@SLIST@(II)) Q:II=""  D
"RTN","BSTSDTS3",177,0)
 . NEW DTSID,DSCID,CONC,STATUS,CONCID,FSNT,FSND,REL,SYN
"RTN","BSTSDTS3",178,0)
 . NEW SUB,ERSLT,PRD,PRT,PRSY,ASSOC,MAPP
"RTN","BSTSDTS3",179,0)
 . ;
"RTN","BSTSDTS3",180,0)
 . S DTSID=$P(@SLIST@(II),U) Q:DTSID=""
"RTN","BSTSDTS3",181,0)
 . S DSCID=$P(@SLIST@(II),U,2) I STYPE="S",DSCID="" Q
"RTN","BSTSDTS3",182,0)
 . ;
"RTN","BSTSDTS3",183,0)
 . I $G(BSTSWS("DEBUG")) W !,"DTSID: ",DTSID
"RTN","BSTSDTS3",184,0)
 . ;
"RTN","BSTSDTS3",185,0)
 . ;Check for maximum
"RTN","BSTSDTS3",186,0)
 . I $G(OCNT)'<MAX Q
"RTN","BSTSDTS3",187,0)
 . ;
"RTN","BSTSDTS3",188,0)
 . ;Look for detail stored locally
"RTN","BSTSDTS3",189,0)
 . S CONC=$$CONC^BSTSDTS0(DTSID,.BSTSWS)
"RTN","BSTSDTS3",190,0)
 . ;
"RTN","BSTSDTS3",191,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DETAIL CONC: ",CONC
"RTN","BSTSDTS3",192,0)
 . ;
"RTN","BSTSDTS3",193,0)
 . ;Now get the detail
"RTN","BSTSDTS3",194,0)
 . ;
"RTN","BSTSDTS3",195,0)
 . ;Not Found or in need of update
"RTN","BSTSDTS3",196,0)
 . S BSTSWS("DTSID")=DTSID
"RTN","BSTSDTS3",197,0)
 . ;
"RTN","BSTSDTS3",198,0)
 . ;Clear result file
"RTN","BSTSDTS3",199,0)
 . K @DLIST
"RTN","BSTSDTS3",200,0)
 . ;
"RTN","BSTSDTS3",201,0)
 . ;Get Detail for concept
"RTN","BSTSDTS3",202,0)
 . S STATUS=$$DETAIL^BSTSCMCL(.BSTSWS,.ERSLT)
"RTN","BSTSDTS3",203,0)
 . ;
"RTN","BSTSDTS3",204,0)
 . ;Concept ID
"RTN","BSTSDTS3",205,0)
 . S CONCID=$P($G(@DLIST@(1,"CONCEPTID")),U)
"RTN","BSTSDTS3",206,0)
 . ;
"RTN","BSTSDTS3",207,0)
 . ;FSN
"RTN","BSTSDTS3",208,0)
 . S FSNT=$P($G(@DLIST@(1,"FSN",1)),U)
"RTN","BSTSDTS3",209,0)
 . S FSND=""
"RTN","BSTSDTS3",210,0)
 . ;
"RTN","BSTSDTS3",211,0)
 . ;ISA
"RTN","BSTSDTS3",212,0)
 . S REL="" I $D(@DLIST@(1,"ISA")) D
"RTN","BSTSDTS3",213,0)
 .. NEW ICNT
"RTN","BSTSDTS3",214,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"ISA",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",215,0)
 ... NEW DTS,TRM
"RTN","BSTSDTS3",216,0)
 ... S DTS=$P($G(@DLIST@(1,"ISA",ICNT,0)),"^")
"RTN","BSTSDTS3",217,0)
 ... S TRM=$P($G(@DLIST@(1,"ISA",ICNT,1)),"^")
"RTN","BSTSDTS3",218,0)
 ... S REL=REL_$S(REL]"":$C(28),1:"")_DTS_$C(29)_TRM_$C(29)_"ISA"
"RTN","BSTSDTS3",219,0)
 . ;
"RTN","BSTSDTS3",220,0)
 . ;Child
"RTN","BSTSDTS3",221,0)
 . I $D(@DLIST@(1,"SUBC")) D
"RTN","BSTSDTS3",222,0)
 .. NEW ICNT
"RTN","BSTSDTS3",223,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"SUBC",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",224,0)
 ... NEW DTS,TRM
"RTN","BSTSDTS3",225,0)
 ... S DTS=$P($G(@DLIST@(1,"SUBC",ICNT,0)),"^")
"RTN","BSTSDTS3",226,0)
 ... S TRM=$P($G(@DLIST@(1,"SUBC",ICNT,1)),"^")
"RTN","BSTSDTS3",227,0)
 ... S REL=REL_$S(REL]"":$C(28),1:"")_DTS_$C(29)_TRM_$C(29)_"CHD"
"RTN","BSTSDTS3",228,0)
 . ;
"RTN","BSTSDTS3",229,0)
 . ;Synonyms
"RTN","BSTSDTS3",230,0)
 . S SYN="",(PRT,PRD)="",PRSY="S" I $D(@DLIST@(1,"SYN")) D
"RTN","BSTSDTS3",231,0)
 .. NEW ICNT
"RTN","BSTSDTS3",232,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"SYN",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",233,0)
 ... NEW TRM,DSC,PS
"RTN","BSTSDTS3",234,0)
 ... S TRM=$P($G(@DLIST@(1,"SYN",ICNT,1)),"^")
"RTN","BSTSDTS3",235,0)
 ... S PS=$P($G(@DLIST@(1,"SYN",ICNT,0)),"^",2)
"RTN","BSTSDTS3",236,0)
 ... S DSC=$P($G(@DLIST@(1,"SYN",ICNT,0)),"^")
"RTN","BSTSDTS3",237,0)
 ... ;
"RTN","BSTSDTS3",238,0)
 ... ;Look for FSN
"RTN","BSTSDTS3",239,0)
 ... I TRM]"",FSNT=TRM D  I $G(@DLIST@(1,"NAMESP"))=36 Q
"RTN","BSTSDTS3",240,0)
 .... S FSND=DSC
"RTN","BSTSDTS3",241,0)
 ... ;
"RTN","BSTSDTS3",242,0)
 ... I DSCID]"",DSCID=DSC D
"RTN","BSTSDTS3",243,0)
 .... S PRD=DSCID,PRT=TRM
"RTN","BSTSDTS3",244,0)
 .... S:PS=1 PRSY="P"
"RTN","BSTSDTS3",245,0)
 ... I DSCID="",PS=1 S PRD=DSC,PRT=TRM
"RTN","BSTSDTS3",246,0)
 ... S SYN=SYN_$S(SYN]"":$C(28),1:"")_DSC_$C(29)_TRM_$C(29)_$S(PS=1:"Preferred",1:"Synonym")
"RTN","BSTSDTS3",247,0)
 . ;
"RTN","BSTSDTS3",248,0)
 . ;Subsets
"RTN","BSTSDTS3",249,0)
 . S SUB="" I $D(@DLIST@(1,"SUB")) D
"RTN","BSTSDTS3",250,0)
 .. NEW ICNT
"RTN","BSTSDTS3",251,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"SUB",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",252,0)
 ... NEW SB
"RTN","BSTSDTS3",253,0)
 ... S SB=$P($G(@DLIST@(1,"SUB",ICNT)),U)
"RTN","BSTSDTS3",254,0)
 ... S SUB=SUB_$S(SUB]"":$C(28),1:"")_SB
"RTN","BSTSDTS3",255,0)
 . ;
"RTN","BSTSDTS3",256,0)
 . ;Associations
"RTN","BSTSDTS3",257,0)
 . S ASSOC="" I $D(@DLIST@(1,"ASC")) D
"RTN","BSTSDTS3",258,0)
 .. NEW ICNT
"RTN","BSTSDTS3",259,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"ASC",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",260,0)
 ... NEW ANODE,ASC,ASN,AST,CDIEN
"RTN","BSTSDTS3",261,0)
 ... S ANODE=$G(@DLIST@(1,"ASC",ICNT))
"RTN","BSTSDTS3",262,0)
 ... S ASC=$P(ANODE,U)
"RTN","BSTSDTS3",263,0)
 ... S ASN=$P(ANODE,U,2) Q:ASN=""
"RTN","BSTSDTS3",264,0)
 ... S CDIEN=$O(^BSTS(9002318.1,"B",ASN,"")) Q:CDIEN=""
"RTN","BSTSDTS3",265,0)
 ... S ASN=$$GET1^DIQ(9002318.1,CDIEN_",",.03,"I") Q:ASN=""
"RTN","BSTSDTS3",266,0)
 ... S AST=$P(ANODE,U,4) S:AST["[" ASC=""
"RTN","BSTSDTS3",267,0)
 ... S ASSOC=ASSOC_$S(ASSOC]"":$C(28),1:"")_ASN_": "_AST_$S(ASC="":"",1:" ["_ASC_"]")
"RTN","BSTSDTS3",268,0)
 . ;
"RTN","BSTSDTS3",269,0)
 . ;Mappings
"RTN","BSTSDTS3",270,0)
 . S MAPP="" I $D(@DLIST@(1,"NDC")) D
"RTN","BSTSDTS3",271,0)
 .. NEW ICNT
"RTN","BSTSDTS3",272,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"NDC",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",273,0)
 ... NEW NDC
"RTN","BSTSDTS3",274,0)
 ... S NDC=$P($G(@DLIST@(1,"NDC",ICNT)),U)
"RTN","BSTSDTS3",275,0)
 ... S MAPP=MAPP_$S(MAPP]"":$C(28),1:"")_"NDC: "_NDC
"RTN","BSTSDTS3",276,0)
 . ;
"RTN","BSTSDTS3",277,0)
 . ;VUID
"RTN","BSTSDTS3",278,0)
 . I $D(@DLIST@(1,"VUID")) D
"RTN","BSTSDTS3",279,0)
 .. NEW ICNT
"RTN","BSTSDTS3",280,0)
 .. S ICNT="" F  S ICNT=$O(@DLIST@(1,"VUID",ICNT)) Q:ICNT=""  D
"RTN","BSTSDTS3",281,0)
 ... NEW VUID
"RTN","BSTSDTS3",282,0)
 ... S VUID=$P($G(@DLIST@(1,"VUID",ICNT)),U)
"RTN","BSTSDTS3",283,0)
 ... S MAPP=MAPP_$S(MAPP]"":$C(28),1:"")_"VUID: "_VUID
"RTN","BSTSDTS3",284,0)
 . ;
"RTN","BSTSDTS3",285,0)
 . ;Save the detail
"RTN","BSTSDTS3",286,0)
 . S OCNT=OCNT+1
"RTN","BSTSDTS3",287,0)
 . S @OUT@(OCNT)=CONCID_U_PRT_U_PRD_U_FSNT_U_FSND_U_SYN_U_REL_U_DTSID_U_SUB_U_PRSY_U_ASSOC_U_MAPP
"RTN","BSTSDTS3",288,0)
 ;
"RTN","BSTSDTS3",289,0)
 K @DLIST,@SLIST
"RTN","BSTSDTS3",290,0)
 ;
"RTN","BSTSDTS3",291,0)
 Q STS
"RTN","BSTSLKP")
0^11^B16303885
"RTN","BSTSLKP",1,0)
BSTSLKP ;GDIT/HS/BEE-Standard Terminology Lookups ;26-Jun-2015 18:12;DKM
"RTN","BSTSLKP",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSLKP",3,0)
 Q
"RTN","BSTSLKP",4,0)
 ;
"RTN","BSTSLKP",5,0)
DSC(OUT,BSTSWS) ;EP - Perform Lookup on Description Id
"RTN","BSTSLKP",6,0)
 ;
"RTN","BSTSLKP",7,0)
 ;Input
"RTN","BSTSLKP",8,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSLKP",9,0)
 ;  BSTSWS("SEARCH") - The Description/Concept Id to lookup
"RTN","BSTSLKP",10,0)
 ;  BSTSWS("NAMESPACEID") (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSLKP",11,0)
 ;  BSTSWS("SNAPDT") (Optional) - Snapshot Date to check (default DT)
"RTN","BSTSLKP",12,0)
 ;
"RTN","BSTSLKP",13,0)
 ;Output
"RTN","BSTSLKP",14,0)
 ; @VAR@(#) - [1]^[2]^[3]
"RTN","BSTSLKP",15,0)
 ; [1] - Concept ID
"RTN","BSTSLKP",16,0)
 ; [2] - DTS ID
"RTN","BSTSLKP",17,0)
 ; [3] - Descriptor ID
"RTN","BSTSLKP",18,0)
 ;
"RTN","BSTSLKP",19,0)
 N DESC,IEN,NMID,SDATE,INMID,TIEN,CONC,DTS,CIEN
"RTN","BSTSLKP",20,0)
 ;
"RTN","BSTSLKP",21,0)
 S DESC=$G(BSTSWS("SEARCH")) Q:DESC="" "0"
"RTN","BSTSLKP",22,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSLKP",23,0)
 S SDATE=$G(BSTSWS("SNAPDT")) S:SDATE="" SDATE=DT
"RTN","BSTSLKP",24,0)
 ;
"RTN","BSTSLKP",25,0)
 ;Pull internal Code Set ID
"RTN","BSTSLKP",26,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) Q:INMID="" "0"
"RTN","BSTSLKP",27,0)
 ;
"RTN","BSTSLKP",28,0)
 ;Lookup of ID
"RTN","BSTSLKP",29,0)
 S TIEN=$O(^BSTS(9002318.3,"D",INMID,DESC,"")) Q:TIEN="" "0"
"RTN","BSTSLKP",30,0)
 S CIEN=$$GET1^DIQ(9002318.3,TIEN_",",.03,"I") Q:CIEN="0"
"RTN","BSTSLKP",31,0)
 S CONC=$$GET1^DIQ(9002318.4,CIEN_",",.02,"I")
"RTN","BSTSLKP",32,0)
 S DTS=$$GET1^DIQ(9002318.4,CIEN_",",.08,"I")
"RTN","BSTSLKP",33,0)
 S @OUT@(1)=CONC_U_DTS_U_DESC
"RTN","BSTSLKP",34,0)
 ;
"RTN","BSTSLKP",35,0)
 Q 1
"RTN","BSTSLKP",36,0)
 ;
"RTN","BSTSLKP",37,0)
DTS(OUT,BSTSWS) ;EP - Perform lookup on DTS Id
"RTN","BSTSLKP",38,0)
 ;
"RTN","BSTSLKP",39,0)
 ;Input
"RTN","BSTSLKP",40,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSLKP",41,0)
 ;  BSTSWS("SEARCH") - The DTS Id to lookup
"RTN","BSTSLKP",42,0)
 ;  BSTSWS("NAMESPACEID") (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSLKP",43,0)
 ;  BSTSWS("SNAPDT") (Optional) - Snapshot Date to check (default DT)
"RTN","BSTSLKP",44,0)
 ;
"RTN","BSTSLKP",45,0)
 ;Output
"RTN","BSTSLKP",46,0)
 ; @VAR@(#) - [1]^[2]^[3]
"RTN","BSTSLKP",47,0)
 ; [1] - Concept ID
"RTN","BSTSLKP",48,0)
 ; [2] - DTS ID
"RTN","BSTSLKP",49,0)
 ; [3] - Descriptor ID
"RTN","BSTSLKP",50,0)
 ;
"RTN","BSTSLKP",51,0)
 N DTS,IEN,NMID,SDATE,CONC,CIEN
"RTN","BSTSLKP",52,0)
 ;
"RTN","BSTSLKP",53,0)
 S DTS=$G(BSTSWS("SEARCH")) Q:DTS="" "0"
"RTN","BSTSLKP",54,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSLKP",55,0)
 S SDATE=$G(BSTSWS("SNAPDT")) S:SDATE="" SDATE=DT
"RTN","BSTSLKP",56,0)
 ;
"RTN","BSTSLKP",57,0)
 ;Lookup of ID
"RTN","BSTSLKP",58,0)
 S CIEN=$O(^BSTS(9002318.4,"D",NMID,DTS,"")) Q:CIEN="" "0"
"RTN","BSTSLKP",59,0)
 S CONC=$$GET1^DIQ(9002318.4,CIEN_",",.02,"I") Q:CONC="" "0"
"RTN","BSTSLKP",60,0)
 S @OUT@(1)=CONC_U_DTS_U
"RTN","BSTSLKP",61,0)
 ;
"RTN","BSTSLKP",62,0)
 Q 1
"RTN","BSTSLKP",63,0)
 ;
"RTN","BSTSLKP",64,0)
CNC(OUT,BSTSWS) ;EP - Perform lookup on Concept Id
"RTN","BSTSLKP",65,0)
 ;
"RTN","BSTSLKP",66,0)
 ;Input
"RTN","BSTSLKP",67,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSLKP",68,0)
 ;  BSTSWS("SEARCH") - The Concept Id to lookup
"RTN","BSTSLKP",69,0)
 ;  BSTSWS("NAMESPACEID") (Optional) - The code set Id (default SNOMED US EXT '36')
"RTN","BSTSLKP",70,0)
 ;  BSTSWS("SNAPDT") (Optional) - Snapshot Date to check (default DT)
"RTN","BSTSLKP",71,0)
 ;
"RTN","BSTSLKP",72,0)
 ;Output
"RTN","BSTSLKP",73,0)
 ; @VAR@(#) - [1]^[2]^[3]
"RTN","BSTSLKP",74,0)
 ; [1] - Concept ID
"RTN","BSTSLKP",75,0)
 ; [2] - DTS ID
"RTN","BSTSLKP",76,0)
 ; [3] - Descriptor ID
"RTN","BSTSLKP",77,0)
 ;
"RTN","BSTSLKP",78,0)
 N DTS,IEN,NMID,SDATE,CONC,CIEN
"RTN","BSTSLKP",79,0)
 ;
"RTN","BSTSLKP",80,0)
 S CONC=$G(BSTSWS("SEARCH")) Q:CONC="" "0"
"RTN","BSTSLKP",81,0)
 S NMID=$G(BSTSWS("NAMESPACEID")) S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSLKP",82,0)
 S SDATE=$G(BSTSWS("SNAPDT")) S:SDATE="" SDATE=DT
"RTN","BSTSLKP",83,0)
 ;
"RTN","BSTSLKP",84,0)
 ;Lookup of ID
"RTN","BSTSLKP",85,0)
 S CIEN=$O(^BSTS(9002318.4,"C",NMID,CONC,"")) Q:CIEN="" "0"
"RTN","BSTSLKP",86,0)
 S DTS=$$GET1^DIQ(9002318.4,CIEN_",",.08,"I")
"RTN","BSTSLKP",87,0)
 S @OUT@(1)=CONC_U_DTS_U
"RTN","BSTSLKP",88,0)
 ;
"RTN","BSTSLKP",89,0)
 Q 1
"RTN","BSTSLKP",90,0)
 ;
"RTN","BSTSLKP",91,0)
VNLKP(OUT,BSTSWS) ;EP - Perform local NDC/VUID lookup
"RTN","BSTSLKP",92,0)
 ;
"RTN","BSTSLKP",93,0)
 NEW NMID,CONC,DTS,CCT,NMIEN
"RTN","BSTSLKP",94,0)
 S CCT=0
"RTN","BSTSLKP",95,0)
 ;
"RTN","BSTSLKP",96,0)
 ;Get internal namespace IEN
"RTN","BSTSLKP",97,0)
 S NMID=$G(BSTSWS("NAMESPACEID"))
"RTN","BSTSLKP",98,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,"")) I NMIEN="" Q CCT
"RTN","BSTSLKP",99,0)
 ;
"RTN","BSTSLKP",100,0)
 ;NDC Search
"RTN","BSTSLKP",101,0)
 ;
"RTN","BSTSLKP",102,0)
 I $G(BSTSWS("LTYPE"))="N" D  Q CCT
"RTN","BSTSLKP",103,0)
 . NEW NDC,CIEN
"RTN","BSTSLKP",104,0)
 . ;
"RTN","BSTSLKP",105,0)
 . ;Get NDC
"RTN","BSTSLKP",106,0)
 . S NDC=$G(BSTSWS("SEARCH")) I NDC="" Q
"RTN","BSTSLKP",107,0)
 . ;
"RTN","BSTSLKP",108,0)
 . ;Lookup the entry
"RTN","BSTSLKP",109,0)
 . S CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"G",NMIEN,NDC,CIEN)) Q:CIEN=""  D
"RTN","BSTSLKP",110,0)
 .. NEW CONC,DTSID
"RTN","BSTSLKP",111,0)
 .. S CONC=$$GET1^DIQ(9002318.4,CIEN_",",".02","I") Q:CONC=""
"RTN","BSTSLKP",112,0)
 .. S DTSID=$$GET1^DIQ(9002318.4,CIEN_",",".08","I") Q:DTSID=""
"RTN","BSTSLKP",113,0)
 .. S CCT=CCT+1,@OUT@(CCT)=CONC_U_DTSID
"RTN","BSTSLKP",114,0)
 ;
"RTN","BSTSLKP",115,0)
 ;VUID search
"RTN","BSTSLKP",116,0)
 ;
"RTN","BSTSLKP",117,0)
 I $G(BSTSWS("LTYPE"))="V" D  Q CCT
"RTN","BSTSLKP",118,0)
 . NEW VUID,CIEN
"RTN","BSTSLKP",119,0)
 . ;
"RTN","BSTSLKP",120,0)
 . ;Get VUID
"RTN","BSTSLKP",121,0)
 . S VUID=$G(BSTSWS("SEARCH")) I VUID="" Q
"RTN","BSTSLKP",122,0)
 . ;
"RTN","BSTSLKP",123,0)
 . ;Lookup the entry
"RTN","BSTSLKP",124,0)
 . S CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"H",NMIEN,VUID,CIEN)) Q:CIEN=""  D
"RTN","BSTSLKP",125,0)
 .. NEW CONC,DTSID
"RTN","BSTSLKP",126,0)
 .. S CONC=$$GET1^DIQ(9002318.4,CIEN_",",".02","I") Q:CONC=""
"RTN","BSTSLKP",127,0)
 .. S DTSID=$$GET1^DIQ(9002318.4,CIEN_",",".08","I") Q:DTSID=""
"RTN","BSTSLKP",128,0)
 .. S CCT=CCT+1,@OUT@(CCT)=CONC_U_DTSID
"RTN","BSTSLKP",129,0)
 ;
"RTN","BSTSLKP",130,0)
 Q 0
"RTN","BSTSLKP",131,0)
 ;
"RTN","BSTSLKP",132,0)
CIEN(CONC,NMID) ;EP - Return the CIEN for the concept
"RTN","BSTSLKP",133,0)
 ;
"RTN","BSTSLKP",134,0)
 I $G(CONC)="" Q ""
"RTN","BSTSLKP",135,0)
 I $G(NMID)="" Q ""
"RTN","BSTSLKP",136,0)
 ;
"RTN","BSTSLKP",137,0)
 NEW TRNCONC,FOUND,CIEN
"RTN","BSTSLKP",138,0)
 ;
"RTN","BSTSLKP",139,0)
 S TRNCONC=$E(CONC,1,30)
"RTN","BSTSLKP",140,0)
 ;
"RTN","BSTSLKP",141,0)
 S FOUND=""
"RTN","BSTSLKP",142,0)
 S CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"C",NMID,TRNCONC,CIEN)) Q:CIEN=""  D  I FOUND]"" Q
"RTN","BSTSLKP",143,0)
 . NEW CONCID
"RTN","BSTSLKP",144,0)
 . S CONCID=$$GET1^DIQ(9002318.4,CIEN_",",".02","I") Q:CONCID=""
"RTN","BSTSLKP",145,0)
 . I CONC'=CONCID Q
"RTN","BSTSLKP",146,0)
 . S FOUND=CIEN
"RTN","BSTSLKP",147,0)
 Q FOUND
"RTN","BSTSLSRC")
0^23^B21199851
"RTN","BSTSLSRC",1,0)
BSTSLSRC ;GDIT/HS/BEE BSTS - New local Search ;26-Jun-2015 18:12;DKM
"RTN","BSTSLSRC",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSLSRC",3,0)
 Q
"RTN","BSTSLSRC",4,0)
 ;
"RTN","BSTSLSRC",5,0)
SRC(OUT,IN) ;Input
"RTN","BSTSLSRC",6,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSLSRC",7,0)
 ;  IN - BSTSWS Array
"RTN","BSTSLSRC",8,0)
 ;
"RTN","BSTSLSRC",9,0)
 ;Output
"RTN","BSTSLSRC",10,0)
 ; @VAR@(#) - [1]^[2]^[3]
"RTN","BSTSLSRC",11,0)
 ; [1] - Concept ID
"RTN","BSTSLSRC",12,0)
 ; [2] - DTS ID
"RTN","BSTSLSRC",13,0)
 ; [3] - Descriptor ID
"RTN","BSTSLSRC",14,0)
 ;
"RTN","BSTSLSRC",15,0)
 N II,TEXT,ARRAY,NM,TMP,SEARCH,STYPE,NMID,SUB,SNAPDT,MAX,BCTCHRC,BCTCHCT,DEBUG,CHKDT
"RTN","BSTSLSRC",16,0)
 N SCREEN,FILE,FIELD,FLAGS,INDEX,VAL,ERROR,TMP2,RES,RCNT,OCNT,CNT,%,%1,I,X,INMID
"RTN","BSTSLSRC",17,0)
 ;
"RTN","BSTSLSRC",18,0)
 ;Define input variables
"RTN","BSTSLSRC",19,0)
 F II=1:1 S TEXT=$P($T(FLD+II),";;",2) Q:TEXT=""  S ARRAY($P(TEXT,"^",1))=$P(TEXT,"^",2)
"RTN","BSTSLSRC",20,0)
 S NM="" F  S NM=$O(IN(NM)) Q:NM=""  I $G(ARRAY(NM))'="" S @ARRAY(NM)=IN(NM)
"RTN","BSTSLSRC",21,0)
 S:$G(NMID)="" NMID=36
"RTN","BSTSLSRC",22,0)
 ;
"RTN","BSTSLSRC",23,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) I INMID="" Q "0^Invalid Codeset"
"RTN","BSTSLSRC",24,0)
 ;
"RTN","BSTSLSRC",25,0)
 S CHKDT=$P($$DATE^BSTSUTIL(IN("SNAPDT")),".") I CHKDT="" Q "0^Invalid Check Date"
"RTN","BSTSLSRC",26,0)
 ;
"RTN","BSTSLSRC",27,0)
 ;Define scratch globals
"RTN","BSTSLSRC",28,0)
 S TMP=$NA(^TMP("BSTSSRCH",$J))
"RTN","BSTSLSRC",29,0)
 K @TMP
"RTN","BSTSLSRC",30,0)
 ;
"RTN","BSTSLSRC",31,0)
 ;Convert to uppercase
"RTN","BSTSLSRC",32,0)
 S SEARCH=$$UP^XLFSTR(SEARCH)
"RTN","BSTSLSRC",33,0)
 ;
"RTN","BSTSLSRC",34,0)
 ;Loop through each search term and perform look up
"RTN","BSTSLSRC",35,0)
 F II=1:1:$L(SEARCH," ") S VAL=$P(SEARCH," ",II) I VAL]"" D
"RTN","BSTSLSRC",36,0)
 . NEW WORD,TIEN
"RTN","BSTSLSRC",37,0)
 . ;
"RTN","BSTSLSRC",38,0)
 . ;Strip out common words
"RTN","BSTSLSRC",39,0)
 . I ^DD("KWIC")[(U_VAL_U) Q
"RTN","BSTSLSRC",40,0)
 . ;
"RTN","BSTSLSRC",41,0)
 . ;Look for exact matches
"RTN","BSTSLSRC",42,0)
 . S TIEN="" F  S TIEN=$O(^BSTS(9002318.3,"E",NMID,VAL,TIEN)) Q:TIEN=""  D MATCH(10000,VAL,TIEN,NMID,SEARCH,STYPE)
"RTN","BSTSLSRC",43,0)
 . ;
"RTN","BSTSLSRC",44,0)
 . ;Look for partial matches
"RTN","BSTSLSRC",45,0)
 . S WORD=VAL F  S WORD=$O(^BSTS(9002318.3,"E",NMID,WORD)) Q:WORD'[VAL  D
"RTN","BSTSLSRC",46,0)
 .. S TIEN="" F  S TIEN=$O(^BSTS(9002318.3,"E",NMID,WORD,TIEN)) Q:TIEN=""  D MATCH(5000,VAL,TIEN,NMID,SEARCH,STYPE)
"RTN","BSTSLSRC",47,0)
 ;
"RTN","BSTSLSRC",48,0)
 ;Now Filter and Sort by finding count
"RTN","BSTSLSRC",49,0)
 S TMP2=$NA(^TMP("BSTSSRCH2",$J)) K @TMP2
"RTN","BSTSLSRC",50,0)
 S RES="" F  S RES=$O(@TMP@(RES)) Q:RES=""  D
"RTN","BSTSLSRC",51,0)
 . N FILTER,CNT,CONC,CIEN,RIN,ROUT
"RTN","BSTSLSRC",52,0)
 . S FILTER=0
"RTN","BSTSLSRC",53,0)
 . ;
"RTN","BSTSLSRC",54,0)
 . ;GET THE CONC and CIEN
"RTN","BSTSLSRC",55,0)
 . S CONC=$P(RES,U) Q:CONC=""
"RTN","BSTSLSRC",56,0)
 . S CIEN=$$CIEN^BSTSLKP(CONC,NMID) Q:CIEN=""
"RTN","BSTSLSRC",57,0)
 . ;
"RTN","BSTSLSRC",58,0)
 . ;Quit if out of date
"RTN","BSTSLSRC",59,0)
 . I $$GET1^DIQ(9002318.4,CIEN_",",".11","I")="Y" Q
"RTN","BSTSLSRC",60,0)
 . ;
"RTN","BSTSLSRC",61,0)
 . ;Check revision dates
"RTN","BSTSLSRC",62,0)
 . S RIN=$$GET1^DIQ(9002318.4,CIEN_",",".05","I")
"RTN","BSTSLSRC",63,0)
 . S ROUT=$$GET1^DIQ(9002318.4,CIEN_",",".06","I")
"RTN","BSTSLSRC",64,0)
 . I CHKDT]"",RIN]"",CHKDT<RIN Q  ;Check date is before revision in
"RTN","BSTSLSRC",65,0)
 . I CHKDT]"",ROUT]"",CHKDT>ROUT Q  ;Check date is after revision out
"RTN","BSTSLSRC",66,0)
 . ;
"RTN","BSTSLSRC",67,0)
 . ;Subset filter
"RTN","BSTSLSRC",68,0)
 . I SUB]"",SUB'["ALL" D  Q:FILTER
"RTN","BSTSLSRC",69,0)
 .. N SB,ISB
"RTN","BSTSLSRC",70,0)
 .. S FILTER=1
"RTN","BSTSLSRC",71,0)
 .. F ISB=1:1:$L(SUB,"~") S SB=$P(SUB,"~",ISB) I SB]"",$D(^BSTS(9002318.4,CIEN,4,"B",SB)) S FILTER=0
"RTN","BSTSLSRC",72,0)
 . ;
"RTN","BSTSLSRC",73,0)
 . S CNT=@TMP@(RES),@TMP2@(CNT,RES)=""
"RTN","BSTSLSRC",74,0)
 ;
"RTN","BSTSLSRC",75,0)
 ;Set up output
"RTN","BSTSLSRC",76,0)
 S (RCNT,OCNT)=0,CNT="" F  S CNT=$O(@TMP2@(CNT),-1) Q:CNT=""  D
"RTN","BSTSLSRC",77,0)
 . N RES
"RTN","BSTSLSRC",78,0)
 . S RES="" F  S RES=$O(@TMP2@(CNT,RES),-1) Q:RES=""  D
"RTN","BSTSLSRC",79,0)
 .. N D,DI
"RTN","BSTSLSRC",80,0)
 .. S RCNT=RCNT+1 Q:RCNT>MAX
"RTN","BSTSLSRC",81,0)
 .. ;
"RTN","BSTSLSRC",82,0)
 .. ;Start at record
"RTN","BSTSLSRC",83,0)
 .. I +BCTCHRC>0,RCNT<(+BCTCHRC) Q
"RTN","BSTSLSRC",84,0)
 .. S OCNT=OCNT+1
"RTN","BSTSLSRC",85,0)
 .. ;
"RTN","BSTSLSRC",86,0)
 .. ;Grab BCTCHCT records
"RTN","BSTSLSRC",87,0)
 .. I +BCTCHCT>0,OCNT>(+BCTCHCT) Q
"RTN","BSTSLSRC",88,0)
 .. ;
"RTN","BSTSLSRC",89,0)
 .. ;Set up output
"RTN","BSTSLSRC",90,0)
 .. S @OUT@(OCNT)=RES
"RTN","BSTSLSRC",91,0)
 ;
"RTN","BSTSLSRC",92,0)
 K @TMP,@TMP2
"RTN","BSTSLSRC",93,0)
 ;
"RTN","BSTSLSRC",94,0)
 ;Return 1 on successful search
"RTN","BSTSLSRC",95,0)
 Q $S(OCNT>0:1,1:0)
"RTN","BSTSLSRC",96,0)
 ;
"RTN","BSTSLSRC",97,0)
MATCH(WT,VAL,TIEN,NMID,SEARCH,STYPE) ;Perform matching checks/weighting
"RTN","BSTSLSRC",98,0)
 ;
"RTN","BSTSLSRC",99,0)
 NEW TERM,TYPE,CPT,ENT,DESC,FILTER
"RTN","BSTSLSRC",100,0)
 ;
"RTN","BSTSLSRC",101,0)
 ;Get the type - skip FSN for SNOMED
"RTN","BSTSLSRC",102,0)
 S TYPE=$$GET1^DIQ(9002318.3,TIEN_",",.09,"I") Q:TYPE=""
"RTN","BSTSLSRC",103,0)
 I TYPE="F",NMID=36 Q
"RTN","BSTSLSRC",104,0)
 ;
"RTN","BSTSLSRC",105,0)
 ;Get the term
"RTN","BSTSLSRC",106,0)
 S TERM=$$UP^XLFSTR($$GET1^DIQ(9002318.3,TIEN_",",1,"E")) Q:TERM=""
"RTN","BSTSLSRC",107,0)
 ;
"RTN","BSTSLSRC",108,0)
 ;Implement AND logic - must have all terms
"RTN","BSTSLSRC",109,0)
 S FILTER=0
"RTN","BSTSLSRC",110,0)
 D  Q:FILTER
"RTN","BSTSLSRC",111,0)
 . NEW PC
"RTN","BSTSLSRC",112,0)
 . FOR PC=1:1:$L(SEARCH," ") D  Q:FILTER
"RTN","BSTSLSRC",113,0)
 .. NEW WD
"RTN","BSTSLSRC",114,0)
 .. S WD=$P(SEARCH," ",PC)
"RTN","BSTSLSRC",115,0)
 .. I TERM'[WD S FILTER=1
"RTN","BSTSLSRC",116,0)
 ;
"RTN","BSTSLSRC",117,0)
 ;Put greatest weight on exact match
"RTN","BSTSLSRC",118,0)
 I SEARCH=TERM S WT=WT+150000
"RTN","BSTSLSRC",119,0)
 ;
"RTN","BSTSLSRC",120,0)
 ;Look for starting match - Heavily weight starting matches with search string
"RTN","BSTSLSRC",121,0)
 I STYPE="F",(TYPE="P"!(TYPE="F")),SEARCH=$E(TERM,1,$L(SEARCH)) S WT=WT+500000
"RTN","BSTSLSRC",122,0)
 I STYPE="S",SEARCH=$E(TERM,1,$L(SEARCH)) S WT=WT+100000
"RTN","BSTSLSRC",123,0)
 ;
"RTN","BSTSLSRC",124,0)
 ;Put higher weight if term starts with any word
"RTN","BSTSLSRC",125,0)
 I VAL=$E(TERM,1,$L(VAL)) S WT=WT+100000
"RTN","BSTSLSRC",126,0)
 ;
"RTN","BSTSLSRC",127,0)
 ;Give higher weight to preferred terms in FSN searches
"RTN","BSTSLSRC",128,0)
 I STYPE="F",(TYPE="P"!(TYPE="F")) S WT=WT+500000
"RTN","BSTSLSRC",129,0)
 ;
"RTN","BSTSLSRC",130,0)
 ;Log entry
"RTN","BSTSLSRC",131,0)
 S CPT=$$GET1^DIQ(9002318.3,TIEN_",",".03","I") Q:CPT=""
"RTN","BSTSLSRC",132,0)
 S ENT=$$GET1^DIQ(9002318.4,CPT_",",".02","I")_U_$$GET1^DIQ(9002318.4,CPT_",",".08","I")_U
"RTN","BSTSLSRC",133,0)
 S DESC=$$GET1^DIQ(9002318.3,TIEN_",",".02","I")
"RTN","BSTSLSRC",134,0)
 ;
"RTN","BSTSLSRC",135,0)
 ;If FSN search pull FSN ID
"RTN","BSTSLSRC",136,0)
 I STYPE="F" S DESC=$P($$PDESC^BSTSSRCH(CPT),U) Q:DESC=""
"RTN","BSTSLSRC",137,0)
 S ENT=ENT_DESC
"RTN","BSTSLSRC",138,0)
 S @TMP@(ENT)=$G(@TMP@(ENT))+WT
"RTN","BSTSLSRC",139,0)
 ;
"RTN","BSTSLSRC",140,0)
 Q
"RTN","BSTSLSRC",141,0)
 ;
"RTN","BSTSLSRC",142,0)
FLD ;;
"RTN","BSTSLSRC",143,0)
 ;;SEARCH^SEARCH
"RTN","BSTSLSRC",144,0)
 ;;STYPE^STYPE
"RTN","BSTSLSRC",145,0)
 ;;NAMESPACEID^NMID
"RTN","BSTSLSRC",146,0)
 ;;SUBSET^SUB
"RTN","BSTSLSRC",147,0)
 ;;SNAPDT^SNAPDT
"RTN","BSTSLSRC",148,0)
 ;;MAXRECS^MAX
"RTN","BSTSLSRC",149,0)
 ;;BCTCHRC^BCTCHRC
"RTN","BSTSLSRC",150,0)
 ;;BCTCHCT^BCTCHCT
"RTN","BSTSLSRC",151,0)
 ;;DEBUG^DEBUG
"RTN","BSTSLSRC",152,0)
 Q
"RTN","BSTSRPC")
0^15^B166146804
"RTN","BSTSRPC",1,0)
BSTSRPC ;GDIT/HS/BEE - SNOMED Utilities - RPC Search ;26-Jun-2015 18:12;DKM
"RTN","BSTSRPC",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSRPC",3,0)
 ;
"RTN","BSTSRPC",4,0)
 Q
"RTN","BSTSRPC",5,0)
 ;
"RTN","BSTSRPC",6,0)
SEARCH(DATA,SEARCH) ;EP - BSTS SNOMED SEARCH
"RTN","BSTSRPC",7,0)
 ;
"RTN","BSTSRPC",8,0)
 ;Description
"RTN","BSTSRPC",9,0)
 ;  Returns a list of SNOMED CT Terms matching the specified search string
"RTN","BSTSRPC",10,0)
 ;
"RTN","BSTSRPC",11,0)
 ;Input
"RTN","BSTSRPC",12,0)
 ;  SEARCH - The string to search on
"RTN","BSTSRPC",13,0)
 ;
"RTN","BSTSRPC",14,0)
 ;Output
"RTN","BSTSRPC",15,0)
 ;  ^TMP("BSTSRPC") - Name of global (passed by reference) in which the data is stored.
"RTN","BSTSRPC",16,0)
 ;
"RTN","BSTSRPC",17,0)
 ;Variables Used
"RTN","BSTSRPC",18,0)
 ;  UID - Unique TMP global subscript.
"RTN","BSTSRPC",19,0)
 ;
"RTN","BSTSRPC",20,0)
 N UID,BSTSII,SVAR,STS,II,%D
"RTN","BSTSRPC",21,0)
 ;
"RTN","BSTSRPC",22,0)
 S SEARCH=$TR(SEARCH,"|","^")
"RTN","BSTSRPC",23,0)
 S $P(SEARCH,U,5)=""
"RTN","BSTSRPC",24,0)
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
"RTN","BSTSRPC",25,0)
 S DATA=$NA(^TMP("BSTSRPC",UID))
"RTN","BSTSRPC",26,0)
 S SVAR=$NA(^TMP("BSTSRPC1",UID))
"RTN","BSTSRPC",27,0)
 K @DATA,@SVAR
"RTN","BSTSRPC",28,0)
 ;
"RTN","BSTSRPC",29,0)
 S BSTSII=0
"RTN","BSTSRPC",30,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSRPC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSRPC",31,0)
 ;
"RTN","BSTSRPC",32,0)
 D HDR
"RTN","BSTSRPC",33,0)
 ;
"RTN","BSTSRPC",34,0)
 ;Validate input
"RTN","BSTSRPC",35,0)
 I $G(SEARCH)="" G DONE
"RTN","BSTSRPC",36,0)
 ;
"RTN","BSTSRPC",37,0)
 ;Perform lookup
"RTN","BSTSRPC",38,0)
 S STS=$$SEARCH^BSTSAPI(SVAR,SEARCH)
"RTN","BSTSRPC",39,0)
 ;
"RTN","BSTSRPC",40,0)
 ;Output Results
"RTN","BSTSRPC",41,0)
 S II=0 F  S II=$O(@SVAR@(II)) Q:II=""  D
"RTN","BSTSRPC",42,0)
 . NEW PRBD,PRBT,CONC,DTS,FSND,FSNT,PRED,PRET
"RTN","BSTSRPC",43,0)
 . NEW ISA,ICD9,SUB,SYN,MICD,D10,ISHDR
"RTN","BSTSRPC",44,0)
 . ;
"RTN","BSTSRPC",45,0)
 . ;Problem Description and Term
"RTN","BSTSRPC",46,0)
 . S PRBD=$G(@SVAR@(II,"PRB","DSC"))
"RTN","BSTSRPC",47,0)
 . S PRBT=$G(@SVAR@(II,"PRB","TRM"))
"RTN","BSTSRPC",48,0)
 . S CONC=$G(@SVAR@(II,"CON"))
"RTN","BSTSRPC",49,0)
 . S DTS=$G(@SVAR@(II,"DTS"))
"RTN","BSTSRPC",50,0)
 . S FSND=$G(@SVAR@(II,"FSN","DSC"))
"RTN","BSTSRPC",51,0)
 . S FSNT=$G(@SVAR@(II,"FSN","TRM"))
"RTN","BSTSRPC",52,0)
 . S PRED=$G(@SVAR@(II,"PRE","DSC"))
"RTN","BSTSRPC",53,0)
 . S PRET=$G(@SVAR@(II,"PRE","TRM"))
"RTN","BSTSRPC",54,0)
 . S ISHDR=$S(PRED=PRBD:"",1:"S")
"RTN","BSTSRPC",55,0)
 . ;
"RTN","BSTSRPC",56,0)
 . ;ISA
"RTN","BSTSRPC",57,0)
 . S ISA="" I $D(@SVAR@(II,"ISA")) D
"RTN","BSTSRPC",58,0)
 .. NEW ICNT
"RTN","BSTSRPC",59,0)
 .. S ICNT="" F  S ICNT=$O(@SVAR@(II,"ISA",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",60,0)
 ... NEW DTS,CON,TRM
"RTN","BSTSRPC",61,0)
 ... S DTS=$G(@SVAR@(II,"ISA",ICNT,"DTS"))
"RTN","BSTSRPC",62,0)
 ... S CON=$G(@SVAR@(II,"ISA",ICNT,"CON"))
"RTN","BSTSRPC",63,0)
 ... S TRM=$G(@SVAR@(II,"ISA",ICNT,"TRM"))
"RTN","BSTSRPC",64,0)
 ... S ISA=ISA_$S(ISA]"":$C(28),1:"")_DTS_$C(29)_CON_$C(29)_TRM
"RTN","BSTSRPC",65,0)
 . ;
"RTN","BSTSRPC",66,0)
 . ;ICD9
"RTN","BSTSRPC",67,0)
 . S ICD9="" I $D(@SVAR@(II,"ICD")) D
"RTN","BSTSRPC",68,0)
 .. NEW ICNT
"RTN","BSTSRPC",69,0)
 .. S ICNT="" F  S ICNT=$O(@SVAR@(II,"ICD",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",70,0)
 ... NEW ICD
"RTN","BSTSRPC",71,0)
 ... S ICD=$G(@SVAR@(II,"ICD",ICNT,"COD"))
"RTN","BSTSRPC",72,0)
 ... S ICD9=ICD9_$S(ICD9]"":$C(28),1:"")_ICD
"RTN","BSTSRPC",73,0)
 . ;
"RTN","BSTSRPC",74,0)
 . ;ICD10
"RTN","BSTSRPC",75,0)
 . S D10=""
"RTN","BSTSRPC",76,0)
 . ;
"RTN","BSTSRPC",77,0)
 . ;Subsets
"RTN","BSTSRPC",78,0)
 . S SUB="" I $D(@SVAR@(II,"SUB")) D
"RTN","BSTSRPC",79,0)
 .. NEW ICNT
"RTN","BSTSRPC",80,0)
 .. S ICNT="" F  S ICNT=$O(@SVAR@(II,"SUB",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",81,0)
 ... NEW SB
"RTN","BSTSRPC",82,0)
 ... S SB=$G(@SVAR@(II,"SUB",ICNT,"SUB"))
"RTN","BSTSRPC",83,0)
 ... S SUB=SUB_$S(SUB]"":$C(28),1:"")_SB
"RTN","BSTSRPC",84,0)
 . ;
"RTN","BSTSRPC",85,0)
 . ;Synonyms
"RTN","BSTSRPC",86,0)
 . S SYN=PRED_$C(29)_PRET_$C(29)_"Preferred" I $D(@SVAR@(II,"SYN")) D
"RTN","BSTSRPC",87,0)
 .. NEW ICNT
"RTN","BSTSRPC",88,0)
 .. S ICNT="" F  S ICNT=$O(@SVAR@(II,"SYN",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",89,0)
 ... NEW TRM,DSC
"RTN","BSTSRPC",90,0)
 ... S TRM=$G(@SVAR@(II,"SYN",ICNT,"TRM"))
"RTN","BSTSRPC",91,0)
 ... S DSC=$G(@SVAR@(II,"SYN",ICNT,"DSC"))
"RTN","BSTSRPC",92,0)
 ... S SYN=SYN_$S(SYN]"":$C(28),1:"")_DSC_$C(29)_TRM_$C(29)_"Synonym"
"RTN","BSTSRPC",93,0)
 . ;
"RTN","BSTSRPC",94,0)
 . S MICD=ICD9
"RTN","BSTSRPC",95,0)
 . ;Save entry
"RTN","BSTSRPC",96,0)
 . S BSTSII=BSTSII+1,@DATA@(BSTSII)=PRBD_U_PRBT_U_PRED_U_PRET_U_CONC_U_DTS_U_FSND_U_FSNT_U_ISA
"RTN","BSTSRPC",97,0)
 . S @DATA@(BSTSII)=@DATA@(BSTSII)_U_ICD9_U_SUB_U_D10_U_SYN_U_ISHDR_U_MICD_$C(30)
"RTN","BSTSRPC",98,0)
 ;
"RTN","BSTSRPC",99,0)
DONE ;
"RTN","BSTSRPC",100,0)
 S BSTSII=BSTSII+1,@DATA@(BSTSII)=$C(31)
"RTN","BSTSRPC",101,0)
 Q
"RTN","BSTSRPC",102,0)
 ;
"RTN","BSTSRPC",103,0)
USEARCH(DATA,SEARCH) ;EP - BSTS SNOMED UNIVERSE SEARCH
"RTN","BSTSRPC",104,0)
 ;
"RTN","BSTSRPC",105,0)
 ;Description
"RTN","BSTSRPC",106,0)
 ;  Perform a Codeset Universe Lookup
"RTN","BSTSRPC",107,0)
 ;  Returns a set of terms matching the specified search string
"RTN","BSTSRPC",108,0)
 ;
"RTN","BSTSRPC",109,0)
 ;Input
"RTN","BSTSRPC",110,0)
 ;  SEARCH - The string to search on
"RTN","BSTSRPC",111,0)
 ;
"RTN","BSTSRPC",112,0)
 ;Output
"RTN","BSTSRPC",113,0)
 ;  ^TMP("BSTSRPC") - Name of global (passed by reference) in which the data is stored.
"RTN","BSTSRPC",114,0)
 ;
"RTN","BSTSRPC",115,0)
 ;Variables Used
"RTN","BSTSRPC",116,0)
 ;  UID - Unique TMP global subscript.
"RTN","BSTSRPC",117,0)
 ;
"RTN","BSTSRPC",118,0)
 N UID,BSTSII,SVAR,STS,II,%D
"RTN","BSTSRPC",119,0)
 ;
"RTN","BSTSRPC",120,0)
 S SEARCH=$TR(SEARCH,"|","^")
"RTN","BSTSRPC",121,0)
 S $P(SEARCH,U,5)=""
"RTN","BSTSRPC",122,0)
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
"RTN","BSTSRPC",123,0)
 S DATA=$NA(^TMP("BSTSRPC",UID))
"RTN","BSTSRPC",124,0)
 S SVAR=$NA(^TMP("BSTSRPC1",UID))
"RTN","BSTSRPC",125,0)
 K @DATA,@SVAR
"RTN","BSTSRPC",126,0)
 ;
"RTN","BSTSRPC",127,0)
 S BSTSII=0
"RTN","BSTSRPC",128,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSRPC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSRPC",129,0)
 ;
"RTN","BSTSRPC",130,0)
 D UHDR
"RTN","BSTSRPC",131,0)
 ;
"RTN","BSTSRPC",132,0)
 ;Validate input
"RTN","BSTSRPC",133,0)
 I $G(SEARCH)="" G UDONE
"RTN","BSTSRPC",134,0)
 ;
"RTN","BSTSRPC",135,0)
 ;Perform lookup
"RTN","BSTSRPC",136,0)
 S STS=$$USEARCH^BSTSAPIF(SVAR,SEARCH)
"RTN","BSTSRPC",137,0)
 ;
"RTN","BSTSRPC",138,0)
 ;Output Results
"RTN","BSTSRPC",139,0)
 S II=0 F  S II=$O(@SVAR@(II)) Q:II=""  D
"RTN","BSTSRPC",140,0)
 . NEW PRBD,PRBT,CONC,DTS,FSND,FSNT,ISA,SYN,PS,SUB
"RTN","BSTSRPC",141,0)
 . NEW ASSC,MAPP
"RTN","BSTSRPC",142,0)
 . ;
"RTN","BSTSRPC",143,0)
 . ;Problem Description and Term
"RTN","BSTSRPC",144,0)
 . S PRBD=$P($G(@SVAR@(II)),U,3)
"RTN","BSTSRPC",145,0)
 . S PRBT=$P($G(@SVAR@(II)),U,2)
"RTN","BSTSRPC",146,0)
 . S CONC=$P($G(@SVAR@(II)),U)
"RTN","BSTSRPC",147,0)
 . S DTS=$P($G(@SVAR@(II)),U,8)
"RTN","BSTSRPC",148,0)
 . S FSND=$P($G(@SVAR@(II)),U,5)
"RTN","BSTSRPC",149,0)
 . S FSNT=$P($G(@SVAR@(II)),U,4)
"RTN","BSTSRPC",150,0)
 . ;
"RTN","BSTSRPC",151,0)
 . ;ISA
"RTN","BSTSRPC",152,0)
 . S ISA=$P($G(@SVAR@(II)),U,7)
"RTN","BSTSRPC",153,0)
 . ;
"RTN","BSTSRPC",154,0)
 . ;Synonym
"RTN","BSTSRPC",155,0)
 . S SYN=$P($G(@SVAR@(II)),U,6)
"RTN","BSTSRPC",156,0)
 . ;
"RTN","BSTSRPC",157,0)
 . ;Preferred/Synonym
"RTN","BSTSRPC",158,0)
 . S PS=$P($G(@SVAR@(II)),U,10)
"RTN","BSTSRPC",159,0)
 . ;
"RTN","BSTSRPC",160,0)
 . ;Subsets
"RTN","BSTSRPC",161,0)
 . S SUB=$P($G(@SVAR@(II)),U,9) D
"RTN","BSTSRPC",162,0)
 . ;
"RTN","BSTSRPC",163,0)
 . ;Associations
"RTN","BSTSRPC",164,0)
 . S ASSC=$P($G(@SVAR@(II)),U,11)
"RTN","BSTSRPC",165,0)
 . ;
"RTN","BSTSRPC",166,0)
 . ;Mappings
"RTN","BSTSRPC",167,0)
 . S MAPP=$P($G(@SVAR@(II)),U,12)
"RTN","BSTSRPC",168,0)
 . ;
"RTN","BSTSRPC",169,0)
 . ;Save entry
"RTN","BSTSRPC",170,0)
 . S BSTSII=BSTSII+1,@DATA@(BSTSII)=PRBT_U_PRBD_U_PS_U_FSNT_U_CONC_U_FSND_U_SYN_U_ISA_U_DTS_U_SUB_U_ASSC_U_MAPP
"RTN","BSTSRPC",171,0)
 . S @DATA@(BSTSII)=@DATA@(BSTSII)_$C(30)
"RTN","BSTSRPC",172,0)
 ;
"RTN","BSTSRPC",173,0)
 ;Reset Scratch Global
"RTN","BSTSRPC",174,0)
 K @SVAR
"RTN","BSTSRPC",175,0)
 ;
"RTN","BSTSRPC",176,0)
UDONE ;
"RTN","BSTSRPC",177,0)
 S BSTSII=BSTSII+1,@DATA@(BSTSII)=$C(31)
"RTN","BSTSRPC",178,0)
 Q
"RTN","BSTSRPC",179,0)
 ;
"RTN","BSTSRPC",180,0)
ICD2SMD(DATA,INPUT) ;EP - BSTS ICD9 TO SNOMED
"RTN","BSTSRPC",181,0)
 ;
"RTN","BSTSRPC",182,0)
 ;Description
"RTN","BSTSRPC",183,0)
 ;  Returns a list of SNOMED CT Terms matching the specified ICD9 code
"RTN","BSTSRPC",184,0)
 ;
"RTN","BSTSRPC",185,0)
 ;Input
"RTN","BSTSRPC",186,0)
 ;  INPUT - "|" Delimited string
"RTN","BSTSRPC",187,0)
 ;          [1] ICD9 Code
"RTN","BSTSRPC",188,0)
 ;          [2] Subset(s) (Optional) - Include only concepts in these subsets
"RTN","BSTSRPC",189,0)
 ;                                     (multiple subsets delimited by "~")
"RTN","BSTSRPC",190,0)
 ;
"RTN","BSTSRPC",191,0)
 ;Output
"RTN","BSTSRPC",192,0)
 ;  ^TMP("BSTSRPC") - Name of global (passed by reference) in which the data is stored.
"RTN","BSTSRPC",193,0)
 ;
"RTN","BSTSRPC",194,0)
 ;Variables Used
"RTN","BSTSRPC",195,0)
 ;  UID - Unique TMP global subscript.
"RTN","BSTSRPC",196,0)
 ;
"RTN","BSTSRPC",197,0)
 N UID,BSTSII,SVAR,STS,II,SUBSETS,SNAPDT,%D
"RTN","BSTSRPC",198,0)
 ;
"RTN","BSTSRPC",199,0)
 S INPUT=$G(INPUT,"")
"RTN","BSTSRPC",200,0)
 S INPUT=$TR(INPUT,"|","^")
"RTN","BSTSRPC",201,0)
 ;
"RTN","BSTSRPC",202,0)
 ;Strip off trailing "."
"RTN","BSTSRPC",203,0)
 S $P(INPUT,U)=$$TKO^BSTSUTIL($P(INPUT,U),".")
"RTN","BSTSRPC",204,0)
 ;
"RTN","BSTSRPC",205,0)
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
"RTN","BSTSRPC",206,0)
 S DATA=$NA(^TMP("BSTSRPC",UID))
"RTN","BSTSRPC",207,0)
 ;S SVAR=$NA(^TMP("BSTSRPC1",UID))  ;Now doing local array
"RTN","BSTSRPC",208,0)
 K @DATA
"RTN","BSTSRPC",209,0)
 ;
"RTN","BSTSRPC",210,0)
 S BSTSII=0
"RTN","BSTSRPC",211,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSRPC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSRPC",212,0)
 ;
"RTN","BSTSRPC",213,0)
 D IHDR
"RTN","BSTSRPC",214,0)
 ;
"RTN","BSTSRPC",215,0)
 ;Validate input
"RTN","BSTSRPC",216,0)
 I $P(INPUT,U)="" G IDONE
"RTN","BSTSRPC",217,0)
 S SUBSETS=$P(INPUT,U,2) S:SUBSETS]"" SUBSETS="~"_SUBSETS_"~"
"RTN","BSTSRPC",218,0)
 S SNAPDT=$P(INPUT,U,3)
"RTN","BSTSRPC",219,0)
 ;
"RTN","BSTSRPC",220,0)
 ;Perform lookup - ICD9
"RTN","BSTSRPC",221,0)
 I $E($P(INPUT,U),1)'="?" S STS=$$ICD2SMD^BSTSAPI("SVAR",$P(INPUT,U)_"^BCIX^")
"RTN","BSTSRPC",222,0)
 ;
"RTN","BSTSRPC",223,0)
 ;Perform lookup - Text
"RTN","BSTSRPC",224,0)
 I $E($P(INPUT,U),1)="?" D
"RTN","BSTSRPC",225,0)
 . NEW STRING
"RTN","BSTSRPC",226,0)
 . S STRING=$E($P(INPUT,U),2,9999)
"RTN","BSTSRPC",227,0)
 . S STS=$$SEARCH^BSTSAPI("SVAR",STRING_"^F^^^^^BCIX")
"RTN","BSTSRPC",228,0)
 ;
"RTN","BSTSRPC",229,0)
 ;Output Results
"RTN","BSTSRPC",230,0)
 S II=0 F  S II=$O(SVAR(II)) Q:II=""  D
"RTN","BSTSRPC",231,0)
 . NEW CONC,DESC,PTERM,REL,SCHK,SUB,ICD9
"RTN","BSTSRPC",232,0)
 . ;
"RTN","BSTSRPC",233,0)
 . ;Perform subset check to see it this Concept should be returned
"RTN","BSTSRPC",234,0)
 . S SCHK=0 I SUBSETS]"",$D(SVAR(II,"SUB")) D
"RTN","BSTSRPC",235,0)
 .. NEW ICNT
"RTN","BSTSRPC",236,0)
 .. S ICNT="" F  S ICNT=$O(SVAR(II,"SUB",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",237,0)
 ... NEW SB
"RTN","BSTSRPC",238,0)
 ... S SB=$G(SVAR(II,"SUB",ICNT,"SUB"))
"RTN","BSTSRPC",239,0)
 ... I SUBSETS[("~"_SB_"~") S SCHK=1
"RTN","BSTSRPC",240,0)
 . I SUBSETS]"",'SCHK Q
"RTN","BSTSRPC",241,0)
 . ;
"RTN","BSTSRPC",242,0)
 . ;Get Concept ID
"RTN","BSTSRPC",243,0)
 . S CONC=$G(SVAR(II,"CON")) Q:CONC=""
"RTN","BSTSRPC",244,0)
 . ;
"RTN","BSTSRPC",245,0)
 . ;Get Description Id of Preferred Term
"RTN","BSTSRPC",246,0)
 . S DESC=$G(SVAR(II,"PRB","DSC")) Q:DESC=""
"RTN","BSTSRPC",247,0)
 . ;
"RTN","BSTSRPC",248,0)
 . ;Get Preferred Term
"RTN","BSTSRPC",249,0)
 . S PTERM=$G(SVAR(II,"PRB","TRM")) Q:PTERM=""
"RTN","BSTSRPC",250,0)
 . ;
"RTN","BSTSRPC",251,0)
 . ;ICD9
"RTN","BSTSRPC",252,0)
 . S ICD9="" I $D(SVAR(II,"ICD")) D
"RTN","BSTSRPC",253,0)
 .. NEW ICNT
"RTN","BSTSRPC",254,0)
 .. S ICNT="" F  S ICNT=$O(SVAR(II,"ICD",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",255,0)
 ... NEW ICD
"RTN","BSTSRPC",256,0)
 ... S ICD=$G(SVAR(II,"ICD",ICNT,"COD"))
"RTN","BSTSRPC",257,0)
 ... S ICD9=ICD9_$S(ICD9]"":$C(28),1:"")_ICD
"RTN","BSTSRPC",258,0)
 . ;
"RTN","BSTSRPC",259,0)
 . ;Initialize Relations Value
"RTN","BSTSRPC",260,0)
 . S REL=""
"RTN","BSTSRPC",261,0)
 . ;
"RTN","BSTSRPC",262,0)
 . ;Subsets
"RTN","BSTSRPC",263,0)
 . S SUB="" I $D(SVAR(II,"SUB")) D
"RTN","BSTSRPC",264,0)
 .. NEW ICNT
"RTN","BSTSRPC",265,0)
 .. S ICNT="" F  S ICNT=$O(SVAR(II,"SUB",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",266,0)
 ... NEW SB
"RTN","BSTSRPC",267,0)
 ... S SB=$G(SVAR(II,"SUB",ICNT,"SUB"))
"RTN","BSTSRPC",268,0)
 ... S SUB=SUB_$S(SUB]"":$C(28),1:"")_SB
"RTN","BSTSRPC",269,0)
 . ;
"RTN","BSTSRPC",270,0)
 . ;Get ISA (Parents) first
"RTN","BSTSRPC",271,0)
 . I $D(SVAR(II,"ISA")) D
"RTN","BSTSRPC",272,0)
 .. NEW ICNT,PICD9
"RTN","BSTSRPC",273,0)
 .. S ICNT="" F  S ICNT=$O(SVAR(II,"ISA",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",274,0)
 ... NEW DTS,PDSC,PTRM,VR,STS,PCNC,SCHK
"RTN","BSTSRPC",275,0)
 ... ;
"RTN","BSTSRPC",276,0)
 ... ;Pull DTSId of Parent
"RTN","BSTSRPC",277,0)
 ... S DTS=$G(SVAR(II,"ISA",ICNT,"DTS")) Q:DTS=""
"RTN","BSTSRPC",278,0)
 ... ;
"RTN","BSTSRPC",279,0)
 ... ;Look up entry
"RTN","BSTSRPC",280,0)
 ... S STS=$$DTSLKP^BSTSAPI("VR",DTS_"^^^1")
"RTN","BSTSRPC",281,0)
 ... ;
"RTN","BSTSRPC",282,0)
 ... ;Perform subset check to see it this Concept should be returned
"RTN","BSTSRPC",283,0)
 ... S SCHK=0 I SUBSETS]"",$D(VR(1,"SUB")) D
"RTN","BSTSRPC",284,0)
 .... NEW ICNT
"RTN","BSTSRPC",285,0)
 .... S ICNT="" F  S ICNT=$O(VR(1,"SUB",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",286,0)
 ..... NEW SB
"RTN","BSTSRPC",287,0)
 ..... S SB=$G(VR(1,"SUB",ICNT,"SUB"))
"RTN","BSTSRPC",288,0)
 ..... I SUBSETS[("~"_SB_"~") S SCHK=1
"RTN","BSTSRPC",289,0)
 ... I SUBSETS]"",'SCHK Q
"RTN","BSTSRPC",290,0)
 ... ;
"RTN","BSTSRPC",291,0)
 ... S PDSC=$G(VR(1,"PRE","DSC")) Q:PDSC=""
"RTN","BSTSRPC",292,0)
 ... S PTRM=$G(VR(1,"PRE","TRM")) Q:PTRM=""
"RTN","BSTSRPC",293,0)
 ... S PCNC=$G(VR(1,"CON")) Q:PCNC=""
"RTN","BSTSRPC",294,0)
 ... ;
"RTN","BSTSRPC",295,0)
 ... ;ICD9 - Parent
"RTN","BSTSRPC",296,0)
 ... S PICD9="" I $D(VR(1,"ICD")) D
"RTN","BSTSRPC",297,0)
 .... NEW ICNT
"RTN","BSTSRPC",298,0)
 .... S ICNT="" F  S ICNT=$O(VR(1,"ICD",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",299,0)
 ..... NEW ICD
"RTN","BSTSRPC",300,0)
 ..... S ICD=$G(VR(1,"ICD",ICNT,"COD"))
"RTN","BSTSRPC",301,0)
 ..... S PICD9=PICD9_$S(PICD9]"":$C(26),1:"")_ICD
"RTN","BSTSRPC",302,0)
 ... ;
"RTN","BSTSRPC",303,0)
 ... ;Set up output
"RTN","BSTSRPC",304,0)
 ... S REL=REL_$S(REL]"":$C(28),1:"")_"P"_$C(29)_PCNC_$C(29)_PDSC_$C(29)_PTRM_$C(29)_PICD9
"RTN","BSTSRPC",305,0)
 . ;
"RTN","BSTSRPC",306,0)
 . ;Now get Children
"RTN","BSTSRPC",307,0)
 . I $D(SVAR(II,"CHD")) D
"RTN","BSTSRPC",308,0)
 .. NEW ICNT,CICD9
"RTN","BSTSRPC",309,0)
 .. S ICNT="" F  S ICNT=$O(SVAR(II,"CHD",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",310,0)
 ... NEW DTS,PDSC,PTRM,VR,STS,PCNC,SCHK
"RTN","BSTSRPC",311,0)
 ... ;
"RTN","BSTSRPC",312,0)
 ... ;Pull DTSId of Child
"RTN","BSTSRPC",313,0)
 ... S DTS=$G(SVAR(II,"CHD",ICNT,"DTS")) Q:DTS=""
"RTN","BSTSRPC",314,0)
 ... ;
"RTN","BSTSRPC",315,0)
 ... ;Look up entry
"RTN","BSTSRPC",316,0)
 ... S STS=$$DTSLKP^BSTSAPI("VR",DTS_"^^^1")
"RTN","BSTSRPC",317,0)
 ... ;
"RTN","BSTSRPC",318,0)
 ... ;Perform subset check to see it this Concept should be returned
"RTN","BSTSRPC",319,0)
 ... S SCHK=0 I SUBSETS]"",$D(VR(1,"SUB")) D
"RTN","BSTSRPC",320,0)
 .... NEW ICNT
"RTN","BSTSRPC",321,0)
 .... S ICNT="" F  S ICNT=$O(VR(1,"SUB",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",322,0)
 ..... NEW SB
"RTN","BSTSRPC",323,0)
 ..... S SB=$G(VR(1,"SUB",ICNT,"SUB"))
"RTN","BSTSRPC",324,0)
 ..... I SUBSETS[("~"_SB_"~") S SCHK=1
"RTN","BSTSRPC",325,0)
 ... I SUBSETS]"",'SCHK Q
"RTN","BSTSRPC",326,0)
 ... ;
"RTN","BSTSRPC",327,0)
 ... S PDSC=$G(VR(1,"PRE","DSC")) Q:PDSC=""
"RTN","BSTSRPC",328,0)
 ... S PTRM=$G(VR(1,"PRE","TRM")) Q:PTRM=""
"RTN","BSTSRPC",329,0)
 ... S PCNC=$G(VR(1,"CON")) Q:PCNC=""
"RTN","BSTSRPC",330,0)
 ... ;
"RTN","BSTSRPC",331,0)
 ... ;ICD9 - Children
"RTN","BSTSRPC",332,0)
 ... S CICD9="" I $D(VR(1,"ICD")) D
"RTN","BSTSRPC",333,0)
 .... NEW ICNT
"RTN","BSTSRPC",334,0)
 .... S ICNT="" F  S ICNT=$O(VR(1,"ICD",ICNT)) Q:ICNT=""  D
"RTN","BSTSRPC",335,0)
 ..... NEW ICD
"RTN","BSTSRPC",336,0)
 ..... S ICD=$G(VR(1,"ICD",ICNT,"COD"))
"RTN","BSTSRPC",337,0)
 ..... S CICD9=CICD9_$S(CICD9]"":$C(26),1:"")_ICD
"RTN","BSTSRPC",338,0)
 ... ;
"RTN","BSTSRPC",339,0)
 ... ;Set up output
"RTN","BSTSRPC",340,0)
 ... S REL=REL_$S(REL]"":$C(28),1:"")_"C"_$C(29)_PCNC_$C(29)_PDSC_$C(29)_PTRM_$C(29)_CICD9
"RTN","BSTSRPC",341,0)
 . ;
"RTN","BSTSRPC",342,0)
 . ;Save entry
"RTN","BSTSRPC",343,0)
 . S BSTSII=BSTSII+1
"RTN","BSTSRPC",344,0)
 . S @DATA@(BSTSII)=CONC_U_DESC_U_PTERM_U_REL_U_SUB_U_ICD9_$C(30)
"RTN","BSTSRPC",345,0)
 ;
"RTN","BSTSRPC",346,0)
IDONE ;
"RTN","BSTSRPC",347,0)
 S BSTSII=BSTSII+1,@DATA@(BSTSII)=$C(31)
"RTN","BSTSRPC",348,0)
 Q
"RTN","BSTSRPC",349,0)
 ;
"RTN","BSTSRPC",350,0)
IHDR ;
"RTN","BSTSRPC",351,0)
 NEW HDR
"RTN","BSTSRPC",352,0)
 S HDR="T00050CONCID^T00050DESC_ID^T00250PREF_TRM^T04096RELATIONS^T04096SUBSETS^T04096ICD9"
"RTN","BSTSRPC",353,0)
 S @DATA@(BSTSII)=HDR_$C(30)
"RTN","BSTSRPC",354,0)
 Q
"RTN","BSTSRPC",355,0)
 ;
"RTN","BSTSRPC",356,0)
HDR ;
"RTN","BSTSRPC",357,0)
 NEW HDR
"RTN","BSTSRPC",358,0)
 S HDR="T00050PRB_DSC^T00250PRB_TRM^T00050PREF_DSC^T00250PREF_TRM^T00050CONCID^T00030DTSID^T00050FSN_DSC^T00250FSN_TRM"
"RTN","BSTSRPC",359,0)
 S HDR=HDR_"^T04096ISA^T04096ICD9^T04096SUBSETS^T0409610D^T04096SYNONYMS"
"RTN","BSTSRPC",360,0)
 S HDR=HDR_"^T00001ISA_SYN_HDR^T04096MAPPED_ICD"
"RTN","BSTSRPC",361,0)
 S @DATA@(BSTSII)=HDR_$C(30)
"RTN","BSTSRPC",362,0)
 Q
"RTN","BSTSRPC",363,0)
 ;
"RTN","BSTSRPC",364,0)
UHDR ;
"RTN","BSTSRPC",365,0)
 NEW HDR
"RTN","BSTSRPC",366,0)
 S HDR="T00250PRB_TRM^T00050PRB_DSC^T00001PS^T00250FSN_TERM^T00250CONCID^T00050FSN_DSC"
"RTN","BSTSRPC",367,0)
 S HDR=HDR_"^T04096SYNONYMS^T04096RELATION^T00050HIDDEN_DTSID^T04096SUBSETS^T04096ASSOCIATION^T04096MAPPING"
"RTN","BSTSRPC",368,0)
 S @DATA@(BSTSII)=HDR_$C(30)
"RTN","BSTSRPC",369,0)
 Q
"RTN","BSTSRPC",370,0)
 ;
"RTN","BSTSRPC",371,0)
SUBSET(DATA,INPUT) ;EP - BSTS GET SUBSET LIST
"RTN","BSTSRPC",372,0)
 ;
"RTN","BSTSRPC",373,0)
 ;Description
"RTN","BSTSRPC",374,0)
 ;  Returns a list of Subsets available to select from
"RTN","BSTSRPC",375,0)
 ;
"RTN","BSTSRPC",376,0)
 ;Input
"RTN","BSTSRPC",377,0)
 ; INPUT - P1 (Optional) - Namespace ID - Default to SNOMED US EXT (#36)
"RTN","BSTSRPC",378,0)
 ;       - P2 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSRPC",379,0)
 ;                         blank for remote listing
"RTN","BSTSRPC",380,0)
 ;       - P3 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSRPC",381,0)
 ;       - P4 (Optional) - IPL - Pass 1 to return only problem list subsets (SRCH*)
"RTN","BSTSRPC",382,0)
 ;
"RTN","BSTSRPC",383,0)
 ;Output
"RTN","BSTSRPC",384,0)
 ;  ^TMP("BSTSRPC") - Name of global (passed by reference) in which the data is stored.
"RTN","BSTSRPC",385,0)
 ;
"RTN","BSTSRPC",386,0)
 ;Variables Used
"RTN","BSTSRPC",387,0)
 ;  UID - Unique TMP global subscript.
"RTN","BSTSRPC",388,0)
 ;
"RTN","BSTSRPC",389,0)
 ;Always look LOCAL
"RTN","BSTSRPC",390,0)
 S $P(INPUT,"|",2)=1
"RTN","BSTSRPC",391,0)
 ;
"RTN","BSTSRPC",392,0)
 N UID,BSTSII,STS,II,VAR,IPL,%D
"RTN","BSTSRPC",393,0)
 ;
"RTN","BSTSRPC",394,0)
 S INPUT=$TR($G(INPUT),"|","^")
"RTN","BSTSRPC",395,0)
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
"RTN","BSTSRPC",396,0)
 S DATA=$NA(^TMP("BSTSRPC",UID))
"RTN","BSTSRPC",397,0)
 K @DATA
"RTN","BSTSRPC",398,0)
 ;
"RTN","BSTSRPC",399,0)
 S BSTSII=0
"RTN","BSTSRPC",400,0)
 S IPL=$P(INPUT,"^",4)
"RTN","BSTSRPC",401,0)
 ;
"RTN","BSTSRPC",402,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSRPC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSRPC",403,0)
 ;
"RTN","BSTSRPC",404,0)
 S STS=$$SUBSET^BSTSAPI("VAR",$P(INPUT,U,1,3))
"RTN","BSTSRPC",405,0)
 ;
"RTN","BSTSRPC",406,0)
 ;Define header
"RTN","BSTSRPC",407,0)
 S @DATA@(0)="T04096SUBSET^T04096DISPLAY_SUBSETS"_$C(30)
"RTN","BSTSRPC",408,0)
 ;
"RTN","BSTSRPC",409,0)
 ;Loop through list and set up results
"RTN","BSTSRPC",410,0)
 S II="" F  S II=$O(VAR(II)) Q:II=""  D
"RTN","BSTSRPC",411,0)
 . ;
"RTN","BSTSRPC",412,0)
 . NEW DISPSB
"RTN","BSTSRPC",413,0)
 . ;
"RTN","BSTSRPC",414,0)
 . ;Filter for Integrated Problem List
"RTN","BSTSRPC",415,0)
 . I IPL,$E(VAR(II),1,4)'="SRCH" Q
"RTN","BSTSRPC",416,0)
 . S DISPSB=VAR(II) I $E(VAR(II),1,5)="SRCH " S DISPSB=$E(VAR(II),6,999)
"RTN","BSTSRPC",417,0)
 . ;
"RTN","BSTSRPC",418,0)
 . S BSTSII=BSTSII+1,@DATA@(BSTSII)=VAR(II)_U_DISPSB_$C(30)
"RTN","BSTSRPC",419,0)
 ;
"RTN","BSTSRPC",420,0)
 S BSTSII=BSTSII+1,@DATA@(BSTSII)=$C(31)
"RTN","BSTSRPC",421,0)
 Q
"RTN","BSTSRPC",422,0)
 ;
"RTN","BSTSRPC",423,0)
CDSET(DATA,INPUT) ;EP - BSTS GET CODESETS
"RTN","BSTSRPC",424,0)
 ;
"RTN","BSTSRPC",425,0)
 ;Description
"RTN","BSTSRPC",426,0)
 ;  Returns a list of Codesets available to select from
"RTN","BSTSRPC",427,0)
 ;
"RTN","BSTSRPC",428,0)
 ;Input
"RTN","BSTSRPC",429,0)
 ; INPUT - P1 (Optional) - LOCAL - Pass 1 to perform local listing, otherwise leave
"RTN","BSTSRPC",430,0)
 ;                         blank for remote listing
"RTN","BSTSRPC",431,0)
 ;       - P2 (Optional) - DEBUG - Pass 1 to display debug information
"RTN","BSTSRPC",432,0)
 ;       - P3 (Optional) - Pass 1 to return codesets for the standalone search tool
"RTN","BSTSRPC",433,0)
 ;
"RTN","BSTSRPC",434,0)
 ;  10       ICD-9-CM
"RTN","BSTSRPC",435,0)
 ;X 32768    IHS
"RTN","BSTSRPC",436,0)
 ;X 32769    SNOMED CT to ICD-10-CM Old
"RTN","BSTSRPC",437,0)
 ;X 32770    ECLIPS
"RTN","BSTSRPC",438,0)
 ;X 32771    IHS VANDF
"RTN","BSTSRPC",439,0)
 ;X 32772    GMRA Signs Symptoms
"RTN","BSTSRPC",440,0)
 ;X 32773    GMRA Allergies with Maps
"RTN","BSTSRPC",441,0)
 ;X 35290    SNOMED CT US Ext to ICD-10-CM
"RTN","BSTSRPC",442,0)
 ;X 32774    IHS Med Route
"RTN","BSTSRPC",443,0)
 ;  1552     RxNorm R
"RTN","BSTSRPC",444,0)
 ;  36       SNOMED CT US Extension
"RTN","BSTSRPC",445,0)
 ;  30       SNOMED CT
"RTN","BSTSRPC",446,0)
 ;  5180     FDA UNII
"RTN","BSTSRPC",447,0)
 ;
"RTN","BSTSRPC",448,0)
 ;Output
"RTN","BSTSRPC",449,0)
 ;  ^TMP("BSTSRPC") - Name of global (passed by reference) in which the data is stored.
"RTN","BSTSRPC",450,0)
 ;
"RTN","BSTSRPC",451,0)
 ;Variables Used
"RTN","BSTSRPC",452,0)
 ;  UID - Unique TMP global subscript.
"RTN","BSTSRPC",453,0)
 ;
"RTN","BSTSRPC",454,0)
 N UID,BSTSII,STS,II,VAR,SA,%D
"RTN","BSTSRPC",455,0)
 ;
"RTN","BSTSRPC",456,0)
 S INPUT=$TR($G(INPUT),"|","^")
"RTN","BSTSRPC",457,0)
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
"RTN","BSTSRPC",458,0)
 S DATA=$NA(^TMP("BSTSRPC",UID))
"RTN","BSTSRPC",459,0)
 K @DATA
"RTN","BSTSRPC",460,0)
 ;
"RTN","BSTSRPC",461,0)
 S BSTSII=0
"RTN","BSTSRPC",462,0)
 S SA=$P(INPUT,"^",3)
"RTN","BSTSRPC",463,0)
 ;
"RTN","BSTSRPC",464,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSRPC D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSRPC",465,0)
 ;
"RTN","BSTSRPC",466,0)
 S STS=$$CODESETS^BSTSAPI("VAR",$P(INPUT,U,1,2))
"RTN","BSTSRPC",467,0)
 ;
"RTN","BSTSRPC",468,0)
 ;Define header
"RTN","BSTSRPC",469,0)
 S @DATA@(0)="T00010CODE^T04096CODESET_NAME"_$C(30)
"RTN","BSTSRPC",470,0)
 ;
"RTN","BSTSRPC",471,0)
 ;Loop through list and set up results
"RTN","BSTSRPC",472,0)
 S II="" F  S II=$O(VAR(II)) Q:II=""  D
"RTN","BSTSRPC",473,0)
 . ;
"RTN","BSTSRPC",474,0)
 . NEW CODE,CODESET
"RTN","BSTSRPC",475,0)
 . ;
"RTN","BSTSRPC",476,0)
 . S CODE=$P(VAR(II),U)
"RTN","BSTSRPC",477,0)
 . S CODESET=$P(VAR(II),U,3)
"RTN","BSTSRPC",478,0)
 . ;
"RTN","BSTSRPC",479,0)
 . ;Filter for Standalone
"RTN","BSTSRPC",480,0)
 . I SA=1,CODE<32770,CODE>32667 Q
"RTN","BSTSRPC",481,0)
 . I SA=1,CODE=35290 Q
"RTN","BSTSRPC",482,0)
 . ;
"RTN","BSTSRPC",483,0)
 . ;Save entry
"RTN","BSTSRPC",484,0)
 . S BSTSII=BSTSII+1,@DATA@(BSTSII)=CODE_U_CODESET_$C(30)
"RTN","BSTSRPC",485,0)
 ;
"RTN","BSTSRPC",486,0)
 S BSTSII=BSTSII+1,@DATA@(BSTSII)=$C(31)
"RTN","BSTSRPC",487,0)
 Q
"RTN","BSTSRPC",488,0)
 ;
"RTN","BSTSRPC",489,0)
ERR ;
"RTN","BSTSRPC",490,0)
 D ^%ZTER
"RTN","BSTSRPC",491,0)
 NEW Y,ERRDTM
"RTN","BSTSRPC",492,0)
 S Y=$$NOW^XLFDT() X ^DD("DD") S ERRDTM=Y
"RTN","BSTSRPC",493,0)
 S BMXSEC="Recording that an error occurred at "_ERRDTM
"RTN","BSTSRPC",494,0)
 I $D(BSTSII),$D(DATA) S BSTSII=BSTSII+1,@DATA@(BSTSII)=$C(31)
"RTN","BSTSRPC",495,0)
 Q
"RTN","BSTSSRCH")
0^8^B42118106
"RTN","BSTSSRCH",1,0)
BSTSSRCH ;GDIT/HS/ALA-Search terms ;26-Jun-2015 18:12;DKM
"RTN","BSTSSRCH",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSSRCH",3,0)
 Q
"RTN","BSTSSRCH",4,0)
 ;
"RTN","BSTSSRCH",5,0)
SRC(OUT,IN) ;Input
"RTN","BSTSSRCH",6,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSSRCH",7,0)
 ;  IN - BSTSWS Array
"RTN","BSTSSRCH",8,0)
 ;
"RTN","BSTSSRCH",9,0)
 ;Output
"RTN","BSTSSRCH",10,0)
 ; @VAR@(#) - [1]^[2]^[3]
"RTN","BSTSSRCH",11,0)
 ; [1] - Concept ID
"RTN","BSTSSRCH",12,0)
 ; [2] - DTS ID
"RTN","BSTSSRCH",13,0)
 ; [3] - Descriptor ID
"RTN","BSTSSRCH",14,0)
 ;
"RTN","BSTSSRCH",15,0)
 ;Make call to new search logic
"RTN","BSTSSRCH",16,0)
 Q $$SRC^BSTSLSRC(.OUT,.IN)
"RTN","BSTSSRCH",17,0)
 ;
"RTN","BSTSSRCH",18,0)
 N II,TEXT,ARRAY,NM,TMP,SEARCH,STYPE,NMID,SUB,SNAPDT,MAX,BCTCHRC,BCTCHCT,DEBUG,CHKDT
"RTN","BSTSSRCH",19,0)
 N SCREEN,FILE,FIELD,FLAGS,INDEX,VAL,ERROR,TMP2,RES,RCNT,OCNT,CNT,%,%1,I,X,INMID
"RTN","BSTSSRCH",20,0)
 ;
"RTN","BSTSSRCH",21,0)
 ;Define input variables
"RTN","BSTSSRCH",22,0)
 F II=1:1 S TEXT=$P($T(FLD+II),";;",2) Q:TEXT=""  S ARRAY($P(TEXT,"^",1))=$P(TEXT,"^",2)
"RTN","BSTSSRCH",23,0)
 S NM="" F  S NM=$O(IN(NM)) Q:NM=""  I $G(ARRAY(NM))'="" S @ARRAY(NM)=IN(NM)
"RTN","BSTSSRCH",24,0)
 S:$G(NMID)="" NMID=36
"RTN","BSTSSRCH",25,0)
 ;
"RTN","BSTSSRCH",26,0)
 S INMID=$O(^BSTS(9002318.1,"B",NMID,"")) I INMID="" Q "0^Invalid Codeset"
"RTN","BSTSSRCH",27,0)
 ;
"RTN","BSTSSRCH",28,0)
 S CHKDT=$P($$DATE^BSTSUTIL(IN("SNAPDT")),".") I CHKDT="" Q "0^Invalid Check Date"
"RTN","BSTSSRCH",29,0)
 ;
"RTN","BSTSSRCH",30,0)
 ;Define scratch global
"RTN","BSTSSRCH",31,0)
 S TMP=$NA(^TMP("BSTSSRCH",$J))
"RTN","BSTSSRCH",32,0)
 K @TMP
"RTN","BSTSSRCH",33,0)
 ;
"RTN","BSTSSRCH",34,0)
 ;Define FileMan scratch global
"RTN","BSTSSRCH",35,0)
 K ^TMP("DILIST",$J)
"RTN","BSTSSRCH",36,0)
 ;
"RTN","BSTSSRCH",37,0)
 ;Loop through each search term and perform look up
"RTN","BSTSSRCH",38,0)
 S SCREEN="I $P(^(0),U,8)="_INMID
"RTN","BSTSSRCH",39,0)
 S FILE=9002318.3,FIELD=".02;.03;.09;1",FLAGS="PCM",INDEX="E"
"RTN","BSTSSRCH",40,0)
 F II=1:1:$L(SEARCH," ") S VAL=$P(SEARCH," ",II) D
"RTN","BSTSSRCH",41,0)
 . N N,TOT,VALUE
"RTN","BSTSSRCH",42,0)
 . S VALUE=$$UP^XLFSTR(VAL)
"RTN","BSTSSRCH",43,0)
 . D FIND^DIC(FILE,"",FIELD,FLAGS,VALUE,"",INDEX,SCREEN,"","","ERROR")
"RTN","BSTSSRCH",44,0)
 . S TOT=$P($G(^TMP("DILIST",$J,0)),"^",1)
"RTN","BSTSSRCH",45,0)
 . I TOT=0 Q
"RTN","BSTSSRCH",46,0)
 . F N=1:1:TOT D FND(N,SEARCH,NMID)
"RTN","BSTSSRCH",47,0)
 . Q
"RTN","BSTSSRCH",48,0)
 ;
"RTN","BSTSSRCH",49,0)
 ;Now Filter and Sort by finding count
"RTN","BSTSSRCH",50,0)
 S TMP2=$NA(^TMP("BSTSSRCH2",$J)) K @TMP2
"RTN","BSTSSRCH",51,0)
 S RES="" F  S RES=$O(@TMP@(RES)) Q:RES=""  D
"RTN","BSTSSRCH",52,0)
 . N FILTER,CNT,CONC,CIEN,RIN,ROUT
"RTN","BSTSSRCH",53,0)
 . S FILTER=0
"RTN","BSTSSRCH",54,0)
 . ;
"RTN","BSTSSRCH",55,0)
 . ;GET THE CONC and CIEN
"RTN","BSTSSRCH",56,0)
 . S CONC=$P(RES,U) Q:CONC=""
"RTN","BSTSSRCH",57,0)
 . S CIEN=$$CIEN^BSTSLKP(CONC,NMID) Q:CIEN=""
"RTN","BSTSSRCH",58,0)
 . ;
"RTN","BSTSSRCH",59,0)
 . ;Quit if out of date
"RTN","BSTSSRCH",60,0)
 . I $$GET1^DIQ(9002318.4,CIEN_",",".11","I")="Y" Q
"RTN","BSTSSRCH",61,0)
 . ;
"RTN","BSTSSRCH",62,0)
 . ;Check revision dates
"RTN","BSTSSRCH",63,0)
 . S RIN=$$GET1^DIQ(9002318.4,CIEN_",",".05","I")
"RTN","BSTSSRCH",64,0)
 . S ROUT=$$GET1^DIQ(9002318.4,CIEN_",",".06","I")
"RTN","BSTSSRCH",65,0)
 . I CHKDT]"",RIN]"",CHKDT<RIN Q  ;Check date is before revision in
"RTN","BSTSSRCH",66,0)
 . I CHKDT]"",ROUT]"",CHKDT>ROUT Q  ;Check date is after revision out
"RTN","BSTSSRCH",67,0)
 . ;
"RTN","BSTSSRCH",68,0)
 . ;Subset filter
"RTN","BSTSSRCH",69,0)
 . I SUB]"" D  Q:FILTER
"RTN","BSTSSRCH",70,0)
 .. N SB,ISB
"RTN","BSTSSRCH",71,0)
 .. S FILTER=1
"RTN","BSTSSRCH",72,0)
 .. F ISB=1:1:$L(SUB,"~") S SB=$P(SUB,"~",ISB) I SB]"",$D(^BSTS(9002318.4,CIEN,4,"B",SB)) S FILTER=0
"RTN","BSTSSRCH",73,0)
 . ;
"RTN","BSTSSRCH",74,0)
 . S CNT=@TMP@(RES),@TMP2@(CNT,RES)=""
"RTN","BSTSSRCH",75,0)
 ;
"RTN","BSTSSRCH",76,0)
 ;Set up output
"RTN","BSTSSRCH",77,0)
 S (RCNT,OCNT)=0,CNT="" F  S CNT=$O(@TMP2@(CNT),-1) Q:CNT=""  D
"RTN","BSTSSRCH",78,0)
 . N RES
"RTN","BSTSSRCH",79,0)
 . S RES="" F  S RES=$O(@TMP2@(CNT,RES),-1) Q:RES=""  D
"RTN","BSTSSRCH",80,0)
 .. N D,DI
"RTN","BSTSSRCH",81,0)
 .. S RCNT=RCNT+1 Q:RCNT>MAX
"RTN","BSTSSRCH",82,0)
 .. ;
"RTN","BSTSSRCH",83,0)
 .. ;Start at record
"RTN","BSTSSRCH",84,0)
 .. I +BCTCHRC>0,RCNT<(+BCTCHRC) Q
"RTN","BSTSSRCH",85,0)
 .. S OCNT=OCNT+1
"RTN","BSTSSRCH",86,0)
 .. ;
"RTN","BSTSSRCH",87,0)
 .. ;Grab BCTCHCT records
"RTN","BSTSSRCH",88,0)
 .. I +BCTCHCT>0,OCNT>(+BCTCHCT) Q
"RTN","BSTSSRCH",89,0)
 .. ;
"RTN","BSTSSRCH",90,0)
 .. ;Set up output
"RTN","BSTSSRCH",91,0)
 .. S @OUT@(OCNT)=RES
"RTN","BSTSSRCH",92,0)
 ;
"RTN","BSTSSRCH",93,0)
 K @TMP,@TMP2,^TMP("DILIST",$J,0)
"RTN","BSTSSRCH",94,0)
 ;
"RTN","BSTSSRCH",95,0)
 ;Return 1 on successful search
"RTN","BSTSSRCH",96,0)
 Q $S(OCNT>0:1,1:0)
"RTN","BSTSSRCH",97,0)
 ;
"RTN","BSTSSRCH",98,0)
FDESC(CIEN) ;EP - Retrieve Description Id of FSN
"RTN","BSTSSRCH",99,0)
 ;
"RTN","BSTSSRCH",100,0)
 N TIEN,NMID,DESC
"RTN","BSTSSRCH",101,0)
 ;
"RTN","BSTSSRCH",102,0)
 S NMID=$$GET1^DIQ(9002318.4,CIEN_",",.07,"E") Q:NMID="" ""
"RTN","BSTSSRCH",103,0)
 S (DESC,TIEN)="" F  S TIEN=$O(^BSTS(9002318.3,"C",NMID,CIEN,TIEN)) Q:TIEN=""  D  Q:DESC
"RTN","BSTSSRCH",104,0)
 . N TYPE
"RTN","BSTSSRCH",105,0)
 . S TYPE=$$GET1^DIQ(9002318.3,TIEN_",",.09,"I") I TYPE'="F" Q
"RTN","BSTSSRCH",106,0)
 . S DESC=$$GET1^DIQ(9002318.3,TIEN_",",.02,"E")
"RTN","BSTSSRCH",107,0)
 ;
"RTN","BSTSSRCH",108,0)
 Q DESC
"RTN","BSTSSRCH",109,0)
 ;
"RTN","BSTSSRCH",110,0)
PDESC(CIEN) ;EP - Retrieve Description Id of Preferred Term
"RTN","BSTSSRCH",111,0)
 ;
"RTN","BSTSSRCH",112,0)
 N TIEN,NMID,DESC
"RTN","BSTSSRCH",113,0)
 ;
"RTN","BSTSSRCH",114,0)
 S NMID=$$GET1^DIQ(9002318.4,CIEN_",",.07,"E") Q:NMID="" ""
"RTN","BSTSSRCH",115,0)
 S (DESC,TIEN)="" F  S TIEN=$O(^BSTS(9002318.3,"C",NMID,CIEN,TIEN)) Q:TIEN=""  D  Q:DESC
"RTN","BSTSSRCH",116,0)
 . N TYPE,TERM
"RTN","BSTSSRCH",117,0)
 . S TYPE=$$GET1^DIQ(9002318.3,TIEN_",",.09,"I")
"RTN","BSTSSRCH",118,0)
 . ;
"RTN","BSTSSRCH",119,0)
 . ;For SNOMED look for preferred
"RTN","BSTSSRCH",120,0)
 . ;For UNII look for FSN
"RTN","BSTSSRCH",121,0)
 . ;For RXNORM look for preferred
"RTN","BSTSSRCH",122,0)
 . I NMID=36,TYPE'="P" Q
"RTN","BSTSSRCH",123,0)
 . I NMID=5180,TYPE'="F" Q
"RTN","BSTSSRCH",124,0)
 . I NMID=1552,TYPE'="P" Q
"RTN","BSTSSRCH",125,0)
 . I NMID>32770,NMID<32780,TYPE'="F" Q
"RTN","BSTSSRCH",126,0)
 . ;
"RTN","BSTSSRCH",127,0)
 . S DESC=$$GET1^DIQ(9002318.3,TIEN_",",.02,"E")
"RTN","BSTSSRCH",128,0)
 . S TERM=$$GET1^DIQ(9002318.3,TIEN_",",1,"E")
"RTN","BSTSSRCH",129,0)
 . S DESC=DESC_U_TERM
"RTN","BSTSSRCH",130,0)
 ;
"RTN","BSTSSRCH",131,0)
 Q DESC
"RTN","BSTSSRCH",132,0)
 ;
"RTN","BSTSSRCH",133,0)
FND(N,SEARCH,NMID) ;Set up return entry
"RTN","BSTSSRCH",134,0)
 N ENT,CPT,FILTER,DESC,TERM,WGT,USEARCH,PC,UTERM
"RTN","BSTSSRCH",135,0)
 S CPT=$P(^TMP("DILIST",$J,N,0),U,4) Q:CPT=""
"RTN","BSTSSRCH",136,0)
 S ENT=$P(^BSTS(9002318.4,CPT,0),"^",2)_"^"_$P(^(0),"^",8)_"^"
"RTN","BSTSSRCH",137,0)
 S DESC=$P(^TMP("DILIST",$J,N,0),U,3) Q:DESC=""
"RTN","BSTSSRCH",138,0)
 S TERM=$P(^TMP("DILIST",$J,N,0),U,6)
"RTN","BSTSSRCH",139,0)
 ;
"RTN","BSTSSRCH",140,0)
 S FILTER=0
"RTN","BSTSSRCH",141,0)
 ;
"RTN","BSTSSRCH",142,0)
 ;Skip FSN terms and out of date entries
"RTN","BSTSSRCH",143,0)
 D  Q:FILTER
"RTN","BSTSSRCH",144,0)
 . N TIEN,TTYP
"RTN","BSTSSRCH",145,0)
 . S TIEN=$O(^BSTS(9002318.3,"D",INMID,DESC,"")) Q:TIEN=""
"RTN","BSTSSRCH",146,0)
 . S TTYP=$$GET1^DIQ(9002318.3,TIEN_",",.09,"I")
"RTN","BSTSSRCH",147,0)
 . ;I TTYP="F" S FILTER=1
"RTN","BSTSSRCH",148,0)
 . I ((NMID<32771)!(NMID>32780)),TTYP="F" S FILTER=1 Q
"RTN","BSTSSRCH",149,0)
 . I $$GET1^DIQ(9002318.3,TIEN_",",.11,"I")="Y" S FILTER=1
"RTN","BSTSSRCH",150,0)
 ;
"RTN","BSTSSRCH",151,0)
 ;Implement AND logic - must have all terms
"RTN","BSTSSRCH",152,0)
 D  Q:FILTER
"RTN","BSTSSRCH",153,0)
 . NEW PC
"RTN","BSTSSRCH",154,0)
 . FOR PC=1:1:$L(SEARCH," ") D  Q:FILTER
"RTN","BSTSSRCH",155,0)
 .. NEW WD
"RTN","BSTSSRCH",156,0)
 .. S WD=$P(SEARCH," ",PC)
"RTN","BSTSSRCH",157,0)
 .. ;
"RTN","BSTSSRCH",158,0)
 .. ;Strip out comparison words
"RTN","BSTSSRCH",159,0)
 .. I (WD="")!(WD="OR")!(WD="AND")!(WD="NOT") Q
"RTN","BSTSSRCH",160,0)
 .. I ($$UP^XLFSTR(TERM))'[($$UP^XLFSTR(WD)) S FILTER=1
"RTN","BSTSSRCH",161,0)
 ;
"RTN","BSTSSRCH",162,0)
 ;Determine weight value (look for exact match)
"RTN","BSTSSRCH",163,0)
 S USEARCH=$$UP^XLFSTR(SEARCH)
"RTN","BSTSSRCH",164,0)
 S UTERM=$$UP^XLFSTR(TERM)
"RTN","BSTSSRCH",165,0)
 S WGT=1 F PC=1:1:$L(USEARCH," ") I $P(USEARCH," ",PC)=$P(UTERM," ",PC) S WGT=WGT+1
"RTN","BSTSSRCH",166,0)
 I UTERM=USEARCH S WGT=WGT+5
"RTN","BSTSSRCH",167,0)
 ;
"RTN","BSTSSRCH",168,0)
 ;Log entry
"RTN","BSTSSRCH",169,0)
 I STYPE="F" S DESC=$P($$PDESC^BSTSSRCH(CPT),U) Q:DESC=""
"RTN","BSTSSRCH",170,0)
 S ENT=ENT_DESC
"RTN","BSTSSRCH",171,0)
 S @TMP@(ENT)=$G(@TMP@(ENT))+WGT
"RTN","BSTSSRCH",172,0)
 ;
"RTN","BSTSSRCH",173,0)
 Q
"RTN","BSTSSRCH",174,0)
 ;
"RTN","BSTSSRCH",175,0)
FLD ;;
"RTN","BSTSSRCH",176,0)
 ;;SEARCH^SEARCH
"RTN","BSTSSRCH",177,0)
 ;;STYPE^STYPE
"RTN","BSTSSRCH",178,0)
 ;;NAMESPACEID^NMID
"RTN","BSTSSRCH",179,0)
 ;;SUBSET^SUB
"RTN","BSTSSRCH",180,0)
 ;;SNAPDT^SNAPDT
"RTN","BSTSSRCH",181,0)
 ;;MAXRECS^MAX
"RTN","BSTSSRCH",182,0)
 ;;BCTCHRC^BCTCHRC
"RTN","BSTSSRCH",183,0)
 ;;BCTCHCT^BCTCHCT
"RTN","BSTSSRCH",184,0)
 ;;DEBUG^DEBUG
"RTN","BSTSSRCH",185,0)
 Q
"RTN","BSTSSRCH",186,0)
 ;
"RTN","BSTSSRCH",187,0)
SXF ;EP - Set cross-reference
"RTN","BSTSSRCH",188,0)
 S %1=1 F %=1:1:$L(X)+1 D
"RTN","BSTSSRCH",189,0)
 . S I=$E(X,%)
"RTN","BSTSSRCH",190,0)
 . I "(,.?! '/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1
"RTN","BSTSSRCH",191,0)
 . S I=$$UP^XLFSTR(I)
"RTN","BSTSSRCH",192,0)
 . I $L(I)>2,^DD("KWIC")'[I D
"RTN","BSTSSRCH",193,0)
 .. NEW CDSET
"RTN","BSTSSRCH",194,0)
 .. S CDSET=$$GET1^DIQ(9002318.3,DA_",",.08,"E") Q:CDSET=""
"RTN","BSTSSRCH",195,0)
 .. ;
"RTN","BSTSSRCH",196,0)
 .. ;Strip leading '-'/'+'
"RTN","BSTSSRCH",197,0)
 .. I "-+"[$E(I,1) S I=$E(I,2,9999)
"RTN","BSTSSRCH",198,0)
 .. ;
"RTN","BSTSSRCH",199,0)
 .. ;Strip quotes
"RTN","BSTSSRCH",200,0)
 .. S I=$TR(I,"""","")
"RTN","BSTSSRCH",201,0)
 .. ;
"RTN","BSTSSRCH",202,0)
 .. ;Save entry
"RTN","BSTSSRCH",203,0)
 .. S ^BSTS(9002318.3,"E",CDSET,I,DA)=""
"RTN","BSTSSRCH",204,0)
 Q
"RTN","BSTSSRCH",205,0)
 ;
"RTN","BSTSSRCH",206,0)
KXF ;EP - Kill cross-reference
"RTN","BSTSSRCH",207,0)
 S %1=1 F %=1:1:$L(X)+1 D
"RTN","BSTSSRCH",208,0)
 . S I=$E(X,%)
"RTN","BSTSSRCH",209,0)
 . I "(,.?! '/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1
"RTN","BSTSSRCH",210,0)
 . S I=$$UP^XLFSTR(I)
"RTN","BSTSSRCH",211,0)
 . I $L(I)>2 D
"RTN","BSTSSRCH",212,0)
 .. NEW CDSET
"RTN","BSTSSRCH",213,0)
 .. S CDSET=$$GET1^DIQ(9002318.3,DA_",",.08,"E") Q:CDSET=""
"RTN","BSTSSRCH",214,0)
 .. ;
"RTN","BSTSSRCH",215,0)
 .. ;Strip leading '-'/'+'
"RTN","BSTSSRCH",216,0)
 .. I "-+"[$E(I,1) S I=$E(I,2,9999)
"RTN","BSTSSRCH",217,0)
 .. ;
"RTN","BSTSSRCH",218,0)
 .. ;Strip quotes
"RTN","BSTSSRCH",219,0)
 .. S I=$TR(I,"""","")
"RTN","BSTSSRCH",220,0)
 .. ;
"RTN","BSTSSRCH",221,0)
 .. ;Kill entry
"RTN","BSTSSRCH",222,0)
 .. K ^BSTS(9002318.3,"E",CDSET,I,DA)
"RTN","BSTSSRCH",223,0)
 Q
"RTN","BSTSSRCH",224,0)
 ;
"RTN","BSTSSRCH",225,0)
DETAIL(OUT,BSTSWS,RESULT) ;EP - Return Details for each Concept/Term
"RTN","BSTSSRCH",226,0)
 ;
"RTN","BSTSSRCH",227,0)
 ;Return the concept detail
"RTN","BSTSSRCH",228,0)
 ;
"RTN","BSTSSRCH",229,0)
 ;Call moved to new routine because of space issues
"RTN","BSTSSRCH",230,0)
 Q $$DETAIL^BSTSCDET(OUT,.BSTSWS,.RESULT)
"RTN","BSTSTST")
0^13^B7200964
"RTN","BSTSTST",1,0)
BSTSTST ;GDIT/HS/BEE-Standard Terminology Web Service Test ;26-Jun-2015 18:12;DKM
"RTN","BSTSTST",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSTST",3,0)
 Q
"RTN","BSTSTST",4,0)
 ;
"RTN","BSTSTST",5,0)
TEST ;EP - BSTS TEST WEB SERVICE Option
"RTN","BSTSTST",6,0)
 ;
"RTN","BSTSTST",7,0)
 ; Select an existing web service and run sample calls for testing
"RTN","BSTSTST",8,0)
 ;
"RTN","BSTSTST",9,0)
 NEW DIC,Y,DIR,QUIT,DEBUG,SR,RES,SERV,IADT,SCNT,RESULT,DLAYGO
"RTN","BSTSTST",10,0)
 NEW DIROUT,DIRUT,DTOUT,DUOUT
"RTN","BSTSTST",11,0)
 ;
"RTN","BSTSTST",12,0)
 ;First Select the web service
"RTN","BSTSTST",13,0)
SRV S DIC="^BSTS(9002318.2,",DIC(0)="AEMNZ"
"RTN","BSTSTST",14,0)
 S DLAYGO=9002318.2 D ^DIC S SERV=+Y
"RTN","BSTSTST",15,0)
 I SERV=-1 Q
"RTN","BSTSTST",16,0)
 ;
"RTN","BSTSTST",17,0)
 ;Check if active
"RTN","BSTSTST",18,0)
 S IADT=$$GET1^DIQ(9002318.2,SERV_",",".1","I")
"RTN","BSTSTST",19,0)
 I IADT]"",IADT<DT W !!,"This Web Service is not Active",! H 2 G SRV
"RTN","BSTSTST",20,0)
 ;
"RTN","BSTSTST",21,0)
 ;Check for debug mode
"RTN","BSTSTST",22,0)
 S DIR(0)="Y",DIR("B")="N"
"RTN","BSTSTST",23,0)
 S DIR("A",1)=""
"RTN","BSTSTST",24,0)
 S DIR("A")="Display DTS connection log (Y/N): "
"RTN","BSTSTST",25,0)
 D ^DIR
"RTN","BSTSTST",26,0)
 S QUIT=$$CKANS()
"RTN","BSTSTST",27,0)
 ;
"RTN","BSTSTST",28,0)
 ;Check for "^", "^^", timeout
"RTN","BSTSTST",29,0)
 I QUIT>1 Q
"RTN","BSTSTST",30,0)
 S DEBUG=$S(Y=1:1,1:"")
"RTN","BSTSTST",31,0)
 ;
"RTN","BSTSTST",32,0)
 ;Perform test searches
"RTN","BSTSTST",33,0)
 S SCNT=0,RES=2 F SR="HEART DISEASE DISORDER","ANTENATAL CARE","EDEMA","DIABETES" D  I RES<2 Q
"RTN","BSTSTST",34,0)
 . S SCNT=SCNT+1
"RTN","BSTSTST",35,0)
 . W !!,"Performing search on term: ",SR
"RTN","BSTSTST",36,0)
 . S RES=$$CALL(SERV,SR,DEBUG)
"RTN","BSTSTST",37,0)
 . S RESULT(SCNT)=SR_U_RES
"RTN","BSTSTST",38,0)
 ;
"RTN","BSTSTST",39,0)
 ;Loop through and display results
"RTN","BSTSTST",40,0)
 W !!,"TEST RESULTS FOR ",$$GET1^DIQ(9002318.2,SERV_",",.01,"I")
"RTN","BSTSTST",41,0)
 S SCNT="" F  S SCNT=$O(RESULT(SCNT)) Q:SCNT=""  D
"RTN","BSTSTST",42,0)
 . N RES
"RTN","BSTSTST",43,0)
 . S RES=RESULT(SCNT)
"RTN","BSTSTST",44,0)
 . W !!,"Search Term: ",$P(RES,U)
"RTN","BSTSTST",45,0)
 . W !,"Search Result: ",$S(+$P(RES,U,2)=2:"Success",1:"Fail")
"RTN","BSTSTST",46,0)
 . W !,"Error Message: ",$S($P(RES,U,3)]"":$P(RES,U,3),1:"N/A")
"RTN","BSTSTST",47,0)
 . W !,"Call Completion Time: ",$P(RES,U,4)
"RTN","BSTSTST",48,0)
 ;
"RTN","BSTSTST",49,0)
 ;Check for new test
"RTN","BSTSTST",50,0)
 S DIR(0)="Y",DIR("B")="N"
"RTN","BSTSTST",51,0)
 S DIR("A",1)=""
"RTN","BSTSTST",52,0)
 S DIR("A")="Run another test (Y/N): "
"RTN","BSTSTST",53,0)
 D ^DIR
"RTN","BSTSTST",54,0)
 S QUIT=$$CKANS()
"RTN","BSTSTST",55,0)
 ;
"RTN","BSTSTST",56,0)
 ;Check for "^", "^^", timeout
"RTN","BSTSTST",57,0)
 I QUIT>1!('Y) Q
"RTN","BSTSTST",58,0)
 K RESULT
"RTN","BSTSTST",59,0)
 G SRV
"RTN","BSTSTST",60,0)
 ;
"RTN","BSTSTST",61,0)
CKANS() ;EP - Check answer "^", "^^", and timeout
"RTN","BSTSTST",62,0)
 ;
"RTN","BSTSTST",63,0)
 ;User typed "^^"
"RTN","BSTSTST",64,0)
 I $G(DIROUT) Q 3
"RTN","BSTSTST",65,0)
 ;
"RTN","BSTSTST",66,0)
 ;User typed "^" or timed out
"RTN","BSTSTST",67,0)
 I $G(DUOUT)!$G(DTOUT) Q 2
"RTN","BSTSTST",68,0)
 ;
"RTN","BSTSTST",69,0)
 ;User hit ENTER
"RTN","BSTSTST",70,0)
 I $G(DIRUT) Q 1
"RTN","BSTSTST",71,0)
 ;
"RTN","BSTSTST",72,0)
 Q 0
"RTN","BSTSTST",73,0)
 ;
"RTN","BSTSTST",74,0)
CALL(SERV,SEARCH,DEBUG) ;EP - Perform Test Search
"RTN","BSTSTST",75,0)
 ;
"RTN","BSTSTST",76,0)
 N RESULT,BSTSR,BSTSWS,RES
"RTN","BSTSTST",77,0)
 ;
"RTN","BSTSTST",78,0)
 S BSTSWS("SEARCH")=SEARCH
"RTN","BSTSTST",79,0)
 S BSTSWS("STYPE")="S"
"RTN","BSTSTST",80,0)
 S BSTSWS("NAMESPACEID")=36
"RTN","BSTSTST",81,0)
 S BSTSWS("SUBSET")="IHS Problem List"
"RTN","BSTSTST",82,0)
 S BSTSWS("SNAPDT")=""
"RTN","BSTSTST",83,0)
 S BSTSWS("MAXRECS")=100
"RTN","BSTSTST",84,0)
 S BSTSWS("BCTCHRC")=""
"RTN","BSTSTST",85,0)
 S BSTSWS("BCTCHCT")=""
"RTN","BSTSTST",86,0)
 S BSTSWS("RET")="PSCBIXAV"
"RTN","BSTSTST",87,0)
 S BSTSWS("DAT")=""
"RTN","BSTSTST",88,0)
 S BSTSWS("SERVICE")=SERV
"RTN","BSTSTST",89,0)
 ;
"RTN","BSTSTST",90,0)
 ;Make DTS search call
"RTN","BSTSTST",91,0)
 S BSTSR=1
"RTN","BSTSTST",92,0)
 ;
"RTN","BSTSTST",93,0)
 ;Perform Test Lookup
"RTN","BSTSTST",94,0)
 S BSTSR=$$TEST^BSTSWSV("RESULT",.BSTSWS,DEBUG) S:+BSTSR $P(BSTSR,U)=2
"RTN","BSTSTST",95,0)
 ;
"RTN","BSTSTST",96,0)
 Q BSTSR
"RTN","BSTSUPD")
0^7^B840054
"RTN","BSTSUPD",1,0)
BSTSUPD ;GDIT/HS/ALA-Update parameters ;26-Jun-2015 18:12;DKM
"RTN","BSTSUPD",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSUPD",3,0)
 Q
"RTN","BSTSUPD",4,0)
 ;
"RTN","BSTSUPD",5,0)
WEB ;EP - Update Web Services
"RTN","BSTSUPD",6,0)
 ; Add a new service and update the associated fields
"RTN","BSTSUPD",7,0)
 ; Edit an existing service's associated fields
"RTN","BSTSUPD",8,0)
 NEW DA,DIC,DIE,DR,Y,DLAYGO
"RTN","BSTSUPD",9,0)
 S DIC="^BSTS(9002318.2,",DIC(0)="AELMNZ",DIE=DIC,DR="[BSTS ADD/EDIT WEB SERVICE]"
"RTN","BSTSUPD",10,0)
 S DLAYGO=9002318.2 D ^DIC S DA=+Y
"RTN","BSTSUPD",11,0)
 I DA=-1 Q
"RTN","BSTSUPD",12,0)
 D ^DIE
"RTN","BSTSUPD",13,0)
 Q
"RTN","BSTSUPD",14,0)
 ;
"RTN","BSTSUPD",15,0)
SIT ;EP - Update Site parameters
"RTN","BSTSUPD",16,0)
 ; Update the web services for a site
"RTN","BSTSUPD",17,0)
 NEW DA,DIC,DIE,DR,Y,DLAYGO
"RTN","BSTSUPD",18,0)
 S DIC="^BSTS(9002318,",DIC(0)="AEMNZ",DIE=DIC,DR="[BSTS EDIT SITE PARAMETERS]"
"RTN","BSTSUPD",19,0)
 S DLAYGO=9002318 D ^DIC S DA=+Y
"RTN","BSTSUPD",20,0)
 I DA=-1 Q
"RTN","BSTSUPD",21,0)
 D ^DIE
"RTN","BSTSUPD",22,0)
 Q
"RTN","BSTSUTIL")
0^5^B114103788
"RTN","BSTSUTIL",1,0)
BSTSUTIL ;GDIT/HS/BEE-Standard Terminology Utility Program ;26-Jun-2015 18:12;DKM
"RTN","BSTSUTIL",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSUTIL",3,0)
 ;
"RTN","BSTSUTIL",4,0)
 Q
"RTN","BSTSUTIL",5,0)
 ;
"RTN","BSTSUTIL",6,0)
DTCHG(X1,X2) ;EP - ADD/SUBTRACT FROM DATE
"RTN","BSTSUTIL",7,0)
 ;
"RTN","BSTSUTIL",8,0)
 NEW X,%H
"RTN","BSTSUTIL",9,0)
 I $G(X1)="" Q ""
"RTN","BSTSUTIL",10,0)
 I $G(X2)="" Q ""
"RTN","BSTSUTIL",11,0)
 ;
"RTN","BSTSUTIL",12,0)
 D C^%DTC
"RTN","BSTSUTIL",13,0)
 Q X
"RTN","BSTSUTIL",14,0)
 ;
"RTN","BSTSUTIL",15,0)
EP2FMDT(MSECS,DTONLY) ;EP - Convert UNIX (EPOCH) Date to FileMan Date (and Time)
"RTN","BSTSUTIL",16,0)
 ;
"RTN","BSTSUTIL",17,0)
 ;Input
"RTN","BSTSUTIL",18,0)
 ; MSECS  - UNIX (EPOCH) date - Milliseconds since Jan 1, 1970
"RTN","BSTSUTIL",19,0)
 ; DTONLY (Optional) - If 1, return only date portion
"RTN","BSTSUTIL",20,0)
 ;
"RTN","BSTSUTIL",21,0)
 ;Output
"RTN","BSTSUTIL",22,0)
 ; FDT - FileMan Date format
"RTN","BSTSUTIL",23,0)
 ;
"RTN","BSTSUTIL",24,0)
 NEW MDATE,MTIME
"RTN","BSTSUTIL",25,0)
 S DTONLY=$G(DTONLY),DTONLY=$S(DTONLY="1":"1",1:"")
"RTN","BSTSUTIL",26,0)
 Q:MSECS'?12.13N "" ; Do not convert date beyond 11/19/2280
"RTN","BSTSUTIL",27,0)
 S MSECS=MSECS\1000
"RTN","BSTSUTIL",28,0)
 S MDATE=(MSECS\86400+47117)
"RTN","BSTSUTIL",29,0)
 S MTIME=+(MSECS#86400)
"RTN","BSTSUTIL",30,0)
 ;
"RTN","BSTSUTIL",31,0)
 Q $$HTFM^XLFDT(MDATE_","_MTIME,DTONLY)
"RTN","BSTSUTIL",32,0)
 ;
"RTN","BSTSUTIL",33,0)
EP2EXDT(MSECS,FORMAT) ;EP - Convert UNIX (EPOCH) Date to External Date (and Time)
"RTN","BSTSUTIL",34,0)
 ;
"RTN","BSTSUTIL",35,0)
 ;Input
"RTN","BSTSUTIL",36,0)
 ; MSECS  - UNIX (EPOCH) date - Milliseconds since Jan 1, 1970
"RTN","BSTSUTIL",37,0)
 ; FORMAT - XLFDT format field (optional) - default is "5DZ"
"RTN","BSTSUTIL",38,0)
 ;
"RTN","BSTSUTIL",39,0)
 ;Output
"RTN","BSTSUTIL",40,0)
 ; FDT - External Date (Time) format
"RTN","BSTSUTIL",41,0)
 ;
"RTN","BSTSUTIL",42,0)
 NEW MDATE,MTIME
"RTN","BSTSUTIL",43,0)
 S FORMAT=$G(FORMAT,"") S:FORMAT="" FORMAT="5DZ"
"RTN","BSTSUTIL",44,0)
 Q:MSECS'?12.13N "" ; Do not convert date beyond 11/19/2280
"RTN","BSTSUTIL",45,0)
 S MSECS=MSECS\1000
"RTN","BSTSUTIL",46,0)
 S MDATE=(MSECS\86400+47117)
"RTN","BSTSUTIL",47,0)
 S MTIME=+(MSECS#86400)
"RTN","BSTSUTIL",48,0)
 ;
"RTN","BSTSUTIL",49,0)
 Q $$HTE^XLFDT(MDATE_","_MTIME,FORMAT)
"RTN","BSTSUTIL",50,0)
 ;
"RTN","BSTSUTIL",51,0)
FMDT2EP(FDT) ;EP - FileMan Date (and Time) to UNIX (EPOCH) Date
"RTN","BSTSUTIL",52,0)
 ;
"RTN","BSTSUTIL",53,0)
 ;Input
"RTN","BSTSUTIL",54,0)
 ; FDT - FileMan Date (and Time)
"RTN","BSTSUTIL",55,0)
 ;
"RTN","BSTSUTIL",56,0)
 ;Output
"RTN","BSTSUTIL",57,0)
 ; MSECS  - UNIX (EPOCH) date - Milliseconds since Jan 1, 1970
"RTN","BSTSUTIL",58,0)
 ;
"RTN","BSTSUTIL",59,0)
 NEW DOLH,DOLD,DOLT,EPOCH
"RTN","BSTSUTIL",60,0)
 S DOLH=$$FMTH^XLFDT(FDT)
"RTN","BSTSUTIL",61,0)
 S DOLD=+$P(DOLH,",")
"RTN","BSTSUTIL",62,0)
 S DOLT=+$P(DOLH,",",2)
"RTN","BSTSUTIL",63,0)
 S EPOCH=((DOLD-47117)*86400)+DOLT
"RTN","BSTSUTIL",64,0)
 ;
"RTN","BSTSUTIL",65,0)
 Q (EPOCH*1000)
"RTN","BSTSUTIL",66,0)
 ;
"RTN","BSTSUTIL",67,0)
EXDT2EP(EXDT) ;EP - External Date (and Time) to UNIX (EPOCH) Date
"RTN","BSTSUTIL",68,0)
 ;
"RTN","BSTSUTIL",69,0)
 ;Input
"RTN","BSTSUTIL",70,0)
 ; EXDT - External Date (and Time)
"RTN","BSTSUTIL",71,0)
 ;
"RTN","BSTSUTIL",72,0)
 ;Output
"RTN","BSTSUTIL",73,0)
 ; MSECS  - UNIX (EPOCH) date - Milliseconds since Jan 1, 1970
"RTN","BSTSUTIL",74,0)
 ;
"RTN","BSTSUTIL",75,0)
 NEW DOLH,DOLD,DOLT,EPOCH,X,Y,%DT
"RTN","BSTSUTIL",76,0)
 S X=EXDT,%DT="TS"
"RTN","BSTSUTIL",77,0)
 D ^%DT
"RTN","BSTSUTIL",78,0)
 I Y="-1" Q Y  ;Invalid date
"RTN","BSTSUTIL",79,0)
 ;
"RTN","BSTSUTIL",80,0)
 S DOLH=$$FMTH^XLFDT(Y)
"RTN","BSTSUTIL",81,0)
 S DOLD=+$P(DOLH,",")
"RTN","BSTSUTIL",82,0)
 S DOLT=+$P(DOLH,",",2)
"RTN","BSTSUTIL",83,0)
 S EPOCH=((DOLD-47117)*86400)+DOLT
"RTN","BSTSUTIL",84,0)
 ;
"RTN","BSTSUTIL",85,0)
 Q (EPOCH*1000)
"RTN","BSTSUTIL",86,0)
 ;
"RTN","BSTSUTIL",87,0)
DATE(DATE) ;EP - Convert standard date/time to a FileMan date/time
"RTN","BSTSUTIL",88,0)
 ;Input
"RTN","BSTSUTIL",89,0)
 ;  DATE - In a standard format
"RTN","BSTSUTIL",90,0)
 ;Output
"RTN","BSTSUTIL",91,0)
 ;  -1 is if it couldn't convert to a FileMan date
"RTN","BSTSUTIL",92,0)
 ;  otherwise a standard FileMan date
"RTN","BSTSUTIL",93,0)
 NEW %DT,X,Y
"RTN","BSTSUTIL",94,0)
 I DATE[":" D
"RTN","BSTSUTIL",95,0)
 . I DATE["/",$L(DATE," ")=3 S DATE=$P(DATE," ",1)_"@"_$P(DATE," ",2)_$P(DATE," ",3) Q
"RTN","BSTSUTIL",96,0)
 . I $L(DATE," ")=3 S DATE=$P(DATE," ",1,2)_"@"_$P(DATE," ",3)
"RTN","BSTSUTIL",97,0)
 . I $L(DATE," ")>3 S DATE=$P(DATE," ",1,3)_"@"_$P(DATE," ",4,99)
"RTN","BSTSUTIL",98,0)
 S %DT="TS",X=DATE D ^%DT
"RTN","BSTSUTIL",99,0)
 I Y=-1 S Y=""
"RTN","BSTSUTIL",100,0)
 ;
"RTN","BSTSUTIL",101,0)
 Q Y
"RTN","BSTSUTIL",102,0)
 ;
"RTN","BSTSUTIL",103,0)
DTS2FMDT(DATE,FORMAT) ;EP - Convert Date/Time from DTS to a FileMan date/time
"RTN","BSTSUTIL",104,0)
 ;Input
"RTN","BSTSUTIL",105,0)
 ;  DATE - In a standard format - 'CCYY-MM-DD HH:MM:SS'
"RTN","BSTSUTIL",106,0)
 ;  FORMAT - 1 - Return Date only
"RTN","BSTSUTIL",107,0)
 ;
"RTN","BSTSUTIL",108,0)
 ;Output
"RTN","BSTSUTIL",109,0)
 ;  -1 is if it couldn't convert to a FileMan date - 'CYYMMDD'
"RTN","BSTSUTIL",110,0)
 ;  otherwise a standard FileMan date
"RTN","BSTSUTIL",111,0)
 NEW %DT,X,Y
"RTN","BSTSUTIL",112,0)
 ;
"RTN","BSTSUTIL",113,0)
 S %DT="T"
"RTN","BSTSUTIL",114,0)
 S X=$P(DATE,"-",2)_"/"_$P($P(DATE,"-",3)," ")_"/"_$P(DATE,"-")
"RTN","BSTSUTIL",115,0)
 ;
"RTN","BSTSUTIL",116,0)
 I $G(FORMAT)'=1 D
"RTN","BSTSUTIL",117,0)
 . I $P(DATE," ",2)[":" S X=X_"@"_$P(DATE," ",2,99)
"RTN","BSTSUTIL",118,0)
 . S %DT="ST"
"RTN","BSTSUTIL",119,0)
 D ^%DT
"RTN","BSTSUTIL",120,0)
 ;
"RTN","BSTSUTIL",121,0)
 I Y=-1 S Y=""
"RTN","BSTSUTIL",122,0)
 ;
"RTN","BSTSUTIL",123,0)
 Q Y
"RTN","BSTSUTIL",124,0)
 ;
"RTN","BSTSUTIL",125,0)
FMDT2XML(DATE) ;EP - Convert Date/Time from FileMan to XML
"RTN","BSTSUTIL",126,0)
 ;Input
"RTN","BSTSUTIL",127,0)
 ;  DATE - In a standard FileMan format
"RTN","BSTSUTIL",128,0)
 ;
"RTN","BSTSUTIL",129,0)
 ;Output
"RTN","BSTSUTIL",130,0)
 ;  Convert to a XML date - 'CCYY-MM-DD HH:MM:SS'
"RTN","BSTSUTIL",131,0)
 ;
"RTN","BSTSUTIL",132,0)
 NEW X
"RTN","BSTSUTIL",133,0)
 S X=$S($E(DATE,1)="2":"19",1:"20")_$E(DATE,2,3)_"-"_$E(DATE,4,5)_"-"_$E(DATE,6,7)_"T00:00:00"
"RTN","BSTSUTIL",134,0)
 ;
"RTN","BSTSUTIL",135,0)
 Q X
"RTN","BSTSUTIL",136,0)
 ;
"RTN","BSTSUTIL",137,0)
SQL2XML(DATE) ;EP - Convert date from SQL to XML formats
"RTN","BSTSUTIL",138,0)
 ;Input
"RTN","BSTSUTIL",139,0)
 ;  DATE - In SQL format - 'JUN 13, 2013'
"RTN","BSTSUTIL",140,0)
 ;
"RTN","BSTSUTIL",141,0)
 ;Output
"RTN","BSTSUTIL",142,0)
 ;  "" is if it couldn't convert to a XML date - '2013-06-13T00:00:00'
"RTN","BSTSUTIL",143,0)
 ;
"RTN","BSTSUTIL",144,0)
 ;NEW %DT,X,Y,FMDT,M,D
"RTN","BSTSUTIL",145,0)
 ;
"RTN","BSTSUTIL",146,0)
 ;S %DT="TS",X=DATE D ^%DT
"RTN","BSTSUTIL",147,0)
 ;I Y=-1 Q ""
"RTN","BSTSUTIL",148,0)
 NEW %DT,X,Y,FMDT,M,D
"RTN","BSTSUTIL",149,0)
 I DATE[":" D
"RTN","BSTSUTIL",150,0)
 . I DATE["/",$L(DATE," ")=3 S DATE=$P(DATE," ",1)_"@"_$P(DATE," ",2)_$P(DATE," ",3) Q
"RTN","BSTSUTIL",151,0)
 . I $L(DATE," ")=3 S DATE=$P(DATE," ",1,2)_"@"_$P(DATE," ",3)
"RTN","BSTSUTIL",152,0)
 . I $L(DATE," ")>3 S DATE=$P(DATE," ",1,3)_"@"_$P(DATE," ",4,99)
"RTN","BSTSUTIL",153,0)
 S %DT="TS",X=DATE D ^%DT
"RTN","BSTSUTIL",154,0)
 I Y=-1 Q ""
"RTN","BSTSUTIL",155,0)
 ;
"RTN","BSTSUTIL",156,0)
 S Y=$$FMTE^XLFDT($P(Y,"."),"7")
"RTN","BSTSUTIL",157,0)
 S M=$P(Y,"/",2) S:$L(M)=1 M="0"_M
"RTN","BSTSUTIL",158,0)
 S D=$P(Y,"/",3) S:$L(D)=1 D="0"_D
"RTN","BSTSUTIL",159,0)
 S Y=$P(Y,"/")
"RTN","BSTSUTIL",160,0)
 S Y=Y_"-"_M_"-"_D_"T00:00:01"
"RTN","BSTSUTIL",161,0)
 Q Y
"RTN","BSTSUTIL",162,0)
 ;
"RTN","BSTSUTIL",163,0)
FMTE(Y) ;EP - Convert Fileman Date/Time to 'MMM DD, CCYY HH:MM:SS' format.
"RTN","BSTSUTIL",164,0)
 ;Description
"RTN","BSTSUTIL",165,0)
 ;  Receives Date (Y) in FileMan format and returns formatted date.
"RTN","BSTSUTIL",166,0)
 ;
"RTN","BSTSUTIL",167,0)
 ;Input
"RTN","BSTSUTIL",168,0)
 ;  Y - FileMan date/time (i.e. 3051024.123456).
"RTN","BSTSUTIL",169,0)
 ;
"RTN","BSTSUTIL",170,0)
 ;Output
"RTN","BSTSUTIL",171,0)
 ;  Date/Time in External format (i.e. OCT 24,2005 12:34:56).
"RTN","BSTSUTIL",172,0)
 ;
"RTN","BSTSUTIL",173,0)
 NEW DATM,XX,I,V,DA
"RTN","BSTSUTIL",174,0)
 S DATM=$TR($$FMTE^DILIBF(Y,"5U"),"@"," ")
"RTN","BSTSUTIL",175,0)
 I DATM["24:00" S DATM=$P(DATM," ",1,2)_" 00:00"
"RTN","BSTSUTIL",176,0)
 S XX="" F I=1:1:$L(DATM) S V=$E(DATM,I,I),XX=XX_V I V="," S XX=XX_" "
"RTN","BSTSUTIL",177,0)
 S DATM=XX
"RTN","BSTSUTIL",178,0)
 Q DATM
"RTN","BSTSUTIL",179,0)
 ;
"RTN","BSTSUTIL",180,0)
WRAP(OUT,TEXT,RM,IND) ;EP - Wrap the text and insert in array
"RTN","BSTSUTIL",181,0)
 ;
"RTN","BSTSUTIL",182,0)
 NEW SP
"RTN","BSTSUTIL",183,0)
 ;
"RTN","BSTSUTIL",184,0)
 I $G(TEXT)="" S OUT(1)="" Q
"RTN","BSTSUTIL",185,0)
 I $G(RM)="" Q
"RTN","BSTSUTIL",186,0)
 I $G(IND)="" S IND=0
"RTN","BSTSUTIL",187,0)
 S $P(SP," ",80)=" "
"RTN","BSTSUTIL",188,0)
 ;
"RTN","BSTSUTIL",189,0)
 ;Strip out $c(10)
"RTN","BSTSUTIL",190,0)
 S TEXT=$TR(TEXT,$C(10))
"RTN","BSTSUTIL",191,0)
 ;
"RTN","BSTSUTIL",192,0)
 F  I $L(TEXT)>0 D  Q:$L(TEXT)=0
"RTN","BSTSUTIL",193,0)
 . NEW PIECE,SPACE,LINE
"RTN","BSTSUTIL",194,0)
 . S PIECE=$E(TEXT,1,RM)
"RTN","BSTSUTIL",195,0)
 . ;
"RTN","BSTSUTIL",196,0)
 . ;Handle Line feeds
"RTN","BSTSUTIL",197,0)
 . I PIECE[$C(13) D  Q
"RTN","BSTSUTIL",198,0)
 .. NEW LINE,I
"RTN","BSTSUTIL",199,0)
 .. S LINE=$P(PIECE,$C(13)) S:LINE="" LINE=" "
"RTN","BSTSUTIL",200,0)
 .. S OUT=$G(OUT)+1,OUT(OUT)=LINE
"RTN","BSTSUTIL",201,0)
 .. F I=1:1:$L(PIECE) I $E(PIECE,I)=$C(13) Q
"RTN","BSTSUTIL",202,0)
 .. S TEXT=$E(SP,1,IND)_$$STZ($E(TEXT,I+1,9999999999))
"RTN","BSTSUTIL",203,0)
 . ;
"RTN","BSTSUTIL",204,0)
 . ;Check if line is less than right margin
"RTN","BSTSUTIL",205,0)
 . I $L(PIECE)<RM S OUT=$G(OUT)+1,OUT(OUT)=PIECE,TEXT="" Q
"RTN","BSTSUTIL",206,0)
 . ;
"RTN","BSTSUTIL",207,0)
 . ;Locate last space in line and handle if no space
"RTN","BSTSUTIL",208,0)
 . F SPACE=$L(PIECE):-1:(IND+1) I $E(PIECE,SPACE)=" " Q
"RTN","BSTSUTIL",209,0)
 . I (SPACE=(IND+1)) D  S:TEXT]"" TEXT=$E(SP,1,IND)_TEXT Q
"RTN","BSTSUTIL",210,0)
 .. S LINE=PIECE,OUT=$G(OUT)+1,OUT(OUT)=LINE,TEXT=$$STZ($E(TEXT,RM+1,999999999))
"RTN","BSTSUTIL",211,0)
 . ;
"RTN","BSTSUTIL",212,0)
 . ;Handle line with space
"RTN","BSTSUTIL",213,0)
 . S LINE=$E(PIECE,1,SPACE-1),OUT=$G(OUT)+1,OUT(OUT)=LINE,TEXT=$$STZ($E(TEXT,SPACE+1,999999999))
"RTN","BSTSUTIL",214,0)
 . S:TEXT]"" TEXT=$E(SP,1,IND)_TEXT
"RTN","BSTSUTIL",215,0)
 ;
"RTN","BSTSUTIL",216,0)
 Q
"RTN","BSTSUTIL",217,0)
 ;
"RTN","BSTSUTIL",218,0)
STZ(TEXT) ;EP - Strip Leading Spaces
"RTN","BSTSUTIL",219,0)
 NEW START
"RTN","BSTSUTIL",220,0)
 F START=1:1:$L(TEXT) I $E(TEXT,START)'=" " Q
"RTN","BSTSUTIL",221,0)
 Q $E(TEXT,START,9999999999)
"RTN","BSTSUTIL",222,0)
 ;
"RTN","BSTSUTIL",223,0)
ICDSX ;EP - Set cross-reference
"RTN","BSTSUTIL",224,0)
 NEW CSET
"RTN","BSTSUTIL",225,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",226,0)
 S ^BSTS(9002318.4,"F",CSET,X,DA(1))=""
"RTN","BSTSUTIL",227,0)
 Q
"RTN","BSTSUTIL",228,0)
 ;
"RTN","BSTSUTIL",229,0)
ICDKX ;EP - Kill cross-reference
"RTN","BSTSUTIL",230,0)
 NEW CSET
"RTN","BSTSUTIL",231,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",232,0)
 K ^BSTS(9002318.4,"F",CSET,X,DA(1))
"RTN","BSTSUTIL",233,0)
 Q
"RTN","BSTSUTIL",234,0)
 ;
"RTN","BSTSUTIL",235,0)
SBSX ;EP - Set cross-reference
"RTN","BSTSUTIL",236,0)
 NEW CSET
"RTN","BSTSUTIL",237,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",238,0)
 S ^BSTS(9002318.4,"E",CSET,X,DA(1),DA)=""
"RTN","BSTSUTIL",239,0)
 Q
"RTN","BSTSUTIL",240,0)
 ;
"RTN","BSTSUTIL",241,0)
SBKX ;EP - Kill cross-reference
"RTN","BSTSUTIL",242,0)
 NEW CSET
"RTN","BSTSUTIL",243,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",244,0)
 K ^BSTS(9002318.4,"E",CSET,X,DA(1),DA)
"RTN","BSTSUTIL",245,0)
 Q
"RTN","BSTSUTIL",246,0)
 ;
"RTN","BSTSUTIL",247,0)
NDSX ;EP - Set cross-reference
"RTN","BSTSUTIL",248,0)
 NEW CSET
"RTN","BSTSUTIL",249,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",250,0)
 S ^BSTS(9002318.4,"G",CSET,X,DA(1),DA)=""
"RTN","BSTSUTIL",251,0)
 Q
"RTN","BSTSUTIL",252,0)
 ;
"RTN","BSTSUTIL",253,0)
NDKX ;EP - Kill cross-reference
"RTN","BSTSUTIL",254,0)
 NEW CSET
"RTN","BSTSUTIL",255,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",256,0)
 K ^BSTS(9002318.4,"G",CSET,X,DA(1),DA)
"RTN","BSTSUTIL",257,0)
 Q
"RTN","BSTSUTIL",258,0)
 ;
"RTN","BSTSUTIL",259,0)
VUSX ;EP - Set cross-reference
"RTN","BSTSUTIL",260,0)
 NEW CSET
"RTN","BSTSUTIL",261,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",262,0)
 S ^BSTS(9002318.4,"H",CSET,X,DA(1),DA)=""
"RTN","BSTSUTIL",263,0)
 Q
"RTN","BSTSUTIL",264,0)
 ;
"RTN","BSTSUTIL",265,0)
VUKX ;EP - Kill cross-reference
"RTN","BSTSUTIL",266,0)
 NEW CSET
"RTN","BSTSUTIL",267,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",268,0)
 K ^BSTS(9002318.4,"H",CSET,X,DA(1),DA)
"RTN","BSTSUTIL",269,0)
 Q
"RTN","BSTSUTIL",270,0)
 ;
"RTN","BSTSUTIL",271,0)
 ;
"RTN","BSTSUTIL",272,0)
I2SSX ;EP - Set cross-reference
"RTN","BSTSUTIL",273,0)
 NEW CSET
"RTN","BSTSUTIL",274,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",275,0)
 S ^BSTS(9002318.4,"I",CSET,X,DA(1))=""
"RTN","BSTSUTIL",276,0)
 Q
"RTN","BSTSUTIL",277,0)
 ;
"RTN","BSTSUTIL",278,0)
I2SKX ;EP - Kill cross-reference
"RTN","BSTSUTIL",279,0)
 NEW CSET
"RTN","BSTSUTIL",280,0)
 S CSET=$$CSET() I CSET="" Q
"RTN","BSTSUTIL",281,0)
 K ^BSTS(9002318.4,"I",CSET,X,DA(1))
"RTN","BSTSUTIL",282,0)
 Q
"RTN","BSTSUTIL",283,0)
 ;
"RTN","BSTSUTIL",284,0)
CSET() ;EP - Get the codeset
"RTN","BSTSUTIL",285,0)
 Q $P($G(^BSTS(9002318.4,DA(1),0)),U,7)
"RTN","BSTSUTIL",286,0)
 ;
"RTN","BSTSUTIL",287,0)
DEL ;EP - Delete a codeset from cache
"RTN","BSTSUTIL",288,0)
 ;
"RTN","BSTSUTIL",289,0)
 NEW NMID,C,DIR,X,Y
"RTN","BSTSUTIL",290,0)
 ;
"RTN","BSTSUTIL",291,0)
 S DIR(0)="F"
"RTN","BSTSUTIL",292,0)
 S DIR("A")="Enter codeset IEN to clear out: "
"RTN","BSTSUTIL",293,0)
 D ^DIR
"RTN","BSTSUTIL",294,0)
 I +Y<1 Q
"RTN","BSTSUTIL",295,0)
 S NMID=+Y
"RTN","BSTSUTIL",296,0)
 ;
"RTN","BSTSUTIL",297,0)
 I '$D(^BSTS(9002318.3,"C",NMID)) W !!,"No entries defined for codeset" H 2 Q
"RTN","BSTSUTIL",298,0)
 ;
"RTN","BSTSUTIL",299,0)
 ;Loop through index and clear out each entry
"RTN","BSTSUTIL",300,0)
 W !!,"DELETING TERMS"
"RTN","BSTSUTIL",301,0)
 S C="" F  S C=$O(^BSTS(9002318.3,"C",NMID,C)) Q:C=""  D
"RTN","BSTSUTIL",302,0)
 . NEW TIEN,DA,DIK
"RTN","BSTSUTIL",303,0)
 . S TIEN="" F  S TIEN=$O(^BSTS(9002318.3,"C",NMID,C,TIEN)) Q:TIEN=""  D
"RTN","BSTSUTIL",304,0)
 .. W !,"TIEN: ",TIEN,?10,$G(^BSTS(9002318.3,TIEN,0))
"RTN","BSTSUTIL",305,0)
 .. S DA=TIEN,DIK="^BSTS(9002318.3,"
"RTN","BSTSUTIL",306,0)
 .. D ^DIK
"RTN","BSTSUTIL",307,0)
 ;
"RTN","BSTSUTIL",308,0)
 W !!,"DELETING CONCEPTS"
"RTN","BSTSUTIL",309,0)
 S C="" F  S C=$O(^BSTS(9002318.4,"C",NMID,C)) Q:C=""  D
"RTN","BSTSUTIL",310,0)
 . NEW CIEN,DA,DIK
"RTN","BSTSUTIL",311,0)
 . S CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"C",NMID,C,CIEN)) Q:CIEN=""  D
"RTN","BSTSUTIL",312,0)
 .. W !,"CIEN: ",CIEN,?10,$G(^BSTS(9002318.4,CIEN,0))
"RTN","BSTSUTIL",313,0)
 .. S DA=CIEN,DIK="^BSTS(9002318.4,"
"RTN","BSTSUTIL",314,0)
 .. D ^DIK
"RTN","BSTSUTIL",315,0)
 Q
"RTN","BSTSUTIL",316,0)
 ;
"RTN","BSTSUTIL",317,0)
TKO(STR,VAL) ;EP - Take off ending character
"RTN","BSTSUTIL",318,0)
 ;
"RTN","BSTSUTIL",319,0)
 ;Description
"RTN","BSTSUTIL",320,0)
 ;  This will take off the ending character at the end of
"RTN","BSTSUTIL",321,0)
 ;  a string
"RTN","BSTSUTIL",322,0)
 ;Input
"RTN","BSTSUTIL",323,0)
 ;  STR - String of data
"RTN","BSTSUTIL",324,0)
 ;  VAL - Delimiter character
"RTN","BSTSUTIL",325,0)
 ;Output
"RTN","BSTSUTIL",326,0)
 ;  same STR without the ending character
"RTN","BSTSUTIL",327,0)
 ;
"RTN","BSTSUTIL",328,0)
 I $G(STR)="" Q ""
"RTN","BSTSUTIL",329,0)
 I $G(VAL)="" Q ""
"RTN","BSTSUTIL",330,0)
 ;
"RTN","BSTSUTIL",331,0)
 NEW LV
"RTN","BSTSUTIL",332,0)
 S LV=$L(VAL)
"RTN","BSTSUTIL",333,0)
 I $E(STR,$L(STR)-(LV-1),$L(STR))=VAL S STR=$E(STR,1,$L(STR)-LV)
"RTN","BSTSUTIL",334,0)
 ;
"RTN","BSTSUTIL",335,0)
 Q STR
"RTN","BSTSUTIL",336,0)
 ;
"RTN","BSTSUTIL",337,0)
CKJOB(ZTSK) ;Check the status of a job
"RTN","BSTSUTIL",338,0)
 ;
"RTN","BSTSUTIL",339,0)
 NEW ST
"RTN","BSTSUTIL",340,0)
 ;
"RTN","BSTSUTIL",341,0)
 ;Check on current job
"RTN","BSTSUTIL",342,0)
 D STAT^%ZTLOAD
"RTN","BSTSUTIL",343,0)
 S ST=$G(ZTSK(2))
"RTN","BSTSUTIL",344,0)
 ;
"RTN","BSTSUTIL",345,0)
 ;Pending - Don't start
"RTN","BSTSUTIL",346,0)
 I ST["Pending" Q 1
"RTN","BSTSUTIL",347,0)
 ;
"RTN","BSTSUTIL",348,0)
 ;Running - Don't start
"RTN","BSTSUTIL",349,0)
 I ST["Running" Q 1
"RTN","BSTSUTIL",350,0)
 ;
"RTN","BSTSUTIL",351,0)
 ;Finished/Inactive/Interrupted/Undefined - clear and allow start
"RTN","BSTSUTIL",352,0)
 Q 0
"RTN","BSTSUTIL",353,0)
 ;
"RTN","BSTSUTIL",354,0)
CDJOB(NMIEN,TYPE) ;EP - Kick off BSTS Background Process
"RTN","BSTSUTIL",355,0)
 ;
"RTN","BSTSUTIL",356,0)
 NEW TJOB,ZTDTH,ZTDESC,ZTRTN,ZTIO,ZTSAVE,BSTSUPD,ERROR,FIELD,ZTSK
"RTN","BSTSUTIL",357,0)
 ;
"RTN","BSTSUTIL",358,0)
 ;Determine field to pull
"RTN","BSTSUTIL",359,0)
 I TYPE="C" S FIELD=".07"  ;Regular Codeset
"RTN","BSTSUTIL",360,0)
 I TYPE="S" S FIELD=".08"  ;Subset
"RTN","BSTSUTIL",361,0)
 I TYPE="I" S FIELD=".09"  ;ICD9 TO SNOMED
"RTN","BSTSUTIL",362,0)
 ;
"RTN","BSTSUTIL",363,0)
 ;Get the previous task number
"RTN","BSTSUTIL",364,0)
 S TJOB=$$GET1^DIQ(9002318.1,NMIEN_",",FIELD,"I")
"RTN","BSTSUTIL",365,0)
 ;
"RTN","BSTSUTIL",366,0)
 ;Running or pending - Do not start
"RTN","BSTSUTIL",367,0)
 I TJOB]"",$$CKJOB(TJOB) Q
"RTN","BSTSUTIL",368,0)
 ;
"RTN","BSTSUTIL",369,0)
 ;Other status - clear task
"RTN","BSTSUTIL",370,0)
 I TJOB]"" D
"RTN","BSTSUTIL",371,0)
 . NEW BSTSUPD,ERR
"RTN","BSTSUTIL",372,0)
 . S BSTSUPD(9002318.1,NMIEN_",",FIELD)="@"
"RTN","BSTSUTIL",373,0)
 . D FILE^DIE("","BSTSUPD","ERR")
"RTN","BSTSUTIL",374,0)
 ;
"RTN","BSTSUTIL",375,0)
 ;Queue the process off in the background
"RTN","BSTSUTIL",376,0)
 K IO("Q")
"RTN","BSTSUTIL",377,0)
 ;
"RTN","BSTSUTIL",378,0)
 ;Regular codeset refresh
"RTN","BSTSUTIL",379,0)
 I TYPE="C" D
"RTN","BSTSUTIL",380,0)
 . S ZTRTN="RES^BSTSVRSN",ZTDESC="BSTS - Refresh Codeset"
"RTN","BSTSUTIL",381,0)
 . S ZTSAVE("NMIEN")=""
"RTN","BSTSUTIL",382,0)
 ;
"RTN","BSTSUTIL",383,0)
 ;Subset refresh
"RTN","BSTSUTIL",384,0)
 I TYPE="S" D
"RTN","BSTSUTIL",385,0)
 . S ZTRTN="SUB^BSTSVRSN",ZTDESC="BSTS - Update IHS Standard Terminology Subsets"
"RTN","BSTSUTIL",386,0)
 . S ZTSAVE("NMIEN")=""
"RTN","BSTSUTIL",387,0)
 ;
"RTN","BSTSUTIL",388,0)
 ;ICD9 to SNOMED process
"RTN","BSTSUTIL",389,0)
 I TYPE="I" D
"RTN","BSTSUTIL",390,0)
 . S ZTRTN="JOB^BSTSUTIL",ZTDESC="BSTS - Preload SNOMED Concepts"
"RTN","BSTSUTIL",391,0)
 ;
"RTN","BSTSUTIL",392,0)
 S ZTIO=""
"RTN","BSTSUTIL",393,0)
 S ZTDTH=$H
"RTN","BSTSUTIL",394,0)
 D ^%ZTLOAD
"RTN","BSTSUTIL",395,0)
 ;
"RTN","BSTSUTIL",396,0)
 ;Save task to file
"RTN","BSTSUTIL",397,0)
 S BSTSUPD(9002318.1,NMIEN_",",FIELD)=$G(ZTSK)
"RTN","BSTSUTIL",398,0)
 D FILE^DIE("","BSTSUPD","ERR")
"RTN","BSTSUTIL",399,0)
 ;
"RTN","BSTSUTIL",400,0)
 Q
"RTN","BSTSUTIL",401,0)
 ;
"RTN","BSTSUTIL",402,0)
PLOAD(NMIEN) ;Job off process to pre-load SNOMED concepts at site
"RTN","BSTSUTIL",403,0)
 ;
"RTN","BSTSUTIL",404,0)
 NEW VAR,STS
"RTN","BSTSUTIL",405,0)
 ;
"RTN","BSTSUTIL",406,0)
 ;Quit if process has run before
"RTN","BSTSUTIL",407,0)
 I $$GET1^DIQ(9002318.1,NMIEN_",",".09","I")]"" Q
"RTN","BSTSUTIL",408,0)
 ;
"RTN","BSTSUTIL",409,0)
 ;Do not perform check if background process is running
"RTN","BSTSUTIL",410,0)
 L +^BSTS(9002318.1,0):0 E  Q
"RTN","BSTSUTIL",411,0)
 L -^BSTS(9002318.1,0)
"RTN","BSTSUTIL",412,0)
 ;
"RTN","BSTSUTIL",413,0)
 ;Make sure ICD9 to SNOMED background process isn't already running
"RTN","BSTSUTIL",414,0)
 L +^TMP("BSTSICD2SMD"):0 E  Q
"RTN","BSTSUTIL",415,0)
 L -^TMP("BSTSICD2SMD")
"RTN","BSTSUTIL",416,0)
 ;
"RTN","BSTSUTIL",417,0)
 ;Only run if server set up
"RTN","BSTSUTIL",418,0)
 S STS=$$VERSIONS^BSTSAPI("VAR") ;Try a quick call to see if DTS is up
"RTN","BSTSUTIL",419,0)
 I +STS'=2 Q
"RTN","BSTSUTIL",420,0)
 ;
"RTN","BSTSUTIL",421,0)
 ;Queue the process off in the background
"RTN","BSTSUTIL",422,0)
 D CDJOB^BSTSUTIL(NMIEN,"I")
"RTN","BSTSUTIL",423,0)
 ;
"RTN","BSTSUTIL",424,0)
 Q
"RTN","BSTSUTIL",425,0)
 ;
"RTN","BSTSUTIL",426,0)
JOB ;Background process to preload SNOMED concepts corresponding to ICD9 values
"RTN","BSTSUTIL",427,0)
 ;
"RTN","BSTSUTIL",428,0)
 ;Lock process
"RTN","BSTSUTIL",429,0)
 L +^TMP("BSTSICD2SMD"):0 E  Q
"RTN","BSTSUTIL",430,0)
 ;
"RTN","BSTSUTIL",431,0)
 NEW AUPNPROB,JTMP,UID,JTMP,SVAR
"RTN","BSTSUTIL",432,0)
 ;
"RTN","BSTSUTIL",433,0)
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
"RTN","BSTSUTIL",434,0)
 S JTMP=$NA(^TMP("BSTS1POS",UID))
"RTN","BSTSUTIL",435,0)
 S SVAR=$NA(^TMP("BSTSRPC1",UID))
"RTN","BSTSUTIL",436,0)
 K @JTMP
"RTN","BSTSUTIL",437,0)
 ;
"RTN","BSTSUTIL",438,0)
 S AUPNPROB=0 F  S AUPNPROB=$O(^AUPNPROB(AUPNPROB)) Q:'AUPNPROB  D
"RTN","BSTSUTIL",439,0)
 . NEW ICD9,STS
"RTN","BSTSUTIL",440,0)
 . ;
"RTN","BSTSUTIL",441,0)
 . ;Reset scratch global
"RTN","BSTSUTIL",442,0)
 . K @SVAR
"RTN","BSTSUTIL",443,0)
 . ;
"RTN","BSTSUTIL",444,0)
 . ;Get the ICD9 code
"RTN","BSTSUTIL",445,0)
 . S ICD9=$$GET1^DIQ(9000011,AUPNPROB,.01,"E") Q:ICD9=""
"RTN","BSTSUTIL",446,0)
 . ;
"RTN","BSTSUTIL",447,0)
 . ;Strip off trailing "."
"RTN","BSTSUTIL",448,0)
 . S ICD9=$$TKO^BSTSUTIL(ICD9,".")
"RTN","BSTSUTIL",449,0)
 . ;
"RTN","BSTSUTIL",450,0)
 . ;Skip if that ICD9 already processed
"RTN","BSTSUTIL",451,0)
 . I $D(@JTMP@(ICD9)) Q
"RTN","BSTSUTIL",452,0)
 . ;
"RTN","BSTSUTIL",453,0)
 . ;Pre-load the SNOMED for that ICD9
"RTN","BSTSUTIL",454,0)
 . S STS=$$ICD2SMD^BSTSAPI(SVAR,ICD9_"^BCIX^2")
"RTN","BSTSUTIL",455,0)
 . ;
"RTN","BSTSUTIL",456,0)
 . ;Mark the entry processed
"RTN","BSTSUTIL",457,0)
 . S @JTMP@(ICD9)=""
"RTN","BSTSUTIL",458,0)
 ;
"RTN","BSTSUTIL",459,0)
 ;Remove entry when done
"RTN","BSTSUTIL",460,0)
 K @JTMP
"RTN","BSTSUTIL",461,0)
 ;
"RTN","BSTSUTIL",462,0)
 ;Unlock process
"RTN","BSTSUTIL",463,0)
 L -^TMP("BSTSICD2SMD")
"RTN","BSTSUTIL",464,0)
 ;
"RTN","BSTSUTIL",465,0)
 Q
"RTN","BSTSVRSN")
0^14^B83343499
"RTN","BSTSVRSN",1,0)
BSTSVRSN ;GDIT/HS/BEE-Standard Terminology - Local File Handling ;26-Jun-2015 18:12;DKM
"RTN","BSTSVRSN",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSVRSN",3,0)
 ;
"RTN","BSTSVRSN",4,0)
 Q
"RTN","BSTSVRSN",5,0)
 ;
"RTN","BSTSVRSN",6,0)
RESET(NMIEN) ;EP - Mark local entries as out of date
"RTN","BSTSVRSN",7,0)
 ;
"RTN","BSTSVRSN",8,0)
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BSTSVRSN D UNWIND^%ZTER" ; SAC 2009 2.2.3.17
"RTN","BSTSVRSN",9,0)
 ;
"RTN","BSTSVRSN",10,0)
 ;Get NMID - Only refresh 36
"RTN","BSTSVRSN",11,0)
 S NMID=$$GET1^DIQ(9002318.1,NMIEN_",",.01,"I") I NMID'=36 Q
"RTN","BSTSVRSN",12,0)
 ;
"RTN","BSTSVRSN",13,0)
 ;Make sure process isn't running
"RTN","BSTSVRSN",14,0)
 L +^BSTS(9002318.1,0):1 E  Q
"RTN","BSTSVRSN",15,0)
 L -^BSTS(9002318.1,0)
"RTN","BSTSVRSN",16,0)
 ;
"RTN","BSTSVRSN",17,0)
 ;Make sure ICD9 to SNOMED background process isn't running
"RTN","BSTSVRSN",18,0)
 L +^TMP("BSTSICD2SMD"):0 E  Q
"RTN","BSTSVRSN",19,0)
 L -^TMP("BSTSICD2SMD")
"RTN","BSTSVRSN",20,0)
 ;
"RTN","BSTSVRSN",21,0)
 ;Queue the process off in the background
"RTN","BSTSVRSN",22,0)
 D CDJOB^BSTSUTIL(NMIEN,"C")
"RTN","BSTSVRSN",23,0)
 ;
"RTN","BSTSVRSN",24,0)
 Q
"RTN","BSTSVRSN",25,0)
 ;
"RTN","BSTSVRSN",26,0)
RES ;EP - Mark Local Entries As Out of Date
"RTN","BSTSVRSN",27,0)
 ;
"RTN","BSTSVRSN",28,0)
 NEW STS,BSTS,ERROR,VAR
"RTN","BSTSVRSN",29,0)
 ;
"RTN","BSTSVRSN",30,0)
 ;Passed in variables
"RTN","BSTSVRSN",31,0)
 I $G(NMIEN)="" Q
"RTN","BSTSVRSN",32,0)
 ;
"RTN","BSTSVRSN",33,0)
 ;Perform lock so only one process is allowed
"RTN","BSTSVRSN",34,0)
 L +^BSTS(9002318.1,0):1 E  Q
"RTN","BSTSVRSN",35,0)
 ;
"RTN","BSTSVRSN",36,0)
 ;Update LAST VERSION CHECK now so process won't keep getting called
"RTN","BSTSVRSN",37,0)
 S BSTS(9002318.1,NMIEN_",",.05)=DT
"RTN","BSTSVRSN",38,0)
 D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",39,0)
 ;
"RTN","BSTSVRSN",40,0)
 NEW CRID,CIEN,NMID,VDTS,NVIEN,NVLCL
"RTN","BSTSVRSN",41,0)
 ;
"RTN","BSTSVRSN",42,0)
 ;Get NMID
"RTN","BSTSVRSN",43,0)
 S NMID=$$GET1^DIQ(9002318.1,NMIEN_",",.01,"I") I NMID="" G XRES
"RTN","BSTSVRSN",44,0)
 ;
"RTN","BSTSVRSN",45,0)
 ;Loop through each concept in the codeset and make it Out of Date
"RTN","BSTSVRSN",46,0)
 S VDTS="" F  S VDTS=$O(^BSTS(9002318.4,"D",NMID,VDTS)) Q:VDTS=""  S CIEN=0 F  S CIEN=$O(^BSTS(9002318.4,"D",NMID,VDTS,CIEN)) Q:'CIEN  D
"RTN","BSTSVRSN",47,0)
 . ;
"RTN","BSTSVRSN",48,0)
 . NEW BSTSUPD,ERR,TIEN
"RTN","BSTSVRSN",49,0)
 . ;
"RTN","BSTSVRSN",50,0)
 . ;Mark Entry as Out of Date
"RTN","BSTSVRSN",51,0)
 . S BSTSUPD(9002318.4,CIEN_",",".11")="Y"
"RTN","BSTSVRSN",52,0)
 . ;
"RTN","BSTSVRSN",53,0)
 . ;Process the Associated Terms
"RTN","BSTSVRSN",54,0)
 . S TIEN="" F  S TIEN=$O(^BSTS(9002318.3,"C",NMID,CIEN,TIEN)) Q:TIEN=""  D
"RTN","BSTSVRSN",55,0)
 .. ;
"RTN","BSTSVRSN",56,0)
 .. NEW BSTSTUPD,ERR
"RTN","BSTSVRSN",57,0)
 .. ;
"RTN","BSTSVRSN",58,0)
 .. ;Mark Entry as Out of Date
"RTN","BSTSVRSN",59,0)
 .. S BSTSTUPD(9002318.3,TIEN_",",".11")="Y"
"RTN","BSTSVRSN",60,0)
 .. D FILE^DIE("","BSTSTUPD","ERR")
"RTN","BSTSVRSN",61,0)
 . ;
"RTN","BSTSVRSN",62,0)
 . ;File entry
"RTN","BSTSVRSN",63,0)
 . I $D(BSTSUPD) D FILE^DIE("","BSTSUPD","ERR")
"RTN","BSTSVRSN",64,0)
 ;
"RTN","BSTSVRSN",65,0)
 ;Update the current version
"RTN","BSTSVRSN",66,0)
 ;
"RTN","BSTSVRSN",67,0)
 ;Get the current version from the codeset multiple
"RTN","BSTSVRSN",68,0)
 S NVIEN=$O(^BSTS(9002318.1,NMIEN,1,"A"),-1)
"RTN","BSTSVRSN",69,0)
 S NVLCL="" I +NVIEN>0 D
"RTN","BSTSVRSN",70,0)
 . NEW DA,IENS
"RTN","BSTSVRSN",71,0)
 . S DA(1)=NMIEN,DA=+NVIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSVRSN",72,0)
 . S NVLCL=$$GET1^DIQ(9002318.11,IENS,".01","I")
"RTN","BSTSVRSN",73,0)
 ;
"RTN","BSTSVRSN",74,0)
 ;Now save it in the CURRENT VERSION field
"RTN","BSTSVRSN",75,0)
 I NVLCL]"" D
"RTN","BSTSVRSN",76,0)
 . NEW BSTS,ERROR
"RTN","BSTSVRSN",77,0)
 . S BSTS(9002318.1,NMIEN_",",.04)=NVLCL
"RTN","BSTSVRSN",78,0)
 . D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",79,0)
 ;
"RTN","BSTSVRSN",80,0)
 ;Unlock entry
"RTN","BSTSVRSN",81,0)
XRES L -^BSTS(9002318.1,0)
"RTN","BSTSVRSN",82,0)
 ;
"RTN","BSTSVRSN",83,0)
 Q
"RTN","BSTSVRSN",84,0)
 ;
"RTN","BSTSVRSN",85,0)
VCHK(NMID) ;EP - Daily check for new version
"RTN","BSTSVRSN",86,0)
 ;
"RTN","BSTSVRSN",87,0)
 NEW NMIEN,LVCKDT,STS,BSTS,ERROR,VAR,CVLCL,NVIEN,NVLCL
"RTN","BSTSVRSN",88,0)
 ;
"RTN","BSTSVRSN",89,0)
 S NMID=$G(NMID,"") S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSVRSN",90,0)
 ;
"RTN","BSTSVRSN",91,0)
 ;Only process SNOMED
"RTN","BSTSVRSN",92,0)
 I NMID'=36 G XCHECK
"RTN","BSTSVRSN",93,0)
 ;
"RTN","BSTSVRSN",94,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,"")) I NMIEN="" G XCHECK
"RTN","BSTSVRSN",95,0)
 ;
"RTN","BSTSVRSN",96,0)
 ;Pull last version check date
"RTN","BSTSVRSN",97,0)
 S LVCKDT=$$GET1^DIQ(9002318.1,NMIEN_",",.05,"I")
"RTN","BSTSVRSN",98,0)
 I LVCKDT'<DT G XCHECK
"RTN","BSTSVRSN",99,0)
 ;
"RTN","BSTSVRSN",100,0)
 ;Do not perform check if another process is already checking
"RTN","BSTSVRSN",101,0)
 L +^BSTS("VERSION CHECK"):0 E  G XCHECK
"RTN","BSTSVRSN",102,0)
 ;
"RTN","BSTSVRSN",103,0)
 ;Do not perform check if background process is running
"RTN","BSTSVRSN",104,0)
 L +^BSTS(9002318.1,0):0 E  G XCHECK
"RTN","BSTSVRSN",105,0)
 L -^BSTS(9002318.1,0)
"RTN","BSTSVRSN",106,0)
 ;
"RTN","BSTSVRSN",107,0)
 ;Make sure ICD9 to SNOMED background process isn't running
"RTN","BSTSVRSN",108,0)
 L +^TMP("BSTSICD2SMD"):0 E  G XCHECK
"RTN","BSTSVRSN",109,0)
 L -^TMP("BSTSICD2SMD")
"RTN","BSTSVRSN",110,0)
 ;
"RTN","BSTSVRSN",111,0)
 ;Perform version check
"RTN","BSTSVRSN",112,0)
 S STS=$$VERSIONS^BSTSAPI("VAR",NMID)
"RTN","BSTSVRSN",113,0)
 ;
"RTN","BSTSVRSN",114,0)
 ;Check for successful remote call - If failure, don't check again today
"RTN","BSTSVRSN",115,0)
 I +STS'=2 D  G XCHECK
"RTN","BSTSVRSN",116,0)
 . NEW BSTS,ERROR
"RTN","BSTSVRSN",117,0)
 . S BSTS(9002318.1,NMIEN_",",.05)=DT
"RTN","BSTSVRSN",118,0)
 . D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",119,0)
 ;
"RTN","BSTSVRSN",120,0)
 ;Pull the current version on file
"RTN","BSTSVRSN",121,0)
 S CVLCL=$$GET1^DIQ(9002318.1,NMIEN_",",".04","I")
"RTN","BSTSVRSN",122,0)
 ;
"RTN","BSTSVRSN",123,0)
 ;Get the current version from the codeset multiple
"RTN","BSTSVRSN",124,0)
 S NVIEN=$O(^BSTS(9002318.1,NMIEN,1,"A"),-1)
"RTN","BSTSVRSN",125,0)
 S NVLCL="" I +NVIEN>0 D
"RTN","BSTSVRSN",126,0)
 . NEW DA,IENS
"RTN","BSTSVRSN",127,0)
 . S DA(1)=NMIEN,DA=+NVIEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSVRSN",128,0)
 . S NVLCL=$$GET1^DIQ(9002318.11,IENS,".01","I")
"RTN","BSTSVRSN",129,0)
 ;
"RTN","BSTSVRSN",130,0)
 ;If the current version value isn't equal to the latest in the multiple need to process
"RTN","BSTSVRSN",131,0)
 I NVLCL]"",CVLCL'=NVLCL D RESET^BSTSVRSN(NMIEN) G XCHECK
"RTN","BSTSVRSN",132,0)
 ;
"RTN","BSTSVRSN",133,0)
 ;Check to see if ICD9 to SMD process needs run - Only run once
"RTN","BSTSVRSN",134,0)
 D PLOAD^BSTSUTIL(NMIEN)
"RTN","BSTSVRSN",135,0)
 ;
"RTN","BSTSVRSN",136,0)
 ;Mark the codeset as checked
"RTN","BSTSVRSN",137,0)
 D
"RTN","BSTSVRSN",138,0)
 . NEW BSTS,ERROR
"RTN","BSTSVRSN",139,0)
 . S BSTS(9002318.1,NMIEN_",",.05)=DT
"RTN","BSTSVRSN",140,0)
 . D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",141,0)
 ;
"RTN","BSTSVRSN",142,0)
XCHECK L -^BSTS("VERSION CHECK")
"RTN","BSTSVRSN",143,0)
 Q
"RTN","BSTSVRSN",144,0)
 ;
"RTN","BSTSVRSN",145,0)
SCHK(NMID) ;EP - Check for periodic subset updates
"RTN","BSTSVRSN",146,0)
 ;
"RTN","BSTSVRSN",147,0)
 NEW LMDT,STS,BSTS,ERROR,ZTRTN,ZTSAVE,ZTDESC,ZTDTH,NMIEN
"RTN","BSTSVRSN",148,0)
 NEW VAR,SITE,SDAYS,ZTIO,SUBLST,X1,X2,X,%H
"RTN","BSTSVRSN",149,0)
 ;
"RTN","BSTSVRSN",150,0)
 S NMID=$G(NMID,"") S:NMID="" NMID=36 S:NMID=30 NMID=36
"RTN","BSTSVRSN",151,0)
 ;
"RTN","BSTSVRSN",152,0)
 ;Only run it for codeset 36
"RTN","BSTSVRSN",153,0)
 I NMID'=36 Q
"RTN","BSTSVRSN",154,0)
 ;
"RTN","BSTSVRSN",155,0)
 ;Get Site Parameter IEN
"RTN","BSTSVRSN",156,0)
 S SITE=$O(^BSTS(9002318,0)) Q:'SITE
"RTN","BSTSVRSN",157,0)
 ;
"RTN","BSTSVRSN",158,0)
 ;Get subset update days
"RTN","BSTSVRSN",159,0)
 S SDAYS=$$GET1^DIQ(9002318,SITE_",",.02,"I") S:SDAYS="" SDAYS=60
"RTN","BSTSVRSN",160,0)
 ;
"RTN","BSTSVRSN",161,0)
 ;Make sure we have a codeset (namespace)
"RTN","BSTSVRSN",162,0)
 S NMIEN=$O(^BSTS(9002318.1,"B",NMID,"")) Q:NMIEN=""
"RTN","BSTSVRSN",163,0)
 ;
"RTN","BSTSVRSN",164,0)
 ;Check if refresh needs run
"RTN","BSTSVRSN",165,0)
 S LMDT=$$GET1^DIQ(9002318.1,NMIEN,".06","I")
"RTN","BSTSVRSN",166,0)
 I LMDT>0 S X1=LMDT,X2=SDAYS D C^%DTC S LMDT=X
"RTN","BSTSVRSN",167,0)
 I LMDT>DT Q
"RTN","BSTSVRSN",168,0)
 ;
"RTN","BSTSVRSN",169,0)
 ;Do not perform check if another process is already checking
"RTN","BSTSVRSN",170,0)
 L +^BSTS("SUBSET CHECK"):0 E  Q
"RTN","BSTSVRSN",171,0)
 ;
"RTN","BSTSVRSN",172,0)
 ;Only one SNOMED background process can be running at a time
"RTN","BSTSVRSN",173,0)
 L +^BSTS(9002318.1,0):1 E  G XSCHK
"RTN","BSTSVRSN",174,0)
 L -^BSTS(9002318.1,0)
"RTN","BSTSVRSN",175,0)
 ;
"RTN","BSTSVRSN",176,0)
 ;Make sure ICD9 to SNOMED background process isn't running
"RTN","BSTSVRSN",177,0)
 L +^TMP("BSTSICD2SMD"):0 E  G XSCHK
"RTN","BSTSVRSN",178,0)
 L -^TMP("BSTSICD2SMD")
"RTN","BSTSVRSN",179,0)
 ;
"RTN","BSTSVRSN",180,0)
 ;Only run if server set up
"RTN","BSTSVRSN",181,0)
 S STS=$$VERSIONS^BSTSAPI("VAR") ;Try a quick call to see if DTS is up
"RTN","BSTSVRSN",182,0)
 I +STS'=2 D  G XSCHK
"RTN","BSTSVRSN",183,0)
 . NEW X1,X2,X,BSTS,ERROR
"RTN","BSTSVRSN",184,0)
 . ;
"RTN","BSTSVRSN",185,0)
 . ;Find the date to use so that it won't run again until tomorrow
"RTN","BSTSVRSN",186,0)
 . S X1=DT,X2=-SDAYS+1 D C^%DTC
"RTN","BSTSVRSN",187,0)
 . ;
"RTN","BSTSVRSN",188,0)
 . ;Update LAST SUBSET CHECK now so process won't keep getting called
"RTN","BSTSVRSN",189,0)
 . S BSTS(9002318.1,NMIEN_",",.06)=X
"RTN","BSTSVRSN",190,0)
 . D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",191,0)
 ;
"RTN","BSTSVRSN",192,0)
 ;Queue the process off in the background
"RTN","BSTSVRSN",193,0)
 D CDJOB^BSTSUTIL(NMIEN,"S")
"RTN","BSTSVRSN",194,0)
 ;
"RTN","BSTSVRSN",195,0)
XSCHK L -^BSTS("SUBSET CHECK")
"RTN","BSTSVRSN",196,0)
 Q
"RTN","BSTSVRSN",197,0)
 ;
"RTN","BSTSVRSN",198,0)
SUB ;EP - Update IHS Standard Terminology Subsets
"RTN","BSTSVRSN",199,0)
 ;
"RTN","BSTSVRSN",200,0)
 ;Retrieve passed in variable
"RTN","BSTSVRSN",201,0)
 S NMIEN=$G(NMIEN) I NMIEN="" Q
"RTN","BSTSVRSN",202,0)
 ;
"RTN","BSTSVRSN",203,0)
 ;Perform lock so only one process is allowed
"RTN","BSTSVRSN",204,0)
 L +^BSTS(9002318.1,0):10 E  Q
"RTN","BSTSVRSN",205,0)
 ;
"RTN","BSTSVRSN",206,0)
 NEW BSTS,ERROR,CIEN,BSTSSB,STS,CNC,SUBLST,SSCIEN,ICONC,SITE,SDAYS,NMID
"RTN","BSTSVRSN",207,0)
 ;
"RTN","BSTSVRSN",208,0)
 ;Get NMID
"RTN","BSTSVRSN",209,0)
 S NMID=$$GET1^DIQ(9002318.1,NMIEN_",",.01,"I") I NMID="" Q
"RTN","BSTSVRSN",210,0)
 ;
"RTN","BSTSVRSN",211,0)
 ;Get Site Parameter IEN
"RTN","BSTSVRSN",212,0)
 S SITE=$O(^BSTS(9002318,0)) Q:'SITE
"RTN","BSTSVRSN",213,0)
 ;
"RTN","BSTSVRSN",214,0)
 ;Get subset update days
"RTN","BSTSVRSN",215,0)
 S SDAYS=$$GET1^DIQ(9002318,SITE_",",.02,"I") S:SDAYS="" SDAYS=60
"RTN","BSTSVRSN",216,0)
 ;
"RTN","BSTSVRSN",217,0)
 ;Try a quick call to make sure it works - if not set to run tomorrow
"RTN","BSTSVRSN",218,0)
 S STS=$$SUBSET^BSTSAPI("SUBLST",NMID_"^2")
"RTN","BSTSVRSN",219,0)
 I +STS'=2 D  G XSUB
"RTN","BSTSVRSN",220,0)
 . NEW X1,X2,X,BSTS,ERROR,%H
"RTN","BSTSVRSN",221,0)
 . ;
"RTN","BSTSVRSN",222,0)
 . ;Find the date to use so that it won't run again until tomorrow
"RTN","BSTSVRSN",223,0)
 . S X1=DT,X2=-SDAYS+1 D C^%DTC
"RTN","BSTSVRSN",224,0)
 . ;
"RTN","BSTSVRSN",225,0)
 . ;Update LAST SUBSET CHECK now so process won't keep getting called
"RTN","BSTSVRSN",226,0)
 . S BSTS(9002318.1,NMIEN_",",.06)=X
"RTN","BSTSVRSN",227,0)
 . D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",228,0)
 ;
"RTN","BSTSVRSN",229,0)
 ;Update LAST SUBSET CHECK now so process won't keep getting called
"RTN","BSTSVRSN",230,0)
 S BSTS(9002318.1,NMIEN_",",.06)=DT
"RTN","BSTSVRSN",231,0)
 D FILE^DIE("","BSTS","ERROR")
"RTN","BSTSVRSN",232,0)
 ;
"RTN","BSTSVRSN",233,0)
 ;Loop through concepts and clear out modified date for codes in codeset
"RTN","BSTSVRSN",234,0)
 S ICONC="" F  S ICONC=$O(^BSTS(9002318.4,"C",NMID,ICONC)) Q:ICONC=""  D
"RTN","BSTSVRSN",235,0)
 . S CIEN="" F  S CIEN=$O(^BSTS(9002318.4,"C",NMID,ICONC,CIEN)) Q:CIEN=""  D
"RTN","BSTSVRSN",236,0)
 .. NEW CDSET,BSTS,ERR
"RTN","BSTSVRSN",237,0)
 .. ;
"RTN","BSTSVRSN",238,0)
 .. ;Skip partial entries
"RTN","BSTSVRSN",239,0)
 .. I $$GET1^DIQ(9002318.4,CIEN_",",.03,"I")="P" Q
"RTN","BSTSVRSN",240,0)
 .. ;
"RTN","BSTSVRSN",241,0)
 .. ;Mark as out of date
"RTN","BSTSVRSN",242,0)
 .. S BSTS(9002318.4,CIEN_",",".12")="@"
"RTN","BSTSVRSN",243,0)
 .. D FILE^DIE("","BSTS","ERR")
"RTN","BSTSVRSN",244,0)
 ;
"RTN","BSTSVRSN",245,0)
 ;Process all subsets (SUBLST was created before call)
"RTN","BSTSVRSN",246,0)
 S BSTSSB="" F  S BSTSSB=$O(SUBLST(BSTSSB)) Q:BSTSSB=""  D
"RTN","BSTSVRSN",247,0)
 . ;
"RTN","BSTSVRSN",248,0)
 . NEW IN,OUT,STS
"RTN","BSTSVRSN",249,0)
 . ;
"RTN","BSTSVRSN",250,0)
 . ;Skip SRCH* subsets since they are in IHS Problem List
"RTN","BSTSVRSN",251,0)
 . S IN=SUBLST(BSTSSB)_"^^2"
"RTN","BSTSVRSN",252,0)
 . I $E(IN,1,4)="SRCH" Q
"RTN","BSTSVRSN",253,0)
 . ;
"RTN","BSTSVRSN",254,0)
 . ;Pull the subset
"RTN","BSTSVRSN",255,0)
 . S OUT=$NA(^TMP("BSTSSUPD",$J)) K @OUT
"RTN","BSTSVRSN",256,0)
 . S STS=$$SUBLST^BSTSAPI(OUT,IN)
"RTN","BSTSVRSN",257,0)
 . K @OUT
"RTN","BSTSVRSN",258,0)
 ;
"RTN","BSTSVRSN",259,0)
 ;Need to loop through list again to catch any deletes
"RTN","BSTSVRSN",260,0)
 S ICONC="" F  S ICONC=$O(^BSTS(9002318.4,"C",NMID,ICONC)) Q:ICONC=""  S SSCIEN="" F  S SSCIEN=$O(^BSTS(9002318.4,"C",NMID,ICONC,SSCIEN)) Q:SSCIEN=""  D
"RTN","BSTSVRSN",261,0)
 . ;
"RTN","BSTSVRSN",262,0)
 . NEW LMOD,DTSID,STS,SBVAR,CDSET,X1,X2,X,%H
"RTN","BSTSVRSN",263,0)
 . ;
"RTN","BSTSVRSN",264,0)
 . ;Skip partial entries
"RTN","BSTSVRSN",265,0)
 . I $$GET1^DIQ(9002318.4,SSCIEN_",",.03,"I")="P" Q
"RTN","BSTSVRSN",266,0)
 . ;
"RTN","BSTSVRSN",267,0)
 . ;Get last modified date for concept
"RTN","BSTSVRSN",268,0)
 . S LMOD=$$GET1^DIQ(9002318.4,SSCIEN_",",".12","I")
"RTN","BSTSVRSN",269,0)
 . I LMOD>0 S X1=LMOD,X2=SDAYS D C^%DTC S LMOD=X
"RTN","BSTSVRSN",270,0)
 . ;
"RTN","BSTSVRSN",271,0)
 . ;Skip if not out of date
"RTN","BSTSVRSN",272,0)
 . I LMOD>DT Q
"RTN","BSTSVRSN",273,0)
 . ;
"RTN","BSTSVRSN",274,0)
 . ;Get DTSId
"RTN","BSTSVRSN",275,0)
 . S DTSID=$$GET1^DIQ(9002318.4,SSCIEN_",",".08","I") Q:DTSID=""
"RTN","BSTSVRSN",276,0)
 . ;
"RTN","BSTSVRSN",277,0)
 . ;If Out of Date, retrieve detail from server
"RTN","BSTSVRSN",278,0)
 . S STS=$$DTSLKP^BSTSAPI("SBVAR",DTSID)
"RTN","BSTSVRSN",279,0)
 ;
"RTN","BSTSVRSN",280,0)
 ;Unlock entry
"RTN","BSTSVRSN",281,0)
XSUB L -^BSTS(9002318.1,0)
"RTN","BSTSVRSN",282,0)
 ;
"RTN","BSTSVRSN",283,0)
 Q
"RTN","BSTSVRSN",284,0)
 ;
"RTN","BSTSVRSN",285,0)
SBRSET ;EP - BSTS REFRESH SUBSETS option
"RTN","BSTSVRSN",286,0)
 ;
"RTN","BSTSVRSN",287,0)
 NEW II,NMID,NMIEN,BSTS,ERR,DIR,X,Y,DIC,CONC,CNT,DLAYGO
"RTN","BSTSVRSN",288,0)
 ;
"RTN","BSTSVRSN",289,0)
 W !!,"This option refreshes the IHS BSTS Terminology Subsets"
"RTN","BSTSVRSN",290,0)
 W !,"It will mark each concept's subsets as out of date and then"
"RTN","BSTSVRSN",291,0)
 W !,"start a background process to retrieve the subsets assigned"
"RTN","BSTSVRSN",292,0)
 W !,"to each concept."
"RTN","BSTSVRSN",293,0)
 W !!
"RTN","BSTSVRSN",294,0)
 S DIR("A")="Are you sure you want to do this"
"RTN","BSTSVRSN",295,0)
 S DIR("B")="NO"
"RTN","BSTSVRSN",296,0)
 S DIR(0)="Y"
"RTN","BSTSVRSN",297,0)
 D ^DIR
"RTN","BSTSVRSN",298,0)
 I '+Y Q
"RTN","BSTSVRSN",299,0)
 ;
"RTN","BSTSVRSN",300,0)
 ;Retrieve codeset
"RTN","BSTSVRSN",301,0)
 S DIC=9002318.1,DIC(0)="AEM",DIC("A")="Select the codeset to refresh: "
"RTN","BSTSVRSN",302,0)
 S DLAYGO=DIC D ^DIC
"RTN","BSTSVRSN",303,0)
 I '+Y Q
"RTN","BSTSVRSN",304,0)
 S NMID=$P(Y,U,2)
"RTN","BSTSVRSN",305,0)
 S NMIEN=$P(Y,U)
"RTN","BSTSVRSN",306,0)
 I '+Y Q
"RTN","BSTSVRSN",307,0)
 ;
"RTN","BSTSVRSN",308,0)
 ;Only one SNOMED background process can be running at a time
"RTN","BSTSVRSN",309,0)
 L +^BSTS(9002318.1,0):1 E  W !!,"A Subset Refresh is Already Running. Please Try Later" H 3 Q
"RTN","BSTSVRSN",310,0)
 L -^BSTS(9002318.1,0)
"RTN","BSTSVRSN",311,0)
 ;
"RTN","BSTSVRSN",312,0)
 S DIR("A")="Start the process"
"RTN","BSTSVRSN",313,0)
 S DIR("B")="NO"
"RTN","BSTSVRSN",314,0)
 S DIR(0)="Y"
"RTN","BSTSVRSN",315,0)
 D ^DIR
"RTN","BSTSVRSN",316,0)
 I '+Y Q
"RTN","BSTSVRSN",317,0)
 ;
"RTN","BSTSVRSN",318,0)
 ;Remove the subset last checked date
"RTN","BSTSVRSN",319,0)
CALL ;Clear LAST SUBSET CHECK
"RTN","BSTSVRSN",320,0)
 S BSTS(9002318.1,NMIEN_",",.06)=""
"RTN","BSTSVRSN",321,0)
 D FILE^DIE("","BSTS","ERR")
"RTN","BSTSVRSN",322,0)
 ;
"RTN","BSTSVRSN",323,0)
 W !!,"Kicking off background process to set up subsets"
"RTN","BSTSVRSN",324,0)
 D SCHK(NMID)
"RTN","BSTSVRSN",325,0)
 H 2
"RTN","BSTSVRSN",326,0)
 ;
"RTN","BSTSVRSN",327,0)
 Q
"RTN","BSTSVRSN",328,0)
 ;
"RTN","BSTSVRSN",329,0)
ERR ;
"RTN","BSTSVRSN",330,0)
 D ^%ZTER
"RTN","BSTSVRSN",331,0)
 Q
"RTN","BSTSWSV")
0^6^B144465700
"RTN","BSTSWSV",1,0)
BSTSWSV ;GDIT/HS/BEE-Standard Terminology Web Service Handling ;26-Jun-2015 18:12;DKM
"RTN","BSTSWSV",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSWSV",3,0)
 ;
"RTN","BSTSWSV",4,0)
 Q
"RTN","BSTSWSV",5,0)
 ;
"RTN","BSTSWSV",6,0)
SEARCH(OUT,IN,DEBUG) ;EP - Perform a Web Service Search
"RTN","BSTSWSV",7,0)
 ;
"RTN","BSTSWSV",8,0)
 ;Input
"RTN","BSTSWSV",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",10,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",11,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",12,0)
 ;
"RTN","BSTSWSV",13,0)
 ;Output
"RTN","BSTSWSV",14,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",15,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",16,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",17,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",18,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",19,0)
 ;
"RTN","BSTSWSV",20,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV",21,0)
 ; [1] - Concept ID
"RTN","BSTSWSV",22,0)
 ; [2] - DTS ID
"RTN","BSTSWSV",23,0)
 ; [3] - Description ID
"RTN","BSTSWSV",24,0)
 ;
"RTN","BSTSWSV",25,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",26,0)
 ;
"RTN","BSTSWSV",27,0)
 ;Define DEBUG
"RTN","BSTSWSV",28,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",29,0)
 ;
"RTN","BSTSWSV",30,0)
 ;Get list of servers
"RTN","BSTSWSV",31,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",32,0)
 ;
"RTN","BSTSWSV",33,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",34,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV",35,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",36,0)
 . ;
"RTN","BSTSWSV",37,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",38,0)
 . M BSTSWS=IN
"RTN","BSTSWSV",39,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",40,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",41,0)
 . ;
"RTN","BSTSWSV",42,0)
 . ;Call DTS
"RTN","BSTSWSV",43,0)
 . S CSTS=$$SEARCH^BSTSDTS2(OUT,.BSTSWS)
"RTN","BSTSWSV",44,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",45,0)
 . ;
"RTN","BSTSWSV",46,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",47,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",48,0)
 . ;
"RTN","BSTSWSV",49,0)
 . ;Define status variable
"RTN","BSTSWSV",50,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",51,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",52,0)
 ;
"RTN","BSTSWSV",53,0)
 Q STS
"RTN","BSTSWSV",54,0)
 ;
"RTN","BSTSWSV",55,0)
CNCSR(OUT,IN,DEBUG) ;EP - Perform a Web Service Concept Id Search
"RTN","BSTSWSV",56,0)
 ;
"RTN","BSTSWSV",57,0)
 ;Input
"RTN","BSTSWSV",58,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",59,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",60,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",61,0)
 ;
"RTN","BSTSWSV",62,0)
 ;Output
"RTN","BSTSWSV",63,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",64,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",65,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",66,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",67,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",68,0)
 ;
"RTN","BSTSWSV",69,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV",70,0)
 ; [1] - Concept ID
"RTN","BSTSWSV",71,0)
 ; [2] - DTS ID
"RTN","BSTSWSV",72,0)
 ; [3] - Description ID
"RTN","BSTSWSV",73,0)
 ;
"RTN","BSTSWSV",74,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",75,0)
 ;
"RTN","BSTSWSV",76,0)
 ;Define DEBUG
"RTN","BSTSWSV",77,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",78,0)
 ;
"RTN","BSTSWSV",79,0)
 ;Get list of servers
"RTN","BSTSWSV",80,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",81,0)
 ;
"RTN","BSTSWSV",82,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",83,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV",84,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",85,0)
 . ;
"RTN","BSTSWSV",86,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",87,0)
 . M BSTSWS=IN
"RTN","BSTSWSV",88,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",89,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",90,0)
 . ;
"RTN","BSTSWSV",91,0)
 . ;Call DTS
"RTN","BSTSWSV",92,0)
 . I TYPE="D" S CSTS=$$CNCSR^BSTSDTS0(OUT,.BSTSWS)
"RTN","BSTSWSV",93,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",94,0)
 . ;
"RTN","BSTSWSV",95,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",96,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",97,0)
 . ;
"RTN","BSTSWSV",98,0)
 . ;Define status variable
"RTN","BSTSWSV",99,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",100,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",101,0)
 ;
"RTN","BSTSWSV",102,0)
 Q STS
"RTN","BSTSWSV",103,0)
 ;
"RTN","BSTSWSV",104,0)
ICD2SMD(OUT,IN,DEBUG) ;EP - Perform a Web Service ICD9 to SNOMED mapping retrieval
"RTN","BSTSWSV",105,0)
 ;
"RTN","BSTSWSV",106,0)
 ;Input
"RTN","BSTSWSV",107,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",108,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",109,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",110,0)
 ;
"RTN","BSTSWSV",111,0)
 ;Output
"RTN","BSTSWSV",112,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",113,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",114,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",115,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",116,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",117,0)
 ;
"RTN","BSTSWSV",118,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV",119,0)
 ; [1] - Concept ID
"RTN","BSTSWSV",120,0)
 ; [2] - DTS ID
"RTN","BSTSWSV",121,0)
 ; [3] - Description ID
"RTN","BSTSWSV",122,0)
 ;
"RTN","BSTSWSV",123,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",124,0)
 ;
"RTN","BSTSWSV",125,0)
 ;Define DEBUG
"RTN","BSTSWSV",126,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",127,0)
 ;
"RTN","BSTSWSV",128,0)
 ;Get list of servers
"RTN","BSTSWSV",129,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",130,0)
 ;
"RTN","BSTSWSV",131,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",132,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV",133,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",134,0)
 . ;
"RTN","BSTSWSV",135,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",136,0)
 . M BSTSWS=IN
"RTN","BSTSWSV",137,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",138,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",139,0)
 . ;
"RTN","BSTSWSV",140,0)
 . ;Call DTS
"RTN","BSTSWSV",141,0)
 . I TYPE="D" S CSTS=$$ICD2SMD^BSTSDTS2(OUT,.BSTSWS)
"RTN","BSTSWSV",142,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",143,0)
 . ;
"RTN","BSTSWSV",144,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",145,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",146,0)
 . ;
"RTN","BSTSWSV",147,0)
 . ;Define status variable
"RTN","BSTSWSV",148,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",149,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",150,0)
 ;
"RTN","BSTSWSV",151,0)
 Q STS
"RTN","BSTSWSV",152,0)
 ;
"RTN","BSTSWSV",153,0)
DSCLKP(OUT,IN,DEBUG) ;EP - Perform a Web Service Description Id Search
"RTN","BSTSWSV",154,0)
 ;
"RTN","BSTSWSV",155,0)
 ;Input
"RTN","BSTSWSV",156,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",157,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",158,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",159,0)
 ;
"RTN","BSTSWSV",160,0)
 ;Output
"RTN","BSTSWSV",161,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",162,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",163,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",164,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",165,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",166,0)
 ;
"RTN","BSTSWSV",167,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV",168,0)
 ; [1] - Concept ID
"RTN","BSTSWSV",169,0)
 ; [2] - DTS ID
"RTN","BSTSWSV",170,0)
 ; [3] - Description ID
"RTN","BSTSWSV",171,0)
 ;
"RTN","BSTSWSV",172,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",173,0)
 ;
"RTN","BSTSWSV",174,0)
 ;Define DEBUG
"RTN","BSTSWSV",175,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",176,0)
 ;
"RTN","BSTSWSV",177,0)
 ;Get list of servers
"RTN","BSTSWSV",178,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",179,0)
 ;
"RTN","BSTSWSV",180,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",181,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV",182,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",183,0)
 . ;
"RTN","BSTSWSV",184,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",185,0)
 . M BSTSWS=IN
"RTN","BSTSWSV",186,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",187,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",188,0)
 . ;
"RTN","BSTSWSV",189,0)
 . ;Call DTS
"RTN","BSTSWSV",190,0)
 . I TYPE="D" S CSTS=$$DSCSRCH^BSTSDTS2(OUT,.BSTSWS)
"RTN","BSTSWSV",191,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",192,0)
 . ;
"RTN","BSTSWSV",193,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",194,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",195,0)
 . ;
"RTN","BSTSWSV",196,0)
 . ;Define status variable
"RTN","BSTSWSV",197,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",198,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",199,0)
 ;
"RTN","BSTSWSV",200,0)
 Q STS
"RTN","BSTSWSV",201,0)
 ;
"RTN","BSTSWSV",202,0)
SUBLST(DLIST,IN,DEBUG) ;EP - Perform a Web Service Subset Listing
"RTN","BSTSWSV",203,0)
 ;
"RTN","BSTSWSV",204,0)
 ;Input
"RTN","BSTSWSV",205,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",206,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",207,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",208,0)
 ;
"RTN","BSTSWSV",209,0)
 ;Output
"RTN","BSTSWSV",210,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",211,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",212,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",213,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",214,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",215,0)
 ;
"RTN","BSTSWSV",216,0)
 ; VAR(#) - [1]
"RTN","BSTSWSV",217,0)
 ; [1] - DTSId
"RTN","BSTSWSV",218,0)
 ;
"RTN","BSTSWSV",219,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",220,0)
 ;
"RTN","BSTSWSV",221,0)
 ;Define DEBUG
"RTN","BSTSWSV",222,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",223,0)
 ;
"RTN","BSTSWSV",224,0)
 ;Get list of servers
"RTN","BSTSWSV",225,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",226,0)
 ;
"RTN","BSTSWSV",227,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",228,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV",229,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",230,0)
 . ;
"RTN","BSTSWSV",231,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",232,0)
 . M BSTSWS=IN
"RTN","BSTSWSV",233,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",234,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",235,0)
 . ;
"RTN","BSTSWSV",236,0)
 . ;Call DTS
"RTN","BSTSWSV",237,0)
 . I TYPE="D" S CSTS=$$SUBLST^BSTSDTS2(DLIST,.BSTSWS)
"RTN","BSTSWSV",238,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",239,0)
 . ;
"RTN","BSTSWSV",240,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",241,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",242,0)
 . ;
"RTN","BSTSWSV",243,0)
 . ;Define status variable
"RTN","BSTSWSV",244,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",245,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",246,0)
 ;
"RTN","BSTSWSV",247,0)
 Q STS
"RTN","BSTSWSV",248,0)
 ;
"RTN","BSTSWSV",249,0)
DTSSR(OUT,IN,DEBUG) ;EP - Perform a Web Service DTS Id Lookup
"RTN","BSTSWSV",250,0)
 ;
"RTN","BSTSWSV",251,0)
 ;Input
"RTN","BSTSWSV",252,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",253,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",254,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",255,0)
 ;
"RTN","BSTSWSV",256,0)
 ;Output
"RTN","BSTSWSV",257,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",258,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",259,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",260,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",261,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",262,0)
 ;
"RTN","BSTSWSV",263,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV",264,0)
 ; [1] - Concept ID
"RTN","BSTSWSV",265,0)
 ; [2] - DTS ID
"RTN","BSTSWSV",266,0)
 ; [3] - Description ID
"RTN","BSTSWSV",267,0)
 ;
"RTN","BSTSWSV",268,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",269,0)
 ;
"RTN","BSTSWSV",270,0)
 ;Define DEBUG
"RTN","BSTSWSV",271,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",272,0)
 ;
"RTN","BSTSWSV",273,0)
 ;Get list of servers
"RTN","BSTSWSV",274,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",275,0)
 ;
"RTN","BSTSWSV",276,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",277,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV",278,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",279,0)
 . ;
"RTN","BSTSWSV",280,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",281,0)
 . M BSTSWS=IN
"RTN","BSTSWSV",282,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",283,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",284,0)
 . ;
"RTN","BSTSWSV",285,0)
 . ;Call DTS
"RTN","BSTSWSV",286,0)
 . I TYPE="D" S CSTS=$$DTSSR^BSTSDTS1(OUT,.BSTSWS)
"RTN","BSTSWSV",287,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",288,0)
 . ;
"RTN","BSTSWSV",289,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",290,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",291,0)
 . ;
"RTN","BSTSWSV",292,0)
 . ;Define status variable
"RTN","BSTSWSV",293,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",294,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",295,0)
 ;
"RTN","BSTSWSV",296,0)
 Q STS
"RTN","BSTSWSV",297,0)
 ;
"RTN","BSTSWSV",298,0)
 ;
"RTN","BSTSWSV",299,0)
 ;
"RTN","BSTSWSV",300,0)
GCDSET(DEBUG) ;EP - Poll server(s) for codeset information
"RTN","BSTSWSV",301,0)
 ;
"RTN","BSTSWSV",302,0)
 ;Input
"RTN","BSTSWSV",303,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",304,0)
 ;
"RTN","BSTSWSV",305,0)
 ;Output
"RTN","BSTSWSV",306,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",307,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",308,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",309,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",310,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",311,0)
 ;
"RTN","BSTSWSV",312,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",313,0)
 ;
"RTN","BSTSWSV",314,0)
 ;Define DEBUG
"RTN","BSTSWSV",315,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",316,0)
 ;
"RTN","BSTSWSV",317,0)
 ;Get list of servers
"RTN","BSTSWSV",318,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",319,0)
 ;
"RTN","BSTSWSV",320,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",321,0)
 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",322,0)
 . ;
"RTN","BSTSWSV",323,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",324,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",325,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",326,0)
 . ;
"RTN","BSTSWSV",327,0)
 . ;Call DTS
"RTN","BSTSWSV",328,0)
 . I TYPE="D" S CSTS=$$GCDSDTS4^BSTSDTS0(.BSTSWS)
"RTN","BSTSWSV",329,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",330,0)
 . ;
"RTN","BSTSWSV",331,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",332,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",333,0)
 . ;
"RTN","BSTSWSV",334,0)
 . ;Define status variable
"RTN","BSTSWSV",335,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",336,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",337,0)
 ;
"RTN","BSTSWSV",338,0)
 Q STS
"RTN","BSTSWSV",339,0)
 ;
"RTN","BSTSWSV",340,0)
GVRSET(NMID,DEBUG) ;EP - Poll server(s) for codeset information
"RTN","BSTSWSV",341,0)
 ;
"RTN","BSTSWSV",342,0)
 ;Input
"RTN","BSTSWSV",343,0)
 ; NMID - Namespace ID
"RTN","BSTSWSV",344,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",345,0)
 ;
"RTN","BSTSWSV",346,0)
 ;Output
"RTN","BSTSWSV",347,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",348,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",349,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",350,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",351,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",352,0)
 ;
"RTN","BSTSWSV",353,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",354,0)
 ;
"RTN","BSTSWSV",355,0)
 ;Define DEBUG
"RTN","BSTSWSV",356,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",357,0)
 ;
"RTN","BSTSWSV",358,0)
 ;Get list of servers
"RTN","BSTSWSV",359,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",360,0)
 ;
"RTN","BSTSWSV",361,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",362,0)
 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",363,0)
 . ;
"RTN","BSTSWSV",364,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",365,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",366,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",367,0)
 . S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSWSV",368,0)
 . ;
"RTN","BSTSWSV",369,0)
 . ;Call DTS
"RTN","BSTSWSV",370,0)
 . I TYPE="D" S CSTS=$$GVRDTS4^BSTSDTS0(.BSTSWS)
"RTN","BSTSWSV",371,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",372,0)
 . ;
"RTN","BSTSWSV",373,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",374,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",375,0)
 . ;
"RTN","BSTSWSV",376,0)
 . ;Define status variable
"RTN","BSTSWSV",377,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",378,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",379,0)
 ;
"RTN","BSTSWSV",380,0)
 Q STS
"RTN","BSTSWSV",381,0)
 ;
"RTN","BSTSWSV",382,0)
SUBSET(OUT,NMID,DEBUG) ;EP - Poll server(s) for subset information
"RTN","BSTSWSV",383,0)
 ;
"RTN","BSTSWSV",384,0)
 ;Input
"RTN","BSTSWSV",385,0)
 ; NMID - Namespace ID
"RTN","BSTSWSV",386,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",387,0)
 ;
"RTN","BSTSWSV",388,0)
 ;Output
"RTN","BSTSWSV",389,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",390,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",391,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",392,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",393,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",394,0)
 ;
"RTN","BSTSWSV",395,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV",396,0)
 ;
"RTN","BSTSWSV",397,0)
 ;Define DEBUG
"RTN","BSTSWSV",398,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",399,0)
 ;
"RTN","BSTSWSV",400,0)
 ;Get list of servers
"RTN","BSTSWSV",401,0)
 S STS=$$WSERVER(.BSTSSRV,DEBUG)
"RTN","BSTSWSV",402,0)
 ;
"RTN","BSTSWSV",403,0)
 ;Loop through list and make each call
"RTN","BSTSWSV",404,0)
 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV",405,0)
 . ;
"RTN","BSTSWSV",406,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",407,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV",408,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",409,0)
 . S BSTSWS("NAMESPACEID")=NMID
"RTN","BSTSWSV",410,0)
 . ;
"RTN","BSTSWSV",411,0)
 . ;Call DTS
"RTN","BSTSWSV",412,0)
 . I TYPE="D" S CSTS=$$SUBSET^BSTSDTS2(OUT,.BSTSWS)
"RTN","BSTSWSV",413,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV",414,0)
 . ;
"RTN","BSTSWSV",415,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV",416,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV",417,0)
 . ;
"RTN","BSTSWSV",418,0)
 . ;Define status variable
"RTN","BSTSWSV",419,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV",420,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV",421,0)
 ;
"RTN","BSTSWSV",422,0)
 Q STS
"RTN","BSTSWSV",423,0)
 ;
"RTN","BSTSWSV",424,0)
TEST(OUT,IN,DEBUG) ;EP - Perform a Test Web Service Search
"RTN","BSTSWSV",425,0)
 ;
"RTN","BSTSWSV",426,0)
 ;Input
"RTN","BSTSWSV",427,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV",428,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV",429,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",430,0)
 ;
"RTN","BSTSWSV",431,0)
 ;Output
"RTN","BSTSWSV",432,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV",433,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV",434,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV",435,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV",436,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV",437,0)
 ;
"RTN","BSTSWSV",438,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV",439,0)
 ; [1] - Concept ID
"RTN","BSTSWSV",440,0)
 ; [2] - DTS ID
"RTN","BSTSWSV",441,0)
 ; [3] - Description ID
"RTN","BSTSWSV",442,0)
 ;
"RTN","BSTSWSV",443,0)
 N BSTSSRV,PRI,STS,II,BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV",444,0)
 ;
"RTN","BSTSWSV",445,0)
 ;Define DEBUG
"RTN","BSTSWSV",446,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV",447,0)
 ;
"RTN","BSTSWSV",448,0)
 M BSTSWS=IN
"RTN","BSTSWSV",449,0)
 ;
"RTN","BSTSWSV",450,0)
 ;Retrieve Web Service Information
"RTN","BSTSWSV",451,0)
 S STS=$$GETWSV(BSTSWS("SERVICE"),.BSTSSRV,DEBUG)
"RTN","BSTSWSV",452,0)
 ;
"RTN","BSTSWSV",453,0)
 ;Make sure service was found
"RTN","BSTSWSV",454,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found" Q 0
"RTN","BSTSWSV",455,0)
 ;
"RTN","BSTSWSV",456,0)
 M BSTSWS=BSTSSRV(1)
"RTN","BSTSWSV",457,0)
 S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV",458,0)
 ;
"RTN","BSTSWSV",459,0)
 ;Call DTS
"RTN","BSTSWSV",460,0)
 I TYPE="D" S CSTS=$$TSRCH^BSTSDTS1(OUT,.BSTSWS)
"RTN","BSTSWSV",461,0)
 ;
"RTN","BSTSWSV",462,0)
 Q CSTS
"RTN","BSTSWSV",463,0)
 ;
"RTN","BSTSWSV",464,0)
WSERVER(BSTSSRV,DEBUG) ;P - Retrieve array of Web Server Information
"RTN","BSTSWSV",465,0)
 ;
"RTN","BSTSWSV",466,0)
 ;Input
"RTN","BSTSWSV",467,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",468,0)
 ;
"RTN","BSTSWSV",469,0)
 ;Output
"RTN","BSTSWSV",470,0)
 ; Function - 0:No Data Returned, 1:Data Returned
"RTN","BSTSWSV",471,0)
 ; BSTSSRV - Array of web service connection information
"RTN","BSTSWSV",472,0)
 ;
"RTN","BSTSWSV",473,0)
 ;Quit if install is running
"RTN","BSTSWSV",474,0)
 L +^TMP("BSTSINSTALL"):1 E  Q 0
"RTN","BSTSWSV",475,0)
 L -^TMP("BSTSINSTALL")
"RTN","BSTSWSV",476,0)
 ;
"RTN","BSTSWSV",477,0)
 N NMIEN
"RTN","BSTSWSV",478,0)
 ;
"RTN","BSTSWSV",479,0)
 ;Loop through servers until successful call
"RTN","BSTSWSV",480,0)
 S NMIEN=0 F  S NMIEN=$O(^BSTS(9002318,NMIEN)) Q:'NMIEN  D
"RTN","BSTSWSV",481,0)
 . N PRI
"RTN","BSTSWSV",482,0)
 . S PRI="" F  S PRI=$O(^BSTS(9002318,NMIEN,1,"C",PRI)) Q:'PRI  D
"RTN","BSTSWSV",483,0)
 .. N IEN
"RTN","BSTSWSV",484,0)
 .. S IEN="" F  S IEN=$O(^BSTS(9002318,NMIEN,1,"C",PRI,IEN)) Q:'IEN  D
"RTN","BSTSWSV",485,0)
 ... N WSIEN,STS,DA,IENS
"RTN","BSTSWSV",486,0)
 ... ;
"RTN","BSTSWSV",487,0)
 ... ;Pull Web Service IEN
"RTN","BSTSWSV",488,0)
 ... S DA(1)=NMIEN,DA=IEN,IENS=$$IENS^DILF(.DA)
"RTN","BSTSWSV",489,0)
 ... S WSIEN=$$GET1^DIQ(9002318.01,IENS,".01","I") Q:WSIEN=""
"RTN","BSTSWSV",490,0)
 ... ;
"RTN","BSTSWSV",491,0)
 ... ;Retrieve Web Service Information
"RTN","BSTSWSV",492,0)
 ... S STS=$$GETWSV(WSIEN,.BSTSSRV,DEBUG)
"RTN","BSTSWSV",493,0)
 ;
"RTN","BSTSWSV",494,0)
 Q $S($O(BSTSSRV(""))]"":"1",1:"0")
"RTN","BSTSWSV",495,0)
 ;
"RTN","BSTSWSV",496,0)
GETWSV(WSIEN,BSTSSRV,DEBUG) ;EP - Retrieve Single Web Service Connection Info
"RTN","BSTSWSV",497,0)
 ;
"RTN","BSTSWSV",498,0)
 ;Input
"RTN","BSTSWSV",499,0)
 ; WSIEN - Pointer to 9002318.2
"RTN","BSTSWSV",500,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV",501,0)
 ;
"RTN","BSTSWSV",502,0)
 ;Output
"RTN","BSTSWSV",503,0)
 ; Function - 0:No Data Returned, 1:Data Returned
"RTN","BSTSWSV",504,0)
 ; BSTSSRV - Array of web service connection information
"RTN","BSTSWSV",505,0)
 ;
"RTN","BSTSWSV",506,0)
 N DA,IENS,URLRT,PORT,TYPE,TIME,USER,PASS,II,SPATH,IADT,SSL,CTIME
"RTN","BSTSWSV",507,0)
 ;
"RTN","BSTSWSV",508,0)
 ;Pull Server information
"RTN","BSTSWSV",509,0)
 S IADT=$$GET1^DIQ(9002318.2,WSIEN_",",".1","I")
"RTN","BSTSWSV",510,0)
 I IADT]"",IADT<DT Q 0
"RTN","BSTSWSV",511,0)
 S URLRT=$$GET1^DIQ(9002318.2,WSIEN_",",".02","E")
"RTN","BSTSWSV",512,0)
 S PORT=$$GET1^DIQ(9002318.2,WSIEN_",",".03","E")
"RTN","BSTSWSV",513,0)
 S TYPE=$$GET1^DIQ(9002318.2,WSIEN_",",".04","I")
"RTN","BSTSWSV",514,0)
 S TIME=$$GET1^DIQ(9002318.2,WSIEN_",",".05","I")
"RTN","BSTSWSV",515,0)
 S USER=$$GET1^DIQ(9002318.2,WSIEN_",",".07","E")
"RTN","BSTSWSV",516,0)
 S PASS=$$GET1^DIQ(9002318.2,WSIEN_",",".08","E")
"RTN","BSTSWSV",517,0)
 S IADT=$$GET1^DIQ(9002318.2,WSIEN_",",".1","I")
"RTN","BSTSWSV",518,0)
 S SPATH=$$GET1^DIQ(9002318.2,WSIEN_",",".11","E")
"RTN","BSTSWSV",519,0)
 S SSL=$$GET1^DIQ(9002318.2,WSIEN_",","2.01","E")
"RTN","BSTSWSV",520,0)
 S CTIME=$$GET1^DIQ(9002318.2,WSIEN_",",".12","I") S:CTIME="" CTIME=2
"RTN","BSTSWSV",521,0)
 S II=$O(BSTSSRV(""),-1)+1
"RTN","BSTSWSV",522,0)
 S BSTSSRV(II,"URLROOT")=URLRT
"RTN","BSTSWSV",523,0)
 S BSTSSRV(II,"PORT")=PORT
"RTN","BSTSWSV",524,0)
 S BSTSSRV(II,"TYPE")=TYPE
"RTN","BSTSWSV",525,0)
 S BSTSSRV(II,"USER")=USER
"RTN","BSTSWSV",526,0)
 S BSTSSRV(II,"PASS")=PASS
"RTN","BSTSWSV",527,0)
 S BSTSSRV(II,"TIMEOUT")=TIME
"RTN","BSTSWSV",528,0)
 S BSTSSRV(II,"DEBUG")=DEBUG
"RTN","BSTSWSV",529,0)
 S BSTSSRV(II,"SERVICEPATH")=SPATH
"RTN","BSTSWSV",530,0)
 S BSTSSRV(II,"SSL")=SSL
"RTN","BSTSWSV",531,0)
 S BSTSSRV(II,"CTIME")=CTIME
"RTN","BSTSWSV",532,0)
 ;
"RTN","BSTSWSV",533,0)
 Q 1
"RTN","BSTSWSV1")
0^20^B6736795
"RTN","BSTSWSV1",1,0)
BSTSWSV1 ;GDIT/HS/BEE-Standard Terminology Web Service Handling (CONT) ;26-Jun-2015 18:12;DKM
"RTN","BSTSWSV1",2,0)
 ;;1.0;IHS STANDARD TERMINOLOGY;;Sep 10, 2014;Build 116
"RTN","BSTSWSV1",3,0)
 ;
"RTN","BSTSWSV1",4,0)
 Q
"RTN","BSTSWSV1",5,0)
 ;
"RTN","BSTSWSV1",6,0)
DILKP(OUT,IN,DEBUG) ;EP - Perform a Web Service Drug Ingredient Lookup
"RTN","BSTSWSV1",7,0)
 ;
"RTN","BSTSWSV1",8,0)
 ;Input
"RTN","BSTSWSV1",9,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV1",10,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV1",11,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV1",12,0)
 ;
"RTN","BSTSWSV1",13,0)
 ;Output
"RTN","BSTSWSV1",14,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV1",15,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV1",16,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV1",17,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV1",18,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV1",19,0)
 ;
"RTN","BSTSWSV1",20,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV1",21,0)
 ; [1] - Concept ID
"RTN","BSTSWSV1",22,0)
 ; [2] - DTS ID
"RTN","BSTSWSV1",23,0)
 ; [3] - Description ID
"RTN","BSTSWSV1",24,0)
 ;
"RTN","BSTSWSV1",25,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV1",26,0)
 ;
"RTN","BSTSWSV1",27,0)
 ;Define DEBUG
"RTN","BSTSWSV1",28,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV1",29,0)
 ;
"RTN","BSTSWSV1",30,0)
 ;Get list of servers
"RTN","BSTSWSV1",31,0)
 S STS=$$WSERVER^BSTSWSV(.BSTSSRV,DEBUG)
"RTN","BSTSWSV1",32,0)
 ;
"RTN","BSTSWSV1",33,0)
 ;Loop through list and make each call
"RTN","BSTSWSV1",34,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV1",35,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV1",36,0)
 . ;
"RTN","BSTSWSV1",37,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV1",38,0)
 . M BSTSWS=IN
"RTN","BSTSWSV1",39,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV1",40,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV1",41,0)
 . ;
"RTN","BSTSWSV1",42,0)
 . ;Call DTS
"RTN","BSTSWSV1",43,0)
 . I TYPE="D" S CSTS=$$DILKP^BSTSDTS1(OUT,.BSTSWS)
"RTN","BSTSWSV1",44,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV1",45,0)
 . ;
"RTN","BSTSWSV1",46,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV1",47,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV1",48,0)
 . ;
"RTN","BSTSWSV1",49,0)
 . ;Define status variable
"RTN","BSTSWSV1",50,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV1",51,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV1",52,0)
 ;
"RTN","BSTSWSV1",53,0)
 Q STS
"RTN","BSTSWSV1",54,0)
 ;
"RTN","BSTSWSV1",55,0)
 ;
"RTN","BSTSWSV1",56,0)
USEARCH(OUT,IN,DEBUG) ;EP - Perform a Web Service UNIVERSE Search
"RTN","BSTSWSV1",57,0)
 ;
"RTN","BSTSWSV1",58,0)
 ;Input
"RTN","BSTSWSV1",59,0)
 ; OUT - Output variable/global to return information in (VAR)
"RTN","BSTSWSV1",60,0)
 ; IN Array - List of search parameters
"RTN","BSTSWSV1",61,0)
 ; DEBUG - 1:DEBUG mode
"RTN","BSTSWSV1",62,0)
 ;
"RTN","BSTSWSV1",63,0)
 ;Output
"RTN","BSTSWSV1",64,0)
 ; Function returns - [1]^[2]^[3]
"RTN","BSTSWSV1",65,0)
 ; [1] - 1:Successful remote call
"RTN","BSTSWSV1",66,0)
 ;       0:Unsuccessful remote call
"RTN","BSTSWSV1",67,0)
 ; [2] - Primary Remote Error Message
"RTN","BSTSWSV1",68,0)
 ; [3] - Secondary Remote Error Message (if applicable)
"RTN","BSTSWSV1",69,0)
 ;
"RTN","BSTSWSV1",70,0)
 ; VAR(#) - [1]^[2]^[3]
"RTN","BSTSWSV1",71,0)
 ; [1] - Concept ID
"RTN","BSTSWSV1",72,0)
 ; [2] - DTS ID
"RTN","BSTSWSV1",73,0)
 ; [3] - Description ID
"RTN","BSTSWSV1",74,0)
 ;
"RTN","BSTSWSV1",75,0)
 N BSTSSRV,PRI,STS,II
"RTN","BSTSWSV1",76,0)
 ;
"RTN","BSTSWSV1",77,0)
 ;Define DEBUG
"RTN","BSTSWSV1",78,0)
 S DEBUG=$G(DEBUG,"")
"RTN","BSTSWSV1",79,0)
 ;
"RTN","BSTSWSV1",80,0)
 ;Get list of servers
"RTN","BSTSWSV1",81,0)
 S STS=$$WSERVER^BSTSWSV(.BSTSSRV,DEBUG)
"RTN","BSTSWSV1",82,0)
 ;
"RTN","BSTSWSV1",83,0)
 ;Loop through list and make each call
"RTN","BSTSWSV1",84,0)
 I $D(BSTSSRV)<10 S STS="0^No Active Server Found"
"RTN","BSTSWSV1",85,0)
 I $D(BSTSSRV)>1 S STS=0,PRI="" F II=2:1 S PRI=$O(BSTSSRV(PRI)) Q:PRI=""  D  Q:+STS
"RTN","BSTSWSV1",86,0)
 . ;
"RTN","BSTSWSV1",87,0)
 . N BSTSWS,TYPE,TIME,CSTS
"RTN","BSTSWSV1",88,0)
 . M BSTSWS=IN
"RTN","BSTSWSV1",89,0)
 . M BSTSWS=BSTSSRV(PRI)
"RTN","BSTSWSV1",90,0)
 . S TYPE=$G(BSTSWS("TYPE")),CSTS=""
"RTN","BSTSWSV1",91,0)
 . ;
"RTN","BSTSWSV1",92,0)
 . ;Call DTS
"RTN","BSTSWSV1",93,0)
 . S CSTS=$$USEARCH^BSTSDTS3(OUT,.BSTSWS)
"RTN","BSTSWSV1",94,0)
 . I $G(BSTSWS("DEBUG")) W !!,"DTS: ",CSTS,!
"RTN","BSTSWSV1",95,0)
 . ;
"RTN","BSTSWSV1",96,0)
 . ;Log call times (needs completed)
"RTN","BSTSWSV1",97,0)
 . S TIME=$P(CSTS,U,3)
"RTN","BSTSWSV1",98,0)
 . ;
"RTN","BSTSWSV1",99,0)
 . ;Define status variable
"RTN","BSTSWSV1",100,0)
 . S $P(STS,U)=+CSTS
"RTN","BSTSWSV1",101,0)
 . I II<4 S $P(STS,U,II)=$P(CSTS,U,2)
"RTN","BSTSWSV1",102,0)
 ;
"RTN","BSTSWSV1",103,0)
 Q STS
"SEC","^DIC",9002318,9002318,0,"AUDIT")
@
"SEC","^DIC",9002318,9002318,0,"DD")
@
"SEC","^DIC",9002318,9002318,0,"DEL")
@
"SEC","^DIC",9002318,9002318,0,"LAYGO")
@
"SEC","^DIC",9002318,9002318,0,"RD")
@
"SEC","^DIC",9002318,9002318,0,"WR")
@
"SEC","^DIC",9002318.1,9002318.1,0,"AUDIT")
@
"SEC","^DIC",9002318.1,9002318.1,0,"DD")
@
"SEC","^DIC",9002318.1,9002318.1,0,"DEL")
@
"SEC","^DIC",9002318.1,9002318.1,0,"LAYGO")
@
"SEC","^DIC",9002318.1,9002318.1,0,"RD")
@
"SEC","^DIC",9002318.1,9002318.1,0,"WR")
@
"SEC","^DIC",9002318.2,9002318.2,0,"AUDIT")
@
"SEC","^DIC",9002318.2,9002318.2,0,"DD")
@
"SEC","^DIC",9002318.2,9002318.2,0,"DEL")
@
"SEC","^DIC",9002318.2,9002318.2,0,"LAYGO")
@
"SEC","^DIC",9002318.2,9002318.2,0,"RD")
@
"SEC","^DIC",9002318.2,9002318.2,0,"WR")
@
"SEC","^DIC",9002318.3,9002318.3,0,"AUDIT")
@
"SEC","^DIC",9002318.3,9002318.3,0,"DD")
@
"SEC","^DIC",9002318.3,9002318.3,0,"DEL")
@
"SEC","^DIC",9002318.3,9002318.3,0,"LAYGO")
@
"SEC","^DIC",9002318.3,9002318.3,0,"RD")
@
"SEC","^DIC",9002318.3,9002318.3,0,"WR")
@
"SEC","^DIC",9002318.4,9002318.4,0,"AUDIT")
@
"SEC","^DIC",9002318.4,9002318.4,0,"DD")
@
"SEC","^DIC",9002318.4,9002318.4,0,"DEL")
@
"SEC","^DIC",9002318.4,9002318.4,0,"LAYGO")
@
"SEC","^DIC",9002318.4,9002318.4,0,"RD")
@
"SEC","^DIC",9002318.4,9002318.4,0,"WR")
@
"SEC","^DIC",9002318.5,9002318.5,0,"AUDIT")
@
"SEC","^DIC",9002318.5,9002318.5,0,"DD")
@
"SEC","^DIC",9002318.5,9002318.5,0,"DEL")
@
"SEC","^DIC",9002318.5,9002318.5,0,"LAYGO")
@
"SEC","^DIC",9002318.5,9002318.5,0,"RD")
@
"SEC","^DIC",9002318.5,9002318.5,0,"WR")
@
"VER")
8.0^22.0
"^DD",9002318,9002318,0)
FIELD^^.02^3
"^DD",9002318,9002318,0,"DT")
3140710
"^DD",9002318,9002318,0,"IX","B",9002318,.01)

"^DD",9002318,9002318,0,"IX","C",9002318.01,.02)

"^DD",9002318,9002318,0,"NM","BSTS SITE PARAMETERS")

"^DD",9002318,9002318,0,"VRPK")
IHS STANDARD TERMINOLOGY
"^DD",9002318,9002318,.01,0)
NAME^RP9999999.06'^AUTTLOC(^0;1^Q
"^DD",9002318,9002318,.01,1,0)
^.1
"^DD",9002318,9002318,.01,1,1,0)
9002318^B
"^DD",9002318,9002318,.01,1,1,1)
S ^BSTS(9002318,"B",$E(X,1,30),DA)=""
"^DD",9002318,9002318,.01,1,1,2)
K ^BSTS(9002318,"B",$E(X,1,30),DA)
"^DD",9002318,9002318,.01,3)

"^DD",9002318,9002318,.01,"DT")
3121031
"^DD",9002318,9002318,.02,0)
REFRESH SUBSETS EVERY # DAYS^NJ3,0^^0;2^K:+X'=X!(X>999)!(X<14)!(X?.E1"."1N.N) X
"^DD",9002318,9002318,.02,3)
Automatically refresh the subsets every 'x' days. The recommended range is between 30 and 90 days.  A null in this field will result in the subsets getting automatically refreshed every 60 days.
"^DD",9002318,9002318,.02,21,0)
^^3^3^3140409^
"^DD",9002318,9002318,.02,21,1,0)
Automatically refresh the subsets every 'x' days.  The recommended range 
"^DD",9002318,9002318,.02,21,2,0)
is between 30 and 90 days.  A null in this field will result in the 
"^DD",9002318,9002318,.02,21,3,0)
subsets getting automatically refreshed every 60 days.
"^DD",9002318,9002318,.02,"DT")
3140409
"^DD",9002318,9002318,1,0)
WEB SERVICE^9002318.01P^^1;0
"^DD",9002318,9002318.01,0)
WEB SERVICE SUB-FIELD^^.03^3
"^DD",9002318,9002318.01,0,"DT")
3121031
"^DD",9002318,9002318.01,0,"IX","B",9002318.01,.01)

"^DD",9002318,9002318.01,0,"IX","C",9002318.01,.02)

"^DD",9002318,9002318.01,0,"NM","WEB SERVICE")

"^DD",9002318,9002318.01,0,"UP")
9002318
"^DD",9002318,9002318.01,.01,0)
WEB SERVICE^MP9002318.2'^BSTS(9002318.2,^0;1^Q
"^DD",9002318,9002318.01,.01,1,0)
^.1
"^DD",9002318,9002318.01,.01,1,1,0)
9002318.01^B
"^DD",9002318,9002318.01,.01,1,1,1)
S ^BSTS(9002318,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002318,9002318.01,.01,1,1,2)
K ^BSTS(9002318,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002318,9002318.01,.01,"DT")
3121031
"^DD",9002318,9002318.01,.02,0)
PRIORITY^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318,9002318.01,.02,1,0)
^.1
"^DD",9002318,9002318.01,.02,1,1,0)
9002318^C
"^DD",9002318,9002318.01,.02,1,1,1)
S ^BSTS(9002318,"C",$E(X,1,30),DA(1),DA)=""
"^DD",9002318,9002318.01,.02,1,1,2)
K ^BSTS(9002318,"C",$E(X,1,30),DA(1),DA)
"^DD",9002318,9002318.01,.02,1,1,"DT")
3121109
"^DD",9002318,9002318.01,.02,1,2,0)
9002318.01^C
"^DD",9002318,9002318.01,.02,1,2,1)
S ^BSTS(9002318,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",9002318,9002318.01,.02,1,2,2)
K ^BSTS(9002318,DA(1),1,"C",$E(X,1,30),DA)
"^DD",9002318,9002318.01,.02,1,2,"DT")
3121109
"^DD",9002318,9002318.01,.02,3)
Type a number between 1 and 99, 0 decimal digits.
"^DD",9002318,9002318.01,.02,"DT")
3121109
"^DD",9002318,9002318.01,.03,0)
DAYS TO KEEP RESPONSE^NJ2,0^^0;3^K:+X'=X!(X>90)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318,9002318.01,.03,3)
Type a number between 1 and 90, 0 decimal digits.
"^DD",9002318,9002318.01,.03,21,0)
^^1^1^3121031^
"^DD",9002318,9002318.01,.03,21,1,0)
The number of days to keep the requested search response on file.
"^DD",9002318,9002318.01,.03,"DT")
3121031
"^DD",9002318.1,9002318.1,0)
FIELD^^.09^10
"^DD",9002318.1,9002318.1,0,"DDA")
N
"^DD",9002318.1,9002318.1,0,"DT")
3140710
"^DD",9002318.1,9002318.1,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002318.1,9002318.1,0,"IX","B",9002318.1,.01)

"^DD",9002318.1,9002318.1,0,"IX","C",9002318.1,.02)

"^DD",9002318.1,9002318.1,0,"IX","D",9002318.1,.03)

"^DD",9002318.1,9002318.1,0,"NM","BSTS CODESET")

"^DD",9002318.1,9002318.1,0,"PT",9002318.3,.08)

"^DD",9002318.1,9002318.1,0,"PT",9002318.4,.07)

"^DD",9002318.1,9002318.1,0,"VRPK")
IHS STANDARD TERMINOLOGY
"^DD",9002318.1,9002318.1,.01,0)
ID^RF^^0;1^K:$L(X)>5!($L(X)<1)!'(X'?1P.E) X
"^DD",9002318.1,9002318.1,.01,1,0)
^.1
"^DD",9002318.1,9002318.1,.01,1,1,0)
9002318.1^B
"^DD",9002318.1,9002318.1,.01,1,1,1)
S ^BSTS(9002318.1,"B",$E(X,1,30),DA)=""
"^DD",9002318.1,9002318.1,.01,1,1,2)
K ^BSTS(9002318.1,"B",$E(X,1,30),DA)
"^DD",9002318.1,9002318.1,.01,3)
Answer must be 1-5 characters in length.
"^DD",9002318.1,9002318.1,.01,"DT")
3121108
"^DD",9002318.1,9002318.1,.02,0)
CODE^F^^0;2^K:$L(X)>15!($L(X)<1) X
"^DD",9002318.1,9002318.1,.02,1,0)
^.1
"^DD",9002318.1,9002318.1,.02,1,1,0)
9002318.1^C
"^DD",9002318.1,9002318.1,.02,1,1,1)
S ^BSTS(9002318.1,"C",$E(X,1,30),DA)=""
"^DD",9002318.1,9002318.1,.02,1,1,2)
K ^BSTS(9002318.1,"C",$E(X,1,30),DA)
"^DD",9002318.1,9002318.1,.02,1,1,"DT")
3121108
"^DD",9002318.1,9002318.1,.02,3)
Answer must be 1-15 characters in length.
"^DD",9002318.1,9002318.1,.02,"DT")
3121108
"^DD",9002318.1,9002318.1,.03,0)
NAME^F^^0;3^K:$L(X)>15!($L(X)<1) X
"^DD",9002318.1,9002318.1,.03,1,0)
^.1
"^DD",9002318.1,9002318.1,.03,1,1,0)
9002318.1^D
"^DD",9002318.1,9002318.1,.03,1,1,1)
S ^BSTS(9002318.1,"D",$E(X,1,30),DA)=""
"^DD",9002318.1,9002318.1,.03,1,1,2)
K ^BSTS(9002318.1,"D",$E(X,1,30),DA)
"^DD",9002318.1,9002318.1,.03,1,1,"DT")
3130725
"^DD",9002318.1,9002318.1,.03,3)
Answer must be 1-15 characters in length.
"^DD",9002318.1,9002318.1,.03,"DT")
3130725
"^DD",9002318.1,9002318.1,.04,0)
CURRENT VERSION^F^^0;4^K:$L(X)>15!($L(X)<1) X
"^DD",9002318.1,9002318.1,.04,3)
Answer must be 1-15 characters in length.
"^DD",9002318.1,9002318.1,.04,"DT")
3121031
"^DD",9002318.1,9002318.1,.05,0)
LAST VERSION CHECK^D^^0;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.1,9002318.1,.05,21,0)
^^1^1^3130129^
"^DD",9002318.1,9002318.1,.05,21,1,0)
This field lists the date that the last version check was performed.
"^DD",9002318.1,9002318.1,.05,"DT")
3130129
"^DD",9002318.1,9002318.1,.06,0)
LAST SUBSET CHECK^D^^0;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.1,9002318.1,.06,"DT")
3130311
"^DD",9002318.1,9002318.1,.07,0)
TASK NUMBER^F^^0;7^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.1,9002318.1,.07,3)
Answer must be 1-20 characters in length.
"^DD",9002318.1,9002318.1,.07,"DT")
3140710
"^DD",9002318.1,9002318.1,.08,0)
SUBSET TASK NUMBER^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.1,9002318.1,.08,3)
Answer must be 1-20 characters in length.
"^DD",9002318.1,9002318.1,.08,"DT")
3140710
"^DD",9002318.1,9002318.1,.09,0)
ICD2SMD TASK NUMBER^F^^0;9^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.1,9002318.1,.09,3)
Answer must be 1-20 characters in length.
"^DD",9002318.1,9002318.1,.09,"DT")
3140710
"^DD",9002318.1,9002318.1,1,0)
VERSION^9002318.11^^1;0
"^DD",9002318.1,9002318.11,0)
VERSION SUB-FIELD^^.04^4
"^DD",9002318.1,9002318.11,0,"DT")
3121031
"^DD",9002318.1,9002318.11,0,"IX","B",9002318.11,.01)

"^DD",9002318.1,9002318.11,0,"NM","VERSION")

"^DD",9002318.1,9002318.11,0,"UP")
9002318.1
"^DD",9002318.1,9002318.11,.01,0)
ID^MF^^0;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002318.1,9002318.11,.01,1,0)
^.1
"^DD",9002318.1,9002318.11,.01,1,1,0)
9002318.11^B
"^DD",9002318.1,9002318.11,.01,1,1,1)
S ^BSTS(9002318.1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002318.1,9002318.11,.01,1,1,2)
K ^BSTS(9002318.1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002318.1,9002318.11,.01,3)
Answer must be 1-15 characters in length.
"^DD",9002318.1,9002318.11,.01,"DT")
3121031
"^DD",9002318.1,9002318.11,.02,0)
NAME^F^^0;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002318.1,9002318.11,.02,3)
Answer must be 1-25 characters in length.
"^DD",9002318.1,9002318.11,.02,"DT")
3121031
"^DD",9002318.1,9002318.11,.03,0)
RELEASE DATE^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.1,9002318.11,.03,"DT")
3121031
"^DD",9002318.1,9002318.11,.04,0)
INSTALLED DATE^D^^0;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.1,9002318.11,.04,"DT")
3121031
"^DD",9002318.2,9002318.2,0)
FIELD^^.12^14
"^DD",9002318.2,9002318.2,0,"DT")
3140703
"^DD",9002318.2,9002318.2,0,"IX","B",9002318.2,.01)

"^DD",9002318.2,9002318.2,0,"NM","BSTS WEB SERVICE ENDPOINT")

"^DD",9002318.2,9002318.2,0,"PT",9002318.01,.01)

"^DD",9002318.2,9002318.2,0,"VRPK")
IHS STANDARD TERMINOLOGY
"^DD",9002318.2,9002318.2,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002318.2,9002318.2,.01,1,0)
^.1
"^DD",9002318.2,9002318.2,.01,1,1,0)
9002318.2^B
"^DD",9002318.2,9002318.2,.01,1,1,1)
S ^BSTS(9002318.2,"B",$E(X,1,30),DA)=""
"^DD",9002318.2,9002318.2,.01,1,1,2)
K ^BSTS(9002318.2,"B",$E(X,1,30),DA)
"^DD",9002318.2,9002318.2,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002318.2,9002318.2,.02,0)
URL ROOT^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002318.2,9002318.2,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002318.2,9002318.2,.02,21,0)
^.001^2^2^3121113^^
"^DD",9002318.2,9002318.2,.02,21,1,0)
The DNS identifier for the web services endpoint.  Use name instead of IP 
"^DD",9002318.2,9002318.2,.02,21,2,0)
address.
"^DD",9002318.2,9002318.2,.02,"DT")
3121113
"^DD",9002318.2,9002318.2,.03,0)
PORT NUMBER^F^^0;3^K:$L(X)>5!($L(X)<1) X
"^DD",9002318.2,9002318.2,.03,3)
Answer must be 1-5 characters in length.
"^DD",9002318.2,9002318.2,.03,"DT")
3121031
"^DD",9002318.2,9002318.2,.04,0)
TYPE^S^D:DTS4;^0;4^Q
"^DD",9002318.2,9002318.2,.04,"DT")
3121031
"^DD",9002318.2,9002318.2,.05,0)
TIMEOUT OVERRIDE^F^^0;5^K:$L(X)>10!($L(X)<1) X
"^DD",9002318.2,9002318.2,.05,3)
Answer must be 1-10 characters in length.
"^DD",9002318.2,9002318.2,.05,"DT")
3121031
"^DD",9002318.2,9002318.2,.06,0)
CURRENT VERSION^F^^0;6^K:$L(X)>5!($L(X)<1) X
"^DD",9002318.2,9002318.2,.06,3)
Answer must be 1-5 characters in length.
"^DD",9002318.2,9002318.2,.06,"DT")
3121031
"^DD",9002318.2,9002318.2,.07,0)
USERNAME^F^^0;7^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.2,9002318.2,.07,3)
Answer must be 1-20 characters in length.
"^DD",9002318.2,9002318.2,.07,"DT")
3121105
"^DD",9002318.2,9002318.2,.08,0)
PASSWORD^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.2,9002318.2,.08,3)
Answer must be 1-20 characters in length.
"^DD",9002318.2,9002318.2,.08,"DT")
3121105
"^DD",9002318.2,9002318.2,.09,0)
INACTIVE^S^1:Inactive;^0;9^Q
"^DD",9002318.2,9002318.2,.09,"DT")
3121109
"^DD",9002318.2,9002318.2,.1,0)
INACTIVE DATE^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.2,9002318.2,.1,"DT")
3121109
"^DD",9002318.2,9002318.2,.11,0)
SERVICE PATH^F^^0;11^K:$L(X)>80!($L(X)<1) X
"^DD",9002318.2,9002318.2,.11,3)
Answer must be 1-80 characters in length.
"^DD",9002318.2,9002318.2,.11,"DT")
3121113
"^DD",9002318.2,9002318.2,.12,0)
CONNECTION TIMEOUT OVERRIDE^NJ2,0^^0;12^K:+X'=X!(X>90)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318.2,9002318.2,.12,3)
Enter the connection timeout override value (the default is 2)
"^DD",9002318.2,9002318.2,.12,"DT")
3140703
"^DD",9002318.2,9002318.2,1,0)
VERSION^9002318.21^^1;0
"^DD",9002318.2,9002318.2,2.01,0)
SSL/TLS CONFIGURATION^F^^2;1^K:$L(X)>30!($L(X)<3) X
"^DD",9002318.2,9002318.2,2.01,3)
Answer must be 3-30 characters in length.
"^DD",9002318.2,9002318.2,2.01,21,0)
^^2^2^3131105^
"^DD",9002318.2,9002318.2,2.01,21,1,0)
If using SSL, enter the name of the SSL/TLS CONFIGURATION as found in the 
"^DD",9002318.2,9002318.2,2.01,21,2,0)
Ensemble System Management, SSL/TLS Configurations definition page.
"^DD",9002318.2,9002318.2,2.01,"DT")
3131105
"^DD",9002318.2,9002318.21,0)
VERSION SUB-FIELD^^.02^2
"^DD",9002318.2,9002318.21,0,"DT")
3121031
"^DD",9002318.2,9002318.21,0,"IX","B",9002318.21,.01)

"^DD",9002318.2,9002318.21,0,"NM","VERSION")

"^DD",9002318.2,9002318.21,0,"UP")
9002318.2
"^DD",9002318.2,9002318.21,.01,0)
VERSION^MF^^0;1^K:$L(X)>5!($L(X)<1) X
"^DD",9002318.2,9002318.21,.01,1,0)
^.1
"^DD",9002318.2,9002318.21,.01,1,1,0)
9002318.21^B
"^DD",9002318.2,9002318.21,.01,1,1,1)
S ^BSTS(9002318.2,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002318.2,9002318.21,.01,1,1,2)
K ^BSTS(9002318.2,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002318.2,9002318.21,.01,3)
Answer must be 1-5 characters in length.
"^DD",9002318.2,9002318.21,.01,"DT")
3121031
"^DD",9002318.2,9002318.21,.02,0)
DATE INSTALLED^D^^0;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.2,9002318.21,.02,"DT")
3121031
"^DD",9002318.3,9002318.3,0)
FIELD^^.1^13
"^DD",9002318.3,9002318.3,0,"DT")
3130311
"^DD",9002318.3,9002318.3,0,"IX","B",9002318.3,.01)

"^DD",9002318.3,9002318.3,0,"IX","E",9002318.3,1)

"^DD",9002318.3,9002318.3,0,"NM","BSTS TERMINOLOGY")

"^DD",9002318.3,9002318.3,0,"VRPK")
IHS STANDARD TERMINOLOGY
"^DD",9002318.3,9002318.3,.01,0)
COUNTER^RNJ10,0^^0;1^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318.3,9002318.3,.01,1,0)
^.1
"^DD",9002318.3,9002318.3,.01,1,1,0)
9002318.3^B
"^DD",9002318.3,9002318.3,.01,1,1,1)
S ^BSTS(9002318.3,"B",$E(X,1,30),DA)=""
"^DD",9002318.3,9002318.3,.01,1,1,2)
K ^BSTS(9002318.3,"B",$E(X,1,30),DA)
"^DD",9002318.3,9002318.3,.01,3)
Type a number between 1 and 9999999999, 0 decimal digits.
"^DD",9002318.3,9002318.3,.01,"DT")
3121108
"^DD",9002318.3,9002318.3,.02,0)
DESCRIPTION ID^F^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.3,9002318.3,.02,1,0)
^.1^^0
"^DD",9002318.3,9002318.3,.02,3)
Answer must be 1-20 characters in length.
"^DD",9002318.3,9002318.3,.02,"DT")
3121114
"^DD",9002318.3,9002318.3,.03,0)
CONCEPT ID^P9002318.4'^BSTS(9002318.4,^0;3^Q
"^DD",9002318.3,9002318.3,.03,"DT")
3121115
"^DD",9002318.3,9002318.3,.04,0)
PARTIAL ENTRY^S^N:NON-PATIAL (FULL ENTRY);P:PARTIAL;^0;4^Q
"^DD",9002318.3,9002318.3,.04,"DT")
3130111
"^DD",9002318.3,9002318.3,.05,0)
VERSION^F^^0;5^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.3,9002318.3,.05,3)
Answer must be 1-20 characters in length.
"^DD",9002318.3,9002318.3,.05,"DT")
3121108
"^DD",9002318.3,9002318.3,.06,0)
REVISION IN^D^^0;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.3,9002318.3,.06,"DT")
3121108
"^DD",9002318.3,9002318.3,.07,0)
REVISION OUT^D^^0;7^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.3,9002318.3,.07,"DT")
3121108
"^DD",9002318.3,9002318.3,.08,0)
CODESET^P9002318.1'^BSTS(9002318.1,^0;8^Q
"^DD",9002318.3,9002318.3,.08,"DT")
3121115
"^DD",9002318.3,9002318.3,.09,0)
TYPE^S^P:PREFERRED TERM;S:SYNONYM;F:FULLY SPECIFIED NAME;^0;9^Q
"^DD",9002318.3,9002318.3,.09,"DT")
3121115
"^DD",9002318.3,9002318.3,.1,0)
LAST MODIFIED^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.3,9002318.3,.1,"DT")
3130311
"^DD",9002318.3,9002318.3,.11,0)
OUT OF DATE^S^N:NO;Y:YES;^0;11^Q
"^DD",9002318.3,9002318.3,.11,"DT")
3130111
"^DD",9002318.3,9002318.3,1,0)
TERM^F^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",9002318.3,9002318.3,1,1,0)
^.1
"^DD",9002318.3,9002318.3,1,1,1,0)
9002318.3^E^MUMPS
"^DD",9002318.3,9002318.3,1,1,1,1)
D SXF^BSTSSRCH
"^DD",9002318.3,9002318.3,1,1,1,2)
D KXF^BSTSSRCH
"^DD",9002318.3,9002318.3,1,1,1,"DT")
3121116
"^DD",9002318.3,9002318.3,1,3)
Answer must be 1-245 characters in length.
"^DD",9002318.3,9002318.3,1,"DT")
3121116
"^DD",9002318.3,9002318.3,10,0)
FREQUENCY^NJ8,0^^10;1^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002318.3,9002318.3,10,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",9002318.3,9002318.3,10,"DT")
3121108
"^DD",9002318.4,9002318.4,0)
FIELD^^13^25
"^DD",9002318.4,9002318.4,0,"DT")
3140714
"^DD",9002318.4,9002318.4,0,"IX","B",9002318.4,.01)

"^DD",9002318.4,9002318.4,0,"IX","E",9002318.44,.01)

"^DD",9002318.4,9002318.4,0,"IX","F",9002318.43,.02)

"^DD",9002318.4,9002318.4,0,"IX","G",9002318.47,.01)

"^DD",9002318.4,9002318.4,0,"IX","H",9002318.48,.01)

"^DD",9002318.4,9002318.4,0,"IX","I",9002318.413,.01)

"^DD",9002318.4,9002318.4,0,"NM","BSTS CONCEPT")

"^DD",9002318.4,9002318.4,0,"PT",9002318.3,.03)

"^DD",9002318.4,9002318.4,0,"PT",9002318.45,.01)

"^DD",9002318.4,9002318.4,0,"PT",9002318.46,.01)

"^DD",9002318.4,9002318.4,0,"VRPK")
IHS STANDARD TERMINOLOGY
"^DD",9002318.4,9002318.4,.01,0)
COUNTER^RNJ10,0^^0;1^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318.4,9002318.4,.01,1,0)
^.1
"^DD",9002318.4,9002318.4,.01,1,1,0)
9002318.4^B
"^DD",9002318.4,9002318.4,.01,1,1,1)
S ^BSTS(9002318.4,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.4,.01,1,1,2)
K ^BSTS(9002318.4,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.4,.01,3)
Type a number between 1 and 9999999999, 0 decimal digits.
"^DD",9002318.4,9002318.4,.01,"DT")
3121108
"^DD",9002318.4,9002318.4,.02,0)
CONCEPT ID^F^^0;2^K:$L(X)>100!($L(X)<1) X
"^DD",9002318.4,9002318.4,.02,1,0)
^.1^^0
"^DD",9002318.4,9002318.4,.02,3)
Answer must be 1-100 characters in length.
"^DD",9002318.4,9002318.4,.02,"DT")
3130724
"^DD",9002318.4,9002318.4,.03,0)
PARTIAL ENTRY^S^N:NON-PATIAL (FULL ENTRY);P:PARTIAL;^0;3^Q
"^DD",9002318.4,9002318.4,.03,"DT")
3130111
"^DD",9002318.4,9002318.4,.04,0)
VERSION^F^^0;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.4,.04,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.4,.04,"DT")
3121108
"^DD",9002318.4,9002318.4,.05,0)
REVISION IN^D^^0;5^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.4,.05,"DT")
3121108
"^DD",9002318.4,9002318.4,.06,0)
REVISION OUT^D^^0;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.4,.06,"DT")
3121108
"^DD",9002318.4,9002318.4,.07,0)
CODESET^P9002318.1'^BSTS(9002318.1,^0;7^Q
"^DD",9002318.4,9002318.4,.07,"DT")
3121114
"^DD",9002318.4,9002318.4,.08,0)
DTS ID^F^^0;8^K:$L(X)>25!($L(X)<1) X
"^DD",9002318.4,9002318.4,.08,1,0)
^.1^^0
"^DD",9002318.4,9002318.4,.08,3)
Answer must be 1-25 characters in length.
"^DD",9002318.4,9002318.4,.08,21,0)
^^1^1^3121108^
"^DD",9002318.4,9002318.4,.08,21,1,0)
The id of the SNOMED record used in detail lookups.
"^DD",9002318.4,9002318.4,.08,"DT")
3121114
"^DD",9002318.4,9002318.4,.09,0)
MAP^NJ1,0^^0;9^K:+X'=X!(X>4)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002318.4,9002318.4,.09,3)
Type a number between 0 and 4, 0 decimal digits.
"^DD",9002318.4,9002318.4,.09,"DT")
3121108
"^DD",9002318.4,9002318.4,.1,0)
FSN DESCRIPTION ID^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.4,.1,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.4,.1,"DT")
3121108
"^DD",9002318.4,9002318.4,.11,0)
OUT OF DATE^S^N:NO;Y:YES;^0;11^Q
"^DD",9002318.4,9002318.4,.11,"DT")
3130111
"^DD",9002318.4,9002318.4,.12,0)
LAST MODIFIED^D^^0;12^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.4,.12,"DT")
3130311
"^DD",9002318.4,9002318.4,1,0)
FULLY SPECIFIED NAME^F^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",9002318.4,9002318.4,1,3)
Answer must be 1-245 characters in length.
"^DD",9002318.4,9002318.4,1,"DT")
3121119
"^DD",9002318.4,9002318.4,2,0)
MAP ADVICE^9002318.42^^2;0
"^DD",9002318.4,9002318.4,3,0)
ICD MAPPING^9002318.43^^3;0
"^DD",9002318.4,9002318.4,4,0)
SUBSETS^9002318.44A^^4;0
"^DD",9002318.4,9002318.4,5,0)
IS A RELATIONSHIP^9002318.45P^^5;0
"^DD",9002318.4,9002318.4,6,0)
SUBCONCEPTS^9002318.46PA^^6;0
"^DD",9002318.4,9002318.4,7,0)
NDC^9002318.47A^^7;0
"^DD",9002318.4,9002318.4,8,0)
VUID^9002318.48A^^8;0
"^DD",9002318.4,9002318.4,9,0)
ASSOCIATIONS^9002318.49A^^9;0
"^DD",9002318.4,9002318.4,9,"DT")
3130725
"^DD",9002318.4,9002318.4,10,0)
FREQUENCY^NJ7,0^^10;1^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002318.4,9002318.4,10,3)
Type a number between 0 and 9999999, 0 decimal digits.
"^DD",9002318.4,9002318.4,10,"DT")
3121108
"^DD",9002318.4,9002318.4,11,0)
INVERSE ASSOCIATIONS^9002318.411A^^11;0
"^DD",9002318.4,9002318.4,12,0)
TTY^9002318.412A^^12;0
"^DD",9002318.4,9002318.4,13,0)
ICD9 TO SNOMED MAP^9002318.413A^^13;0
"^DD",9002318.4,9002318.411,0)
INVERSE ASSOCIATIONS SUB-FIELD^^.04^4
"^DD",9002318.4,9002318.411,0,"DT")
3130815
"^DD",9002318.4,9002318.411,0,"IX","B",9002318.411,.01)

"^DD",9002318.4,9002318.411,0,"NM","INVERSE ASSOCIATIONS")

"^DD",9002318.4,9002318.411,0,"UP")
9002318.4
"^DD",9002318.4,9002318.411,.01,0)
CODE^F^^0;1^K:$L(X)>25!($L(X)<1) X
"^DD",9002318.4,9002318.411,.01,1,0)
^.1
"^DD",9002318.4,9002318.411,.01,1,1,0)
9002318.411^B
"^DD",9002318.4,9002318.411,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.411,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.411,.01,3)
Answer must be 1-25 characters in length.
"^DD",9002318.4,9002318.411,.01,"DT")
3130815
"^DD",9002318.4,9002318.411,.02,0)
CODESET^F^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002318.4,9002318.411,.02,3)
Answer must be 1-10 characters in length.
"^DD",9002318.4,9002318.411,.02,"DT")
3130815
"^DD",9002318.4,9002318.411,.03,0)
CODE DTSID^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.411,.03,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.411,.03,"DT")
3130815
"^DD",9002318.4,9002318.411,.04,0)
CODE TERM^F^^0;4^K:$L(X)>180!($L(X)<1) X
"^DD",9002318.4,9002318.411,.04,3)
Answer must be 1-180 characters in length.
"^DD",9002318.4,9002318.411,.04,"DT")
3130815
"^DD",9002318.4,9002318.412,0)
TTY SUB-FIELD^^.01^1
"^DD",9002318.4,9002318.412,0,"DT")
3131009
"^DD",9002318.4,9002318.412,0,"IX","B",9002318.412,.01)

"^DD",9002318.4,9002318.412,0,"NM","TTY")

"^DD",9002318.4,9002318.412,0,"UP")
9002318.4
"^DD",9002318.4,9002318.412,.01,0)
TTY^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",9002318.4,9002318.412,.01,1,0)
^.1
"^DD",9002318.4,9002318.412,.01,1,1,0)
9002318.412^B
"^DD",9002318.4,9002318.412,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),12,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.412,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),12,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.412,.01,3)
Answer must be 1-30 characters in length.
"^DD",9002318.4,9002318.412,.01,"DT")
3131009
"^DD",9002318.4,9002318.413,0)
ICD9 TO SNOMED MAP SUB-FIELD^^.01^1
"^DD",9002318.4,9002318.413,0,"DT")
3140702
"^DD",9002318.4,9002318.413,0,"IX","B",9002318.413,.01)

"^DD",9002318.4,9002318.413,0,"NM","ICD9 TO SNOMED MAP")

"^DD",9002318.4,9002318.413,0,"UP")
9002318.4
"^DD",9002318.4,9002318.413,.01,0)
ICD9 TO SNOMED MAP^F^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.413,.01,1,0)
^.1
"^DD",9002318.4,9002318.413,.01,1,1,0)
9002318.413^B
"^DD",9002318.4,9002318.413,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.413,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.413,.01,1,2,0)
9002318.4^I^MUMPS
"^DD",9002318.4,9002318.413,.01,1,2,1)
D I2SSX^BSTSUTIL
"^DD",9002318.4,9002318.413,.01,1,2,2)
D I2SKX^BSTSUTIL
"^DD",9002318.4,9002318.413,.01,1,2,"DT")
3140703
"^DD",9002318.4,9002318.413,.01,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.413,.01,"DT")
3140703
"^DD",9002318.4,9002318.42,0)
MAP ADVICE SUB-FIELD^^5.08^22
"^DD",9002318.4,9002318.42,0,"DT")
3130304
"^DD",9002318.4,9002318.42,0,"IX","B",9002318.42,.01)

"^DD",9002318.4,9002318.42,0,"NM","MAP ADVICE")

"^DD",9002318.4,9002318.42,0,"UP")
9002318.4
"^DD",9002318.4,9002318.42,.01,0)
NUMBER^MNJ6,0^^0;1^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318.4,9002318.42,.01,1,0)
^.1
"^DD",9002318.4,9002318.42,.01,1,1,0)
9002318.42^B
"^DD",9002318.4,9002318.42,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.42,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.42,.01,3)
Type a number between 1 and 999999, 0 decimal digits.
"^DD",9002318.4,9002318.42,.01,"DT")
3121108
"^DD",9002318.4,9002318.42,.02,0)
MAP GROUP^F^^0;2^K:$L(X)>5!($L(X)<1) X
"^DD",9002318.4,9002318.42,.02,3)
Answer must be 1-5 characters in length.
"^DD",9002318.4,9002318.42,.02,"DT")
3130304
"^DD",9002318.4,9002318.42,.03,0)
MG RIN^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,.03,"DT")
3130304
"^DD",9002318.4,9002318.42,.04,0)
MG ROUT^D^^0;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,.04,"DT")
3130304
"^DD",9002318.4,9002318.42,.05,0)
MAP PRIORITY^F^^0;5^K:$L(X)>5!($L(X)<1) X
"^DD",9002318.4,9002318.42,.05,3)
Answer must be 1-5 characters in length.
"^DD",9002318.4,9002318.42,.05,"DT")
3130304
"^DD",9002318.4,9002318.42,.06,0)
MP RIN^D^^0;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,.06,"DT")
3130304
"^DD",9002318.4,9002318.42,.07,0)
MP ROUT^D^^0;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,.07,"DT")
3130304
"^DD",9002318.4,9002318.42,.08,0)
MAP TARGET^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.42,.08,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.42,.08,"DT")
3130304
"^DD",9002318.4,9002318.42,.09,0)
MT RIN^D^^0;9^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,.09,"DT")
3130304
"^DD",9002318.4,9002318.42,.1,0)
MT ROUT^D^^0;10^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,.1,"DT")
3130304
"^DD",9002318.4,9002318.42,1,0)
MAPADVICE^9002318.421^^1;0
"^DD",9002318.4,9002318.42,2,0)
MAP TARGET NAME^9002318.422^^2;0
"^DD",9002318.4,9002318.42,3,0)
MAP RULE^9002318.423^^3;0
"^DD",9002318.4,9002318.42,4,0)
MAP CATEGORY VALUE^9002318.424^^4;0
"^DD",9002318.4,9002318.42,5.01,0)
MA RIN^D^^5;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.01,"DT")
3130304
"^DD",9002318.4,9002318.42,5.02,0)
MA ROUT^D^^5;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.02,"DT")
3130304
"^DD",9002318.4,9002318.42,5.03,0)
MR RIN^D^^5;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.03,"DT")
3130304
"^DD",9002318.4,9002318.42,5.04,0)
MR ROUT^D^^5;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.04,"DT")
3130304
"^DD",9002318.4,9002318.42,5.05,0)
MTN RIN^D^^5;5^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.05,"DT")
3130304
"^DD",9002318.4,9002318.42,5.06,0)
MTN ROUT^D^^5;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.06,"DT")
3130304
"^DD",9002318.4,9002318.42,5.07,0)
MCV RIN^D^^5;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.07,"DT")
3130304
"^DD",9002318.4,9002318.42,5.08,0)
MCV ROUT^D^^5;8^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.42,5.08,"DT")
3130304
"^DD",9002318.4,9002318.421,0)
MAPADVICE SUB-FIELD^^.01^1
"^DD",9002318.4,9002318.421,0,"DT")
3121108
"^DD",9002318.4,9002318.421,0,"NM","MAPADVICE")

"^DD",9002318.4,9002318.421,0,"UP")
9002318.42
"^DD",9002318.4,9002318.421,.01,0)
MAPADVICE^Wx^^0;1^Q
"^DD",9002318.4,9002318.421,.01,"DT")
3121108
"^DD",9002318.4,9002318.422,0)
MAP TARGET NAME SUB-FIELD^^.01^1
"^DD",9002318.4,9002318.422,0,"DT")
3130304
"^DD",9002318.4,9002318.422,0,"NM","MAP TARGET NAME")

"^DD",9002318.4,9002318.422,0,"UP")
9002318.42
"^DD",9002318.4,9002318.422,.01,0)
MAP TARGET NAME^Wx^^0;1^Q
"^DD",9002318.4,9002318.422,.01,"DT")
3130304
"^DD",9002318.4,9002318.423,0)
MAP RULE SUB-FIELD^^.01^1
"^DD",9002318.4,9002318.423,0,"DT")
3130304
"^DD",9002318.4,9002318.423,0,"NM","MAP RULE")

"^DD",9002318.4,9002318.423,0,"UP")
9002318.42
"^DD",9002318.4,9002318.423,.01,0)
MAP RULE^Wx^^0;1^Q
"^DD",9002318.4,9002318.423,.01,"DT")
3130304
"^DD",9002318.4,9002318.424,0)
MAP CATEGORY VALUE SUB-FIELD^^.01^1
"^DD",9002318.4,9002318.424,0,"DT")
3130304
"^DD",9002318.4,9002318.424,0,"NM","MAP CATEGORY VALUE")

"^DD",9002318.4,9002318.424,0,"UP")
9002318.42
"^DD",9002318.4,9002318.424,.01,0)
MAP CATEGORY VALUE^Wx^^0;1^Q
"^DD",9002318.4,9002318.424,.01,"DT")
3130304
"^DD",9002318.4,9002318.43,0)
ICD MAPPING SUB-FIELD^^.05^5
"^DD",9002318.4,9002318.43,0,"DT")
3140714
"^DD",9002318.4,9002318.43,0,"IX","B",9002318.43,.01)

"^DD",9002318.4,9002318.43,0,"IX","C",9002318.43,.02)

"^DD",9002318.4,9002318.43,0,"NM","ICD MAPPING")

"^DD",9002318.4,9002318.43,0,"UP")
9002318.4
"^DD",9002318.4,9002318.43,.01,0)
COUNTER^MNJ4,0^^0;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002318.4,9002318.43,.01,1,0)
^.1
"^DD",9002318.4,9002318.43,.01,1,1,0)
9002318.43^B
"^DD",9002318.4,9002318.43,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.43,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),3,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.43,.01,3)
Type a number between 1 and 9999, 0 decimal digits.
"^DD",9002318.4,9002318.43,.01,"DT")
3121108
"^DD",9002318.4,9002318.43,.02,0)
CODE^F^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002318.4,9002318.43,.02,1,0)
^.1
"^DD",9002318.4,9002318.43,.02,1,1,0)
9002318.43^C
"^DD",9002318.4,9002318.43,.02,1,1,1)
S ^BSTS(9002318.4,DA(1),3,"C",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.43,.02,1,1,2)
K ^BSTS(9002318.4,DA(1),3,"C",$E(X,1,30),DA)
"^DD",9002318.4,9002318.43,.02,1,1,"DT")
3121119
"^DD",9002318.4,9002318.43,.02,1,2,0)
9002318.4^F^MUMPS
"^DD",9002318.4,9002318.43,.02,1,2,1)
D ICDSX^BSTSUTIL
"^DD",9002318.4,9002318.43,.02,1,2,2)
D ICDKX^BSTSUTIL
"^DD",9002318.4,9002318.43,.02,1,2,"DT")
3130724
"^DD",9002318.4,9002318.43,.02,3)
Answer must be 1-10 characters in length.
"^DD",9002318.4,9002318.43,.02,"DT")
3130724
"^DD",9002318.4,9002318.43,.03,0)
CODE TYPE^S^IC9:ICD9 DX;ICP:ICD9 PR;10D:ICD10 DX;10P:ICD10 PR;^0;3^Q
"^DD",9002318.4,9002318.43,.03,"DT")
3140714
"^DD",9002318.4,9002318.43,.04,0)
REVISION IN^D^^0;4^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.43,.04,"DT")
3121108
"^DD",9002318.4,9002318.43,.05,0)
REVISION OUT^D^^0;5^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.43,.05,"DT")
3121108
"^DD",9002318.4,9002318.44,0)
SUBSETS SUB-FIELD^^.03^3
"^DD",9002318.4,9002318.44,0,"DT")
3121115
"^DD",9002318.4,9002318.44,0,"IX","B",9002318.44,.01)

"^DD",9002318.4,9002318.44,0,"NM","SUBSETS")

"^DD",9002318.4,9002318.44,0,"UP")
9002318.4
"^DD",9002318.4,9002318.44,.01,0)
SUBSETS^F^^0;1^K:$L(X)>150!($L(X)<1) X
"^DD",9002318.4,9002318.44,.01,1,0)
^.1
"^DD",9002318.4,9002318.44,.01,1,1,0)
9002318.44^B
"^DD",9002318.4,9002318.44,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.44,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),4,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.44,.01,1,2,0)
9002318.4^E^MUMPS
"^DD",9002318.4,9002318.44,.01,1,2,1)
D SBSX^BSTSUTIL
"^DD",9002318.4,9002318.44,.01,1,2,2)
D SBKX^BSTSUTIL
"^DD",9002318.4,9002318.44,.01,1,2,"DT")
3130724
"^DD",9002318.4,9002318.44,.01,3)
Answer must be 1-150 characters in length.
"^DD",9002318.4,9002318.44,.01,"DT")
3130724
"^DD",9002318.4,9002318.44,.02,0)
REVISION IN^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.44,.02,"DT")
3121115
"^DD",9002318.4,9002318.44,.03,0)
REVISION OUT^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.44,.03,"DT")
3121115
"^DD",9002318.4,9002318.45,0)
IS A RELATIONSHIP SUB-FIELD^^.03^3
"^DD",9002318.4,9002318.45,0,"DT")
3121108
"^DD",9002318.4,9002318.45,0,"IX","B",9002318.45,.01)

"^DD",9002318.4,9002318.45,0,"NM","IS A RELATIONSHIP")

"^DD",9002318.4,9002318.45,0,"UP")
9002318.4
"^DD",9002318.4,9002318.45,.01,0)
IS A RELATIONSHIP^MP9002318.4'^BSTS(9002318.4,^0;1^Q
"^DD",9002318.4,9002318.45,.01,1,0)
^.1^^-1
"^DD",9002318.4,9002318.45,.01,1,1,0)
9002318.45^B
"^DD",9002318.4,9002318.45,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.45,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),5,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.45,.01,"DT")
3121114
"^DD",9002318.4,9002318.45,.02,0)
REVISION IN^D^^0;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.45,.02,"DT")
3121108
"^DD",9002318.4,9002318.45,.03,0)
REVISION OUT^D^^0;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.45,.03,"DT")
3121108
"^DD",9002318.4,9002318.46,0)
SUBCONCEPTS SUB-FIELD^^.03^3
"^DD",9002318.4,9002318.46,0,"DT")
3130504
"^DD",9002318.4,9002318.46,0,"IX","B",9002318.46,.01)

"^DD",9002318.4,9002318.46,0,"NM","SUBCONCEPTS")

"^DD",9002318.4,9002318.46,0,"UP")
9002318.4
"^DD",9002318.4,9002318.46,.01,0)
SUBCONCEPTS^P9002318.4^BSTS(9002318.4,^0;1^Q
"^DD",9002318.4,9002318.46,.01,1,0)
^.1
"^DD",9002318.4,9002318.46,.01,1,1,0)
9002318.46^B
"^DD",9002318.4,9002318.46,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.46,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),6,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.46,.01,"DT")
3130504
"^DD",9002318.4,9002318.46,.02,0)
REVISION IN^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.46,.02,"DT")
3130504
"^DD",9002318.4,9002318.46,.03,0)
REVISION OUT^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.46,.03,"DT")
3130504
"^DD",9002318.4,9002318.47,0)
NDC SUB-FIELD^^.03^3
"^DD",9002318.4,9002318.47,0,"DT")
3130723
"^DD",9002318.4,9002318.47,0,"IX","B",9002318.47,.01)

"^DD",9002318.4,9002318.47,0,"NM","NDC")

"^DD",9002318.4,9002318.47,0,"UP")
9002318.4
"^DD",9002318.4,9002318.47,.01,0)
NDC^F^^0;1^K:$L(X)>15!($L(X)<3) X
"^DD",9002318.4,9002318.47,.01,1,0)
^.1
"^DD",9002318.4,9002318.47,.01,1,1,0)
9002318.47^B
"^DD",9002318.4,9002318.47,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.47,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),7,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.47,.01,1,2,0)
9002318.4^G^MUMPS
"^DD",9002318.4,9002318.47,.01,1,2,1)
D NDSX^BSTSUTIL
"^DD",9002318.4,9002318.47,.01,1,2,2)
D NDKX^BSTSUTIL
"^DD",9002318.4,9002318.47,.01,1,2,"DT")
3130724
"^DD",9002318.4,9002318.47,.01,3)
Answer must be 3-15 characters in length.
"^DD",9002318.4,9002318.47,.01,"DT")
3130724
"^DD",9002318.4,9002318.47,.02,0)
REVISION IN^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.47,.02,"DT")
3130723
"^DD",9002318.4,9002318.47,.03,0)
REVISION OUT^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.47,.03,"DT")
3130723
"^DD",9002318.4,9002318.48,0)
VUID SUB-FIELD^^.03^3
"^DD",9002318.4,9002318.48,0,"DT")
3130723
"^DD",9002318.4,9002318.48,0,"IX","B",9002318.48,.01)

"^DD",9002318.4,9002318.48,0,"NM","VUID")

"^DD",9002318.4,9002318.48,0,"UP")
9002318.4
"^DD",9002318.4,9002318.48,.01,0)
VUID^F^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.48,.01,1,0)
^.1
"^DD",9002318.4,9002318.48,.01,1,1,0)
9002318.48^B
"^DD",9002318.4,9002318.48,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.48,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),8,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.48,.01,1,2,0)
9002318.4^H^MUMPS
"^DD",9002318.4,9002318.48,.01,1,2,1)
D VUSX^BSTSUTIL
"^DD",9002318.4,9002318.48,.01,1,2,2)
D VUKX^BSTSUTIL
"^DD",9002318.4,9002318.48,.01,1,2,"DT")
3130724
"^DD",9002318.4,9002318.48,.01,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.48,.01,"DT")
3130724
"^DD",9002318.4,9002318.48,.02,0)
REVISION IN^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.48,.02,"DT")
3130723
"^DD",9002318.4,9002318.48,.03,0)
REVISION OUT^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.4,9002318.48,.03,"DT")
3130723
"^DD",9002318.4,9002318.49,0)
ASSOCIATIONS SUB-FIELD^^.03^3
"^DD",9002318.4,9002318.49,0,"DT")
3130725
"^DD",9002318.4,9002318.49,0,"IX","B",9002318.49,.01)

"^DD",9002318.4,9002318.49,0,"NM","ASSOCIATIONS")

"^DD",9002318.4,9002318.49,0,"UP")
9002318.4
"^DD",9002318.4,9002318.49,.01,0)
CODE^F^^0;1^K:$L(X)>100!($L(X)<1) X
"^DD",9002318.4,9002318.49,.01,1,0)
^.1
"^DD",9002318.4,9002318.49,.01,1,1,0)
9002318.49^B
"^DD",9002318.4,9002318.49,.01,1,1,1)
S ^BSTS(9002318.4,DA(1),9,"B",$E(X,1,30),DA)=""
"^DD",9002318.4,9002318.49,.01,1,1,2)
K ^BSTS(9002318.4,DA(1),9,"B",$E(X,1,30),DA)
"^DD",9002318.4,9002318.49,.01,3)
Answer must be 1-100 characters in length.
"^DD",9002318.4,9002318.49,.01,"DT")
3130725
"^DD",9002318.4,9002318.49,.02,0)
CODESET^F^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002318.4,9002318.49,.02,3)
Answer must be 1-10 characters in length.
"^DD",9002318.4,9002318.49,.02,"DT")
3130725
"^DD",9002318.4,9002318.49,.03,0)
CODE DTSID^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002318.4,9002318.49,.03,3)
Answer must be 1-20 characters in length.
"^DD",9002318.4,9002318.49,.03,"DT")
3130730
"^DD",9002318.5,9002318.5,0)
FIELD^^11^11
"^DD",9002318.5,9002318.5,0,"IX","B",9002318.5,.01)

"^DD",9002318.5,9002318.5,0,"NM","BSTS CACHE CLASS TRANSPORT")

"^DD",9002318.5,9002318.5,0,"VRPK")
IHS STANDARD TERMINOLOGY
"^DD",9002318.5,9002318.5,.01,0)
PACKAGE NAME^RF^^0;1^K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X
"^DD",9002318.5,9002318.5,.01,1,0)
^.1
"^DD",9002318.5,9002318.5,.01,1,1,0)
9002318.5^B
"^DD",9002318.5,9002318.5,.01,1,1,1)
S ^BSTSCLS("B",$E(X,1,30),DA)=""
"^DD",9002318.5,9002318.5,.01,1,1,2)
K ^BSTSCLS("B",$E(X,1,30),DA)
"^DD",9002318.5,9002318.5,.01,3)
Answer must be 3-60 characters in length.
"^DD",9002318.5,9002318.5,.01,"DT")
3100512
"^DD",9002318.5,9002318.5,.02,0)
*INSTALL WHERE^S^R:RPMS;E:ENSRPMS;B:BOTH;^0;2^Q
"^DD",9002318.5,9002318.5,.02,"DT")
3100820
"^DD",9002318.5,9002318.5,.04,0)
*PATH^F^^0;4^K:$L(X)>20!($L(X)<20) X
"^DD",9002318.5,9002318.5,.04,3)
Answer must be 20 characters in length.
"^DD",9002318.5,9002318.5,.04,"DT")
3100820
"^DD",9002318.5,9002318.5,1.01,0)
*RPMS FILENAME^F^^1;1^K:$L(X)>60!($L(X)<1) X
"^DD",9002318.5,9002318.5,1.01,3)
Answer must be 1-60 characters in length.
"^DD",9002318.5,9002318.5,1.01,"DT")
3100820
"^DD",9002318.5,9002318.5,1.02,0)
RPMS STATUS^S^R:READY;I:IN PROGRESS;C:COMPLETE;E:ERROR;^1;2^Q
"^DD",9002318.5,9002318.5,1.02,"DT")
3100512
"^DD",9002318.5,9002318.5,1.03,0)
RPMS DATE/TIME INSTALLED^D^^1;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.5,9002318.5,1.03,"DT")
3100111
"^DD",9002318.5,9002318.5,2.01,0)
*ENSEMBLE FILENAME^F^^2;1^K:$L(X)>60!($L(X)<1) X
"^DD",9002318.5,9002318.5,2.01,3)
Answer must be 1-60 characters in length.
"^DD",9002318.5,9002318.5,2.01,"DT")
3100820
"^DD",9002318.5,9002318.5,2.02,0)
*ENSEMBLE STATUS^S^R:READY;I:IN PROGRESS;C:COMPLETE;E:ERROR;^2;2^Q
"^DD",9002318.5,9002318.5,2.02,"DT")
3100820
"^DD",9002318.5,9002318.5,2.03,0)
*ENSEMBLE DATE/TIME INSTALLED^D^^2;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002318.5,9002318.5,2.03,"DT")
3100820
"^DD",9002318.5,9002318.5,10,0)
XML^9002318.51^^10;0
"^DD",9002318.5,9002318.5,11,0)
CLASS^9002318.511A^^11;0
"^DD",9002318.5,9002318.51,0)
XML SUB-FIELD^^.01^1
"^DD",9002318.5,9002318.51,0,"NM","XML")

"^DD",9002318.5,9002318.51,0,"UP")
9002318.5
"^DD",9002318.5,9002318.51,.01,0)
XML^W^^0;1^Q
"^DD",9002318.5,9002318.51,.01,"DT")
3091118
"^DD",9002318.5,9002318.511,0)
CLASS SUB-FIELD^^.01^1
"^DD",9002318.5,9002318.511,0,"IX","B",9002318.511,.01)

"^DD",9002318.5,9002318.511,0,"NM","CLASS")

"^DD",9002318.5,9002318.511,0,"UP")
9002318.5
"^DD",9002318.5,9002318.511,.01,0)
CLASS^RF^^0;1^K:$L(X)>120!($L(X)<2) X
"^DD",9002318.5,9002318.511,.01,1,0)
^.1
"^DD",9002318.5,9002318.511,.01,1,1,0)
9002318.511^B
"^DD",9002318.5,9002318.511,.01,1,1,1)
S ^BSTSCLS(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002318.5,9002318.511,.01,1,1,2)
K ^BSTSCLS(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002318.5,9002318.511,.01,3)
Enter Ensemble class name
"^DD",9002318.5,9002318.511,.01,"DT")
3100512
"^DIC",9002318,9002318,0)
BSTS SITE PARAMETERS^9002318
"^DIC",9002318,9002318,0,"GL")
^BSTS(9002318,
"^DIC",9002318,"B","BSTS SITE PARAMETERS",9002318)

"^DIC",9002318.1,9002318.1,0)
BSTS CODESET^9002318.1
"^DIC",9002318.1,9002318.1,0,"GL")
^BSTS(9002318.1,
"^DIC",9002318.1,"B","BSTS CODESET",9002318.1)

"^DIC",9002318.2,9002318.2,0)
BSTS WEB SERVICE ENDPOINT^9002318.2
"^DIC",9002318.2,9002318.2,0,"GL")
^BSTS(9002318.2,
"^DIC",9002318.2,"B","BSTS WEB SERVICE ENDPOINT",9002318.2)

"^DIC",9002318.3,9002318.3,0)
BSTS TERMINOLOGY^9002318.3
"^DIC",9002318.3,9002318.3,0,"GL")
^BSTS(9002318.3,
"^DIC",9002318.3,"B","BSTS TERMINOLOGY",9002318.3)

"^DIC",9002318.4,9002318.4,0)
BSTS CONCEPT^9002318.4
"^DIC",9002318.4,9002318.4,0,"GL")
^BSTS(9002318.4,
"^DIC",9002318.4,"B","BSTS CONCEPT",9002318.4)

"^DIC",9002318.5,9002318.5,0)
BSTS CACHE CLASS TRANSPORT^9002318.5
"^DIC",9002318.5,9002318.5,0,"GL")
^BSTSCLS(
"^DIC",9002318.5,"B","BSTS CACHE CLASS TRANSPORT",9002318.5)

**END**
**END**
