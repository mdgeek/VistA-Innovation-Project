KIDS Distribution saved on Jul 17, 2015@22:46:42
 T2
**KIDS**:BIV 10.0^

**INSTALL NAME**
BIV 10.0
"BLD",9868,0)
BIV 10.0^IMMUNIZATIONS VISTA PORT^0^3150717^y
"BLD",9868,4,0)
^9.64PA^9002084.02^13
"BLD",9868,4,9002084,0)
9002084
"BLD",9868,4,9002084,222)
y^y^f^^^^n
"BLD",9868,4,9002084.01,0)
9002084.01
"BLD",9868,4,9002084.01,222)
y^y^f^^^^n
"BLD",9868,4,9002084.02,0)
9002084.02
"BLD",9868,4,9002084.02,222)
y^y^f^^^^n
"BLD",9868,4,9002084.1,0)
9002084.1
"BLD",9868,4,9002084.1,222)
y^y^f^^^^n
"BLD",9868,4,9002084.11,0)
9002084.11
"BLD",9868,4,9002084.11,222)
y^y^f^^^^n
"BLD",9868,4,9002084.115,0)
9002084.115
"BLD",9868,4,9002084.115,222)
y^y^f^^^^n
"BLD",9868,4,9002084.12,0)
9002084.12
"BLD",9868,4,9002084.12,222)
y^y^f^^^^n
"BLD",9868,4,9002084.33,0)
9002084.33
"BLD",9868,4,9002084.33,222)
y^y^f^^n^^y^o^n
"BLD",9868,4,9002084.4,0)
9002084.4
"BLD",9868,4,9002084.4,222)
y^y^f^^^^n
"BLD",9868,4,9002084.45,0)
9002084.45
"BLD",9868,4,9002084.45,222)
y^y^f^^n^^y^o^n
"BLD",9868,4,9002084.81,0)
9002084.81
"BLD",9868,4,9002084.81,222)
y^y^f^^n^^y^o^n
"BLD",9868,4,9002084.91,0)
9002084.91
"BLD",9868,4,9002084.91,222)
y^y^f^^n^^y^o^n
"BLD",9868,4,9002084.93,0)
9002084.93
"BLD",9868,4,9002084.93,222)
y^y^f^^n^^y^o^n
"BLD",9868,4,"B",9002084,9002084)

"BLD",9868,4,"B",9002084.01,9002084.01)

"BLD",9868,4,"B",9002084.02,9002084.02)

"BLD",9868,4,"B",9002084.1,9002084.1)

"BLD",9868,4,"B",9002084.11,9002084.11)

"BLD",9868,4,"B",9002084.115,9002084.115)

"BLD",9868,4,"B",9002084.12,9002084.12)

"BLD",9868,4,"B",9002084.33,9002084.33)

"BLD",9868,4,"B",9002084.4,9002084.4)

"BLD",9868,4,"B",9002084.45,9002084.45)

"BLD",9868,4,"B",9002084.81,9002084.81)

"BLD",9868,4,"B",9002084.91,9002084.91)

"BLD",9868,4,"B",9002084.93,9002084.93)

"BLD",9868,6.3)
2
"BLD",9868,"INIT")
POSTVIST^PXVBIVD
"BLD",9868,"KRN",0)
^9.67PA^779.2^20
"BLD",9868,"KRN",.4,0)
.4
"BLD",9868,"KRN",.401,0)
.401
"BLD",9868,"KRN",.402,0)
.402
"BLD",9868,"KRN",.403,0)
.403
"BLD",9868,"KRN",.403,"NM",0)
^9.68A^5^5
"BLD",9868,"KRN",.403,"NM",1,0)
BI FORM-LOT NUMBER EDIT    FILE #9999999.41^9999999.41^0
"BLD",9868,"KRN",.403,"NM",2,0)
BI FORM-IMM VISIT ADD/EDIT    FILE #9000001^9000001^0
"BLD",9868,"KRN",.403,"NM",3,0)
BI FORM-CONTRAIND ADD/EDIT    FILE #9000001^9000001^0
"BLD",9868,"KRN",.403,"NM",4,0)
BI FORM-CASE DATA EDIT    FILE #9002084^9002084^0
"BLD",9868,"KRN",.403,"NM",5,0)
BI FORM-SKIN VISIT ADD/EDIT    FILE #9000001^9000001^0
"BLD",9868,"KRN",.403,"NM","B","BI FORM-CASE DATA EDIT    FILE #9002084",4)

"BLD",9868,"KRN",.403,"NM","B","BI FORM-CONTRAIND ADD/EDIT    FILE #9000001",3)

"BLD",9868,"KRN",.403,"NM","B","BI FORM-IMM VISIT ADD/EDIT    FILE #9000001",2)

"BLD",9868,"KRN",.403,"NM","B","BI FORM-LOT NUMBER EDIT    FILE #9999999.41",1)

"BLD",9868,"KRN",.403,"NM","B","BI FORM-SKIN VISIT ADD/EDIT    FILE #9000001",5)

"BLD",9868,"KRN",.5,0)
.5
"BLD",9868,"KRN",.5,"NM",0)
^9.68A^18^18
"BLD",9868,"KRN",.5,"NM",1,0)
BI CASE MANAGER^^0
"BLD",9868,"KRN",.5,"NM",2,0)
BI CHART NUMBER^^0
"BLD",9868,"KRN",.5,"NM",3,0)
BI DATE OF BIRTH^^0
"BLD",9868,"KRN",.5,"NM",4,0)
BI HE/SHE^^0
"BLD",9868,"KRN",.5,"NM",5,0)
BI HIM/HER^^0
"BLD",9868,"KRN",.5,"NM",6,0)
BI HIS/HER^^0
"BLD",9868,"KRN",.5,"NM",7,0)
BI MAILING ADD-CITY^^0
"BLD",9868,"KRN",.5,"NM",8,0)
BI MAILING ADD-CITY STATE ZIP^^0
"BLD",9868,"KRN",.5,"NM",9,0)
BI MAILING ADD-STATE^^0
"BLD",9868,"KRN",.5,"NM",10,0)
BI MAILING ADD-STREET^^0
"BLD",9868,"KRN",.5,"NM",11,0)
BI MAILING ADD-STREET-2^^0
"BLD",9868,"KRN",.5,"NM",12,0)
BI MAILING ADD-ZIP^^0
"BLD",9868,"KRN",.5,"NM",13,0)
BI NAME FIRST^^0
"BLD",9868,"KRN",.5,"NM",14,0)
BI NAME FIRST LAST^^0
"BLD",9868,"KRN",.5,"NM",15,0)
BI NEXT APPOINTMENT^^0
"BLD",9868,"KRN",.5,"NM",16,0)
BI NOW^^0
"BLD",9868,"KRN",.5,"NM",17,0)
BI PARENT/GUARDIAN^^0
"BLD",9868,"KRN",.5,"NM",18,0)
BI TODAY^^0
"BLD",9868,"KRN",.5,"NM","B","BI CASE MANAGER",1)

"BLD",9868,"KRN",.5,"NM","B","BI CHART NUMBER",2)

"BLD",9868,"KRN",.5,"NM","B","BI DATE OF BIRTH",3)

"BLD",9868,"KRN",.5,"NM","B","BI HE/SHE",4)

"BLD",9868,"KRN",.5,"NM","B","BI HIM/HER",5)

"BLD",9868,"KRN",.5,"NM","B","BI HIS/HER",6)

"BLD",9868,"KRN",.5,"NM","B","BI MAILING ADD-CITY",7)

"BLD",9868,"KRN",.5,"NM","B","BI MAILING ADD-CITY STATE ZIP",8)

"BLD",9868,"KRN",.5,"NM","B","BI MAILING ADD-STATE",9)

"BLD",9868,"KRN",.5,"NM","B","BI MAILING ADD-STREET",10)

"BLD",9868,"KRN",.5,"NM","B","BI MAILING ADD-STREET-2",11)

"BLD",9868,"KRN",.5,"NM","B","BI MAILING ADD-ZIP",12)

"BLD",9868,"KRN",.5,"NM","B","BI NAME FIRST",13)

"BLD",9868,"KRN",.5,"NM","B","BI NAME FIRST LAST",14)

"BLD",9868,"KRN",.5,"NM","B","BI NEXT APPOINTMENT",15)

"BLD",9868,"KRN",.5,"NM","B","BI NOW",16)

"BLD",9868,"KRN",.5,"NM","B","BI PARENT/GUARDIAN",17)

"BLD",9868,"KRN",.5,"NM","B","BI TODAY",18)

"BLD",9868,"KRN",.84,0)
.84
"BLD",9868,"KRN",.84,"NM",0)
^9.68A^1^1
"BLD",9868,"KRN",.84,"NM",1,0)
9200001^^0
"BLD",9868,"KRN",.84,"NM","B",9200001,1)

"BLD",9868,"KRN",3.6,0)
3.6
"BLD",9868,"KRN",3.8,0)
3.8
"BLD",9868,"KRN",9.2,0)
9.2
"BLD",9868,"KRN",9.8,0)
9.8
"BLD",9868,"KRN",9.8,"NM",0)
^9.68A^181^174
"BLD",9868,"KRN",9.8,"NM",1,0)
BISITE^^0^B10999594
"BLD",9868,"KRN",9.8,"NM",2,0)
BISITE1^^0^B47092305
"BLD",9868,"KRN",9.8,"NM",3,0)
BISITE2^^0^B171005337
"BLD",9868,"KRN",9.8,"NM",4,0)
BISITE3^^0^B165989063
"BLD",9868,"KRN",9.8,"NM",5,0)
BISITE4^^0^B148107237
"BLD",9868,"KRN",9.8,"NM",6,0)
BIAGE^^0^B34295641
"BLD",9868,"KRN",9.8,"NM",7,0)
BIAPCHS^^0^B49631446
"BLD",9868,"KRN",9.8,"NM",8,0)
BICMGR^^0^B18546662
"BLD",9868,"KRN",9.8,"NM",9,0)
BIDE^^0^B38132337
"BLD",9868,"KRN",9.8,"NM",10,0)
BIDTAB^^0^B6439410
"BLD",9868,"KRN",9.8,"NM",11,0)
BIDU^^0^B55349718
"BLD",9868,"KRN",9.8,"NM",12,0)
BIDU1^^0^B30688933
"BLD",9868,"KRN",9.8,"NM",13,0)
BIDUPLT^^0^B15075912
"BLD",9868,"KRN",9.8,"NM",14,0)
BIDUPLT1^^0^B4111973
"BLD",9868,"KRN",9.8,"NM",15,0)
BIDUR^^0^B59351036
"BLD",9868,"KRN",9.8,"NM",16,0)
BIDUR1^^0^B8838436
"BLD",9868,"KRN",9.8,"NM",17,0)
BIDUVLS^^0^B27583633
"BLD",9868,"KRN",9.8,"NM",18,0)
BIDUVLS1^^0^B53524822
"BLD",9868,"KRN",9.8,"NM",19,0)
BIDUVLS2^^0^B34545667
"BLD",9868,"KRN",9.8,"NM",20,0)
BIDX^^0^B28657332
"BLD",9868,"KRN",9.8,"NM",21,0)
BIELIG^^0^B36958339
"BLD",9868,"KRN",9.8,"NM",22,0)
BIELIG1^^0^B22465800
"BLD",9868,"KRN",9.8,"NM",23,0)
BIELIG3^^0^B29251780
"BLD",9868,"KRN",9.8,"NM",24,0)
BIENVCHK^^0^B18321502
"BLD",9868,"KRN",9.8,"NM",25,0)
BIETAB^^0^B5318670
"BLD",9868,"KRN",9.8,"NM",26,0)
BIEXP^^0^B26966562
"BLD",9868,"KRN",9.8,"NM",27,0)
BIEXP1^^0^B41307343
"BLD",9868,"KRN",9.8,"NM",28,0)
BIEXP2^^0^B51914490
"BLD",9868,"KRN",9.8,"NM",29,0)
BIEXP3^^0^B10292097
"BLD",9868,"KRN",9.8,"NM",30,0)
BIEXPRT2^^0^B18826693
"BLD",9868,"KRN",9.8,"NM",31,0)
BIEXPRT3^^0^B81602127
"BLD",9868,"KRN",9.8,"NM",32,0)
BIEXPRT4^^0^B18669815
"BLD",9868,"KRN",9.8,"NM",33,0)
BIEXPRT5^^0^B115588358
"BLD",9868,"KRN",9.8,"NM",34,0)
BIEXPRT6^^0^B73221766
"BLD",9868,"KRN",9.8,"NM",35,0)
BIEXPRT8^^0^B3833545
"BLD",9868,"KRN",9.8,"NM",36,0)
BIFMAN^^0^B40044488
"BLD",9868,"KRN",9.8,"NM",37,0)
BIHELP^^0^B6184348
"BLD",9868,"KRN",9.8,"NM",38,0)
BIHS^^0^B8292268
"BLD",9868,"KRN",9.8,"NM",39,0)
BIKEY^^0^B18843758
"BLD",9868,"KRN",9.8,"NM",40,0)
BIKEY1^^0^B39893921
"BLD",9868,"KRN",9.8,"NM",41,0)
BIKEY2^^0^B4203955
"BLD",9868,"KRN",9.8,"NM",42,0)
BILETPR^^0^B37830369
"BLD",9868,"KRN",9.8,"NM",43,0)
BILETPR1^^0^B118603047
"BLD",9868,"KRN",9.8,"NM",44,0)
BILETPR2^^0^B5971720
"BLD",9868,"KRN",9.8,"NM",45,0)
BILETPR3^^0^B22264364
"BLD",9868,"KRN",9.8,"NM",46,0)
BILETPR4^^0^B8005164
"BLD",9868,"KRN",9.8,"NM",47,0)
BILETVW^^0^B29025411
"BLD",9868,"KRN",9.8,"NM",48,0)
BILETVW1^^0^B37659707
"BLD",9868,"KRN",9.8,"NM",49,0)
BILETVW2^^0^B101256737
"BLD",9868,"KRN",9.8,"NM",50,0)
BILOGO^^0^B23635240
"BLD",9868,"KRN",9.8,"NM",51,0)
BILOT^^0^B159288316
"BLD",9868,"KRN",9.8,"NM",52,0)
BILOT1^^0^B159461320
"BLD",9868,"KRN",9.8,"NM",53,0)
BILOT2^^0^B10609281
"BLD",9868,"KRN",9.8,"NM",54,0)
BIMFI^^0^B8271751
"BLD",9868,"KRN",9.8,"NM",55,0)
BINDC^^0^B48072258
"BLD",9868,"KRN",9.8,"NM",56,0)
BINDC1^^0^B110347257
"BLD",9868,"KRN",9.8,"NM",57,0)
BINDC2^^0^B5010819
"BLD",9868,"KRN",9.8,"NM",58,0)
BINFO^^0^B3651355
"BLD",9868,"KRN",9.8,"NM",59,0)
BINTEG^^0^B4929716
"BLD",9868,"KRN",9.8,"NM",60,0)
BIO^^0^B281375
"BLD",9868,"KRN",9.8,"NM",61,0)
BIOUTPT^^0^B171725916
"BLD",9868,"KRN",9.8,"NM",62,0)
BIOUTPT1^^0^B131538211
"BLD",9868,"KRN",9.8,"NM",63,0)
BIOUTPT2^^0^B95782122
"BLD",9868,"KRN",9.8,"NM",64,0)
BIOUTPT3^^0^B200232267
"BLD",9868,"KRN",9.8,"NM",65,0)
BIOUTPT4^^0^B152498081
"BLD",9868,"KRN",9.8,"NM",66,0)
BIOUTPT5^^0^B132245267
"BLD",9868,"KRN",9.8,"NM",67,0)
BIPATCO^^0^B27934606
"BLD",9868,"KRN",9.8,"NM",68,0)
BIPATCO1^^0^B4160688
"BLD",9868,"KRN",9.8,"NM",69,0)
BIPATCO2^^0^B21497710
"BLD",9868,"KRN",9.8,"NM",70,0)
BIPATE^^0^B22259160
"BLD",9868,"KRN",9.8,"NM",71,0)
BIPATER^^0^B46255846
"BLD",9868,"KRN",9.8,"NM",72,0)
BIPATER1^^0^B19834029
"BLD",9868,"KRN",9.8,"NM",73,0)
BIPATPF^^0^B14288700
"BLD",9868,"KRN",9.8,"NM",74,0)
BIPATUP^^0^B24996927
"BLD",9868,"KRN",9.8,"NM",75,0)
BIPATUP1^^0^B51318324
"BLD",9868,"KRN",9.8,"NM",76,0)
BIPATUP2^^0^B13957327
"BLD",9868,"KRN",9.8,"NM",77,0)
BIPATUP3^^0^B7260631
"BLD",9868,"KRN",9.8,"NM",78,0)
BIPATVW^^0^B50308275
"BLD",9868,"KRN",9.8,"NM",79,0)
BIPATVW1^^0^B83032319
"BLD",9868,"KRN",9.8,"NM",80,0)
BIPATVW2^^0^B78493065
"BLD",9868,"KRN",9.8,"NM",81,0)
BIPATVW3^^0^B110644272
"BLD",9868,"KRN",9.8,"NM",82,0)
BIPCC^^0^B2520097
"BLD",9868,"KRN",9.8,"NM",83,0)
BIPOST^^0^B33788184
"BLD",9868,"KRN",9.8,"NM",84,0)
BIPRE^^0^B33992941
"BLD",9868,"KRN",9.8,"NM",85,0)
BIREP^^0^B30342488
"BLD",9868,"KRN",9.8,"NM",86,0)
BIREPA^^0^B58558255
"BLD",9868,"KRN",9.8,"NM",87,0)
BIREPA1^^0^B11908055
"BLD",9868,"KRN",9.8,"NM",88,0)
BIREPA2^^0^B44086803
"BLD",9868,"KRN",9.8,"NM",89,0)
BIREPA3^^0^B17152680
"BLD",9868,"KRN",9.8,"NM",90,0)
BIREPD^^0^B71142514
"BLD",9868,"KRN",9.8,"NM",91,0)
BIREPD1^^0^B25499917
"BLD",9868,"KRN",9.8,"NM",92,0)
BIREPD2^^0^B70038827
"BLD",9868,"KRN",9.8,"NM",93,0)
BIREPD3^^0^B49293986
"BLD",9868,"KRN",9.8,"NM",94,0)
BIREPD4^^0^B87489235
"BLD",9868,"KRN",9.8,"NM",95,0)
BIREPE^^0^B83343944
"BLD",9868,"KRN",9.8,"NM",96,0)
BIREPE1^^0^B12952198
"BLD",9868,"KRN",9.8,"NM",97,0)
BIREPE2^^0^B59055814
"BLD",9868,"KRN",9.8,"NM",98,0)
BIREPE3^^0^B19789610
"BLD",9868,"KRN",9.8,"NM",99,0)
BIREPF^^0^B112816417
"BLD",9868,"KRN",9.8,"NM",100,0)
BIREPF1^^0^B24668650
"BLD",9868,"KRN",9.8,"NM",101,0)
BIREPF2^^0^B30028410
"BLD",9868,"KRN",9.8,"NM",102,0)
BIREPF3^^0^B29304058
"BLD",9868,"KRN",9.8,"NM",103,0)
BIREPF4^^0^B45795532
"BLD",9868,"KRN",9.8,"NM",104,0)
BIREPH^^0^B56034336
"BLD",9868,"KRN",9.8,"NM",105,0)
BIREPH1^^0^B11788116
"BLD",9868,"KRN",9.8,"NM",106,0)
BIREPH2^^0^B40998713
"BLD",9868,"KRN",9.8,"NM",107,0)
BIREPH3^^0^B18678958
"BLD",9868,"KRN",9.8,"NM",108,0)
BIREPL^^0^B71650642
"BLD",9868,"KRN",9.8,"NM",109,0)
BIREPL1^^0^B22816799
"BLD",9868,"KRN",9.8,"NM",110,0)
BIREPL2^^0^B55205516
"BLD",9868,"KRN",9.8,"NM",111,0)
BIREPL3^^0^B64725722
"BLD",9868,"KRN",9.8,"NM",112,0)
BIREPP^^0^B39936093
"BLD",9868,"KRN",9.8,"NM",113,0)
BIREPP1^^0^B12140642
"BLD",9868,"KRN",9.8,"NM",114,0)
BIREPP2^^0^B39815467
"BLD",9868,"KRN",9.8,"NM",115,0)
BIREPP3^^0^B27571704
"BLD",9868,"KRN",9.8,"NM",116,0)
BIREPQ^^0^B93020585
"BLD",9868,"KRN",9.8,"NM",117,0)
BIREPQ1^^0^B23955170
"BLD",9868,"KRN",9.8,"NM",118,0)
BIREPQ2^^0^B20362887
"BLD",9868,"KRN",9.8,"NM",119,0)
BIREPQ3^^0^B22953670
"BLD",9868,"KRN",9.8,"NM",120,0)
BIREPQ4^^0^B70007941
"BLD",9868,"KRN",9.8,"NM",121,0)
BIREPQ5^^0^B15940253
"BLD",9868,"KRN",9.8,"NM",122,0)
BIREPT^^0^B80988307
"BLD",9868,"KRN",9.8,"NM",123,0)
BIREPT1^^0^B22145420
"BLD",9868,"KRN",9.8,"NM",124,0)
BIREPT2^^0^B36921120
"BLD",9868,"KRN",9.8,"NM",125,0)
BIREPT3^^0^B22745337
"BLD",9868,"KRN",9.8,"NM",126,0)
BIREPT4^^0^B108702724
"BLD",9868,"KRN",9.8,"NM",127,0)
BIREPVP^^0^B29949628
"BLD",9868,"KRN",9.8,"NM",128,0)
BIRESTD^^0^B19219313
"BLD",9868,"KRN",9.8,"NM",129,0)
BIRPC^^0^B39859102
"BLD",9868,"KRN",9.8,"NM",130,0)
BIRPC1^^0^B6937183
"BLD",9868,"KRN",9.8,"NM",131,0)
BIRPC2^^0^B10052475
"BLD",9868,"KRN",9.8,"NM",132,0)
BIRPC3^^0^B46738139
"BLD",9868,"KRN",9.8,"NM",133,0)
BIRPC4^^0^B78239729
"BLD",9868,"KRN",9.8,"NM",134,0)
BIRPC5^^0^B20034069
"BLD",9868,"KRN",9.8,"NM",135,0)
BIRPC6^^0^B5724193
"BLD",9868,"KRN",9.8,"NM",136,0)
BISCAN^^0^B42175673
"BLD",9868,"KRN",9.8,"NM",137,0)
BISELEC1^^0^B74913736
"BLD",9868,"KRN",9.8,"NM",138,0)
BISELEC2^^0^B18939256
"BLD",9868,"KRN",9.8,"NM",139,0)
BISELECT^^0^B36757927
"BLD",9868,"KRN",9.8,"NM",140,0)
BITEST^^0^B2092544
"BLD",9868,"KRN",9.8,"NM",141,0)
BITN^^0^B169851237
"BLD",9868,"KRN",9.8,"NM",142,0)
BITN2^^0^B108426735
"BLD",9868,"KRN",9.8,"NM",143,0)
BITRS^^0^B3764707
"BLD",9868,"KRN",9.8,"NM",144,0)
BITX^^0^B368637
"BLD",9868,"KRN",9.8,"NM",145,0)
BITXA^^0^B15236777
"BLD",9868,"KRN",9.8,"NM",146,0)
BITXB^^0^B14336456
"BLD",9868,"KRN",9.8,"NM",147,0)
BITXC^^0^B16462944
"BLD",9868,"KRN",9.8,"NM",148,0)
BITXD^^0^B10181675
"BLD",9868,"KRN",9.8,"NM",149,0)
BIUTL1^^0^B88339060
"BLD",9868,"KRN",9.8,"NM",150,0)
BIUTL11^^0^B120337184
"BLD",9868,"KRN",9.8,"NM",151,0)
BIUTL2^^0^B77876709
"BLD",9868,"KRN",9.8,"NM",152,0)
BIUTL3^^0^B21545278
"BLD",9868,"KRN",9.8,"NM",153,0)
BIUTL4^^0^B143400322
"BLD",9868,"KRN",9.8,"NM",154,0)
BIUTL5^^0^B31996793
"BLD",9868,"KRN",9.8,"NM",155,0)
BIUTL6^^0^B178534121
"BLD",9868,"KRN",9.8,"NM",156,0)
BIUTL7^^0^B135015819
"BLD",9868,"KRN",9.8,"NM",157,0)
BIUTL8^^0^B65044050
"BLD",9868,"KRN",9.8,"NM",158,0)
BIUTL9^^0^B2779619
"BLD",9868,"KRN",9.8,"NM",159,0)
BIUTLFIX^^0^B72577217
"BLD",9868,"KRN",9.8,"NM",160,0)
BIVACED^^0^B46685781
"BLD",9868,"KRN",9.8,"NM",161,0)
BIVACED1^^0^B22682484
"BLD",9868,"KRN",9.8,"NM",162,0)
BIVGRP^^0^B14770178
"BLD",9868,"KRN",9.8,"NM",163,0)
BIVGRP1^^0^B11417238
"BLD",9868,"KRN",9.8,"NM",164,0)
BIVISIT^^0^B112358141
"BLD",9868,"KRN",9.8,"NM",165,0)
BIVISIT1^^0^B43286157
"BLD",9868,"KRN",9.8,"NM",166,0)
BIVISIT2^^0^B25663423
"BLD",9868,"KRN",9.8,"NM",167,0)
BIVT100^^0^B11189202
"BLD",9868,"KRN",9.8,"NM",168,0)
BIVTAB^^0^B20875514
"BLD",9868,"KRN",9.8,"NM",169,0)
BIW^^0^B4799995
"BLD",9868,"KRN",9.8,"NM",170,0)
BIXCALL^^0^B46799525
"BLD",9868,"KRN",9.8,"NM",171,0)
BIXRPC^^0^B13726940
"BLD",9868,"KRN",9.8,"NM",172,0)
BIXTCH^^0^B22213527
"BLD",9868,"KRN",9.8,"NM",180,0)
PXVVISIT^^0^B55427535
"BLD",9868,"KRN",9.8,"NM",181,0)
PXVBIVD^^0^B2463834
"BLD",9868,"KRN",9.8,"NM","B","BIAGE",6)

"BLD",9868,"KRN",9.8,"NM","B","BIAPCHS",7)

"BLD",9868,"KRN",9.8,"NM","B","BICMGR",8)

"BLD",9868,"KRN",9.8,"NM","B","BIDE",9)

"BLD",9868,"KRN",9.8,"NM","B","BIDTAB",10)

"BLD",9868,"KRN",9.8,"NM","B","BIDU",11)

"BLD",9868,"KRN",9.8,"NM","B","BIDU1",12)

"BLD",9868,"KRN",9.8,"NM","B","BIDUPLT",13)

"BLD",9868,"KRN",9.8,"NM","B","BIDUPLT1",14)

"BLD",9868,"KRN",9.8,"NM","B","BIDUR",15)

"BLD",9868,"KRN",9.8,"NM","B","BIDUR1",16)

"BLD",9868,"KRN",9.8,"NM","B","BIDUVLS",17)

"BLD",9868,"KRN",9.8,"NM","B","BIDUVLS1",18)

"BLD",9868,"KRN",9.8,"NM","B","BIDUVLS2",19)

"BLD",9868,"KRN",9.8,"NM","B","BIDX",20)

"BLD",9868,"KRN",9.8,"NM","B","BIELIG",21)

"BLD",9868,"KRN",9.8,"NM","B","BIELIG1",22)

"BLD",9868,"KRN",9.8,"NM","B","BIELIG3",23)

"BLD",9868,"KRN",9.8,"NM","B","BIENVCHK",24)

"BLD",9868,"KRN",9.8,"NM","B","BIETAB",25)

"BLD",9868,"KRN",9.8,"NM","B","BIEXP",26)

"BLD",9868,"KRN",9.8,"NM","B","BIEXP1",27)

"BLD",9868,"KRN",9.8,"NM","B","BIEXP2",28)

"BLD",9868,"KRN",9.8,"NM","B","BIEXP3",29)

"BLD",9868,"KRN",9.8,"NM","B","BIEXPRT2",30)

"BLD",9868,"KRN",9.8,"NM","B","BIEXPRT3",31)

"BLD",9868,"KRN",9.8,"NM","B","BIEXPRT4",32)

"BLD",9868,"KRN",9.8,"NM","B","BIEXPRT5",33)

"BLD",9868,"KRN",9.8,"NM","B","BIEXPRT6",34)

"BLD",9868,"KRN",9.8,"NM","B","BIEXPRT8",35)

"BLD",9868,"KRN",9.8,"NM","B","BIFMAN",36)

"BLD",9868,"KRN",9.8,"NM","B","BIHELP",37)

"BLD",9868,"KRN",9.8,"NM","B","BIHS",38)

"BLD",9868,"KRN",9.8,"NM","B","BIKEY",39)

"BLD",9868,"KRN",9.8,"NM","B","BIKEY1",40)

"BLD",9868,"KRN",9.8,"NM","B","BIKEY2",41)

"BLD",9868,"KRN",9.8,"NM","B","BILETPR",42)

"BLD",9868,"KRN",9.8,"NM","B","BILETPR1",43)

"BLD",9868,"KRN",9.8,"NM","B","BILETPR2",44)

"BLD",9868,"KRN",9.8,"NM","B","BILETPR3",45)

"BLD",9868,"KRN",9.8,"NM","B","BILETPR4",46)

"BLD",9868,"KRN",9.8,"NM","B","BILETVW",47)

"BLD",9868,"KRN",9.8,"NM","B","BILETVW1",48)

"BLD",9868,"KRN",9.8,"NM","B","BILETVW2",49)

"BLD",9868,"KRN",9.8,"NM","B","BILOGO",50)

"BLD",9868,"KRN",9.8,"NM","B","BILOT",51)

"BLD",9868,"KRN",9.8,"NM","B","BILOT1",52)

"BLD",9868,"KRN",9.8,"NM","B","BILOT2",53)

"BLD",9868,"KRN",9.8,"NM","B","BIMFI",54)

"BLD",9868,"KRN",9.8,"NM","B","BINDC",55)

"BLD",9868,"KRN",9.8,"NM","B","BINDC1",56)

"BLD",9868,"KRN",9.8,"NM","B","BINDC2",57)

"BLD",9868,"KRN",9.8,"NM","B","BINFO",58)

"BLD",9868,"KRN",9.8,"NM","B","BINTEG",59)

"BLD",9868,"KRN",9.8,"NM","B","BIO",60)

"BLD",9868,"KRN",9.8,"NM","B","BIOUTPT",61)

"BLD",9868,"KRN",9.8,"NM","B","BIOUTPT1",62)

"BLD",9868,"KRN",9.8,"NM","B","BIOUTPT2",63)

"BLD",9868,"KRN",9.8,"NM","B","BIOUTPT3",64)

"BLD",9868,"KRN",9.8,"NM","B","BIOUTPT4",65)

"BLD",9868,"KRN",9.8,"NM","B","BIOUTPT5",66)

"BLD",9868,"KRN",9.8,"NM","B","BIPATCO",67)

"BLD",9868,"KRN",9.8,"NM","B","BIPATCO1",68)

"BLD",9868,"KRN",9.8,"NM","B","BIPATCO2",69)

"BLD",9868,"KRN",9.8,"NM","B","BIPATE",70)

"BLD",9868,"KRN",9.8,"NM","B","BIPATER",71)

"BLD",9868,"KRN",9.8,"NM","B","BIPATER1",72)

"BLD",9868,"KRN",9.8,"NM","B","BIPATPF",73)

"BLD",9868,"KRN",9.8,"NM","B","BIPATUP",74)

"BLD",9868,"KRN",9.8,"NM","B","BIPATUP1",75)

"BLD",9868,"KRN",9.8,"NM","B","BIPATUP2",76)

"BLD",9868,"KRN",9.8,"NM","B","BIPATUP3",77)

"BLD",9868,"KRN",9.8,"NM","B","BIPATVW",78)

"BLD",9868,"KRN",9.8,"NM","B","BIPATVW1",79)

"BLD",9868,"KRN",9.8,"NM","B","BIPATVW2",80)

"BLD",9868,"KRN",9.8,"NM","B","BIPATVW3",81)

"BLD",9868,"KRN",9.8,"NM","B","BIPCC",82)

"BLD",9868,"KRN",9.8,"NM","B","BIPOST",83)

"BLD",9868,"KRN",9.8,"NM","B","BIPRE",84)

"BLD",9868,"KRN",9.8,"NM","B","BIREP",85)

"BLD",9868,"KRN",9.8,"NM","B","BIREPA",86)

"BLD",9868,"KRN",9.8,"NM","B","BIREPA1",87)

"BLD",9868,"KRN",9.8,"NM","B","BIREPA2",88)

"BLD",9868,"KRN",9.8,"NM","B","BIREPA3",89)

"BLD",9868,"KRN",9.8,"NM","B","BIREPD",90)

"BLD",9868,"KRN",9.8,"NM","B","BIREPD1",91)

"BLD",9868,"KRN",9.8,"NM","B","BIREPD2",92)

"BLD",9868,"KRN",9.8,"NM","B","BIREPD3",93)

"BLD",9868,"KRN",9.8,"NM","B","BIREPD4",94)

"BLD",9868,"KRN",9.8,"NM","B","BIREPE",95)

"BLD",9868,"KRN",9.8,"NM","B","BIREPE1",96)

"BLD",9868,"KRN",9.8,"NM","B","BIREPE2",97)

"BLD",9868,"KRN",9.8,"NM","B","BIREPE3",98)

"BLD",9868,"KRN",9.8,"NM","B","BIREPF",99)

"BLD",9868,"KRN",9.8,"NM","B","BIREPF1",100)

"BLD",9868,"KRN",9.8,"NM","B","BIREPF2",101)

"BLD",9868,"KRN",9.8,"NM","B","BIREPF3",102)

"BLD",9868,"KRN",9.8,"NM","B","BIREPF4",103)

"BLD",9868,"KRN",9.8,"NM","B","BIREPH",104)

"BLD",9868,"KRN",9.8,"NM","B","BIREPH1",105)

"BLD",9868,"KRN",9.8,"NM","B","BIREPH2",106)

"BLD",9868,"KRN",9.8,"NM","B","BIREPH3",107)

"BLD",9868,"KRN",9.8,"NM","B","BIREPL",108)

"BLD",9868,"KRN",9.8,"NM","B","BIREPL1",109)

"BLD",9868,"KRN",9.8,"NM","B","BIREPL2",110)

"BLD",9868,"KRN",9.8,"NM","B","BIREPL3",111)

"BLD",9868,"KRN",9.8,"NM","B","BIREPP",112)

"BLD",9868,"KRN",9.8,"NM","B","BIREPP1",113)

"BLD",9868,"KRN",9.8,"NM","B","BIREPP2",114)

"BLD",9868,"KRN",9.8,"NM","B","BIREPP3",115)

"BLD",9868,"KRN",9.8,"NM","B","BIREPQ",116)

"BLD",9868,"KRN",9.8,"NM","B","BIREPQ1",117)

"BLD",9868,"KRN",9.8,"NM","B","BIREPQ2",118)

"BLD",9868,"KRN",9.8,"NM","B","BIREPQ3",119)

"BLD",9868,"KRN",9.8,"NM","B","BIREPQ4",120)

"BLD",9868,"KRN",9.8,"NM","B","BIREPQ5",121)

"BLD",9868,"KRN",9.8,"NM","B","BIREPT",122)

"BLD",9868,"KRN",9.8,"NM","B","BIREPT1",123)

"BLD",9868,"KRN",9.8,"NM","B","BIREPT2",124)

"BLD",9868,"KRN",9.8,"NM","B","BIREPT3",125)

"BLD",9868,"KRN",9.8,"NM","B","BIREPT4",126)

"BLD",9868,"KRN",9.8,"NM","B","BIREPVP",127)

"BLD",9868,"KRN",9.8,"NM","B","BIRESTD",128)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC",129)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC1",130)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC2",131)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC3",132)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC4",133)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC5",134)

"BLD",9868,"KRN",9.8,"NM","B","BIRPC6",135)

"BLD",9868,"KRN",9.8,"NM","B","BISCAN",136)

"BLD",9868,"KRN",9.8,"NM","B","BISELEC1",137)

"BLD",9868,"KRN",9.8,"NM","B","BISELEC2",138)

"BLD",9868,"KRN",9.8,"NM","B","BISELECT",139)

"BLD",9868,"KRN",9.8,"NM","B","BISITE",1)

"BLD",9868,"KRN",9.8,"NM","B","BISITE1",2)

"BLD",9868,"KRN",9.8,"NM","B","BISITE2",3)

"BLD",9868,"KRN",9.8,"NM","B","BISITE3",4)

"BLD",9868,"KRN",9.8,"NM","B","BISITE4",5)

"BLD",9868,"KRN",9.8,"NM","B","BITEST",140)

"BLD",9868,"KRN",9.8,"NM","B","BITN",141)

"BLD",9868,"KRN",9.8,"NM","B","BITN2",142)

"BLD",9868,"KRN",9.8,"NM","B","BITRS",143)

"BLD",9868,"KRN",9.8,"NM","B","BITX",144)

"BLD",9868,"KRN",9.8,"NM","B","BITXA",145)

"BLD",9868,"KRN",9.8,"NM","B","BITXB",146)

"BLD",9868,"KRN",9.8,"NM","B","BITXC",147)

"BLD",9868,"KRN",9.8,"NM","B","BITXD",148)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL1",149)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL11",150)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL2",151)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL3",152)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL4",153)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL5",154)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL6",155)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL7",156)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL8",157)

"BLD",9868,"KRN",9.8,"NM","B","BIUTL9",158)

"BLD",9868,"KRN",9.8,"NM","B","BIUTLFIX",159)

"BLD",9868,"KRN",9.8,"NM","B","BIVACED",160)

"BLD",9868,"KRN",9.8,"NM","B","BIVACED1",161)

"BLD",9868,"KRN",9.8,"NM","B","BIVGRP",162)

"BLD",9868,"KRN",9.8,"NM","B","BIVGRP1",163)

"BLD",9868,"KRN",9.8,"NM","B","BIVISIT",164)

"BLD",9868,"KRN",9.8,"NM","B","BIVISIT1",165)

"BLD",9868,"KRN",9.8,"NM","B","BIVISIT2",166)

"BLD",9868,"KRN",9.8,"NM","B","BIVT100",167)

"BLD",9868,"KRN",9.8,"NM","B","BIVTAB",168)

"BLD",9868,"KRN",9.8,"NM","B","BIW",169)

"BLD",9868,"KRN",9.8,"NM","B","BIXCALL",170)

"BLD",9868,"KRN",9.8,"NM","B","BIXRPC",171)

"BLD",9868,"KRN",9.8,"NM","B","BIXTCH",172)

"BLD",9868,"KRN",9.8,"NM","B","PXVBIVD",181)

"BLD",9868,"KRN",9.8,"NM","B","PXVVISIT",180)

"BLD",9868,"KRN",19,0)
19
"BLD",9868,"KRN",19,"NM",0)
^9.68A^43^43
"BLD",9868,"KRN",19,"NM",1,0)
BI CASE MANAGER ADD/EDIT^^0
"BLD",9868,"KRN",19,"NM",2,0)
BI CASE MANAGER TRANSFER^^0
"BLD",9868,"KRN",19,"NM",3,0)
BI DUE LISTS & LETTERS PRINT^^0
"BLD",9868,"KRN",19,"NM",4,0)
BI ELIGIBILITY TABLE EDIT^^0
"BLD",9868,"KRN",19,"NM",5,0)
BI EXPORT IMMUNIZATIONS^^0
"BLD",9868,"KRN",19,"NM",6,0)
BI EXPORT VACCINE TABLE^^0
"BLD",9868,"KRN",19,"NM",7,0)
BI KEY ALLOCATE NEW FROM OLD^^0
"BLD",9868,"KRN",19,"NM",8,0)
BI KEYS ALLOCATE^^0
"BLD",9868,"KRN",19,"NM",9,0)
BI LETTER EDIT^^0
"BLD",9868,"KRN",19,"NM",10,0)
BI LINE FOR MENUS^^0
"BLD",9868,"KRN",19,"NM",11,0)
BI LOT NUMBER ADD/EDIT^^0
"BLD",9868,"KRN",19,"NM",12,0)
BI LOT NUMBER NON-MANAGER^^0
"BLD",9868,"KRN",19,"NM",13,0)
BI MANUFACTURER ADD/EDIT^^0
"BLD",9868,"KRN",19,"NM",14,0)
BI MENU-MANAGER^^0
"BLD",9868,"KRN",19,"NM",15,0)
BI MENU-OLD PACKAGE^^0
"BLD",9868,"KRN",19,"NM",16,0)
BI MENU-PATIENT^^0
"BLD",9868,"KRN",19,"NM",17,0)
BI MENU-REPORTS^^0
"BLD",9868,"KRN",19,"NM",18,0)
BI NDC ADD/EDIT^^0
"BLD",9868,"KRN",19,"NM",19,0)
BI PACKAGE SETUP INFO VIEW^^0
"BLD",9868,"KRN",19,"NM",20,0)
BI PATIENT ERRORS^^0
"BLD",9868,"KRN",19,"NM",21,0)
BI PATIENT LETTER INDIVIDUAL^^0
"BLD",9868,"KRN",19,"NM",22,0)
BI PATIENT LISTS & LETTERS^^0
"BLD",9868,"KRN",19,"NM",23,0)
BI PATIENT VIEW ONLY^^0
"BLD",9868,"KRN",19,"NM",24,0)
BI PATIENT VIEW/EDIT^^0
"BLD",9868,"KRN",19,"NM",25,0)
BI PATIENTS CONV PROBS DELETE^^0
"BLD",9868,"KRN",19,"NM",26,0)
BI PATIENTS CONV PROBS PRINT^^0
"BLD",9868,"KRN",19,"NM",27,0)
BI PATIENTS SCAN^^0
"BLD",9868,"KRN",19,"NM",28,0)
BI REPORT ADOLESCENT IMMS^^0
"BLD",9868,"KRN",19,"NM",29,0)
BI REPORT ADULT IMMS^^0
"BLD",9868,"KRN",19,"NM",30,0)
BI REPORT ELIGIBILITY^^0
"BLD",9868,"KRN",19,"NM",31,0)
BI REPORT ERROR CODE TABLE^^0
"BLD",9868,"KRN",19,"NM",32,0)
BI REPORT FLU^^0
"BLD",9868,"KRN",19,"NM",33,0)
BI REPORT H1N1 ACCOUNTABILITY^^0
"BLD",9868,"KRN",19,"NM",34,0)
BI REPORT PCV^^0
"BLD",9868,"KRN",19,"NM",35,0)
BI REPORT QUARTERLY IMM^^0
"BLD",9868,"KRN",19,"NM",36,0)
BI REPORT TWO-YR RATES^^0
"BLD",9868,"KRN",19,"NM",37,0)
BI REPORT VAC ACCOUNTABILITY^^0
"BLD",9868,"KRN",19,"NM",38,0)
BI REPORT VACCINE TRANSLAT^^0
"BLD",9868,"KRN",19,"NM",39,0)
BI SITE PARAMETERS EDIT^^0
"BLD",9868,"KRN",19,"NM",40,0)
BI TASKMAN FORECAST ALL^^0
"BLD",9868,"KRN",19,"NM",41,0)
BI VACCINE TABLE EDIT^^0
"BLD",9868,"KRN",19,"NM",42,0)
BI VACCINE TABLE RESTAND^^0
"BLD",9868,"KRN",19,"NM",43,0)
BIMENU^^0
"BLD",9868,"KRN",19,"NM","B","BI CASE MANAGER ADD/EDIT",1)

"BLD",9868,"KRN",19,"NM","B","BI CASE MANAGER TRANSFER",2)

"BLD",9868,"KRN",19,"NM","B","BI DUE LISTS & LETTERS PRINT",3)

"BLD",9868,"KRN",19,"NM","B","BI ELIGIBILITY TABLE EDIT",4)

"BLD",9868,"KRN",19,"NM","B","BI EXPORT IMMUNIZATIONS",5)

"BLD",9868,"KRN",19,"NM","B","BI EXPORT VACCINE TABLE",6)

"BLD",9868,"KRN",19,"NM","B","BI KEY ALLOCATE NEW FROM OLD",7)

"BLD",9868,"KRN",19,"NM","B","BI KEYS ALLOCATE",8)

"BLD",9868,"KRN",19,"NM","B","BI LETTER EDIT",9)

"BLD",9868,"KRN",19,"NM","B","BI LINE FOR MENUS",10)

"BLD",9868,"KRN",19,"NM","B","BI LOT NUMBER ADD/EDIT",11)

"BLD",9868,"KRN",19,"NM","B","BI LOT NUMBER NON-MANAGER",12)

"BLD",9868,"KRN",19,"NM","B","BI MANUFACTURER ADD/EDIT",13)

"BLD",9868,"KRN",19,"NM","B","BI MENU-MANAGER",14)

"BLD",9868,"KRN",19,"NM","B","BI MENU-OLD PACKAGE",15)

"BLD",9868,"KRN",19,"NM","B","BI MENU-PATIENT",16)

"BLD",9868,"KRN",19,"NM","B","BI MENU-REPORTS",17)

"BLD",9868,"KRN",19,"NM","B","BI NDC ADD/EDIT",18)

"BLD",9868,"KRN",19,"NM","B","BI PACKAGE SETUP INFO VIEW",19)

"BLD",9868,"KRN",19,"NM","B","BI PATIENT ERRORS",20)

"BLD",9868,"KRN",19,"NM","B","BI PATIENT LETTER INDIVIDUAL",21)

"BLD",9868,"KRN",19,"NM","B","BI PATIENT LISTS & LETTERS",22)

"BLD",9868,"KRN",19,"NM","B","BI PATIENT VIEW ONLY",23)

"BLD",9868,"KRN",19,"NM","B","BI PATIENT VIEW/EDIT",24)

"BLD",9868,"KRN",19,"NM","B","BI PATIENTS CONV PROBS DELETE",25)

"BLD",9868,"KRN",19,"NM","B","BI PATIENTS CONV PROBS PRINT",26)

"BLD",9868,"KRN",19,"NM","B","BI PATIENTS SCAN",27)

"BLD",9868,"KRN",19,"NM","B","BI REPORT ADOLESCENT IMMS",28)

"BLD",9868,"KRN",19,"NM","B","BI REPORT ADULT IMMS",29)

"BLD",9868,"KRN",19,"NM","B","BI REPORT ELIGIBILITY",30)

"BLD",9868,"KRN",19,"NM","B","BI REPORT ERROR CODE TABLE",31)

"BLD",9868,"KRN",19,"NM","B","BI REPORT FLU",32)

"BLD",9868,"KRN",19,"NM","B","BI REPORT H1N1 ACCOUNTABILITY",33)

"BLD",9868,"KRN",19,"NM","B","BI REPORT PCV",34)

"BLD",9868,"KRN",19,"NM","B","BI REPORT QUARTERLY IMM",35)

"BLD",9868,"KRN",19,"NM","B","BI REPORT TWO-YR RATES",36)

"BLD",9868,"KRN",19,"NM","B","BI REPORT VAC ACCOUNTABILITY",37)

"BLD",9868,"KRN",19,"NM","B","BI REPORT VACCINE TRANSLAT",38)

"BLD",9868,"KRN",19,"NM","B","BI SITE PARAMETERS EDIT",39)

"BLD",9868,"KRN",19,"NM","B","BI TASKMAN FORECAST ALL",40)

"BLD",9868,"KRN",19,"NM","B","BI VACCINE TABLE EDIT",41)

"BLD",9868,"KRN",19,"NM","B","BI VACCINE TABLE RESTAND",42)

"BLD",9868,"KRN",19,"NM","B","BIMENU",43)

"BLD",9868,"KRN",19.1,0)
19.1
"BLD",9868,"KRN",19.1,"NM",0)
^9.68A^5^5
"BLD",9868,"KRN",19.1,"NM",1,0)
BIZ EDIT PATIENTS^^0
"BLD",9868,"KRN",19.1,"NM",2,0)
BIZ LOT NON-MANAGER^^0
"BLD",9868,"KRN",19.1,"NM",3,0)
BIZ LOT ONLY^^0
"BLD",9868,"KRN",19.1,"NM",4,0)
BIZ MANAGER^^0
"BLD",9868,"KRN",19.1,"NM",5,0)
BIZMENU^^0
"BLD",9868,"KRN",19.1,"NM","B","BIZ EDIT PATIENTS",1)

"BLD",9868,"KRN",19.1,"NM","B","BIZ LOT NON-MANAGER",2)

"BLD",9868,"KRN",19.1,"NM","B","BIZ LOT ONLY",3)

"BLD",9868,"KRN",19.1,"NM","B","BIZ MANAGER",4)

"BLD",9868,"KRN",19.1,"NM","B","BIZMENU",5)

"BLD",9868,"KRN",101,0)
101
"BLD",9868,"KRN",101,"NM",0)
^9.68A^78^78
"BLD",9868,"KRN",101,"NM",1,0)
BI MENU SITE PARAMETERS^^0
"BLD",9868,"KRN",101,"NM",2,0)
BI MENU SITE PARAMS HIDDEN^^0
"BLD",9868,"KRN",101,"NM",3,0)
BI SITE CASE MANAGER^^0
"BLD",9868,"KRN",101,"NM",4,0)
BI SITE CHART# DASHES^^0
"BLD",9868,"KRN",101,"NM",5,0)
BI SITE CPT VISITS IMPORT^^0
"BLD",9868,"KRN",101,"NM",6,0)
BI SITE DEFAULT PROVIDER^^0
"BLD",9868,"KRN",101,"NM",7,0)
BI SITE DUE LETTER^^0
"BLD",9868,"KRN",101,"NM",8,0)
BI SITE FORC MIN VS RECOMM^^0
"BLD",9868,"KRN",101,"NM",9,0)
BI SITE FORC RULES^^0
"BLD",9868,"KRN",101,"NM",10,0)
BI SITE FORECAST ENABLE^^0
"BLD",9868,"KRN",101,"NM",11,0)
BI SITE GPRA COMS^^0
"BLD",9868,"KRN",101,"NM",12,0)
BI SITE HFS PATH^^0
"BLD",9868,"KRN",101,"NM",13,0)
BI SITE IMMSERVE DIRECTORY^^0
"BLD",9868,"KRN",101,"NM",14,0)
BI SITE INPATIENT CHECK ENABLE^^0
"BLD",9868,"KRN",101,"NM",15,0)
BI SITE IP TCH FORECASTER^^0
"BLD",9868,"KRN",101,"NM",16,0)
BI SITE LOT# REQ'D^^0
"BLD",9868,"KRN",101,"NM",17,0)
BI SITE MIN DAYS LAST LET^^0
"BLD",9868,"KRN",101,"NM",18,0)
BI SITE OFFICIAL PT RECORD^^0
"BLD",9868,"KRN",101,"NM",19,0)
BI SITE OTHER LOCATION^^0
"BLD",9868,"KRN",101,"NM",20,0)
BI SITE PNEUMO AGE^^0
"BLD",9868,"KRN",101,"NM",21,0)
BI SITE PNEUMO/FLU PARAMETERS^^0
"BLD",9868,"KRN",101,"NM",22,0)
BI SITE REPORT HEADER^^0
"BLD",9868,"KRN",101,"NM",23,0)
BI SITE RISK CHECK ENABLE^^0
"BLD",9868,"KRN",101,"NM",24,0)
BI SITE VISIT SELECTION MENU^^0
"BLD",9868,"KRN",101,"NM",25,0)
BI UP ONE LINE^^0
"BLD",9868,"KRN",101,"NM",26,0)
BI DOWN A LINE^^0
"BLD",9868,"KRN",101,"NM",27,0)
BI PRINT LIST^^0
"BLD",9868,"KRN",101,"NM",28,0)
BI NEXT SCREEN^^0
"BLD",9868,"KRN",101,"NM",29,0)
BI PREVIOUS SCREEN^^0
"BLD",9868,"KRN",101,"NM",30,0)
BI LAST SCREEN^^0
"BLD",9868,"KRN",101,"NM",31,0)
BI FIRST SCREEN^^0
"BLD",9868,"KRN",101,"NM",32,0)
BI QUIT^^0
"BLD",9868,"KRN",101,"NM",33,0)
BI MENU LETTER FORM^^0
"BLD",9868,"KRN",101,"NM",34,0)
BI LETTER DATE/LOCATION^^0
"BLD",9868,"KRN",101,"NM",35,0)
BI LETTER DELETE^^0
"BLD",9868,"KRN",101,"NM",36,0)
BI LETTER EDIT BOTTOM^^0
"BLD",9868,"KRN",101,"NM",37,0)
BI LETTER EDIT CLOSING^^0
"BLD",9868,"KRN",101,"NM",38,0)
BI LETTER EDIT MIDDLE^^0
"BLD",9868,"KRN",101,"NM",39,0)
BI LETTER EDIT TOP^^0
"BLD",9868,"KRN",101,"NM",40,0)
BI LETTER FORECAST^^0
"BLD",9868,"KRN",101,"NM",41,0)
BI LETTER HISTORY^^0
"BLD",9868,"KRN",101,"NM",42,0)
BI LETTER PRINT INDIVIDUAL^^0
"BLD",9868,"KRN",101,"NM",43,0)
BI LETTER PRINT SAMPLE^^0
"BLD",9868,"KRN",101,"NM",44,0)
BI MENU KEY HOLDERS^^0
"BLD",9868,"KRN",101,"NM",45,0)
BI KEYS ALLOCATE/DEALLOC^^0
"BLD",9868,"KRN",101,"NM",46,0)
BI KEYS HELP VIEW^^0
"BLD",9868,"KRN",101,"NM",47,0)
BI MENU PACKAGE INFO VIEW^^0
"BLD",9868,"KRN",101,"NM",48,0)
BI BLANK^^0
"BLD",9868,"KRN",101,"NM",49,0)
BI LOT NUMBER ADD^^0
"BLD",9868,"KRN",101,"NM",50,0)
BI LOT NUMBER CHANGE ORDER^^0
"BLD",9868,"KRN",101,"NM",51,0)
BI LOT NUMBER DISP INACTIVE^^0
"BLD",9868,"KRN",101,"NM",52,0)
BI LOT NUMBER EDIT^^0
"BLD",9868,"KRN",101,"NM",53,0)
BI LOT NUMBER HELP^^0
"BLD",9868,"KRN",101,"NM",54,0)
BI LOT NUMBER PRINT^^0
"BLD",9868,"KRN",101,"NM",55,0)
BI LOT NUMBERS INACTIVATE OLD^^0
"BLD",9868,"KRN",101,"NM",56,0)
BI SEARCH LIST^^0
"BLD",9868,"KRN",101,"NM",57,0)
BI MENU LOT NUMBER EDIT^^0
"BLD",9868,"KRN",101,"NM",58,0)
BI MENU PATIENT VIEW ONLY^^0
"BLD",9868,"KRN",101,"NM",59,0)
BI HEALTH SUMMARY^^0
"BLD",9868,"KRN",101,"NM",60,0)
BI PATIENT PROFILE VIEW^^0
"BLD",9868,"KRN",101,"NM",61,0)
BI OFFICIAL IMM REC PRINT^^0
"BLD",9868,"KRN",101,"NM",62,0)
BI MENU PATIENT VIEW^^0
"BLD",9868,"KRN",101,"NM",63,0)
BI IMMUNIZATION VISIT EDIT^^0
"BLD",9868,"KRN",101,"NM",64,0)
BI IMMUNIZATION VISIT DELETE^^0
"BLD",9868,"KRN",101,"NM",65,0)
BI IMMUNIZATION VISIT ADD^^0
"BLD",9868,"KRN",101,"NM",66,0)
BI SKIN TEST VISIT ADD^^0
"BLD",9868,"KRN",101,"NM",67,0)
BI PATIENT CASE DATA EDIT^^0
"BLD",9868,"KRN",101,"NM",68,0)
BI CONTRAINDICATIONS^^0
"BLD",9868,"KRN",101,"NM",69,0)
BI PATIENT VIEW PRINT^^0
"BLD",9868,"KRN",101,"NM",70,0)
BI MENU GENERIC HELP VIEW^^0
"BLD",9868,"KRN",101,"NM",71,0)
BI MENU CONTRAINDICATIONS^^0
"BLD",9868,"KRN",101,"NM",72,0)
BI CONTRAINDICATION DELETE^^0
"BLD",9868,"KRN",101,"NM",73,0)
BI CONTRAINDICATION ADD^^0
"BLD",9868,"KRN",101,"NM",74,0)
BI CONTRAINDICATION HELP^^0
"BLD",9868,"KRN",101,"NM",75,0)
BI CONTRAINDICATIONS EDIT^^0
"BLD",9868,"KRN",101,"NM",76,0)
BI MENU BLANK^^0
"BLD",9868,"KRN",101,"NM",77,0)
BI IMMUNIZATION DELETED^^0
"BLD",9868,"KRN",101,"NM",78,0)
BI IMMUNIZATION ADDED^^0
"BLD",9868,"KRN",101,"NM","B","BI BLANK",48)

"BLD",9868,"KRN",101,"NM","B","BI CONTRAINDICATION ADD",73)

"BLD",9868,"KRN",101,"NM","B","BI CONTRAINDICATION DELETE",72)

"BLD",9868,"KRN",101,"NM","B","BI CONTRAINDICATION HELP",74)

"BLD",9868,"KRN",101,"NM","B","BI CONTRAINDICATIONS",68)

"BLD",9868,"KRN",101,"NM","B","BI CONTRAINDICATIONS EDIT",75)

"BLD",9868,"KRN",101,"NM","B","BI DOWN A LINE",26)

"BLD",9868,"KRN",101,"NM","B","BI FIRST SCREEN",31)

"BLD",9868,"KRN",101,"NM","B","BI HEALTH SUMMARY",59)

"BLD",9868,"KRN",101,"NM","B","BI IMMUNIZATION ADDED",78)

"BLD",9868,"KRN",101,"NM","B","BI IMMUNIZATION DELETED",77)

"BLD",9868,"KRN",101,"NM","B","BI IMMUNIZATION VISIT ADD",65)

"BLD",9868,"KRN",101,"NM","B","BI IMMUNIZATION VISIT DELETE",64)

"BLD",9868,"KRN",101,"NM","B","BI IMMUNIZATION VISIT EDIT",63)

"BLD",9868,"KRN",101,"NM","B","BI KEYS ALLOCATE/DEALLOC",45)

"BLD",9868,"KRN",101,"NM","B","BI KEYS HELP VIEW",46)

"BLD",9868,"KRN",101,"NM","B","BI LAST SCREEN",30)

"BLD",9868,"KRN",101,"NM","B","BI LETTER DATE/LOCATION",34)

"BLD",9868,"KRN",101,"NM","B","BI LETTER DELETE",35)

"BLD",9868,"KRN",101,"NM","B","BI LETTER EDIT BOTTOM",36)

"BLD",9868,"KRN",101,"NM","B","BI LETTER EDIT CLOSING",37)

"BLD",9868,"KRN",101,"NM","B","BI LETTER EDIT MIDDLE",38)

"BLD",9868,"KRN",101,"NM","B","BI LETTER EDIT TOP",39)

"BLD",9868,"KRN",101,"NM","B","BI LETTER FORECAST",40)

"BLD",9868,"KRN",101,"NM","B","BI LETTER HISTORY",41)

"BLD",9868,"KRN",101,"NM","B","BI LETTER PRINT INDIVIDUAL",42)

"BLD",9868,"KRN",101,"NM","B","BI LETTER PRINT SAMPLE",43)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBER ADD",49)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBER CHANGE ORDER",50)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBER DISP INACTIVE",51)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBER EDIT",52)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBER HELP",53)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBER PRINT",54)

"BLD",9868,"KRN",101,"NM","B","BI LOT NUMBERS INACTIVATE OLD",55)

"BLD",9868,"KRN",101,"NM","B","BI MENU BLANK",76)

"BLD",9868,"KRN",101,"NM","B","BI MENU CONTRAINDICATIONS",71)

"BLD",9868,"KRN",101,"NM","B","BI MENU GENERIC HELP VIEW",70)

"BLD",9868,"KRN",101,"NM","B","BI MENU KEY HOLDERS",44)

"BLD",9868,"KRN",101,"NM","B","BI MENU LETTER FORM",33)

"BLD",9868,"KRN",101,"NM","B","BI MENU LOT NUMBER EDIT",57)

"BLD",9868,"KRN",101,"NM","B","BI MENU PACKAGE INFO VIEW",47)

"BLD",9868,"KRN",101,"NM","B","BI MENU PATIENT VIEW",62)

"BLD",9868,"KRN",101,"NM","B","BI MENU PATIENT VIEW ONLY",58)

"BLD",9868,"KRN",101,"NM","B","BI MENU SITE PARAMETERS",1)

"BLD",9868,"KRN",101,"NM","B","BI MENU SITE PARAMS HIDDEN",2)

"BLD",9868,"KRN",101,"NM","B","BI NEXT SCREEN",28)

"BLD",9868,"KRN",101,"NM","B","BI OFFICIAL IMM REC PRINT",61)

"BLD",9868,"KRN",101,"NM","B","BI PATIENT CASE DATA EDIT",67)

"BLD",9868,"KRN",101,"NM","B","BI PATIENT PROFILE VIEW",60)

"BLD",9868,"KRN",101,"NM","B","BI PATIENT VIEW PRINT",69)

"BLD",9868,"KRN",101,"NM","B","BI PREVIOUS SCREEN",29)

"BLD",9868,"KRN",101,"NM","B","BI PRINT LIST",27)

"BLD",9868,"KRN",101,"NM","B","BI QUIT",32)

"BLD",9868,"KRN",101,"NM","B","BI SEARCH LIST",56)

"BLD",9868,"KRN",101,"NM","B","BI SITE CASE MANAGER",3)

"BLD",9868,"KRN",101,"NM","B","BI SITE CHART# DASHES",4)

"BLD",9868,"KRN",101,"NM","B","BI SITE CPT VISITS IMPORT",5)

"BLD",9868,"KRN",101,"NM","B","BI SITE DEFAULT PROVIDER",6)

"BLD",9868,"KRN",101,"NM","B","BI SITE DUE LETTER",7)

"BLD",9868,"KRN",101,"NM","B","BI SITE FORC MIN VS RECOMM",8)

"BLD",9868,"KRN",101,"NM","B","BI SITE FORC RULES",9)

"BLD",9868,"KRN",101,"NM","B","BI SITE FORECAST ENABLE",10)

"BLD",9868,"KRN",101,"NM","B","BI SITE GPRA COMS",11)

"BLD",9868,"KRN",101,"NM","B","BI SITE HFS PATH",12)

"BLD",9868,"KRN",101,"NM","B","BI SITE IMMSERVE DIRECTORY",13)

"BLD",9868,"KRN",101,"NM","B","BI SITE INPATIENT CHECK ENABLE",14)

"BLD",9868,"KRN",101,"NM","B","BI SITE IP TCH FORECASTER",15)

"BLD",9868,"KRN",101,"NM","B","BI SITE LOT# REQ'D",16)

"BLD",9868,"KRN",101,"NM","B","BI SITE MIN DAYS LAST LET",17)

"BLD",9868,"KRN",101,"NM","B","BI SITE OFFICIAL PT RECORD",18)

"BLD",9868,"KRN",101,"NM","B","BI SITE OTHER LOCATION",19)

"BLD",9868,"KRN",101,"NM","B","BI SITE PNEUMO AGE",20)

"BLD",9868,"KRN",101,"NM","B","BI SITE PNEUMO/FLU PARAMETERS",21)

"BLD",9868,"KRN",101,"NM","B","BI SITE REPORT HEADER",22)

"BLD",9868,"KRN",101,"NM","B","BI SITE RISK CHECK ENABLE",23)

"BLD",9868,"KRN",101,"NM","B","BI SITE VISIT SELECTION MENU",24)

"BLD",9868,"KRN",101,"NM","B","BI SKIN TEST VISIT ADD",66)

"BLD",9868,"KRN",101,"NM","B","BI UP ONE LINE",25)

"BLD",9868,"KRN",409.61,0)
409.61
"BLD",9868,"KRN",409.61,"NM",0)
^9.68A^10^10
"BLD",9868,"KRN",409.61,"NM",1,0)
BI SITE PARAMETERS EDIT^^0
"BLD",9868,"KRN",409.61,"NM",2,0)
BI LETTER FORM^^0
"BLD",9868,"KRN",409.61,"NM",3,0)
BI KEY HOLDERS VIEW/EDIT^^0
"BLD",9868,"KRN",409.61,"NM",4,0)
BI KEYS EXPLANATION VIEW^^0
"BLD",9868,"KRN",409.61,"NM",5,0)
BI LOT TABLE EDIT^^0
"BLD",9868,"KRN",409.61,"NM",6,0)
BI PATIENT DATA VIEW ONLY^^0
"BLD",9868,"KRN",409.61,"NM",7,0)
BI PATIENT DATA VIEW/EDIT^^0
"BLD",9868,"KRN",409.61,"NM",8,0)
BI GENERIC HELP VIEW^^0
"BLD",9868,"KRN",409.61,"NM",9,0)
BI PATIENT CONTRAINDICATIONS^^0
"BLD",9868,"KRN",409.61,"NM",10,0)
BI PATIENT PROFILE VIEW^^0
"BLD",9868,"KRN",409.61,"NM","B","BI GENERIC HELP VIEW",8)

"BLD",9868,"KRN",409.61,"NM","B","BI KEY HOLDERS VIEW/EDIT",3)

"BLD",9868,"KRN",409.61,"NM","B","BI KEYS EXPLANATION VIEW",4)

"BLD",9868,"KRN",409.61,"NM","B","BI LETTER FORM",2)

"BLD",9868,"KRN",409.61,"NM","B","BI LOT TABLE EDIT",5)

"BLD",9868,"KRN",409.61,"NM","B","BI PATIENT CONTRAINDICATIONS",9)

"BLD",9868,"KRN",409.61,"NM","B","BI PATIENT DATA VIEW ONLY",6)

"BLD",9868,"KRN",409.61,"NM","B","BI PATIENT DATA VIEW/EDIT",7)

"BLD",9868,"KRN",409.61,"NM","B","BI PATIENT PROFILE VIEW",10)

"BLD",9868,"KRN",409.61,"NM","B","BI SITE PARAMETERS EDIT",1)

"BLD",9868,"KRN",771,0)
771
"BLD",9868,"KRN",779.2,0)
779.2
"BLD",9868,"KRN",870,0)
870
"BLD",9868,"KRN",8989.51,0)
8989.51
"BLD",9868,"KRN",8989.52,0)
8989.52
"BLD",9868,"KRN",8994,0)
8994
"BLD",9868,"KRN","B",.4,.4)

"BLD",9868,"KRN","B",.401,.401)

"BLD",9868,"KRN","B",.402,.402)

"BLD",9868,"KRN","B",.403,.403)

"BLD",9868,"KRN","B",.5,.5)

"BLD",9868,"KRN","B",.84,.84)

"BLD",9868,"KRN","B",3.6,3.6)

"BLD",9868,"KRN","B",3.8,3.8)

"BLD",9868,"KRN","B",9.2,9.2)

"BLD",9868,"KRN","B",9.8,9.8)

"BLD",9868,"KRN","B",19,19)

"BLD",9868,"KRN","B",19.1,19.1)

"BLD",9868,"KRN","B",101,101)

"BLD",9868,"KRN","B",409.61,409.61)

"BLD",9868,"KRN","B",771,771)

"BLD",9868,"KRN","B",779.2,779.2)

"BLD",9868,"KRN","B",870,870)

"BLD",9868,"KRN","B",8989.51,8989.51)

"BLD",9868,"KRN","B",8989.52,8989.52)

"BLD",9868,"KRN","B",8994,8994)

"BLD",9868,"QUES",0)
^9.62^^
"BLD",9868,"REQB",0)
^9.611^4^3
"BLD",9868,"REQB",2,0)
PX*1.0*201^1
"BLD",9868,"REQB",3,0)
PX*1.0*206^1
"BLD",9868,"REQB",4,0)
PX*1.0*209^1
"BLD",9868,"REQB","B","PX*1.0*201",2)

"BLD",9868,"REQB","B","PX*1.0*206",3)

"BLD",9868,"REQB","B","PX*1.0*209",4)

"DATA",9002084.33,99,0)
99
"DATA",9002084.33,100,0)
100^SITE PARAMETERS, HOST FILE, OP SYSTEM, STANDARD VARIABLE ERRORS
"DATA",9002084.33,101,0)
101^Save to Host File Server FAILED (software error).
"DATA",9002084.33,102,0)
102^File name is not provided.
"DATA",9002084.33,103,0)
103^There is no entry in the BI SITE PARAMETER File for this site.
"DATA",9002084.33,104,0)
104^The Host File Path in the BI SITE PARAMETER File has not been set.
"DATA",9002084.33,105,0)
105^Site IEN (DUZ(2)) not provided (software error).
"DATA",9002084.33,106,0)
106^User/Person ID (DUZ) not provided (software error).
"DATA",9002084.33,108,0)
108^Immunizations Due Letter IEN does not exist in file (software error).
"DATA",9002084.33,109,0)
109^Site IEN not passed (software error).
"DATA",9002084.33,110,0)
110^Site IEN does not exist in BI SITE PARAMETER File (software error).
"DATA",9002084.33,111,0)
111^Variable BISITE is not provided (software error).
"DATA",9002084.33,112,0)
112^User ID (DUZ) does not exist in NEW PERSON File (software error).
"DATA",9002084.33,113,0)
113^Site Param for Official Imm Record not set. (Go MGR-->ESP-->4)
"DATA",9002084.33,114,0)
114^Official Imm Record Letter has been deleted. (Go MGR-->ESP-->4)
"DATA",9002084.33,115,0)
115^Save patient history to Host File Server failed (software error).
"DATA",9002084.33,116,0)
116^Site Parameter for Operating System not set. (Go MGR-->ESP-->15)
"DATA",9002084.33,117,0)
117^Read of forecast from Host File Server failed (software error).
"DATA",9002084.33,118,0)
118^Invalid ImmServe Path; edit Site Parameter. (Go MGR-->ESP-->15)
"DATA",9002084.33,119,0)
119^ImmServe Path not set; edit Site Parameter. (Go MGR-->ESP-->15)
"DATA",9002084.33,120,0)
120^Unable to identify Operating System (software error).
"DATA",9002084.33,121,0)
121^Site IEN (DUZ(2)) not provided in BIRPC3 (software error).
"DATA",9002084.33,122,0)
122^Call to OS level Immserve library failed (software error).^Immserve call fail
"DATA",9002084.33,123,0)
123^Failure to open forecaster. Check Apache Tomcat Service.^Check Apache Svc
"DATA",9002084.33,124,0)
124^Site IEN (BIDUZ2) not provided to rtn BIXTCH (software error).
"DATA",9002084.33,125,0)
125^IP address for TCH Forecaster not set in Site Parameters.
"DATA",9002084.33,199,0)
199^ 
"DATA",9002084.33,200,0)
200^PATIENT ERRORS
"DATA",9002084.33,201,0)
201^Patient DFN not provided (software error).
"DATA",9002084.33,202,0)
202^This patient did not have an IMM ACTIVE/INACTIVE Status.
"DATA",9002084.33,203,0)
203^DFN does not exist in RPMS Patient database (software error).
"DATA",9002084.33,204,0)
204^This patient is not in the Immunization Register.
"DATA",9002084.33,205,0)
205^Records indicate this patient is deceased.
"DATA",9002084.33,206,0)
206^Valid DFN for Patient Case Data edit not provided (software error).
"DATA",9002084.33,207,0)
207^Patient Case Data for edit not provided (software error).
"DATA",9002084.33,208,0)
208^Valid Case Manager IEN not provided (software error).
"DATA",9002084.33,209,0)
209^Inactive Date provided is not valid (software error).
"DATA",9002084.33,210,0)
210^Patient Case Data edit failed in call to DIE (software error).
"DATA",9002084.33,211,0)
211^Unable to add patient to Immunization database (software error).
"DATA",9002084.33,212,0)
212^This Patient is being edited by another user.  Please try later.  
"DATA",9002084.33,213,0)
213^Case Manager is INACTIVE.  Reactivate under Manager Menu (MGR-->CMG).
"DATA",9002084.33,214,0)
214^Default Case Manager is INACTIVE.  Check Site Parameters (MGR-->ESP).
"DATA",9002084.33,215,0)
215^Precise Date of Birth not recorded.  Edit patient's DOB.
"DATA",9002084.33,216,0)
216^Valid Patient DFN not retrieved from BIPERR global (software error).
"DATA",9002084.33,217,0)
217^Valid BIDFN not provided for AUPNPAT global (software error).
"DATA",9002084.33,218,0)
218^This patient is already in the Immunization Database.
"DATA",9002084.33,219,0)
219^An Inactive Date requires a Inactive REASON. 
"DATA",9002084.33,299,0)
299^ 
"DATA",9002084.33,300,0)
300^IMMUNIZATION HISTORY, FORECASTING AND PROFILE ERRORS
"DATA",9002084.33,301,0)
301^Patient DFN not provided for Forecast (software error).
"DATA",9002084.33,302,0)
302^Location for Immunization Visit not entered.
"DATA",9002084.33,303,0)
303^Immunization History not provided (software error).
"DATA",9002084.33,305,0)
305^Patient DFN not provided for Profile (software error).
"DATA",9002084.33,306,0)
306^Patient DFN not provided for Imm History (software error).
"DATA",9002084.33,307,0)
307^Imm/Serve Patient Profile not provided (software error).
"DATA",9002084.33,308,0)
308^Patient DFN not provided for contraindications (software error).
"DATA",9002084.33,309,0)
309^Patient zero node is null (software error).
"DATA",9002084.33,310,0)
310^Contraindications string not provided (software error).
"DATA",9002084.33,311,0)
311^Unable to add contraindication for this patient (software error).
"DATA",9002084.33,312,0)
312^Vaccine entry does not exist in IMMUNIZATION File (software error).
"DATA",9002084.33,313,0)
313^There are no Contraindications to delete!
"DATA",9002084.33,314,0)
314^Immunization Forecasting disabled (see Site Parameters).
"DATA",9002084.33,315,0)
315^Forecast Date is before Patient's Date of Birth.
"DATA",9002084.33,399,0)
399^ 
"DATA",9002084.33,400,0)
400^PCC VISIT, CONTRAINDICATION, HEALTH SUMMARY, FACE SHEET ERRORS
"DATA",9002084.33,401,0)
401^PCC VISIT not created.
"DATA",9002084.33,402,0)
402^PCC V IMMUNIZATION not created (software error).
"DATA",9002084.33,403,0)
403^New Immunization Visit data not provided (software error).
"DATA",9002084.33,404,0)
404^DA to delete V File Visit not provided (software error).
"DATA",9002084.33,405,0)
405^Patient DFN for Immunization Visit not provided (software error).
"DATA",9002084.33,406,0)
406^No selection made.
"DATA",9002084.33,407,0)
407^Health Summary not produced (software error).
"DATA",9002084.33,408,0)
408^Face Sheet not produced (software error).
"DATA",9002084.33,409,0)
409^IEN for V FILE entry not provided (software error).
"DATA",9002084.33,410,0)
410^Visit Type (I or S) not provided (software error).
"DATA",9002084.33,411,0)
411^V File entry does not exist (software error).
"DATA",9002084.33,412,0)
412^Failure to retrieve Visit data (software error).
"DATA",9002084.33,413,0)
413^PCC V SKIN TEST not created (software error).
"DATA",9002084.33,414,0)
414^IEN to delete Contraindication not provided (software error).
"DATA",9002084.33,415,0)
415^Patient DFN for Contraindication not provided (software error).
"DATA",9002084.33,416,0)
416^New Contraindication data not provided (software error).
"DATA",9002084.33,417,0)
417^Valid Patient DFN for contraindication not provided (software error).
"DATA",9002084.33,418,0)
418^Valid Vaccine IEN for contraindication not provided (software error).
"DATA",9002084.33,419,0)
419^IEN for Contraindication Reason is not valid (software error).
"DATA",9002084.33,420,0)
420^Contraindication NOT added (software error).
"DATA",9002084.33,421,0)
421^Vaccine Information Statement (VIS) not stored (software error).
"DATA",9002084.33,422,0)
422^Visit date submitted is before Patient's Date of Birth.
"DATA",9002084.33,423,0)
423^An Immunization for this vaccine on this date is already recorded.
"DATA",9002084.33,424,0)
424^This Skin Test has already been recorded for this date.
"DATA",9002084.33,425,0)
425^Invalid Lot# IEN passed to PCC (software error).
"DATA",9002084.33,426,0)
426^Lot# is INACTIVE.  Reactivate under Manager Menu (MGR-->LOT).
"DATA",9002084.33,427,0)
427^Lot# for this Visit is a duplicate.  Check Lot Table.
"DATA",9002084.33,428,0)
428^Failure to delete V File entry (software error).
"DATA",9002084.33,429,0)
429^Vaccine is INACTIVE.  Reactivate under Manager Menu (MGR-->VAC).
"DATA",9002084.33,430,0)
430^Invalid Vaccine IEN passed to PCC (software error).
"DATA",9002084.33,431,0)
431^A Lot# is required.  (Add a Lot# or edit Site Parameter: MGR-->ESP)
"DATA",9002084.33,432,0)
432^VISIT (at IEN=BIVSIT) does not exist (software error).
"DATA",9002084.33,433,0)
433^DIE call to change Visit Location failed (software error).
"DATA",9002084.33,434,0)
434^DIE call to change Visit Outside Location failed (software error).
"DATA",9002084.33,435,0)
435^Failed call to APCDAPI4 (software error).
"DATA",9002084.33,436,0)
436^If you enter a Skin Test Result you MUST enter a Reading.^Missing Reading
"DATA",9002084.33,437,0)
437^Visit data not provided (software error)
"DATA",9002084.33,438,0)
438^Failed to identify Visit after call to APCDAPI4 (software error)
"DATA",9002084.33,439,0)
439^This would be a duplicate Contraindication.^Duplicate Contraind
"DATA",9002084.33,440,0)
440^Entry does not exist in the Refusal Type file (software error).^Bad pointer
"DATA",9002084.33,441,0)
441^Vaccine IEN not provided.
"DATA",9002084.33,442,0)
442^New Lot Number data not provided (software error).^No Lot Number data
"DATA",9002084.33,443,0)
443^Lot Number provided is too long(software error).^Lot Number too long
"DATA",9002084.33,444,0)
444^New Lot Number provided already exists (software error).^Lot# already exists
"DATA",9002084.33,445,0)
445^Invalid CVX Code provided (software error).^Invalid CVX Code
"DATA",9002084.33,446,0)
446^Invalid MVX Code provided (software error).^Invalid MVX
"DATA",9002084.33,447,0)
447^Failure to match new Lot Number IEN (software error).^Fail IEN
"DATA",9002084.33,448,0)
448^Contraindication IEN does not exist (software error).^Bad Contra IEN
"DATA",9002084.33,449,0)
449^Bad IEN for BI CONTRA DELETED (software error).^Contra Del bad IEN
"DATA",9002084.33,450,0)
450^Bad IEN for BI V IMM DELETED (software error).^Bad IEN for Imm Del
"DATA",9002084.33,499,0)
499^ 
"DATA",9002084.33,500,0)
500^IMMUNIZATION TABLES ERRORS
"DATA",9002084.33,501,0)
501^There are no ACTIVE Vaccine Names.  Check Site Parameters.
"DATA",9002084.33,502,0)
502^Vaccine IEN not provided (software error).
"DATA",9002084.33,503,0)
503^Vaccine Table (IMMUNIZATION File) is not standard--cannot proceed.
"DATA",9002084.33,504,0)
504^Vaccine Short Name not passed--contact OIRM Headquarters for help.
"DATA",9002084.33,505,0)
505^Vaccine Translation Table corrupt--contact OIRM Headquarters for help.
"DATA",9002084.33,506,0)
506^Vaccine not selected.  * Halting installation. *
"DATA",9002084.33,507,0)
507^Problem with pointers mapping old Vaccine Table to new HL7 Table.
"DATA",9002084.33,508,0)
508^Non-standard entry in the Vaccine Table (IMMUNIZATION File).
"DATA",9002084.33,509,0)
509^A standard entry is missing from the Vaccine Table (IMM File).
"DATA",9002084.33,510,0)
510^Vaccine Group IEN not provided (software error).
"DATA",9002084.33,511,0)
511^Valid Lot Number IEN not provided (software error).^No Lot IEN.
"DATA",9002084.33,512,0)
512^Lot Number IEN does not exist (software error).^No Lot
"DATA",9002084.33,513,0)
513^Lot Number not assigned to Vaccine provided.  Check Lot Table.^Lot not for Vaccine
"DATA",9002084.33,514,0)
514^Eligibility Code IEN not provided (software error).
"DATA",9002084.33,515,0)
515^NDC Code IEN not provided (software error).
"DATA",9002084.33,516,0)
516^NDC Code IEN does not exist in global (software error).
"DATA",9002084.33,517,0)
517^Unable to create new NDC Code (software error).
"DATA",9002084.33,599,0)
599
"DATA",9002084.33,600,0)
600^SELECTION AND OTHER UTILITY ERRORS
"DATA",9002084.33,601,0)
601^Lookup global for this File# does not exist (software error).
"DATA",9002084.33,602,0)
602^Local array name for Item Selection not passed (software error).
"DATA",9002084.33,604,0)
604^IEN of Selected Item not found in TMP (sofware error).
"DATA",9002084.33,605,0)
605^Selection Array is subscripted; see routine BISELECT (software error).
"DATA",9002084.33,606,0)
606^Selection Array may not be a global (software error).
"DATA",9002084.33,607,0)
607^File Number not passed (software error).
"DATA",9002084.33,608,0)
608^DD or Data global for File# passed does not exist (software error).
"DATA",9002084.33,609,0)
609^Form Letter IEN not provided (software error).
"DATA",9002084.33,610,0)
610^Form Letter IEN does not exist in file (software error).
"DATA",9002084.33,611,0)
611^Section Node for Form Letter edit not provided (software error).
"DATA",9002084.33,612,0)
612^Form Letter Section Node does not exist in file (software error).
"DATA",9002084.33,613,0)
613^Age Range not provided (software error).
"DATA",9002084.33,614,0)
614^Current Community array not provided (software error).
"DATA",9002084.33,615,0)
615^Case Manager array not provided (software error).
"DATA",9002084.33,616,0)
616^Forecast Date not provided (software error).
"DATA",9002084.33,617,0)
617^Minimum Interval Days not provided (software error).
"DATA",9002084.33,618,0)
618^Order of Listing not provided (software error).
"DATA",9002084.33,619,0)
619^Sorry, you do not have the Manager's Key to edit the Due Letter.
"DATA",9002084.33,620,0)
620^Patient Group parameter not passed (software error).
"DATA",9002084.33,621,0)
621^Calling routine for reset not passed (software error).
"DATA",9002084.33,622,0)
622^Please enter a valid Quarter Ending Date.    
"DATA",9002084.33,623,0)
623^Quarter Ending Date not provided (software error).
"DATA",9002084.33,624,0)
624^Listman array node not passed (software error).
"DATA",9002084.33,625,0)
625^Health Care Facility array not provided (software error).
"DATA",9002084.33,626,0)
626^Beginning Date not provided (software error).
"DATA",9002084.33,627,0)
627^Ending Date not provided (software error).
"DATA",9002084.33,628,0)
628^Valid List Template not provided (software error).
"DATA",9002084.33,629,0)
629^Additional Information parameter not provided (software error).
"DATA",9002084.33,630,0)
630^Lot Number array not provided (software error).
"DATA",9002084.33,631,0)
631^You do not have the BIZ MANAGER Key required to allocate Keys.
"DATA",9002084.33,632,0)
632^Key does not exist in SECURITY KEY File (software error).
"DATA",9002084.33,633,0)
633^There are duplicates of this Key in the SECURITY KEY File.
"DATA",9002084.33,634,0)
634^BIALL parameter not specified (software error).
"DATA",9002084.33,635,0)
635^Key name not provided (software error).
"DATA",9002084.33,636,0)
636^FILE~DICN lookup failed (Fileman software error).
"DATA",9002084.33,637,0)
637^TMP("BILET",$J global storing letter does not exist (software error).
"DATA",9002084.33,638,0)
638^Immunizations Due array not provided (software error).
"DATA",9002084.33,639,0)
639^Patient Group variable, BIPG, not passed (software error).
"DATA",9002084.33,640,0)
640^Survey Date, BISVDT, not passed to Export (software error).
"DATA",9002084.33,641,0)
641^Patient Group, BIGRP, not passed to Export (software error).
"DATA",9002084.33,642,0)
642^Age Range, BIAGRG, not passed to Export (software error).
"DATA",9002084.33,643,0)
643^Health Care Facility, BIHCF, not passed to Export (software error).
"DATA",9002084.33,644,0)
644^Current Community, BICC, not passed to Export (software error).
"DATA",9002084.33,645,0)
645^Immunization, BIMMR, not passed to Export (software error).
"DATA",9002084.33,646,0)
646^No Data Elements selected.
"DATA",9002084.33,647,0)
647^Format, BIFMT, not passed to Export (software error).
"DATA",9002084.33,648,0)
648^Output Device, BIOUT, not passed to Export (software error).
"DATA",9002084.33,649,0)
649^File Name, BIFLNM, not passed to Export (software error).
"DATA",9002084.33,650,0)
650^No patients selected.
"DATA",9002084.33,651,0)
651^Path Name, BIPATH, not passed to Export (software error).
"DATA",9002084.33,652,0)
652^Immunizations Received array not provided (software error).
"DATA",9002084.33,653,0)
653^Search Template IEN not passed (software error).
"DATA",9002084.33,654,0)
654^Search Template does not exist (software error).
"DATA",9002084.33,655,0)
655^Search Template does not contain any patients.
"DATA",9002084.33,656,0)
656^Subheader array not passed (software error).
"DATA",9002084.33,657,0)
657^Subheader Item Name not passed (software error).
"DATA",9002084.33,658,0)
658^Subheader Item global not passed (software error).
"DATA",9002084.33,659,0)
659^Invalid global name for Subheader Items (software error).
"DATA",9002084.33,660,0)
660^  * INVALID AGE RANGE.  Please begin again.
"DATA",9002084.33,661,0)
661^Listman item not defined (software error).
"DATA",9002084.33,662,0)
662^Beneficiary Type array not provided (software error).
"DATA",9002084.33,663,0)
663^Include Historical Visits parameter not provided (software error).
"DATA",9002084.33,664,0)
664^Visit Type array not provided (software error).
"DATA",9002084.33,665,0)
665^Invalid Set of Codes for Subheader Items (software error).
"DATA",9002084.33,666,0)
666^Explanation Text Array not passed (software error).
"DATA",9002084.33,667,0)
667^Adult Report statistics not passed (software error).^Stats not passed.
"DATA",9002084.33,668,0)
668^Too many subheaders for screen display. Print Report instead.^Too many subheaders
"DATA",9002084.33,669,0)
669^Report Menu parameter not passed (software error).^Param not passed
"DATA",9002084.33,670,0)
670^This Entry is being edited by another user.  Please try later.
"DATA",9002084.33,671,0)
671^Invalid File Number passed (software error).^Invalid File Number
"DATA",9002084.33,672,0)
672^Internal Entry Number not passed (software error).^IEN not passed.
"DATA",9002084.33,673,0)
673^Passed File Entry does not exist (software error).^Entry doesn't exist
"DATA",9002084.33,674,0)
674^Fileman Error reported by FILE~DIE (software error).^Fileman Error
"DATA",9002084.33,675,0)
675^Fileman Error reported by UPDATE~DIE (software error).^UPDATE~DIE Error
"DATA",9002084.33,676,0)
676^Invalid Age Range passed (software error).
"DATA",9002084.33,677,0)
677^24-Month Column display parameter not provided (software error).^No 24-Month param
"DATA",9002084.33,678,0)
678^Vaccine Combination Number not passed (software error).^Vac Comb not passed
"DATA",9002084.33,679,0)
679^Please enter a valid year [yyyy].^Valid year
"DATA",9002084.33,680,0)
680^Designated Provider array not provided (software error).^No Desig Provider
"DATA",9002084.33,681,0)
681^Display by Lot Number parameter not provided (software error).^Display Lot Number
"DATA",9002084.33,682,0)
682^Include Adults parameter not provided (software error).^Incl Adults missing
"DATA",9002084.33,683,0)
683^Delimiter parameter not provided (software error).^Delimiter missing
"DATA",9002084.33,699,0)
699
"DATA",9002084.33,800,0)
800^IMMSERVE ERROR CODES
"DATA",9002084.33,801,0)
801^Bad dose date in series history.^Bad Dose date
"DATA",9002084.33,802,0)
802^Unsupported dose date in series history.^Bad Dose date
"DATA",9002084.33,803,0)
803^Dose date earlier than Date of Birth.^Dose Date<DOB
"DATA",9002084.33,804,0)
804^Dose date later than Date of Forecast.^Dose Date>Forc Date
"DATA",9002084.33,805,0)
805^Dose number too big for the series.^Dose# too big
"DATA",9002084.33,806,0)
806^Unsupported numbered dose date source.^Bad Dose date
"DATA",9002084.33,807,0)
807^More than one designated dose.^>1 Designate Dose
"DATA",9002084.33,808,0)
808^Too many prior doses in a designated dose series.^Too many Doses
"DATA",9002084.33,809,0)
809^Numbered dose out of sequence in a low number series.^Dose# out of seq
"DATA",9002084.33,810,0)
810^Multiple doses with the same number in a low number series.^Duplicate Dose#'s
"DATA",9002084.33,811,0)
811^Too many prior doses in a low number series.^Too many Doses
"DATA",9002084.33,812,0)
812^Numbered dose out of order.^Dose# out of seq
"DATA",9002084.33,813,0)
813^Multiple doses with the same number.^Duplicate Dose#'s
"DATA",9002084.33,814,0)
814^Un-numbered dose.^Un-numbered dose
"DATA",9002084.33,815,0)
815^Screening a prior dose in a designated dose series.^Prior Dose problem
"DATA",9002084.33,816,0)
816^Screening the designated dose.^Desig Dose problem
"DATA",9002084.33,817,0)
817^Screening a prior dose in a low number series.^Prior Dose problem
"DATA",9002084.33,818,0)
818^Screening the lowest numbered dose.^Lowest Dose problem
"DATA",9002084.33,819,0)
819^The Series is incomplete and has a problem dose.^Incomplete Series
"DATA",9002084.33,998,0)
998^ 
"DATA",9002084.33,999,0)
999^Unknown error.
"DATA",9002084.45,1,0)
Standard Due Letter^1^1^1^^0
"DATA",9002084.45,1,1,0)
^^23^23^3060914^
"DATA",9002084.45,1,1,1,0)
 
"DATA",9002084.45,1,1,2,0)
                            Jimmy's Immies Clinic
"DATA",9002084.45,1,1,3,0)
                                7 Your Street
"DATA",9002084.45,1,1,4,0)
                             Your City, ST  77777
"DATA",9002084.45,1,1,5,0)
 
"DATA",9002084.45,1,1,6,0)
 
"DATA",9002084.45,1,1,7,0)
     |BI TODAY|
"DATA",9002084.45,1,1,8,0)
 
"DATA",9002084.45,1,1,9,0)
                                    Date of Birth: |BI DATE OF BIRTH|
"DATA",9002084.45,1,1,10,0)
                                           Chart#: |BI CHART NUMBER|
"DATA",9002084.45,1,1,11,0)
 
"DATA",9002084.45,1,1,12,0)
     |BI PARENT/GUARDIAN|
"DATA",9002084.45,1,1,13,0)
     |BI NAME FIRST LAST|
"DATA",9002084.45,1,1,14,0)
     |BI MAILING ADD-STREET|
"DATA",9002084.45,1,1,15,0)
     |BI MAILING ADD-STREET-2|
"DATA",9002084.45,1,1,16,0)
     |BI MAILING ADD-CITY STATE ZIP|
"DATA",9002084.45,1,1,17,0)
 
"DATA",9002084.45,1,1,18,0)
- -                                                                    - -
"DATA",9002084.45,1,1,19,0)
 
"DATA",9002084.45,1,1,20,0)
     Dear Parent or Guardian:
"DATA",9002084.45,1,1,21,0)
 
"DATA",9002084.45,1,1,22,0)
     Your child, |BI NAME FIRST|, is due for immunizations.  According to our 
"DATA",9002084.45,1,1,23,0)
     records, the following immunizations have already been received:
"DATA",9002084.45,1,2,0)
^9002084.47^1^1^3050512^^^^
"DATA",9002084.45,1,2,1,0)
     |BI NAME FIRST| will be due for the immunizations listed below:
"DATA",9002084.45,1,3,0)
^9002084.48^6^6^3050512^^
"DATA",9002084.45,1,3,1,0)
     If you feel our records are not correct, please notify us so that
"DATA",9002084.45,1,3,2,0)
     we may make the corrections to update our records.  Otherwise, please
"DATA",9002084.45,1,3,3,0)
     bring the your child to the clinic at the date and location given
"DATA",9002084.45,1,3,4,0)
     below:
"DATA",9002084.45,1,3,5,0)
 
"DATA",9002084.45,1,3,6,0)
     Current Next Appt: |BI NEXT APPOINTMENT|
"DATA",9002084.45,1,4,0)
^9002084.49^13^13^3050512^^^^
"DATA",9002084.45,1,4,1,0)
 
"DATA",9002084.45,1,4,2,0)
     Sincerely,
"DATA",9002084.45,1,4,3,0)
 
"DATA",9002084.45,1,4,4,0)
 
"DATA",9002084.45,1,4,5,0)
 
"DATA",9002084.45,1,4,6,0)
     Jack's Vax, LPN
"DATA",9002084.45,1,4,7,0)
     Drive-thru Immunization Program
"DATA",9002084.45,1,4,8,0)
     "You always get great service ...
"DATA",9002084.45,1,4,9,0)
              at the Sign of the Syringe!"
"DATA",9002084.45,1,4,10,0)
     
"DATA",9002084.45,1,4,11,0)
     phone: 777-7777
"DATA",9002084.45,1,4,12,0)
 
"DATA",9002084.45,1,4,13,0)
     printed: |BI NOW|        Case Manager: |BI CASE MANAGER|
"DATA",9002084.45,2,0)
Official Immunization Record^3^0^0^^0
"DATA",9002084.45,2,1,0)
^^13^13^3060914^
"DATA",9002084.45,2,1,1,0)
                              OFFICIAL IMMUNIZATION RECORD
"DATA",9002084.45,2,1,2,0)
                                 Jimmy's Immies Clinic
"DATA",9002084.45,2,1,3,0)
                                     7 Your Street
"DATA",9002084.45,2,1,4,0)
                                  Your City, ST  77777
"DATA",9002084.45,2,1,5,0)
     |BI TODAY|
"DATA",9002084.45,2,1,6,0)
                                   
"DATA",9002084.45,2,1,7,0)
     |BI NAME FIRST LAST|              Date of Birth: |BI DATE OF BIRTH|
"DATA",9002084.45,2,1,8,0)
     |BI MAILING ADD-STREET|                  Chart#: |BI CHART NUMBER|
"DATA",9002084.45,2,1,9,0)
     |BI MAILING ADD-STREET-2|
"DATA",9002084.45,2,1,10,0)
     |BI MAILING ADD-CITY STATE ZIP|
"DATA",9002084.45,2,1,11,0)
 
"DATA",9002084.45,2,1,12,0)
     Our records show that |BI NAME FIRST| has received the following
"DATA",9002084.45,2,1,13,0)
     immunizations:
"DATA",9002084.45,2,3,0)
^^2^2^3000606^^^^
"DATA",9002084.45,2,3,1,0)
     If you feel our records are not correct, please notify us so that
"DATA",9002084.45,2,3,2,0)
     we may make the corrections to update our records.  
"DATA",9002084.45,2,4,0)
^^6^6^3000606^^^^
"DATA",9002084.45,2,4,1,0)
     Sincerely,
"DATA",9002084.45,2,4,2,0)
 
"DATA",9002084.45,2,4,3,0)
     ____________________________   _________________________
"DATA",9002084.45,2,4,4,0)
       Name                            Title
"DATA",9002084.45,2,4,5,0)
     
"DATA",9002084.45,2,4,6,0)
     phone: 777-7777
"DATA",9002084.45,3,0)
Standard Due Letter, Inverted^1^1^1^^1
"DATA",9002084.45,3,1,0)
^^23^23^3060914^
"DATA",9002084.45,3,1,1,0)
 
"DATA",9002084.45,3,1,2,0)
                            Jimmy's Immies Clinic
"DATA",9002084.45,3,1,3,0)
                                7 Your Street
"DATA",9002084.45,3,1,4,0)
                             Your City, ST  77777
"DATA",9002084.45,3,1,5,0)
 
"DATA",9002084.45,3,1,6,0)
 
"DATA",9002084.45,3,1,7,0)
     |BI TODAY|
"DATA",9002084.45,3,1,8,0)
 
"DATA",9002084.45,3,1,9,0)
                                    Date of Birth: |BI DATE OF BIRTH|
"DATA",9002084.45,3,1,10,0)
                                           Chart#: |BI CHART NUMBER|
"DATA",9002084.45,3,1,11,0)
 
"DATA",9002084.45,3,1,12,0)
     |BI PARENT/GUARDIAN|
"DATA",9002084.45,3,1,13,0)
     |BI NAME FIRST LAST|
"DATA",9002084.45,3,1,14,0)
     |BI MAILING ADD-STREET|
"DATA",9002084.45,3,1,15,0)
     |BI MAILING ADD-STREET-2|
"DATA",9002084.45,3,1,16,0)
     |BI MAILING ADD-CITY STATE ZIP|
"DATA",9002084.45,3,1,17,0)
 
"DATA",9002084.45,3,1,18,0)
- -                                                                    - -
"DATA",9002084.45,3,1,19,0)
 
"DATA",9002084.45,3,1,20,0)
     Dear Parent or Guardian:
"DATA",9002084.45,3,1,21,0)
 
"DATA",9002084.45,3,1,22,0)
     Your child, |BI NAME FIRST|, is due for the immunizations listed 
"DATA",9002084.45,3,1,23,0)
     below:
"DATA",9002084.45,3,2,0)
^9002084.47^2^2^3050826^^^
"DATA",9002084.45,3,2,1,0)
     According to our records, |BI NAME FIRST| has already received the 
"DATA",9002084.45,3,2,2,0)
     following immunizations: 
"DATA",9002084.45,3,3,0)
^9002084.48^6^6^3050826^^^^
"DATA",9002084.45,3,3,1,0)
     If you feel our records are not correct, please notify us so that
"DATA",9002084.45,3,3,2,0)
     we may make the corrections to update our records.  Otherwise, please
"DATA",9002084.45,3,3,3,0)
     bring the your child to the clinic at the date and location given
"DATA",9002084.45,3,3,4,0)
     below:
"DATA",9002084.45,3,3,5,0)
 
"DATA",9002084.45,3,3,6,0)
     Current Next Appt: |BI NEXT APPOINTMENT|
"DATA",9002084.45,3,4,0)
^9002084.49^13^13^3050826^^^^
"DATA",9002084.45,3,4,1,0)
 
"DATA",9002084.45,3,4,2,0)
     Sincerely,
"DATA",9002084.45,3,4,3,0)
 
"DATA",9002084.45,3,4,4,0)
 
"DATA",9002084.45,3,4,5,0)
 
"DATA",9002084.45,3,4,6,0)
     Jack's Vax, LPN
"DATA",9002084.45,3,4,7,0)
     Drive-thru Immunization Program
"DATA",9002084.45,3,4,8,0)
     "You always get great service ...
"DATA",9002084.45,3,4,9,0)
              at the Sign of the Syringe!"
"DATA",9002084.45,3,4,10,0)
     
"DATA",9002084.45,3,4,11,0)
     phone: 777-7777
"DATA",9002084.45,3,4,12,0)
 
"DATA",9002084.45,3,4,13,0)
     printed: |BI NOW|        Case Manager: |BI CASE MANAGER|
"DATA",9002084.81,1,0)
Fever>104F^^1
"DATA",9002084.81,2,0)
Persistent Crying^^1
"DATA",9002084.81,3,0)
Lethargy/Hypotonic Episode^^1
"DATA",9002084.81,4,0)
Anaphylaxis^^1
"DATA",9002084.81,5,0)
Convulsion^^1
"DATA",9002084.81,6,0)
Immune Deficiency^^1
"DATA",9002084.81,7,0)
Immune Deficient Household^^0
"DATA",9002084.81,8,0)
Egg Allergy^^0
"DATA",9002084.81,9,0)
Neomycin Allergy^^1
"DATA",9002084.81,10,0)
Other Allergy^^1^1
"DATA",9002084.81,11,0)
Patient Refusal^1^1
"DATA",9002084.81,12,0)
Hx of Chicken Pox^^1
"DATA",9002084.81,13,0)
Reason not recorded^1^0
"DATA",9002084.81,14,0)
Immune^^1
"DATA",9002084.81,15,0)
Carrier^^1
"DATA",9002084.81,16,0)
Parent Refusal^1^1
"DATA",9002084.81,17,0)
Positive TB Skin Test^1^1^1
"DATA",9002084.81,18,0)
Vaccine Unavailable^1^1^0
"DATA",9002084.81,19,0)
GBS^^1
"DATA",9002084.81,20,0)
Anaphylactic Egg Allergy^^1
"DATA",9002084.91,1,0)
LASTNAME,FIRSTNAME MI^S Y=$$NAME~BIUTL1(BIDFN)^NAME^A
"DATA",9002084.91,2,0)
LASTNAME ONLY^S Y=$$NAME~BIUTL1(BIDFN,3)^NAME^A
"DATA",9002084.91,3,0)
FIRSTNAME ONLY^S Y=$$NAME~BIUTL1(BIDFN,2)^NAME^A
"DATA",9002084.91,4,0)
VACCINE NAME, SHORT^S Y=$$VNAME~BIUTL2($P(BI0,U))^VS^I
"DATA",9002084.91,5,0)
CHART#^S Y=$$HRCN~BIUTL1(BIDFN,DUZ(2))^HRCN^A
"DATA",9002084.91,6,0)
DOSE#^S Y=$P(BI0,U,4)^SERIES^I
"DATA",9002084.91,7,0)
DATE OF BIRTH (MM/DD/YYYY)^S Y=$$DOB~BIUTL1(BIDFN),Y=$$SLDT2~BIUTL5(Y)^DOB^A
"DATA",9002084.91,8,0)
VACCINE COMPONENT IENS^ S Y=$$VCOMPS~BIUTL2($P(BI0,U))^COMPS^I
"DATA",9002084.91,9,0)
VACCINE NAME, LONG^S Y=$$VNAME~BIUTL2($P(BI0,U),1)^VL^I
"DATA",9002084.91,10,0)
SEX^S Y=$$SEX~BIUTL1(BIDFN)^^A
"DATA",9002084.91,11,0)
AGE IN MONTHS (TODAY)^S Y=$$AGE~BIUTL1(BIDFN,2)^AM^A
"DATA",9002084.91,12,0)
AGE IN YEARS (TODAY)^S Y=$$AGE~BIUTL1(BIDFN,1)^AY^A
"DATA",9002084.91,13,0)
SSN#^S Y=$$SSN~BIUTL1(BIDFN)^SOC^A
"DATA",9002084.91,14,0)
CHART# (NO DASHES)^S Y=$$HRCN~BIUTL1(BIDFN,DUZ(2),1)^HRCN^A
"DATA",9002084.91,15,0)
PHONE, HOME^S Y=$$HPHONE~BIUTL1(BIDFN)^HOME^A
"DATA",9002084.91,16,0)
ADDRESS-STREET^S Y=$$STREET~BIUTL1(BIDFN)^ADD^A
"DATA",9002084.91,17,0)
ADDRESS-CITY^S Y=$$CITY~BIUTL1(BIDFN)^ADDC^A
"DATA",9002084.91,18,0)
ADDRESS-STATE^S Y=$$STATE~BIUTL1(BIDFN)^ADDS^A
"DATA",9002084.91,19,0)
ADDRESS-ZIP^S Y=$$ZIP~BIUTL1(BIDFN)^ADDZ^A
"DATA",9002084.91,20,0)
CURRENT COMMUNITY IEN^S Y=$$CURCOM~BIUTL11(BIDFN)^COMM^A
"DATA",9002084.91,21,0)
DATE OF VISIT (MM/DD/YYYY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$SLDT2~BIUTL5(Y)^DOV^A
"DATA",9002084.91,23,0)
DATE OF VISIT IMM/SERV (MMDDYYYY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$NOSLDT~BIUTL5(Y)^DOV^A
"DATA",9002084.91,24,0)
V FILE IEN^S Y=BIVIEN^VISIT^A
"DATA",9002084.91,25,0)
VACCINE CODE, HL7-CVX^S Y=$$CODE~BIUTL2($P(BI0,U))^HL7^I
"DATA",9002084.91,26,0)
LOCATION OF VISIT IHS/OTHER (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1)^VISIT^A
"DATA",9002084.91,27,0)
VACCINE GRP NAME (SERIES TYPE)^S Y=$$IMMVG~BIUTL2($P(BI0,U),1)^GROUP^I
"DATA",9002084.91,28,0)
DATE OF BIRTH (DD-Mmm-YYYY)^S Y=$$DOB~BIUTL1(BIDFN),Y=$$TXDT1~BIUTL5(Y)^DOB^A
"DATA",9002084.91,29,0)
DATE OF VISIT (DD-Mmm-YYYY @HHMM)^S Y=$$IMMDTT~BIUTL6(BIVPTR,,1)^DOV^A
"DATA",9002084.91,30,0)
VACCINE NAME, IEN^S Y=$P(BI0,U)^VIEN^I
"DATA",9002084.91,31,0)
VACCINE MAXIMUM DOSE#^S Y=$$VMAX~BIUTL2($P(BI0,U))^MAXIM^I
"DATA",9002084.91,32,0)
VACCINE LOT NUMBER, IEN^S Y=$P(BI0,U,5)^LOT^I
"DATA",9002084.91,33,0)
VACCINE LOT NUMBER, TEXT^S Y=$P(BI0,U,5) S:+Y Y=$P($G(~AUTTIML($P(BI0,U,5),0)),U)^LOT^I
"DATA",9002084.91,34,0)
LOCATION IEN^S Y=$P(~AUPNVSIT(BIVPTR,0),U,6)^IEN^A
"DATA",9002084.91,35,0)
CATEGORY OF VISIT^S Y=$P(~AUPNVSIT(BIVPTR,0),U,7)^VISIT^A
"DATA",9002084.91,36,0)
LOCATION OF VISIT OTHER (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1,2)^OTHER^A
"DATA",9002084.91,37,0)
LOCATION OF VISIT IHS (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1,1)^VISIT^A
"DATA",9002084.91,38,0)
SKIN TEST RESULT^S Y=$$SKRESLT~BIUTL6($P(BI0,U,4))^RES^S
"DATA",9002084.91,39,0)
SKIN TEST READING^S Y=$P(BI0,U,5)^READ^S
"DATA",9002084.91,40,0)
SKIN TEST DATE READ (MM/DD/YY)^S Y=$$SLDT2~BIUTL5($P(BI0,U,6),1)^DATE^S
"DATA",9002084.91,41,0)
SKIN TEST NAME^S Y=$$SKNAME~BIUTL6($P(BI0,U))^TEST^S
"DATA",9002084.91,42,0)
SKIN TEST NAME IEN^S Y=$P(BI0,U)^TEST^S
"DATA",9002084.91,43,0)
VACCINE REACTION, IEN^S Y=$P(BI0,U,6)^VRX^I
"DATA",9002084.91,44,0)
VACCINE REACTION, TEXT^S Y=$$REACTXT~BIUTL6($P(BI0,U,6))^VRT^I
"DATA",9002084.91,45,0)
MOTHER'S HBSAG STATUS^S Y=$$MOTHER~BIUTL11(BIDFN,1)^HB^A
"DATA",9002084.91,46,0)
PARENT OR GUARDIAN^S Y=$$PARENT~BIUTL1(BIDFN)^GUARD^A
"DATA",9002084.91,47,0)
CASE MANAGER^S Y=$$CMGR~BIUTL1(BIDFN)^^A
"DATA",9002084.91,48,0)
DATE INACTIVE (DD-Mmm-YYYY)^S Y=$$TXDT1~BIUTL5($$INACT~BIUTL1(BIDFN))^INACT^A
"DATA",9002084.91,49,0)
VACCINE INFO STMT (1=YES, 2=NO)^S Y=$P(BI0,U,11)^VIS^I
"DATA",9002084.91,50,0)
VAC INFO STMT DATE FM (YYYMMDD)^S Y=$P(BI0,U,12)^VISD^I
"DATA",9002084.91,51,0)
VAC INFO STMT DATE (DD-Mmm-YYYY)^S Y=$P(BI0,U,12),Y=$$TXDT1~BIUTL5(Y)^VISD^I
"DATA",9002084.91,52,0)
VACCINE CODE, CPT^S Y=$$CODE~BIUTL2($P(BI0,U),2)^CPT^I
"DATA",9002084.91,55,0)
VACCINE GRP IEN (SERIES TYPE)^S Y=$$IMMVG~BIUTL2($P(BI0,U),2)^GROUP^I
"DATA",9002084.91,56,0)
DATE OF VISIT FILEMAN (YYYMMDD)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),".")^DOVF^A
"DATA",9002084.91,57,0)
AGE AT VISIT^S Y=$$AGEF~BIUTL1(BIDFN,$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."))^AV^A
"DATA",9002084.91,58,0)
PATIENT DFN^S Y=BIDFN^DFN^A
"DATA",9002084.91,59,0)
VISIT, PPC TYPE^S Y=$P(~AUPNVSIT(+BIVPTR,0),U,3)^TYPE^A
"DATA",9002084.91,60,0)
DATE OF VISIT (DD-Mmm-YYYY)^S Y=$P($G(~AUPNVSIT(+BIVPTR,0)),U),Y=$$TXDT1~BIUTL5(Y)^DOV^A
"DATA",9002084.91,61,0)
PROVIDER, ENCOUNTER IEN^S Y=$P(BI012,U,4)^^A
"DATA",9002084.91,62,0)
CURRENT COMMUNITY TEXT^S Y=$$CURCOM~BIUTL11(BIDFN,1)^COMM^A
"DATA",9002084.91,63,0)
MOTHER'S MAIDEN NAME^S Y=$$MOTHMAID~BIUTL11(BIDFN)^MAIDEN^A
"DATA",9002084.91,64,0)
PATIENT BENEFICIARY TYPE^S Y=$$BENTYP~BIUTL11(BIDFN,1)^BENEFI^A
"DATA",9002084.91,65,0)
DOSE OVERRIDE^S Y=$P(BI0,U,8)^OVRD^I
"DATA",9002084.91,66,0)
DATE OF VISIT YY (MM/DD/YY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$SLDT2~BIUTL5(Y,1)^DOVYY^A
"DATA",9002084.91,67,0)
INJECTION SITE^S Y=$P(BI0,U,9)^IS^A
"DATA",9002084.91,68,0)
VOLUME^S Y=$P(BI0,U,11)^^A
"DATA",9002084.91,69,0)
VACCINE COMPONENT CVX CODE^S Y=$$CODE~BIUTL2($P(BI0,U))^COMP^I
"DATA",9002084.91,70,0)
SKIN TEST READER^S Y=$P(BI0,U,8)^READER^S
"DATA",9002084.91,71,0)
REASON INACTIVE^S Y=$$INACTRE~BIUTL1(BIDFN)^INACT^A
"DATA",9002084.91,72,0)
LOCATION MOVED OR TX ELSEWHERE^S Y=$$MOVEDLOC~BIUTL1(BIDFN)^MOVED^A
"DATA",9002084.91,73,0)
VACCINE CODE, HL7-CVX LEADING ZERO^S Y=$$CODE~BIUTL2($P(BI0,U),6)^HL70^I
"DATA",9002084.91,74,0)
CPT-CODED VISIT^S Y=$P(BI0,U,13)^CPTC^I
"DATA",9002084.91,75,0)
PROVIDER, NAME^S Y=$P(BI012,U,4) S:Y Y=$P($G(~VA(200,Y,0)),U)^^A
"DATA",9002084.91,76,0)
VISIT IEN^S Y=$P(BI0,U,3)^VIEN^A
"DATA",9002084.91,77,0)
ELIG CODE, IEN^S Y=$P(BI0,U,14)^VFC^I
"DATA",9002084.91,78,0)
IMPORTED FROM OUTSIDE REGISTRY^S Y=$P(BI0,U,15)^IMPORT^I
"DATA",9002084.91,79,0)
CONSENT STATE REGISTRY^S Y=$$CONSENT~BIUTL1(BIDFN)^CONS^A
"DATA",9002084.91,80,0)
NDC CODE, IEN^S Y=$P(BI0,U,16)^NDCPTR^I
"DATA",9002084.91,82,0)
ELIG CODE, TEXT^S Y=$$ELIGC~BIELIG($P(BI0,U,14),1)^ELIGTX^I
"DATA",9002084.91,83,0)
ELIG CODE, LABEL^S Y=$$ELIGC~BIELIG($P(BI0,U,14),2)^ELIGLB^I
"DATA",9002084.91,84,0)
NDC CODE, TEXT^S Y=$$NDC~BINDC($P(BI0,U,16),1)^NDCTXT^I
"DATA",9002084.91,85,0)
DATE OF EVENT OR VISIT (MM/DD/YY)^S Y=$$IMMDTT~BIUTL6(BIVPTR,$G(BI012))^DATEVT^A
"DATA",9002084.91,86,0)
DATE OF EVENT OR VISIT (YYYMMDD)^S Y=$$IMMDTT~BIUTL6(BIVPTR,$G(BI012),2)^DOEVFM^A
"DATA",9002084.91,87,0)
ADMINISTRATIVE NOTE^S Y=$P(BI01,U,1)^BIANOT^A
"DATA",9002084.91,88,0)
DATE OF VISIT TCH (YYYYMMDD)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$FMTCHDT~BIUTL5(Y)^DOVTCH^A
"DATA",9002084.91,89,0)
DATE VIS PRESENTED FM (YYYMMDD)^S Y=$P(BI0,U,17)^DATVIS^I
"DATA",9002084.91,90,0)
DATE VIS PRESENTED (MM/DD/YY)^I $P(BI0,U,17) S Y=$$SLDT2~BIUTL5($P(BI0,U,17))^DTVISL^I
"DATA",9002084.91,91,0)
DATE ADMIN SHOT--EVENT ONLY^S Y=$$IMMDTT~BIUTL6(,$G(BI012))^DADMIN^I
"DATA",9002084.93,1,0)
DTORP^1^DTaP^4^1^1^^1
"DATA",9002084.93,2,0)
OORIPV^3^POLIO^3^1^1^^1
"DATA",9002084.93,3,0)
HIB^4^HIB^4^1^1^^1
"DATA",9002084.93,4,0)
HEPB^6^HEPB^3^1^1^3^1
"DATA",9002084.93,5,0)
HBIG^5^HBIG^^1^0^^0
"DATA",9002084.93,6,0)
MMRORME^7^MMR^1^1^1^2^1
"DATA",9002084.93,7,0)
VAR^8^VAR^1^1^1^2^1
"DATA",9002084.93,8,0)
TD_B^2^TD_B^^1^1^1^0
"DATA",9002084.93,9,0)
HEPA^9^HEPA^2^1^1^2^1
"DATA",9002084.93,10,0)
FLU^10^FLU^4^1^1^1^1
"DATA",9002084.93,11,0)
PNEUMO^12^PCV^4^1^1^^1
"DATA",9002084.93,12,0)
OTHER^90^OTHER^^1^0^^0
"DATA",9002084.93,13,0)
SKIN TEST^99^SKIN^^0^0^^0
"DATA",9002084.93,14,0)
COMBO^95^COMBO^^0^0^^0
"DATA",9002084.93,15,0)
ROTAVIRUS^85^ROTA^3^1^1^^1
"DATA",9002084.93,16,0)
MENING^15^MEN^^1^1^1^0
"DATA",9002084.93,17,0)
HPV^18^HPV^^1^1^3
"DATA",9002084.93,18,0)
H1N1^11^H1N1^2^0^1^2^1
"FIA",9002084)
BI PATIENT
"FIA",9002084,0)
^BIP(
"FIA",9002084,0,0)
9002084PO
"FIA",9002084,0,1)
y^y^f^^^^n
"FIA",9002084,0,10)

"FIA",9002084,0,11)

"FIA",9002084,0,"RLRO")

"FIA",9002084,0,"VR")
10.0^BIV
"FIA",9002084,9002084)
0
"FIA",9002084,9002084.03)
0
"FIA",9002084.01)
BI CASE MANAGER
"FIA",9002084.01,0)
^BIMGR(
"FIA",9002084.01,0,0)
9002084.01P
"FIA",9002084.01,0,1)
y^y^f^^^^n
"FIA",9002084.01,0,10)

"FIA",9002084.01,0,11)

"FIA",9002084.01,0,"RLRO")

"FIA",9002084.01,0,"VR")
10.0^BIV
"FIA",9002084.01,9002084.01)
0
"FIA",9002084.02)
BI SITE PARAMETER
"FIA",9002084.02,0)
^BISITE(
"FIA",9002084.02,0,0)
9002084.02P
"FIA",9002084.02,0,1)
y^y^f^^^^n
"FIA",9002084.02,0,10)

"FIA",9002084.02,0,11)

"FIA",9002084.02,0,"RLRO")

"FIA",9002084.02,0,"VR")
10.0^BIV
"FIA",9002084.02,9002084.02)
0
"FIA",9002084.02,9002084.02920001)
0
"FIA",9002084.02,9002084.04)
0
"FIA",9002084.1)
BI PATIENT IMMUNIZATIONS DUE
"FIA",9002084.1,0)
^BIPDUE(
"FIA",9002084.1,0,0)
9002084.1P
"FIA",9002084.1,0,1)
y^y^f^^^^n
"FIA",9002084.1,0,10)

"FIA",9002084.1,0,11)

"FIA",9002084.1,0,"RLRO")

"FIA",9002084.1,0,"VR")
10.0^BIV
"FIA",9002084.1,9002084.1)
0
"FIA",9002084.11)
BI PATIENT CONTRAINDICATIONS
"FIA",9002084.11,0)
^BIPC(
"FIA",9002084.11,0,0)
9002084.11PI
"FIA",9002084.11,0,1)
y^y^f^^^^n
"FIA",9002084.11,0,10)

"FIA",9002084.11,0,11)

"FIA",9002084.11,0,"RLRO")

"FIA",9002084.11,0,"VR")
10.0^BIV
"FIA",9002084.11,9002084.11)
0
"FIA",9002084.11,9002084.111)
0
"FIA",9002084.115)
BI PATIENT CONTRAINDICATIONS DELETED
"FIA",9002084.115,0)
^BIPCD(
"FIA",9002084.115,0,0)
9002084.115PI
"FIA",9002084.115,0,1)
y^y^f^^^^n
"FIA",9002084.115,0,10)

"FIA",9002084.115,0,11)

"FIA",9002084.115,0,"RLRO")

"FIA",9002084.115,0,"VR")
10.0^BIV
"FIA",9002084.115,9002084.115)
0
"FIA",9002084.12)
BI PATIENT FORECAST ERRORS
"FIA",9002084.12,0)
^BIPERR(
"FIA",9002084.12,0,0)
9002084.12P
"FIA",9002084.12,0,1)
y^y^f^^^^n
"FIA",9002084.12,0,10)

"FIA",9002084.12,0,11)

"FIA",9002084.12,0,"RLRO")

"FIA",9002084.12,0,"VR")
10.0^BIV
"FIA",9002084.12,9002084.12)
0
"FIA",9002084.33)
BI TABLE ERROR CODE
"FIA",9002084.33,0)
^BIERR(
"FIA",9002084.33,0,0)
9002084.33I
"FIA",9002084.33,0,1)
y^y^f^^n^^y^o^n
"FIA",9002084.33,0,10)

"FIA",9002084.33,0,11)

"FIA",9002084.33,0,"RLRO")

"FIA",9002084.33,0,"VR")
10.0^BIV
"FIA",9002084.33,9002084.33)
0
"FIA",9002084.4)
BI LETTER
"FIA",9002084.4,0)
^BILET(
"FIA",9002084.4,0,0)
9002084.4
"FIA",9002084.4,0,1)
y^y^f^^^^n
"FIA",9002084.4,0,10)

"FIA",9002084.4,0,11)

"FIA",9002084.4,0,"RLRO")

"FIA",9002084.4,0,"VR")
10.0^BIV
"FIA",9002084.4,9002084.4)
0
"FIA",9002084.4,9002084.41)
0
"FIA",9002084.4,9002084.42)
0
"FIA",9002084.4,9002084.43)
0
"FIA",9002084.4,9002084.44)
0
"FIA",9002084.45)
BI LETTER SAMPLE
"FIA",9002084.45,0)
^BILETS(
"FIA",9002084.45,0,0)
9002084.45
"FIA",9002084.45,0,1)
y^y^f^^n^^y^o^n
"FIA",9002084.45,0,10)

"FIA",9002084.45,0,11)

"FIA",9002084.45,0,"RLRO")

"FIA",9002084.45,0,"VR")
10.0^BIV
"FIA",9002084.45,9002084.45)
0
"FIA",9002084.45,9002084.46)
0
"FIA",9002084.45,9002084.47)
0
"FIA",9002084.45,9002084.48)
0
"FIA",9002084.45,9002084.49)
0
"FIA",9002084.81)
BI TABLE CONTRA REASON
"FIA",9002084.81,0)
^BICONT(
"FIA",9002084.81,0,0)
9002084.81
"FIA",9002084.81,0,1)
y^y^f^^n^^y^o^n
"FIA",9002084.81,0,10)

"FIA",9002084.81,0,11)

"FIA",9002084.81,0,"RLRO")

"FIA",9002084.81,0,"VR")
10.0^BIV
"FIA",9002084.81,9002084.81)
0
"FIA",9002084.91)
BI TABLE DATA ELEMENT
"FIA",9002084.91,0)
^BIEXPDD(
"FIA",9002084.91,0,0)
9002084.91I
"FIA",9002084.91,0,1)
y^y^f^^n^^y^o^n
"FIA",9002084.91,0,10)

"FIA",9002084.91,0,11)

"FIA",9002084.91,0,"RLRO")

"FIA",9002084.91,0,"VR")
10.0^BIV
"FIA",9002084.91,9002084.91)
0
"FIA",9002084.93)
BI TABLE VACCINE GROUP (SERIES TYPE)
"FIA",9002084.93,0)
^BISERT(
"FIA",9002084.93,0,0)
9002084.93
"FIA",9002084.93,0,1)
y^y^f^^n^^y^o^n
"FIA",9002084.93,0,10)

"FIA",9002084.93,0,11)

"FIA",9002084.93,0,"RLRO")

"FIA",9002084.93,0,"VR")
10.0^BIV
"FIA",9002084.93,9002084.93)
0
"INIT")
POSTVIST^PXVBIVD
"KRN",.403,128,-1)
0^1
"KRN",.403,128,0)
BI FORM-LOT NUMBER EDIT^@^@^^3080819.2133^^^9999999.41^0^1^1
"KRN",.403,128,40,0)
^.4031I^6^6
"KRN",.403,128,40,1,0)
1^^1,1
"KRN",.403,128,40,1,1)
Page 1
"KRN",.403,128,40,1,40,0)
^.4032IP^480^2
"KRN",.403,128,40,1,40,479,0)
BI BLK-LOT NUMBER HEADER^1^1,1^d
"KRN",.403,128,40,1,40,480,0)
BI BLK-LOT NUMBER EDIT^2^5,1^e
"KRN",.403,128,40,2,0)
2^^8,6^^^1^12,71
"KRN",.403,128,40,2,1)
BI PAGE-INVENTORY OFF
"KRN",.403,128,40,2,40,0)
^.4032IP^481^1
"KRN",.403,128,40,2,40,481,0)
BI BLK-INVENTORY OFF^1^1,1^d
"KRN",.403,128,40,3,0)
3^^8,4^^^1^16,77
"KRN",.403,128,40,3,1)
BI PAGE-CHANGE LOT WARNING
"KRN",.403,128,40,3,40,0)
^.4032IP^482^1
"KRN",.403,128,40,3,40,482,0)
BI BLK-CHANGE LOT WARNING^1^3,4^d
"KRN",.403,128,40,4,0)
4^^2,3^^^1^15,77
"KRN",.403,128,40,4,1)
BI PAGE-FACILITY CAUTION
"KRN",.403,128,40,4,40,0)
^.4032IP^483^1
"KRN",.403,128,40,4,40,483,0)
BI BLK-FACILITY CAUTION^1^3,3^d
"KRN",.403,128,40,5,0)
5^^9,10^^^1^14,70
"KRN",.403,128,40,5,1)
BI PAGE-INACTIVE VACCINE
"KRN",.403,128,40,5,40,0)
^.4032IP^484^1
"KRN",.403,128,40,5,40,484,0)
BI BLK-INACTIVE VACCINE^1^2,3^d
"KRN",.403,128,40,6,0)
6^^8,7^^^1^17,75
"KRN",.403,128,40,6,1)
BI PAGE-LOT DUPLICATE WARNING
"KRN",.403,128,40,6,40,0)
^.4032IP^485^1
"KRN",.403,128,40,6,40,485,0)
BI BLK-LOT DUPLICATE WARNING^1^1,1^d
"KRN",.403,129,-1)
0^2
"KRN",.403,129,0)
BI FORM-IMM VISIT ADD/EDIT^@^@^^2980101.1522^^^9000001^0^1^1
"KRN",.403,129,12)

"KRN",.403,129,14)

"KRN",.403,129,40,0)
^.4031I^7^5
"KRN",.403,129,40,1,0)
1^^1,1
"KRN",.403,129,40,1,1)
Page 1
"KRN",.403,129,40,1,40,0)
^.4032IP^487^2
"KRN",.403,129,40,1,40,486,0)
BI BLK-IMM VISIT HEADER^1^1,1^d
"KRN",.403,129,40,1,40,487,0)
BI BLK-IMM VISIT ADD/EDIT^2^7,1^e
"KRN",.403,129,40,4,0)
2^^13,12^^^1^17,67
"KRN",.403,129,40,4,1)
BI PAGE-LOT EXPIRED
"KRN",.403,129,40,4,40,0)
^.4032IP^488^1
"KRN",.403,129,40,4,40,488,0)
BI BLK-IMM VISIT LOT EXPIRED^1^2,2^d
"KRN",.403,129,40,5,0)
3^^13,18^^^1^17,63
"KRN",.403,129,40,5,1)
BI PAGE-LOW SUPPLY ALERT
"KRN",.403,129,40,5,40,0)
^.4032IP^489^1
"KRN",.403,129,40,5,40,489,0)
BI BLK-LOT LOW SUPPLY^1^2,2^d
"KRN",.403,129,40,6,0)
4^^13,6^^^1^17,75
"KRN",.403,129,40,6,1)
BI PAGE-EXPIRED AND LOW
"KRN",.403,129,40,6,40,0)
^.4032IP^490^1
"KRN",.403,129,40,6,40,490,0)
BI BLK-EXPIRED AND LOW^1^2,2^d
"KRN",.403,129,40,7,0)
5^^12,6^^^1^16,73
"KRN",.403,129,40,7,1)
BI PAGE-LOCATION NAME TOO LONG
"KRN",.403,129,40,7,40,0)
^.4032IP^491^1
"KRN",.403,129,40,7,40,491,0)
BI BLK-OUTSIDE LOC TOO LONG^1^2,4^d
"KRN",.403,130,-1)
0^3
"KRN",.403,130,0)
BI FORM-CONTRAIND ADD/EDIT^@^@^^2980101.1522^^^9000001^0^1^1
"KRN",.403,130,14)

"KRN",.403,130,40,0)
^.4031I^1^1
"KRN",.403,130,40,1,0)
1^^1,1
"KRN",.403,130,40,1,1)
Page 1
"KRN",.403,130,40,1,40,0)
^.4032IP^493^2
"KRN",.403,130,40,1,40,492,0)
BI BLK-CONTRAINDICATION HEADER^1^1,1^d
"KRN",.403,130,40,1,40,493,0)
BI BLK-CONTRAINDICATION ADD^2^7,1^e
"KRN",.403,131,-1)
0^4
"KRN",.403,131,0)
BI FORM-CASE DATA EDIT^@^@^^2980217.1451^^^9002084^0^1^1
"KRN",.403,131,14)
D SAVCAS^BIUTL7
"KRN",.403,131,40,0)
^.4031I^1^1
"KRN",.403,131,40,1,0)
1^^1,1
"KRN",.403,131,40,1,1)
Page 1
"KRN",.403,131,40,1,40,0)
^.4032IP^495^2
"KRN",.403,131,40,1,40,494,0)
BI BLK-CASE DATA HEADER^1^1,1^d
"KRN",.403,131,40,1,40,495,0)
BI BLK-CASE DATE EDIT^2^8,1^e
"KRN",.403,132,-1)
0^5
"KRN",.403,132,0)
BI FORM-SKIN VISIT ADD/EDIT^@^@^^2980101.1522^^^9000001^0^1^1
"KRN",.403,132,14)

"KRN",.403,132,40,0)
^.4031I^2^2
"KRN",.403,132,40,1,0)
1^^1,1
"KRN",.403,132,40,1,1)
Page 1
"KRN",.403,132,40,1,40,0)
^.4032IP^497^2
"KRN",.403,132,40,1,40,496,0)
BI BLK-SKIN VISIT HEADER^1^1,1^d
"KRN",.403,132,40,1,40,497,0)
BI BLK-SKIN VISIT ADD/EDIT^2^7,1^e
"KRN",.403,132,40,2,0)
2^^12,6^^^1^16,73
"KRN",.403,132,40,2,1)
BI PAGE-LOCATION NAME TOO LONG
"KRN",.403,132,40,2,40,0)
^.4032IP^491^1
"KRN",.403,132,40,2,40,491,0)
BI BLK-OUTSIDE LOC TOO LONG^1^2,4^e
"KRN",.404,479,0)
BI BLK-LOT NUMBER HEADER^9999999.41^
"KRN",.404,479,40,0)
^.4044I^5^4
"KRN",.404,479,40,1,0)
1^!M^1
"KRN",.404,479,40,1,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,479,40,1,2)
^^2,2
"KRN",.404,479,40,2,0)
2^!M^1
"KRN",.404,479,40,2,.1)
S Y="* * *  "_$S($G(BINEW):"ADD",1:"EDIT")_" A LOT NUMBER  * * *"
"KRN",.404,479,40,2,2)
^^2,25
"KRN",.404,479,40,3,0)
3^!M^1
"KRN",.404,479,40,3,.1)
S Y=IOINORM_"Lot Number: "_IORVON_" "_$$LOTTX^BIUTL6($G(BILOT))_" "_IOINORM
"KRN",.404,479,40,3,2)
^^4,7
"KRN",.404,479,40,5,0)
10^_______________________________________________________________________________^1
"KRN",.404,479,40,5,2)
^^5,1
"KRN",.404,480,0)
BI BLK-LOT NUMBER EDIT^9999999.41
"KRN",.404,480,11)
D LOADLOT^BILOT1
"KRN",.404,480,40,0)
^.4044I^15^15
"KRN",.404,480,40,1,0)
1^Lot Number^2
"KRN",.404,480,40,1,2)
3,15^20^3,3
"KRN",.404,480,40,1,4)
1
"KRN",.404,480,40,1,10)
I '$G(BINEW),X'=DDSOLD S DDSSTACK="BI PAGE-CHANGE LOT WARNING"
"KRN",.404,480,40,1,11)
D HLP^DDSUTL("Enter/edit the Lot Number.")
"KRN",.404,480,40,1,12)
S BI("A")=X
"KRN",.404,480,40,1,13)
I '$G(BINEW) D HLP^DDSUTL("NOTE! Changing the text of an existing Lot Number should be done with caution, as it affects existing historical data.")
"KRN",.404,480,40,1,14)
D LOTDVAL^BILOT2(X)
"KRN",.404,480,40,1,20)
F^^3:20
"KRN",.404,480,40,1,21,0)
^^3^3^3110708^^^
"KRN",.404,480,40,1,21,1,0)
Enter the Lot Number.  NOTE! Changing the text of an existing Lot Number
"KRN",.404,480,40,1,21,2,0)
should be done with extreme caution.  Existing prior patient data that
"KRN",.404,480,40,1,21,3,0)
used this Lot Number will reflect the change.
"KRN",.404,480,40,2,0)
2^Vaccine^2
"KRN",.404,480,40,2,2)
3,47^33^3,38
"KRN",.404,480,40,2,4)
1^^^1
"KRN",.404,480,40,2,10)
D VACINA1^BILOT1
"KRN",.404,480,40,2,11)
D HLP^DDSUTL("Select the Vaccine that corresponds to this Lot Number.")
"KRN",.404,480,40,2,13)
S BI("B")=X D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(X)_")")
"KRN",.404,480,40,2,20)
P^^9999999.14:QEM
"KRN",.404,480,40,2,21,0)
^^4^4^3080828^^^
"KRN",.404,480,40,2,21,1,0)
Select the vaccine for this Lot Number.  NOTE: Once the vaccine for a new 
"KRN",.404,480,40,2,21,2,0)
Lot Number has been entered and that Lot Number has been saved, the 
"KRN",.404,480,40,2,21,3,0)
Vaccine field will no longer be editable.  (Such a change would render 
"KRN",.404,480,40,2,21,4,0)
historical data using that Lot Number inaccurate.)
"KRN",.404,480,40,3,0)
2.5^^2
"KRN",.404,480,40,3,2)
4,47^12
"KRN",.404,480,40,3,4)
0^^^1
"KRN",.404,480,40,3,20)
F
"KRN",.404,480,40,4,0)
3^Status^2
"KRN",.404,480,40,4,2)
6,20^8^6,12
"KRN",.404,480,40,4,11)
D VACINA2^BILOT1
"KRN",.404,480,40,4,12)
S BI("C")=X
"KRN",.404,480,40,4,20)
S^^0:Active;1:Inactive
"KRN",.404,480,40,4,21,0)
^^4^4^3080821^
"KRN",.404,480,40,4,21,1,0)
Enter 0 or "A" if this Lot Number should be active (used in entering
"KRN",.404,480,40,4,21,2,0)
immunization data).  Enter 1 or "I" if it should be Inactive.
"KRN",.404,480,40,4,21,3,0)
Note: If you make a Lot Number Inactive, users will be unable to select
"KRN",.404,480,40,4,21,4,0)
it when entering Immunization Visits with a Category of "Ambulatory."
"KRN",.404,480,40,5,0)
4^Expiration Date^2
"KRN",.404,480,40,5,2)
7,20^11^7,3
"KRN",.404,480,40,5,11)
D HLP^DDSUTL("Enter the date on which this Lot Number expires.")
"KRN",.404,480,40,5,12)
S BI("D")=X
"KRN",.404,480,40,5,20)
D
"KRN",.404,480,40,5,21,0)
^^1^1^3080820^
"KRN",.404,480,40,5,21,1,0)
Enter the date on which this Lot Number expires.
"KRN",.404,480,40,6,0)
5^Starting Count^2
"KRN",.404,480,40,6,2)
10,20^5^10,4
"KRN",.404,480,40,6,4)
^^0
"KRN",.404,480,40,6,10)
I X<$G(BI("F")) D INVOFF^BILOT1(1)
"KRN",.404,480,40,6,11)
D HLP^DDSUTL("Enter the Starting Count for this Lot.  This is for inventory purposes.")
"KRN",.404,480,40,6,12)
S:(X'<$G(BI("F"))) BI("E")=X D CALCDOS^BILOT1($G(BI("E")),$G(BI("F")))
"KRN",.404,480,40,6,13)
I $G(BI("F"))="" S BI("F")=X D PUT^DDSVALF(6,,,BI("F"),"I")
"KRN",.404,480,40,6,20)
N^^1:99999
"KRN",.404,480,40,6,21,0)
^^3^3^3080820^
"KRN",.404,480,40,6,21,1,0)
Enter the Starting Count (number of doses) for this Lot Number.  This is 
"KRN",.404,480,40,6,21,2,0)
for inventory purposes.  It is the initial total number of doses that the
"KRN",.404,480,40,6,21,3,0)
facility/clinic received from the manufacturer.
"KRN",.404,480,40,7,0)
6^Doses Unused^2
"KRN",.404,480,40,7,2)
10,42^5^10,28
"KRN",.404,480,40,7,4)
^^0
"KRN",.404,480,40,7,10)
I X>$G(BI("E")) D INVOFF^BILOT1(2)
"KRN",.404,480,40,7,11)
D HLP^DDSUTL("Enter or correct the number of doses of this Lot that are remaining (sitting on the shelf unused.)")
"KRN",.404,480,40,7,12)
S:(X'>$G(BI("E"))) BI("F")=X D CALCDOS^BILOT1($G(BI("E")),$G(BI("F")))
"KRN",.404,480,40,7,20)
N^^0:99999
"KRN",.404,480,40,7,21,0)
^^2^2^3080820^^
"KRN",.404,480,40,7,21,1,0)
Enter or correct the number of doses of this Lot that are remaining 
"KRN",.404,480,40,7,21,2,0)
(sitting on the shelf unused.)
"KRN",.404,480,40,8,0)
7^Low Supply Alert^2
"KRN",.404,480,40,8,2)
11,20^5^11,2
"KRN",.404,480,40,8,4)
^^0
"KRN",.404,480,40,8,11)
D HLP^DDSUTL("Enter the number of remaining doses (Number Unused) that will trigger a Low Supply Alert.")
"KRN",.404,480,40,8,12)
S BI("G")=X
"KRN",.404,480,40,8,20)
N^^0:9999
"KRN",.404,480,40,8,21,0)
^^3^3^3080820^
"KRN",.404,480,40,8,21,1,0)
Enter the number of doses remaining that will trigger a Low Supply Alert 
"KRN",.404,480,40,8,21,2,0)
for this Lot during data entry of immunizations.  Type a number between 0 
"KRN",.404,480,40,8,21,3,0)
and 9999.
"KRN",.404,480,40,9,0)
10^Manufacturer^2
"KRN",.404,480,40,9,2)
6,47^30^6,33
"KRN",.404,480,40,9,4)
1
"KRN",.404,480,40,9,10)
I $G(BINEW(1)) S DDSBR=3 K BINEW(1)
"KRN",.404,480,40,9,11)
D HLP^DDSUTL("Select the Manufacturer for this Lot Number.  NOTE: This is a required field; you must select a manufacturer.")
"KRN",.404,480,40,9,12)
S BI("M")=X
"KRN",.404,480,40,9,20)
P^^9999999.04:QEM
"KRN",.404,480,40,9,21,0)
^^1^1^3120911^^
"KRN",.404,480,40,9,21,1,0)
Select the Manufacturer for this Lot Number.
"KRN",.404,480,40,9,24)
S DIR("S")="I $P(^AUTTIMAN(Y,0),U,3)=$S($$RPMS^BIUTL9():1,1:0)"
"KRN",.404,480,40,10,0)
8^Doses Used^2
"KRN",.404,480,40,10,2)
10,62^5^10,50
"KRN",.404,480,40,10,4)
^^0^1
"KRN",.404,480,40,10,20)
N^^0:99999
"KRN",.404,480,40,11,0)
8.5^(calculated)^1
"KRN",.404,480,40,11,2)
^^11,50
"KRN",.404,480,40,12,0)
11^Source^2
"KRN",.404,480,40,12,2)
7,47^12^7,39
"KRN",.404,480,40,12,11)
D HLP^DDSUTL("Enter the source of this Lot.")
"KRN",.404,480,40,12,12)
S BI("H")=X
"KRN",.404,480,40,12,20)
S^^v:VFC;o:Other State;i:IHS/Tribal
"KRN",.404,480,40,12,21,0)
^^1^1^3100316^
"KRN",.404,480,40,12,21,1,0)
Enter the source of this Lot.
"KRN",.404,480,40,13,0)
9^Facility^2
"KRN",.404,480,40,13,2)
13,20^30^13,10
"KRN",.404,480,40,13,10)
I X'=DDSOLD,X]"" S DDSSTACK="BI PAGE-FACILITY CAUTION"
"KRN",.404,480,40,13,11)
D HLP^DDSUTL("Select the Facility where this Lot will be stored and used.")
"KRN",.404,480,40,13,12)
S BI("N")=X
"KRN",.404,480,40,13,20)
P^^9999999.06:QEM
"KRN",.404,480,40,13,21,0)
^^10^10^3080821^
"KRN",.404,480,40,13,21,1,0)
Generally, limiting a Lot Number to a Facility is NOT necessary and
"KRN",.404,480,40,13,21,2,0)
NOT recommended.  It is only for multi-clinic or multi-facility sites
"KRN",.404,480,40,13,21,3,0)
where more than one inventory of Lot Numbers is being maintained on
"KRN",.404,480,40,13,21,4,0)
the same computer.  An entry in this field will restrict availability
"KRN",.404,480,40,13,21,5,0)
to only those users who are logged on to that Facility.
"KRN",.404,480,40,13,21,6,0)
 
"KRN",.404,480,40,13,21,7,0)
To proceed, select the Facility where this Lot Number will be stored
"KRN",.404,480,40,13,21,8,0)
and used.
"KRN",.404,480,40,13,21,9,0)
If you've entered a Facility in error, simply return to the Facilty
"KRN",.404,480,40,13,21,10,0)
field and delete it by entering an "@" (no quotes).
"KRN",.404,480,40,14,0)
1.5^Sub-lot^2
"KRN",.404,480,40,14,2)
4,20^8^4,11
"KRN",.404,480,40,14,11)
D SUBLOTH^BILOT2($G(BI("A")))
"KRN",.404,480,40,14,12)
S BI("S")=X
"KRN",.404,480,40,14,14)
D SUBLOTD^BILOT2(BI("A"),X)
"KRN",.404,480,40,14,20)
F
"KRN",.404,480,40,14,21,0)
^^2^2^3100314^
"KRN",.404,480,40,14,21,1,0)
If you wish to designate sub-lots for this lot number, enter the sub-lot 
"KRN",.404,480,40,14,21,2,0)
suffix in this space.
"KRN",.404,480,40,15,0)
4.5^Default NDC^2
"KRN",.404,480,40,15,.1)

"KRN",.404,480,40,15,2)
8,20^20^8,7
"KRN",.404,480,40,15,11)
D HLP^DDSUTL("Select the NDC Code that will be the default for this Lot Number.")
"KRN",.404,480,40,15,12)
S BI("O")=X
"KRN",.404,480,40,15,20)
P^^9002084.95:QEM
"KRN",.404,481,0)
BI BLK-INVENTORY OFF^9999999.41^
"KRN",.404,481,40,0)
^.4044I^1^1
"KRN",.404,481,40,1,0)
1^The Doses Unused cannot be greater than the Starting Count.^1
"KRN",.404,481,40,1,2)
^^3,4
"KRN",.404,482,0)
BI BLK-CHANGE LOT WARNING^9999999.41^
"KRN",.404,482,40,0)
^.4044I^4^4
"KRN",.404,482,40,1,0)
1^Changing an existing Lot Number will affect historical patient data.^1
"KRN",.404,482,40,1,2)
^^3,2
"KRN",.404,482,40,2,0)
2^Previous immunizations that used the old Lot Number will now show^1
"KRN",.404,482,40,2,2)
^^4,2
"KRN",.404,482,40,3,0)
.5^CAUTION!^1
"KRN",.404,482,40,3,2)
^^1,31
"KRN",.404,482,40,4,0)
3^the new one.^1
"KRN",.404,482,40,4,2)
^^5,2
"KRN",.404,483,0)
BI BLK-FACILITY CAUTION^9999999.41^
"KRN",.404,483,40,0)
^.4044I^8^8
"KRN",.404,483,40,1,0)
1^CAUTION!^1
"KRN",.404,483,40,1,2)
^^1,30
"KRN",.404,483,40,2,0)
2^Generally, limiting a Lot Number to a Facility is NOT necessary and^1
"KRN",.404,483,40,2,2)
^^3,2
"KRN",.404,483,40,3,0)
3^NOT recommended.  It is only for multi-clinic or multi-facility sites,^1
"KRN",.404,483,40,3,2)
^^4,2
"KRN",.404,483,40,4,0)
4^where more than one inventory of Lot Numbers is being maintained on^1
"KRN",.404,483,40,4,2)
^^5,2
"KRN",.404,483,40,5,0)
5^the same computer.  An entry in this field will restrict availability^1
"KRN",.404,483,40,5,2)
^^6,2
"KRN",.404,483,40,6,0)
6^to only those users who are logged on to that Facility.^1
"KRN",.404,483,40,6,2)
^^7,2
"KRN",.404,483,40,7,0)
7^If you've entered a Facility in error, simply return to the Facilty^1
"KRN",.404,483,40,7,2)
^^9,2
"KRN",.404,483,40,8,0)
8^field and delete it by entering an "@" (no quotes).^1
"KRN",.404,483,40,8,2)
^^10,2
"KRN",.404,484,0)
BI BLK-INACTIVE VACCINE^9999999.41^
"KRN",.404,484,12)
D VACINA3^BILOT1
"KRN",.404,484,40,0)
^.4044I^2^2
"KRN",.404,484,40,1,0)
1^The vaccine you have selected is Inactive.  You must^1
"KRN",.404,484,40,1,2)
^^2,3
"KRN",.404,484,40,2,0)
2^either Activate the vaccine or select a different one.^1
"KRN",.404,484,40,2,2)
^^3,3
"KRN",.404,485,0)
BI BLK-LOT DUPLICATE WARNING^9999999.41^
"KRN",.404,485,40,0)
^.4044I^5^5
"KRN",.404,485,40,1,0)
1^WARNING!  This Lot Number already exists!^1
"KRN",.404,485,40,1,2)
^^3,14
"KRN",.404,485,40,2,0)
2^If you are creating a Sub-lot, then continue.  But if you are^1
"KRN",.404,485,40,2,2)
^^5,5
"KRN",.404,485,40,3,0)
3^adding just a new Lot Number, then exit this screen and select^1
"KRN",.404,485,40,3,2)
^^6,5
"KRN",.404,485,40,4,0)
4^it from the List.  (NOTE: It may be Inactive. If you cannot^1
"KRN",.404,485,40,4,2)
^^7,5
"KRN",.404,485,40,5,0)
5^find it, check the Inactive list.)^1
"KRN",.404,485,40,5,2)
^^8,5
"KRN",.404,486,0)
BI BLK-IMM VISIT HEADER^9000001^
"KRN",.404,486,40,0)
^.4044I^7^7
"KRN",.404,486,40,1,0)
1^!M^1
"KRN",.404,486,40,1,.1)
S Y="* * *  "_$S('$G(BI("K")):"ADD",1:"EDIT")_" AN IMMUNIZATION VISIT  * * *"
"KRN",.404,486,40,1,2)
^^2,21
"KRN",.404,486,40,2,0)
2^!M^1
"KRN",.404,486,40,2,.1)
S Y=IOINORM_" Patient: "_IORVON_$$NAME^BIUTL1(BIDFN)_IOINORM
"KRN",.404,486,40,2,2)
^^4,1
"KRN",.404,486,40,3,0)
3^!M^1
"KRN",.404,486,40,3,.1)
S Y="DOB: "_IORVON_$$DOBF^BIUTL1(BIDFN)_IOINORM
"KRN",.404,486,40,3,2)
^^4,44
"KRN",.404,486,40,4,0)
4^!M^1
"KRN",.404,486,40,4,.1)
S Y="  Chart#: "_IORVON_$$HRCN^BIUTL1(BIDFN)_" at "_$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)_IOINORM
"KRN",.404,486,40,4,2)
^^5,1
"KRN",.404,486,40,5,0)
5^!M^1
"KRN",.404,486,40,5,.1)
S Y=$$ACTIVE^BIUTL1(BIDFN)_"     "_$$SEXW^BIUTL1(BIDFN)
"KRN",.404,486,40,5,2)
^^5,49
"KRN",.404,486,40,6,0)
6^________________________________________________________________________________^1
"KRN",.404,486,40,6,2)
^^6,1
"KRN",.404,486,40,7,0)
.5^!M^1
"KRN",.404,486,40,7,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,486,40,7,2)
^^2,2
"KRN",.404,487,0)
BI BLK-IMM VISIT ADD/EDIT^9000001
"KRN",.404,487,11)
D LOADVIS^BIUTL7("I")
"KRN",.404,487,12)

"KRN",.404,487,40,0)
^.4044I^26^24
"KRN",.404,487,40,1,0)
1^Visit Date^2
"KRN",.404,487,40,1,2)
2,18^22^2,6
"KRN",.404,487,40,1,4)
1
"KRN",.404,487,40,1,11)
D HLP^DDSUTL("Enter the date on which this immunization was given.")
"KRN",.404,487,40,1,12)
S BI("E")=X D OLDDATE^BIUTL4(X)
"KRN",.404,487,40,1,13)
S BIDEFDT=X
"KRN",.404,487,40,1,14)
I $P(Y,".")>DT S DDSERROR="" D HLP^DDSUTL(" * Date may not be in the future.")
"KRN",.404,487,40,1,20)
D^^::PTEX
"KRN",.404,487,40,1,21,0)
^^2^2^2990304^
"KRN",.404,487,40,1,21,1,0)
Enter the date of this Immunization Visit.  You may also add the Time of
"KRN",.404,487,40,1,21,2,0)
Visit following an "@", for example, 1/1/99@0900.
"KRN",.404,487,40,2,0)
2^Vaccine^2
"KRN",.404,487,40,2,2)
4,12^30^4,3
"KRN",.404,487,40,2,4)
1
"KRN",.404,487,40,2,11)
D HLP^DDSUTL("Select the vaccine for this Immunization Visit.")
"KRN",.404,487,40,2,12)
D VACSEL^BIUTL4(X)
"KRN",.404,487,40,2,13)
D VACCHG^BIUTL4(X)
"KRN",.404,487,40,2,20)
P^^9999999.14:QEM
"KRN",.404,487,40,2,21,0)
^^1^1^3080814^^^
"KRN",.404,487,40,2,21,1,0)
Select the vaccine for this Immunization Visit.
"KRN",.404,487,40,2,24)
D VACSCR^BIUTL4
"KRN",.404,487,40,3,0)
2.5^^2
"KRN",.404,487,40,3,2)
5,12^12
"KRN",.404,487,40,3,4)
0^^^1
"KRN",.404,487,40,3,20)
F
"KRN",.404,487,40,5,0)
3^Lot#^2
"KRN",.404,487,40,5,2)
4,56^20^4,50
"KRN",.404,487,40,5,4)
0
"KRN",.404,487,40,5,10)
D LOTWARN^BIUTL7($G(BI("D")),$G(BI("E")),$G(BI("F")))
"KRN",.404,487,40,5,11)
D HLP^DDSUTL("Select the Lot Number for the vaccine used in this immunization. Enter the first character to see a list.")
"KRN",.404,487,40,5,12)
S BI("D")=X D LOTHELP^BIUTL4(X) D LOTDAT^BIUTL7(BI("D"))
"KRN",.404,487,40,5,13)
D LOTSEL^BIUTL4(X)
"KRN",.404,487,40,5,20)
P^^9999999.41:QEM
"KRN",.404,487,40,5,21,0)
^^1^1^3080814^^^
"KRN",.404,487,40,5,21,1,0)
Select the Lot Number for the vaccine used on this Immunization Visit.
"KRN",.404,487,40,5,24)
D LOTSCR^BIUTL4
"KRN",.404,487,40,6,0)
7^Location^2
"KRN",.404,487,40,6,2)
8,36^40^8,26
"KRN",.404,487,40,6,4)
0
"KRN",.404,487,40,6,11)
D HLP^DDSUTL("Select a Location.  If the Location you wish to select is not in the Location File, go to the Location Type field on this screen and select ""OTHER"", then return to this field and enter the location you wish.")
"KRN",.404,487,40,6,12)
S BI("F")=X
"KRN",.404,487,40,6,20)
P^^4:QEM
"KRN",.404,487,40,6,21,0)
^^3^3^2990530^
"KRN",.404,487,40,6,21,1,0)
Select a Location.  If the Location you wish to select is not in the
"KRN",.404,487,40,6,21,2,0)
Location File, go to the Location Type field on this screen and select
"KRN",.404,487,40,6,21,3,0)
"OTHER", then return to this field and enter the location you wish.
"KRN",.404,487,40,6,24)
S DIR("S")="I $D(^AUTTLOC(Y,0)) I '$P(^(0),U,21)"
"KRN",.404,487,40,7,0)
6^Location Type^2
"KRN",.404,487,40,7,2)
8,17^5^8,2
"KRN",.404,487,40,7,3)
IHS
"KRN",.404,487,40,7,4)
1
"KRN",.404,487,40,7,11)
D HLP^DDSUTL("Enter ""I"" if this visit occurred at an Indian Health Location found in the Location file.  Enter ""O"" if it occurred at some Other location not listed in the Location File.")
"KRN",.404,487,40,7,12)
D LOCBR^BIUTL4
"KRN",.404,487,40,7,20)
S^M^I:IHS;O:Other
"KRN",.404,487,40,7,21,0)
^^3^3^3050613^
"KRN",.404,487,40,7,21,1,0)
Enter "I" if this visit occurred at an Indian Health Location found in the
"KRN",.404,487,40,7,21,2,0)
Location File.  Enter "O" if it occurred at some Other location not listed
"KRN",.404,487,40,7,21,3,0)
in the Location File.
"KRN",.404,487,40,8,0)
8^Location^2
"KRN",.404,487,40,8,2)
8,36^42^8,26
"KRN",.404,487,40,8,4)
0^^^1
"KRN",.404,487,40,8,10)
I $G(BITOLONG) S DDSSTACK="BI PAGE-LOCATION NAME TOO LONG"
"KRN",.404,487,40,8,11)
D HLP^DDSUTL("Enter the name of the non-IHS location for this visit (between 2 and 50 characters).")
"KRN",.404,487,40,8,12)
S BI("G")=X
"KRN",.404,487,40,8,20)
F^^2:100
"KRN",.404,487,40,8,21,0)
^^2^2^3080618^^^^
"KRN",.404,487,40,8,21,1,0)
Enter the name of the non-IHS location for this visit (between 2 and 30
"KRN",.404,487,40,8,21,2,0)
characters).
"KRN",.404,487,40,8,22)
I $L(X)>50 S Y=$E(X,1,50) S BITOLONG=1
"KRN",.404,487,40,9,0)
11^Category^2
"KRN",.404,487,40,9,2)
2,56^16^2,46
"KRN",.404,487,40,9,3)
A
"KRN",.404,487,40,9,4)
1
"KRN",.404,487,40,9,11)
D HLP^DDSUTL("Select the PCC Category for this visit (Ambulatory, Historical, or Inpatient).")
"KRN",.404,487,40,9,12)
S BI("I")=X D NOPROV^BIUTL7(X)
"KRN",.404,487,40,9,13)
D HISTORY^BIUTL4(X)
"KRN",.404,487,40,9,20)
S^M^A:Ambulatory;E:Historical Event;I:Inpatient
"KRN",.404,487,40,9,21,0)
^^1^1^2980112^
"KRN",.404,487,40,9,21,1,0)
Select the PCC Category for this visit.
"KRN",.404,487,40,10,0)
13^!M^2
"KRN",.404,487,40,10,.1)
I $G(BI("K")) S Y="Reaction"
"KRN",.404,487,40,10,2)
10,57^23^10,47
"KRN",.404,487,40,10,4)
^^^1
"KRN",.404,487,40,10,11)
D HLP^DDSUTL("If the patient had a reaction to this immunization, select the type of reaction.")
"KRN",.404,487,40,10,12)
S BI("O")=X
"KRN",.404,487,40,10,20)
P^^9002084.8:QEM
"KRN",.404,487,40,10,21,0)
^^1^1^3030820^^^
"KRN",.404,487,40,10,21,1,0)
Select the reaction the patient had to this Immunization Visit.
"KRN",.404,487,40,10,24)
S DIR("S")="I $P(^(0),U,3)"
"KRN",.404,487,40,12,0)
10^VIS Date^2
"KRN",.404,487,40,12,2)
10,12^11^10,2
"KRN",.404,487,40,12,11)
D HLP^DDSUTL("Enter the publication date of the Vaccine Information Statement (VIS), if one was given to the patient.")
"KRN",.404,487,40,12,12)
S BI("Q")=X
"KRN",.404,487,40,12,20)
D
"KRN",.404,487,40,12,21,0)
^^3^3^2980914^
"KRN",.404,487,40,12,21,1,0)
Enter the Release/Revision date of the Vaccine Information Statement
"KRN",.404,487,40,12,21,2,0)
(VIS)--if given--at this visit.  NOTE: This is NOT the date of visit; this
"KRN",.404,487,40,12,21,3,0)
is the date the VIS was released or published.  (Enter @ to delete.)
"KRN",.404,487,40,13,0)
9^Provider^2
"KRN",.404,487,40,13,2)
9,12^28^9,2
"KRN",.404,487,40,13,4)
0
"KRN",.404,487,40,13,11)
D HLP^DDSUTL("Select the provider who actually administered the immunization (gave the injection).")
"KRN",.404,487,40,13,12)
S BI("R")=X
"KRN",.404,487,40,13,20)
P^^200:QEM
"KRN",.404,487,40,13,21,0)
^^3^3^2990530^
"KRN",.404,487,40,13,21,1,0)
Select the person who actually administered the immunization (gave the
"KRN",.404,487,40,13,21,2,0)
injection).  This person must be listed as a Provider in the RPMS Person
"KRN",.404,487,40,13,21,3,0)
File (must have the Provider Key).
"KRN",.404,487,40,13,24)
S DIR("S")="I $D(^XUSEC(""PROVIDER"",+Y))"
"KRN",.404,487,40,14,0)
14^!M^2
"KRN",.404,487,40,14,.1)
I $G(BI("K")) S Y="Dose Override"
"KRN",.404,487,40,14,2)
11,57^19^11,42
"KRN",.404,487,40,14,4)
^^^1
"KRN",.404,487,40,14,11)
D HLP^DDSUTL("Normally leave blank.  Select an INVALID reason or FORCE VALID as necessary.")
"KRN",.404,487,40,14,12)
S BI("S")=X
"KRN",.404,487,40,14,20)
S^M^0:;1:INVALID-BAD STORAGE;2:INVALID-DEFECTIVE;3:INVALID-EXPIRED;4:INVALID-ADMIN ERROR;9:FORCE VALID
"KRN",.404,487,40,14,21,1,0)
If this dose should be considered invalid, select one of the "INVALID"
"KRN",.404,487,40,14,21,2,0)
reasons below.  If this dose is INVALID by the forecaster, but you wish
"KRN",.404,487,40,14,21,3,0)
wish to FORCE it to be considered valid, select "VALID-FORCE."  If you
"KRN",.404,487,40,14,21,4,0)
do not wish to override this dose, leave it blank or select 0 (zero).
"KRN",.404,487,40,15,0)
4^Inj Site^2
"KRN",.404,487,40,15,2)
7,12^21^7,2
"KRN",.404,487,40,15,11)
D HLP^DDSUTL("Select the Injection Site for this immunization.")
"KRN",.404,487,40,15,12)
S BI("T")=X
"KRN",.404,487,40,15,20)
S^M^LTI:Left Thigh IM;LTS:Left Thigh SQ;RTI:Right Thigh IM;RTS:Right Thigh SQ;BTI:Both Thighs IM;LDI:Left Deltoid IM;LAS:Left Arm SQ;RDI:Right Deltoid IM;RAS:Right Arm SQ;O:Oral;IN:Intranasal;LID:Left Arm Intradermal;RID:Right Arm Intradermal
"KRN",.404,487,40,15,21,0)
^^1^1^3030729^
"KRN",.404,487,40,15,21,1,0)
Select the location of the patient's body where the needle was inserted.
"KRN",.404,487,40,16,0)
5^Vol^2
"KRN",.404,487,40,16,2)
7,41^4^7,36
"KRN",.404,487,40,16,4)
^^0^0
"KRN",.404,487,40,16,11)
D HLP^DDSUTL("Enter the Volume in mls of vaccine fluid injected.")
"KRN",.404,487,40,16,13)
S BI("W")=+X D PUT^DDSVALF(5,,,$$LEADZ^BIUTL5(X),"E")
"KRN",.404,487,40,16,20)
F^^0:4
"KRN",.404,487,40,16,21,0)
^^4^4^3121206^^^
"KRN",.404,487,40,16,21,1,0)
Enter the volume in mililiters of vaccine fluid that was injected into 
"KRN",.404,487,40,16,21,2,0)
the patient's body.  This is generally .5ml.  However, 0.25ml of influenza
"KRN",.404,487,40,16,21,3,0)
is usually given to infants 6-35 months, and 1.0ml of Hep B is usually 
"KRN",.404,487,40,16,21,4,0)
given to adults.
"KRN",.404,487,40,16,22)
I (+X'>0)!(X>5) K X
"KRN",.404,487,40,17,0)
5.5^ml^2
"KRN",.404,487,40,17,2)
7,48^1^7,46^1
"KRN",.404,487,40,17,4)
^^^1
"KRN",.404,487,40,17,20)
F
"KRN",.404,487,40,19,0)
3.5^^2
"KRN",.404,487,40,19,2)
5,56^22
"KRN",.404,487,40,19,4)
0^^^1
"KRN",.404,487,40,19,20)
F
"KRN",.404,487,40,20,0)
3.4^^2
"KRN",.404,487,40,20,2)
6,56^20
"KRN",.404,487,40,20,4)
0^^^1
"KRN",.404,487,40,20,20)
F
"KRN",.404,487,40,21,0)
10.5^Vac Elig^2^^
"KRN",.404,487,40,21,2)
11,12^27^11,2
"KRN",.404,487,40,21,4)
1
"KRN",.404,487,40,21,11)
D HLP^DDSUTL("Select Vaccine Eligibility for this patient on the date of this visit.")
"KRN",.404,487,40,21,12)
S BI("P")=X D ELIGLAB^BIUTL8(X)
"KRN",.404,487,40,21,20)
P^^9002084.83:QEM
"KRN",.404,487,40,21,24)
S DIR("S")="I $P(^BIELIG(Y,0),U,3)'=1"
"KRN",.404,487,40,22,0)
15^^2
"KRN",.404,487,40,22,2)
3,56^21
"KRN",.404,487,40,22,4)
0^^^1
"KRN",.404,487,40,22,20)
F
"KRN",.404,487,40,23,0)
3.8^NDC Code^2
"KRN",.404,487,40,23,2)
6,12^13^6,2
"KRN",.404,487,40,23,11)
D HLP^DDSUTL("Select the NDC Code for this immunization. Enter the first digit to see a list of available choices.")
"KRN",.404,487,40,23,12)
S BI("H")=X
"KRN",.404,487,40,23,20)
P^^9002084.95:QEM
"KRN",.404,487,40,23,21,0)
^^1^1^3110720^
"KRN",.404,487,40,23,21,1,0)
Select the NDC Code for this immunization.
"KRN",.404,487,40,23,24)
D NDCSCR^BIUTL4
"KRN",.404,487,40,24,0)
10.6^^2
"KRN",.404,487,40,24,2)
11,17^22
"KRN",.404,487,40,24,4)
^^^1
"KRN",.404,487,40,24,20)
F
"KRN",.404,487,40,25,0)
1.5^Admin Date^2
"KRN",.404,487,40,25,2)
3,18^22^3,6
"KRN",.404,487,40,25,4)
0
"KRN",.404,487,40,25,11)
D HLP^DDSUTL("Enter the date on which this shot was actually administered to the patient.")
"KRN",.404,487,40,25,12)
S BI("EE")=X
"KRN",.404,487,40,25,14)
I $P(Y,".")>DT S DDSERROR="" D HLP^DDSUTL(" * Date may not be in the future.")
"KRN",.404,487,40,25,20)
D
"KRN",.404,487,40,25,21,0)
^^3^3^3140828^
"KRN",.404,487,40,25,21,1,0)
Enter the date on which this immunization was actually administered to the
"KRN",.404,487,40,25,21,2,0)
patient.  NOTE: This may be different from the "visit date" associated 
"KRN",.404,487,40,25,21,3,0)
this immunization, as in the case of an inpatient stay.
"KRN",.404,487,40,26,0)
10.2^Presented^2
"KRN",.404,487,40,26,2)
10,35^11^10,24
"KRN",.404,487,40,26,11)
D HLP^DDSUTL("Enter the date on which the VIS was actually given to the patient.")
"KRN",.404,487,40,26,12)
S BI("QQ")=X
"KRN",.404,487,40,26,20)
D
"KRN",.404,487,40,26,21,0)
^^4^4^3140828^
"KRN",.404,487,40,26,21,1,0)
Enter the date on which the Vaccine Information Statement (VIS) was 
"KRN",.404,487,40,26,21,2,0)
actually given to the patient.  NOTE: This is not the VIS 
"KRN",.404,487,40,26,21,3,0)
Release/Revision date.  Also, it may also be different from the visit
"KRN",.404,487,40,26,21,4,0)
date.
"KRN",.404,488,0)
BI BLK-IMM VISIT LOT EXPIRED^9000001^
"KRN",.404,488,40,0)
^.4044I^1^1
"KRN",.404,488,40,1,0)
1^WARNING! THIS LOT EXPIRED BEFORE THE VISIT DATE!^1
"KRN",.404,488,40,1,2)
^^2,4
"KRN",.404,489,0)
BI BLK-LOT LOW SUPPLY^9000001^
"KRN",.404,489,40,0)
^.4044I^1^1
"KRN",.404,489,40,1,0)
1^ALERT! THE SUPPLY OF THIS LOT IS LOW!^1
"KRN",.404,489,40,1,2)
^^2,4
"KRN",.404,490,0)
BI BLK-EXPIRED AND LOW^9000001^
"KRN",.404,490,40,0)
^.4044I^1^1
"KRN",.404,490,40,1,0)
1^WARNING! THIS LOT EXPIRED BEFORE THE VISIT, AND SUPPLY IS LOW!^1
"KRN",.404,490,40,1,2)
^^2,4
"KRN",.404,491,0)
BI BLK-OUTSIDE LOC TOO LONG^9000001^
"KRN",.404,491,40,0)
^.4044I^1^1
"KRN",.404,491,40,1,0)
1^Your Other Loccation Name will be shortened to 50 characters.^1
"KRN",.404,491,40,1,2)
^^2,2
"KRN",.404,492,0)
BI BLK-CONTRAINDICATION HEADER^9000001^
"KRN",.404,492,40,0)
^.4044I^7^7
"KRN",.404,492,40,1,0)
1^!M^1
"KRN",.404,492,40,1,.1)
S Y="* * *  "_$S('$G(BI("N")):"ADD",1:"EDIT")_" A CONTRAINDICATION  * * *"
"KRN",.404,492,40,1,2)
^^2,22
"KRN",.404,492,40,2,0)
2^!M^1
"KRN",.404,492,40,2,.1)
S Y=IOINORM_" Patient: "_IORVON_$$NAME^BIUTL1(BIDFN)_IOINORM
"KRN",.404,492,40,2,2)
^^4,1
"KRN",.404,492,40,3,0)
3^!M^1
"KRN",.404,492,40,3,.1)
S Y="DOB: "_IORVON_$$DOBF^BIUTL1(BIDFN)_IOINORM
"KRN",.404,492,40,3,2)
^^4,44
"KRN",.404,492,40,4,0)
4^!M^1
"KRN",.404,492,40,4,.1)
S Y="  Chart#: "_IORVON_$$HRCN^BIUTL1(BIDFN)_" at "_$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)_IOINORM
"KRN",.404,492,40,4,2)
^^5,1
"KRN",.404,492,40,5,0)
5^!M^1
"KRN",.404,492,40,5,.1)
S Y=$$ACTIVE^BIUTL1(BIDFN)_"     "_$$SEXW^BIUTL1(BIDFN)
"KRN",.404,492,40,5,2)
^^5,49
"KRN",.404,492,40,6,0)
6^________________________________________________________________________________^1
"KRN",.404,492,40,6,2)
^^6,1
"KRN",.404,492,40,7,0)
.5^!M^1
"KRN",.404,492,40,7,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,492,40,7,2)
^^2,2
"KRN",.404,493,0)
BI BLK-CONTRAINDICATION ADD^9000001
"KRN",.404,493,11)
D LDCONTR^BIUTL7
"KRN",.404,493,12)

"KRN",.404,493,40,0)
^.4044I^11^4
"KRN",.404,493,40,2,0)
1^Vaccine^2
"KRN",.404,493,40,2,2)
3,15^30^3,6
"KRN",.404,493,40,2,4)
1
"KRN",.404,493,40,2,11)
D HLP^DDSUTL("Select the vaccine that is contraindicated for this patient.")
"KRN",.404,493,40,2,12)
S BI("B")=X D VACSEL^BIUTL4(X)
"KRN",.404,493,40,2,20)
P^^9999999.14:QEM
"KRN",.404,493,40,2,21,0)
^^1^1^2990530^^
"KRN",.404,493,40,2,21,1,0)
Select the vaccine that is contraindicated for this patient.
"KRN",.404,493,40,3,0)
2.5^^2
"KRN",.404,493,40,3,2)
4,15^12
"KRN",.404,493,40,3,4)
0^^^1
"KRN",.404,493,40,3,20)
F
"KRN",.404,493,40,10,0)
4^Reason^2
"KRN",.404,493,40,10,2)
6,15^26^6,7
"KRN",.404,493,40,10,4)
1
"KRN",.404,493,40,10,10)
I '$G(BI("B")) D HLP^DDSUTL("You must first choose a vaccine."),HLP^DDSUTL("$$EOP") S DDSBR=1
"KRN",.404,493,40,10,11)
D HLP^DDSUTL("Select the reason or reaction that has caused this vaccine/immunization to be contraindicated for this patient.")
"KRN",.404,493,40,10,12)
S BI("C")=X D CREASCHK^BIUTL7
"KRN",.404,493,40,10,20)
P^^920.4:QEM
"KRN",.404,493,40,10,21,0)
^^2^2^3150605^^^
"KRN",.404,493,40,10,21,1,0)
Select the reason or reaction that has caused this vaccine/immunization to
"KRN",.404,493,40,10,21,2,0)
be contraindicated for this patient.
"KRN",.404,493,40,10,24)
S DIR("S")="I $$CREASCR^BIUTL4()"
"KRN",.404,493,40,11,0)
5^Date Noted^2
"KRN",.404,493,40,11,2)
9,15^11^9,3
"KRN",.404,493,40,11,3)
!M
"KRN",.404,493,40,11,3.1)
S Y=$$TXDT^BIUTL5(DT)
"KRN",.404,493,40,11,11)
D HLP^DDSUTL("Enter the date on which this Contraindication was noted.")
"KRN",.404,493,40,11,12)
S BI("D")=X
"KRN",.404,493,40,11,20)
D^^::PTEX
"KRN",.404,493,40,11,21,0)
^^1^1^2990530^^
"KRN",.404,493,40,11,21,1,0)
Enter the date on which this Contraindication was noted.
"KRN",.404,494,0)
BI BLK-CASE DATA HEADER^9002084^
"KRN",.404,494,40,0)
^.4044I^8^8
"KRN",.404,494,40,1,0)
1^* * *  EDIT PATIENT CASE DATA  * * *^1^
"KRN",.404,494,40,1,2)
^^1,22^
"KRN",.404,494,40,2,0)
2^!M^1^
"KRN",.404,494,40,2,.1)
S Y=IOINORM_"Patient Name: "_IOINHI_$$NAME^BIUTL1(BIDFN)_" ("_$$AGEF^BIUTL1(BIDFN)_")"_IOINORM
"KRN",.404,494,40,2,2)
^^3,1
"KRN",.404,494,40,3,0)
3^!M^1^
"KRN",.404,494,40,3,.1)
S Y=IOINORM_"Chart#: "_IOINHI_$$HRCN^BIUTL1(BIDFN,DUZ(2))_IOINORM
"KRN",.404,494,40,3,2)
^^3,57
"KRN",.404,494,40,4,0)
7^________________________________________________________________________________^1^
"KRN",.404,494,40,4,2)
^^6,1
"KRN",.404,494,40,5,0)
5^!M^1^
"KRN",.404,494,40,5,.1)
S Y=IOINORM_"Patient Phone: "_IOINHI_$$HPHONE^BIUTL1(BIDFN)
"KRN",.404,494,40,5,2)
^^4,50
"KRN",.404,494,40,6,0)
4^!M^1^
"KRN",.404,494,40,6,.1)
S Y=IOINORM_"Street: "_IOINHI_$$STREET^BIUTL1(BIDFN)_IOINORM
"KRN",.404,494,40,6,2)
^^4,7
"KRN",.404,494,40,7,0)
6^!M^1^
"KRN",.404,494,40,7,.1)
S Y=IOINORM_"Cty/St/Zip: "_IOINHI_$$CTYSTZ^BIUTL1(BIDFN)_IOINORM
"KRN",.404,494,40,7,2)
^^5,3
"KRN",.404,494,40,8,0)
8^(The above data may be edited through Patient Registration.)^1^
"KRN",.404,494,40,8,2)
^^7,12
"KRN",.404,495,0)
BI BLK-CASE DATE EDIT^9002084
"KRN",.404,495,11)
D LOADCAS^BIUTL7
"KRN",.404,495,40,0)
^.4044I^26^10
"KRN",.404,495,40,17,0)
99^ ^1
"KRN",.404,495,40,17,2)
^^10,78
"KRN",.404,495,40,18,0)
2^Parent/Guardian^2
"KRN",.404,495,40,18,2)
3,25^40^3,8
"KRN",.404,495,40,18,11)
D HLP^DDSUTL("If this patient is a child, enter the name of the parent or guardian of this child.  This should be the person who will be contacted for the patient's follow-up.")
"KRN",.404,495,40,18,12)
S BI("C")=X
"KRN",.404,495,40,18,20)
F^^3:40
"KRN",.404,495,40,18,21,0)
^^3^3^2990530^
"KRN",.404,495,40,18,21,1,0)
If this patient is a child, enter the name of the parent or guardian of
"KRN",.404,495,40,18,21,2,0)
this child.  This should be the person who will be contacted for the pati
"KRN",.404,495,40,18,21,3,0)
ent's follow-up.
"KRN",.404,495,40,19,0)
7^Mother's HBsAG Status^2
"KRN",.404,495,40,19,2)
10,25^10^10,2
"KRN",.404,495,40,19,11)
D HLP^DDSUTL("Select the patient's mother's HBsAg Status: P for Positive, N for Negative,   or U for Unknown.")
"KRN",.404,495,40,19,12)
S BI("D")=X
"KRN",.404,495,40,19,20)
S^^P:Positive;N:Negative;U:Unknown
"KRN",.404,495,40,19,21,0)
^^1^1^2980303^
"KRN",.404,495,40,19,21,1,0)
Select the patient's mother's HBsAg Status.
"KRN",.404,495,40,20,0)
1^Case Manager^2
"KRN",.404,495,40,20,2)
2,25^35^2,11
"KRN",.404,495,40,20,11)
D HLP^DDSUTL("Select the person who is currently managing this patient's immunizations, letters, etc.")
"KRN",.404,495,40,20,12)
S BI("B")=X
"KRN",.404,495,40,20,20)
P^^200:QEM
"KRN",.404,495,40,20,21,0)
^^2^2^2980303^^^^
"KRN",.404,495,40,20,21,1,0)
Select the person who is currently managing this patient's immunizations,
"KRN",.404,495,40,20,21,2,0)
letters, etc.
"KRN",.404,495,40,20,24)
S DIR("S")="I $D(^BIMGR(Y,0)) I '$P(^(0),U,2)"
"KRN",.404,495,40,21,0)
4^Inactive Date^2
"KRN",.404,495,40,21,2)
6,25^11^6,10
"KRN",.404,495,40,21,11)
D HLP^DDSUTL("Enter the date on which this patient became Inactive in the Immunization Register.  To RE-ACTIVATE this patient, enter ""@"" (shift-2, no quotes), which will delete the Inactive Date.")
"KRN",.404,495,40,21,12)
S BI("E")=DDSEXT D INACTV^BIUTL4(X)
"KRN",.404,495,40,21,20)
D
"KRN",.404,495,40,21,21,0)
^^3^3^2990530^^
"KRN",.404,495,40,21,21,1,0)
Enter the date on which this patient became Inactive in the Immunization
"KRN",.404,495,40,21,21,2,0)
Register.  To RE-ACTIVATE this patient, enter "@" (shift-2, no quotes),
"KRN",.404,495,40,21,21,3,0)
which will delete the Inactive Date.
"KRN",.404,495,40,22,0)
5^Inactive Reason^2
"KRN",.404,495,40,22,2)
6,57^23^6,40
"KRN",.404,495,40,22,11)
D HLP^DDSUTL("Select the reason this patient was made Inactive.")
"KRN",.404,495,40,22,12)
S BI("F")=X D REASCHK^BIUTL7
"KRN",.404,495,40,22,20)
S^^m:Moved Elsewhere;t:Treatment Elsewhere;d:Deceased;p:Previously Inactivated;n:Never Activated;i:Ineligible, non-Ben
"KRN",.404,495,40,22,21,0)
^^1^1^3050201^
"KRN",.404,495,40,22,21,1,0)
Select the reason this patient was made Inactive.
"KRN",.404,495,40,23,0)
3^Other Info^2
"KRN",.404,495,40,23,2)
4,25^55^4,13
"KRN",.404,495,40,23,11)
D HLP^DDSUTL("Enter any small item of demographic patient information that is not tracked elsewhere in the software.")
"KRN",.404,495,40,23,12)
S BI("G")=X
"KRN",.404,495,40,23,20)
F^^1:55
"KRN",.404,495,40,23,21,0)
^^3^3^2980505^
"KRN",.404,495,40,23,21,1,0)
Enter any small item of demographic patient information that is not
"KRN",.404,495,40,23,21,2,0)
tracked elsewhere in the software.  Answer must be 1-50 characters in
"KRN",.404,495,40,23,21,3,0)
length.
"KRN",.404,495,40,24,0)
6^Force Pneumo Forecast^2
"KRN",.404,495,40,24,2)
9,25^23^9,2
"KRN",.404,495,40,24,11)
D HLP^DDSUTL("Select whether Pneumococcal vaccine should be forecast for this patient, regardless of age.  Select  Normal to forecast them only in later life.  Select Disregard to ignore Risk Factors.")
"KRN",.404,495,40,24,12)
S BI("H")=X
"KRN",.404,495,40,24,20)
S^^0:Normal;2:Pneumococcal;4:Disregard Risk Factors
"KRN",.404,495,40,24,21,0)
^^4^4^3140301^
"KRN",.404,495,40,24,21,1,0)
   Select whether Pneumococcal vaccine should be forecast for this
"KRN",.404,495,40,24,21,2,0)
   patient, regardless of age.  Leave it blank or enter Normal to forecast
"KRN",.404,495,40,24,21,3,0)
   this vaccine only in later life (>65yrs). Select Disregard to prevent
"KRN",.404,495,40,24,21,4,0)
   forecasting Pneumo due to Risk Factors.
"KRN",.404,495,40,25,0)
5.5^Moved to/Tx Elsewhere^2^^
"KRN",.404,495,40,25,2)
7,25^55^7,2
"KRN",.404,495,40,25,11)
D HLP^DDSUTL("If the patient has moved, enter the location (if known).  Or if the patient is receiving treatment elsewhere, enter the name of the clinic or hospital (if known).")
"KRN",.404,495,40,25,12)
S BI("I")=X D REASCHK^BIUTL7
"KRN",.404,495,40,25,20)
F^^1:55
"KRN",.404,495,40,26,0)
8^State Registry Consent^2
"KRN",.404,495,40,26,2)
10,75^3^10,51
"KRN",.404,495,40,26,11)
D HLP^DDSUTL("Enter YES if the patient or guardian has consented to participate in the state immunization registry; enter NO if consent has not been given.")
"KRN",.404,495,40,26,12)
S BI("K")=X
"KRN",.404,495,40,26,20)
S^^0:NO;1:YES
"KRN",.404,495,40,26,21,0)
^^2^2^3100406^
"KRN",.404,495,40,26,21,1,0)
Enter YES if this patient has consented to participating in a state 
"KRN",.404,495,40,26,21,2,0)
immunization registry.  Enter NO if they have declined.
"KRN",.404,496,0)
BI BLK-SKIN VISIT HEADER^9000001^
"KRN",.404,496,40,0)
^.4044I^8^8
"KRN",.404,496,40,1,0)
1^* * *  ADD/EDIT SKIN TEST VISIT  * * *^1
"KRN",.404,496,40,1,2)
^^2,22
"KRN",.404,496,40,2,0)
2^!M^1
"KRN",.404,496,40,2,.1)
S Y=IOINORM_" Patient: "_IORVON_$$NAME^BIUTL1(BIDFN)_IOINORM
"KRN",.404,496,40,2,2)
^^4,1
"KRN",.404,496,40,3,0)
3^!M^1
"KRN",.404,496,40,3,.1)
S Y="DOB: "_IORVON_$$DOBF^BIUTL1(BIDFN)_IOINORM
"KRN",.404,496,40,3,2)
^^4,44
"KRN",.404,496,40,4,0)
4^!M^1
"KRN",.404,496,40,4,.1)
S Y="  Chart#: "_IORVON_$$HRCN^BIUTL1(BIDFN)_" at "_$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)_IOINORM
"KRN",.404,496,40,4,2)
^^5,1
"KRN",.404,496,40,5,0)
5^!M^1
"KRN",.404,496,40,5,.1)
S Y=$$ACTIVE^BIUTL1(BIDFN)_"     "_$$SEXW^BIUTL1(BIDFN)
"KRN",.404,496,40,5,2)
^^5,49
"KRN",.404,496,40,6,0)
6^________________________________________________________________________________^1
"KRN",.404,496,40,6,2)
^^6,1
"KRN",.404,496,40,7,0)
.5^!M^1
"KRN",.404,496,40,7,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,496,40,7,2)
^^2,2
"KRN",.404,496,40,8,0)
.4^!M^1
"KRN",.404,496,40,8,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,496,40,8,2)
^^2,2
"KRN",.404,497,0)
BI BLK-SKIN VISIT ADD/EDIT^9000001
"KRN",.404,497,11)
D LOADVIS^BIUTL7("S")
"KRN",.404,497,12)

"KRN",.404,497,40,0)
^.4044I^15^15
"KRN",.404,497,40,1,0)
1^Date^2
"KRN",.404,497,40,1,2)
2,14^22^2,8
"KRN",.404,497,40,1,4)
1
"KRN",.404,497,40,1,11)
D HLP^DDSUTL("Enter the date of this Skin Test Visit.")
"KRN",.404,497,40,1,12)
S BI("E")=X D OLDDATE^BIUTL4(X)
"KRN",.404,497,40,1,13)
S BIDEFDT=X
"KRN",.404,497,40,1,14)
I $P(Y,".")>DT S DDSERROR="" D HLP^DDSUTL(" * Date may not be in the future.")
"KRN",.404,497,40,1,20)
D^^::PTEX
"KRN",.404,497,40,1,21,0)
^^2^2^2990305^
"KRN",.404,497,40,1,21,1,0)
Enter the date of this Skin Test Visit.  You may also add the Time of
"KRN",.404,497,40,1,21,2,0)
Visit following an "@", for example, 1/1/99@0900.
"KRN",.404,497,40,2,0)
2^Skin Test^2
"KRN",.404,497,40,2,2)
4,14^10^4,3
"KRN",.404,497,40,2,4)
1^^^
"KRN",.404,497,40,2,11)
D HLP^DDSUTL("Select the Skin Test for this Visit.")
"KRN",.404,497,40,2,12)
S BI("B")=X
"KRN",.404,497,40,2,13)
D SKINCHG^BIUTL4(X)
"KRN",.404,497,40,2,20)
P^^9999999.28:QEM
"KRN",.404,497,40,2,21,0)
^^1^1^2980211^^^
"KRN",.404,497,40,2,21,1,0)
Select the Skin Test for this Visit.
"KRN",.404,497,40,3,0)
3^Result^2
"KRN",.404,497,40,3,2)
6,11^8^6,3
"KRN",.404,497,40,3,4)
0^^^
"KRN",.404,497,40,3,11)
D HLP^DDSUTL("Select the result for this Skin Test: P for Positive, N for Negative, D for Doubtful, or O for No Take.  *** NOTE! If you enter a Result you MUST enter a Reading! ***")
"KRN",.404,497,40,3,12)
S BI("L")=X
"KRN",.404,497,40,3,14)
I ($$GET^DDSVALF(4,"","","I")>14)&(X="N") D BADREAD^BIUTL4
"KRN",.404,497,40,3,20)
S^M^P:POSITIVE;N:NEGATIVE;D:DOUBTFUL;O:NO TAKE
"KRN",.404,497,40,3,21,0)
^^1^1^2980211^
"KRN",.404,497,40,3,21,1,0)
Select the result for this Skin Test.
"KRN",.404,497,40,4,0)
4^Reading^2
"KRN",.404,497,40,4,2)
6,35^2^6,26
"KRN",.404,497,40,4,4)
^^^0
"KRN",.404,497,40,4,11)
D HLP^DDSUTL("Enter a whole number between 0 and 40, indicating the size of the reading in millimeters.  If the Result is NEGATIVE, the reading must be less than 15mm.")
"KRN",.404,497,40,4,12)
S BI("M")=X D READCHK^BIUTL7
"KRN",.404,497,40,4,14)
I ($$GET^DDSVALF(3,"","","I")="N")&(X>14) D BADREAD^BIUTL4
"KRN",.404,497,40,4,20)
N^^0:40:0
"KRN",.404,497,40,4,21,0)
^^3^3^3030814^
"KRN",.404,497,40,4,21,1,0)
Enter a whole number between 0 and 40, indicating the size of the reading
"KRN",.404,497,40,4,21,2,0)
in millimeters.  If the Result is NEGATIVE, the reading must be less than
"KRN",.404,497,40,4,21,3,0)
15 mm.
"KRN",.404,497,40,5,0)
5^Date of Reading^2
"KRN",.404,497,40,5,2)
6,60^11^6,43
"KRN",.404,497,40,5,4)
0
"KRN",.404,497,40,5,11)
D HLP^DDSUTL("Enter the date on which the result reading was taken.")
"KRN",.404,497,40,5,12)
S BI("N")=X
"KRN",.404,497,40,5,14)
I Y D BADRDAT^BIUTL4
"KRN",.404,497,40,5,20)
D^^
"KRN",.404,497,40,5,21,0)
^^1^1^3060808^^^
"KRN",.404,497,40,5,21,1,0)
Enter the date on which the result reading was taken
"KRN",.404,497,40,6,0)
7^Location^2
"KRN",.404,497,40,6,2)
8,36^40^8,26
"KRN",.404,497,40,6,4)
0
"KRN",.404,497,40,6,11)
D HLP^DDSUTL("Select a Location.  If the Location you wish to select is not in the Location File, go to the Location Type field on this screen and select ""OTHER"", then return to this field and enter the location you wish.")
"KRN",.404,497,40,6,12)
S BI("F")=X
"KRN",.404,497,40,6,20)
P^^4:QEM
"KRN",.404,497,40,6,21,0)
^^3^3^2990530^
"KRN",.404,497,40,6,21,1,0)
Select a Location.  If the Location you wish to select is not in the
"KRN",.404,497,40,6,21,2,0)
Location File, go to the Location Type field on this screen and select
"KRN",.404,497,40,6,21,3,0)
"OTHER", then return to this field and enter the location you wish.
"KRN",.404,497,40,6,24)
S DIR("S")="I $D(^AUTTLOC(Y,0)) I '$P(^(0),U,21)"
"KRN",.404,497,40,7,0)
6^Location Type^2
"KRN",.404,497,40,7,2)
8,18^5^8,3
"KRN",.404,497,40,7,3)
IHS
"KRN",.404,497,40,7,4)
1
"KRN",.404,497,40,7,11)
D HLP^DDSUTL("Enter ""I"" if this visit occurred at an IHS Location.  Enter ""O"" if it occurred at some Other location not listed in the Location File.")
"KRN",.404,497,40,7,12)
D READCH6^BIUTL7
"KRN",.404,497,40,7,20)
S^M^I:IHS;O:Other
"KRN",.404,497,40,7,21,0)
^^2^2^2990530^
"KRN",.404,497,40,7,21,1,0)
Enter "I" if this visit occurred at an IHS Location.  Enter "O" if it
"KRN",.404,497,40,7,21,2,0)
occurred at some Other location not listed in the Location File.
"KRN",.404,497,40,8,0)
8^Location^2
"KRN",.404,497,40,8,2)
8,36^40^8,26
"KRN",.404,497,40,8,4)
0^^^1
"KRN",.404,497,40,8,10)
I $G(BITOLONG) S DDSSTACK="BI PAGE-LOCATION NAME TOO LONG"
"KRN",.404,497,40,8,11)
D HLP^DDSUTL("Enter the name of the non-IHS location for this visit (between 2 and 30 characters).")
"KRN",.404,497,40,8,12)
S BI("G")=X
"KRN",.404,497,40,8,20)
F^^2:100
"KRN",.404,497,40,8,21,0)
^^2^2^2980127^
"KRN",.404,497,40,8,21,1,0)
Enter the name of the non-IHS location for this visit (between 2 and 30
"KRN",.404,497,40,8,21,2,0)
characters).
"KRN",.404,497,40,8,22)
I $L(X)>50 S Y=$E(X,1,50) S BITOLONG=1
"KRN",.404,497,40,9,0)
11^Category^2
"KRN",.404,497,40,9,2)
2,56^16^2,46
"KRN",.404,497,40,9,3)
A
"KRN",.404,497,40,9,4)
1
"KRN",.404,497,40,9,11)
D HLP^DDSUTL("Select the PCC Category for this visit (Ambulatory, Historical, or Inpatient).")
"KRN",.404,497,40,9,12)
S BI("I")=X D NOPROV^BIUTL7(X)
"KRN",.404,497,40,9,20)
S^M^A:Ambulatory;E:Historical Event;I:Inpatient
"KRN",.404,497,40,9,21,0)
^^1^1^2980112^
"KRN",.404,497,40,9,21,1,0)
Select the PCC Category for this visit.
"KRN",.404,497,40,10,0)
4.5^mm^1
"KRN",.404,497,40,10,2)
^^6,38
"KRN",.404,497,40,11,0)
9^Skin Test Provider^2
"KRN",.404,497,40,11,2)
10,23^28^10,3
"KRN",.404,497,40,11,11)
D HLP^DDSUTL("Select the Provider who actually administered the Skin Test.  (This may or may not be the person who read the test result.)")
"KRN",.404,497,40,11,12)
S BI("R")=X
"KRN",.404,497,40,11,20)
P^^200:QEM
"KRN",.404,497,40,11,21,0)
^^4^4^2990530^
"KRN",.404,497,40,11,21,1,0)
Select the Provider who actually administered the Skin Test.  This person
"KRN",.404,497,40,11,21,2,0)
must be listed as a Provider in the RPMS Person File (must have the
"KRN",.404,497,40,11,21,3,0)
Provider Key).  This may or may not be the person who read the test
"KRN",.404,497,40,11,21,4,0)
result.
"KRN",.404,497,40,11,24)
S DIR("S")="I $D(^XUSEC(""PROVIDER"",+Y))"
"KRN",.404,497,40,12,0)
10^Skin Test Reader^2
"KRN",.404,497,40,12,2)
11,23^28^11,5
"KRN",.404,497,40,12,11)
D HLP^DDSUTL("Select the provider who actually read the test result.")
"KRN",.404,497,40,12,12)
S BI("X")=X
"KRN",.404,497,40,12,20)
P^^200:QEM
"KRN",.404,497,40,13,0)
2.4^Site^2
"KRN",.404,497,40,13,2)
4,35^13^4,29
"KRN",.404,497,40,13,4)
0
"KRN",.404,497,40,13,11)
D HLP^DDSUTL("Enter ""L"" for Left Forearm or ""R"" for Right Forearm.")
"KRN",.404,497,40,13,12)
S BI("T")=X
"KRN",.404,497,40,13,20)
S^M^L:LEFT FOREARM;R:RIGHT FOREARM
"KRN",.404,497,40,14,0)
2.8^Volume^2
"KRN",.404,497,40,14,2)
4,60^4^4,52
"KRN",.404,497,40,14,4)
^^0^0
"KRN",.404,497,40,14,11)
D HLP^DDSUTL("Enter the Volume in mls of test fluid injected")
"KRN",.404,497,40,14,12)
S BI("W")=X
"KRN",.404,497,40,14,20)
N^N^0:5:2
"KRN",.404,497,40,15,0)
13.5^ml^2
"KRN",.404,497,40,15,2)
4,68^1^4,64^1
"KRN",.404,497,40,15,4)
^^^1
"KRN",.404,497,40,15,20)
F
"KRN",.5,210,-1)
0^14
"KRN",.5,210,0)
BI NAME FIRST LAST
"KRN",.5,210,1)
S X=$S($G(BIDFN):$$NAME^BIUTL1(BIDFN,1),1:"")
"KRN",.5,210,2)
X
"KRN",.5,210,3)
0
"KRN",.5,210,9)
Returns full name in the form First Name Last Name.
"KRN",.5,211,-1)
0^16
"KRN",.5,211,0)
BI NOW
"KRN",.5,211,1)
S X=$$NOW^BIUTL5()
"KRN",.5,211,2)
X
"KRN",.5,211,3)
0
"KRN",.5,211,9)
Returns current date and time in external format.
"KRN",.5,212,-1)
0^1
"KRN",.5,212,0)
BI CASE MANAGER
"KRN",.5,212,1)
S X=$S($G(BIDFN):$$CMGR^BIUTL1(BIDFN,1,1),1:"")
"KRN",.5,212,2)
X
"KRN",.5,212,3)
0
"KRN",.5,212,9)
Returns name of Patient's Case Manager.
"KRN",.5,213,-1)
0^17
"KRN",.5,213,0)
BI PARENT/GUARDIAN
"KRN",.5,213,1)
S X=$$PARENT^BIUTL1($G(BIDFN),1)
"KRN",.5,213,2)
X
"KRN",.5,213,3)
0
"KRN",.5,213,9)
Returns name of Patient's Parent or Guardian as store in the Immunization Package (or just "Parent/Guardian of" if no data).
"KRN",.5,214,-1)
0^3
"KRN",.5,214,0)
BI DATE OF BIRTH
"KRN",.5,214,1)
S X=$S($G(BIDFN):$$DOBF^BIUTL1(BIDFN),1:"")
"KRN",.5,214,2)
X
"KRN",.5,214,3)
0
"KRN",.5,214,9)
Returns the Patient's Date of Birth
"KRN",.5,215,-1)
0^2
"KRN",.5,215,0)
BI CHART NUMBER
"KRN",.5,215,1)
S X=$S($G(BIDFN)&($D(DUZ(2))):$$HRCN^BIUTL1(BIDFN,DUZ(2)),1:"")
"KRN",.5,215,2)
X
"KRN",.5,215,3)
0
"KRN",.5,215,9)
Returns Patient's Chart# at this site DUZ(2).
"KRN",.5,216,-1)
0^10
"KRN",.5,216,0)
BI MAILING ADD-STREET
"KRN",.5,216,1)
S X=$S($G(BIDFN):$$STREET^BIUTL1(BIDFN),1:"")
"KRN",.5,216,2)
X
"KRN",.5,216,3)
0
"KRN",.5,216,9)
Returns patient's address street.
"KRN",.5,217,-1)
0^9
"KRN",.5,217,0)
BI MAILING ADD-STATE
"KRN",.5,217,1)
S X=$S($G(BIDFN):$$STATE^BIUTL1(BIDFN),1:"")
"KRN",.5,217,2)
X
"KRN",.5,217,3)
0
"KRN",.5,217,9)
Returns patient's address state (e.g., AK for Alaska).
"KRN",.5,218,-1)
0^12
"KRN",.5,218,0)
BI MAILING ADD-ZIP
"KRN",.5,218,1)
S X=$S($G(BIDFN):$$ZIP^BIUTL1(BIDFN),1:"")
"KRN",.5,218,2)
X
"KRN",.5,218,3)
0
"KRN",.5,218,9)
Returns patient's address zipcode.
"KRN",.5,219,-1)
0^7
"KRN",.5,219,0)
BI MAILING ADD-CITY
"KRN",.5,219,1)
S X=$S($G(BIDFN):$$CITY^BIUTL1(BIDFN),1:"")
"KRN",.5,219,2)
X
"KRN",.5,219,3)
0
"KRN",.5,219,9)
Returns patient's address city.
"KRN",.5,220,-1)
0^8
"KRN",.5,220,0)
BI MAILING ADD-CITY STATE ZIP
"KRN",.5,220,1)
S X=$S($G(BIDFN):$$CTYSTZ^BIUTL1(BIDFN),1:"")
"KRN",.5,220,2)
X
"KRN",.5,220,3)
0
"KRN",.5,220,9)
Returns patient's city, state zip (e.g., EAGLE RIVER, AK  99577).
"KRN",.5,221,-1)
0^13
"KRN",.5,221,0)
BI NAME FIRST
"KRN",.5,221,1)
S X=$S($G(BIDFN):$$NAME^BIUTL1(BIDFN,2),2:"")
"KRN",.5,221,2)
X
"KRN",.5,221,3)
0
"KRN",.5,221,9)
Returns patient's first name.
"KRN",.5,222,-1)
0^18
"KRN",.5,222,0)
BI TODAY
"KRN",.5,222,1)
S X=$$TXDT1^BIUTL5(DT)
"KRN",.5,222,2)
X
"KRN",.5,222,3)
0
"KRN",.5,222,9)
Returns current data in DD-MMM-YYYY
"KRN",.5,223,-1)
0^4
"KRN",.5,223,0)
BI HE/SHE
"KRN",.5,223,1)
S X=$S($G(BIDFN):$$SEX^BIUTL1(BIDFN,1),1:"")
"KRN",.5,223,2)
X
"KRN",.5,223,3)
0
"KRN",.5,223,9)
Given BIDFN, return "he" or "she".
"KRN",.5,224,-1)
0^5
"KRN",.5,224,0)
BI HIM/HER
"KRN",.5,224,1)
S X=$S($G(BIDFN):$$SEX^BIUTL1(BIDFN,2),1:"")
"KRN",.5,224,2)
X
"KRN",.5,224,3)
0
"KRN",.5,224,9)
Given BIDFN, return "him" or "her".
"KRN",.5,225,-1)
0^6
"KRN",.5,225,0)
BI HIS/HER
"KRN",.5,225,1)
S X=$S($G(BIDFN):$$SEX^BIUTL1(BIDFN,3),1:"")
"KRN",.5,225,2)
X
"KRN",.5,225,3)
0
"KRN",.5,225,9)
Given BIDFN, return "his" or "her".
"KRN",.5,226,-1)
0^15
"KRN",.5,226,0)
BI NEXT APPOINTMENT
"KRN",.5,226,1)
S X=$S($G(BIDFN):$$NEXTAPPT^BIUTL11(BIDFN),1:"")
"KRN",.5,226,2)
X
"KRN",.5,226,3)
0
"KRN",.5,226,9)
Given BIDFN, return Patient's next appointment.
"KRN",.5,227,-1)
0^11
"KRN",.5,227,0)
BI MAILING ADD-STREET-2
"KRN",.5,227,1)
S X=$S($G(BIDFN):$$STREET^BIUTL1(BIDFN,2),1:"")
"KRN",.5,227,2)
X
"KRN",.5,227,3)
0
"KRN",.5,227,9)
Returns patient's address street, line 2.
"KRN",.84,9200001,-1)
0^1
"KRN",.84,9200001,0)
9200001^3^^IMMUNIZATIONS VISTA PORT^Imm Package Key Allocation Message
"KRN",.84,9200001,2,0)
^^62^62^3150508^
"KRN",.84,9200001,2,1,0)
     This screen displays all users who hold any of the four  Keys to
"KRN",.84,9200001,2,2,0)
     the Immunization Package.  The Keys, which begin with BIZ, are 
"KRN",.84,9200001,2,3,0)
     listed as column headers at the top of the screen.
"KRN",.84,9200001,2,4,0)
 
"KRN",.84,9200001,2,5,0)
     A "YES" in the column under a Key name indicates that the user
"KRN",.84,9200001,2,6,0)
     listed on that line holds the Key in the column header.
"KRN",.84,9200001,2,7,0)
 
"KRN",.84,9200001,2,8,0)
     There are four Keys included in the Immunization Package:
"KRN",.84,9200001,2,9,0)
     
"KRN",.84,9200001,2,10,0)
     
"KRN",.84,9200001,2,11,0)
     1 - BIZMENU
"KRN",.84,9200001,2,12,0)
     -----------
"KRN",.84,9200001,2,13,0)
     Gives Users access to the Main Menu of the Immunization Package,
"KRN",.84,9200001,2,14,0)
     with minimal permission to view Patients' Immunization data, to print
"KRN",.84,9200001,2,15,0)
     Official Immunization Records, to view/print Due Lists, and to run
"KRN",.84,9200001,2,16,0)
     reports.
"KRN",.84,9200001,2,17,0)
     
"KRN",.84,9200001,2,18,0)
     
"KRN",.84,9200001,2,19,0)
     2 - BIZ EDIT PATIENTS
"KRN",.84,9200001,2,20,0)
     ---------------------
"KRN",.84,9200001,2,21,0)
     Gives Users the ability to ADD/EDIT Patients' immunization data,
"KRN",.84,9200001,2,22,0)
     contraindications, skin tests, and other patient information.  This
"KRN",.84,9200001,2,23,0)
     Key functions by making various Add/Edit Actions available on the
"KRN",.84,9200001,2,24,0)
     main Patient View screen of the Patient Immunization Record Option.
"KRN",.84,9200001,2,25,0)
     
"KRN",.84,9200001,2,26,0)
     (Users without this key will still be able to view patient data
"KRN",.84,9200001,2,27,0)
     from the Patient Immunization Record Option, but they will only be
"KRN",.84,9200001,2,28,0)
     able to view the Immunization data and the Health Summary, and print
"KRN",.84,9200001,2,29,0)
     the Official Immunization Record.)
"KRN",.84,9200001,2,30,0)
     
"KRN",.84,9200001,2,31,0)
     
"KRN",.84,9200001,2,32,0)
     3 - BIZ MANAGER
"KRN",.84,9200001,2,33,0)
     ---------------
"KRN",.84,9200001,2,34,0)
     Gives Users access to the Manager Menu of the New Immunization
"KRN",.84,9200001,2,35,0)
     Package and the full range of Manager functions, such as, editing
"KRN",.84,9200001,2,36,0)
     Case Managers, editing Form Letters, editing Site Parameters, etc.
"KRN",.84,9200001,2,37,0)
     Since you are here, you have the BIZ MANAGER Key described above and 
"KRN",.84,9200001,2,38,0)
     are allowed to allocate or de-allocate any of the Immunization (BIZ)
"KRN",.84,9200001,2,39,0)
     Keys to other Users.
"KRN",.84,9200001,2,40,0)
 
"KRN",.84,9200001,2,41,0)
 
"KRN",.84,9200001,2,42,0)
     4 - BIZ LOT ONLY
"KRN",.84,9200001,2,43,0)
     ----------------
"KRN",.84,9200001,2,44,0)
     This "stand-alone" option is NOT connected to the rest of the RPMS 
"KRN",.84,9200001,2,45,0)
     Immunization Menu; instead it may be assigned to any menu of any user
"KRN",.84,9200001,2,46,0)
     for the purpose of adding and editing Lot Numbers in the Immunization
"KRN",.84,9200001,2,47,0)
     Package. The option allows someone, such as a pharmacist, to add and
"KRN",.84,9200001,2,48,0)
     maintain the Lot Number Inventory without gaining access to the rest
"KRN",.84,9200001,2,49,0)
     of the Manager Menu in the Immunization Package.
"KRN",.84,9200001,2,50,0)
     
"KRN",.84,9200001,2,51,0)
     There are two Actions presented at the bottom of the screen:
"KRN",.84,9200001,2,52,0)
      
"KRN",.84,9200001,2,53,0)
        1 - "Add/Edit a Holder" allows you to allocate or deallocate the
"KRN",.84,9200001,2,54,0)
            Immunization Keys to users.
"KRN",.84,9200001,2,55,0)
        
"KRN",.84,9200001,2,56,0)
        2 - "Help" (this screen) presents a detailed explanation of the
"KRN",.84,9200001,2,57,0)
            privileges each Key bestows upon holders of the Key.
"KRN",.84,9200001,2,58,0)
 
"KRN",.84,9200001,2,59,0)
 
"KRN",.84,9200001,2,60,0)
     NOTE: If you intend to allocate Keys to a large number of Users,
"KRN",.84,9200001,2,61,0)
           it may be more convenient to have your Site Manager to this
"KRN",.84,9200001,2,62,0)
           in batch mode under the Site Manager's Key Management Menu.
"KRN",19,11571,-1)
0^5
"KRN",19,11571,0)
BI EXPORT IMMUNIZATIONS^Export Immunizations^^R^^^^^^^^^^^1
"KRN",19,11571,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11571,25)
BIEXP
"KRN",19,11571,"U")
EXPORT IMMUNIZATIONS
"KRN",19,11572,-1)
0^24
"KRN",19,11572,0)
BI PATIENT VIEW/EDIT^Single Patient Record^^A^^^^^^^^^^1^1^^
"KRN",19,11572,1,0)
^^3^3^2990402^
"KRN",19,11572,1,1,0)
Allows users to view and/or edit Patients' Immunization Records.
"KRN",19,11572,1,2,0)
A user must have the BIZ EDIT PATIENTS Key for Edit Actions to appear at
"KRN",19,11572,1,3,0)
the bottom of the screen.
"KRN",19,11572,15)
D MENUT^BIUTL5("PATIENT MENU")
"KRN",19,11572,20)
D ^BIPATVW
"KRN",19,11572,25)
BIPATVW
"KRN",19,11572,26)

"KRN",19,11572,"U")
SINGLE PATIENT RECORD
"KRN",19,11573,-1)
0^43
"KRN",19,11573,0)
BIMENU^Immunization Menu^^M^^BIZMENU^^^^^^^^1^1^^1
"KRN",19,11573,10,0)
^19.01IP^3^3
"KRN",19,11573,10,1,0)
11574^PAT^1
"KRN",19,11573,10,1,"^")
BI MENU-PATIENT
"KRN",19,11573,10,2,0)
11575^REP^2
"KRN",19,11573,10,2,"^")
BI MENU-REPORTS
"KRN",19,11573,10,3,0)
11576^MGR^3
"KRN",19,11573,10,3,"^")
BI MENU-MANAGER
"KRN",19,11573,15)
D KILLALL^BIUTL8(1)
"KRN",19,11573,20)
D CHECK^BILOGO
"KRN",19,11573,26)
D ^BILOGO
"KRN",19,11573,99)
63658,39659
"KRN",19,11573,"U")
IMMUNIZATION MENU
"KRN",19,11574,-1)
0^16
"KRN",19,11574,0)
BI MENU-PATIENT^Patient Menu^^M^^^^^^^^^^1^^^
"KRN",19,11574,10,0)
^19.01IP^3^3
"KRN",19,11574,10,1,0)
11572^SGL^1
"KRN",19,11574,10,1,"^")
BI PATIENT VIEW/EDIT
"KRN",19,11574,10,2,0)
11601^LLS^3
"KRN",19,11574,10,2,"^")
BI PATIENT LISTS & LETTERS
"KRN",19,11574,10,3,0)
11599^LET^2
"KRN",19,11574,10,3,"^")
BI PATIENT LETTER INDIVIDUAL
"KRN",19,11574,20)
D MENUT^BIUTL5("PATIENT MENU")
"KRN",19,11574,26)

"KRN",19,11574,99)
63658,39660
"KRN",19,11574,"U")
PATIENT MENU
"KRN",19,11575,-1)
0^17
"KRN",19,11575,0)
BI MENU-REPORTS^Reports Menu^^M^^^^^^^^^^1^^^
"KRN",19,11575,10,0)
^19.01IP^10^10
"KRN",19,11575,10,2,0)
11583^QTR^7
"KRN",19,11575,10,2,"^")
BI REPORT QUARTERLY IMM
"KRN",19,11575,10,3,0)
11584^TWO^8
"KRN",19,11575,10,3,"^")
BI REPORT TWO-YR RATES
"KRN",19,11575,10,4,0)
11585^VAC^9
"KRN",19,11575,10,4,"^")
BI REPORT VAC ACCOUNTABILITY
"KRN",19,11575,10,5,0)
11602^ADL^2
"KRN",19,11575,10,5,"^")
BI REPORT ADULT IMMS
"KRN",19,11575,10,6,0)
11604^ADO^1
"KRN",19,11575,10,6,"^")
BI REPORT ADOLESCENT IMMS
"KRN",19,11575,10,7,0)
11606^FLU^4
"KRN",19,11575,10,7,"^")
BI REPORT FLU
"KRN",19,11575,10,8,0)
11608^H1^5
"KRN",19,11575,10,8,"^")
BI REPORT H1N1 ACCOUNTABILITY
"KRN",19,11575,10,9,0)
11610^PCV^6
"KRN",19,11575,10,9,"^")
BI REPORT PCV
"KRN",19,11575,10,10,0)
11611^ELI^3
"KRN",19,11575,10,10,"^")
BI REPORT ELIGIBILITY
"KRN",19,11575,20)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11575,26)

"KRN",19,11575,99)
63658,39660
"KRN",19,11575,"U")
REPORTS MENU
"KRN",19,11576,-1)
0^14
"KRN",19,11576,0)
BI MENU-MANAGER^Manager Menu^^M^^BIZ MANAGER^^^^^^^^1^^^
"KRN",19,11576,10,0)
^19.01IP^23^20
"KRN",19,11576,10,1,0)
11577^LET^9
"KRN",19,11576,10,1,"^")
BI LETTER EDIT
"KRN",19,11576,10,2,0)
11578^ESP^7
"KRN",19,11576,10,2,"^")
BI SITE PARAMETERS EDIT
"KRN",19,11576,10,5,0)
11571^EXP^14
"KRN",19,11576,10,5,"^")
BI EXPORT IMMUNIZATIONS
"KRN",19,11576,10,7,0)
11587^LOT^10
"KRN",19,11576,10,7,"^")
BI LOT NUMBER ADD/EDIT
"KRN",19,11576,10,10,0)
11590^ERR^1
"KRN",19,11576,10,10,"^")
BI PATIENT ERRORS
"KRN",19,11576,10,11,0)
11591^CMG^2
"KRN",19,11576,10,11,"^")
BI CASE MANAGER ADD/EDIT
"KRN",19,11576,10,12,0)
11592^CMT^3
"KRN",19,11576,10,12,"^")
BI CASE MANAGER TRANSFER
"KRN",19,11576,10,17,0)
11597^KEY^15
"KRN",19,11576,10,17,"^")
BI KEYS ALLOCATE
"KRN",19,11576,10,18,0)
11598^^6
"KRN",19,11576,10,18,"^")
BI LINE FOR MENUS
"KRN",19,11576,10,21,0)
11603^SCN^3
"KRN",19,11576,10,21,"^")
BI PATIENTS SCAN
"KRN",19,11576,10,23,0)
11612^ELI^12
"KRN",19,11576,10,23,"^")
BI ELIGIBILITY TABLE EDIT
"KRN",19,11576,20)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11576,26)

"KRN",19,11576,99)
63680,52577
"KRN",19,11576,"U")
MANAGER MENU
"KRN",19,11577,-1)
0^9
"KRN",19,11577,0)
BI LETTER EDIT^Form Letters Add/Edit^^R^^^^^^^^^^^1
"KRN",19,11577,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11577,25)
BILETVW
"KRN",19,11577,"U")
FORM LETTERS ADD/EDIT
"KRN",19,11578,-1)
0^39
"KRN",19,11578,0)
BI SITE PARAMETERS EDIT^Site Parameters Edit^^R^^^^^^^^^^^1
"KRN",19,11578,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11578,25)
BISITE
"KRN",19,11578,"U")
SITE PARAMETERS EDIT
"KRN",19,11579,-1)
0^42
"KRN",19,11579,0)
BI VACCINE TABLE RESTAND^Restandardize Vaccine Table^Not used in VISTA^R^^^^^^^^^^^1
"KRN",19,11579,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11579,25)
RESTAND^BIRESTD("",1)
"KRN",19,11579,"U")
RESTANDARDIZE VACCINE TABLE
"KRN",19,11580,-1)
0^38
"KRN",19,11580,0)
BI REPORT VACCINE TRANSLAT^Translation Table of Vaccines^^R^^^^^^^^^^^1
"KRN",19,11580,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11580,25)
BIVTAB
"KRN",19,11580,"U")
TRANSLATION TABLE OF VACCINES
"KRN",19,11581,-1)
0^31
"KRN",19,11581,0)
BI REPORT ERROR CODE TABLE^Error Code Table^^R^^^^^^^^
"KRN",19,11581,25)
BIETAB
"KRN",19,11581,"U")
ERROR CODE TABLE
"KRN",19,11582,-1)
0^3
"KRN",19,11582,0)
BI DUE LISTS & LETTERS PRINT^Due Lists and Letters^^R^^^^^^^^^^^1^^
"KRN",19,11582,15)
D MENUT^BIUTL5("PATIENT MENU")
"KRN",19,11582,25)
BIDU
"KRN",19,11582,26)

"KRN",19,11582,"U")
DUE LISTS AND LETTERS
"KRN",19,11583,-1)
0^35
"KRN",19,11583,0)
BI REPORT QUARTERLY IMM^3-27 Month Report^^R^^^^^^^^^^^1
"KRN",19,11583,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11583,25)
BIREPQ
"KRN",19,11583,"U")
3-27 MONTH REPORT
"KRN",19,11584,-1)
0^36
"KRN",19,11584,0)
BI REPORT TWO-YR RATES^Two-Yr-Old Rates Report^^R^^^^^^^^^^^1
"KRN",19,11584,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11584,25)
BIREPT
"KRN",19,11584,"U")
TWO-YR-OLD RATES REPORT
"KRN",19,11585,-1)
0^37
"KRN",19,11585,0)
BI REPORT VAC ACCOUNTABILITY^Vaccine Accountability Report^^R^^^^^^^^^^^1
"KRN",19,11585,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11585,25)
BIREPA
"KRN",19,11585,"U")
VACCINE ACCOUNTABILITY REPORT
"KRN",19,11586,-1)
0^23
"KRN",19,11586,0)
BI PATIENT VIEW ONLY^View Patient Immunization Record^^A^^^^^^^^^^1
"KRN",19,11586,20)
D START^BIPATVW()
"KRN",19,11586,"U")
VIEW PATIENT IMMUNIZATION RECO
"KRN",19,11587,-1)
0^11
"KRN",19,11587,0)
BI LOT NUMBER ADD/EDIT^Lot Number Add/Edit^^A^^^^^^^^^^1^1
"KRN",19,11587,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11587,20)
D ^BILOT
"KRN",19,11587,"U")
LOT NUMBER ADD/EDIT
"KRN",19,11588,-1)
0^13
"KRN",19,11588,0)
BI MANUFACTURER ADD/EDIT^Manufacturer Add/Edit^^A^^^^^^^^^^1^1
"KRN",19,11588,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11588,20)
D MANUF^BIMANLOT
"KRN",19,11588,"U")
MANUFACTURER ADD/EDIT
"KRN",19,11589,-1)
0^26
"KRN",19,11589,0)
BI PATIENTS CONV PROBS PRINT^Print Conversion Problem Patients^^R^^^^^^^^^^^1
"KRN",19,11589,15)
D MENUT^BIUTL5("OLD PACKAGE CLEANUP MENU")
"KRN",19,11589,20)

"KRN",19,11589,25)
PROBPRT^BICONVP1
"KRN",19,11589,"U")
PRINT CONVERSION PROBLEM PATIE
"KRN",19,11590,-1)
0^20
"KRN",19,11590,0)
BI PATIENT ERRORS^Edit Patient Errors^^A^^^^^^^^^^1^1
"KRN",19,11590,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11590,20)
D ^BIPATER
"KRN",19,11590,"U")
EDIT PATIENT ERRORS
"KRN",19,11591,-1)
0^1
"KRN",19,11591,0)
BI CASE MANAGER ADD/EDIT^Add/Edit Case Manager^^A^^^^^^^^^^1^1
"KRN",19,11591,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11591,20)
D START^BICMGR
"KRN",19,11591,"U")
ADD/EDIT CASE MANAGER
"KRN",19,11592,-1)
0^2
"KRN",19,11592,0)
BI CASE MANAGER TRANSFER^Transfer a Case Manager's Patients^^A^^^^^^^^^^1^1
"KRN",19,11592,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11592,20)
D TRANS^BICMGR
"KRN",19,11592,"U")
TRANSFER A CASE MANAGER'S PATI
"KRN",19,11593,-1)
0^41
"KRN",19,11593,0)
BI VACCINE TABLE EDIT^Vaccine Table Edit^Not used in VISTA^A^^^^^^^^^^1^1
"KRN",19,11593,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11593,20)
D ^BIVACED
"KRN",19,11593,"U")
VACCINE TABLE EDIT
"KRN",19,11594,-1)
0^25
"KRN",19,11594,0)
BI PATIENTS CONV PROBS DELETE^Delete Conversion Problem Patients^^R^^^^^^^^^^^1
"KRN",19,11594,15)
D MENUT^BIUTL5("OLD PACKAGE CLEANUP MENU")
"KRN",19,11594,25)
PROBDEL^BICONVP1
"KRN",19,11594,"U")
DELETE CONVERSION PROBLEM PATI
"KRN",19,11595,-1)
0^15
"KRN",19,11595,0)
BI MENU-OLD PACKAGE^Old Package Cleanup Menu^^M^^^^^^^^^^1^1^^
"KRN",19,11595,10,0)
^19.01IP^3^3
"KRN",19,11595,10,1,0)
11589^PPP^1
"KRN",19,11595,10,1,"^")
BI PATIENTS CONV PROBS PRINT
"KRN",19,11595,10,2,0)
11594^DPP^2
"KRN",19,11595,10,2,"^")
BI PATIENTS CONV PROBS DELETE
"KRN",19,11595,10,3,0)
11596^OKY^3
"KRN",19,11595,10,3,"^")
BI KEY ALLOCATE NEW FROM OLD
"KRN",19,11595,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11595,20)
D MENUT^BIUTL5("OLD PACKAGE CLEANUP")
"KRN",19,11595,26)

"KRN",19,11595,99)
63658,39660
"KRN",19,11595,"U")
OLD PACKAGE CLEANUP MENU
"KRN",19,11596,-1)
0^7
"KRN",19,11596,0)
BI KEY ALLOCATE NEW FROM OLD^Allocate New Keys to Holders of Old^^R^^^^^^^^^^^1
"KRN",19,11596,15)
D MENUT^BIUTL5("OLD PACKAGE CLEANUP MENU")
"KRN",19,11596,25)
BIKEYS
"KRN",19,11596,"U")
ALLOCATE NEW KEYS TO HOLDERS O
"KRN",19,11597,-1)
0^8
"KRN",19,11597,0)
BI KEYS ALLOCATE^Allocate/Deallocate Imm Menu Keys^^R^^^^^^^^^^^1
"KRN",19,11597,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11597,25)
BIKEY
"KRN",19,11597,"U")
ALLOCATE/DEALLOCATE IMM MENU K
"KRN",19,11598,-1)
0^10
"KRN",19,11598,0)
BI LINE FOR MENUS^------------------------------^^E^^^^^^^^
"KRN",19,11598,"U")
------------------------------
"KRN",19,11599,-1)
0^21
"KRN",19,11599,0)
BI PATIENT LETTER INDIVIDUAL^Print Individual Patient Letter^^A^^^^^^^^^^1^1
"KRN",19,11599,15)
D MENUT^BIUTL5("PATIENT MENU")
"KRN",19,11599,20)
D PATLETS^BILETPR2
"KRN",19,11599,"U")
PRINT INDIVIDUAL PATIENT LETTE
"KRN",19,11600,-1)
0^19
"KRN",19,11600,0)
BI PACKAGE SETUP INFO VIEW^Package Setup Information^^R^^^^^^^^^^^1
"KRN",19,11600,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11600,25)
BINFO
"KRN",19,11600,"U")
PACKAGE SETUP INFORMATION
"KRN",19,11601,-1)
0^22
"KRN",19,11601,0)
BI PATIENT LISTS & LETTERS^Patient Lists and Letters^^R^^^^^^^^^^^1^^
"KRN",19,11601,15)
D MENUT^BIUTL5("PATIENT MENU")
"KRN",19,11601,25)
BIDU
"KRN",19,11601,26)

"KRN",19,11601,"U")
PATIENT LISTS AND LETTERS
"KRN",19,11602,-1)
0^29
"KRN",19,11602,0)
BI REPORT ADULT IMMS^Adult Report^^A^^^^^^^^^^1^1
"KRN",19,11602,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11602,20)
D ^BIREPL
"KRN",19,11602,"U")
ADULT REPORT
"KRN",19,11603,-1)
0^27
"KRN",19,11603,0)
BI PATIENTS SCAN^Scan For Patients^^A^^^^^^^^^^1^1
"KRN",19,11603,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11603,20)
D ^BISCAN
"KRN",19,11603,"U")
SCAN FOR PATIENTS
"KRN",19,11604,-1)
0^28
"KRN",19,11604,0)
BI REPORT ADOLESCENT IMMS^Adolescent Report^^A^^^^^^^^^^1^1
"KRN",19,11604,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11604,20)
D ^BIREPD
"KRN",19,11604,"U")
ADOLESCENT REPORT
"KRN",19,11605,-1)
0^12
"KRN",19,11605,0)
BI LOT NUMBER NON-MANAGER^Vaccine Lot Number Add/Edit^^A^^BIZ LOT ONLY^^^^^^^^1
"KRN",19,11605,1,0)
^19.06^4^4^3110916^^^
"KRN",19,11605,1,1,0)
This option may be assigned to any user for the purpose of adding and 
"KRN",19,11605,1,2,0)
editing Lot Numbers in the Immunization Package.  This option allows 
"KRN",19,11605,1,3,0)
someone, such as a pharmacist, access to Lot Numbers without providing 
"KRN",19,11605,1,4,0)
access to the rest of the Manager Menu in the Immunization Package.
"KRN",19,11605,20)
D ^BILOT
"KRN",19,11605,"U")
VACCINE LOT NUMBER ADD/EDIT
"KRN",19,11606,-1)
0^32
"KRN",19,11606,0)
BI REPORT FLU^Influenza Report^^R^^^^^^^^^^^1
"KRN",19,11606,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11606,25)
BIREPF
"KRN",19,11606,"U")
INFLUENZA REPORT
"KRN",19,11607,-1)
0^40
"KRN",19,11607,0)
BI TASKMAN FORECAST ALL^Forecast All Patients^^A^^^^^^^^^^1
"KRN",19,11607,20)
D FORCALL^BIRPC
"KRN",19,11607,"U")
FORECAST ALL PATIENTS
"KRN",19,11608,-1)
0^33
"KRN",19,11608,0)
BI REPORT H1N1 ACCOUNTABILITY^H1N1 Accountability Report^^R^^^^^^^^^^^1
"KRN",19,11608,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11608,25)
BIREPH
"KRN",19,11608,"U")
H1N1 ACCOUNTABILITY REPORT
"KRN",19,11609,-1)
0^6
"KRN",19,11609,0)
BI EXPORT VACCINE TABLE^Export Vaccine Table to Excel File^Won't port. Not imporant^R^^^^^^^^^^^1
"KRN",19,11609,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11609,25)
EXPVT^BIEXP
"KRN",19,11609,"U")
EXPORT VACCINE TABLE TO EXCEL 
"KRN",19,11610,-1)
0^34
"KRN",19,11610,0)
BI REPORT PCV^PCV Report^^A^^^^^^^^^^1^1
"KRN",19,11610,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11610,20)
D ^BIREPP
"KRN",19,11610,"U")
PCV REPORT
"KRN",19,11611,-1)
0^30
"KRN",19,11611,0)
BI REPORT ELIGIBILITY^Eligibility Report^^R^^^^^^^^^^^1
"KRN",19,11611,15)
D MENUT^BIUTL5("REPORTS MENU")
"KRN",19,11611,25)
BIREPE
"KRN",19,11611,"U")
ELIGIBILITY REPORT
"KRN",19,11612,-1)
0^4
"KRN",19,11612,0)
BI ELIGIBILITY TABLE EDIT^Eligibility Table Edit^^A^^^^^^^^^^1^1
"KRN",19,11612,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11612,20)
D ^BIELIG
"KRN",19,11612,"U")
ELIGIBILITY TABLE EDIT
"KRN",19,11613,-1)
0^18
"KRN",19,11613,0)
BI NDC ADD/EDIT^NDC Code Add/Edit^Not used in VISTA^A^^^^^^^^^^1^1
"KRN",19,11613,15)
D MENUT^BIUTL5("MANAGER MENU")
"KRN",19,11613,20)
D ^BINDC
"KRN",19,11613,"U")
NDC CODE ADD/EDIT
"KRN",19.1,587,-1)
0^4
"KRN",19.1,587,0)
BIZ MANAGER^Manager to New Immunization
"KRN",19.1,588,-1)
0^5
"KRN",19.1,588,0)
BIZMENU^Immunization package
"KRN",19.1,589,-1)
0^1
"KRN",19.1,589,0)
BIZ EDIT PATIENTS^Edit Immunization Patients^
"KRN",19.1,589,1,0)
^^1^1^2990402^^^^
"KRN",19.1,589,1,1,0)
Allows holder to edit a Patient's Immunization History.
"KRN",19.1,590,-1)
0^2
"KRN",19.1,590,0)
BIZ LOT NON-MANAGER^Vaccine Lot Add/Edit
"KRN",19.1,590,1,0)
^^3^3^3070508^
"KRN",19.1,590,1,1,0)
This key will allow a person who does NOT have Manager privileges in the 
"KRN",19.1,590,1,2,0)
Immunization Package to add and edit lot numbers.  This key is intended 
"KRN",19.1,590,1,3,0)
mainly for pharmacists.
"KRN",19.1,591,-1)
0^3
"KRN",19.1,591,0)
BIZ LOT ONLY^BIZ LOT ONLY
"KRN",19.1,591,1,0)
^19.11^3^3^3080221^^
"KRN",19.1,591,1,1,0)
This key will allow a person who does NOT have Manager privileges in the 
"KRN",19.1,591,1,2,0)
Immunization Package to add and edit lot numbers.  This key is intended 
"KRN",19.1,591,1,3,0)
mainly for pharmacists.
"KRN",101,4675,-1)
0^32
"KRN",101,4675,0)
BI QUIT^Quit^^A^^^^^^^^
"KRN",101,4675,20)
Q
"KRN",101,4675,99)
63658,43400
"KRN",101,4676,-1)
0^1
"KRN",101,4676,0)
BI MENU SITE PARAMETERS^Edit Site Parameters^^M^^^^^^^^
"KRN",101,4676,4)
25^3
"KRN",101,4676,10,0)
^101.01PA^1^1
"KRN",101,4676,26)
D SHOW^VALM
"KRN",101,4676,28)
Select Action: 
"KRN",101,4676,29)
Quit
"KRN",101,4676,99)
63658,43400
"KRN",101,4677,-1)
0^3
"KRN",101,4677,0)
BI SITE CASE MANAGER^Edit Default Case Mgr^^A^^^^^^^^
"KRN",101,4677,20)
D CMGR^BISITE2
"KRN",101,4677,99)
63658,43400
"KRN",101,4678,-1)
0^19
"KRN",101,4678,0)
BI SITE OTHER LOCATION^Select Other Location^^A^^^^^^^^
"KRN",101,4678,20)
D OTHER^BISITE2
"KRN",101,4678,99)
63658,43400
"KRN",101,4679,-1)
0^7
"KRN",101,4679,0)
BI SITE DUE LETTER^Select Due Letter^^A^^^^^^^^
"KRN",101,4679,20)
D DUELET^BISITE2
"KRN",101,4679,99)
63658,43400
"KRN",101,4680,-1)
0^22
"KRN",101,4680,0)
BI SITE REPORT HEADER^Edit Report Header^^A^^^^^^^^
"KRN",101,4680,10,0)
^101.01PA
"KRN",101,4680,20)
D REPHDR^BISITE2
"KRN",101,4680,99)
63658,43400
"KRN",101,4681,-1)
0^12
"KRN",101,4681,0)
BI SITE HFS PATH^Edit HFS Path^^A^^^^^^^^
"KRN",101,4681,20)
D HFSPATH^BISITE2
"KRN",101,4681,99)
63658,43400
"KRN",101,4682,-1)
0^17
"KRN",101,4682,0)
BI SITE MIN DAYS LAST LET^Edit Minimum Days^^A^^^^^^^^
"KRN",101,4682,20)
D MINDAYS^BISITE2
"KRN",101,4682,99)
63658,43400
"KRN",101,4683,-1)
0^2
"KRN",101,4683,0)
BI MENU SITE PARAMS HIDDEN^Edit Site Params Hidden^^M^^^^^^^^
"KRN",101,4683,10,0)
^101.01PA^33^33
"KRN",101,4683,10,1,0)
4677^1^1^
"KRN",101,4683,10,1,"^")
BI SITE CASE MANAGER
"KRN",101,4683,10,2,0)
4678^2^2^
"KRN",101,4683,10,2,"^")
BI SITE OTHER LOCATION
"KRN",101,4683,10,3,0)
4679^3^3^
"KRN",101,4683,10,3,"^")
BI SITE DUE LETTER
"KRN",101,4683,10,4,0)
4680^5^5^
"KRN",101,4683,10,4,"^")
BI SITE REPORT HEADER
"KRN",101,4683,10,5,0)
4681^6^6^
"KRN",101,4683,10,5,"^")
BI SITE HFS PATH
"KRN",101,4683,10,6,0)
4682^7^7^
"KRN",101,4683,10,6,"^")
BI SITE MIN DAYS LAST LET
"KRN",101,4683,10,8,0)
4685^9^9^
"KRN",101,4683,10,8,"^")
BI SITE FORC RULES
"KRN",101,4683,10,9,0)
4684^8^8^
"KRN",101,4683,10,9,"^")
BI SITE FORC MIN VS RECOMM
"KRN",101,4683,10,10,0)
4686^10^10^
"KRN",101,4683,10,10,"^")
BI SITE LOT# REQ'D
"KRN",101,4683,10,11,0)
4704^11^11^
"KRN",101,4683,10,11,"^")
BI SITE PNEUMO/FLU PARAMETERS
"KRN",101,4683,10,12,0)
4688^12^12^
"KRN",101,4683,10,12,"^")
BI SITE FORECAST ENABLE
"KRN",101,4683,10,14,0)
4689^13^13^
"KRN",101,4683,10,14,"^")
BI SITE CHART# DASHES
"KRN",101,4683,10,15,0)
4690^4^4^
"KRN",101,4683,10,15,"^")
BI SITE OFFICIAL PT RECORD
"KRN",101,4683,10,16,0)
4691^14^14^
"KRN",101,4683,10,16,"^")
BI SITE DEFAULT PROVIDER
"KRN",101,4683,10,17,0)
4706^15^15^
"KRN",101,4683,10,17,"^")
BI SITE IP TCH FORECASTER
"KRN",101,4683,10,18,0)
4694^16^16^
"KRN",101,4683,10,18,"^")
BI SITE GPRA COMS
"KRN",101,4683,10,19,0)
4697^17^17^
"KRN",101,4683,10,19,"^")
BI SITE INPATIENT CHECK ENABLE
"KRN",101,4683,10,23,0)
4698^18^18^
"KRN",101,4683,10,23,"^")
BI SITE RISK CHECK ENABLE
"KRN",101,4683,10,24,0)
4699^19^19^
"KRN",101,4683,10,24,"^")
BI SITE CPT VISITS IMPORT
"KRN",101,4683,10,25,0)
4695^UP^21^
"KRN",101,4683,10,25,"^")
BI UP ONE LINE
"KRN",101,4683,10,26,0)
4696^DN^22^
"KRN",101,4683,10,26,"^")
BI DOWN A LINE
"KRN",101,4683,10,27,0)
4693^PL^23^
"KRN",101,4683,10,27,"^")
BI PRINT LIST
"KRN",101,4683,10,28,0)
4700^+^^
"KRN",101,4683,10,28,"^")
BI NEXT SCREEN
"KRN",101,4683,10,29,0)
4701^-^^
"KRN",101,4683,10,29,"^")
BI PREVIOUS SCREEN
"KRN",101,4683,10,30,0)
4702^LS^^
"KRN",101,4683,10,30,"^")
BI LAST SCREEN
"KRN",101,4683,10,31,0)
4703^FS^^
"KRN",101,4683,10,31,"^")
BI FIRST SCREEN
"KRN",101,4683,10,32,0)
4705^20^20^
"KRN",101,4683,10,32,"^")
BI SITE VISIT SELECTION MENU
"KRN",101,4683,10,33,0)
4675^Q^^
"KRN",101,4683,10,33,"^")
BI QUIT
"KRN",101,4683,99)
63658,43400
"KRN",101,4684,-1)
0^8
"KRN",101,4684,0)
BI SITE FORC MIN VS RECOMM^Forecast Min vs Recommended^^A^^^^^^^^
"KRN",101,4684,20)
D MINAGE^BISITE2
"KRN",101,4684,99)
63658,43400
"KRN",101,4685,-1)
0^9
"KRN",101,4685,0)
BI SITE FORC RULES^Forecasting Rules^^A^^^^^^^^
"KRN",101,4685,20)
D RULES^BISITE2
"KRN",101,4685,99)
63658,43400
"KRN",101,4686,-1)
0^16
"KRN",101,4686,0)
BI SITE LOT# REQ'D^Edit Lot# Required^^A^^^^^^^^
"KRN",101,4686,20)
D LOTREQ^BISITE3
"KRN",101,4686,99)
63658,43400
"KRN",101,4687,-1)
0^20
"KRN",101,4687,0)
BI SITE PNEUMO AGE^Appropriate Age for Pneumo^^A^^^^^^^^
"KRN",101,4687,20)
D PNEUMO^BISITE3
"KRN",101,4687,99)
63658,43400
"KRN",101,4688,-1)
0^10
"KRN",101,4688,0)
BI SITE FORECAST ENABLE^Enable Forecasting^^A^^^^^^^^
"KRN",101,4688,20)
D FORECAS^BISITE3
"KRN",101,4688,99)
63658,43400
"KRN",101,4689,-1)
0^4
"KRN",101,4689,0)
BI SITE CHART# DASHES^Chart# with dashes^^A^^^^^^^^
"KRN",101,4689,20)
D DASHES^BISITE3
"KRN",101,4689,99)
63658,43400
"KRN",101,4690,-1)
0^18
"KRN",101,4690,0)
BI SITE OFFICIAL PT RECORD^Select Official Imm Record^^A^^^^^^^^
"KRN",101,4690,20)
D OFFREC^BISITE3
"KRN",101,4690,99)
63658,43400
"KRN",101,4691,-1)
0^6
"KRN",101,4691,0)
BI SITE DEFAULT PROVIDER^Default Provider^^A^^^^^^^^
"KRN",101,4691,20)
D DEFPRV^BISITE3
"KRN",101,4691,99)
63658,43400
"KRN",101,4692,-1)
0^13
"KRN",101,4692,0)
BI SITE IMMSERVE DIRECTORY^ImmServe Directory^^A^^^^^^^^
"KRN",101,4692,20)
D IMMSVDIR^BISITE3
"KRN",101,4692,99)
63658,43400
"KRN",101,4693,-1)
0^27
"KRN",101,4693,0)
BI PRINT LIST^Print List^^A^^^^^^^^
"KRN",101,4693,20)
D PRTL^VALM1
"KRN",101,4693,99)
63658,43400
"KRN",101,4694,-1)
0^11
"KRN",101,4694,0)
BI SITE GPRA COMS^GPRA Communities^^A^^^^^^^^
"KRN",101,4694,20)
D GPRA^BISITE4
"KRN",101,4694,99)
63658,43400
"KRN",101,4695,-1)
0^25
"KRN",101,4695,0)
BI UP ONE LINE^Up a Line^^A^^^^^^^^
"KRN",101,4695,1,0)
^101.06^1^1^3050715^^
"KRN",101,4695,1,1,0)
Move up a line
"KRN",101,4695,20)
D UP^VALM40
"KRN",101,4695,99)
63658,43400
"KRN",101,4696,-1)
0^26
"KRN",101,4696,0)
BI DOWN A LINE^Down a Line^^A^^^^^^^^
"KRN",101,4696,1,0)
^^2^2^2911027^
"KRN",101,4696,1,1,0)
Move down a line.
"KRN",101,4696,1,2,0)

"KRN",101,4696,20)
D DOWN^VALM40
"KRN",101,4696,99)
63658,43400
"KRN",101,4697,-1)
0^14
"KRN",101,4697,0)
BI SITE INPATIENT CHECK ENABLE^Inpatient Visit Chk^^A^^^^^^^^
"KRN",101,4697,20)
D INPTCHK^BISITE4
"KRN",101,4697,99)
63658,43400
"KRN",101,4698,-1)
0^23
"KRN",101,4698,0)
BI SITE RISK CHECK ENABLE^Risk Enabled Check^^A^^^^^^^^
"KRN",101,4698,20)
D RISKP^BISITE4
"KRN",101,4698,99)
63658,43400
"KRN",101,4699,-1)
0^5
"KRN",101,4699,0)
BI SITE CPT VISITS IMPORT^Import CPT-coded Visits^^A^^^^^^^^
"KRN",101,4699,20)
D IMPCPT^BISITE4
"KRN",101,4699,99)
63658,43400
"KRN",101,4700,-1)
0^28
"KRN",101,4700,0)
BI NEXT SCREEN^Next Screen^^A^^^^^^^^
"KRN",101,4700,2,0)
^101.02A^1^1
"KRN",101,4700,2,1,0)
NX
"KRN",101,4700,2,"B","NX",1)

"KRN",101,4700,20)
D NEXT^VALM4
"KRN",101,4700,99)
63658,43400
"KRN",101,4701,-1)
0^29
"KRN",101,4701,0)
BI PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^
"KRN",101,4701,2,0)
^101.02A^2^2
"KRN",101,4701,2,1,0)
PR
"KRN",101,4701,2,2,0)
BK
"KRN",101,4701,2,"B","BK",2)

"KRN",101,4701,2,"B","PR",1)

"KRN",101,4701,20)
D PREV^VALM4
"KRN",101,4701,99)
63658,43400
"KRN",101,4702,-1)
0^30
"KRN",101,4702,0)
BI LAST SCREEN^Last Screen^^A^^^^^^^^
"KRN",101,4702,20)
D LAST^VALM4
"KRN",101,4702,99)
63658,43400
"KRN",101,4703,-1)
0^31
"KRN",101,4703,0)
BI FIRST SCREEN^First Screen^^A^^^^^^^^
"KRN",101,4703,20)
D FIRST^VALM4
"KRN",101,4703,99)
63658,43400
"KRN",101,4704,-1)
0^21
"KRN",101,4704,0)
BI SITE PNEUMO/FLU PARAMETERS^Pneumo & Flu Parameters^^A^^^^^^^^
"KRN",101,4704,20)
D PNUFLU^BISITE3
"KRN",101,4704,99)
63658,43400
"KRN",101,4705,-1)
0^24
"KRN",101,4705,0)
BI SITE VISIT SELECTION MENU^Visit Selection Menu^^A^^^^^^^^
"KRN",101,4705,20)
D VISMNU^BISITE4
"KRN",101,4705,99)
63658,43400
"KRN",101,4706,-1)
0^15
"KRN",101,4706,0)
BI SITE IP TCH FORECASTER^IP for TCH Forecaster^^A^^^^^^^^
"KRN",101,4706,20)
D IPTCH^BISITE3
"KRN",101,4706,99)
63658,43400
"KRN",101,4707,-1)
0^33
"KRN",101,4707,0)
BI MENU LETTER FORM^Form Letter View/Edit^^M^^^^^^^^
"KRN",101,4707,.1)
VIEW
"KRN",101,4707,4)
25^3
"KRN",101,4707,10,0)
^101.01PA^9^9
"KRN",101,4707,10,1,0)
4708^T^1^
"KRN",101,4707,10,1,"^")
BI LETTER EDIT TOP
"KRN",101,4707,10,2,0)
4709^M^3^
"KRN",101,4707,10,2,"^")
BI LETTER EDIT MIDDLE
"KRN",101,4707,10,3,0)
4710^B^5^
"KRN",101,4707,10,3,"^")
BI LETTER EDIT BOTTOM
"KRN",101,4707,10,4,0)
4711^H^2^
"KRN",101,4707,10,4,"^")
BI LETTER HISTORY
"KRN",101,4707,10,5,0)
4712^F^4^
"KRN",101,4707,10,5,"^")
BI LETTER FORECAST
"KRN",101,4707,10,6,0)
4714^D^6^
"KRN",101,4707,10,6,"^")
BI LETTER DATE/LOCATION
"KRN",101,4707,10,7,0)
4713^C^7^
"KRN",101,4707,10,7,"^")
BI LETTER EDIT CLOSING
"KRN",101,4707,10,8,0)
4715^P^8^
"KRN",101,4707,10,8,"^")
BI LETTER PRINT SAMPLE
"KRN",101,4707,10,9,0)
4716^X^9^
"KRN",101,4707,10,9,"^")
BI LETTER DELETE
"KRN",101,4707,26)
D SHOW^VALM
"KRN",101,4707,28)
Select Action: 
"KRN",101,4707,29)
Quit
"KRN",101,4707,99)
63677,47094
"KRN",101,4708,-1)
0^39
"KRN",101,4708,0)
BI LETTER EDIT TOP^Top^^A^^^^^^^^
"KRN",101,4708,20)
D EDITSEC^BILETVW2(1)
"KRN",101,4708,99)
63677,47094
"KRN",101,4709,-1)
0^38
"KRN",101,4709,0)
BI LETTER EDIT MIDDLE^Middle^^A^^^^^^^^
"KRN",101,4709,20)
D EDITSEC^BILETVW2(2)
"KRN",101,4709,99)
63677,47094
"KRN",101,4710,-1)
0^36
"KRN",101,4710,0)
BI LETTER EDIT BOTTOM^Bottom^^A^^^^^^^^
"KRN",101,4710,20)
D EDITSEC^BILETVW2(3)
"KRN",101,4710,99)
63677,47094
"KRN",101,4711,-1)
0^41
"KRN",101,4711,0)
BI LETTER HISTORY^History^^A^^^^^^^^
"KRN",101,4711,20)
D HISTORY^BILETVW2
"KRN",101,4711,99)
63677,47094
"KRN",101,4712,-1)
0^40
"KRN",101,4712,0)
BI LETTER FORECAST^Forecast^^A^^^^^^^^
"KRN",101,4712,20)
D FORECAST^BILETVW2
"KRN",101,4712,99)
63677,47094
"KRN",101,4713,-1)
0^37
"KRN",101,4713,0)
BI LETTER EDIT CLOSING^Closing^^A^^^^^^^^
"KRN",101,4713,20)
D EDITSEC^BILETVW2(4)
"KRN",101,4713,99)
63677,47094
"KRN",101,4714,-1)
0^34
"KRN",101,4714,0)
BI LETTER DATE/LOCATION^Date/Loc^^A^^^^^^^^
"KRN",101,4714,20)
D DATELOC^BILETVW2
"KRN",101,4714,99)
63677,47094
"KRN",101,4715,-1)
0^43
"KRN",101,4715,0)
BI LETTER PRINT SAMPLE^Print Sample Letter^^A^^^^^^^^
"KRN",101,4715,20)
D PRINTSAM^BILETVW2
"KRN",101,4715,99)
63677,47094
"KRN",101,4716,-1)
0^35
"KRN",101,4716,0)
BI LETTER DELETE^Delete Form Letter^^A^^^^^^^^
"KRN",101,4716,20)
D DELETLET^BILETVW2
"KRN",101,4716,99)
63677,47094
"KRN",101,4717,-1)
0^42
"KRN",101,4717,0)
BI LETTER PRINT INDIVIDUAL^Letter Print^^A^^^^^^^^
"KRN",101,4717,15)

"KRN",101,4717,20)
D INDIVLET^BILETPR2($G(BIDFN),$G(BIRTN))
"KRN",101,4717,99)
63693,39927
"KRN",101,4718,-1)
0^48
"KRN",101,4718,0)
BI BLANK^   ^^^^^^^^^^
"KRN",101,4718,4)
^3
"KRN",101,4718,99)
63735,41045
"KRN",101,4719,-1)
0^47
"KRN",101,4719,0)
BI MENU PACKAGE INFO VIEW^View Package Information^^M^^^^^^^^
"KRN",101,4719,4)
30^3
"KRN",101,4719,10,0)
^101.01PA^2^1
"KRN",101,4719,10,2,0)
4718^^1^
"KRN",101,4719,10,2,"^")
BI BLANK
"KRN",101,4719,26)
D SHOW^VALM
"KRN",101,4719,28)
Select Action: 
"KRN",101,4719,29)
Quit
"KRN",101,4719,99)
63735,41045
"KRN",101,4720,-1)
0^44
"KRN",101,4720,0)
BI MENU KEY HOLDERS^Key Holders^^M^^^^^^^^
"KRN",101,4720,4)
25^3
"KRN",101,4720,10,0)
^101.01PA^5^5
"KRN",101,4720,10,4,0)
4722^A^1^
"KRN",101,4720,10,4,"^")
BI KEYS ALLOCATE/DEALLOC
"KRN",101,4720,10,5,0)
4721^H^2^
"KRN",101,4720,10,5,"^")
BI KEYS HELP VIEW
"KRN",101,4720,26)
D SHOW^VALM
"KRN",101,4720,28)
Select Action: 
"KRN",101,4720,29)
Quit
"KRN",101,4720,99)
63680,57187
"KRN",101,4721,-1)
0^46
"KRN",101,4721,0)
BI KEYS HELP VIEW^Help^^A^^^^^^^^
"KRN",101,4721,20)
D ^BIKEY2
"KRN",101,4721,99)
63680,57187
"KRN",101,4722,-1)
0^45
"KRN",101,4722,0)
BI KEYS ALLOCATE/DEALLOC^Add/Edit a Holder^^A^^^^^^^^
"KRN",101,4722,20)
D ^BIKEY1
"KRN",101,4722,99)
63680,57187
"KRN",101,4723,-1)
0^54
"KRN",101,4723,0)
BI LOT NUMBER PRINT^Print Lot Number Table^^A^^^^^^^^
"KRN",101,4723,20)
D PRINT^BILOT
"KRN",101,4723,99)
63692,41244
"KRN",101,4724,-1)
0^50
"KRN",101,4724,0)
BI LOT NUMBER CHANGE ORDER^Change List Order^^A^^^^^^^^
"KRN",101,4724,20)
D CHGORDR^BILOT1
"KRN",101,4724,99)
63692,41244
"KRN",101,4725,-1)
0^52
"KRN",101,4725,0)
BI LOT NUMBER EDIT^Edit a Lot Number^^A^^^^^^^^
"KRN",101,4725,20)
D EDITLOT^BILOT1()
"KRN",101,4725,99)
63692,41244
"KRN",101,4726,-1)
0^53
"KRN",101,4726,0)
BI LOT NUMBER HELP^Help^^A^^^^^^^^
"KRN",101,4726,20)
D HELP1^BILOT
"KRN",101,4726,99)
63692,41244
"KRN",101,4727,-1)
0^49
"KRN",101,4727,0)
BI LOT NUMBER ADD^Add a Lot Number^^A^^^^^^^^
"KRN",101,4727,20)
D EDITLOT^BILOT1(1)
"KRN",101,4727,99)
63692,41244
"KRN",101,4728,-1)
0^55
"KRN",101,4728,0)
BI LOT NUMBERS INACTIVATE OLD^Inactivate Old Lots^^A^^^^^^^^
"KRN",101,4728,20)
D INACTA^BILOT1
"KRN",101,4728,99)
63692,41244
"KRN",101,4729,-1)
0^56
"KRN",101,4729,0)
BI SEARCH LIST^Search List^^A^^^^^^^^
"KRN",101,4729,20)
D FIND^VALM40
"KRN",101,4729,99)
63692,41244
"KRN",101,4730,-1)
0^51
"KRN",101,4730,0)
BI LOT NUMBER DISP INACTIVE^Display Inactives Yes/No^^A^^^^^^^^
"KRN",101,4730,20)
D DISPLYI^BILOT2
"KRN",101,4730,99)
63692,41244
"KRN",101,4731,-1)
0^57
"KRN",101,4731,0)
BI MENU LOT NUMBER EDIT^Lot Number Edit^^M^^^^^^^^
"KRN",101,4731,4)
25^3
"KRN",101,4731,10,0)
^101.01PA^12^12
"KRN",101,4731,10,3,0)
4724^C^2^
"KRN",101,4731,10,3,"^")
BI LOT NUMBER CHANGE ORDER
"KRN",101,4731,10,4,0)
4725^E^4^
"KRN",101,4731,10,4,"^")
BI LOT NUMBER EDIT
"KRN",101,4731,10,5,0)
4726^H^9^
"KRN",101,4731,10,5,"^")
BI LOT NUMBER HELP
"KRN",101,4731,10,7,0)
4727^A^1^
"KRN",101,4731,10,7,"^")
BI LOT NUMBER ADD
"KRN",101,4731,10,8,0)
4728^I^8^
"KRN",101,4731,10,8,"^")
BI LOT NUMBERS INACTIVATE OLD
"KRN",101,4731,10,9,0)
4729^S^5^
"KRN",101,4731,10,9,"^")
BI SEARCH LIST
"KRN",101,4731,10,10,0)
4718^^3^
"KRN",101,4731,10,10,"^")
BI BLANK
"KRN",101,4731,10,11,0)
4718^^6^
"KRN",101,4731,10,11,"^")
BI BLANK
"KRN",101,4731,10,12,0)
4730^D^7^
"KRN",101,4731,10,12,"^")
BI LOT NUMBER DISP INACTIVE
"KRN",101,4731,26)
D SHOW^VALM
"KRN",101,4731,28)
Select Action: 
"KRN",101,4731,29)
Quit
"KRN",101,4731,99)
63749,40733
"KRN",101,4732,-1)
0^62
"KRN",101,4732,0)
BI MENU PATIENT VIEW^View Patient Imm Data^^M^^^^^^^^
"KRN",101,4732,.1)
VIEW
"KRN",101,4732,4)
25^3
"KRN",101,4732,10,0)
^101.01PA^22^22
"KRN",101,4732,10,12,0)
4733^E^3^
"KRN",101,4732,10,12,"^")
BI IMMUNIZATION VISIT EDIT
"KRN",101,4732,10,14,0)
4734^H^6^
"KRN",101,4732,10,14,"^")
BI HEALTH SUMMARY
"KRN",101,4732,10,16,0)
4735^D^4^
"KRN",101,4732,10,16,"^")
BI IMMUNIZATION VISIT DELETE
"KRN",101,4732,10,17,0)
4736^A^1^
"KRN",101,4732,10,17,"^")
BI IMMUNIZATION VISIT ADD
"KRN",101,4732,10,18,0)
4737^S^2^
"KRN",101,4732,10,18,"^")
BI SKIN TEST VISIT ADD
"KRN",101,4732,10,19,0)
4738^P^7^
"KRN",101,4732,10,19,"^")
BI PATIENT CASE DATA EDIT
"KRN",101,4732,10,20,0)
4739^C^8^
"KRN",101,4732,10,20,"^")
BI CONTRAINDICATIONS
"KRN",101,4732,10,21,0)
4717^L^9^
"KRN",101,4732,10,21,"^")
BI LETTER PRINT INDIVIDUAL
"KRN",101,4732,10,22,0)
4741^R^5^
"KRN",101,4732,10,22,"^")
BI PATIENT PROFILE VIEW
"KRN",101,4732,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4732,26)
D SHOW^VALM
"KRN",101,4732,28)
Select Action: 
"KRN",101,4732,29)
Quit
"KRN",101,4732,99)
63693,39927
"KRN",101,4733,-1)
0^63
"KRN",101,4733,0)
BI IMMUNIZATION VISIT EDIT^Edit Visit^^A^^^^^^^^
"KRN",101,4733,2,0)
^101.02A^^0
"KRN",101,4733,15)
S VALMBCK="R"
"KRN",101,4733,20)
D EDITIMM^BIPATVW2
"KRN",101,4733,99)
63693,39927
"KRN",101,4734,-1)
0^59
"KRN",101,4734,0)
BI HEALTH SUMMARY^Health Summary^^A^^^^^^^^
"KRN",101,4734,4)
^
"KRN",101,4734,15)
S VALMBCK="R"
"KRN",101,4734,20)
D ^BIHS
"KRN",101,4734,26)

"KRN",101,4734,28)

"KRN",101,4734,29)

"KRN",101,4734,99)
63693,39927
"KRN",101,4735,-1)
0^64
"KRN",101,4735,0)
BI IMMUNIZATION VISIT DELETE^Delete Visit^^A^^^^^^^^
"KRN",101,4735,15)
S VALMBCK="R"
"KRN",101,4735,20)
D DELETIMM^BIPATVW2
"KRN",101,4735,24)

"KRN",101,4735,99)
63693,39927
"KRN",101,4736,-1)
0^65
"KRN",101,4736,0)
BI IMMUNIZATION VISIT ADD^Add Immunization^^A^^^^^^^^
"KRN",101,4736,15)
S VALMBCK="R"
"KRN",101,4736,20)
D ADDIMM^BIPATVW2
"KRN",101,4736,24)

"KRN",101,4736,99)
63693,39927
"KRN",101,4737,-1)
0^66
"KRN",101,4737,0)
BI SKIN TEST VISIT ADD^Skin Test Add^^A^^^^^^^^
"KRN",101,4737,2,0)
^101.02A^^0
"KRN",101,4737,4)
^^^
"KRN",101,4737,15)
S VALMBCK="R"
"KRN",101,4737,20)
D ADDSK^BIPATVW2
"KRN",101,4737,99)
63693,39927
"KRN",101,4738,-1)
0^67
"KRN",101,4738,0)
BI PATIENT CASE DATA EDIT^Patient Edit^^A^^^^^^^^
"KRN",101,4738,15)
D RESET^BIPATVW
"KRN",101,4738,20)
D SCREEN^BIPATE($G(BIDFN))
"KRN",101,4738,99)
63693,39927
"KRN",101,4739,-1)
0^68
"KRN",101,4739,0)
BI CONTRAINDICATIONS^Contraindications^^A^^^^^^^^
"KRN",101,4739,2,0)
^101.02A^^0
"KRN",101,4739,15)
D RESET^BIPATVW
"KRN",101,4739,20)
D EN^BIPATCO($G(BIDFN))
"KRN",101,4739,99)
63693,39927
"KRN",101,4740,-1)
0^58
"KRN",101,4740,0)
BI MENU PATIENT VIEW ONLY^View ONLY Patient Imm Data^^M^^^^^^^^
"KRN",101,4740,.1)
VIEW
"KRN",101,4740,4)
26^3
"KRN",101,4740,10,0)
^101.01PA^20^20
"KRN",101,4740,10,14,0)
4734^H^5^
"KRN",101,4740,10,14,"^")
BI HEALTH SUMMARY
"KRN",101,4740,10,17,0)
4741^R^1^
"KRN",101,4740,10,17,"^")
BI PATIENT PROFILE VIEW
"KRN",101,4740,10,18,0)
4743^O^3^
"KRN",101,4740,10,18,"^")
BI OFFICIAL IMM REC PRINT
"KRN",101,4740,10,19,0)
4718^^2^
"KRN",101,4740,10,19,"^")
BI BLANK
"KRN",101,4740,10,20,0)
4718^^4^
"KRN",101,4740,10,20,"^")
BI BLANK
"KRN",101,4740,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4740,26)
D SHOW^VALM
"KRN",101,4740,28)
Select Action: 
"KRN",101,4740,29)
Quit
"KRN",101,4740,99)
63735,41045
"KRN",101,4741,-1)
0^60
"KRN",101,4741,0)
BI PATIENT PROFILE VIEW^Report Text^^A^^^^^^^^
"KRN",101,4741,15)
S VALMBCK="R"
"KRN",101,4741,20)
D HAVEPAT^BIPATPF(BIDFN,$G(BIFDT),$G(BIDUZ2))
"KRN",101,4741,99)
63693,39927
"KRN",101,4742,-1)
0^69
"KRN",101,4742,0)
BI PATIENT VIEW PRINT^Print Patient Data^^A^^^^^^^^
"KRN",101,4742,20)
D HAVEPAT^BIPATVW($G(BIDFN),$G(BIFDT),1)
"KRN",101,4742,99)
63693,39927
"KRN",101,4743,-1)
0^61
"KRN",101,4743,0)
BI OFFICIAL IMM REC PRINT^Official Imm Record^^A^^^^^^^^
"KRN",101,4743,20)
D OFFICIAL^BILETPR2($G(BIDFN),$G(BIRTN))
"KRN",101,4743,99)
63693,39927
"KRN",101,4744,-1)
0^70
"KRN",101,4744,0)
BI MENU GENERIC HELP VIEW^View Help Text^^M^^^^^^^^
"KRN",101,4744,4)
30^3
"KRN",101,4744,10,0)
^101.01PA^2^1
"KRN",101,4744,10,2,0)
4718^^1^
"KRN",101,4744,10,2,"^")
BI BLANK
"KRN",101,4744,26)
D SHOW^VALM
"KRN",101,4744,28)
Select Action:
"KRN",101,4744,29)
 Quit
"KRN",101,4744,99)
63735,41045
"KRN",101,4745,-1)
0^71
"KRN",101,4745,0)
BI MENU CONTRAINDICATIONS^Contraindications^^M^^^^^^^^
"KRN",101,4745,.1)
VIEW
"KRN",101,4745,4)
30^3
"KRN",101,4745,10,0)
^101.01PA^4^4
"KRN",101,4745,10,1,0)
4746^D^3^
"KRN",101,4745,10,1,"^")
BI CONTRAINDICATION DELETE
"KRN",101,4745,10,2,0)
4747^A^1^
"KRN",101,4745,10,2,"^")
BI CONTRAINDICATION ADD
"KRN",101,4745,10,3,0)
4748^H^4^
"KRN",101,4745,10,3,"^")
BI CONTRAINDICATION HELP
"KRN",101,4745,10,4,0)
4749^E^2^
"KRN",101,4745,10,4,"^")
BI CONTRAINDICATIONS EDIT
"KRN",101,4745,26)
D SHOW^VALM
"KRN",101,4745,28)
Select Action: 
"KRN",101,4745,29)
Quit
"KRN",101,4745,99)
63694,55322
"KRN",101,4746,-1)
0^72
"KRN",101,4746,0)
BI CONTRAINDICATION DELETE^Delete Contraindication^^A^^^^^^^^
"KRN",101,4746,15)

"KRN",101,4746,20)
D DELETCON^BIPATCO2
"KRN",101,4746,24)

"KRN",101,4746,99)
63694,55322
"KRN",101,4747,-1)
0^73
"KRN",101,4747,0)
BI CONTRAINDICATION ADD^Add Contraindication^^A^^^^^^^^
"KRN",101,4747,15)

"KRN",101,4747,20)
D ADDCON^BIPATCO2
"KRN",101,4747,99)
63694,55322
"KRN",101,4748,-1)
0^74
"KRN",101,4748,0)
BI CONTRAINDICATION HELP^Help^^A^^^^^^^^
"KRN",101,4748,20)
D HELP1^BIPATCO
"KRN",101,4748,99)
63694,55322
"KRN",101,4749,-1)
0^75
"KRN",101,4749,0)
BI CONTRAINDICATIONS EDIT^Edit Contraindication^^A^^^^^^^^
"KRN",101,4749,20)
D EDITCON^BIPATCO2
"KRN",101,4749,99)
63694,55322
"KRN",101,4750,-1)
0^76
"KRN",101,4750,0)
BI MENU BLANK^Blank, no actions^^M^^^^^^^^
"KRN",101,4750,.1)

"KRN",101,4750,4)
30^3
"KRN",101,4750,10,0)
^101.01PA^1^1
"KRN",101,4750,10,1,0)
4718^^1^
"KRN",101,4750,10,1,"^")
BI BLANK
"KRN",101,4750,26)
D SHOW^VALM
"KRN",101,4750,28)
Select Action: 
"KRN",101,4750,29)
Quit
"KRN",101,4750,99)
63735,41045
"KRN",101,4751,-1)
0^78
"KRN",101,4751,0)
BI IMMUNIZATION ADDED^Immunization Added Trigger Event^^X^^^^^^^^
"KRN",101,4751,1,0)
^^19^19^3000311^^^^
"KRN",101,4751,1,1,0)
 Immunization Added Trigger Event call to Protocol File.
"KRN",101,4751,1,2,0)
 
"KRN",101,4751,1,3,0)
 The follwing local variables are available when this protocol is
"KRN",101,4751,1,4,0)
 called immediately after the addition of a new Immunization:
"KRN",101,4751,1,5,0)
 
"KRN",101,4751,1,6,0)
     BIADFN -  IEN of V IMMUNIZATION just created.
"KRN",101,4751,1,7,0)
     BICAT  -  Category: A (Ambul), I (Inpat), E (Event/Hist)
"KRN",101,4751,1,8,0)
     BIDATE -  Date of Visit (Fileman format).
"KRN",101,4751,1,9,0)
     BIDFN  -  DFN of patient.
"KRN",101,4751,1,10,0)
     BIDOSE -  Dose# number for this Immunization.
"KRN",101,4751,1,11,0)
     BILOC  -  Location of encounter (IEN).
"KRN",101,4751,1,12,0)
     BILOT  -  Lot number for this Immunization (text).
"KRN",101,4751,1,13,0)
     BIOLOC -  Other Location of encounter (text).
"KRN",101,4751,1,14,0)
     BIPTR  -  Vaccine (IEN in IMMUNIZATION File).
"KRN",101,4751,1,15,0)
     BIREC  -  Vaccine Reaction (text).
"KRN",101,4751,1,16,0)
     BITYPE -  Type of Visit (PCC Master Control File I,C,6).
"KRN",101,4751,1,17,0)
     BIVHL7 -  Vaccine HL7 Code.
"KRN",101,4751,1,18,0)
     BIVNAM -  Vaccine Name, short form.
"KRN",101,4751,1,19,0)
     BIVSIT -  IEN of Visit just created.
"KRN",101,4751,10,0)
^101.01PA^^0
"KRN",101,4751,99)
63748,79664
"KRN",101,4752,-1)
0^77
"KRN",101,4752,0)
BI IMMUNIZATION DELETED^Immunization Deleted Trigger Event^^X^^^^^^^^
"KRN",101,4752,1,0)
^^17^17^2990423^^
"KRN",101,4752,1,1,0)
 Immunization Deleted Trigger Event call to Protocol File.
"KRN",101,4752,1,2,0)
 
"KRN",101,4752,1,3,0)
 The follwing local variables are available when this protocol is
"KRN",101,4752,1,4,0)
 called immediately after the deletion of an Immunization:
"KRN",101,4752,1,5,0)
 
"KRN",101,4752,1,6,0)
     BICAT  -  Category: A (Ambul), I (Inpat), E (Event/Hist)
"KRN",101,4752,1,7,0)
     BIDATE -  Date of Visit (Fileman format).
"KRN",101,4752,1,8,0)
     BIDFN  -  DFN of patient.
"KRN",101,4752,1,9,0)
     BIDOSE -  Dose# number for this Immunization.
"KRN",101,4752,1,10,0)
     BILOC  -  Location of encounter (IEN).
"KRN",101,4752,1,11,0)
     BILOT  -  Lot number for this Immunization (text).
"KRN",101,4752,1,12,0)
     BIOLOC -  Other Location of encounter (text).
"KRN",101,4752,1,13,0)
     BIPTR  -  Vaccine (IEN in IMMUNIZATION File).
"KRN",101,4752,1,14,0)
     BIREC  -  Vaccine Reaction (text).
"KRN",101,4752,1,15,0)
     BITYPE -  Type of Visit (PCC Master Control File I,C,6).
"KRN",101,4752,1,16,0)
     BIVHL7 -  Vaccine HL7 Code.
"KRN",101,4752,1,17,0)
     BIVNAM -  Vaccine Name, short form.
"KRN",101,4752,10,0)
^101.01PA^^0
"KRN",101,4752,99)
63748,79664
"KRN",409.61,702,-1)
0^1
"KRN",409.61,702,0)
BI SITE PARAMETERS EDIT^2^^80^5^21^1^1^^BI MENU SITE PARAMETERS^BI SITE PARAMETERS EDIT^1^^1
"KRN",409.61,702,1)
^BI MENU SITE PARAMS HIDDEN
"KRN",409.61,702,"ARRAY")
 ^TMP("BISITE",$J)
"KRN",409.61,702,"FNL")
D EXIT^BISITE
"KRN",409.61,702,"HDR")
D HDR^BISITE
"KRN",409.61,702,"HLP")
D HELP^BISITE
"KRN",409.61,702,"INIT")
D INIT^BISITE
"KRN",409.61,703,-1)
0^2
"KRN",409.61,703,0)
BI LETTER FORM^1^^80^5^18^1^1^Form Letter^BI MENU LETTER FORM^VIEW/EDIT FORM LETTER^1^^1
"KRN",409.61,703,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,703,"ARRAY")
 ^TMP("BILMLT",$J)
"KRN",409.61,703,"COL",0)
^409.621^^0
"KRN",409.61,703,"FNL")
D EXIT^BILETVW
"KRN",409.61,703,"HDR")
D HDR^BILETVW
"KRN",409.61,703,"HLP")
D HELP^BILETVW
"KRN",409.61,703,"INIT")
D INIT^BILETVW
"KRN",409.61,704,-1)
0^3
"KRN",409.61,704,0)
BI KEY HOLDERS VIEW/EDIT^1^^80^8^20^1^1^^BI MENU KEY HOLDERS^KEY HOLDERS^1^^1
"KRN",409.61,704,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,704,"ARRAY")
 ^TMP("BIKEYS",$J)
"KRN",409.61,704,"FNL")
D EXIT^BIKEY
"KRN",409.61,704,"HDR")
D HDR^BIKEY
"KRN",409.61,704,"HLP")
D HELP^BIKEY
"KRN",409.61,704,"INIT")
D INIT^BIKEY
"KRN",409.61,705,-1)
0^4
"KRN",409.61,705,0)
BI KEYS EXPLANATION VIEW^1^^80^5^20^1^1^^BI MENU PACKAGE INFO VIEW^  ^1^^1
"KRN",409.61,705,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,705,"ARRAY")
 ^TMP("BIKEY2",$J)
"KRN",409.61,705,"FNL")
D EXIT^BIKEY2
"KRN",409.61,705,"HDR")
D HDR^BIKEY2
"KRN",409.61,705,"HLP")
D HELP^BIKEY2
"KRN",409.61,705,"INIT")
D INIT^BIKEY2
"KRN",409.61,706,-1)
0^5
"KRN",409.61,706,0)
BI LOT TABLE EDIT^1^^80^9^19^1^1^Lot Number^BI MENU LOT NUMBER EDIT^Lot Number Edit^1^^1
"KRN",409.61,706,1)
BI LOT NUMBER PRINT^VALM HIDDEN ACTIONS
"KRN",409.61,706,"ARRAY")
 ^TMP("BILOT",$J)
"KRN",409.61,706,"COL",0)
^409.621^10^8
"KRN",409.61,706,"COL",1,0)
SELECTION^3^1^#^^0
"KRN",409.61,706,"COL",2,0)
LOT NUMBER^6^12^Lot Number^^0
"KRN",409.61,706,"COL",3,0)
MVX^32^3^MVX
"KRN",409.61,706,"COL",4,0)
STATUS^40^6^Status
"KRN",409.61,706,"COL",5,0)
VACCINE^28^7^Vaccine
"KRN",409.61,706,"COL",6,0)
EXP DATE^48^8^Exp Date
"KRN",409.61,706,"COL",7,0)
START AMT^58^5^Start
"KRN",409.61,706,"COL",9,0)
UNUSED^64^6^Unused
"KRN",409.61,706,"COL",10,0)
FACILITY^72^8^Facility
"KRN",409.61,706,"COL","AIDENT",0,1)

"KRN",409.61,706,"COL","AIDENT",0,2)

"KRN",409.61,706,"COL","B","EXP DATE",6)

"KRN",409.61,706,"COL","B","FACILITY",10)

"KRN",409.61,706,"COL","B","LOT NUMBER",2)

"KRN",409.61,706,"COL","B","MVX",3)

"KRN",409.61,706,"COL","B","SELECTION",1)

"KRN",409.61,706,"COL","B","START AMT",7)

"KRN",409.61,706,"COL","B","STATUS",4)

"KRN",409.61,706,"COL","B","UNUSED",9)

"KRN",409.61,706,"COL","B","VACCINE",5)

"KRN",409.61,706,"FNL")
D EXIT^BILOT
"KRN",409.61,706,"HDR")
D HDR^BILOT()
"KRN",409.61,706,"HLP")
D HELP^BILOT
"KRN",409.61,706,"INIT")
D INIT^BILOT
"KRN",409.61,707,-1)
0^7
"KRN",409.61,707,0)
BI PATIENT DATA VIEW/EDIT^1^^80^7^18^1^1^Visit^BI MENU PATIENT VIEW^IMMUNIZATION PATIENT SCREEN^1^^1
"KRN",409.61,707,1)
BI PATIENT VIEW PRINT^VALM HIDDEN ACTIONS
"KRN",409.61,707,"ARRAY")
 ^TMP("BILMVW",$J)
"KRN",409.61,707,"COL",0)
^409.621^3^3
"KRN",409.61,707,"COL",1,0)
SELECTION^3^1^#
"KRN",409.61,707,"COL",2,0)
IMM HISTORY^6^39^Immunization History                  |
"KRN",409.61,707,"COL",3,0)
IMMUNIZATIONS DUE^48^33^Immunizations DUE
"KRN",409.61,707,"COL","B","IMM HISTORY",2)

"KRN",409.61,707,"COL","B","IMMUNIZATIONS DUE",3)

"KRN",409.61,707,"COL","B","SELECTION",1)

"KRN",409.61,707,"FNL")
D EXIT^BIPATVW
"KRN",409.61,707,"HDR")
D HDR^BIPATVW()
"KRN",409.61,707,"HLP")
D HELP^BIPATVW
"KRN",409.61,707,"INIT")
D INIT^BIPATVW
"KRN",409.61,708,-1)
0^6
"KRN",409.61,708,0)
BI PATIENT DATA VIEW ONLY^1^^80^7^20^1^1^Immunization^BI MENU PATIENT VIEW ONLY^IMMUNIZATION PATIENT SCREEN^1^^1
"KRN",409.61,708,1)
BI PATIENT VIEW PRINT^VALM HIDDEN ACTIONS
"KRN",409.61,708,"ARRAY")
 ^TMP("BILMVW",$J)
"KRN",409.61,708,"COL",0)
^409.621^3^3
"KRN",409.61,708,"COL",1,0)
SELECTION^3^1^#
"KRN",409.61,708,"COL",2,0)
IMM HISTORY^6^35^Immunization History              |
"KRN",409.61,708,"COL",3,0)
IMMUNIZATIONS DUE^44^33^Immunizations DUE
"KRN",409.61,708,"COL","B","IMM HISTORY",2)

"KRN",409.61,708,"COL","B","IMMUNIZATIONS DUE",3)

"KRN",409.61,708,"COL","B","SELECTION",1)

"KRN",409.61,708,"FNL")
D EXIT^BIPATVW
"KRN",409.61,708,"HDR")
D HDR^BIPATVW()
"KRN",409.61,708,"HLP")
D HELP^BIPATVW
"KRN",409.61,708,"INIT")
D INIT^BIPATVW
"KRN",409.61,709,-1)
0^8
"KRN",409.61,709,0)
BI GENERIC HELP VIEW^1^^80^5^20^1^1^^BI MENU GENERIC HELP VIEW^^1^^1
"KRN",409.61,709,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,709,"ARRAY")
 ^TMP("BIHELP",$J)
"KRN",409.61,709,"FNL")
D EXIT^BIHELP
"KRN",409.61,709,"HDR")
D HDR^BIHELP
"KRN",409.61,709,"HLP")
D HELP^BIHELP
"KRN",409.61,709,"INIT")
D INIT^BIHELP
"KRN",409.61,710,-1)
0^9
"KRN",409.61,710,0)
BI PATIENT CONTRAINDICATIONS^1^^80^7^14^1^1^Contraindication^BI MENU CONTRAINDICATIONS^CONTRAINDICATIONS SCREEN^1^^1
"KRN",409.61,710,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,710,"ARRAY")
 ^TMP("BILMCO",$J)
"KRN",409.61,710,"COL",0)
^409.621^4^4
"KRN",409.61,710,"COL",1,0)
SELECTION^5^1^#
"KRN",409.61,710,"COL",2,0)
VACCINE^8^10^Vaccine
"KRN",409.61,710,"COL",3,0)
REASON^20^30^Reason
"KRN",409.61,710,"COL",4,0)
DATE NOTED^48^12^Date Noted
"KRN",409.61,710,"COL","B","DATE NOTED",4)

"KRN",409.61,710,"COL","B","REASON",3)

"KRN",409.61,710,"COL","B","SELECTION",1)

"KRN",409.61,710,"COL","B","VACCINE",2)

"KRN",409.61,710,"FNL")
D EXIT^BIPATCO
"KRN",409.61,710,"HDR")
D HDR^BIPATCO
"KRN",409.61,710,"HLP")
D HELP^BIPATCO
"KRN",409.61,710,"INIT")
D INIT^BIPATCO
"KRN",409.61,711,-1)
0^10
"KRN",409.61,711,0)
BI PATIENT PROFILE VIEW^1^^80^6^20^0^1^^BI MENU BLANK^PATIENT IMMUNIZATION PROFILE^1^^1
"KRN",409.61,711,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,711,"ARRAY")
 ^TMP("BILMPF",$J)
"KRN",409.61,711,"FNL")
D EXIT^BIPATPF
"KRN",409.61,711,"HDR")
D HDR^BIPATPF
"KRN",409.61,711,"HLP")
D HELP^BIPATPF
"KRN",409.61,711,"INIT")
D INIT^BIPATPF
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",4,.5)
.5;4;;;EDEOUT^DIFROMSO(.5,DA,"",XPDA);FPRE^DIFROMSI(.5,"",XPDA);EPRE^DIFROMSI(.5,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.5,DA,"",XPDA)
"ORD",4,.5,0)
FUNCTION
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",9,.84)
.84;9;;;EDEOUT^DIFROMSO(.84,DA,"",XPDA);FPRE^DIFROMSI(.84,"",XPDA);EPRE^DIFROMSI(.84,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.84,DA,"",XPDA);DEL^DIFROMSK(.84,"",%)
"ORD",9,.84,0)
DIALOG
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",224,-1)
1^1
"PKG",224,0)
IMMUNIZATIONS VISTA PORT^BIV^VISTA Port of RPMS Immunizations
"PKG",224,22,0)
^9.49I^1^1
"PKG",224,22,1,0)
10.0^3150717
"PKG",224,"VERSION")
10.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
174
"RTN","BIAGE")
0^6^B34295641
"RTN","BIAGE",1,0)
BIAGE ;IHS/CMI/MWR - PROCESS AGE RANGES, PROMPTS ; MAY 10, 2010
"RTN","BIAGE",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIAGE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIAGE",4,0)
 ;;  UTILITY TO PROMPT AND PROCESS AGE RANGES.
"RTN","BIAGE",5,0)
 ;
"RTN","BIAGE",6,0)
 ;
"RTN","BIAGE",7,0)
 ;----------
"RTN","BIAGE",8,0)
AGERNG(BIAGRG,BIPOP,BIDFLT,BIDMODE) ;EP
"RTN","BIAGE",9,0)
 ;---> Ask age range.
"RTN","BIAGE",10,0)
 ;---> Parameters:
"RTN","BIAGE",11,0)
 ;     1 - BIAGRG  (ret) Age Range^Mode (Mode is in Months or Years).
"RTN","BIAGE",12,0)
 ;                       Mode="" or 0, is Months (default).
"RTN","BIAGE",13,0)
 ;                       Mode=1, is Years.
"RTN","BIAGE",14,0)
 ;                       Or BIAGRG="ALL"
"RTN","BIAGE",15,0)
 ;                       Examples: "6-24"="6 to 24 Months"
"RTN","BIAGE",16,0)
 ;                                 "50-64^1"="50 to 64 Years"
"RTN","BIAGE",17,0)
 ;                                 "ALL"
"RTN","BIAGE",18,0)
 ;     2 - BIPOP   (ret) =1 if quit
"RTN","BIAGE",19,0)
 ;     3 - BIDFLT  (opt) Default Age Range
"RTN","BIAGE",20,0)
 ;     4 - BIDMODE (opt) Default Mode: 1=Years, 0/""=Months(default)
"RTN","BIAGE",21,0)
 ;
"RTN","BIAGE",22,0)
 ;
"RTN","BIAGE",23,0)
ASKRNG ;EP
"RTN","BIAGE",24,0)
 N DIR,DIRUT,Y S BIPOP=0,BIAGRG=""
"RTN","BIAGE",25,0)
 D
"RTN","BIAGE",26,0)
 .;---> Set default=previous entry.
"RTN","BIAGE",27,0)
 .I $D(^BIAGRG(DUZ,0)) D  Q
"RTN","BIAGE",28,0)
 ..S DIR("B")=$P(^BIAGRG(DUZ,0),U,2)
"RTN","BIAGE",29,0)
 ..S BIMODE=+$P(^BIAGRG(DUZ,0),U,3)
"RTN","BIAGE",30,0)
 .;
"RTN","BIAGE",31,0)
 .;---> If no previous user default, then use passed default.
"RTN","BIAGE",32,0)
 .S:$G(BIDFLT)]"" DIR("B")=BIDFLT
"RTN","BIAGE",33,0)
 .S BIMODE=+$G(BIDMODE)
"RTN","BIAGE",34,0)
 ;
"RTN","BIAGE",35,0)
ASKRNG1 ;GO EP
"RTN","BIAGE",36,0)
 ;
"RTN","BIAGE",37,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT AGE RANGE")
"RTN","BIAGE",38,0)
 D
"RTN","BIAGE",39,0)
 .I BIMODE D TEXT2 Q
"RTN","BIAGE",40,0)
 .D TEXT1
"RTN","BIAGE",41,0)
 ;
"RTN","BIAGE",42,0)
 S DIR(0)="FOA"
"RTN","BIAGE",43,0)
 S DIR("?")="     Enter a number"
"RTN","BIAGE",44,0)
 S DIR("A")="     Enter Age Range in "
"RTN","BIAGE",45,0)
 S DIR("A")=DIR("A")_$S(BIMODE:"Years: ",1:"Months: ")
"RTN","BIAGE",46,0)
 D ^DIR
"RTN","BIAGE",47,0)
 I $D(DIRUT)!(Y="") S BIPOP=1 Q
"RTN","BIAGE",48,0)
 ;
"RTN","BIAGE",49,0)
 I "ALLAllall"[Y S BIAGRG="ALL" Q
"RTN","BIAGE",50,0)
 ;
"RTN","BIAGE",51,0)
 I "YyMm"[Y D  G ASKRNG1
"RTN","BIAGE",52,0)
 .S BIMODE=$S("Yy"[Y:1,1:0) K DIR
"RTN","BIAGE",53,0)
 ;
"RTN","BIAGE",54,0)
 ;---> If not a valid range, begin again.
"RTN","BIAGE",55,0)
 I $$CHECK(.Y) D ERRCD^BIUTL2(660,,1) G ASKRNG
"RTN","BIAGE",56,0)
 ;
"RTN","BIAGE",57,0)
 ;---> If Age Range was given in Years, concat 1.
"RTN","BIAGE",58,0)
 S:BIMODE Y=Y_U_1
"RTN","BIAGE",59,0)
 S BIAGRG=Y
"RTN","BIAGE",60,0)
 ;
"RTN","BIAGE",61,0)
 ;---> Now store user's Age Range for future default.
"RTN","BIAGE",62,0)
 Q:Y=""
"RTN","BIAGE",63,0)
 Q:DUZ=0
"RTN","BIAGE",64,0)
 ;---> Clear any previous Date-Loc Line for this user.
"RTN","BIAGE",65,0)
 K ^BIAGRG(DUZ),^BIAGRG("B",DUZ)
"RTN","BIAGE",66,0)
 ;---> Store this Age Range for this user.
"RTN","BIAGE",67,0)
 S ^BIAGRG(DUZ,0)=DUZ_U_Y,^BIAGRG("B",DUZ,DUZ)=""
"RTN","BIAGE",68,0)
 Q
"RTN","BIAGE",69,0)
 ;
"RTN","BIAGE",70,0)
 ;
"RTN","BIAGE",71,0)
 ;----------
"RTN","BIAGE",72,0)
TEXT1 ;EP
"RTN","BIAGE",73,0)
 ;;Enter the patient Age Range IN MONTHS in the form of: 6-24
"RTN","BIAGE",74,0)
 ;;Use a dash "-" to separate the limits of the range.  You may also
"RTN","BIAGE",75,0)
 ;;enter a single age, such as 12, to select for only 12-month-old
"RTN","BIAGE",76,0)
 ;;patients.
"RTN","BIAGE",77,0)
 ;;
"RTN","BIAGE",78,0)
 ;;Enter "ALL" if you wish to simply include patients of ALL ages.
"RTN","BIAGE",79,0)
 ;;
"RTN","BIAGE",80,0)
 ;;Or, if you wish to select a range in YEARS, enter "Y" (no quotes).
"RTN","BIAGE",81,0)
 ;;
"RTN","BIAGE",82,0)
 ;;NOTE: The Age Range will include patients whose ages span from the
"RTN","BIAGE",83,0)
 ;;minimum age all the way up to ONE DAY LESS THAN a month after the
"RTN","BIAGE",84,0)
 ;;maximum age.  For example, 6-24 will include patients 6 months of
"RTN","BIAGE",85,0)
 ;;age and older, up to 24 months and approximately 30 days.
"RTN","BIAGE",86,0)
 ;;
"RTN","BIAGE",87,0)
 ;;
"RTN","BIAGE",88,0)
 D PRINTX("TEXT1")
"RTN","BIAGE",89,0)
 Q
"RTN","BIAGE",90,0)
 ;
"RTN","BIAGE",91,0)
 ;
"RTN","BIAGE",92,0)
 ;----------
"RTN","BIAGE",93,0)
TEXT2 ;EP
"RTN","BIAGE",94,0)
 ;;Enter the patient Age Range IN YEARS in the form of: 65-99
"RTN","BIAGE",95,0)
 ;;Use a dash "-" to separate the limits of the range.  You may also
"RTN","BIAGE",96,0)
 ;;enter a single age, such as 65, to select for only 65-year-old
"RTN","BIAGE",97,0)
 ;;patients.
"RTN","BIAGE",98,0)
 ;;
"RTN","BIAGE",99,0)
 ;;Enter "ALL" if you wish to simply include patients of ALL ages.
"RTN","BIAGE",100,0)
 ;;
"RTN","BIAGE",101,0)
 ;;Or, if you wish to select a range in MONTHS, enter "M" (no quotes).
"RTN","BIAGE",102,0)
 ;;
"RTN","BIAGE",103,0)
 ;;NOTE: The Age Range will include patients whose ages span from the
"RTN","BIAGE",104,0)
 ;;minimum age all the way up to ONE DAY LESS THAN a year after the
"RTN","BIAGE",105,0)
 ;;maximum age.  For example, 65-99 will include patients 65 years of
"RTN","BIAGE",106,0)
 ;;age and older, up to 99 years and 364 days.
"RTN","BIAGE",107,0)
 ;;
"RTN","BIAGE",108,0)
 ;;
"RTN","BIAGE",109,0)
 D PRINTX("TEXT2")
"RTN","BIAGE",110,0)
 Q
"RTN","BIAGE",111,0)
 ;
"RTN","BIAGE",112,0)
 ;
"RTN","BIAGE",113,0)
 ;----------
"RTN","BIAGE",114,0)
CHECK(X) ;EP
"RTN","BIAGE",115,0)
 ;---> Check syntax of age range string.
"RTN","BIAGE",116,0)
 ;---> Also, convert to years if appropriate.
"RTN","BIAGE",117,0)
 ;---> Parameters:
"RTN","BIAGE",118,0)
 ;     1 - X      (req) Age Range.
"RTN","BIAGE",119,0)
 ;
"RTN","BIAGE",120,0)
 ;---> If only one age selected, quit.
"RTN","BIAGE",121,0)
 Q:X?1N.N 0
"RTN","BIAGE",122,0)
 N V,Y,Z S V="-"
"RTN","BIAGE",123,0)
 S Y=$P(X,V),Z=$P(X,V,2)
"RTN","BIAGE",124,0)
 ;---> Each end of the range should be a number.
"RTN","BIAGE",125,0)
 I (Y'?1N.N)!(Z'?1N.N) K X Q 1
"RTN","BIAGE",126,0)
 ;---> The lower number should be first.
"RTN","BIAGE",127,0)
 I Z<Y K X Q 1
"RTN","BIAGE",128,0)
 Q 0
"RTN","BIAGE",129,0)
 ;
"RTN","BIAGE",130,0)
 ;
"RTN","BIAGE",131,0)
 ;----------
"RTN","BIAGE",132,0)
AGEDATE(BIAGRG,BISVDT,BIBEGDT,BIENDDT,BIERR) ;EP
"RTN","BIAGE",133,0)
 ;---> Given an Age Range in months or years and a Survey Date,
"RTN","BIAGE",134,0)
 ;---> return the beginning and ending dates in Fileman format.
"RTN","BIAGE",135,0)
 ;---> Use to search patients by DOB.
"RTN","BIAGE",136,0)
 ;---> Parameters:
"RTN","BIAGE",137,0)
 ;     1 - BIAGRG  (req) Age Range^Mth/Yr (e.g.,50-64^1)
"RTN","BIAGE",138,0)
 ;                    (See description at linelable AGERNG above.)
"RTN","BIAGE",139,0)
 ;     2 - BISVDT  (req) Survey/Forecast Date (date from which to
"RTN","BIAGE",140,0)
 ;                       calculate age).
"RTN","BIAGE",141,0)
 ;     3 - BIBEGDT (ret) Beginning Date.
"RTN","BIAGE",142,0)
 ;     4 - BIENDDT (ret) Ending Date.
"RTN","BIAGE",143,0)
 ;     5 - BIERR   (ret) Error.
"RTN","BIAGE",144,0)
 ;
"RTN","BIAGE",145,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIAGE",146,0)
 I "ALL"[$G(BIAGRG) S BIBEGDT=0,BIENDDT=9999999 Q
"RTN","BIAGE",147,0)
 I '$G(BISVDT) S BISVDT=$G(DT)
"RTN","BIAGE",148,0)
 ;I '$G(BISVDT) S BIBEGDT=0,BIENDDT=9999999 Q
"RTN","BIAGE",149,0)
 ;S:BISVDT>DT BISVDT=DT
"RTN","BIAGE",150,0)
 ;
"RTN","BIAGE",151,0)
 ;---> If X=one age only, set it in the form X-X and quit.
"RTN","BIAGE",152,0)
 ;---> If Age Range is passed in years, convert to months.
"RTN","BIAGE",153,0)
 D
"RTN","BIAGE",154,0)
 .N Y S Y=$P(BIAGRG,U)
"RTN","BIAGE",155,0)
 .;---> If Y=one age only, set it in the form Y-Y.
"RTN","BIAGE",156,0)
 .I Y?1N.N S Y=Y_"-"_Y
"RTN","BIAGE",157,0)
 .I '$P(BIAGRG,U,2) S BIAGRG=Y Q
"RTN","BIAGE",158,0)
 .S BIAGRG=(12*$P(Y,"-"))_"-"_(12*$P(Y,"-",2)+11)
"RTN","BIAGE",159,0)
 ;
"RTN","BIAGE",160,0)
 N BIAGRG1,BIAGRG2
"RTN","BIAGE",161,0)
 S BIAGRG1=+$P(BIAGRG,"-",1),BIAGRG2=+$P(BIAGRG,"-",2)
"RTN","BIAGE",162,0)
 I (BIAGRG1'?1N.N)!(BIAGRG2'?1N.N) D ERRCD^BIUTL2(676,.BIERR) Q
"RTN","BIAGE",163,0)
 ;
"RTN","BIAGE",164,0)
 ;D PASTMTH(BISVDT,($P(BIAGRG,"-",2)+1),.BIBEGDT)
"RTN","BIAGE",165,0)
 D PASTMTH(BISVDT,(BIAGRG2+1),.BIBEGDT)
"RTN","BIAGE",166,0)
 ;
"RTN","BIAGE",167,0)
 ;---> Now, set Beginning Day to be one day AFTER the patient would
"RTN","BIAGE",168,0)
 ;---> be too old and out of the selected Age Range.
"RTN","BIAGE",169,0)
 ;---> In other words, come forward one day to include only patients
"RTN","BIAGE",170,0)
 ;---> whose age is ONE DAY LESS THAN a month (or year) after the
"RTN","BIAGE",171,0)
 ;---> maximum limit of the selected Age Range.
"RTN","BIAGE",172,0)
 ;---> For example, Age Range=24-36 includes patients whose age
"RTN","BIAGE",173,0)
 ;---> is between [24months] and [37months-1day].
"RTN","BIAGE",174,0)
 N X,X1,X2 S X1=BIBEGDT,X2=1 D C^%DTC S BIBEGDT=X
"RTN","BIAGE",175,0)
 ;
"RTN","BIAGE",176,0)
 ;D PASTMTH(BISVDT,$P(BIAGRG,"-",1),.BIENDDT)
"RTN","BIAGE",177,0)
 D PASTMTH(BISVDT,BIAGRG1,.BIENDDT)
"RTN","BIAGE",178,0)
 Q
"RTN","BIAGE",179,0)
 ;
"RTN","BIAGE",180,0)
 ;
"RTN","BIAGE",181,0)
 ;----------
"RTN","BIAGE",182,0)
PASTMTH(BIDTI,BIMTHS,BIDTO,BIYR) ;EP
"RTN","BIAGE",183,0)
 ;---> Return the date BIMTHS months/years prior the input date.
"RTN","BIAGE",184,0)
 ;---> Parameters:
"RTN","BIAGE",185,0)
 ;     1 - BIDTI  (req) Date in.
"RTN","BIAGE",186,0)
 ;     2 - BIMTHS (req) Number of months in the past to calculate.
"RTN","BIAGE",187,0)
 ;     3 - BIDTO  (ret) Date out (BIMTHS prior to BIDTI).
"RTN","BIAGE",188,0)
 ;     4 - BIYR   (opt) If BIYR=1, input is in years; multiply BIMTHSx12.
"RTN","BIAGE",189,0)
 ;
"RTN","BIAGE",190,0)
 Q:'$G(BIDTI)
"RTN","BIAGE",191,0)
 I '$G(BIMTHS) S BIDTO=BIDTI Q
"RTN","BIAGE",192,0)
 I $G(BIYR)=1 S BIMTHS=(BIMTHS*12)
"RTN","BIAGE",193,0)
 N YYY,MM,DD
"RTN","BIAGE",194,0)
 S YYY=$E(BIDTI,1,3),MM=+$E(BIDTI,4,5),DD=+$E(BIDTI,6,7)
"RTN","BIAGE",195,0)
 D
"RTN","BIAGE",196,0)
 .I MM>BIMTHS S MM=MM-BIMTHS Q
"RTN","BIAGE",197,0)
 .N I,Q S Q=0
"RTN","BIAGE",198,0)
 .F I=12:12 D  Q:Q
"RTN","BIAGE",199,0)
 ..I BIMTHS-MM<I S MM=I-(BIMTHS-MM),YYY=YYY-(I/12),Q=1
"RTN","BIAGE",200,0)
 ;
"RTN","BIAGE",201,0)
 S:MM<10 MM="0"_MM
"RTN","BIAGE",202,0)
 S:DD<10 DD="0"_DD
"RTN","BIAGE",203,0)
 S BIDTO=YYY_MM_DD
"RTN","BIAGE",204,0)
 Q
"RTN","BIAGE",205,0)
 ;
"RTN","BIAGE",206,0)
 ;
"RTN","BIAGE",207,0)
 ;----------
"RTN","BIAGE",208,0)
MTHYR(BIAG,BIS) ;EP
"RTN","BIAGE",209,0)
 ;---> Return Age Range for display in either months or years
"RTN","BIAGE",210,0)
 ;---> as appropriate, formatted: "24-36 Months" or "65-99 Years".
"RTN","BIAGE",211,0)
 ;---> Parameters:
"RTN","BIAGE",212,0)
 ;     1 - BIAG (req) Age Range^Mth/Yr
"RTN","BIAGE",213,0)
 ;                    (See description at linelable AGERNG above.)
"RTN","BIAGE",214,0)
 ;     2 - BIS  (opt) If BIS=1 return "Mths" instead of "Months" or
"RTN","BIAGE",215,0)
 ;                    "Yrs" instead of "Years".
"RTN","BIAGE",216,0)
 ;
"RTN","BIAGE",217,0)
 Q:$G(BIAG)="" "NO RANGE"
"RTN","BIAGE",218,0)
 N V,W,X,Y,Z S V="-"
"RTN","BIAGE",219,0)
 ;
"RTN","BIAGE",220,0)
 ;---> Z=""/0: Range is in Months; Z=1: Range is in Years.
"RTN","BIAGE",221,0)
 S W=$P(BIAG,U),X=$P(W,V),Y=$P(W,V,2),Z=$P(BIAG,U,2)
"RTN","BIAGE",222,0)
 S:'X X=0
"RTN","BIAGE",223,0)
 S:W=0 W="<1"
"RTN","BIAGE",224,0)
 Q:$G(Z) W_$S($G(BIS):" Yr",1:" Year")_$S((Y!(X>1)):"s",1:"")
"RTN","BIAGE",225,0)
 Q W_$S($G(BIS):" Mth",1:" Month")_$S((Y!(X>1)):"s",1:"")
"RTN","BIAGE",226,0)
 ;
"RTN","BIAGE",227,0)
 ;
"RTN","BIAGE",228,0)
 ;----------
"RTN","BIAGE",229,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIAGE",230,0)
 Q:$G(BILINL)=""
"RTN","BIAGE",231,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIAGE",232,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIAGE",233,0)
 Q
"RTN","BIAPCHS")
0^7^B49631446
"RTN","BIAPCHS",1,0)
BIAPCHS ;IHS/CMI/MWR - PRODUCE IMMUNIZATION PATIENT RECORD FOR HEALTH SUMMARY.; MAY 10, 2010
"RTN","BIAPCHS",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIAPCHS",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIAPCHS",4,0)
 ;;  BUILD TEMP ARRAY TO PASS BACK TO APCHS2.
"RTN","BIAPCHS",5,0)
 ;;  PATCH 3: Use Date of Event if it exists for Imm Hx.  HISTORY+33,+81
"RTN","BIAPCHS",6,0)
 ;
"RTN","BIAPCHS",7,0)
 ;---> Call from IMMBI8^APCHS2: D IMMBI^BIAPCHS(APCHSPAT,.APCHSARR)
"RTN","BIAPCHS",8,0)
 ;
"RTN","BIAPCHS",9,0)
 ;----------
"RTN","BIAPCHS",10,0)
IMMBI(BIDFN,BIARRAY) ;EP
"RTN","BIAPCHS",11,0)
 ;---> Get patient's Immunization Data and write lines for display in
"RTN","BIAPCHS",12,0)
 ;---> Health Summary.  Pass formatted lines back in BIARRAY.
"RTN","BIAPCHS",13,0)
 ;---> Called by APCHS2.
"RTN","BIAPCHS",14,0)
 ;---> Parameters:
"RTN","BIAPCHS",15,0)
 ;     1 - BIDFN   (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIAPCHS",16,0)
 ;     2 - BIARRAY (ret) Local array of formatted lines for Health Summary.
"RTN","BIAPCHS",17,0)
 ;
"RTN","BIAPCHS",18,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIAPCHS",19,0)
 K ^TMP("BIHS",$J)
"RTN","BIAPCHS",20,0)
 D GATHER($G(BIDFN))
"RTN","BIAPCHS",21,0)
 D PASSARR(.BIARRAY)
"RTN","BIAPCHS",22,0)
 K ^TMP("BIHS",$J)
"RTN","BIAPCHS",23,0)
 Q
"RTN","BIAPCHS",24,0)
 ;
"RTN","BIAPCHS",25,0)
 ;
"RTN","BIAPCHS",26,0)
 ;----------
"RTN","BIAPCHS",27,0)
GATHER(BIDFN) ;EP
"RTN","BIAPCHS",28,0)
 ;---> Get patient's Immunization Data and write lines for display in
"RTN","BIAPCHS",29,0)
 ;---> Health Summary.  Store lines in ^TMP("BIHS",$J...).
"RTN","BIAPCHS",30,0)
 ;---> Called by APCHS2.
"RTN","BIAPCHS",31,0)
 ;---> Parameters:
"RTN","BIAPCHS",32,0)
 ;     1 - BIDFN   (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIAPCHS",33,0)
 ;
"RTN","BIAPCHS",34,0)
 N BILINE S BILINE=0
"RTN","BIAPCHS",35,0)
 ;
"RTN","BIAPCHS",36,0)
 ;---> Error check.
"RTN","BIAPCHS",37,0)
 N BIERR,BIPDSS S BIERR=""
"RTN","BIAPCHS",38,0)
 D  I BIERR]"" D WRITE(.BILINE,BIERR) Q
"RTN","BIAPCHS",39,0)
 .I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BIAPCHS",40,0)
 .I '$D(^DPT(BIDFN,0)) D ERRCD^BIUTL2(203,.BIERR) Q
"RTN","BIAPCHS",41,0)
 .S:'$G(BIFDT) BIFDT=DT
"RTN","BIAPCHS",42,0)
 ;
"RTN","BIAPCHS",43,0)
 ;---> Retrieve and store sections of letter in WP ^TMP global.
"RTN","BIAPCHS",44,0)
 D FORECAST(BIDFN,.BILINE,.BIPDSS)
"RTN","BIAPCHS",45,0)
 D CONTRAS(BIDFN,.BILINE)
"RTN","BIAPCHS",46,0)
 D HISTORY(BIDFN,.BILINE,BIPDSS)
"RTN","BIAPCHS",47,0)
 Q
"RTN","BIAPCHS",48,0)
 ;
"RTN","BIAPCHS",49,0)
 ;
"RTN","BIAPCHS",50,0)
 ;----------
"RTN","BIAPCHS",51,0)
PASSARR(BIARRAY) ;EP
"RTN","BIAPCHS",52,0)
 ;---> Get patient's Immunization Health Summary formatted display lines from
"RTN","BIAPCHS",53,0)
 ;---> ^TMP("BIHS",$J) and populate BIARRAY to pass back to APCHS2.
"RTN","BIAPCHS",54,0)
 ;---> Parameters:
"RTN","BIAPCHS",55,0)
 ;     1 - BIARRAY (req) Local array receiving copy of HS formatted lines
"RTN","BIAPCHS",56,0)
 ;                       from ^TMP("BIHS",$J...)
"RTN","BIAPCHS",57,0)
 N N S N=0
"RTN","BIAPCHS",58,0)
 F  S N=$O(^TMP("BIHS",$J,N)) Q:'N  S BIARRAY(N,0)=^(N,0)
"RTN","BIAPCHS",59,0)
 ;
"RTN","BIAPCHS",60,0)
 Q
"RTN","BIAPCHS",61,0)
 ;
"RTN","BIAPCHS",62,0)
 ;
"RTN","BIAPCHS",63,0)
 ;----------
"RTN","BIAPCHS",64,0)
FORECAST(BIDFN,BILINE,BIPDSS) ;EP
"RTN","BIAPCHS",65,0)
 ;---> Calculate and store Forecast in WP ^TMP global.
"RTN","BIAPCHS",66,0)
 ;---> Parameters:
"RTN","BIAPCHS",67,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIAPCHS",68,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BIAPCHS",69,0)
 ;     3 - BIPDSS (ret) Returned string of Visit IEN's that are
"RTN","BIAPCHS",70,0)
 ;                      Problem Doses, according to ImmServe.
"RTN","BIAPCHS",71,0)
 ;
"RTN","BIAPCHS",72,0)
 ;
"RTN","BIAPCHS",73,0)
 N BIFORCST,BIERR S BIFORCST="",BIPDSS=""
"RTN","BIAPCHS",74,0)
 ;
"RTN","BIAPCHS",75,0)
 ;---> Get forecast string (BIFORCST) and problem dose string (BIPDSS).
"RTN","BIAPCHS",76,0)
 ;---> Pass BIPDSS to HISTORY to mark problem doses with asterisks.
"RTN","BIAPCHS",77,0)
 ;---> Pass BIFORCST to FORECAST for display.
"RTN","BIAPCHS",78,0)
 D IMMFORC^BIRPC(.BIFORCST,BIDFN,,,,.BIPDSS)
"RTN","BIAPCHS",79,0)
 D WRITE(.BILINE,"   IMMUNIZATION FORECAST:",1)
"RTN","BIAPCHS",80,0)
 ;
"RTN","BIAPCHS",81,0)
 ;---> Check for error in 2nd piece of return value.
"RTN","BIAPCHS",82,0)
 S BIERR=$P(BIFORCST,BI31,2)
"RTN","BIAPCHS",83,0)
 ;---> If there's an error, display it and quit.
"RTN","BIAPCHS",84,0)
 I BIERR]"" D WRITE(.BILINE,"      *"_BIERR) Q
"RTN","BIAPCHS",85,0)
 ;
"RTN","BIAPCHS",86,0)
 ;---> No error, so take 1st piece of return value and process it.
"RTN","BIAPCHS",87,0)
 S BIFORCST=$P(BIFORCST,BI31,1)
"RTN","BIAPCHS",88,0)
 N I,X
"RTN","BIAPCHS",89,0)
 F I=1:1 S X=$P(BIFORCST,U,I) Q:X=""  D
"RTN","BIAPCHS",90,0)
 .N Y S Y="   "_$$PAD($P(X,"|"),20)
"RTN","BIAPCHS",91,0)
 .S Y=Y_$$PAD($P(X,"|",2),36)_$P(X,"|",3)
"RTN","BIAPCHS",92,0)
 .D WRITE(.BILINE,Y)
"RTN","BIAPCHS",93,0)
 D WRITE(.BILINE)
"RTN","BIAPCHS",94,0)
 Q
"RTN","BIAPCHS",95,0)
 ;
"RTN","BIAPCHS",96,0)
 ;
"RTN","BIAPCHS",97,0)
 ;----------
"RTN","BIAPCHS",98,0)
CONTRAS(BIDFN,BILINE) ;EP
"RTN","BIAPCHS",99,0)
 ;---> Store Contraindications in ^TMP global.
"RTN","BIAPCHS",100,0)
 ;---> Parameters:
"RTN","BIAPCHS",101,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIAPCHS",102,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BIAPCHS",103,0)
 ;
"RTN","BIAPCHS",104,0)
 N BIRETVAL S BIRETVAL=""
"RTN","BIAPCHS",105,0)
 ;---> RPC to retrieve Contraindications.
"RTN","BIAPCHS",106,0)
 D CONTRAS^BIRPC5(.BIRETVAL,BIDFN)
"RTN","BIAPCHS",107,0)
 ;
"RTN","BIAPCHS",108,0)
 ;---> If BIERR has a value, display it and quit.
"RTN","BIAPCHS",109,0)
 S BIERR=$P(BIRETVAL,BI31,2)
"RTN","BIAPCHS",110,0)
 I BIERR]"" D WRITE(.BILINE,"      *"_BIERR) Q
"RTN","BIAPCHS",111,0)
 ;
"RTN","BIAPCHS",112,0)
 ;---> Set BIC=to a string of Contraindications for this patient.
"RTN","BIAPCHS",113,0)
 N BIC S BIC=$P(BIRETVAL,BI31,1)
"RTN","BIAPCHS",114,0)
 Q:BIC=""
"RTN","BIAPCHS",115,0)
 ;---> Build Health Summary array from BIC string.
"RTN","BIAPCHS",116,0)
 N I,X
"RTN","BIAPCHS",117,0)
 F I=1:1 S X=$P(BIC,U,I) Q:X=""  D
"RTN","BIAPCHS",118,0)
 .;---> Build display line for this Contraindication.
"RTN","BIAPCHS",119,0)
 .N V,Y S V="|",Y="      "
"RTN","BIAPCHS",120,0)
 .S:I=1 Y=Y_"* Contraindications:" S Y=$$PAD(Y,28)
"RTN","BIAPCHS",121,0)
 .;
"RTN","BIAPCHS",122,0)
 .;---> Display "Vaccine:  Date  Reason"
"RTN","BIAPCHS",123,0)
 .S Y=Y_$P(X,V,2)_":",Y=$$PAD(Y,40)_$P(X,V,4)
"RTN","BIAPCHS",124,0)
 .S Y=$$PAD(Y,53)_$P(X,V,3)
"RTN","BIAPCHS",125,0)
 .;---> Set formatted Contraindication line and index in ^TMP.
"RTN","BIAPCHS",126,0)
 .D WRITE(.BILINE,Y)
"RTN","BIAPCHS",127,0)
 D WRITE(.BILINE)
"RTN","BIAPCHS",128,0)
 Q
"RTN","BIAPCHS",129,0)
 ;
"RTN","BIAPCHS",130,0)
 ;
"RTN","BIAPCHS",131,0)
HISTORY(BIDFN,BILINE,BIPDSS) ;EP
"RTN","BIAPCHS",132,0)
 ;---> Retrieve Patient's Imm History and store in WP ^TMP global.
"RTN","BIAPCHS",133,0)
 ;---> Parameters:
"RTN","BIAPCHS",134,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIAPCHS",135,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BIAPCHS",136,0)
 ;     3 - BIPDSS (ret) Returned string of Visit IEN's that are
"RTN","BIAPCHS",137,0)
 ;                      Problem Doses, according to ImmServe.
"RTN","BIAPCHS",138,0)
 ;
"RTN","BIAPCHS",139,0)
 ;---> Next line: Change Data Elements called. ;Cimarron/Mike Remillard 7/30/03
"RTN","BIAPCHS",140,0)
 ;---> Use Date Element IEN 4 instead of 8.  DE 8 used to contain Dose#-Short Name;
"RTN","BIAPCHS",141,0)
 ;---> now it contains vaccine components.
"RTN","BIAPCHS",142,0)
 ;---> Also add DE 24 V File IEN, and DE 65 is Dose Override.
"RTN","BIAPCHS",143,0)
 ;NEW BIDE,I F I=8,26,27,60,33,44,57 S BIDE(I)=""
"RTN","BIAPCHS",144,0)
 ;
"RTN","BIAPCHS",145,0)
 ;
"RTN","BIAPCHS",146,0)
 ;
"RTN","BIAPCHS",147,0)
 ;---> If BIDE local array (Data Elements to be returned) is not
"RTN","BIAPCHS",148,0)
 ;---> passed, then set the following default Data Elements.
"RTN","BIAPCHS",149,0)
 ;---> The following are IEN's in ^BIEXPDD(.
"RTN","BIAPCHS",150,0)
 ;---> IEN PC  DATA
"RTN","BIAPCHS",151,0)
 ;---> --- --  ----
"RTN","BIAPCHS",152,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIAPCHS",153,0)
 ;--->  4  2 = Vaccine Name, Short.
"RTN","BIAPCHS",154,0)
 ;--->  8  3 = Vaccine Components.  ;v8.0
"RTN","BIAPCHS",155,0)
 ;---> 24  4 = IEN, V File Visit.
"RTN","BIAPCHS",156,0)
 ;---> 26  5 = Location (or Outside Location) where Imm was given.
"RTN","BIAPCHS",157,0)
 ;---> 27  6 = Vaccine Group (Series Type) for grouping of vaccines.
"RTN","BIAPCHS",158,0)
 ;---> 33  7 = Vaccine Lot#, Text.
"RTN","BIAPCHS",159,0)
 ;---> 44  8 = Reaction to Immunization, text.
"RTN","BIAPCHS",160,0)
 ;---> 57  9 = Age at Visit.
"RTN","BIAPCHS",161,0)
 ;---> 65 10 = Dose Override.
"RTN","BIAPCHS",162,0)
 ;---> 66 11 = Date of Visit (MM/DD/YY).
"RTN","BIAPCHS",163,0)
 ;---> 69 12 = Vaccine Component CVX Code.
"RTN","BIAPCHS",164,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIAPCHS",165,0)
 ;---> Add Date of Event to Hx string.
"RTN","BIAPCHS",166,0)
 ;---> 86 13 = Date of Event (1201 field of V File) in YYYMMDD
"RTN","BIAPCHS",167,0)
 ;
"RTN","BIAPCHS",168,0)
 ;
"RTN","BIAPCHS",169,0)
 ;N BIDE,I F I=4,8,24,26,27,33,44,57,65,66,69 S BIDE(I)=""
"RTN","BIAPCHS",170,0)
 N BIDE,I F I=4,8,24,26,27,33,44,57,65,66,69,86 S BIDE(I)=""
"RTN","BIAPCHS",171,0)
 ;**********
"RTN","BIAPCHS",172,0)
 ;
"RTN","BIAPCHS",173,0)
 ;call to get imm hx
"RTN","BIAPCHS",174,0)
 N BIERR,BIFORCST,BIRETVAL S BIRETVAL=""
"RTN","BIAPCHS",175,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,1,0)
"RTN","BIAPCHS",176,0)
 D WRITE(.BILINE,"   IMMUNIZATION HISTORY:")
"RTN","BIAPCHS",177,0)
 ;
"RTN","BIAPCHS",178,0)
 ;---> If there is an Invalid Dose or Reaction, append extra line feed.
"RTN","BIAPCHS",179,0)
 ;---> Use BILF as a line feed flag.  ***NOT USED for now.  CIM/MWR  8/4/03
"RTN","BIAPCHS",180,0)
 N BILF S BILF=0
"RTN","BIAPCHS",181,0)
 ;
"RTN","BIAPCHS",182,0)
 S BIERR=$P(BIRETVAL,BI31,2)
"RTN","BIAPCHS",183,0)
 I BIERR]"" D WRITE(.BILINE,"      *"_BIERR) Q
"RTN","BIAPCHS",184,0)
 ;
"RTN","BIAPCHS",185,0)
 S BIFORCST=$P(BIRETVAL,BI31,1)
"RTN","BIAPCHS",186,0)
 N I,V,BIX,BIZ S BIZ="",V="|"
"RTN","BIAPCHS",187,0)
 ;
"RTN","BIAPCHS",188,0)
 F I=1:1 S BIX=$P(BIFORCST,U,I) Q:BIX=""  D
"RTN","BIAPCHS",189,0)
 .Q:$P(BIX,V)'="I"
"RTN","BIAPCHS",190,0)
 .;
"RTN","BIAPCHS",191,0)
 .;---> Check if new vaccine group; if so, insert line feed.
"RTN","BIAPCHS",192,0)
 .I $P(BIX,V,6)'=BIZ D
"RTN","BIAPCHS",193,0)
 ..S BIZ=$P(BIX,V,6)
"RTN","BIAPCHS",194,0)
 ..;---> If extra line feed was just sent due to Invalid/Reaction, don't here.
"RTN","BIAPCHS",195,0)
 ..D:'$G(BILF) WRITE(.BILINE)
"RTN","BIAPCHS",196,0)
 .;---> Reset line feed flag to zero.
"RTN","BIAPCHS",197,0)
 .S BILF=0
"RTN","BIAPCHS",198,0)
 .;
"RTN","BIAPCHS",199,0)
 .;---> Set flag for ImmServe Problem Dose, flag for asterisk.
"RTN","BIAPCHS",200,0)
 .N BIAST,BIIMMS S BIAST=0,BIIMMS=0
"RTN","BIAPCHS",201,0)
 .;---> Next line: Insert asterisk if Problem Dose ;Cimarron/Mike Remillard 7/30/03
"RTN","BIAPCHS",202,0)
 .D
"RTN","BIAPCHS",203,0)
 ..;---> If there is a Dose Override, set asterisk flag (BIAST)=1.
"RTN","BIAPCHS",204,0)
 ..I $P(BIX,V,10) S BIAST=1 Q
"RTN","BIAPCHS",205,0)
 ..;---> If ImmServe considers this dose to be Invalid, insert asterisk.
"RTN","BIAPCHS",206,0)
 ..;---> Use BIPDSS (ImmServe problem dose string) from Forecast above.
"RTN","BIAPCHS",207,0)
 ..I $$PDSS^BIUTL8($P(BIX,V,4),$P(BIX,V,12),BIPDSS) S BIAST=1,BIIMMS=1
"RTN","BIAPCHS",208,0)
 .;
"RTN","BIAPCHS",209,0)
 .N Y S Y=""
"RTN","BIAPCHS",210,0)
 .S Y="     "_$S($G(BIAST):"*",1:" ")_$P(BIX,V,2)
"RTN","BIAPCHS",211,0)
 .;
"RTN","BIAPCHS",212,0)
 .;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIAPCHS",213,0)
 .;---> Display Date of Event if different from Date of Visit.
"RTN","BIAPCHS",214,0)
 .;---> Also display Age at time of Event if different.
"RTN","BIAPCHS",215,0)
 .;S Y=$$PAD(Y,27)_$P(BIX,V,11)
"RTN","BIAPCHS",216,0)
 .;S Y=$$PAD(Y,37)_$P(BIX,V,9)
"RTN","BIAPCHS",217,0)
 .N BIDT S BIDT=$P(BIX,V,13)
"RTN","BIAPCHS",218,0)
 .S Y=$$PAD(Y,27)_$$SLDT2^BIUTL5(BIDT,1)
"RTN","BIAPCHS",219,0)
 .S Y=$$PAD(Y,37)_$$AGEF^BIUTL1(BIDFN,BIDT)
"RTN","BIAPCHS",220,0)
 .;**********
"RTN","BIAPCHS",221,0)
 .;
"RTN","BIAPCHS",222,0)
 .S Y=$$PAD(Y,45)_$E($P(BIX,V,5),1,20)
"RTN","BIAPCHS",223,0)
 .S Y=$$PAD(Y,66)_$P(BIX,V,7)
"RTN","BIAPCHS",224,0)
 .D WRITE(.BILINE,Y)
"RTN","BIAPCHS",225,0)
 .;
"RTN","BIAPCHS",226,0)
 .;---> If there was a Dose Override, display it here.
"RTN","BIAPCHS",227,0)
 .D:$P(BIX,V,10)
"RTN","BIAPCHS",228,0)
 ..S Y=$$PAD(" ",27)_"-"_$$DOVER^BIUTL8($P(BIX,V,10))_"-"
"RTN","BIAPCHS",229,0)
 ..D WRITE(.BILINE,Y)  ;S BILF=1
"RTN","BIAPCHS",230,0)
 .;
"RTN","BIAPCHS",231,0)
 .;---> If ImmServe considers this dose to be Invalid, display it here.
"RTN","BIAPCHS",232,0)
 .;---> Use BIPDSS (ImmServe problem dose string) from Forecast above.
"RTN","BIAPCHS",233,0)
 .D:$G(BIIMMS)
"RTN","BIAPCHS",234,0)
 ..S Y=$$PAD(" ",27)_"-INVALID--SEE IMMSERVE-"
"RTN","BIAPCHS",235,0)
 ..D WRITE(.BILINE,Y)  ;S BILF=1
"RTN","BIAPCHS",236,0)
 .;
"RTN","BIAPCHS",237,0)
 .;---> If there was a Reaction, display it here.
"RTN","BIAPCHS",238,0)
 .D:$P(BIX,V,8)]""
"RTN","BIAPCHS",239,0)
 ..S Y=$$PAD(" ",27)_"Reaction: "_$P(BIX,V,8)
"RTN","BIAPCHS",240,0)
 ..D WRITE(.BILINE,Y)  ;S BILF=1
"RTN","BIAPCHS",241,0)
 ;
"RTN","BIAPCHS",242,0)
 Q
"RTN","BIAPCHS",243,0)
 ;
"RTN","BIAPCHS",244,0)
 ;
"RTN","BIAPCHS",245,0)
 ;----------
"RTN","BIAPCHS",246,0)
PAD(D,L,C) ;EP
"RTN","BIAPCHS",247,0)
 ;---> Pad the length of data to a total of L characters
"RTN","BIAPCHS",248,0)
 ;---> by adding spaces to the end of the data.
"RTN","BIAPCHS",249,0)
 ;     Example: S X=$$PAD("MIKE",7)  X="MIKE   " (Added 3 spaces.)
"RTN","BIAPCHS",250,0)
 ;---> Parameters:
"RTN","BIAPCHS",251,0)
 ;     1 - D  (req) Data to be padded.
"RTN","BIAPCHS",252,0)
 ;     2 - L  (req) Total length of resulting data.
"RTN","BIAPCHS",253,0)
 ;     3 - C  (opt) Character to pad with (default=space).
"RTN","BIAPCHS",254,0)
 ;
"RTN","BIAPCHS",255,0)
 Q:'$D(D) ""
"RTN","BIAPCHS",256,0)
 S:'$G(L) L=$L(D)
"RTN","BIAPCHS",257,0)
 S:$G(C)="" C=" "
"RTN","BIAPCHS",258,0)
 Q $E(D_$$REPEAT^XLFSTR(C,L),1,L)
"RTN","BIAPCHS",259,0)
 ;
"RTN","BIAPCHS",260,0)
 ;
"RTN","BIAPCHS",261,0)
 ;----------
"RTN","BIAPCHS",262,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIAPCHS",263,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIAPCHS",264,0)
 ;---> Parameters:
"RTN","BIAPCHS",265,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIAPCHS",266,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIAPCHS",267,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIAPCHS",268,0)
 ;
"RTN","BIAPCHS",269,0)
 Q:'$D(BILINE)
"RTN","BIAPCHS",270,0)
 D WL^BIW(.BILINE,"BIHS",$G(BIVAL),$G(BIBLNK))
"RTN","BIAPCHS",271,0)
 Q
"RTN","BICMGR")
0^8^B18546662
"RTN","BICMGR",1,0)
BICMGR ;IHS/CMI/MWR - ADD/EDIT CASE MANAGER; MAY 10, 2010
"RTN","BICMGR",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BICMGR",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BICMGR",4,0)
 ;;  CALLED BY OPTION: "BI CASE MANAGERS ADD/EDIT" TO ADD OR
"RTN","BICMGR",5,0)
 ;;  DEACTIVATE CASE MANAGERS.
"RTN","BICMGR",6,0)
 ;
"RTN","BICMGR",7,0)
 ;
"RTN","BICMGR",8,0)
 ;----------
"RTN","BICMGR",9,0)
START ;EP
"RTN","BICMGR",10,0)
 ;---> DIE Add/Edit Case Managers.
"RTN","BICMGR",11,0)
 D SETVARS^BIUTL5
"RTN","BICMGR",12,0)
 N Y
"RTN","BICMGR",13,0)
 F  D  Q:$G(Y)<0
"RTN","BICMGR",14,0)
 .D TITLE^BIUTL5("ADD/EDIT CASE MANAGERS")
"RTN","BICMGR",15,0)
 .D TEXT1
"RTN","BICMGR",16,0)
 .D DIC^BIFMAN(9002084.01,"QEMAL",.Y,"   Select CASE MANAGER: ")
"RTN","BICMGR",17,0)
 .Q:Y<0
"RTN","BICMGR",18,0)
 .D DIE^BIFMAN(9002084.01,.02,+Y,.BIPOP)
"RTN","BICMGR",19,0)
 .S:BIPOP Y=-1
"RTN","BICMGR",20,0)
 Q
"RTN","BICMGR",21,0)
 ;
"RTN","BICMGR",22,0)
 ;
"RTN","BICMGR",23,0)
 ;----------
"RTN","BICMGR",24,0)
TEXT1 ;EP
"RTN","BICMGR",25,0)
 ;;This option allows you to add new Case Managers, so that they can
"RTN","BICMGR",26,0)
 ;;be selected when editing a patient's Case Data.
"RTN","BICMGR",27,0)
 ;;
"RTN","BICMGR",28,0)
 ;;You may also add a "DATE INACTIVATED" here for a Case Manager who
"RTN","BICMGR",29,0)
 ;;is no longer active in your program.  ANY DATE in a Case Manager's
"RTN","BICMGR",30,0)
 ;;Date Inactivated field will prevent that Case Manager from being
"RTN","BICMGR",31,0)
 ;;selected when editing a patient's Case Data.
"RTN","BICMGR",32,0)
 ;;
"RTN","BICMGR",33,0)
 ;;Occasionally, you may want to RE-activate a Case Manager.  You may
"RTN","BICMGR",34,0)
 ;;do this by deleting the date in the DATE INACTIVATED field (enter
"RTN","BICMGR",35,0)
 ;;@ at the DATE INACTIVATED prompt).
"RTN","BICMGR",36,0)
 ;;
"RTN","BICMGR",37,0)
 ;;
"RTN","BICMGR",38,0)
 D PRINTX("TEXT1")
"RTN","BICMGR",39,0)
 Q
"RTN","BICMGR",40,0)
 ;
"RTN","BICMGR",41,0)
 ;
"RTN","BICMGR",42,0)
 ;----------
"RTN","BICMGR",43,0)
TRANS ;EP
"RTN","BICMGR",44,0)
 ;---> Transfer one Case Manager's patients to another Case Manager.
"RTN","BICMGR",45,0)
 ;
"RTN","BICMGR",46,0)
 D TITLE^BIUTL5("TRANSFER A CASE MANAGER'S PATIENTS")
"RTN","BICMGR",47,0)
 D TEXT2
"RTN","BICMGR",48,0)
 D DIC^BIFMAN(9002084.01,"QEMA",.Y,"   Select OLD CASE MANAGER: ")
"RTN","BICMGR",49,0)
 Q:Y<0
"RTN","BICMGR",50,0)
 S BICMGR=+Y
"RTN","BICMGR",51,0)
 D DIC^BIFMAN(9002084.01,"QEMA",.Y,"   Select NEW CASE MANAGER: ")
"RTN","BICMGR",52,0)
 Q:Y<0
"RTN","BICMGR",53,0)
 S BICMGR1=+Y
"RTN","BICMGR",54,0)
 W !!?3,"All patients currently assigned to: ",$$PERSON^BIUTL1(BICMGR)
"RTN","BICMGR",55,0)
 W !?3,"will be reassigned to.............: ",$$PERSON^BIUTL1(BICMGR1)
"RTN","BICMGR",56,0)
 ;
"RTN","BICMGR",57,0)
 W !!?3,"Do you wish to proceed?"
"RTN","BICMGR",58,0)
 S DIR("?")="     Enter YES to swap Case Managers."
"RTN","BICMGR",59,0)
 S DIR(0)="Y",DIR("A")="   Enter Yes or No"
"RTN","BICMGR",60,0)
 D ^DIR W !
"RTN","BICMGR",61,0)
 Q:$D(DIRUT)!('Y)
"RTN","BICMGR",62,0)
 N BILOCK S BILOCK=0
"RTN","BICMGR",63,0)
 S N=0,M=0
"RTN","BICMGR",64,0)
 F  S N=$O(^BIP("C",BICMGR,N)) Q:'N  D
"RTN","BICMGR",65,0)
 .N BIPOP S BIPOP=0
"RTN","BICMGR",66,0)
 .D DIE^BIFMAN(9002084,".1////"_BICMGR1,N,.BIPOP,1)
"RTN","BICMGR",67,0)
 .I BIPOP S BILOCK=1 Q
"RTN","BICMGR",68,0)
 .S M=M+1
"RTN","BICMGR",69,0)
 ;
"RTN","BICMGR",70,0)
 W !?3,M," patients transferred from ",$$PERSON^BIUTL1(BICMGR)
"RTN","BICMGR",71,0)
 W " to ",$$PERSON^BIUTL1(BICMGR1),"."
"RTN","BICMGR",72,0)
 ;---> If some patients were locked, notify user.
"RTN","BICMGR",73,0)
 D:BILOCK TEXT3
"RTN","BICMGR",74,0)
 D DIRZ^BIUTL3()
"RTN","BICMGR",75,0)
 D EXIT
"RTN","BICMGR",76,0)
 Q
"RTN","BICMGR",77,0)
 ;
"RTN","BICMGR",78,0)
 ;
"RTN","BICMGR",79,0)
 ;----------
"RTN","BICMGR",80,0)
TEXT2 ;EP
"RTN","BICMGR",81,0)
 ;;The purpose of this utility is to aid in the transfer of all of one
"RTN","BICMGR",82,0)
 ;;Case Manager's patients to another Case Manager, such as when there
"RTN","BICMGR",83,0)
 ;;is a turnover in staff.  The program will ask you for an "OLD" Case
"RTN","BICMGR",84,0)
 ;;Manager and then for a "NEW" Case Manager.  All patients who were
"RTN","BICMGR",85,0)
 ;;previously assigned to the "OLD" Case Manager will be reassigned to
"RTN","BICMGR",86,0)
 ;;the "NEW" Case Manager.
"RTN","BICMGR",87,0)
 ;;
"RTN","BICMGR",88,0)
 ;;If the "NEW" Case Manager you are looking for cannot be selected,
"RTN","BICMGR",89,0)
 ;;that person must first be added to the file of Case Managers by
"RTN","BICMGR",90,0)
 ;;using the "Add/Edit Case Managers" option.
"RTN","BICMGR",91,0)
 ;;
"RTN","BICMGR",92,0)
 D PRINTX("TEXT2")
"RTN","BICMGR",93,0)
 Q
"RTN","BICMGR",94,0)
 ;
"RTN","BICMGR",95,0)
 ;
"RTN","BICMGR",96,0)
 ;----------
"RTN","BICMGR",97,0)
TEXT3 ;EP
"RTN","BICMGR",98,0)
 ;;
"RTN","BICMGR",99,0)
 ;;NOTE! One or more patients were being edited by another user during
"RTN","BICMGR",100,0)
 ;;      this transfer.   Those patients did not get reassigned.
"RTN","BICMGR",101,0)
 ;;      This transfer should be run again later to pick up any
"RTN","BICMGR",102,0)
 ;;      remaining patients.
"RTN","BICMGR",103,0)
 D PRINTX("TEXT3",3)
"RTN","BICMGR",104,0)
 Q
"RTN","BICMGR",105,0)
 ;
"RTN","BICMGR",106,0)
 ;
"RTN","BICMGR",107,0)
 ;----------
"RTN","BICMGR",108,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BICMGR",109,0)
 Q:$G(BILINL)=""
"RTN","BICMGR",110,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BICMGR",111,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BICMGR",112,0)
 Q
"RTN","BICMGR",113,0)
 ;
"RTN","BICMGR",114,0)
 ;
"RTN","BICMGR",115,0)
 ;----------
"RTN","BICMGR",116,0)
EXIT ;EP
"RTN","BICMGR",117,0)
 ;---> End of job cleanup.
"RTN","BICMGR",118,0)
 D KILLALL^BIUTL8()
"RTN","BICMGR",119,0)
 Q
"RTN","BIDE")
0^9^B38132337
"RTN","BIDE",1,0)
BIDE ;IHS/CMI/MWR - BUILD ^BIEXPDD GLOBAL.
"RTN","BIDE",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIDE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDE",4,0)
 ;;  UTILITY: BUILD ^BIEXPDD GLOBAL.
"RTN","BIDE",5,0)
 ;
"RTN","BIDE",6,0)
 ;
"RTN","BIDE",7,0)
 ;----------
"RTN","BIDE",8,0)
START ;EP
"RTN","BIDE",9,0)
 D KGBL^BIUTL8("^BIEXPDD")
"RTN","BIDE",10,0)
 S ^BIEXPDD(0)="BI TABLE DATA ELEMENT^9002084.91I"
"RTN","BIDE",11,0)
 N I,X,Y,Z
"RTN","BIDE",12,0)
 F I=1:1 S X=$T(@"TABLE"+I) Q:X'[";;"  D
"RTN","BIDE",13,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BIDE",14,0)
 .S ^BIEXPDD(Y,0)=Z
"RTN","BIDE",15,0)
 N DIK S DIK="^BIEXPDD(" D IXALL^DIK
"RTN","BIDE",16,0)
 Q
"RTN","BIDE",17,0)
 ;
"RTN","BIDE",18,0)
 ;
"RTN","BIDE",19,0)
 ;----------
"RTN","BIDE",20,0)
TABLE ; EP
"RTN","BIDE",21,0)
 ;;1;;LASTNAME,FIRSTNAME MI^S Y=$$NAME~BIUTL1(BIDFN)^NAME^A
"RTN","BIDE",22,0)
 ;;2;;LASTNAME ONLY^S Y=$$NAME~BIUTL1(BIDFN,3)^NAME^A
"RTN","BIDE",23,0)
 ;;3;;FIRSTNAME ONLY^S Y=$$NAME~BIUTL1(BIDFN,2)^NAME^A
"RTN","BIDE",24,0)
 ;;4;;VACCINE NAME, SHORT^S Y=$$VNAME~BIUTL2($P(BI0,U))^VS^I
"RTN","BIDE",25,0)
 ;;5;;CHART#^S Y=$$HRCN~BIUTL1(BIDFN,DUZ(2))^HRCN^A
"RTN","BIDE",26,0)
 ;;6;;DOSE#^S Y=$P(BI0,U,4)^SERIES^I
"RTN","BIDE",27,0)
 ;;7;;DATE OF BIRTH (MM/DD/YYYY)^S Y=$$DOB~BIUTL1(BIDFN),Y=$$SLDT2~BIUTL5(Y)^DOB^A
"RTN","BIDE",28,0)
 ;;8;;VACCINE COMPONENT IENS^ S Y=$$VCOMPS~BIUTL2($P(BI0,U))^COMPS^I
"RTN","BIDE",29,0)
 ;;9;;VACCINE NAME, LONG^S Y=$$VNAME~BIUTL2($P(BI0,U),1)^VL^I
"RTN","BIDE",30,0)
 ;;10;;SEX^S Y=$$SEX~BIUTL1(BIDFN)^^A
"RTN","BIDE",31,0)
 ;;11;;AGE IN MONTHS (TODAY)^S Y=$$AGE~BIUTL1(BIDFN,2)^AM^A
"RTN","BIDE",32,0)
 ;;12;;AGE IN YEARS (TODAY)^S Y=$$AGE~BIUTL1(BIDFN,1)^AY^A
"RTN","BIDE",33,0)
 ;;13;;SSN#^S Y=$$SSN~BIUTL1(BIDFN)^SOC^A
"RTN","BIDE",34,0)
 ;;14;;CHART# (NO DASHES)^S Y=$$HRCN~BIUTL1(BIDFN,DUZ(2),1)^HRCN^A
"RTN","BIDE",35,0)
 ;;15;;PHONE, HOME^S Y=$$HPHONE~BIUTL1(BIDFN)^HOME^A
"RTN","BIDE",36,0)
 ;;16;;ADDRESS-STREET^S Y=$$STREET~BIUTL1(BIDFN)^ADD^A
"RTN","BIDE",37,0)
 ;;17;;ADDRESS-CITY^S Y=$$CITY~BIUTL1(BIDFN)^ADDC^A
"RTN","BIDE",38,0)
 ;;18;;ADDRESS-STATE^S Y=$$STATE~BIUTL1(BIDFN)^ADDS^A
"RTN","BIDE",39,0)
 ;;19;;ADDRESS-ZIP^S Y=$$ZIP~BIUTL1(BIDFN)^ADDZ^A
"RTN","BIDE",40,0)
 ;;20;;CURRENT COMMUNITY IEN^S Y=$$CURCOM~BIUTL11(BIDFN)^COMM^A
"RTN","BIDE",41,0)
 ;;21;;DATE OF VISIT (MM/DD/YYYY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$SLDT2~BIUTL5(Y)^DOV^A
"RTN","BIDE",42,0)
 ;;23;;DATE OF VISIT IMM/SERV (MMDDYYYY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$NOSLDT~BIUTL5(Y)^DOV^A
"RTN","BIDE",43,0)
 ;;24;;V FILE IEN^S Y=BIVIEN^VISIT^A
"RTN","BIDE",44,0)
 ;;25;;VACCINE CODE, HL7-CVX^S Y=$$CODE~BIUTL2($P(BI0,U))^HL7^I
"RTN","BIDE",45,0)
 ;;26;;LOCATION OF VISIT IHS/OTHER (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1)^VISIT^A
"RTN","BIDE",46,0)
 ;;27;;VACCINE GRP NAME (SERIES TYPE)^S Y=$$IMMVG~BIUTL2($P(BI0,U),1)^GROUP^I
"RTN","BIDE",47,0)
 ;;28;;DATE OF BIRTH (DD-Mmm-YYYY)^S Y=$$DOB~BIUTL1(BIDFN),Y=$$TXDT1~BIUTL5(Y)^DOB^A
"RTN","BIDE",48,0)
 ;;29;;DATE OF VISIT (DD-Mmm-YYYY @HHMM)^S Y=$$IMMDTT~BIUTL6(BIVPTR,,1)^DOV^A
"RTN","BIDE",49,0)
 ;;30;;VACCINE NAME, IEN^S Y=$P(BI0,U)^VIEN^I
"RTN","BIDE",50,0)
 ;;31;;VACCINE MAXIMUM DOSE#^S Y=$$VMAX~BIUTL2($P(BI0,U))^MAXIM^I
"RTN","BIDE",51,0)
 ;;32;;VACCINE LOT NUMBER, IEN^S Y=$P(BI0,U,5)^LOT^I
"RTN","BIDE",52,0)
 ;;33;;VACCINE LOT NUMBER, TEXT^S Y=$P(BI0,U,5) S:+Y Y=$P($G(~AUTTIML($P(BI0,U,5),0)),U)^LOT^I
"RTN","BIDE",53,0)
 ;;34;;LOCATION IEN^S Y=$P(~AUPNVSIT(BIVPTR,0),U,6)^IEN^A
"RTN","BIDE",54,0)
 ;;35;;CATEGORY OF VISIT^S Y=$P(~AUPNVSIT(BIVPTR,0),U,7)^VISIT^A
"RTN","BIDE",55,0)
 ;;36;;LOCATION OF VISIT OTHER (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1,2)^OTHER^A
"RTN","BIDE",56,0)
 ;;37;;LOCATION OF VISIT IHS (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1,1)^VISIT^A
"RTN","BIDE",57,0)
 ;;38;;SKIN TEST RESULT^S Y=$$SKRESLT~BIUTL6($P(BI0,U,4))^RES^S
"RTN","BIDE",58,0)
 ;;39;;SKIN TEST READING^S Y=$P(BI0,U,5)^READ^S
"RTN","BIDE",59,0)
 ;;40;;SKIN TEST DATE READ (MM/DD/YY)^S Y=$$SLDT2~BIUTL5($P(BI0,U,6),1)^DATE^S
"RTN","BIDE",60,0)
 ;;41;;SKIN TEST NAME^S Y=$$SKNAME~BIUTL6($P(BI0,U))^TEST^S
"RTN","BIDE",61,0)
 ;;42;;SKIN TEST NAME IEN^S Y=$P(BI0,U)^TEST^S
"RTN","BIDE",62,0)
 ;;43;;VACCINE REACTION, IEN^S Y=$P(BI0,U,6)^VRX^I
"RTN","BIDE",63,0)
 ;;44;;VACCINE REACTION, TEXT^S Y=$$REACTXT~BIUTL6($P(BI0,U,6))^VRT^I
"RTN","BIDE",64,0)
 ;;45;;MOTHER'S HBSAG STATUS^S Y=$$MOTHER~BIUTL11(BIDFN,1)^HB^A
"RTN","BIDE",65,0)
 ;;46;;PARENT OR GUARDIAN^S Y=$$PARENT~BIUTL1(BIDFN)^GUARD^A
"RTN","BIDE",66,0)
 ;;47;;CASE MANAGER^S Y=$$CMGR~BIUTL1(BIDFN)^^A
"RTN","BIDE",67,0)
 ;;48;;DATE INACTIVE (DD-Mmm-YYYY)^S Y=$$TXDT1~BIUTL5($$INACT~BIUTL1(BIDFN))^INACT^A
"RTN","BIDE",68,0)
 ;;49;;VACCINE INFO STMT (1=YES, 2=NO)^S Y=$P(BI0,U,11)^VIS^I
"RTN","BIDE",69,0)
 ;;50;;VAC INFO STMT DATE FM (YYYMMDD)^S Y=$P(BI0,U,12)^VISD^I
"RTN","BIDE",70,0)
 ;;51;;VAC INFO STMT DATE (DD-Mmm-YYYY)^S Y=$P(BI0,U,12),Y=$$TXDT1~BIUTL5(Y)^VISD^I
"RTN","BIDE",71,0)
 ;;52;;VACCINE CODE, CPT^S Y=$$CODE~BIUTL2($P(BI0,U),2)^CPT^I
"RTN","BIDE",72,0)
 ;;55;;VACCINE GRP IEN (SERIES TYPE)^S Y=$$IMMVG~BIUTL2($P(BI0,U),2)^GROUP^I
"RTN","BIDE",73,0)
 ;;56;;DATE OF VISIT FILEMAN (YYYMMDD)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),".")^DOVF^A
"RTN","BIDE",74,0)
 ;;57;;AGE AT VISIT^S Y=$$AGEF~BIUTL1(BIDFN,$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."))^AV^A
"RTN","BIDE",75,0)
 ;;58;;PATIENT DFN^S Y=BIDFN^DFN^A
"RTN","BIDE",76,0)
 ;;59;;VISIT, PPC TYPE^S Y=$P(~AUPNVSIT(+BIVPTR,0),U,3)^TYPE^A
"RTN","BIDE",77,0)
 ;;60;;DATE OF VISIT (DD-Mmm-YYYY)^S Y=$P($G(~AUPNVSIT(+BIVPTR,0)),U),Y=$$TXDT1~BIUTL5(Y)^DOV^A
"RTN","BIDE",78,0)
 ;;61;;PROVIDER, ENCOUNTER IEN^S Y=$P(BI012,U,4)^^A
"RTN","BIDE",79,0)
 ;;62;;CURRENT COMMUNITY TEXT^S Y=$$CURCOM~BIUTL11(BIDFN,1)^COMM^A
"RTN","BIDE",80,0)
 ;;63;;MOTHER'S MAIDEN NAME^S Y=$$MOTHMAID~BIUTL11(BIDFN)^MAIDEN^A
"RTN","BIDE",81,0)
 ;;64;;PATIENT BENEFICIARY TYPE^S Y=$$BENTYP~BIUTL11(BIDFN,1)^BENEFI^A
"RTN","BIDE",82,0)
 ;;65;;DOSE OVERRIDE^S Y=$P(BI0,U,8)^OVRD^I
"RTN","BIDE",83,0)
 ;;66;;DATE OF VISIT YY (MM/DD/YY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$SLDT2~BIUTL5(Y,1)^DOVYY^A
"RTN","BIDE",84,0)
 ;;67;;INJECTION SITE^S Y=$P(BI0,U,9)^IS^A
"RTN","BIDE",85,0)
 ;;68;;VOLUME^S Y=$P(BI0,U,11)^^A
"RTN","BIDE",86,0)
 ;;69;;VACCINE COMPONENT CVX CODE^S Y=$$CODE~BIUTL2($P(BI0,U))^COMP^I
"RTN","BIDE",87,0)
 ;;70;;SKIN TEST READER^S Y=$P(BI0,U,8)^READER^S
"RTN","BIDE",88,0)
 ;;71;;REASON INACTIVE^S Y=$$INACTRE~BIUTL1(BIDFN)^INACT^A
"RTN","BIDE",89,0)
 ;;72;;LOCATION MOVED OR TX ELSEWHERE^S Y=$$MOVEDLOC~BIUTL1(BIDFN)^MOVED^A
"RTN","BIDE",90,0)
 ;;73;;VACCINE CODE, HL7-CVX LEADING ZERO^S Y=$$CODE~BIUTL2($P(BI0,U),6)^HL70^I
"RTN","BIDE",91,0)
 ;;74;;CPT-CODED VISIT^S Y=$P(BI0,U,13)^CPTC^I
"RTN","BIDE",92,0)
 ;;75;;PROVIDER, NAME^S Y=$P(BI012,U,4) S:Y Y=$P($G(~VA(200,Y,0)),U)^^A
"RTN","BIDE",93,0)
 ;;76;;VISIT IEN^S Y=$P(BI0,U,3)^VIEN^A
"RTN","BIDE",94,0)
 ;;77;;ELIG CODE, IEN^S Y=$P(BI0,U,14)^VFC^I
"RTN","BIDE",95,0)
 ;;78;;IMPORTED FROM OUTSIDE REGISTRY^S Y=$P(BI0,U,15)^IMPORT^I
"RTN","BIDE",96,0)
 ;;79;;CONSENT STATE REGISTRY^S Y=$$CONSENT~BIUTL1(BIDFN)^CONS^A
"RTN","BIDE",97,0)
 ;;80;;NDC CODE, IEN^S Y=$P(BI0,U,16)^NDCPTR^I
"RTN","BIDE",98,0)
 ;;82;;ELIG CODE, TEXT^S Y=$$ELIGC~BIELIG($P(BI0,U,14),1)^ELIGTX^I
"RTN","BIDE",99,0)
 ;;83;;ELIG CODE, LABEL^S Y=$$ELIGC~BIELIG($P(BI0,U,14),2)^ELIGLB^I
"RTN","BIDE",100,0)
 ;;84;;NDC CODE, TEXT^S Y=$$NDC~BINDC($P(BI0,U,16),1)^NDCTXT^I
"RTN","BIDE",101,0)
 ;;85;;DATE OF EVENT OR VISIT (MM/DD/YY)^S Y=$$IMMDTT~BIUTL6(BIVPTR,$G(BI012))^DATEVT^A
"RTN","BIDE",102,0)
 ;;86;;DATE OF EVENT OR VISIT (YYYMMDD)^S Y=$$IMMDTT~BIUTL6(BIVPTR,$G(BI012),2)^DOEVFM^A
"RTN","BIDE",103,0)
 ;;87;;ADMINISTRATIVE NOTE^S Y=$P(BI01,U,1)^BIANOT^A
"RTN","BIDE",104,0)
 ;;88;;DATE OF VISIT TCH (YYYYMMDD)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$FMTCHDT~BIUTL5(Y)^DOVTCH^A
"RTN","BIDE",105,0)
 ;;89;;DATE VIS PRESENTED FM (YYYMMDD)^S Y=$P(BI0,U,17)^DATVIS^I
"RTN","BIDE",106,0)
 ;;90;;DATE VIS PRESENTED (MM/DD/YY)^I $P(BI0,U,17) S Y=$$SLDT2~BIUTL5($P(BI0,U,17))^DTVISL^I
"RTN","BIDE",107,0)
 ;;91;;DATE ADMIN SHOT--EVENT ONLY^S Y=$$IMMDTT~BIUTL6(,$G(BI012))^DADMIN^I
"RTN","BIDTAB")
0^10^B6439410
"RTN","BIDTAB",1,0)
BIDTAB ;IHS/CMI/MWR - VIEW DATA ELEMENTS; MAY 10, 2010
"RTN","BIDTAB",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDTAB",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDTAB",4,0)
 ;;  VIEW DATA ELEMENTS, NOT CALLED BY MENUS, PROGRAMMER ONLY.
"RTN","BIDTAB",5,0)
 ;
"RTN","BIDTAB",6,0)
 ;
"RTN","BIDTAB",7,0)
 ;---> Select Data Elements, if ASCII.
"RTN","BIDTAB",8,0)
 N BIIT S BIIT="Data Element"
"RTN","BIDTAB",9,0)
 N BICOL S BICOL="    #  Data Element                       IEN"
"RTN","BIDTAB",10,0)
 ;N BIID S BIID="3;S X=X_""   IEN: ""_BIIEN;40"
"RTN","BIDTAB",11,0)
 N BIID S BIID="1;S X=BIIEN;40"
"RTN","BIDTAB",12,0)
 D SEL^BISELECT(9002084.91,"BIDE",BIIT,,,,BIID,BICOL,.BIPOP,1)
"RTN","BIDTAB",13,0)
 Q
"RTN","BIDTAB",14,0)
 ;
"RTN","BIDTAB",15,0)
 ;
"RTN","BIDTAB",16,0)
 ;**** CODE BELOW SHOULD BE USED TO CREATE PROPER LIST TEMPLATE.
"RTN","BIDTAB",17,0)
 ;**** For now, at least, it displays all Error Codes in a List.
"RTN","BIDTAB",18,0)
 ;----------
"RTN","BIDTAB",19,0)
START ;EP
"RTN","BIDTAB",20,0)
 ;---> Display Error Code table.
"RTN","BIDTAB",21,0)
 ;
"RTN","BIDTAB",22,0)
 D SETVARS^BIUTL5
"RTN","BIDTAB",23,0)
 D EN
"RTN","BIDTAB",24,0)
 Q
"RTN","BIDTAB",25,0)
 ;
"RTN","BIDTAB",26,0)
 ;
"RTN","BIDTAB",27,0)
 ;----------
"RTN","BIDTAB",28,0)
EN ;EP
"RTN","BIDTAB",29,0)
 ;---> Main entry point for option BI VACCINE TRANSLATION TABLE VIEW.
"RTN","BIDTAB",30,0)
 D EN^VALM("BI TABLE ERROR CODE VIEW")
"RTN","BIDTAB",31,0)
 Q
"RTN","BIDTAB",32,0)
 ;
"RTN","BIDTAB",33,0)
 ;
"RTN","BIDTAB",34,0)
 ;----------
"RTN","BIDTAB",35,0)
INIT ;EP
"RTN","BIDTAB",36,0)
 ;---> Initialize variables and list array.
"RTN","BIDTAB",37,0)
 N N,I
"RTN","BIDTAB",38,0)
 S N=0
"RTN","BIDTAB",39,0)
 F I=1:1 S N=$O(^BIERR(N)) Q:'N  D
"RTN","BIDTAB",40,0)
 .S ^TMP("BIETAB",$J,I,0)="  "_N_"  "_$P(^BIERR(N,0),U,2)
"RTN","BIDTAB",41,0)
 S VALMCNT=I-1
"RTN","BIDTAB",42,0)
 Q
"RTN","BIDTAB",43,0)
 ;
"RTN","BIDTAB",44,0)
 ;
"RTN","BIDTAB",45,0)
 ;----------
"RTN","BIDTAB",46,0)
RESET ;EP
"RTN","BIDTAB",47,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIDTAB",48,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIDTAB",49,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIDTAB",50,0)
 D INIT Q
"RTN","BIDTAB",51,0)
 ;
"RTN","BIDTAB",52,0)
 ;
"RTN","BIDTAB",53,0)
 ;----------
"RTN","BIDTAB",54,0)
HELP ;EP
"RTN","BIDTAB",55,0)
 ;---> Help code.
"RTN","BIDTAB",56,0)
 N BIX S BIX=X
"RTN","BIDTAB",57,0)
 D FULL^VALM1
"RTN","BIDTAB",58,0)
 W !!?5,"Use arrow keys to scroll up and down through the list, or"
"RTN","BIDTAB",59,0)
 W !?5,"enter ""A"", then an Error Code Number in order  to Add, Edit"
"RTN","BIDTAB",60,0)
 W !?5,"or Delete an Error Code, or"
"RTN","BIDTAB",61,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIDTAB",62,0)
 D:BIX'="??" DIRZ^BIUTL3("","     Press ENTER/RETURN to continue"),RE^VALM4
"RTN","BIDTAB",63,0)
 Q
"RTN","BIDTAB",64,0)
 ;
"RTN","BIDTAB",65,0)
 ;
"RTN","BIDTAB",66,0)
 ;----------
"RTN","BIDTAB",67,0)
EXIT ;EP
"RTN","BIDTAB",68,0)
 ;---> Cleanup, EOJ.
"RTN","BIDTAB",69,0)
 D KILLALL^BIUTL8()
"RTN","BIDTAB",70,0)
 K ^TMP("BIETAB",$J)
"RTN","BIDTAB",71,0)
 D CLEAR^VALM1
"RTN","BIDTAB",72,0)
 D FULL^VALM1
"RTN","BIDTAB",73,0)
 Q
"RTN","BIDTAB",74,0)
 ;
"RTN","BIDTAB",75,0)
 ;
"RTN","BIDTAB",76,0)
 ;----------
"RTN","BIDTAB",77,0)
ADDEDEL ;EP
"RTN","BIDTAB",78,0)
 ;---> Add/Edit/Delete Error Codes.
"RTN","BIDTAB",79,0)
 ;
"RTN","BIDTAB",80,0)
 D FULL^VALM1
"RTN","BIDTAB",81,0)
 D TITLE^BIUTL5("ADD/EDIT/DELETE ERROR CODES")
"RTN","BIDTAB",82,0)
 W !!?3,"This is your big chance to add/edit/delete Error Codes!",!!
"RTN","BIDTAB",83,0)
 N Y
"RTN","BIDTAB",84,0)
 D DIC^BIFMAN(9002084.33,"QEMAL",.Y,"   Select ERROR CODE: ")
"RTN","BIDTAB",85,0)
 I Y<1 D RESET Q
"RTN","BIDTAB",86,0)
 S DR=".01;.02"
"RTN","BIDTAB",87,0)
 D DIE^BIFMAN(9002084.33,DR,+Y)
"RTN","BIDTAB",88,0)
 D RESET
"RTN","BIDTAB",89,0)
 Q
"RTN","BIDU")
0^11^B55349718
"RTN","BIDU",1,0)
BIDU ;IHS/CMI/MWR - DUE LIST/LETTERS, MAIN DRIVER; AUG 10,2010
"RTN","BIDU",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDU",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDU",4,0)
 ;;  LIST TEMPLATE CODE FOR DUE LISTS, VIEWING & PRINTING LETTERS.
"RTN","BIDU",5,0)
 ;;  PATCH 1: Fix so that user's DUZ(0) is not always included  INIT+86
"RTN","BIDU",6,0)
 ;
"RTN","BIDU",7,0)
 ;----------
"RTN","BIDU",8,0)
START ;EP
"RTN","BIDU",9,0)
 ;---> Listman Screen for printing Immunization Due Letters.
"RTN","BIDU",10,0)
 ;
"RTN","BIDU",11,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIDU",12,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIDU",13,0)
 ;
"RTN","BIDU",14,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIDU",15,0)
 N BINFO
"RTN","BIDU",16,0)
 D ADDINFO
"RTN","BIDU",17,0)
 D EN
"RTN","BIDU",18,0)
 D EXIT,KILLALL^BIUTL8(1)
"RTN","BIDU",19,0)
 Q
"RTN","BIDU",20,0)
 ;
"RTN","BIDU",21,0)
 ;
"RTN","BIDU",22,0)
 ;----------
"RTN","BIDU",23,0)
EN ;EP
"RTN","BIDU",24,0)
 ;---> Main entry point for DUE LISTS & LETTERS.
"RTN","BIDU",25,0)
 D EN^VALM("BI DUE LISTS & LETTERS")
"RTN","BIDU",26,0)
 Q
"RTN","BIDU",27,0)
 ;
"RTN","BIDU",28,0)
 ;
"RTN","BIDU",29,0)
 ;----------
"RTN","BIDU",30,0)
HDR ;EP
"RTN","BIDU",31,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BIDU",32,0)
 D WH^BIW(.BILINE)
"RTN","BIDU",33,0)
 S X=IOUON_"IMMUNIZATION LISTS & LETTERS" D CENTERT^BIUTL5(.X,42)
"RTN","BIDU",34,0)
 D WH^BIW(.BILINE,X_IOINORM)
"RTN","BIDU",35,0)
 ;D EN^VALM("BI DUE LISTS & LETTERS")
"RTN","BIDU",36,0)
 Q
"RTN","BIDU",37,0)
 ;
"RTN","BIDU",38,0)
 ;
"RTN","BIDU",39,0)
 ;----------
"RTN","BIDU",40,0)
INIT ;EP
"RTN","BIDU",41,0)
 ;---> Initialize variables and list array.
"RTN","BIDU",42,0)
 ;---> Variables set by this Init and reside in the local symbol table
"RTN","BIDU",43,0)
 ;---> for use by other List Templates are defined as follows:
"RTN","BIDU",44,0)
 ;---> Variables:
"RTN","BIDU",45,0)
 ;     1 - BIAG   (req) Age Range^Mths/Yrs (See description in ^BIAGE.)
"RTN","BIDU",46,0)
 ;     2 - BIPG   (req) Patient Group Data; see PGRPOUP1^BIOUTPT4 for details.
"RTN","BIDU",47,0)
 ;     3 - BIFDT  (req) Forecast date.
"RTN","BIDU",48,0)
 ;     4 - BICC   (req) Current Community array.
"RTN","BIDU",49,0)
 ;     5 - BICM   (req) Case Manager array.
"RTN","BIDU",50,0)
 ;     6 - BIMMR  (req) Immunizations Received array.
"RTN","BIDU",51,0)
 ;     7 - BIMMD  (req) Immunizations Due array.
"RTN","BIDU",52,0)
 ;     8 - BIHCF  (req) Health Care Facility array.
"RTN","BIDU",53,0)
 ;     9 - BILOT  (req) Lot Number array.
"RTN","BIDU",54,0)
 ;    10 - BIORD  (req) Order of listing.
"RTN","BIDU",55,0)
 ;    11 - BINFO  (ret) Additional Information (not set here).
"RTN","BIDU",56,0)
 ;    12 - BIRDT  (opt) Date Range for Received Imms (form BEGDATE:ENDDATE).
"RTN","BIDU",57,0)
 ;    13 - BIDED  (opt) Include Deceased Patients (0=no, 1=yes).
"RTN","BIDU",58,0)
 ;    14 - BIT    (ret) Total Patients retrieved (not set here).
"RTN","BIDU",59,0)
 ;    15 - BIMD   (req) Minimum Interval days since last letter.
"RTN","BIDU",60,0)
 ;    16 - BIDPRV (req) Designated Provider array.
"RTN","BIDU",61,0)
 ;    17 - BIBEN  (req) Beneficiary Type array: either BIBEN(1) or BIBEN("ALL").
"RTN","BIDU",62,0)
 ;
"RTN","BIDU",63,0)
 ;---> NOTE: For programming work in any of the BIDU* routines,
"RTN","BIDU",64,0)
 ;--->       it is helpful to printscreen the comments (from INIT here)
"RTN","BIDU",65,0)
 ;--->       to use as a guide for the meaning of BI* variables.
"RTN","BIDU",66,0)
 ;
"RTN","BIDU",67,0)
 ;
"RTN","BIDU",68,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIDU",69,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIDU",70,0)
 K ^TMP("BIDU",$J)
"RTN","BIDU",71,0)
 N BILINE,X S BILINE=0
"RTN","BIDU",72,0)
 ;
"RTN","BIDU",73,0)
 ;---> Date.
"RTN","BIDU",74,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIDU",75,0)
 D DATE^BIREP(.BILINE,"BIDU",1,$G(BIFDT),"Date of Forecast/Clinic",0,2,32)
"RTN","BIDU",76,0)
 ;
"RTN","BIDU",77,0)
 ;---> Age Range.
"RTN","BIDU",78,0)
 S:$G(BIAG)="" BIAG="1-72"
"RTN","BIDU",79,0)
 N BIAG1
"RTN","BIDU",80,0)
 D
"RTN","BIDU",81,0)
 .I +$G(BIPG)=8 S BIAG1="(set by Search Template)" Q
"RTN","BIDU",82,0)
 .I BIAG="ALL" S BIAG1="All Ages" Q
"RTN","BIDU",83,0)
 .S BIAG1=$$MTHYR^BIAGE(BIAG)
"RTN","BIDU",84,0)
 S X="   2 - Age Range................: "_BIAG1
"RTN","BIDU",85,0)
 D WRITE(.BILINE,X)
"RTN","BIDU",86,0)
 K X
"RTN","BIDU",87,0)
 ;
"RTN","BIDU",88,0)
 ;---> Patient Group.
"RTN","BIDU",89,0)
 N BIHEAD,BIPG1 S:'$G(BIPG) BIPG=3
"RTN","BIDU",90,0)
 D PGRP(BIPG,.BIPG1)
"RTN","BIDU",91,0)
 ;
"RTN","BIDU",92,0)
 ;---> If Beneficiary is undefined, default to Am Indian/AK Native.
"RTN","BIDU",93,0)
 S:'$D(BIBEN) BIBEN(1)=""
"RTN","BIDU",94,0)
 S BIHEAD="   3 - Patient Group ("_$S($D(BIBEN("ALL")):"all)",1:"01).")_"......: "
"RTN","BIDU",95,0)
 D
"RTN","BIDU",96,0)
 .I $L(BIHEAD_BIPG1)<46 S X=BIHEAD_BIPG1 D WRITE(.BILINE,X) Q
"RTN","BIDU",97,0)
 .N I,N,V,Z S N=1,V=",",X=""
"RTN","BIDU",98,0)
 .F  D  Q:$P(BIPG1,V,I)=""  Q:$G(BIERR)
"RTN","BIDU",99,0)
 ..F I=N:1 S X=$P(BIPG1,V,N,I) Q:$L(X)>46  Q:$P(BIPG1,V,I)=""
"RTN","BIDU",100,0)
 ..I N>1 S BIHEAD=$$SP^BIUTL5(33)
"RTN","BIDU",101,0)
 ..D WRITE(.BILINE,BIHEAD_$P(BIPG1,V,N,I-1))
"RTN","BIDU",102,0)
 ..S N=I
"RTN","BIDU",103,0)
 D WRITE(.BILINE)
"RTN","BIDU",104,0)
 K X
"RTN","BIDU",105,0)
 ;
"RTN","BIDU",106,0)
 ;---> Current Community.
"RTN","BIDU",107,0)
 D DISP^BIREP(.BILINE,"BIDU",.BICC,"Community",4,1,0,2,32)
"RTN","BIDU",108,0)
 K X
"RTN","BIDU",109,0)
 ;
"RTN","BIDU",110,0)
 ;---> Case Manager.
"RTN","BIDU",111,0)
 D DISP^BIREP(.BILINE,"BIDU",.BICM,"Case Manager",5,3,0,2,32)
"RTN","BIDU",112,0)
 ;
"RTN","BIDU",113,0)
 ;---> Designated Provider.
"RTN","BIDU",114,0)
 D DISP^BIREP(.BILINE,"BIDU",.BIDPRV,"Designated Provider",6,3,0,2,32)
"RTN","BIDU",115,0)
 ;
"RTN","BIDU",116,0)
 ;---> Immunization Received.
"RTN","BIDU",117,0)
 N A,B,C S A="Immunizations Received",B="Immunizations"
"RTN","BIDU",118,0)
 ;---> C=Date Range of Received Imms (form BEGDATE:ENDDATE).
"RTN","BIDU",119,0)
 I $G(BIRDT) S C=$$DATE(BIRDT,1)
"RTN","BIDU",120,0)
 D DISP^BIREP(.BILINE,"BIDU",.BIMMR,A,7,6,0,2,32,B,$G(C)) K A,B,C
"RTN","BIDU",121,0)
 ;
"RTN","BIDU",122,0)
 ;---> Immunization Due.
"RTN","BIDU",123,0)
 N A,B S A="Immunizations"_$S($P(BIPG,U)[2:" Past",1:"")_" Due",B="Immunizations"
"RTN","BIDU",124,0)
 D DISP^BIREP(.BILINE,"BIDU",.BIMMD,A,8,6,0,2,32,B) K A,B
"RTN","BIDU",125,0)
 ;
"RTN","BIDU",126,0)
 ;---> Health Care Facility.
"RTN","BIDU",127,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIDU",128,0)
 ;
"RTN","BIDU",129,0)
 ;********** PATCH 1, v8.4, AUG 01,2010, IHS/CMI/MWR
"RTN","BIDU",130,0)
 ;---> Fix so that user's DUZ(0) is not always included
"RTN","BIDU",131,0)
 ;S:$G(DUZ(2)) BIHCF(DUZ(2))=""
"RTN","BIDU",132,0)
 I '$O(BIHCF(0)),$G(DUZ(2)) S BIHCF(DUZ(2))=""
"RTN","BIDU",133,0)
 ;**********
"RTN","BIDU",134,0)
 ;
"RTN","BIDU",135,0)
 D DISP^BIREP(.BILINE,"BIDU",.BIHCF,A,9,2,0,2,32,B) K A,B
"RTN","BIDU",136,0)
 ;
"RTN","BIDU",137,0)
 ;---> Lot Number.
"RTN","BIDU",138,0)
 D DISP^BIREP(.BILINE,"BIDU",.BILOT,"Lot Number",10,7,1,2,32)
"RTN","BIDU",139,0)
 ;
"RTN","BIDU",140,0)
 ;
"RTN","BIDU",141,0)
 ;---> Additional Information.
"RTN","BIDU",142,0)
 N BINFO1
"RTN","BIDU",143,0)
 D
"RTN","BIDU",144,0)
 .N BIHEAD S BIHEAD="  11 - Additional Information...: "
"RTN","BIDU",145,0)
 .I $D(BINFO("ALL")) D WRITE(.BILINE,BIHEAD_"See list") Q
"RTN","BIDU",146,0)
 .I $O(BINFO(0))="" D WRITE(.BILINE,BIHEAD_"None") Q
"RTN","BIDU",147,0)
 .;
"RTN","BIDU",148,0)
 .;---> Display selections.
"RTN","BIDU",149,0)
 .N N S N=""
"RTN","BIDU",150,0)
 .F  S N=$O(BINFO(N)) Q:'N  D
"RTN","BIDU",151,0)
 ..Q:('$D(^BIADDIN(N,0)))
"RTN","BIDU",152,0)
 ..S BINFO1=$G(BINFO1)_$S($G(BINFO1)]"":", ",1:"")_$P(^BIADDIN(N,0),U,3)
"RTN","BIDU",153,0)
 .;
"RTN","BIDU",154,0)
 .;---> Now write the pieces up to 46 characters wide.
"RTN","BIDU",155,0)
 .N I,N,V,Z S N=1,V=",",X=""
"RTN","BIDU",156,0)
 .F  D  Q:$P(BINFO1,V,I)=""
"RTN","BIDU",157,0)
 ..F I=N:1 S X=$P(BINFO1,V,N,I) Q:$L(X)>46  Q:$P(BINFO1,V,I)=""
"RTN","BIDU",158,0)
 ..I N>1 S BIHEAD=$$SP^BIUTL5(33)
"RTN","BIDU",159,0)
 ..D WRITE(.BILINE,BIHEAD_$P(BINFO1,V,N,I-1))
"RTN","BIDU",160,0)
 ..S N=I
"RTN","BIDU",161,0)
 K X
"RTN","BIDU",162,0)
 ;
"RTN","BIDU",163,0)
 ;
"RTN","BIDU",164,0)
 ;---> Order of Listing.
"RTN","BIDU",165,0)
 S:'$G(BIORD) BIORD=1
"RTN","BIDU",166,0)
 ;
"RTN","BIDU",167,0)
 N X S X="Patient Age"
"RTN","BIDU",168,0)
 S X=X_"^Patient Name (alphabetically)"
"RTN","BIDU",169,0)
 S X=X_"^Patient Chart#"
"RTN","BIDU",170,0)
 S X=X_"^Case Manager"
"RTN","BIDU",171,0)
 S X=X_"^Case Manager, then Community"
"RTN","BIDU",172,0)
 S X=X_"^Community, then Case Manager"
"RTN","BIDU",173,0)
 S X=X_"^Community, then Patient Age"
"RTN","BIDU",174,0)
 S X=X_"^Community, then Patient Name"
"RTN","BIDU",175,0)
 S X=X_"^Community, then Patient Chart#"
"RTN","BIDU",176,0)
 S X=X_"^Zipcode, then Patient Name"
"RTN","BIDU",177,0)
 S X=X_"^Designated Provider"
"RTN","BIDU",178,0)
 ;
"RTN","BIDU",179,0)
 N BIORD1 S BIORD1="by "_$P(X,U,BIORD)
"RTN","BIDU",180,0)
 S X="  12 - Order of Listing.........: "_BIORD1
"RTN","BIDU",181,0)
 D WRITE(.BILINE,X)
"RTN","BIDU",182,0)
 K X
"RTN","BIDU",183,0)
 ;
"RTN","BIDU",184,0)
 ;---> Include Deceased.
"RTN","BIDU",185,0)
 N BIDED1 S BIDED1=""
"RTN","BIDU",186,0)
 S:'$D(BIDED) BIDED=0
"RTN","BIDU",187,0)
 S BIDED1=$S(BIDED:"Yes",1:"No")
"RTN","BIDU",188,0)
 S X="  13 - Include Deceased.........: "_BIDED1
"RTN","BIDU",189,0)
 D WRITE(.BILINE,X)
"RTN","BIDU",190,0)
 K X
"RTN","BIDU",191,0)
 ;
"RTN","BIDU",192,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIDU",193,0)
 S VALMCNT=BILINE,BIRTN="BIDU"
"RTN","BIDU",194,0)
 S:VALMCNT>16 VALMSG="Scroll down to view more Parameters. Type ?? help."
"RTN","BIDU",195,0)
 Q
"RTN","BIDU",196,0)
 ;
"RTN","BIDU",197,0)
 ;
"RTN","BIDU",198,0)
 ;----------
"RTN","BIDU",199,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIDU",200,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIDU",201,0)
 ;---> Parameters:
"RTN","BIDU",202,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIDU",203,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIDU",204,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIDU",205,0)
 ;
"RTN","BIDU",206,0)
 Q:'$D(BILINE)
"RTN","BIDU",207,0)
 D WL^BIW(.BILINE,"BIDU",$G(BIVAL),$G(BIBLNK))
"RTN","BIDU",208,0)
 Q
"RTN","BIDU",209,0)
 ;
"RTN","BIDU",210,0)
 ;
"RTN","BIDU",211,0)
 ;----------
"RTN","BIDU",212,0)
PGRP(BIPG,BIPG1) ;EP
"RTN","BIDU",213,0)
 ;---> Return text of Patient Group.
"RTN","BIDU",214,0)
 ;---> Parameters:
"RTN","BIDU",215,0)
 ;     1 - BIPG  (req) Patient Group Data; see PGRPOUP1^BIOUTPT4 for details.
"RTN","BIDU",216,0)
 ;     2 - BIPG1 (ret) Value/text of line (Null=blank line).
"RTN","BIDU",217,0)
 ;
"RTN","BIDU",218,0)
 ;---> If BIPG=null, return unknown.
"RTN","BIDU",219,0)
 I $G(BIPG)="" S BIPG1="Unknown" Q
"RTN","BIDU",220,0)
 ;
"RTN","BIDU",221,0)
 ;---> If BIPG="some text", simply return it.
"RTN","BIDU",222,0)
 I +BIPG=0 S BIPG1=BIPG Q
"RTN","BIDU",223,0)
 ;
"RTN","BIDU",224,0)
 I $P(BIPG,U)=8 S BIPG1="Search Template: "_$P($G(^DIBT(+$P(BIPG,U,8),0)),U) Q
"RTN","BIDU",225,0)
 ;
"RTN","BIDU",226,0)
 N I,X S BIPG1=""
"RTN","BIDU",227,0)
 S X="Due^Past Due^Active^Inactive^Auto-Activated^Refusals^Females Only^Search Template"
"RTN","BIDU",228,0)
 F I=1,2,3,4,5,6,7,8 D
"RTN","BIDU",229,0)
 .I $P(BIPG,U)[I S BIPG1=$G(BIPG1)_$S(BIPG1]"":", ",1:"")_$P(X,U,I)
"RTN","BIDU",230,0)
 .;---> If 2 - Past Due, add "months Past Due".
"RTN","BIDU",231,0)
 .I I=2,$P(BIPG,U)[2,$P(BIPG,U,2) S BIPG1=BIPG1_" ("_$P(BIPG,U,2)_" mths)" Q
"RTN","BIDU",232,0)
 .I I=4,$P(BIPG,U)[4,($P(BIPG,U,4)]"") S BIPG1=BIPG1_$$DATE(BIPG,4)
"RTN","BIDU",233,0)
 .I I=5,$P(BIPG,U)[5,($P(BIPG,U,5)]"") S BIPG1=BIPG1_$$DATE(BIPG,5)
"RTN","BIDU",234,0)
 Q
"RTN","BIDU",235,0)
 ;
"RTN","BIDU",236,0)
 ;
"RTN","BIDU",237,0)
 ;----------
"RTN","BIDU",238,0)
DATE(BIPG,BIGRP) ;EP
"RTN","BIDU",239,0)
 ;---> Return external form of date for Group Date Range in slash format.
"RTN","BIDU",240,0)
 ;---> Parameters:
"RTN","BIDU",241,0)
 ;     1 - BIPG  (req) Patient Group Data; see PGRPOUP1^BIOUTPT4 for details.
"RTN","BIDU",242,0)
 ;     2 - BIGRP (req) Patient Group.
"RTN","BIDU",243,0)
 ;
"RTN","BIDU",244,0)
 Q:'$G(BIPG) "NO DATE"  Q:'$G(BIGRP) "NO DATE"
"RTN","BIDU",245,0)
 N BIX,BIY,BIZ S BIX=""
"RTN","BIDU",246,0)
 S BIY=$P($P(BIPG,U,BIGRP),":",1)
"RTN","BIDU",247,0)
 S BIZ=$P($P(BIPG,U,BIGRP),":",2)
"RTN","BIDU",248,0)
 ;
"RTN","BIDU",249,0)
 ;---> If dates are default (1/1/1900 and TODAY), don't display date range.
"RTN","BIDU",250,0)
 Q:(BIY=2000101&(BIZ=$G(DT))) BIX
"RTN","BIDU",251,0)
 ;
"RTN","BIDU",252,0)
 S BIX=" ("_$$SLDT2^BIUTL5(BIY)_" to "
"RTN","BIDU",253,0)
 S BIX=BIX_$$SLDT2^BIUTL5(BIZ)_")"
"RTN","BIDU",254,0)
 Q BIX
"RTN","BIDU",255,0)
 ;
"RTN","BIDU",256,0)
 ;
"RTN","BIDU",257,0)
 ;----------
"RTN","BIDU",258,0)
ADDINFO ;EP
"RTN","BIDU",259,0)
 ;---> BIDUZF=User-File# identifier to store and retrieve
"RTN","BIDU",260,0)
 ;---> previous lists of selections from this file.
"RTN","BIDU",261,0)
 N BIDUZF S BIDUZF=+$G(DUZ)_"-"_9002084.82
"RTN","BIDU",262,0)
 ;
"RTN","BIDU",263,0)
 I $D(^BISELECT("B",BIDUZF)) D
"RTN","BIDU",264,0)
 .N BIDA S BIDA=$O(^BISELECT("B",BIDUZF,0))
"RTN","BIDU",265,0)
 .Q:'BIDA  Q:$G(^BISELECT(BIDA,0))=""
"RTN","BIDU",266,0)
 .Q:'$O(^BISELECT(BIDA,1,0))
"RTN","BIDU",267,0)
 .N Y S Y=0
"RTN","BIDU",268,0)
 .F  S Y=$O(^BISELECT(BIDA,1,Y)) Q:Y=""  D
"RTN","BIDU",269,0)
 ..S BINFO(Y)=""
"RTN","BIDU",270,0)
 Q
"RTN","BIDU",271,0)
 ;
"RTN","BIDU",272,0)
 ;
"RTN","BIDU",273,0)
 ;----------
"RTN","BIDU",274,0)
RESET ;EP
"RTN","BIDU",275,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIDU",276,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIDU",277,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIDU",278,0)
 D INIT Q
"RTN","BIDU",279,0)
 ;
"RTN","BIDU",280,0)
 ;
"RTN","BIDU",281,0)
 ;----------
"RTN","BIDU",282,0)
EXIT ;EP
"RTN","BIDU",283,0)
 ;---> EOJ cleanup.
"RTN","BIDU",284,0)
 K ^TMP("BIDU",$J)
"RTN","BIDU",285,0)
 D CLEAR^VALM1
"RTN","BIDU",286,0)
 D FULL^VALM1
"RTN","BIDU",287,0)
 Q
"RTN","BIDU1")
0^12^B30688933
"RTN","BIDU1",1,0)
BIDU1 ;IHS/CMI/MWR - DUE LIST/LETTERS, HELP; MAY 10, 2010
"RTN","BIDU1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDU1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDU1",4,0)
 ;;  DUE LISTS/LETTERS, HELP.
"RTN","BIDU1",5,0)
 ;
"RTN","BIDU1",6,0)
 ;
"RTN","BIDU1",7,0)
 ;----------
"RTN","BIDU1",8,0)
HELP ;EP
"RTN","BIDU1",9,0)
 ;---> Help code.
"RTN","BIDU1",10,0)
 N BIX S BIX=X
"RTN","BIDU1",11,0)
 D FULL^VALM1
"RTN","BIDU1",12,0)
 W !!?5,"Enter ""L"" to view or print a list of patients according to the"
"RTN","BIDU1",13,0)
 W !?5,"selection criteria above.  Enter ""P"" to print letters to the list"
"RTN","BIDU1",14,0)
 W !?5,"of patients selected above.  Or enter ""H"" to view the full help text"
"RTN","BIDU1",15,0)
 W !?5,"of the lists, letters, and parameters above."
"RTN","BIDU1",16,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIDU1",17,0)
 D:BIX'="??" RESET^BIDU
"RTN","BIDU1",18,0)
 Q
"RTN","BIDU1",19,0)
 ;
"RTN","BIDU1",20,0)
 ;
"RTN","BIDU1",21,0)
 ;----------
"RTN","BIDU1",22,0)
HELP1 ;EP
"RTN","BIDU1",23,0)
 ;----> Explanation of this report.
"RTN","BIDU1",24,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIDU1",25,0)
 D START^BIHELP("DUE LISTS AND LETTERS - HELP",.BITEXT)
"RTN","BIDU1",26,0)
 Q
"RTN","BIDU1",27,0)
 ;
"RTN","BIDU1",28,0)
 ;
"RTN","BIDU1",29,0)
 ;----------
"RTN","BIDU1",30,0)
TEXT1(BITEXT) ;EP
"RTN","BIDU1",31,0)
 ;;
"RTN","BIDU1",32,0)
 ;;The IMMUNIZATION LISTS & LETTERS screen provides a single point from
"RTN","BIDU1",33,0)
 ;;which to view Due Lists and Master Lists, and to print Due Letters.
"RTN","BIDU1",34,0)
 ;;
"RTN","BIDU1",35,0)
 ;;There are 13 items or "parameters" on the screen that you may
"RTN","BIDU1",36,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIDU1",37,0)
 ;;To change an item, enter its left column number (1-12) at the
"RTN","BIDU1",38,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIDU1",39,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIDU1",40,0)
 ;;changing.
"RTN","BIDU1",41,0)
 ;;
"RTN","BIDU1",42,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIDU1",43,0)
 ;;you want, select L to print or view the List of patients, or
"RTN","BIDU1",44,0)
 ;;select P to Print Due Letters.
"RTN","BIDU1",45,0)
 ;;
"RTN","BIDU1",46,0)
 ;;In building this list to view or print, the computer must examine
"RTN","BIDU1",47,0)
 ;;every patient in the Immunization Register.  For this reason, on
"RTN","BIDU1",48,0)
 ;;some computer systems it may take some time before the list appears.
"RTN","BIDU1",49,0)
 ;;
"RTN","BIDU1",50,0)
 ;;For the parameters: DATE OF FORECAST, AGE RANGE,  PATIENT GROUP,
"RTN","BIDU1",51,0)
 ;;ADDITIONAL INFORMATION, and ORDER OF LISTING detailed help will be
"RTN","BIDU1",52,0)
 ;;displayed when you select these items.
"RTN","BIDU1",53,0)
 ;;
"RTN","BIDU1",54,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIDU1",55,0)
 ;;whose Current Community (under Patient Registration) is one of the
"RTN","BIDU1",56,0)
 ;;selected Communities will be included in the Lists and Letters.
"RTN","BIDU1",57,0)
 ;;
"RTN","BIDU1",58,0)
 ;;CASE MANAGERS: If you select for specific Case Managers, only
"RTN","BIDU1",59,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIDU1",60,0)
 ;;in the Lists and Letters.
"RTN","BIDU1",61,0)
 ;;
"RTN","BIDU1",62,0)
 ;;DESIGNATED PROVIDERS: If you select for specific Designated Primary
"RTN","BIDU1",63,0)
 ;;Providers, only patients who have the selected Providers will be
"RTN","BIDU1",64,0)
 ;;included in the Lists and Letters.
"RTN","BIDU1",65,0)
 ;;
"RTN","BIDU1",66,0)
 ;;IMMUNIZATIONS RECEIVED: If you select for specific Immunizations
"RTN","BIDU1",67,0)
 ;;Received, then only patients who have received the Vaccines selected
"RTN","BIDU1",68,0)
 ;;will be included in the Lists and Letters.  If you further limit your
"RTN","BIDU1",69,0)
 ;;criteria to a date range, then only patients who have received the
"RTN","BIDU1",70,0)
 ;;the selected vaccines within the date range will be included.  You can
"RTN","BIDU1",71,0)
 ;;then choose to display only the history of the vaccines you selected.
"RTN","BIDU1",72,0)
 ;;
"RTN","BIDU1",73,0)
 ;;NOTE: If you select for ALL vaccines and do NOT limit it by date
"RTN","BIDU1",74,0)
 ;;range, then this criterium "Immunizations Received" will have
"RTN","BIDU1",75,0)
 ;;NO limiting effect.  This feature allows you to create lists that
"RTN","BIDU1",76,0)
 ;;include patients who have never received an immunization at your
"RTN","BIDU1",77,0)
 ;;site--for example, a Due List that includes newcomers.
"RTN","BIDU1",78,0)
 ;;
"RTN","BIDU1",79,0)
 ;;IMMUNIZATIONS DUE: If you select for specific Immunizations Due,
"RTN","BIDU1",80,0)
 ;;then only patients who are due for the Vaccines selected will be
"RTN","BIDU1",81,0)
 ;;included in the Lists and Letters.
"RTN","BIDU1",82,0)
 ;;
"RTN","BIDU1",83,0)
 ;;NOTE: This parameter is only used to limit a list to patients who
"RTN","BIDU1",84,0)
 ;;are due for specific vaccines.  If you simply leave the parameter
"RTN","BIDU1",85,0)
 ;;as "ALL" it will have no limiting effect on the Patient Group chosen
"RTN","BIDU1",86,0)
 ;;in parameter 3 of the Lists & Letters Menu.
"RTN","BIDU1",87,0)
 ;;
"RTN","BIDU1",88,0)
 ;;LOT NUMBERS: If you select for specific Lot Numbers, only patients
"RTN","BIDU1",89,0)
 ;;who have received immunizations with the specified Lot Numbers will
"RTN","BIDU1",90,0)
 ;;be included in the Lists and Letters.
"RTN","BIDU1",91,0)
 ;;
"RTN","BIDU1",92,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Facility, only
"RTN","BIDU1",93,0)
 ;;patients who have a Health Record Number at one of the selected
"RTN","BIDU1",94,0)
 ;;Health Care Facilities will be included in the Lists and Letters.
"RTN","BIDU1",95,0)
 ;;
"RTN","BIDU1",96,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIDU1",97,0)
 Q
"RTN","BIDU1",98,0)
 ;
"RTN","BIDU1",99,0)
 ;
"RTN","BIDU1",100,0)
 ;----------
"RTN","BIDU1",101,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIDU1",102,0)
 Q:$G(BILINL)=""
"RTN","BIDU1",103,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIDU1",104,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIDU1",105,0)
 Q
"RTN","BIDUPLT")
0^13^B15075912
"RTN","BIDUPLT",1,0)
BIDUPLT ;IHS/CMI/MWR - BI PRINT LETTERS.; MAY 10, 2010
"RTN","BIDUPLT",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUPLT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUPLT",4,0)
 ;;  PRINT PATIENT LETTERS.
"RTN","BIDUPLT",5,0)
 ;
"RTN","BIDUPLT",6,0)
 ;
"RTN","BIDUPLT",7,0)
 ;----------
"RTN","BIDUPLT",8,0)
PRINTDUE ;EP
"RTN","BIDUPLT",9,0)
 ;---> Print Immunization Due letters.
"RTN","BIDUPLT",10,0)
 ;---> Called by Protocol BI DUE LETTERS PRINT.
"RTN","BIDUPLT",11,0)
 ;---> Variables:
"RTN","BIDUPLT",12,0)
 ;     1 - BIAG   (req) Age Range in months.
"RTN","BIDUPLT",13,0)
 ;     2 - BIPG   (req) 0=Due, >0=Number of months Past Due.
"RTN","BIDUPLT",14,0)
 ;     3 - BICC   (req) Current Community array.
"RTN","BIDUPLT",15,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIDUPLT",16,0)
 ;     5 - BIDPRV (req) Designated Provider array.
"RTN","BIDUPLT",17,0)
 ;     6 - BIFDT  (req) Forecast date.
"RTN","BIDUPLT",18,0)
 ;     7 - BIMMD  (req) Immunization Due array.
"RTN","BIDUPLT",19,0)
 ;     8 - BIHCF  (req) Health Care Facility array.
"RTN","BIDUPLT",20,0)
 ;     9 - BILOT  (req) Lot Number array.
"RTN","BIDUPLT",21,0)
 ;    10 - BIORD  (req) Order of listing.
"RTN","BIDUPLT",22,0)
 ;    11 - BIRDT  (opt) Date Range for Received Imms (form BEGDATE:ENDDATE).
"RTN","BIDUPLT",23,0)
 ;    12 - BIBEN  (req) Beneficiary Type array: either BIBEN(1) or BIBEN("ALL").
"RTN","BIDUPLT",24,0)
 ;
"RTN","BIDUPLT",25,0)
 ;---> Check for required Variables.
"RTN","BIDUPLT",26,0)
 I '$D(BIAG) D ERROR(613) Q
"RTN","BIDUPLT",27,0)
 I '$D(BIPG) D ERROR(620) Q
"RTN","BIDUPLT",28,0)
 I '$D(BICC) D ERROR(614) Q
"RTN","BIDUPLT",29,0)
 I '$D(BICM)  D ERROR(615) Q
"RTN","BIDUPLT",30,0)
 I '$D(BIDPRV) D ERROR(680) Q
"RTN","BIDUPLT",31,0)
 I '$G(BIFDT) D ERROR(616) Q
"RTN","BIDUPLT",32,0)
 I '$D(BIMMD) D ERROR(638) Q
"RTN","BIDUPLT",33,0)
 I '$D(BIHCF) D ERROR(625) Q
"RTN","BIDUPLT",34,0)
 I '$D(BILOT) D ERROR(630) Q
"RTN","BIDUPLT",35,0)
 I '$G(BIORD) D ERROR(618) Q
"RTN","BIDUPLT",36,0)
 I '$D(BIBEN) S BIBEN(1)=""
"RTN","BIDUPLT",37,0)
 ;
"RTN","BIDUPLT",38,0)
 S BIPOP=0
"RTN","BIDUPLT",39,0)
 ;
"RTN","BIDUPLT",40,0)
 ;---> Select Form Letter.
"RTN","BIDUPLT",41,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT FORM LETTER")
"RTN","BIDUPLT",42,0)
 D DEFLET(.BIDFLT,DUZ(2))
"RTN","BIDUPLT",43,0)
 D ASKLET^BILETPR(.BILET,.BIDLOC,.BIPOP,BIDFLT)
"RTN","BIDUPLT",44,0)
 I BIPOP D RESET^BIDU Q
"RTN","BIDUPLT",45,0)
 ;
"RTN","BIDUPLT",46,0)
 ;---> Specify Minimum Interval days since last letter.
"RTN","BIDUPLT",47,0)
 D MINDAYS^BIOUTPT3(.BIMD,.BIPOP)
"RTN","BIDUPLT",48,0)
 I BIPOP D RESET^BIDU Q
"RTN","BIDUPLT",49,0)
 ;
"RTN","BIDUPLT",50,0)
 D DEVICE
"RTN","BIDUPLT",51,0)
 I BIPOP D RESET^BIDU Q
"RTN","BIDUPLT",52,0)
 ;
"RTN","BIDUPLT",53,0)
 ;
"RTN","BIDUPLT",54,0)
 ;---> Retrieve patients for this batch of letters.
"RTN","BIDUPLT",55,0)
 D RETRIEVE(.BIT,.BIERR)
"RTN","BIDUPLT",56,0)
 I $G(BIERR) D ERROR(BIERR),EXIT,RESET^BIDU Q
"RTN","BIDUPLT",57,0)
 ;
"RTN","BIDUPLT",58,0)
 ;---> Print letters for patients retrieved.
"RTN","BIDUPLT",59,0)
 D PRINT^BIDUPLT1(BILET,$G(BIDLOC),ION,BIFDT)
"RTN","BIDUPLT",60,0)
 D ^%ZISC
"RTN","BIDUPLT",61,0)
 D EXIT,RESET^BIDU
"RTN","BIDUPLT",62,0)
 Q
"RTN","BIDUPLT",63,0)
 ;
"RTN","BIDUPLT",64,0)
 ;
"RTN","BIDUPLT",65,0)
 ;----------
"RTN","BIDUPLT",66,0)
RETRIEVE(BIT,BIERR) ;EP
"RTN","BIDUPLT",67,0)
 ;---> Retrieve patients according to parameters set.
"RTN","BIDUPLT",68,0)
 ;---> Parameters:
"RTN","BIDUPLT",69,0)
 ;     1 - BIT   (ret) Total Patients retrieved.
"RTN","BIDUPLT",70,0)
 ;     2 - BIERR (ret) If error, return Error#.
"RTN","BIDUPLT",71,0)
 ;
"RTN","BIDUPLT",72,0)
 ;  vvv83
"RTN","BIDUPLT",73,0)
 D R^BIDUR(BIAG,BIPG,BIFDT,.BICC,.BICM,.BIMMR,.BIMMD,.BILOT,BIMD,BIORD,$G(BIRDT),,.BIT,.BIHCF,.BIDPRV,.BIERR,.BIBEN)
"RTN","BIDUPLT",74,0)
 Q
"RTN","BIDUPLT",75,0)
 ;
"RTN","BIDUPLT",76,0)
 ;
"RTN","BIDUPLT",77,0)
 ;----------
"RTN","BIDUPLT",78,0)
DEVICE ;EP
"RTN","BIDUPLT",79,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIDUPLT",80,0)
 D FULL^VALM1
"RTN","BIDUPLT",81,0)
 K %ZIS,IOP
"RTN","BIDUPLT",82,0)
 S ZTRTN="DEQUEUE^BIDUPLT"
"RTN","BIDUPLT",83,0)
 D ZSAVES^BIUTL3
"RTN","BIDUPLT",84,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIDUPLT",85,0)
 Q
"RTN","BIDUPLT",86,0)
 ;
"RTN","BIDUPLT",87,0)
 ;
"RTN","BIDUPLT",88,0)
 ;----------
"RTN","BIDUPLT",89,0)
DEQUEUE ;EP
"RTN","BIDUPLT",90,0)
 ;---> Retrieve patients for this batch of letters.
"RTN","BIDUPLT",91,0)
 D RETRIEVE(.BIT,.BIPOP)
"RTN","BIDUPLT",92,0)
 I BIPOP D EXIT Q
"RTN","BIDUPLT",93,0)
 ;
"RTN","BIDUPLT",94,0)
 ;---> Print letters for patients retrieved.
"RTN","BIDUPLT",95,0)
 D PRINT^BIDUPLT1(BILET,$G(BIDLOC),ION,BIFDT)
"RTN","BIDUPLT",96,0)
 D ^%ZISC
"RTN","BIDUPLT",97,0)
 D EXIT,KILLALL^BIUTL8(1)
"RTN","BIDUPLT",98,0)
 Q
"RTN","BIDUPLT",99,0)
 ;
"RTN","BIDUPLT",100,0)
 ;
"RTN","BIDUPLT",101,0)
 ;----------
"RTN","BIDUPLT",102,0)
DEFLET(BILET,BISITE) ;EP
"RTN","BIDUPLT",103,0)
 ;---> Retrieve Immunizations Due Letter from Site Parameter file
"RTN","BIDUPLT",104,0)
 ;---> as the default letter for Immunizations Due.
"RTN","BIDUPLT",105,0)
 ;---> Parameters:
"RTN","BIDUPLT",106,0)
 ;     1 - BILET  (ret) IEN of Imms Due Letter in BI LETTER File.
"RTN","BIDUPLT",107,0)
 ;     2 - BISITE (req) Site under which user is logged in.
"RTN","BIDUPLT",108,0)
 ;
"RTN","BIDUPLT",109,0)
 S BILET=""
"RTN","BIDUPLT",110,0)
 I '$D(^BISITE(BISITE,0)) D ERRCD^BIUTL2(103,,1) Q
"RTN","BIDUPLT",111,0)
 S BILET=$$DEFLET^BIUTL2(BISITE)
"RTN","BIDUPLT",112,0)
 I 'BILET D  Q
"RTN","BIDUPLT",113,0)
 .D TEXT1 W !?22,$$INSTTX^BIUTL6(BISITE)
"RTN","BIDUPLT",114,0)
 .D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIDUPLT",115,0)
 .W !?5,"Returning to Print Due Letters...",!
"RTN","BIDUPLT",116,0)
 I '$D(^BILET(BILET,0)) D ERRCD^BIUTL2(108,,1) S BILET="" Q
"RTN","BIDUPLT",117,0)
 Q
"RTN","BIDUPLT",118,0)
 ;
"RTN","BIDUPLT",119,0)
 ;
"RTN","BIDUPLT",120,0)
 ;----------
"RTN","BIDUPLT",121,0)
TEXT1 ;EP
"RTN","BIDUPLT",122,0)
 ;;An Immunizations Due default letter has not been chosen for this
"RTN","BIDUPLT",123,0)
 ;;site.  If you wish to have a default letter appear at this prompt,
"RTN","BIDUPLT",124,0)
 ;;you must use the "Edit Site Parameters" option under the "Manager
"RTN","BIDUPLT",125,0)
 ;;Menu" and select an "IMMUNIZATION DUE LETTER" in the Site Parameters
"RTN","BIDUPLT",126,0)
 ;;for this site:
"RTN","BIDUPLT",127,0)
 D PRINTX("TEXT1",5)
"RTN","BIDUPLT",128,0)
 Q
"RTN","BIDUPLT",129,0)
 ;
"RTN","BIDUPLT",130,0)
 ;
"RTN","BIDUPLT",131,0)
 ;----------
"RTN","BIDUPLT",132,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIDUPLT",133,0)
 Q:$G(BILINL)=""
"RTN","BIDUPLT",134,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIDUPLT",135,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIDUPLT",136,0)
 Q
"RTN","BIDUPLT",137,0)
 ;
"RTN","BIDUPLT",138,0)
 ;
"RTN","BIDUPLT",139,0)
 ;----------
"RTN","BIDUPLT",140,0)
ERROR(BIERR) ;EP
"RTN","BIDUPLT",141,0)
 ;---> Report error, reset Listman screen and quit.
"RTN","BIDUPLT",142,0)
 ;---> Parameters:
"RTN","BIDUPLT",143,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIDUPLT",144,0)
 ;
"RTN","BIDUPLT",145,0)
 S:'$G(BIERR) BIERR=999
"RTN","BIDUPLT",146,0)
 D ERRCD^BIUTL2(BIERR,,1) D RESET^BIDU Q
"RTN","BIDUPLT",147,0)
 Q
"RTN","BIDUPLT",148,0)
 ;
"RTN","BIDUPLT",149,0)
 ;
"RTN","BIDUPLT",150,0)
 ;----------
"RTN","BIDUPLT",151,0)
EXIT ;EP
"RTN","BIDUPLT",152,0)
 ;---> Cleanup and Quit.
"RTN","BIDUPLT",153,0)
 K ^TMP("BIDUL",$J)
"RTN","BIDUPLT",154,0)
 Q
"RTN","BIDUPLT1")
0^14^B4111973
"RTN","BIDUPLT1",1,0)
BIDUPLT1 ;IHS/CMI/MWR - BI PRINT LETTERS.; MAY 10, 2010
"RTN","BIDUPLT1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUPLT1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUPLT1",4,0)
 ;;  PRINT LETTERS FROM ^TMP LIST OF PATIENTS.
"RTN","BIDUPLT1",5,0)
 ;
"RTN","BIDUPLT1",6,0)
 ;
"RTN","BIDUPLT1",7,0)
 ;----------
"RTN","BIDUPLT1",8,0)
PRINT(BILET,BIDLOC,BIIOP,BIFDT) ;EP
"RTN","BIDUPLT1",9,0)
 ;---> Print Due Letters for patients stored in ^TMP("BIDUL".
"RTN","BIDUPLT1",10,0)
 ;---> Called by PRINTALL above; error checking done above.
"RTN","BIDUPLT1",11,0)
 ;---> Parameters:
"RTN","BIDUPLT1",12,0)
 ;     1 - BILET  (req) Due Letter IEN.
"RTN","BIDUPLT1",13,0)
 ;     2 - BIDLOC (req) Date-Location Line of letter.
"RTN","BIDUPLT1",14,0)
 ;     3 - BIIOP  (req) Output Device Name (Should be equal to ION.)
"RTN","BIDUPLT1",15,0)
 ;     4 - BIFDT  (req) Forecast date.
"RTN","BIDUPLT1",16,0)
 ;
"RTN","BIDUPLT1",17,0)
 D FULL^VALM1
"RTN","BIDUPLT1",18,0)
 I '$G(BILET) D ERROR(609) Q
"RTN","BIDUPLT1",19,0)
 I '$D(^BILET(BILET,0)) D ERROR(610) Q
"RTN","BIDUPLT1",20,0)
 S:'$D(BIIOP) BIIOP="HOME"
"RTN","BIDUPLT1",21,0)
 I '$G(BIFDT) D ERROR(616) Q
"RTN","BIDUPLT1",22,0)
 S BICRT=$S(($E(IOST)="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIDUPLT1",23,0)
 ;
"RTN","BIDUPLT1",24,0)
 ;---> Quit if no patients retrieved. (Next line was v8.0 patch 1.)
"RTN","BIDUPLT1",25,0)
 I $O(^TMP("BIDUL",$J,0))="" D  Q
"RTN","BIDUPLT1",26,0)
 .U IO
"RTN","BIDUPLT1",27,0)
 .W !!?3,"NOTE: Based on the criteria you selected, no Immunization Due"
"RTN","BIDUPLT1",28,0)
 .W !?9,"letters were printed."
"RTN","BIDUPLT1",29,0)
 .D:BICRT DIRZ^BIUTL3() W:'BICRT @IOF
"RTN","BIDUPLT1",30,0)
 ;
"RTN","BIDUPLT1",31,0)
 ;---> Loop through ^TMP("BIDUL",$J,...,BIDFN) printing Due Letters.
"RTN","BIDUPLT1",32,0)
 N BIDFN,BILCNT,BIPOP,N,M,P
"RTN","BIDUPLT1",33,0)
 S BILCNT=0,BIPOP=0
"RTN","BIDUPLT1",34,0)
 ;
"RTN","BIDUPLT1",35,0)
 S N=0
"RTN","BIDUPLT1",36,0)
 F  S N=$O(^TMP("BIDUL",$J,N)) Q:N=""  D  Q:BIPOP
"RTN","BIDUPLT1",37,0)
 .S M=0
"RTN","BIDUPLT1",38,0)
 .F  S M=$O(^TMP("BIDUL",$J,N,M)) Q:M=""  D  Q:BIPOP
"RTN","BIDUPLT1",39,0)
 ..S P=0
"RTN","BIDUPLT1",40,0)
 ..F  S P=$O(^TMP("BIDUL",$J,N,M,P)) Q:P=""  D  Q:BIPOP
"RTN","BIDUPLT1",41,0)
 ...S BIDFN=0
"RTN","BIDUPLT1",42,0)
 ...F  S BIDFN=$O(^TMP("BIDUL",$J,N,M,P,BIDFN)) Q:'BIDFN  D  Q:BIPOP
"RTN","BIDUPLT1",43,0)
 ....N N,M,P
"RTN","BIDUPLT1",44,0)
 ....S IOP=BIIOP D ^%ZIS
"RTN","BIDUPLT1",45,0)
 ....D PRINT^BILETPR(BIDFN,BILET,BIDLOC,BIIOP,BIFDT,.BIPOP)
"RTN","BIDUPLT1",46,0)
 ....S BILCNT=BILCNT+1
"RTN","BIDUPLT1",47,0)
 ;
"RTN","BIDUPLT1",48,0)
 S IOP=BIIOP D ^%ZIS
"RTN","BIDUPLT1",49,0)
 U IO
"RTN","BIDUPLT1",50,0)
 W !!?10,"Immunization Due Letters printed: ",BILCNT
"RTN","BIDUPLT1",51,0)
 W !?10,$$NOW^BIUTL5()
"RTN","BIDUPLT1",52,0)
 D:BICRT DIRZ^BIUTL3() W:'BICRT @IOF
"RTN","BIDUPLT1",53,0)
 D ^%ZISC
"RTN","BIDUPLT1",54,0)
 Q
"RTN","BIDUPLT1",55,0)
 ;
"RTN","BIDUPLT1",56,0)
 ;
"RTN","BIDUPLT1",57,0)
 ;----------
"RTN","BIDUPLT1",58,0)
ERROR(BIERR) ;EP
"RTN","BIDUPLT1",59,0)
 ;---> Report error, either to screen or print.
"RTN","BIDUPLT1",60,0)
 ;---> Parameters:
"RTN","BIDUPLT1",61,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIDUPLT1",62,0)
 ;
"RTN","BIDUPLT1",63,0)
 S:'$G(BIERR) BIERR=999
"RTN","BIDUPLT1",64,0)
 D ERRCD^BIUTL2(BIERR,,1)
"RTN","BIDUPLT1",65,0)
 S BIPOP=1
"RTN","BIDUPLT1",66,0)
 Q
"RTN","BIDUR")
0^15^B59351036
"RTN","BIDUR",1,0)
BIDUR ;IHS/CMI/MWR - RETRIEVE PATIENTS.; MAY 10, 2010
"RTN","BIDUR",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUR",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUR",4,0)
 ;;  RETRIEVE PATIENTS FOR DUE LISTS & LETTERS.
"RTN","BIDUR",5,0)
 ;
"RTN","BIDUR",6,0)
 ;
"RTN","BIDUR",7,0)
 ;----------
"RTN","BIDUR",8,0)
R(BIAG,BIPG,BIFDT,BICC,BICM,BIMMR,BIMMD,BILOT,BIMD,BIORD,BIRDT,BIDED,BIT,BIHCF,BIDPRV,BIERR,BIBEN) ;EP
"RTN","BIDUR",9,0)
 ;---> Retrieve patients according to specs.
"RTN","BIDUR",10,0)
 ;---> Parameters:
"RTN","BIDUR",11,0)
 ;     1 - BIAG   (req) Age Range in months or years.
"RTN","BIDUR",12,0)
 ;     2 - BIPG   (req) Patient Group Data; see PGRPOUP1^BIOUTPT4 for details.
"RTN","BIDUR",13,0)
 ;     3 - BIFDT  (req) Forecast date.
"RTN","BIDUR",14,0)
 ;     4 - BICC   (req) Current Community array.
"RTN","BIDUR",15,0)
 ;     5 - BICM   (req) Case Manager array.
"RTN","BIDUR",16,0)
 ;     6 - BIMMR  (req) Immunizations Received array.
"RTN","BIDUR",17,0)
 ;     7 - BIMMD  (req) Immunizations Due array.
"RTN","BIDUR",18,0)
 ;     8 - BILOT  (req) Lot Number array.
"RTN","BIDUR",19,0)
 ;     9 - BIMD   (req) Minimum Interval days since last letter.
"RTN","BIDUR",20,0)
 ;    10 - BIORD  (req) Order of listing.
"RTN","BIDUR",21,0)
 ;    11 - BIRDT  (opt) Date Range for Received Imms (form BEGDATE:ENDDATE).
"RTN","BIDUR",22,0)
 ;    12 - BIDED  (opt) Include Deceased Patients (0=no, 1=yes).
"RTN","BIDUR",23,0)
 ;    13 - BIT    (ret) BIT=Total number of patients stored.
"RTN","BIDUR",24,0)
 ;    14 - BIHCF  (req) Health Care Facility array.
"RTN","BIDUR",25,0)
 ;    15 - BIDPRV (req) Designated Provider array.
"RTN","BIDUR",26,0)
 ;    16 - BIERR  (ret) Error Code.
"RTN","BIDUR",27,0)
 ;    17 - BIBEN  (req) Beneficiary Type array: either BIBEN(1) or BIBEN("ALL").
"RTN","BIDUR",28,0)
 ;
"RTN","BIDUR",29,0)
 ;     Removed for v8.1: 8 - BIHCF (req) Health Care Facility array.
"RTN","BIDUR",30,0)
 ;
"RTN","BIDUR",31,0)
 S BIT=0
"RTN","BIDUR",32,0)
 K ^TMP("BIDUL",$J)
"RTN","BIDUR",33,0)
 ;---> Reset last record edited index so ^BIPDUE global subscript
"RTN","BIDUR",34,0)
 ;---> doesn't grow too large with each run of the report.
"RTN","BIDUR",35,0)
 S $P(^BIPDUE(0),U,3)=0
"RTN","BIDUR",36,0)
 ;
"RTN","BIDUR",37,0)
 ;---> Check for required Variables.
"RTN","BIDUR",38,0)
 I '$D(BIAG) S BIERR=613 Q
"RTN","BIDUR",39,0)
 I '$D(BIPG) S BIERR=620 Q
"RTN","BIDUR",40,0)
 I '$G(BIFDT) S BIERR=616 Q
"RTN","BIDUR",41,0)
 I '$D(BICC) S BIERR=614 Q
"RTN","BIDUR",42,0)
 I '$D(BICM) S BIERR=615 Q
"RTN","BIDUR",43,0)
 I '$D(BIDPRV) S BIERR=680 Q
"RTN","BIDUR",44,0)
 I '$D(BIMMR) S BIERR=652 Q
"RTN","BIDUR",45,0)
 I '$D(BIMMD) S BIERR=638 Q
"RTN","BIDUR",46,0)
 I '$D(BIHCF) S BIERR=625 Q
"RTN","BIDUR",47,0)
 I '$D(BILOT) S BIERR=630 Q
"RTN","BIDUR",48,0)
 I '$D(BIMD) S BIERR=617 Q
"RTN","BIDUR",49,0)
 I '$G(BIORD) S BIERR=618 Q
"RTN","BIDUR",50,0)
 I '$D(BIBEN) S BIERR=662 Q
"RTN","BIDUR",51,0)
 ;
"RTN","BIDUR",52,0)
 ;---> Parse out BIPG.  vvv83
"RTN","BIDUR",53,0)
 N I F I=1,2,4,5,7,8 N @("BIPG"_I) S @("BIPG"_I)=$P(BIPG,U,I)
"RTN","BIDUR",54,0)
 ;
"RTN","BIDUR",55,0)
 ;---> If Patient Group is a Search Template, go store it and quit.
"RTN","BIDUR",56,0)
 I $P(BIPG1,U)=8 D SEARCH(BIPG8,.BIT,.BIERR) Q
"RTN","BIDUR",57,0)
 ;
"RTN","BIDUR",58,0)
 ;
"RTN","BIDUR",59,0)
 ;---> If list is for DUE, or PAST DUE, or Due for a specific vaccine,
"RTN","BIDUR",60,0)
 ;---> or will display forecast in Additional Info, and
"RTN","BIDUR",61,0)
 ;---> if forecasting has been disabled, do ERROR and quit.
"RTN","BIDUR",62,0)
 I ((BIPG1[1!(BIPG1[2))!($O(BIMMD(0)))!($D(BINFO(13)))),'$$FORECAS^BIUTL2(DUZ(2)) D  Q
"RTN","BIDUR",63,0)
 .S BIERR=314 Q
"RTN","BIDUR",64,0)
 ;
"RTN","BIDUR",65,0)
 ;---> Calculate the date before which Immunizations Past Due
"RTN","BIDUR",66,0)
 ;---> will be included.  BIPG1=Past Due Date cutoff, Fileman format.
"RTN","BIDUR",67,0)
 D:(BIPG1[2&(BIPG2))
"RTN","BIDUR",68,0)
 .N X,X1,X2 S X1=BIFDT,X2=-(BIPG2*30)
"RTN","BIDUR",69,0)
 .D C^%DTC S BIPG2=X
"RTN","BIDUR",70,0)
 ;
"RTN","BIDUR",71,0)
 N BIAGDB,BIAGDE S (BIAGDB,BIAGDE)=""
"RTN","BIDUR",72,0)
 D AGEDATE^BIAGE(BIAG,BIFDT,.BIAGDB,.BIAGDE)
"RTN","BIDUR",73,0)
 I (BIAGDB<0)!('BIAGDE)!(BIAGDB>BIAGDE) S BIERR=676 Q
"RTN","BIDUR",74,0)
 ;
"RTN","BIDUR",75,0)
 ;---> Search the BI PATIENT File, ^BIP( for patients who fit the criteria.
"RTN","BIDUR",76,0)
 N BIDFN S BIDFN=0
"RTN","BIDUR",77,0)
 F  S BIDFN=$O(^BIP(BIDFN)) Q:'BIDFN  D
"RTN","BIDUR",78,0)
 .D CHKSET(BIDFN,BIPG1,BIPG2,BIPG4,BIPG5,.BIT)
"RTN","BIDUR",79,0)
 Q
"RTN","BIDUR",80,0)
 ;
"RTN","BIDUR",81,0)
 ;
"RTN","BIDUR",82,0)
 ;----------
"RTN","BIDUR",83,0)
CHKSET(BIDFN,BIPG1,BIPG2,BIPG4,BIPG5,BIT) ;EP
"RTN","BIDUR",84,0)
 ;---> Check if this patient fits criteria; if so, set DFN
"RTN","BIDUR",85,0)
 ;---> in ^TMP("BIDUL".
"RTN","BIDUR",86,0)
 ;---> Parameters:
"RTN","BIDUR",87,0)
 ;     1 - BIDFN  (req) Patient DFN.
"RTN","BIDUR",88,0)
 ;     2 - BIPG1  (req) Patient Group Number.
"RTN","BIDUR",89,0)
 ;     3 - BIPG2  (opt) If BIPG1=2, then BIPG2=Past Due Date cutoff.
"RTN","BIDUR",90,0)
 ;     4 - BIPG4  (opt) If BIPG1=4, then BIPG4=Inactive Date Range.
"RTN","BIDUR",91,0)
 ;     5 - BIPG5  (opt) If BIPG1=5, then BIPG5=Auto-Activated Date Range.
"RTN","BIDUR",92,0)
 ;     6 - BIT    (ret) BIT=Total patients stored.
"RTN","BIDUR",93,0)
 ;     NOTE: Other arrays not passed due to length of parameter list.
"RTN","BIDUR",94,0)
 ;
"RTN","BIDUR",95,0)
 S BIPOP=0 S:'$D(BIT) BIT=0
"RTN","BIDUR",96,0)
 ;
"RTN","BIDUR",97,0)
 ;---> If NOT including Deceased, quit if patient is deceased.
"RTN","BIDUR",98,0)
 I '$G(BIDED) Q:$$DECEASED^BIUTL1(BIDFN)
"RTN","BIDUR",99,0)
 ;
"RTN","BIDUR",100,0)
 ;---> Quit if Femles Only and this patient is male.
"RTN","BIDUR",101,0)
 Q:((BIPG1[7)&($$SEX^BIUTL1(BIDFN)'="F"))
"RTN","BIDUR",102,0)
 ;
"RTN","BIDUR",103,0)
 ;---> Check if Patient fits withing Age Range.
"RTN","BIDUR",104,0)
 N X S X=$$DOB^BIUTL1(BIDFN)
"RTN","BIDUR",105,0)
 Q:(('X)!(X<BIAGDB)!(X>BIAGDE))
"RTN","BIDUR",106,0)
 ;
"RTN","BIDUR",107,0)
 ;---> Quit if patient does not have an Active HRCN at one or more
"RTN","BIDUR",108,0)
 ;---> of the Health Care Facilities selected.  Reactivated  vvv83
"RTN","BIDUR",109,0)
 Q:$$HRCN^BIEXPRT2(BIDFN,.BIHCF)
"RTN","BIDUR",110,0)
 ;
"RTN","BIDUR",111,0)
 ;---> Set local variable for ACTIVE (BIINACT=""), INACTIVE (BIINACT>0).
"RTN","BIDUR",112,0)
 N BIINACT S BIINACT=$$INACT^BIUTL1(BIDFN)
"RTN","BIDUR",113,0)
 ;
"RTN","BIDUR",114,0)
 ;---> Quit if looking ONLY for INACTIVE and this patient is ACTIVE.
"RTN","BIDUR",115,0)
 I (BIPG1[4)&(BIPG1'[3) Q:'BIINACT
"RTN","BIDUR",116,0)
 ;
"RTN","BIDUR",117,0)
 ;---> Quit if looking ONLY for INACTIVE, and a Date Made Inactive was
"RTN","BIDUR",118,0)
 ;---> specified, and the patient's Date falls outside of the range.
"RTN","BIDUR",119,0)
 I (BIPG1[4)&(BIPG1'[3),BIPG4 Q:((BIINACT<$P(BIPG4,":"))!(BIINACT>$P(BIPG4,":",2)))
"RTN","BIDUR",120,0)
 ;
"RTN","BIDUR",121,0)
 ;---> Quit if looking ONLY for ACTIVE and this patient is INACTIVE.
"RTN","BIDUR",122,0)
 I (BIPG1[3)&(BIPG1'[4) Q:BIINACT
"RTN","BIDUR",123,0)
 ;
"RTN","BIDUR",124,0)
 ;---> Quit if looking ONLY for DUE or PAST DUE, which assumes ACTIVE,
"RTN","BIDUR",125,0)
 ;---> and Inactive is not included, and this patient is Inactive.
"RTN","BIDUR",126,0)
 I ((BIPG1[1)!(BIPG1[2))&(BIPG1'[4) Q:BIINACT
"RTN","BIDUR",127,0)
 ;
"RTN","BIDUR",128,0)
 ;---> Quit if looking for AUTOMATICALLY ACTIVATED and Patient was not,
"RTN","BIDUR",129,0)
 ;---> or not Auto Activated within the selected date range.
"RTN","BIDUR",130,0)
 I BIPG1[5 N BIAUTO S BIAUTO=0 D  Q:'BIAUTO
"RTN","BIDUR",131,0)
 .Q:('$$ENTERED^BIUTL1(BIDFN,1))
"RTN","BIDUR",132,0)
 .N X S X=$$ENTERED^BIUTL1(BIDFN)
"RTN","BIDUR",133,0)
 .Q:((X<$P(BIPG5,":"))!(X>$P(BIPG5,":",2)))
"RTN","BIDUR",134,0)
 .S BIAUTO=1
"RTN","BIDUR",135,0)
 ;
"RTN","BIDUR",136,0)
 ;---> Quit if looking for Patients who had Refusals and there are none.
"RTN","BIDUR",137,0)
 I BIPG1[6 N A D CONTRA^BIUTL11(BIDFN,.A,1) Q:'$O(A(0))
"RTN","BIDUR",138,0)
 ;
"RTN","BIDUR",139,0)
 ;---> Quit if Current Community isn't one of those selected.
"RTN","BIDUR",140,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIDUR",141,0)
 ;
"RTN","BIDUR",142,0)
 ;---> Quit if Case Manager isn't one of those selected.
"RTN","BIDUR",143,0)
 Q:$$CMGR(BIDFN,.BICM)
"RTN","BIDUR",144,0)
 ;
"RTN","BIDUR",145,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIDUR",146,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIDUR",147,0)
 ;
"RTN","BIDUR",148,0)
 ;---> Quit if Designated Provider isn't one of those selected.
"RTN","BIDUR",149,0)
 Q:$$DPRV(BIDFN,.BIDPRV)
"RTN","BIDUR",150,0)
 ;
"RTN","BIDUR",151,0)
 ;---> Quit if Patient never received any of the Vaccines selected.
"RTN","BIDUR",152,0)
 Q:$$IMMR(BIDFN,.BIMMR,$G(BIRDT))
"RTN","BIDUR",153,0)
 ;
"RTN","BIDUR",154,0)
 ;---> Quit if Patient never received any of the Lot#s selected.
"RTN","BIDUR",155,0)
 Q:$$LOT(BIDFN,.BILOT)
"RTN","BIDUR",156,0)
 ;
"RTN","BIDUR",157,0)
 ;---> Quit if Patient does not have a Chart# at any of
"RTN","BIDUR",158,0)
 ;---> the Health Care Facilities selected.  vvv83
"RTN","BIDUR",159,0)
 Q:$$HRCN^BIEXPRT2(BIDFN,.BIHCF)
"RTN","BIDUR",160,0)
 ;
"RTN","BIDUR",161,0)
 ;---> Quit if Minimum Interval (since last letter) not reached.
"RTN","BIDUR",162,0)
 N BIQUIT S BIQUIT=0
"RTN","BIDUR",163,0)
 I BIMD D  Q:BIQUIT
"RTN","BIDUR",164,0)
 .Q:BIPG1=5
"RTN","BIDUR",165,0)
 .N X,X1,X2
"RTN","BIDUR",166,0)
 .S X1=DT,X2=+$$LASTLET^BIUTL1(BIDFN)
"RTN","BIDUR",167,0)
 .I X2  D ^%DTC  S:X<BIMD BIQUIT=1
"RTN","BIDUR",168,0)
 ;
"RTN","BIDUR",169,0)
 ;---> If list is for DUE, or PAST DUE, or Due for a specific vaccine,
"RTN","BIDUR",170,0)
 ;---> or will display forecast in Additional Info, then update
"RTN","BIDUR",171,0)
 ;---> the patient's forecast.
"RTN","BIDUR",172,0)
 D:((BIPG1[1!(BIPG1[2))!($O(BIMMD(0)))!($D(BINFO(13))))
"RTN","BIDUR",173,0)
 .;---> 4th param=1: Don't retrieve Immserve Profile.
"RTN","BIDUR",174,0)
 .D UPDATE^BIPATUP(BIDFN,BIFDT,,1)
"RTN","BIDUR",175,0)
 ;
"RTN","BIDUR",176,0)
 ;---> Quit if Patient is not due for a matching Vaccine.
"RTN","BIDUR",177,0)
 Q:$$IMMD(BIDFN,.BIMMD)
"RTN","BIDUR",178,0)
 ;
"RTN","BIDUR",179,0)
 ;---> Quit if list is for DUE and this patient has no Imms
"RTN","BIDUR",180,0)
 ;---> due on this Forecast Date.
"RTN","BIDUR",181,0)
 I BIPG1[1 Q:'$D(^BIPDUE("B",BIDFN))
"RTN","BIDUR",182,0)
 ;
"RTN","BIDUR",183,0)
 ;---> Quit if list is for PAST DUE and this patient has
"RTN","BIDUR",184,0)
 ;---> no Immunizations past due as of the Forecast Date.
"RTN","BIDUR",185,0)
 I BIPG1[2 Q:'$D(^BIPDUE("E",BIDFN))
"RTN","BIDUR",186,0)
 ;
"RTN","BIDUR",187,0)
 ;---> Quit if this patient's earlist Immunization PAST DUE date
"RTN","BIDUR",188,0)
 ;---> is AFTER the Past Due Date.
"RTN","BIDUR",189,0)
 I BIPG1[2 Q:$O(^BIPDUE("E",BIDFN,0))>BIPG2
"RTN","BIDUR",190,0)
 ;
"RTN","BIDUR",191,0)
 ;---> Quit if Patient is not Past Due for a specific matching Vaccine.
"RTN","BIDUR",192,0)
 I BIPG1[2 Q:$$IMMPD(BIDFN,.BIMMD,BIPG2)
"RTN","BIDUR",193,0)
 ;
"RTN","BIDUR",194,0)
 ;---> OK, this patient is a keeper! Go store this patient
"RTN","BIDUR",195,0)
 ;---> in the Order specified, then update Patient Total.
"RTN","BIDUR",196,0)
 D STORE^BIDUR1(BIDFN,BIFDT,BIORD,.BIERR)
"RTN","BIDUR",197,0)
 Q:$G(BIERR)
"RTN","BIDUR",198,0)
 S BIT=$G(BIT)+1
"RTN","BIDUR",199,0)
 Q
"RTN","BIDUR",200,0)
 ;
"RTN","BIDUR",201,0)
 ;
"RTN","BIDUR",202,0)
 ;----------
"RTN","BIDUR",203,0)
SEARCH(BITIEN,BIT,BIERR) ;EP
"RTN","BIDUR",204,0)
 ;---> Gather patients from Patient Search Template.
"RTN","BIDUR",205,0)
 ;---> Parameters:
"RTN","BIDUR",206,0)
 ;     1 - BITIEN (req) Template IEN.
"RTN","BIDUR",207,0)
 ;     2 - BIT    (ret) Total patients stored.
"RTN","BIDUR",208,0)
 ;     3 - BIERR  (ret) Error Code.
"RTN","BIDUR",209,0)
 ;
"RTN","BIDUR",210,0)
 I '$G(BITIEN) S BIERR=653 Q
"RTN","BIDUR",211,0)
 I '$D(^DIBT(BITIEN,0)) S BIERR=654 Q
"RTN","BIDUR",212,0)
 I '$O(^DIBT(BITIEN,1,0)) S BIERR=655 Q
"RTN","BIDUR",213,0)
 ;
"RTN","BIDUR",214,0)
 ;********** PATCH 1, APR 4,2006, IHS/CMI/MWR
"RTN","BIDUR",215,0)
 ;---> Seed Age Range Dates (needed, but not relevant to Search Template).
"RTN","BIDUR",216,0)
 N BIAGDB,BIAGDE S BIAGDB=0,BIAGDE=9999999
"RTN","BIDUR",217,0)
 ;**********
"RTN","BIDUR",218,0)
 ;
"RTN","BIDUR",219,0)
 N BIDFN S BIDFN=0,BIPG="3,4,"
"RTN","BIDUR",220,0)
 F  S BIDFN=$O(^DIBT(BITIEN,1,BIDFN)) Q:'BIDFN  D
"RTN","BIDUR",221,0)
 .D CHKSET(BIDFN,BIPG,,,,.BIT)
"RTN","BIDUR",222,0)
 Q
"RTN","BIDUR",223,0)
 ;
"RTN","BIDUR",224,0)
 ;
"RTN","BIDUR",225,0)
 ;----------
"RTN","BIDUR",226,0)
CMGR(BIDFN,BICM) ;EP
"RTN","BIDUR",227,0)
 ;---> Case Manager indicator.
"RTN","BIDUR",228,0)
 ;---> Return 1 if not selecting all Case Managers and if this
"RTN","BIDUR",229,0)
 ;---> patient's Case Manager is not one of the ones selected.
"RTN","BIDUR",230,0)
 ;
"RTN","BIDUR",231,0)
 Q:'$G(BIDFN) 1
"RTN","BIDUR",232,0)
 Q:$D(BICM("ALL")) 0
"RTN","BIDUR",233,0)
 N BIMGR S BIMGR=$$CMGR^BIUTL1(BIDFN)
"RTN","BIDUR",234,0)
 Q:'BIMGR 1
"RTN","BIDUR",235,0)
 Q:'$D(BICM(BIMGR)) 1
"RTN","BIDUR",236,0)
 Q 0
"RTN","BIDUR",237,0)
 ;
"RTN","BIDUR",238,0)
 ;
"RTN","BIDUR",239,0)
 ;----------
"RTN","BIDUR",240,0)
DPRV(BIDFN,BIDPRV) ;EP
"RTN","BIDUR",241,0)
 ;---> Designated Provider indicator.
"RTN","BIDUR",242,0)
 ;---> Return 1 if not selecting all Designated Providers and if this
"RTN","BIDUR",243,0)
 ;---> patient's Designated Provider is not one of the ones selected.
"RTN","BIDUR",244,0)
 ;
"RTN","BIDUR",245,0)
 Q:'$G(BIDFN) 1
"RTN","BIDUR",246,0)
 Q:$D(BIDPRV("ALL")) 0
"RTN","BIDUR",247,0)
 N BIX S BIX=$$DPRV^BIUTL1(BIDFN)
"RTN","BIDUR",248,0)
 Q:'BIX 1
"RTN","BIDUR",249,0)
 Q:'$D(BIDPRV(BIX)) 1
"RTN","BIDUR",250,0)
 Q 0
"RTN","BIDUR",251,0)
 ;
"RTN","BIDUR",252,0)
 ;
"RTN","BIDUR",253,0)
 ;----------
"RTN","BIDUR",254,0)
IMMR(BIDFN,BIMMR,BIRDT) ;EP
"RTN","BIDUR",255,0)
 ;---> Imm Received indicator.
"RTN","BIDUR",256,0)
 ;---> Return 1 if not selecting all Immunizations Received and if
"RTN","BIDUR",257,0)
 ;---> this patient NEVER received any of the Vaccines selected.
"RTN","BIDUR",258,0)
 ;---> BIHIT=0 includes this patient; BIHIT=1 EXcludes this patient.
"RTN","BIDUR",259,0)
 ;
"RTN","BIDUR",260,0)
 Q:$G(BIDFN)="" 1
"RTN","BIDUR",261,0)
 ;---> If not restricting vaccines or visit dates, then consider this
"RTN","BIDUR",262,0)
 ;---> patient a hit--include in the list.
"RTN","BIDUR",263,0)
 S:'$G(BIRDT) BIRDT=""
"RTN","BIDUR",264,0)
 Q:(($D(BIMMR("ALL")))&('BIRDT)) 0
"RTN","BIDUR",265,0)
 ;
"RTN","BIDUR",266,0)
 ;---> For this Patient retrieve Imm Hx elements IEN vaccine and Fman date;
"RTN","BIDUR",267,0)
 ;---> example: ^I|127|3030821^
"RTN","BIDUR",268,0)
 N BIHX,BI31,BIDE S BI31=$C(31)_$C(31),BIDE(30)="",BIDE(56)=""
"RTN","BIDUR",269,0)
 D IMMHX^BIRPC(.BIHX,BIDFN,.BIDE,0) S BIHX=$P(BIHX,BI31)
"RTN","BIDUR",270,0)
 ;
"RTN","BIDUR",271,0)
 N I,BIIEN,BIDATE,BIHIT
"RTN","BIDUR",272,0)
 ;---> BIHIT=0 this will include the Patient in the list.
"RTN","BIDUR",273,0)
 ;---> So, change BIHIT=0 if a visit meets the criteria.
"RTN","BIDUR",274,0)
 S BIHIT=1
"RTN","BIDUR",275,0)
 F I=1:1:($L(BIHX,U)-1) D  Q:'BIHIT
"RTN","BIDUR",276,0)
 .S BIIEN=$P($P(BIHX,U,I),"|",2),BIDATE=$P($P(BIHX,U,I),"|",3)
"RTN","BIDUR",277,0)
 .;---> If no date restriction and there's a matching Imm, it's a hit (0).
"RTN","BIDUR",278,0)
 .I 'BIRDT,$D(BIMMR(+BIIEN)) S BIHIT=0 Q
"RTN","BIDUR",279,0)
 .;---> If there's a matching Imm, or if not restricting to specific vaccines,
"RTN","BIDUR",280,0)
 .;---> check that visit date is within range.
"RTN","BIDUR",281,0)
 .I $D(BIMMR(+BIIEN))!$D(BIMMR("ALL")) D
"RTN","BIDUR",282,0)
 ..I (BIDATE'<$P(BIRDT,":"))&(BIDATE'>$P(BIRDT,":",2)) S BIHIT=0 Q
"RTN","BIDUR",283,0)
 ;
"RTN","BIDUR",284,0)
 ;---> Quit, returning result.
"RTN","BIDUR",285,0)
 Q BIHIT
"RTN","BIDUR",286,0)
 ;
"RTN","BIDUR",287,0)
 ;
"RTN","BIDUR",288,0)
 ;----------
"RTN","BIDUR",289,0)
LOT(BIHX,BILOT) ;EP
"RTN","BIDUR",290,0)
 ;---> Lot# indicator.
"RTN","BIDUR",291,0)
 ;---> Return 1 if not selecting all Lot Numbers and if this
"RTN","BIDUR",292,0)
 ;---> patient NEVER received any of the Lot Numbers selected.
"RTN","BIDUR",293,0)
 ;
"RTN","BIDUR",294,0)
 Q:$D(BILOT("ALL")) 0
"RTN","BIDUR",295,0)
 Q:$G(BIDFN)="" 0
"RTN","BIDUR",296,0)
 ;
"RTN","BIDUR",297,0)
 N BIHX,BI31,BIDE S BI31=$C(31)_$C(31),BIDE(32)=""
"RTN","BIDUR",298,0)
 D IMMHX^BIRPC(.BIHX,BIDFN,.BIDE,0) S BIHX=$P(BIHX,BI31)
"RTN","BIDUR",299,0)
 ;
"RTN","BIDUR",300,0)
 N I,L S L=""
"RTN","BIDUR",301,0)
 F I=1:1:($L(BIHX,U)-1) S L=$P($P(BIHX,U,I),"|",2) Q:$D(BILOT(+L))
"RTN","BIDUR",302,0)
 Q:$D(BILOT(+L)) 0
"RTN","BIDUR",303,0)
 ;
"RTN","BIDUR",304,0)
 ;---> No match.
"RTN","BIDUR",305,0)
 Q 1
"RTN","BIDUR",306,0)
 ;
"RTN","BIDUR",307,0)
 ;
"RTN","BIDUR",308,0)
 ;----------
"RTN","BIDUR",309,0)
IMMD(BIDFN,BIMMD) ;EP
"RTN","BIDUR",310,0)
 ;---> Imm Due indicator.
"RTN","BIDUR",311,0)
 ;---> Return 1 if not selecting all Immunizations Due and if this
"RTN","BIDUR",312,0)
 ;---> patient is NOT DUE for any of the Vaccines selected.
"RTN","BIDUR",313,0)
 ;
"RTN","BIDUR",314,0)
 Q:'$G(BIDFN) 1
"RTN","BIDUR",315,0)
 Q:$D(BIMMD("ALL")) 0
"RTN","BIDUR",316,0)
 ;
"RTN","BIDUR",317,0)
 ;---> Look for an Imm Due for any of the selected Vaccines.
"RTN","BIDUR",318,0)
 N N,Z S N=0,Z=1
"RTN","BIDUR",319,0)
 F  S N=$O(^BIPDUE("B",BIDFN,N)) Q:'N  Q:'Z  D
"RTN","BIDUR",320,0)
 .S:$D(BIMMD(+$P($G(^BIPDUE(N,0)),U,2))) Z=0
"RTN","BIDUR",321,0)
 ;
"RTN","BIDUR",322,0)
 ;---> Z=1: No match.
"RTN","BIDUR",323,0)
 Q Z
"RTN","BIDUR",324,0)
 ;
"RTN","BIDUR",325,0)
 ;
"RTN","BIDUR",326,0)
 ;----------
"RTN","BIDUR",327,0)
IMMPD(BIDFN,BIMMD,BIPG2) ;EP
"RTN","BIDUR",328,0)
 ;---> Imm PAST Due indicator.
"RTN","BIDUR",329,0)
 ;---> Return 1 if not selecting all Immunizations Past Due and if this
"RTN","BIDUR",330,0)
 ;---> patient is NOT PAST DUE for any of the Vaccines selected.
"RTN","BIDUR",331,0)
 ;
"RTN","BIDUR",332,0)
 Q:'$G(BIDFN) 1
"RTN","BIDUR",333,0)
 Q:$D(BIMMD("ALL")) 0
"RTN","BIDUR",334,0)
 ;
"RTN","BIDUR",335,0)
 ;---> Look for an Imm PAST Due for any of the selected Vaccines.  ;Q:$O(^BIPDUE("E",BIDFN,0))>BIPG2
"RTN","BIDUR",336,0)
 N N,Z S N=0,Z=1
"RTN","BIDUR",337,0)
 F  S N=$O(^BIPDUE("E",BIDFN,N)) Q:'N  Q:'Z  D
"RTN","BIDUR",338,0)
 .Q:(N>BIPG2)
"RTN","BIDUR",339,0)
 .N M S M=0
"RTN","BIDUR",340,0)
 .F  S M=$O(^BIPDUE("E",BIDFN,N,M)) Q:'M  D
"RTN","BIDUR",341,0)
 ..S:$D(BIMMD(+$P($G(^BIPDUE(M,0)),U,2))) Z=0
"RTN","BIDUR",342,0)
 ;
"RTN","BIDUR",343,0)
 ;---> Z=1: No match.
"RTN","BIDUR",344,0)
 Q Z
"RTN","BIDUR",345,0)
 ;
"RTN","BIDUR",346,0)
 ;
"RTN","BIDUR",347,0)
 ;----------
"RTN","BIDUR",348,0)
DPTAGE(BIT) ;EP
"RTN","BIDUR",349,0)
 ;*** NOT USED! ***  JUST FOR REFERENCE.
"RTN","BIDUR",350,0)
 ;
"RTN","BIDUR",351,0)
 ;---> Using an Age Range, search by VA PATIENT File, ^DPT(,
"RTN","BIDUR",352,0)
 ;---> using DOB xref.
"RTN","BIDUR",353,0)
 ;---> Parameters:
"RTN","BIDUR",354,0)
 ;     1 - BIT (ret) BIT=Total patients stored.
"RTN","BIDUR",355,0)
 ;
"RTN","BIDUR",356,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIDUR",357,0)
 N BIDFN,BIBEGDT,BIENDDT,N
"RTN","BIDUR",358,0)
 D AGEDATE^BIAGE(BIAG,BIFDT,.BIBEGDT,.BIENDDT)
"RTN","BIDUR",359,0)
 ;
"RTN","BIDUR",360,0)
 ;---> Start 1 day prior to Begin Date and $O into the desired DOB's.
"RTN","BIDUR",361,0)
 S N=BIBEGDT-1
"RTN","BIDUR",362,0)
 F  S N=$O(^DPT("ADOB",N)) Q:(N>BIENDDT!('N))  D
"RTN","BIDUR",363,0)
 .S BIDFN=0
"RTN","BIDUR",364,0)
 .F  S BIDFN=$O(^DPT("ADOB",N,BIDFN)) Q:'BIDFN  D
"RTN","BIDUR",365,0)
 ..D CHKSET(BIDFN,.BIT)
"RTN","BIDUR",366,0)
 Q
"RTN","BIDUR1")
0^16^B8838436
"RTN","BIDUR1",1,0)
BIDUR1 ;IHS/CMI/MWR - RETRIEVE/STORE PATIENTS.; MAY 10, 2010
"RTN","BIDUR1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUR1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUR1",4,0)
 ;;  RETRIEVE/STORE PATIENTS FOR DUE LISTS & LETTERS.
"RTN","BIDUR1",5,0)
 ;
"RTN","BIDUR1",6,0)
 ;
"RTN","BIDUR1",7,0)
 ;----------
"RTN","BIDUR1",8,0)
STORE(BIDFN,BIFDT,BIORD,BIERR,BIVAL,BISITE) ;EP
"RTN","BIDUR1",9,0)
 ;---> Store this patient in the Order specified.
"RTN","BIDUR1",10,0)
 ;---> Parameters:
"RTN","BIDUR1",11,0)
 ;     1 - BIDFN  (req) Patient's IEN (DFN).
"RTN","BIDUR1",12,0)
 ;     2 - BIFDT  (req) Forecast date.
"RTN","BIDUR1",13,0)
 ;     3 - BIORD  (req) Order of listing (default=1, by age).
"RTN","BIDUR1",14,0)
 ;     4 - BIERR  (ret) Error Code.
"RTN","BIDUR1",15,0)
 ;     5 - BIVAL  (opt) Value to set ^TMP(Patient...) node equal to.
"RTN","BIDUR1",16,0)
 ;     6 - BISITE (req) Site IEN.
"RTN","BIDUR1",17,0)
 ;
"RTN","BIDUR1",18,0)
 ;---> Check for required Variables.
"RTN","BIDUR1",19,0)
 I '$G(BIDFN) S BIERR=201 Q
"RTN","BIDUR1",20,0)
 I '$G(BIFDT) S BIERR=616 Q
"RTN","BIDUR1",21,0)
 S:'$G(BIORD) BIORD=1
"RTN","BIDUR1",22,0)
 S:'$G(BISITE) BISITE=$G(DUZ(2)) I '$G(BISITE) S BIERR=109 Q
"RTN","BIDUR1",23,0)
 ;
"RTN","BIDUR1",24,0)
 ;---> Store this patient in the Order specified:
"RTN","BIDUR1",25,0)
 ;
"RTN","BIDUR1",26,0)
 ;---> By Patient Alphabetically.
"RTN","BIDUR1",27,0)
 I BIORD=2 D  Q
"RTN","BIDUR1",28,0)
 .N X,Y,Z
"RTN","BIDUR1",29,0)
 .S X=1,Y=1,Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",30,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",31,0)
 ;
"RTN","BIDUR1",32,0)
 ;---> By HRCN/Chart#.
"RTN","BIDUR1",33,0)
 I BIORD=3 D  Q
"RTN","BIDUR1",34,0)
 .N X,Y,Z
"RTN","BIDUR1",35,0)
 .S X=1,Y=1,Z=$$HRCN^BIUTL1(BIDFN,BISITE,1)
"RTN","BIDUR1",36,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",37,0)
 ;
"RTN","BIDUR1",38,0)
 ;---> By Case Manager.
"RTN","BIDUR1",39,0)
 I BIORD=4 D  Q
"RTN","BIDUR1",40,0)
 .N X,Y,Z
"RTN","BIDUR1",41,0)
 .S X=$$CMGR^BIUTL1(BIDFN,1),Y=1,Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",42,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",43,0)
 ;
"RTN","BIDUR1",44,0)
 ;---> By Case Manager, then Current Community.
"RTN","BIDUR1",45,0)
 I BIORD=5 D  Q
"RTN","BIDUR1",46,0)
 .N X,Y,Z
"RTN","BIDUR1",47,0)
 .S X=$$CMGR^BIUTL1(BIDFN,1),Y=$$CURCOM^BIUTL11(BIDFN,1)
"RTN","BIDUR1",48,0)
 .S Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",49,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",50,0)
 ;
"RTN","BIDUR1",51,0)
 ;---> By Current Community, then Case Manager.
"RTN","BIDUR1",52,0)
 I BIORD=6 D  Q
"RTN","BIDUR1",53,0)
 .N X,Y,Z
"RTN","BIDUR1",54,0)
 .S X=$$CURCOM^BIUTL11(BIDFN,1),Y=$$CMGR^BIUTL1(BIDFN,1)
"RTN","BIDUR1",55,0)
 .S Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",56,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",57,0)
 ;
"RTN","BIDUR1",58,0)
 ;---> By Current Community, then Patient Age.
"RTN","BIDUR1",59,0)
 I BIORD=7 D  Q
"RTN","BIDUR1",60,0)
 .N X,Y,Z
"RTN","BIDUR1",61,0)
 .S X=$$CURCOM^BIUTL11(BIDFN,1),Y=9999999-$$DOB^BIUTL1(BIDFN)
"RTN","BIDUR1",62,0)
 .S Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",63,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",64,0)
 ;
"RTN","BIDUR1",65,0)
 ;---> By Current Community, then Patient Name.
"RTN","BIDUR1",66,0)
 I BIORD=8 D  Q
"RTN","BIDUR1",67,0)
 .N X,Y,Z
"RTN","BIDUR1",68,0)
 .S X=$$CURCOM^BIUTL11(BIDFN,1),Y=1,Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",69,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",70,0)
 ;
"RTN","BIDUR1",71,0)
 ;---> By Current Community, then Patient Chart#.
"RTN","BIDUR1",72,0)
 I BIORD=9 D  Q
"RTN","BIDUR1",73,0)
 .N X,Y,Z
"RTN","BIDUR1",74,0)
 .S X=$$CURCOM^BIUTL11(BIDFN,1),Y=1,Z=$$HRCN^BIUTL1(BIDFN,BISITE,1)
"RTN","BIDUR1",75,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",76,0)
 ;
"RTN","BIDUR1",77,0)
 ;---> By Zipcode, then Patient Name.
"RTN","BIDUR1",78,0)
 I BIORD=10 D  Q
"RTN","BIDUR1",79,0)
 .N X,Y,Z
"RTN","BIDUR1",80,0)
 .S X=$$ZIP^BIUTL1(BIDFN),Y=1,Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",81,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",82,0)
 ;
"RTN","BIDUR1",83,0)
 ;---> By Designated Provider.
"RTN","BIDUR1",84,0)
 I BIORD=11 D  Q
"RTN","BIDUR1",85,0)
 .N X,Y,Z
"RTN","BIDUR1",86,0)
 .S X=$$DPRV^BIUTL1(BIDFN,1),Y=1,Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",87,0)
 .S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",88,0)
 ;
"RTN","BIDUR1",89,0)
 ;---> By Patient Age (Default, BIORD=1).
"RTN","BIDUR1",90,0)
 N X,Y,Z
"RTN","BIDUR1",91,0)
 S X=1,Y=9999999-$$DOB^BIUTL1(BIDFN),Z=$$NAME^BIUTL1(BIDFN)
"RTN","BIDUR1",92,0)
 S ^TMP("BIDUL",$J,X,Y,Z,BIDFN)=$G(BIVAL)
"RTN","BIDUR1",93,0)
 Q
"RTN","BIDUR1",94,0)
 ;
"RTN","BIDUR1",95,0)
 ;
"RTN","BIDUR1",96,0)
 ;----------
"RTN","BIDUR1",97,0)
BENT(BIDFN,BIBEN) ;EP
"RTN","BIDUR1",98,0)
 ;---> Beneficiary Type indicator.
"RTN","BIDUR1",99,0)
 ;---> Return 1 if not selecting all Beneficiary Types and if this
"RTN","BIDUR1",100,0)
 ;---> patient's Beneficiary Type is not one of the ones selected.
"RTN","BIDUR1",101,0)
 ;
"RTN","BIDUR1",102,0)
 Q:'$G(BIDFN) 1
"RTN","BIDUR1",103,0)
 Q:$D(BIBEN("ALL")) 0
"RTN","BIDUR1",104,0)
 N BIBENT S BIBENT=$$BENTYP^BIUTL11(BIDFN)
"RTN","BIDUR1",105,0)
 Q:'BIBENT 1
"RTN","BIDUR1",106,0)
 Q:'$D(BIBEN(BIBENT)) 1
"RTN","BIDUR1",107,0)
 Q 0
"RTN","BIDUVLS")
0^17^B27583633
"RTN","BIDUVLS",1,0)
BIDUVLS ;IHS/CMI/MWR - VIEW DUE LIST.; MAY 10, 2010
"RTN","BIDUVLS",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUVLS",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUVLS",4,0)
 ;;  VIEW LIST OF PATIENTS (DUE LIST OR MASTER LIST).
"RTN","BIDUVLS",5,0)
 ;;  CALLED BY PROTOCOL: BI DUE LIST OF PATIENTS ("List of Patients")`
"RTN","BIDUVLS",6,0)
 ;
"RTN","BIDUVLS",7,0)
 ;
"RTN","BIDUVLS",8,0)
 ;----------
"RTN","BIDUVLS",9,0)
VIEWDUE ;EP
"RTN","BIDUVLS",10,0)
 ;---> View Immunization Due list.
"RTN","BIDUVLS",11,0)
 ;---> Called by Protocol BI DUE LIST OF PATIENTS.
"RTN","BIDUVLS",12,0)
 ;---> Variables:
"RTN","BIDUVLS",13,0)
 ;     1 - BIAG   (req) Age Range in months.
"RTN","BIDUVLS",14,0)
 ;     2 - BIPG   (req) Patient Group Data; see PGRPOUP1^BIOUTPT4 for details.
"RTN","BIDUVLS",15,0)
 ;     3 - BIFDT  (req) Forecast date.
"RTN","BIDUVLS",16,0)
 ;     4 - BICC   (req) Current Community array.
"RTN","BIDUVLS",17,0)
 ;     5 - BICM   (req) Case Manager array.
"RTN","BIDUVLS",18,0)
 ;     6 - BIDPRV (req) Designated Provider array.
"RTN","BIDUVLS",19,0)
 ;     7 - BIMMR  (req) Immunizations Received array.
"RTN","BIDUVLS",20,0)
 ;     8 - BIMMD  (req) Immunizations Due array.
"RTN","BIDUVLS",21,0)
 ;     9 - BIHCF  (req) Health Care Facility array.
"RTN","BIDUVLS",22,0)
 ;    10 - BILOT  (req) Lot Number array.
"RTN","BIDUVLS",23,0)
 ;    11 - BIORD  (req) Order of listing.
"RTN","BIDUVLS",24,0)
 ;    12 - BINFO  (opt) Array of Additional Information elements (may be null).
"RTN","BIDUVLS",25,0)
 ;    13 - BIRDT  (opt) Date Range for Received Imms (form BEGDATE:ENDDATE).
"RTN","BIDUVLS",26,0)
 ;    14 - BIDED  (opt) Include Deceased Patients (0=no, 1=yes).
"RTN","BIDUVLS",27,0)
 ;    15 - BIMMRF (opt) Imms Received Filter array (subscript=CVX's included).
"RTN","BIDUVLS",28,0)
 ;    16 - BIBEN  (req) Beneficiary Type array: either BIBEN(1) or BIBEN("ALL").
"RTN","BIDUVLS",29,0)
 ;
"RTN","BIDUVLS",30,0)
 ;---> Check for required Variables.
"RTN","BIDUVLS",31,0)
 I '$D(BIAG) D ERROR(613) Q
"RTN","BIDUVLS",32,0)
 I '$D(BIPG) D ERROR(620) Q
"RTN","BIDUVLS",33,0)
 I '$G(BIFDT) D ERROR(616) Q
"RTN","BIDUVLS",34,0)
 I '$D(BICC) D ERROR(614) Q
"RTN","BIDUVLS",35,0)
 I '$D(BICM) D ERROR(615) Q
"RTN","BIDUVLS",36,0)
 I '$D(BIDPRV) D ERROR(680) Q
"RTN","BIDUVLS",37,0)
 I '$D(BIMMR) D ERROR(652) Q
"RTN","BIDUVLS",38,0)
 I '$D(BIMMD) D ERROR(638) Q
"RTN","BIDUVLS",39,0)
 I '$D(BIHCF) D ERROR(625) Q
"RTN","BIDUVLS",40,0)
 I '$D(BILOT) D ERROR(630) Q
"RTN","BIDUVLS",41,0)
 I '$G(BIORD) D ERROR(618) Q
"RTN","BIDUVLS",42,0)
 ;I '$D(BINFO) D ERROR(629) Q  ;Additional Info not required (may be null).
"RTN","BIDUVLS",43,0)
 ;  ;BIMMRF not required (may be null).
"RTN","BIDUVLS",44,0)
 ;
"RTN","BIDUVLS",45,0)
 I '$D(BIRDT) S BIRDT=""
"RTN","BIDUVLS",46,0)
 I '$D(BIDED) S BIDED=0
"RTN","BIDUVLS",47,0)
 I '$D(BIBEN) S BIBEN(1)=""
"RTN","BIDUVLS",48,0)
 ;
"RTN","BIDUVLS",49,0)
 D FULL^VALM1 N BIERR
"RTN","BIDUVLS",50,0)
 D TITLE^BIUTL5("PRINT OR VIEW LIST"),TEXT1
"RTN","BIDUVLS",51,0)
 N DIR
"RTN","BIDUVLS",52,0)
 S DIR("A")="     Select Print or View: ",DIR("B")="View"
"RTN","BIDUVLS",53,0)
 S DIR(0)="SAM^p:Print;v:View;q:Quit"
"RTN","BIDUVLS",54,0)
 D ^DIR K DIR
"RTN","BIDUVLS",55,0)
 I Y=-1!($D(DIRUT)) D RESET^BIDU Q
"RTN","BIDUVLS",56,0)
 ;
"RTN","BIDUVLS",57,0)
 ;---> User chose to Quit.
"RTN","BIDUVLS",58,0)
 I Y="q" D RESET^BIDU Q
"RTN","BIDUVLS",59,0)
 ;
"RTN","BIDUVLS",60,0)
VIEW ;---> User chose to VIEW Due List.
"RTN","BIDUVLS",61,0)
 I Y="v" D  Q
"RTN","BIDUVLS",62,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIDUVLS",63,0)
 .;
"RTN","BIDUVLS",64,0)
 .;---> Retrieve patients for this listing.
"RTN","BIDUVLS",65,0)
 .;---> (Patient's forecast gets updated at CHKSET+60^BIDUR.)
"RTN","BIDUVLS",66,0)
 .;---> Since this is List (not Letter), send 0 days since last letter
"RTN","BIDUVLS",67,0)
 .;---> as 10th parameter.  BIT=Total Patients retrieved.
"RTN","BIDUVLS",68,0)
 .;
"RTN","BIDUVLS",69,0)
 .;D NOW1^BIUTL3
"RTN","BIDUVLS",70,0)
 .D RETRIEVE(.BIT,.BIERR)
"RTN","BIDUVLS",71,0)
 .I $G(BIERR) D ERROR(BIERR),EXIT,RESET^BIDU Q
"RTN","BIDUVLS",72,0)
 .;D NOW2^BIUTL3
"RTN","BIDUVLS",73,0)
 .;
"RTN","BIDUVLS",74,0)
 .;---> Display list of patients retrieved.
"RTN","BIDUVLS",75,0)
 .K ^TMP("BIDULV",$J)
"RTN","BIDUVLS",76,0)
 .D START^BIDUVLS1(BIFDT,.BINFO,BIPG,BIAG,BIT,,,,,.BIBEN)
"RTN","BIDUVLS",77,0)
 .D EXIT,RESET^BIDU
"RTN","BIDUVLS",78,0)
 ;
"RTN","BIDUVLS",79,0)
 ;
"RTN","BIDUVLS",80,0)
PRINT ;EP
"RTN","BIDUVLS",81,0)
 ;---> User chose to PRINT Due List.
"RTN","BIDUVLS",82,0)
 N BIPOP
"RTN","BIDUVLS",83,0)
 D DEVICE(.BIPOP)
"RTN","BIDUVLS",84,0)
 I $G(BIPOP) D RESET^BIDU Q
"RTN","BIDUVLS",85,0)
 ;
"RTN","BIDUVLS",86,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIDUVLS",87,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIDUVLS",88,0)
 ;
"RTN","BIDUVLS",89,0)
 ;---> Retrieve patients for this listing.
"RTN","BIDUVLS",90,0)
 D RETRIEVE(.BIT,.BIERR)
"RTN","BIDUVLS",91,0)
 I $G(BIERR) D ERROR(BIERR),EXIT,RESET^BIDU Q
"RTN","BIDUVLS",92,0)
 ;
"RTN","BIDUVLS",93,0)
 ;---> Print list of patients retrieved.
"RTN","BIDUVLS",94,0)
 ;---> Cannot pass params to INIT, but should have BIFDTDT,
"RTN","BIDUVLS",95,0)
 ;---> BINFO, and BIT defined.
"RTN","BIDUVLS",96,0)
 K ^TMP("BIDULV",$J)
"RTN","BIDUVLS",97,0)
 N VALM,VALMHDR
"RTN","BIDUVLS",98,0)
 D HDR^BIDUVLS1,INIT^BIDUVLS1
"RTN","BIDUVLS",99,0)
 D PRTLST^BIUTL8("BIDULV")
"RTN","BIDUVLS",100,0)
 D EXIT,RESET^BIDU
"RTN","BIDUVLS",101,0)
 Q
"RTN","BIDUVLS",102,0)
 ;
"RTN","BIDUVLS",103,0)
 ;
"RTN","BIDUVLS",104,0)
 ;----------
"RTN","BIDUVLS",105,0)
RETRIEVE(BIT,BIERR) ;EP
"RTN","BIDUVLS",106,0)
 ;---> Retrieve patients according to parameters set.
"RTN","BIDUVLS",107,0)
 ;---> Parameters:
"RTN","BIDUVLS",108,0)
 ;     1 - BIT   (ret) Total Patients retrieved.
"RTN","BIDUVLS",109,0)
 ;     2 - BIERR (ret) Error Code.
"RTN","BIDUVLS",110,0)
 ;
"RTN","BIDUVLS",111,0)
 D R^BIDUR(BIAG,BIPG,BIFDT,.BICC,.BICM,.BIMMR,.BIMMD,.BILOT,0,BIORD,BIRDT,BIDED,.BIT,.BIHCF,.BIDPRV,.BIERR,.BIBEN)
"RTN","BIDUVLS",112,0)
 Q
"RTN","BIDUVLS",113,0)
 ;
"RTN","BIDUVLS",114,0)
 ;
"RTN","BIDUVLS",115,0)
 ;----------
"RTN","BIDUVLS",116,0)
DEVICE(BIPOP) ;EP
"RTN","BIDUVLS",117,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIDUVLS",118,0)
 ;---> Parameters:
"RTN","BIDUVLS",119,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIDUVLS",120,0)
 ;
"RTN","BIDUVLS",121,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIDUVLS",122,0)
 S ZTRTN="DEQUEUE^BIDUVLS"
"RTN","BIDUVLS",123,0)
 D ZSAVES^BIUTL3
"RTN","BIDUVLS",124,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIDUVLS",125,0)
 Q
"RTN","BIDUVLS",126,0)
 ;
"RTN","BIDUVLS",127,0)
 ;
"RTN","BIDUVLS",128,0)
 ;----------
"RTN","BIDUVLS",129,0)
DEQUEUE ;EP
"RTN","BIDUVLS",130,0)
 ;---> Print list of patients retrieved.
"RTN","BIDUVLS",131,0)
 ;
"RTN","BIDUVLS",132,0)
 D RETRIEVE(.BIT,.BIERR)
"RTN","BIDUVLS",133,0)
 I $G(BIERR) D EXIT Q
"RTN","BIDUVLS",134,0)
 K VALMHDR,^TMP("BIDULV",$J)
"RTN","BIDUVLS",135,0)
 D HDR^BIDUVLS1,INIT^BIDUVLS1
"RTN","BIDUVLS",136,0)
 D PRTLST^BIUTL8("BIDULV")
"RTN","BIDUVLS",137,0)
 D EXIT
"RTN","BIDUVLS",138,0)
 Q
"RTN","BIDUVLS",139,0)
 ;
"RTN","BIDUVLS",140,0)
 ;
"RTN","BIDUVLS",141,0)
 ;----------
"RTN","BIDUVLS",142,0)
ERROR(BIERR) ;EP
"RTN","BIDUVLS",143,0)
 ;---> Report error, reset Listman screen and quit.
"RTN","BIDUVLS",144,0)
 ;---> Parameters:
"RTN","BIDUVLS",145,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIDUVLS",146,0)
 ;
"RTN","BIDUVLS",147,0)
 S:'$G(BIERR) BIERR=999
"RTN","BIDUVLS",148,0)
 D ERRCD^BIUTL2(BIERR,,1) D RESET^BIDU Q
"RTN","BIDUVLS",149,0)
 Q
"RTN","BIDUVLS",150,0)
 ;
"RTN","BIDUVLS",151,0)
 ;
"RTN","BIDUVLS",152,0)
TEXT1 ;
"RTN","BIDUVLS",153,0)
 ;;You may either PRINT the List or VIEW it on this screen.
"RTN","BIDUVLS",154,0)
 ;;
"RTN","BIDUVLS",155,0)
 ;;PRINT: If it customarily takes a long time for your computer
"RTN","BIDUVLS",156,0)
 ;;to produce a List of Patients, it may be more efficient for you
"RTN","BIDUVLS",157,0)
 ;;to QUEUE it to a printer.  That way you can be free to do other
"RTN","BIDUVLS",158,0)
 ;;things until the printout is finished.
"RTN","BIDUVLS",159,0)
 ;;
"RTN","BIDUVLS",160,0)
 ;;VIEW:  You will have to wait while the computer retrieves the
"RTN","BIDUVLS",161,0)
 ;;information.  However, once the List of Patients comes up on
"RTN","BIDUVLS",162,0)
 ;;the screen, you will be able to browse the list on screen by
"RTN","BIDUVLS",163,0)
 ;;scrolling up and down using the arrow keys.
"RTN","BIDUVLS",164,0)
 ;;
"RTN","BIDUVLS",165,0)
 D PRINTX("TEXT1",5)
"RTN","BIDUVLS",166,0)
 Q
"RTN","BIDUVLS",167,0)
 ;
"RTN","BIDUVLS",168,0)
 ;
"RTN","BIDUVLS",169,0)
 ;----------
"RTN","BIDUVLS",170,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIDUVLS",171,0)
 Q:$G(BILINL)=""
"RTN","BIDUVLS",172,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIDUVLS",173,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIDUVLS",174,0)
 Q
"RTN","BIDUVLS",175,0)
 ;
"RTN","BIDUVLS",176,0)
 ;
"RTN","BIDUVLS",177,0)
 ;----------
"RTN","BIDUVLS",178,0)
EXIT ;EP
"RTN","BIDUVLS",179,0)
 ;---> Cleanup and Quit.
"RTN","BIDUVLS",180,0)
 K ^TMP("BIDULV",$J)
"RTN","BIDUVLS",181,0)
 Q
"RTN","BIDUVLS",182,0)
 ;
"RTN","BIDUVLS",183,0)
 ;
"RTN","BIDUVLS",184,0)
 ;----------
"RTN","BIDUVLS",185,0)
EDITPAT ;EP
"RTN","BIDUVLS",186,0)
 ;---> Edit Patient from List.
"RTN","BIDUVLS",187,0)
 S:'$G(BIORD) BIORD=1
"RTN","BIDUVLS",188,0)
 D FULL^VALM1
"RTN","BIDUVLS",189,0)
 D
"RTN","BIDUVLS",190,0)
 .N BIAG,BIBEN,BICC,BICM,BICPT,BIDPRV,BIFDT,BIHCF,BILOT,BIMD
"RTN","BIDUVLS",191,0)
 .N BIMMD,BIMMR,BINFO,BIORD,BIPG,BIQDT,BIRPDT,BIT
"RTN","BIDUVLS",192,0)
 .D ONEPAT^BIPATVW
"RTN","BIDUVLS",193,0)
 ;
"RTN","BIDUVLS",194,0)
 S VALMBCK="R"
"RTN","BIDUVLS",195,0)
 Q
"RTN","BIDUVLS1")
0^18^B53524822
"RTN","BIDUVLS1",1,0)
BIDUVLS1 ;IHS/CMI/MWR - VIEW DUE LIST.; MAY 10, 2010
"RTN","BIDUVLS1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUVLS1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUVLS1",4,0)
 ;;  LIST TEMPLATE CODE FOR VIEWING PATIENTS.
"RTN","BIDUVLS1",5,0)
 ;;  PATCH 1: Corrects Patient Group for not displaying Age Range.  HDR+21
"RTN","BIDUVLS1",6,0)
 ;
"RTN","BIDUVLS1",7,0)
 ;
"RTN","BIDUVLS1",8,0)
 ;----------
"RTN","BIDUVLS1",9,0)
START(BIFDT,BINFO,BIPG,BIAG,BIT,BIVAL,BIDASH,BITITL,BIRPDT,BIBEN) ;EP
"RTN","BIDUVLS1",10,0)
 ;---> Display Immunizations Due List via Listman.
"RTN","BIDUVLS1",11,0)
 ;---> Parameters:
"RTN","BIDUVLS1",12,0)
 ;     1 - BIFDT  (req) Forecast/Clinic Date.
"RTN","BIDUVLS1",13,0)
 ;     2 - BINFO  (req) Array of Additional Information elements for each patient.
"RTN","BIDUVLS1",14,0)
 ;     3 - BIPG   (req) Patient Group Data; see PGRPOUP1^BIOUTPT4 for details.
"RTN","BIDUVLS1",15,0)
 ;     4 - BIAG   (opt) Age Range.  If 2nd ^-piece=1, display "years."
"RTN","BIDUVLS1",16,0)
 ;     5 - BIT    (req) Total Patients retrieved.
"RTN","BIDUVLS1",17,0)
 ;     6 - BIVAL  (opt) Value indicates which patients:
"RTN","BIDUVLS1",18,0)
 ;                      0=All, 1=Rejects only, 2=Appropriate only.
"RTN","BIDUVLS1",19,0)
 ;     7 - BIDASH (opt) 1=Omit Dash line between records; 0=include it.
"RTN","BIDUVLS1",20,0)
 ;     8 - BITITL (opt) Report Name, if present will replace "Clinic Date"
"RTN","BIDUVLS1",21,0)
 ;                      in report header.
"RTN","BIDUVLS1",22,0)
 ;     9 - BIRPDT (opt) Report Date: Today unless passed from reports
"RTN","BIDUVLS1",23,0)
 ;                                   (e.g., Quarterly Report).
"RTN","BIDUVLS1",24,0)
 ;    10 - BIBEN  (req) Beneficiary Type array: either BIBEN(1) or BIBEN("ALL").
"RTN","BIDUVLS1",25,0)
 ;
"RTN","BIDUVLS1",26,0)
 ;----------
"RTN","BIDUVLS1",27,0)
MAIN ;EP
"RTN","BIDUVLS1",28,0)
 ;---> Listman Screen for printing Immunization Due Letters.
"RTN","BIDUVLS1",29,0)
 D SETVARS^BIUTL5
"RTN","BIDUVLS1",30,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIDUVLS1",31,0)
 S:'$G(BIRPDT) BIRPDT=DT
"RTN","BIDUVLS1",32,0)
 N VALMCNT
"RTN","BIDUVLS1",33,0)
 D EN
"RTN","BIDUVLS1",34,0)
 D EXIT
"RTN","BIDUVLS1",35,0)
 Q
"RTN","BIDUVLS1",36,0)
 ;
"RTN","BIDUVLS1",37,0)
 ;
"RTN","BIDUVLS1",38,0)
 ;----------
"RTN","BIDUVLS1",39,0)
EN ;EP
"RTN","BIDUVLS1",40,0)
 ;---> Main entry point.
"RTN","BIDUVLS1",41,0)
 D EN^VALM("BI DUE LIST VIEW")
"RTN","BIDUVLS1",42,0)
 Q
"RTN","BIDUVLS1",43,0)
 ;
"RTN","BIDUVLS1",44,0)
 ;
"RTN","BIDUVLS1",45,0)
 ;----------
"RTN","BIDUVLS1",46,0)
HDR ;EP
"RTN","BIDUVLS1",47,0)
 ;---> Header code
"RTN","BIDUVLS1",48,0)
 I '$D(BIPG) D ERRCD^BIUTL2(620,,1) S VALMQUIT="" Q
"RTN","BIDUVLS1",49,0)
 K VALMHDR
"RTN","BIDUVLS1",50,0)
 N BIDASH,BILINE,X,Y,Z S BILINE=0
"RTN","BIDUVLS1",51,0)
 S:'$G(BIRPDT) BIRPDT=DT
"RTN","BIDUVLS1",52,0)
 ;
"RTN","BIDUVLS1",53,0)
 S X="WARNING: Confidential Patient Information, Privacy Act applies."
"RTN","BIDUVLS1",54,0)
 D CENTERT^BIUTL5(.X)
"RTN","BIDUVLS1",55,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIDUVLS1",56,0)
 ;
"RTN","BIDUVLS1",57,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIDUVLS1",58,0)
 D WH^BIW(.BILINE,X)
"RTN","BIDUVLS1",59,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIDUVLS1",60,0)
 D WH^BIW(.BILINE,X)
"RTN","BIDUVLS1",61,0)
 ;
"RTN","BIDUVLS1",62,0)
 S X="       Report Date: "_$$TXDT1^BIUTL5(BIRPDT)
"RTN","BIDUVLS1",63,0)
 S X=X_"        Total Patients: "_$G(BIT)
"RTN","BIDUVLS1",64,0)
 ;
"RTN","BIDUVLS1",65,0)
 D:$G(BIAG)]""
"RTN","BIDUVLS1",66,0)
 .;---> For Patient Group (8=Search Template) to not display Age Range.
"RTN","BIDUVLS1",67,0)
 .Q:(+BIPG=8)
"RTN","BIDUVLS1",68,0)
 .I BIAG="ALL" S X=X_"  (All Ages)" Q
"RTN","BIDUVLS1",69,0)
 .S X=X_" ("_$$MTHYR^BIAGE(BIAG)_")"
"RTN","BIDUVLS1",70,0)
 I +BIPG'=8 S X=X_" *"_$S($D(BIBEN("ALL")):"All",1:"01")
"RTN","BIDUVLS1",71,0)
 D WH^BIW(.BILINE,X)
"RTN","BIDUVLS1",72,0)
 ;
"RTN","BIDUVLS1",73,0)
 D
"RTN","BIDUVLS1",74,0)
 .I $G(BITITL)]"" S X="      Report Title: "_$$PAD^BIUTL5(BITITL,11) Q
"RTN","BIDUVLS1",75,0)
 .I $G(BINFO)["5," S X="       Clinic Date: "_$$TXDT1^BIUTL5(BIFDT) Q
"RTN","BIDUVLS1",76,0)
 .S X=""
"RTN","BIDUVLS1",77,0)
 ;
"RTN","BIDUVLS1",78,0)
 N BIHEAD,BIPG1
"RTN","BIDUVLS1",79,0)
 D PGRP^BIDU(BIPG,.BIPG1)
"RTN","BIDUVLS1",80,0)
 S BIHEAD="Patient Group: "
"RTN","BIDUVLS1",81,0)
 D
"RTN","BIDUVLS1",82,0)
 .I X]"",$L(BIHEAD_BIPG1)<41 D  Q
"RTN","BIDUVLS1",83,0)
 ..S X=X_$$SP^BIUTL5(9)_BIHEAD_BIPG1 D WH^BIW(.BILINE,X)
"RTN","BIDUVLS1",84,0)
 .;---> If Clinic Date & Patient Group won't fit, write Clinic Date and go on.
"RTN","BIDUVLS1",85,0)
 .I X]"" D WH^BIW(.BILINE,X)
"RTN","BIDUVLS1",86,0)
 .;---> Now write Patient Group info on the next line(s).
"RTN","BIDUVLS1",87,0)
 .N I,N,V,Z S N=1,V=",",X="",BIHEAD="     "_BIHEAD
"RTN","BIDUVLS1",88,0)
 .F  D  Q:$P(BIPG1,V,I)=""  Q:$G(BIERR)
"RTN","BIDUVLS1",89,0)
 ..F I=N:1 S X=$P(BIPG1,V,N,I) Q:$L(X)>60  Q:$P(BIPG1,V,I)=""
"RTN","BIDUVLS1",90,0)
 ..I N>1 S BIHEAD=$$SP^BIUTL5(19)
"RTN","BIDUVLS1",91,0)
 ..D WH^BIW(.BILINE,BIHEAD_$P(BIPG1,V,N,I-1))
"RTN","BIDUVLS1",92,0)
 ..S N=I
"RTN","BIDUVLS1",93,0)
 ;
"RTN","BIDUVLS1",94,0)
 ;---> If necessary, write a dashed line for subheader,
"RTN","BIDUVLS1",95,0)
 ;---> otherwise write a blank line.
"RTN","BIDUVLS1",96,0)
 N I K X
"RTN","BIDUVLS1",97,0)
 F I="CC","CM","DPRV","MMR","MMD","HCF","LOT" D
"RTN","BIDUVLS1",98,0)
 .I $O(@("BI"_I_"(0)")) S X=1
"RTN","BIDUVLS1",99,0)
 D WH^BIW(.BILINE,$S($G(X):$$SP^BIUTL5(79,"-"),1:""))
"RTN","BIDUVLS1",100,0)
 ;
"RTN","BIDUVLS1",101,0)
 D
"RTN","BIDUVLS1",102,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIDUVLS1",103,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIDUVLS1",104,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,11)
"RTN","BIDUVLS1",105,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",106,0)
 .;
"RTN","BIDUVLS1",107,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIDUVLS1",108,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,11)
"RTN","BIDUVLS1",109,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",110,0)
 .;
"RTN","BIDUVLS1",111,0)
 .;---> If specific Designated Providers, print Designated Provider subheader.
"RTN","BIDUVLS1",112,0)
 .D SUBH^BIOUTPT5("BIDPRV","Designated Provider",,"^VA(200,",.BILINE,.BIERR,,11)
"RTN","BIDUVLS1",113,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",114,0)
 .;
"RTN","BIDUVLS1",115,0)
 .;---> If specific Immunizations Received, print subheader.
"RTN","BIDUVLS1",116,0)
 .S X="Immunization Rcvd",Y="Immunizations Rcvd"
"RTN","BIDUVLS1",117,0)
 .I $G(BIRDT) N Z S Z=" "_$$DATE^BIDU(BIRDT,1)
"RTN","BIDUVLS1",118,0)
 .D SUBH^BIOUTPT5("BIMMR",X,Y,"^AUTTIMM(",.BILINE,.BIERR,2,11,$G(Z))
"RTN","BIDUVLS1",119,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",120,0)
 .;
"RTN","BIDUVLS1",121,0)
 .;---> If specific Immunizations Due, print subheader.
"RTN","BIDUVLS1",122,0)
 .S X="Immunization Due",Y="Immunizations Due"
"RTN","BIDUVLS1",123,0)
 .D SUBH^BIOUTPT5("BIMMD",X,Y,"^AUTTIMM(",.BILINE,.BIERR,2,11)
"RTN","BIDUVLS1",124,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",125,0)
 .;
"RTN","BIDUVLS1",126,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIDUVLS1",127,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,11)
"RTN","BIDUVLS1",128,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",129,0)
 .;
"RTN","BIDUVLS1",130,0)
 .;---> If specific Lot Numbers, print subheader.
"RTN","BIDUVLS1",131,0)
 .D SUBH^BIOUTPT5("BILOT","Lot Number",,"^AUTTIML(",.BILINE,.BIERR,,11)
"RTN","BIDUVLS1",132,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIDUVLS1",133,0)
 ;
"RTN","BIDUVLS1",134,0)
 ;
"RTN","BIDUVLS1",135,0)
 ;---> Build Column Headers.
"RTN","BIDUVLS1",136,0)
 N BICOL S BICOL="  Name                HRCN#     DOB"
"RTN","BIDUVLS1",137,0)
 D
"RTN","BIDUVLS1",138,0)
 .I BIFDT'=DT D  Q
"RTN","BIDUVLS1",139,0)
 ..S BICOL=BICOL_" & Age on "_$$TXDT1^BIUTL5(BIFDT)_"  Current Community"
"RTN","BIDUVLS1",140,0)
 .;"Age Today" vvv83
"RTN","BIDUVLS1",141,0)
 .S BICOL=BICOL_"        Age Today  Sex Current Community"
"RTN","BIDUVLS1",142,0)
 S BICOL=$$PAD^BIUTL5(BICOL,80)
"RTN","BIDUVLS1",143,0)
 ;
"RTN","BIDUVLS1",144,0)
 ;---> Set Column Headers for Listman.
"RTN","BIDUVLS1",145,0)
 S:$D(VALMCAP) VALMCAP=BICOL
"RTN","BIDUVLS1",146,0)
 ;
"RTN","BIDUVLS1",147,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIDUVLS1",148,0)
 ;---> reset display window margins for Communities, etc. and quit.
"RTN","BIDUVLS1",149,0)
 I $D(VALM("BM")) D  Q
"RTN","BIDUVLS1",150,0)
 .S VALM("TM")=BILINE+3
"RTN","BIDUVLS1",151,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIDUVLS1",152,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIDUVLS1",153,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIDUVLS1",154,0)
 ;
"RTN","BIDUVLS1",155,0)
 ;---> If Header array is being built for a printout, write
"RTN","BIDUVLS1",156,0)
 ;---> in the column headers.
"RTN","BIDUVLS1",157,0)
 D WH^BIW(.BILINE,BICOL)
"RTN","BIDUVLS1",158,0)
 Q
"RTN","BIDUVLS1",159,0)
 ;
"RTN","BIDUVLS1",160,0)
 ;
"RTN","BIDUVLS1",161,0)
 ;----------
"RTN","BIDUVLS1",162,0)
INIT ;EP
"RTN","BIDUVLS1",163,0)
 ;---> Initialize variables and list array.
"RTN","BIDUVLS1",164,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIDUVLS1",165,0)
 N BILINE,BI31,X S BILINE=0,BI31=$C(31)_$C(31)
"RTN","BIDUVLS1",166,0)
 S:'$D(BINFO) BINFO(0)=0
"RTN","BIDUVLS1",167,0)
 I '$D(BIPG) D ERRCD^BIUTL2(620,,1) S VALMQUIT="" Q
"RTN","BIDUVLS1",168,0)
 ;
"RTN","BIDUVLS1",169,0)
 ;
"RTN","BIDUVLS1",170,0)
 ;---> Loop through ^TMP("BIDUL",$J,...,BIDFN) adding patients to list.
"RTN","BIDUVLS1",171,0)
 ;---> Seed loops with -1 to pick up entries with a subscript of 0. Imm v8.5.
"RTN","BIDUVLS1",172,0)
 N BIDFN,N,M,P
"RTN","BIDUVLS1",173,0)
 S N=-1
"RTN","BIDUVLS1",174,0)
 F  S N=$O(^TMP("BIDUL",$J,N)) Q:N=""  D
"RTN","BIDUVLS1",175,0)
 .S M=-1
"RTN","BIDUVLS1",176,0)
 .F  S M=$O(^TMP("BIDUL",$J,N,M)) Q:M=""  D
"RTN","BIDUVLS1",177,0)
 ..S P=-1
"RTN","BIDUVLS1",178,0)
 ..F  S P=$O(^TMP("BIDUL",$J,N,M,P)) Q:P=""  D
"RTN","BIDUVLS1",179,0)
 ...N BIVAL1
"RTN","BIDUVLS1",180,0)
 ...S BIDFN=0
"RTN","BIDUVLS1",181,0)
 ...F  S BIDFN=$O(^TMP("BIDUL",$J,N,M,P,BIDFN)) Q:'BIDFN  S BIVAL1=^(BIDFN) D
"RTN","BIDUVLS1",182,0)
 ....;---> BIVAL=0=All (no filter), 1=Rejects, 2=Appropriate.
"RTN","BIDUVLS1",183,0)
 ....I $G(BIVAL) Q:BIVAL'=BIVAL1
"RTN","BIDUVLS1",184,0)
 ....N N,M,P
"RTN","BIDUVLS1",185,0)
 ....;---> Write line to ^TMP("BIDULV",$J,BILINE,0)=BIVAL global.
"RTN","BIDUVLS1",186,0)
 ....D PATIENT^BIDUVLS2(.BILINE,BIDFN,.BINFO,$G(BIDASH),.BIMMRF,.BIMMLF)
"RTN","BIDUVLS1",187,0)
 ;
"RTN","BIDUVLS1",188,0)
 ;---> If no records were found to match, report it.
"RTN","BIDUVLS1",189,0)
 D:'$G(BIT)
"RTN","BIDUVLS1",190,0)
 .D WRITE^BIDUVLS2(.BILINE)
"RTN","BIDUVLS1",191,0)
 .N X S X="     No Patient Records match the selected criteria."
"RTN","BIDUVLS1",192,0)
 .D WRITE^BIDUVLS2(.BILINE,X)
"RTN","BIDUVLS1",193,0)
 ;
"RTN","BIDUVLS1",194,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIDUVLS1",195,0)
 S VALMCNT=BILINE
"RTN","BIDUVLS1",196,0)
 D ZSAVES^BIUTL3
"RTN","BIDUVLS1",197,0)
 Q
"RTN","BIDUVLS1",198,0)
 ;
"RTN","BIDUVLS1",199,0)
 ;
"RTN","BIDUVLS1",200,0)
 ;----------
"RTN","BIDUVLS1",201,0)
RESET ;EP
"RTN","BIDUVLS1",202,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIDUVLS1",203,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIDUVLS1",204,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIDUVLS1",205,0)
 D INIT Q
"RTN","BIDUVLS1",206,0)
 ;
"RTN","BIDUVLS1",207,0)
 ;
"RTN","BIDUVLS1",208,0)
 ;----------
"RTN","BIDUVLS1",209,0)
PRINTVW ;EP
"RTN","BIDUVLS1",210,0)
 ;---> Print Due List from View Screen.  (No queueing.)
"RTN","BIDUVLS1",211,0)
 ;---> Called by Protocol BI DUE LIST VIEW PRINT from
"RTN","BIDUVLS1",212,0)
 ;---> Menu Protocol BI MENU DUE LIST VIEW.
"RTN","BIDUVLS1",213,0)
 ;
"RTN","BIDUVLS1",214,0)
 D
"RTN","BIDUVLS1",215,0)
 .N BIPOP W !?3,"Printout may not be queued at this point."
"RTN","BIDUVLS1",216,0)
 .D ZIS^BIUTL2(.BIPOP)
"RTN","BIDUVLS1",217,0)
 .Q:$G(BIPOP)
"RTN","BIDUVLS1",218,0)
 .D PRTLST^BIUTL8("BIDULV")
"RTN","BIDUVLS1",219,0)
 S VALMBCK="R"
"RTN","BIDUVLS1",220,0)
 D RE^VALM4
"RTN","BIDUVLS1",221,0)
 Q
"RTN","BIDUVLS1",222,0)
 ;
"RTN","BIDUVLS1",223,0)
 ;
"RTN","BIDUVLS1",224,0)
 ;----------
"RTN","BIDUVLS1",225,0)
HELP ;EP
"RTN","BIDUVLS1",226,0)
 ;---> Help code.
"RTN","BIDUVLS1",227,0)
 N BIX S BIX=X
"RTN","BIDUVLS1",228,0)
 D FULL^VALM1
"RTN","BIDUVLS1",229,0)
 W !!?5,"Use arrow keys to scroll up and down through the list, or"
"RTN","BIDUVLS1",230,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIDUVLS1",231,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIDUVLS1",232,0)
 D:BIX'="??" RE^VALM4
"RTN","BIDUVLS1",233,0)
 Q
"RTN","BIDUVLS1",234,0)
 ;
"RTN","BIDUVLS1",235,0)
 ;
"RTN","BIDUVLS1",236,0)
 ;----------
"RTN","BIDUVLS1",237,0)
EXIT ;EP
"RTN","BIDUVLS1",238,0)
 ;---> Cleanup, EOJ.
"RTN","BIDUVLS1",239,0)
 K ^TMP("BIDULV",$J)
"RTN","BIDUVLS1",240,0)
 Q
"RTN","BIDUVLS2")
0^19^B34545667
"RTN","BIDUVLS2",1,0)
BIDUVLS2 ;IHS/CMI/MWR - VIEW DUE LIST VIEW.; MAY 10, 2010
"RTN","BIDUVLS2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIDUVLS2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDUVLS2",4,0)
 ;;  LIST TEMPLATE CODE FOR VIEWING PATIENTS DUE, SET LINES FOR
"RTN","BIDUVLS2",5,0)
 ;;  INDIVIDUAL PATIENTS.
"RTN","BIDUVLS2",6,0)
 ;
"RTN","BIDUVLS2",7,0)
 ;
"RTN","BIDUVLS2",8,0)
 ;----------
"RTN","BIDUVLS2",9,0)
PATIENT(BILINE,BIDFN,BINFO,BIDASH,BIMMRF,BIMMLF) ;EP
"RTN","BIDUVLS2",10,0)
 ;---> Set line in Listman display global.
"RTN","BIDUVLS2",11,0)
 ;---> Parameters:
"RTN","BIDUVLS2",12,0)
 ;     1 - BILINE (req) Line Number in display area.
"RTN","BIDUVLS2",13,0)
 ;     2 - BIDFN  (req) Patient DFN.
"RTN","BIDUVLS2",14,0)
 ;     3 - BINFO  (req) Array of Additional Info elements.
"RTN","BIDUVLS2",15,0)
 ;     4 - BIDASH (opt) 1=Omit Dash line between records; 0=include it.
"RTN","BIDUVLS2",16,0)
 ;     5 - BIMMRF (opt) Imms Received Filter array (subscript=CVX's included).
"RTN","BIDUVLS2",17,0)
 ;     6 - BIMMLF (opt) Lot Number Filter array (subscript=lot number text).
"RTN","BIDUVLS2",18,0)
 ;
"RTN","BIDUVLS2",19,0)
 Q:$G(BILINE)=""
"RTN","BIDUVLS2",20,0)
 N BIPLIN,BIPLIN1,X
"RTN","BIDUVLS2",21,0)
 ;
"RTN","BIDUVLS2",22,0)
 ;---> Patient demographic line.
"RTN","BIDUVLS2",23,0)
 S X="  "_$E($$NAME^BIUTL1(BIDFN),1,19)
"RTN","BIDUVLS2",24,0)
 S X=$$PAD^BIUTL5(X,22)_$$PAD^BIUTL5($$HRCN^BIUTL1(BIDFN,DUZ(2)),8)
"RTN","BIDUVLS2",25,0)
 ;S X=X_"  "_$$DOBF^BIUTL1(BIDFN,,,1)_"  "_$$SEX^BIUTL1(BIDFN)  vvv83
"RTN","BIDUVLS2",26,0)
 S X=X_"  "_$$DOBF^BIUTL1(BIDFN,$G(BIFDT),,1)
"RTN","BIDUVLS2",27,0)
 S X=$$PAD^BIUTL5(X,54)_$$SEX^BIUTL1(BIDFN)
"RTN","BIDUVLS2",28,0)
 S X=$$PAD^BIUTL5(X,58)_$E($$CURCOM^BIUTL11(BIDFN,1),1,21)
"RTN","BIDUVLS2",29,0)
 D:'$G(BIDASH) WRITE(.BILINE)
"RTN","BIDUVLS2",30,0)
 D WRITE(.BILINE,X) K X
"RTN","BIDUVLS2",31,0)
 ;---> Preserve line number of Patient demographic line, for record
"RTN","BIDUVLS2",32,0)
 ;---> line count and for address and phone lines below.
"RTN","BIDUVLS2",33,0)
 S BIPLIN=BILINE-1,BIPLIN1=BILINE+1
"RTN","BIDUVLS2",34,0)
 ;
"RTN","BIDUVLS2",35,0)
 ;---> Next section: Write specifed Additional Information in BINFO.
"RTN","BIDUVLS2",36,0)
 ;
"RTN","BIDUVLS2",37,0)
 ;--> Check if BINFO("ALL") exists.  If so, set BIALL=1 and display all Info.
"RTN","BIDUVLS2",38,0)
 N BIALL S BIALL=0
"RTN","BIDUVLS2",39,0)
 S:$D(BINFO("ALL")) BIALL=1
"RTN","BIDUVLS2",40,0)
 ;
"RTN","BIDUVLS2",41,0)
 ;---> First, build Data String, BINFODS, of Add Info elements (2nd piece of
"RTN","BIDUVLS2",42,0)
 ;---> BI TABLE ADD INFO File #9002084.82).
"RTN","BIDUVLS2",43,0)
 N BINFODS
"RTN","BIDUVLS2",44,0)
 D
"RTN","BIDUVLS2",45,0)
 .N N S N=0
"RTN","BIDUVLS2",46,0)
 .F  S N=$O(BINFO(N)) Q:'N  D
"RTN","BIDUVLS2",47,0)
 ..S BINFODS=$G(BINFODS)_$P($G(^BIADDIN(N,0)),U,2)_"^"
"RTN","BIDUVLS2",48,0)
 .S:'$G(BINFODS) BINFODS=0
"RTN","BIDUVLS2",49,0)
 ;
"RTN","BIDUVLS2",50,0)
 ;---> Forecast.
"RTN","BIDUVLS2",51,0)
 D:((BINFODS[15)!BIALL) WRITE(.BILINE),FORECAST(.BILINE,BIDFN,$G(BIFDT))
"RTN","BIDUVLS2",52,0)
 ;
"RTN","BIDUVLS2",53,0)
 ;---> Address.
"RTN","BIDUVLS2",54,0)
 D:((BINFODS[12)!BIALL)
"RTN","BIDUVLS2",55,0)
 .N X S X="Address..: "_$E($$STREET^BIUTL1(BIDFN),1,38)
"RTN","BIDUVLS2",56,0)
 .S BIPLIN1=BIPLIN1+1
"RTN","BIDUVLS2",57,0)
 .D APPEND(BIPLIN1,X,.BILINE)
"RTN","BIDUVLS2",58,0)
 .S X="           "_$$CTYSTZ^BIUTL1(BIDFN),BIPLIN1=BIPLIN1+1
"RTN","BIDUVLS2",59,0)
 .D APPEND(BIPLIN1,X,.BILINE)
"RTN","BIDUVLS2",60,0)
 ;
"RTN","BIDUVLS2",61,0)
 ;---> Phone Number.
"RTN","BIDUVLS2",62,0)
 D:((BINFODS[11)!BIALL)
"RTN","BIDUVLS2",63,0)
 .N X S X="Phone....: "_$$HPHONE^BIUTL1(BIDFN),BIPLIN1=BIPLIN1+1
"RTN","BIDUVLS2",64,0)
 .D APPEND(BIPLIN1,X,.BILINE)
"RTN","BIDUVLS2",65,0)
 ;
"RTN","BIDUVLS2",66,0)
 ;---> Parent/Guardian.
"RTN","BIDUVLS2",67,0)
 D:((BINFODS[17)!BIALL)
"RTN","BIDUVLS2",68,0)
 .N X S X="Parent...: "_$$PARENT^BIUTL1(BIDFN),BIPLIN1=BIPLIN1+1
"RTN","BIDUVLS2",69,0)
 .D APPEND(BIPLIN1,X,.BILINE)
"RTN","BIDUVLS2",70,0)
 ;
"RTN","BIDUVLS2",71,0)
 ;---> Case Manager.
"RTN","BIDUVLS2",72,0)
 D:((BINFODS[18)!BIALL)
"RTN","BIDUVLS2",73,0)
 .N X S X="Case Mgr.: "_$$CMGR^BIUTL1(BIDFN,1,1),BIPLIN1=BIPLIN1+1
"RTN","BIDUVLS2",74,0)
 .D APPEND(BIPLIN1,X,.BILINE)
"RTN","BIDUVLS2",75,0)
 ;
"RTN","BIDUVLS2",76,0)
 ;---> Reason Inactivated.
"RTN","BIDUVLS2",77,0)
 D:((BINFODS[19)!BIALL)
"RTN","BIDUVLS2",78,0)
 .Q:('$$INACT^BIUTL1(BIDFN))
"RTN","BIDUVLS2",79,0)
 .N X S X="Inactive.: "_$$INACTRE^BIUTL1(BIDFN),BIPLIN1=BIPLIN1+1
"RTN","BIDUVLS2",80,0)
 .D APPEND(BIPLIN1,X,.BILINE)
"RTN","BIDUVLS2",81,0)
 ;
"RTN","BIDUVLS2",82,0)
 ;---> Immunization History.
"RTN","BIDUVLS2",83,0)
 I (BINFODS[13)!(BINFODS[14)!(BINFODS[20)!(BINFODS[22)!(BINFODS[25)!BIALL D
"RTN","BIDUVLS2",84,0)
 .;---> Write either History or History w/Lot#'s, VFC, with or without Skin Tests.
"RTN","BIDUVLS2",85,0)
 .N X D
"RTN","BIDUVLS2",86,0)
 ..I (BINFODS[14)&(BINFODS'[25) S X=2 Q
"RTN","BIDUVLS2",87,0)
 ..I (BINFODS'[14)&(BINFODS[25) S X=5 Q
"RTN","BIDUVLS2",88,0)
 ..I (BINFODS[14)&(BINFODS[25) S X=7 Q
"RTN","BIDUVLS2",89,0)
 ..S X=1
"RTN","BIDUVLS2",90,0)
 .;
"RTN","BIDUVLS2",91,0)
 .;---> Include location where shot was given.
"RTN","BIDUVLS2",92,0)
 .N Y S Y=$S(BINFODS[22:1,1:0)
"RTN","BIDUVLS2",93,0)
 .N Z S Z=1
"RTN","BIDUVLS2",94,0)
 .D:(BINFODS[20)
"RTN","BIDUVLS2",95,0)
 ..I ((BINFODS'[13)&(BINFODS'[14)&(BINFODS'[25)) S Z=2 Q
"RTN","BIDUVLS2",96,0)
 ..S Z=0
"RTN","BIDUVLS2",97,0)
 .D WRITE(.BILINE),WRITE(.BILINE,"     History:")
"RTN","BIDUVLS2",98,0)
 .D HISTORY1^BILETPR1(.BILINE,BIDFN,X,,"BIDULV",,,Z,Y,.BIMMRF,.BIMMLF)
"RTN","BIDUVLS2",99,0)
 ;
"RTN","BIDUVLS2",100,0)
 ;
"RTN","BIDUVLS2",101,0)
 ;---> Refusals.
"RTN","BIDUVLS2",102,0)
 D:((BINFODS[23)!BIALL)
"RTN","BIDUVLS2",103,0)
 .N A,X1,X2,X3 S (X1,X2,X3)=""
"RTN","BIDUVLS2",104,0)
 .D CONTRA^BIUTL11(BIDFN,.A,1,1)
"RTN","BIDUVLS2",105,0)
 .Q:('$D(A))
"RTN","BIDUVLS2",106,0)
 .D WRITE(.BILINE)
"RTN","BIDUVLS2",107,0)
 .S X1="     Refusals: "
"RTN","BIDUVLS2",108,0)
 .N N,M S N=0,M=0
"RTN","BIDUVLS2",109,0)
 .F  S N=$O(A(N)) Q:'N  D
"RTN","BIDUVLS2",110,0)
 ..N X S M=M+1
"RTN","BIDUVLS2",111,0)
 ..S X=$$VNAME^BIUTL2($$HL7TX^BIUTL2(N))_" ("_$$SLDT2^BIUTL5($P(A(N),U,2),1)_")"
"RTN","BIDUVLS2",112,0)
 ..S:"235689"[M X=", "_X
"RTN","BIDUVLS2",113,0)
 ..I M<4 S X1=X1_X Q
"RTN","BIDUVLS2",114,0)
 ..I M<7 S:M=4 X2="               ",X1=X1_"," S X2=X2_X Q
"RTN","BIDUVLS2",115,0)
 ..S:M=7 X3="               ",X2=X2_"," S X3=X3_X Q
"RTN","BIDUVLS2",116,0)
 .I X1]"" D WRITE(.BILINE,X1)
"RTN","BIDUVLS2",117,0)
 .I X2]"" D WRITE(.BILINE,X2)
"RTN","BIDUVLS2",118,0)
 .I X3]"" D WRITE(.BILINE,X3)
"RTN","BIDUVLS2",119,0)
 ;
"RTN","BIDUVLS2",120,0)
 ;---> Next Appointment.
"RTN","BIDUVLS2",121,0)
 D:((BINFODS[21)!BIALL)
"RTN","BIDUVLS2",122,0)
 .;---> Write either Patient's Next Appointment if there is one.
"RTN","BIDUVLS2",123,0)
 .N X S X=$$NEXTAPPT^BIUTL11(BIDFN)
"RTN","BIDUVLS2",124,0)
 .D:X]""
"RTN","BIDUVLS2",125,0)
 ..S X="     Next Appointment: "_$E(X,1,57)
"RTN","BIDUVLS2",126,0)
 ..D WRITE(.BILINE),WRITE(.BILINE,X)
"RTN","BIDUVLS2",127,0)
 ;
"RTN","BIDUVLS2",128,0)
 ;---> Directions to House.
"RTN","BIDUVLS2",129,0)
 D:((BINFODS[16)!BIALL)
"RTN","BIDUVLS2",130,0)
 .Q:'$O(^AUPNPAT(BIDFN,12,0))
"RTN","BIDUVLS2",131,0)
 .D WRITE(.BILINE)
"RTN","BIDUVLS2",132,0)
 .N X S X="  Directions to the home of "_$$NAME^BIUTL1(BIDFN,1)_":"
"RTN","BIDUVLS2",133,0)
 .D WRITE(.BILINE,X)
"RTN","BIDUVLS2",134,0)
 .N N S N=0
"RTN","BIDUVLS2",135,0)
 .F  S N=$O(^AUPNPAT(BIDFN,12,N)) Q:'N  D
"RTN","BIDUVLS2",136,0)
 ..S X=$G(^AUPNPAT(BIDFN,12,N,0))
"RTN","BIDUVLS2",137,0)
 ..D WRITE(.BILINE,"  "_X)
"RTN","BIDUVLS2",138,0)
 ;
"RTN","BIDUVLS2",139,0)
 D:'$G(BIDASH) WRITE(.BILINE,"  "_$$SP^BIUTL5(73,"-"))
"RTN","BIDUVLS2",140,0)
 ;---> Mark the top line of this record with the total lines in it.
"RTN","BIDUVLS2",141,0)
 D MARK^BIW(BIPLIN,BILINE-BIPLIN,"BIDULV")
"RTN","BIDUVLS2",142,0)
 Q
"RTN","BIDUVLS2",143,0)
 ;
"RTN","BIDUVLS2",144,0)
 ;
"RTN","BIDUVLS2",145,0)
 ;----------
"RTN","BIDUVLS2",146,0)
FORECAST(BILINE,BIDFN,BIFDT) ;EP
"RTN","BIDUVLS2",147,0)
 ;---> Retrieve and store Imm Forecast in WP ^TMP global.
"RTN","BIDUVLS2",148,0)
 ;---> Parameters:
"RTN","BIDUVLS2",149,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BIDUVLS2",150,0)
 ;     3 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIDUVLS2",151,0)
 ;     4 - BIFDT  (opt) Forecast Date.
"RTN","BIDUVLS2",152,0)
 ;
"RTN","BIDUVLS2",153,0)
 Q:'$D(BILINE)  Q:'$G(BIDFN)
"RTN","BIDUVLS2",154,0)
 ;
"RTN","BIDUVLS2",155,0)
 ;---> If Patient is deceased, display date instead of forecast.
"RTN","BIDUVLS2",156,0)
 N X S X=$$DECEASED^BIUTL1(BIDFN,1)
"RTN","BIDUVLS2",157,0)
 I X D WRITE(.BILINE),WRITE(.BILINE,"     DECEASED: "_$$TXDT^BIUTL5(X)) Q
"RTN","BIDUVLS2",158,0)
 ;
"RTN","BIDUVLS2",159,0)
 ;---> If Forecast Date not provided, set it equal to today.
"RTN","BIDUVLS2",160,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIDUVLS2",161,0)
 ;
"RTN","BIDUVLS2",162,0)
 ;---> RPC to gather Immunization History.
"RTN","BIDUVLS2",163,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BIDUVLS2",164,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BIDUVLS2",165,0)
 ;
"RTN","BIDUVLS2",166,0)
 N BIRETVAL,BIRETERR S BIRETVAL=""
"RTN","BIDUVLS2",167,0)
 ;---> Next line: 4th param=1 to not call Immserve because forecast
"RTN","BIDUVLS2",168,0)
 ;---> just got updated in retrieving patients: +225^BIDUR.
"RTN","BIDUVLS2",169,0)
 D IMMFORC^BIRPC(.BIRETVAL,BIDFN,BIFDT,1)
"RTN","BIDUVLS2",170,0)
 ;
"RTN","BIDUVLS2",171,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BIDUVLS2",172,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIDUVLS2",173,0)
 I BIRETERR]"" D  Q
"RTN","BIDUVLS2",174,0)
 .D WRITE(.BILINE),WRITE(.BILINE,"     "_BIRETERR),WRITE(.BILINE)
"RTN","BIDUVLS2",175,0)
 ;
"RTN","BIDUVLS2",176,0)
 ;---> Set BIFDTORC=to the Immunization Forecast for this patient.
"RTN","BIDUVLS2",177,0)
 N BIFDTORC,I,V S V="|",BIFDTORC=$P(BIRETVAL,BI31,1)
"RTN","BIDUVLS2",178,0)
 ;
"RTN","BIDUVLS2",179,0)
 ;---> Loop through "^"-pieces of Imm Forecast, getting data.
"RTN","BIDUVLS2",180,0)
 F I=1:1 S Y=$P(BIFDTORC,U,I) Q:Y=""  D
"RTN","BIDUVLS2",181,0)
 .N X,Z S X=$S(I=1:"     Needs: ",1:"            ")
"RTN","BIDUVLS2",182,0)
 .;---> If the forecast for this vaccine contains an error,
"RTN","BIDUVLS2",183,0)
 .;---> write Vaccine Group Name Error, such as, $P("DTP ERROR:",":").
"RTN","BIDUVLS2",184,0)
 .S Z=$P(Y,V),Z=X_$P(Z,":")
"RTN","BIDUVLS2",185,0)
 .D WRITE(.BILINE,Z)
"RTN","BIDUVLS2",186,0)
 Q
"RTN","BIDUVLS2",187,0)
 ;
"RTN","BIDUVLS2",188,0)
 ;
"RTN","BIDUVLS2",189,0)
 ;----------
"RTN","BIDUVLS2",190,0)
WRITE(BILINE,BIVAL) ;EP
"RTN","BIDUVLS2",191,0)
 ;---> Write a line to the ^TMP global for WP or Listman.
"RTN","BIDUVLS2",192,0)
 ;---> Parameters:
"RTN","BIDUVLS2",193,0)
 ;     1 - BILINE (ret) Last line# in the WP ^TMP global.
"RTN","BIDUVLS2",194,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIDUVLS2",195,0)
 ;
"RTN","BIDUVLS2",196,0)
 Q:'$D(BILINE)
"RTN","BIDUVLS2",197,0)
 S:$G(BIVAL)="" BIVAL=" "
"RTN","BIDUVLS2",198,0)
 S BILINE=BILINE+1,^TMP("BIDULV",$J,BILINE,0)=BIVAL
"RTN","BIDUVLS2",199,0)
 Q
"RTN","BIDUVLS2",200,0)
 ;
"RTN","BIDUVLS2",201,0)
 ;
"RTN","BIDUVLS2",202,0)
 ;----------
"RTN","BIDUVLS2",203,0)
APPEND(BIPLIN1,BIVAL,BILINE) ;EP
"RTN","BIDUVLS2",204,0)
 ;---> Append BIVAL to existing line or create new line.
"RTN","BIDUVLS2",205,0)
 ;---> Parameters:
"RTN","BIDUVLS2",206,0)
 ;     1 - BIPLIN1 (ret) Line down from demog line to be added to.
"RTN","BIDUVLS2",207,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIDUVLS2",208,0)
 ;     3 - BILINE (ret) Last line# in the WP ^TMP global.
"RTN","BIDUVLS2",209,0)
 ;
"RTN","BIDUVLS2",210,0)
 Q:'$D(BILINE)
"RTN","BIDUVLS2",211,0)
 Q:$G(BIVAL)=""
"RTN","BIDUVLS2",212,0)
 ;
"RTN","BIDUVLS2",213,0)
 ;---> If line already exists, append to it.
"RTN","BIDUVLS2",214,0)
 N X
"RTN","BIDUVLS2",215,0)
 I $D(^TMP("BIDULV",$J,BIPLIN1,0)) S X=^(0) D  Q
"RTN","BIDUVLS2",216,0)
 .S X=$$PAD^BIUTL5(X,32)_BIVAL
"RTN","BIDUVLS2",217,0)
 .S ^TMP("BIDULV",$J,BIPLIN1,0)=X
"RTN","BIDUVLS2",218,0)
 ;
"RTN","BIDUVLS2",219,0)
 ;---> If line doesn't exist, create it.
"RTN","BIDUVLS2",220,0)
 D WRITE(.BILINE,$$SP^BIUTL5(32)_BIVAL)
"RTN","BIDUVLS2",221,0)
 Q
"RTN","BIDX")
0^20^B28657332
"RTN","BIDX",1,0)
BIDX ;IHS/CMI/MWR - RISK FOR FLU & PNEUMO, CHECK FOR DIAGNOSES.; MAY 10, 2010
"RTN","BIDX",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIDX",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDX",4,0)
 ;;  CHECK FOR DIAGNOSES IN A TAXONOMY RANGE, WITHIN A GIVE DATE RANGE.
"RTN","BIDX",5,0)
 ;;  FROM LORI BUTCHER, 9-18-05
"RTN","BIDX",6,0)
 ;;  PATCH 5: New code to check for Smoking Health Factors.   HFSMKR+23
"RTN","BIDX",7,0)
 ;;  PATCH 9: Changes to include Hep B Risk.  RISK+9, RISK+41
"RTN","BIDX",8,0)
 ;
"RTN","BIDX",9,0)
 ;
"RTN","BIDX",10,0)
 ;----------
"RTN","BIDX",11,0)
RISK(BIDFN,BIFDT,BIRSK,BIRISKI,BIRISKP,BIRISKH) ;EP Return High Risk Influenza & Pneumo.
"RTN","BIDX",12,0)
 ;---> Determine if this patient is in the Pneumo Risk Taxonomy.
"RTN","BIDX",13,0)
 ;---> Parameters:
"RTN","BIDX",14,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIDX",15,0)
 ;     2 - BIFDT   (opt) Forecast Date (date used for forecast).
"RTN","BIDX",16,0)
 ;     3 - BIRSK   (opt) Risk Parameter: 0=none, 1=Hep B only, 2=Pneumo only,
"RTN","BIDX",17,0)
 ;                       12=Hep B & Pneumo, 23=Pneumo only + Smoking, 123=all.
"RTN","BIDX",18,0)
 ;     4 - BIRISKI (ret) 1=Patient has Risk of Influenza; otherwise 0.
"RTN","BIDX",19,0)
 ;     5 - BIRISKP (ret) 1=Patient has Risk of Pneumo; otherwise 0.
"RTN","BIDX",20,0)
 ;     6 - BIRISKH (ret) 1=Patient has Risk of HEP B; otherwise 0.
"RTN","BIDX",21,0)
 ;
"RTN","BIDX",22,0)
 ;
"RTN","BIDX",23,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIDX",24,0)
 ;---> Seed new BIRISKH variable for Hep B risk.
"RTN","BIDX",25,0)
 S BIRISKI=0,BIRISKP=0,BIRISKH=0
"RTN","BIDX",26,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIDX",27,0)
 S BIRSK=+$G(BIRSK)
"RTN","BIDX",28,0)
 ;
"RTN","BIDX",29,0)
 Q:'$G(BIDFN)
"RTN","BIDX",30,0)
 S:'$G(BIFDT) BIFDT=$G(DT)
"RTN","BIDX",31,0)
 ;---> Patient age in years.
"RTN","BIDX",32,0)
 N BIAGEY S BIAGEY=$$AGE^BIUTL1(BIDFN,1,BIFDT)
"RTN","BIDX",33,0)
 ;
"RTN","BIDX",34,0)
 ;---> No High Risk computation under 19 years.
"RTN","BIDX",35,0)
 Q:(BIAGEY<19)
"RTN","BIDX",36,0)
 N Y
"RTN","BIDX",37,0)
 ;
"RTN","BIDX",38,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIDX",39,0)
 ;---> Comment out Flu code since all ages are forecast for Flu.
"RTN","BIDX",40,0)
 ;
"RTN","BIDX",41,0)
 ;---> Check Influenza Risk (2 Flu Dx's over 3-year range).
"RTN","BIDX",42,0)
 ;---> Flu now forecast for all.
"RTN","BIDX",43,0)
 ;D:('BIRSK!(BIRSK=1))
"RTN","BIDX",44,0)
 ;.Q:(BIAGEY>50)
"RTN","BIDX",45,0)
 ;.S Y=+$$HASDX(BIDFN,"BI HIGH RISK FLU",2,BIBEGDT,BIFDT)
"RTN","BIDX",46,0)
 ;.S:(Y>0) BIRISKI=1
"RTN","BIDX",47,0)
 ;
"RTN","BIDX",48,0)
 ;
"RTN","BIDX",49,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIDX",50,0)
 ;---> Check Hep B Risk (2 Diabetes Dx's from DOB to Forecast Date).
"RTN","BIDX",51,0)
 D:(BIRSK[1)
"RTN","BIDX",52,0)
 .Q:(BIAGEY>59)
"RTN","BIDX",53,0)
 .S Y=+$$V2DM(BIDFN,,BIFDT)
"RTN","BIDX",54,0)
 .S:Y BIRISKH=1
"RTN","BIDX",55,0)
 ;**********
"RTN","BIDX",56,0)
 ;
"RTN","BIDX",57,0)
 N BIBEGDT S BIBEGDT=$$FMADD^XLFDT(BIFDT,-(3*365))
"RTN","BIDX",58,0)
 ;
"RTN","BIDX",59,0)
 ;---> Check Pneumo Risk (2 Pneumo Dx's over 3-year range).
"RTN","BIDX",60,0)
 D:(BIRSK[2)
"RTN","BIDX",61,0)
 .Q:(BIAGEY>64)
"RTN","BIDX",62,0)
 .S Y=+$$HASDX(BIDFN,"BI HIGH RISK PNEUMO",2,BIBEGDT,BIFDT)
"RTN","BIDX",63,0)
 .I Y S BIRISKP=1 Q
"RTN","BIDX",64,0)
 .;
"RTN","BIDX",65,0)
 .;---> Quit if site parameter says don't include Smoking.
"RTN","BIDX",66,0)
 .Q:(BIRSK'[3)
"RTN","BIDX",67,0)
 .S Y=+$$HASDX(BIDFN,"BI HIGH RISK PNEUMO W/SMOKING",2,BIBEGDT,BIFDT)
"RTN","BIDX",68,0)
 .I Y S BIRISKP=1 Q
"RTN","BIDX",69,0)
 .;
"RTN","BIDX",70,0)
 .;---> Check for Smoking Health Factor in the last 2 years.
"RTN","BIDX",71,0)
 .S BIRISKP=$$HFSMKR(BIDFN,BIFDT)
"RTN","BIDX",72,0)
 ;
"RTN","BIDX",73,0)
 Q
"RTN","BIDX",74,0)
 ;
"RTN","BIDX",75,0)
 ;
"RTN","BIDX",76,0)
 ;----------
"RTN","BIDX",77,0)
HASDX(BIDFN,BITAX,BINUM,BIBD,BIED) ;EP
"RTN","BIDX",78,0)
 ;---> This call is made to determine if a patient (BIDFN) has had
"RTN","BIDX",79,0)
 ;---> BINUM number of diagnoses within taxonomy BITAX during the
"RTN","BIDX",80,0)
 ;---> time period BIBD to BIED.
"RTN","BIDX",81,0)
 ;---> Parameters:
"RTN","BIDX",82,0)
 ;     1 - BIDFN  (req) Patient DFN.
"RTN","BIDX",83,0)
 ;     2 - BITAX  (req) Name of the Taxonomy e.g. "BI HIGH RISK FLU"
"RTN","BIDX",84,0)
 ;     3 - BINUM  (req) The number of diagnoses the patient has to have had.
"RTN","BIDX",85,0)
 ;     4 - BIBD   (opt) Beginning date (earliest) date to search for diagnoses.
"RTN","BIDX",86,0)
 ;                      If null, use patient's DOB.
"RTN","BIDX",87,0)
 ;     5 - BIED   (opt) Date (latest) date to search for diagnoses.
"RTN","BIDX",88,0)
 ;                      If null, use DT.
"RTN","BIDX",89,0)
 ;
"RTN","BIDX",90,0)
 ;  Return values:  1 if patient has had the diagnoses
"RTN","BIDX",91,0)
 ;                  0 if patient has NOT had the diagnoses
"RTN","BIDX",92,0)
 ;                 -1^error message   if error occurred
"RTN","BIDX",93,0)
 ;
"RTN","BIDX",94,0)
 ;  Example:  to find if patient has had at least 2 diagnoses in past 3 years
"RTN","BIDX",95,0)
 ;           S X=$$HASDX^BIDX(40503,"BI HIGH RISK FLU",2,$$FMADD^XLFDT(DT,-(3*365)),DT)
"RTN","BIDX",96,0)
 ;           I X=1 Then yes they had the diagnoses, I X=0 then no they didn't
"RTN","BIDX",97,0)
 ;           to find if patient has ever had a diagnoses in the SURVEILLANCE DIABETES
"RTN","BIDX",98,0)
 ;           taxonomy:  S X=$$HASDX^BIDX(dfn,"SURVEILLANCE DIABETES",1)
"RTN","BIDX",99,0)
 ;
"RTN","BIDX",100,0)
 ;
"RTN","BIDX",101,0)
 I '$G(BIDFN) Q "-1^Patient DFN invalid"
"RTN","BIDX",102,0)
 ;
"RTN","BIDX",103,0)
 I $G(BIBD)="" S BIBD=$$DOB^AUPNPAT(BIDFN)
"RTN","BIDX",104,0)
 I $G(BIED)="" S BIED=DT
"RTN","BIDX",105,0)
 NEW BITAXI,BIIBD,BIIED,BISD,X,Y,I,P,R,C
"RTN","BIDX",106,0)
 S BITAXI=$O(^ATXAX("B",BITAX,0))
"RTN","BIDX",107,0)
 I 'BITAXI Q "-1^Invalid Taxonomy name"
"RTN","BIDX",108,0)
 S R=0  ;return value
"RTN","BIDX",109,0)
 S BIIBD=9999999-BIBD  ;inverse of beginning date
"RTN","BIDX",110,0)
 S BIIED=9999999-BIED  ;inverse of ending date
"RTN","BIDX",111,0)
 S BISD=BIIED-1  ;start one day later for $O
"RTN","BIDX",112,0)
 S C=0  ;counter for diagnoses
"RTN","BIDX",113,0)
 S X=0 F  S X=$O(^AUPNVPOV("AA",BIDFN,X)) Q:X=""!(X>BIIBD)!(C=BINUM)  D
"RTN","BIDX",114,0)
 .S Y=0 F  S Y=$O(^AUPNVPOV("AA",BIDFN,X,Y)) Q:Y'=+Y!(C=BINUM)  D
"RTN","BIDX",115,0)
 ..Q:'$D(^AUPNVPOV(Y,0))  ;bad xref
"RTN","BIDX",116,0)
 ..S P=$P($G(^AUPNVPOV(Y,0)),"^")
"RTN","BIDX",117,0)
 ..Q:P=""  ;bad entry
"RTN","BIDX",118,0)
 ..Q:'$$ICD^ATXCHK(P,BITAXI,9)  ;this diagnosis not in taxonomy
"RTN","BIDX",119,0)
 ..S C=C+1  ;update counter as diagnosis found
"RTN","BIDX",120,0)
 ..Q
"RTN","BIDX",121,0)
 .Q
"RTN","BIDX",122,0)
 I C<BINUM Q 0  ;patient did not meet the required # of diagnoses
"RTN","BIDX",123,0)
 Q 1
"RTN","BIDX",124,0)
 ;
"RTN","BIDX",125,0)
 ;
"RTN","BIDX",126,0)
 ;----------
"RTN","BIDX",127,0)
HFSMKR(BIDFN,BIFDT) ;EP
"RTN","BIDX",128,0)
 ;---> Return 1 if Patient has Last Health Factor in the TOBACCO category
"RTN","BIDX",129,0)
 ;---> with a date of <2 years.
"RTN","BIDX",130,0)
 ;---> Parameters:
"RTN","BIDX",131,0)
 ;     1 - BIDFN   (req) Patient's IEN (DFN).
"RTN","BIDX",132,0)
 ;     2 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIDX",133,0)
 ;
"RTN","BIDX",134,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIDX",135,0)
 ;---> New code to check for Smoking Health Factors.
"RTN","BIDX",136,0)
 ;
"RTN","BIDX",137,0)
 ;---> Return 0 if routine APCLAPIU is not in the namespace.
"RTN","BIDX",138,0)
 ;---> APCLAPIU is from ;;2.0;IHS PCC SUITE;**2,6**;MAY 14, 2009.
"RTN","BIDX",139,0)
 Q:('$L($T(^APCLAPIU))) 0
"RTN","BIDX",140,0)
 Q:'$G(BIDFN) 0
"RTN","BIDX",141,0)
 S:'$G(BIFDT) BIFDT=$G(DT)
"RTN","BIDX",142,0)
 ;
"RTN","BIDX",143,0)
 N Y S Y=$$LASTHF^APCLAPIU(BIDFN,"TOBACCO (SMOKING)",$$FMADD^XLFDT(BIFDT,-730),BIFDT)
"RTN","BIDX",144,0)
 ;---> If there's a hit it looks like this:
"RTN","BIDX",145,0)
 ;--->     3110815^HF: CURRENT SMOKER, SOME DAY^^2580^9000010.23^2, otherwise null.
"RTN","BIDX",146,0)
 ;---> So, if there's a leading date, then patient has an HF "TOBACCO (SMOKING)" Category.
"RTN","BIDX",147,0)
 ;---> Looking for these Health Factors:
"RTN","BIDX",148,0)
 ;
"RTN","BIDX",149,0)
 Q:(Y["CURRENT SMOKER, STATUS UNKNOWN") 1
"RTN","BIDX",150,0)
 Q:(Y["CURRENT SMOKER, EVERY DAY") 1
"RTN","BIDX",151,0)
 Q:(Y["CURRENT SMOKER, SOME DAY") 1
"RTN","BIDX",152,0)
 Q:(Y["CESSATION-SMOKER") 1
"RTN","BIDX",153,0)
 Q:(Y["HEAVY TOBACCO SMOKER") 1
"RTN","BIDX",154,0)
 Q:(Y["LIGHT TOBACCO SMOKER") 1
"RTN","BIDX",155,0)
 ;
"RTN","BIDX",156,0)
 ;---> Patient does NOT have a SMOKER Health Factor 2 years prior to the Forecast Date.
"RTN","BIDX",157,0)
 Q 0
"RTN","BIDX",158,0)
 ;**********
"RTN","BIDX",159,0)
 ;
"RTN","BIDX",160,0)
 ;
"RTN","BIDX",161,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIDX",162,0)
 ;---> New code from Lori Butcher to check for Diabetes (rtn: CIMZDMCK).
"RTN","BIDX",163,0)
V2DM(P,BDATE,EDATE) ;EP - are there 2 visits with DM?
"RTN","BIDX",164,0)
 ;P is Patient DFN
"RTN","BIDX",165,0)
 ;BDATE  - beginning date to look default is DOB
"RTN","BIDX",166,0)
 ;EDATE - end date to look default is DT
"RTN","BIDX",167,0)
 I '$G(P) Q ""
"RTN","BIDX",168,0)
 I '$D(^AUPNVSIT("AC",P)) Q ""  ;patient has no visits
"RTN","BIDX",169,0)
 I '$G(BDATE) S BDATE=$$DOB^AUPNPAT(P)
"RTN","BIDX",170,0)
 I '$G(EDATE) S EDATE=DT
"RTN","BIDX",171,0)
 NEW A,T,X,G,D,V
"RTN","BIDX",172,0)
 K ^TMP($J,"A")
"RTN","BIDX",173,0)
 S A="^TMP($J,""A"",",B=P_"^ALL VISITS;DURING "_$$FMTE^XLFDT(BDATE)_"-"_$$FMTE^XLFDT(EDATE),E=$$START1^APCLDF(B,A)
"RTN","BIDX",174,0)
 I '$D(^TMP($J,"A",1)) Q ""  ;no visits returned
"RTN","BIDX",175,0)
 S T=$O(^ATXAX("B","SURVEILLANCE DIABETES",0))
"RTN","BIDX",176,0)
 I 'T Q ""
"RTN","BIDX",177,0)
 S (X,G)=0 F  S X=$O(^TMP($J,"A",X)) Q:X'=+X!(G>2)  S V=$P(^TMP($J,"A",X),U,5) D
"RTN","BIDX",178,0)
 .Q:'$D(^AUPNVSIT(V,0))
"RTN","BIDX",179,0)
 .Q:'$P(^AUPNVSIT(V,0),U,9)  ;0 DEPENDENT ENTRIES
"RTN","BIDX",180,0)
 .Q:$P(^AUPNVSIT(V,0),U,11)  ;DELETED VISIT
"RTN","BIDX",181,0)
 .Q:"SAHOR"'[$P(^AUPNVSIT(V,0),U,7)  ;ELIMINATE TELEPHONE CALLS, CHART REVIEWS, ETC
"RTN","BIDX",182,0)
 .S (D,Y)=0 F  S Y=$O(^AUPNVPOV("AD",V,Y)) Q:Y'=+Y!(D)  I $D(^AUPNVPOV(Y,0)) S %=$P(^AUPNVPOV(Y,0),U) I $$ICD^ATXCHK(%,T,9) S D=1
"RTN","BIDX",183,0)
 .Q:'D
"RTN","BIDX",184,0)
 .S G=G+1
"RTN","BIDX",185,0)
 .Q
"RTN","BIDX",186,0)
 ;Q 1  ;for testing a positive hit on Diabetes.
"RTN","BIDX",187,0)
 Q $S(G<2:"",1:1)
"RTN","BIDX",188,0)
 ;**********
"RTN","BIDX",189,0)
 ;
"RTN","BIDX",190,0)
 ;----------
"RTN","BIDX",191,0)
TEST ;
"RTN","BIDX",192,0)
 S X=$$HASDX(40503,"SURVEILLANCE DIABETES",1,3050914,3050914)
"RTN","BIDX",193,0)
 W !,X
"RTN","BIDX",194,0)
 Q
"RTN","BIELIG")
0^21^B36958339
"RTN","BIELIG",1,0)
BIELIG ;IHS/CMI/MWR - EDIT ELIGIBILITY CODES.; MAY 10, 2010
"RTN","BIELIG",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIELIG",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIELIG",4,0)
 ;;  EDIT ELIGIBILITY FIELDS: ACTIVE, LOCAL TEXT, REPORT ABBREVIATION.
"RTN","BIELIG",5,0)
 ;;  PATCH 3: This entire routine to edit Eligibility Codes is new.
"RTN","BIELIG",6,0)
 ;
"RTN","BIELIG",7,0)
 ;
"RTN","BIELIG",8,0)
 ;----------
"RTN","BIELIG",9,0)
START ;EP
"RTN","BIELIG",10,0)
 ;---> Lookup Eligibility Codes and edit their fields.
"RTN","BIELIG",11,0)
 D SETVARS^BIUTL5 K ^TMP("BIELIG",$J) N BIELIG,BITMP
"RTN","BIELIG",12,0)
 D EN
"RTN","BIELIG",13,0)
 D EXIT
"RTN","BIELIG",14,0)
 Q
"RTN","BIELIG",15,0)
 ;
"RTN","BIELIG",16,0)
 ;
"RTN","BIELIG",17,0)
 ;----------
"RTN","BIELIG",18,0)
EN ;EP
"RTN","BIELIG",19,0)
 D EN^VALM("BI ELIGIBILITY TABLE EDIT")
"RTN","BIELIG",20,0)
 Q
"RTN","BIELIG",21,0)
 ;
"RTN","BIELIG",22,0)
 ;
"RTN","BIELIG",23,0)
 ;----------
"RTN","BIELIG",24,0)
PRINT ;EP
"RTN","BIELIG",25,0)
 ;---> Print Eligibility Table.
"RTN","BIELIG",26,0)
 ;---> Called by Protocol BI VACCINE TABLE PRINT, which is the
"RTN","BIELIG",27,0)
 ;---> Print List Protocol for the List: BI VACCINE TABLE EDIT.
"RTN","BIELIG",28,0)
 ;
"RTN","BIELIG",29,0)
 D DEVICE(.BIPOP)
"RTN","BIELIG",30,0)
 I $G(BIPOP) D RESET Q
"RTN","BIELIG",31,0)
 ;
"RTN","BIELIG",32,0)
 D HDR(1),INIT^BIELIG1
"RTN","BIELIG",33,0)
 D PRTLST^BIUTL8("BIELIG")
"RTN","BIELIG",34,0)
 D RESET
"RTN","BIELIG",35,0)
 Q
"RTN","BIELIG",36,0)
 ;
"RTN","BIELIG",37,0)
 ;
"RTN","BIELIG",38,0)
 ;----------
"RTN","BIELIG",39,0)
HDR(BIPRT) ;EP
"RTN","BIELIG",40,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BIELIG",41,0)
 ;---> Parameters:
"RTN","BIELIG",42,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Change column
"RTN","BIELIG",43,0)
 ;                      header line and add Site Header line.
"RTN","BIELIG",44,0)
 ;
"RTN","BIELIG",45,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BIELIG",46,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIELIG",47,0)
 ;
"RTN","BIELIG",48,0)
 D WH^BIW(.BILINE)
"RTN","BIELIG",49,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIELIG",50,0)
 D WH^BIW(.BILINE,X)
"RTN","BIELIG",51,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIELIG",52,0)
 D WH^BIW(.BILINE,X)
"RTN","BIELIG",53,0)
 ;
"RTN","BIELIG",54,0)
 S X="ELIGIBILITY CODE TABLE" S:'$G(BIPRT) X="EDIT "_X D CENTERT^BIUTL5(.X)
"RTN","BIELIG",55,0)
 S:BICRT X=IOINHI_X_IOINORM
"RTN","BIELIG",56,0)
 D WH^BIW(.BILINE,X)
"RTN","BIELIG",57,0)
 ;
"RTN","BIELIG",58,0)
 D:$G(BIPRT)
"RTN","BIELIG",59,0)
 .S X=$$SP^BIUTL5(51)_"Printed: "_$$NOW^BIUTL5()
"RTN","BIELIG",60,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BIELIG",61,0)
 .S X="    #  Eligibility Code      Label of Cdoe    Status     Local Text     Report Text"
"RTN","BIELIG",62,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIELIG",63,0)
 Q
"RTN","BIELIG",64,0)
 ;
"RTN","BIELIG",65,0)
 ;
"RTN","BIELIG",66,0)
 ;----------
"RTN","BIELIG",67,0)
INIT ;EP
"RTN","BIELIG",68,0)
 ;---> Initialize variables and list array.
"RTN","BIELIG",69,0)
 D INIT^BIELIG1
"RTN","BIELIG",70,0)
 Q
"RTN","BIELIG",71,0)
 ;
"RTN","BIELIG",72,0)
 ;
"RTN","BIELIG",73,0)
 ;----------
"RTN","BIELIG",74,0)
RESET ;EP
"RTN","BIELIG",75,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIELIG",76,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIELIG",77,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIELIG",78,0)
 D INIT,HDR() Q
"RTN","BIELIG",79,0)
 ;
"RTN","BIELIG",80,0)
 ;
"RTN","BIELIG",81,0)
 ;----------
"RTN","BIELIG",82,0)
DEVICE(BIPOP) ;EP
"RTN","BIELIG",83,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIELIG",84,0)
 ;---> Parameters:
"RTN","BIELIG",85,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIELIG",86,0)
 ;
"RTN","BIELIG",87,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIELIG",88,0)
 S ZTRTN="DEQUEUE^BIELIG"
"RTN","BIELIG",89,0)
 D ZSAVES^BIUTL3
"RTN","BIELIG",90,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIELIG",91,0)
 Q
"RTN","BIELIG",92,0)
 ;
"RTN","BIELIG",93,0)
 ;
"RTN","BIELIG",94,0)
 ;----------
"RTN","BIELIG",95,0)
DEQUEUE ;EP
"RTN","BIELIG",96,0)
 ;---> Print Patient Data screen.
"RTN","BIELIG",97,0)
 D HDR(1),INIT^BIELIG1
"RTN","BIELIG",98,0)
 D PRTLST^BIUTL8("BIELIG"),EXIT
"RTN","BIELIG",99,0)
 Q
"RTN","BIELIG",100,0)
 ;
"RTN","BIELIG",101,0)
 ;
"RTN","BIELIG",102,0)
 ;----------
"RTN","BIELIG",103,0)
HELP ;EP
"RTN","BIELIG",104,0)
 ;---> Help code.
"RTN","BIELIG",105,0)
 N BIX S BIX=X
"RTN","BIELIG",106,0)
 D FULL^VALM1
"RTN","BIELIG",107,0)
 W !!?5,"Enter ""E"" to edit a Eligibility Code, enter ""C"" to change the order of"
"RTN","BIELIG",108,0)
 W !?5,"the list, ""H"" to view the full help text for the Eligibility list and"
"RTN","BIELIG",109,0)
 W !?5,"its parameters, ""F"" to turn on/off the forecasting of vaccines"
"RTN","BIELIG",110,0)
 W !?5,"and enter ""P"" to print the list."
"RTN","BIELIG",111,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIELIG",112,0)
 D:BIX'="??" RE^VALM4
"RTN","BIELIG",113,0)
 Q
"RTN","BIELIG",114,0)
 ;
"RTN","BIELIG",115,0)
 ;
"RTN","BIELIG",116,0)
 ;----------
"RTN","BIELIG",117,0)
HELP1 ;EP
"RTN","BIELIG",118,0)
 ;----> Explanation of this report.
"RTN","BIELIG",119,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIELIG",120,0)
 D START^BIHELP("EDIT VACCINE TABLE - HELP",.BITEXT)
"RTN","BIELIG",121,0)
 Q
"RTN","BIELIG",122,0)
 ;
"RTN","BIELIG",123,0)
 ;
"RTN","BIELIG",124,0)
 ;----------
"RTN","BIELIG",125,0)
TEXT1(BITEXT) ;EP
"RTN","BIELIG",126,0)
 ;;
"RTN","BIELIG",127,0)
 ;;This screen allows you to edit 3 fields for each Eligibility Code.
"RTN","BIELIG",128,0)
 ;;To Edit a particular Code, type "E", then select the left
"RTN","BIELIG",129,0)
 ;;column number that corresponds to the Code you wish to edit.
"RTN","BIELIG",130,0)
 ;;
"RTN","BIELIG",131,0)
 ;;* Active/Inactive - If a Code is set to "Inactive", users will
"RTN","BIELIG",132,0)
 ;;     not be able to select this Elligibility Code when entering or
"RTN","BIELIG",133,0)
 ;;     editing immunizations. However, previous immunizations with
"RTN","BIELIG",134,0)
 ;;     Code will continue to display it.
"RTN","BIELIG",135,0)
 ;;
"RTN","BIELIG",136,0)
 ;;* Local Text - This is an optional, locally meaningful text that
"RTN","BIELIG",137,0)
 ;;     may be entered to help staff recognize Codes.  It may be the
"RTN","BIELIG",138,0)
 ;;     proper name of a local or State program, a regional or clinic
"RTN","BIELIG",139,0)
 ;;     name, or whatever is helpful.  It may be up to 20 characters
"RTN","BIELIG",140,0)
 ;;     in length. It is not exported, nor does it appear anywhere
"RTN","BIELIG",141,0)
 ;;     except during the Eligibility Code selection (along side the
"RTN","BIELIG",142,0)
 ;;     true Code) when immunizations are entered or edited.
"RTN","BIELIG",143,0)
 ;;
"RTN","BIELIG",144,0)
 ;;* Report Abbreviation - This is an optional, locally meaningful text
"RTN","BIELIG",145,0)
 ;;     that can be entered to help make information in the Eligibility
"RTN","BIELIG",146,0)
 ;;     Report more recognizable.  Text entered here will show up in
"RTN","BIELIG",147,0)
 ;;     the fourth column of the Vaccine Eligibility Report. (If no Report
"RTN","BIELIG",148,0)
 ;;     Abbreviation has been entered, then the standard Eligibility Code
"RTN","BIELIG",149,0)
 ;;     will appear in column four of the report.)
"RTN","BIELIG",150,0)
 ;;
"RTN","BIELIG",151,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIELIG",152,0)
 Q
"RTN","BIELIG",153,0)
 ;
"RTN","BIELIG",154,0)
 ;
"RTN","BIELIG",155,0)
 ;----------
"RTN","BIELIG",156,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIELIG",157,0)
 Q:$G(BILINL)=""
"RTN","BIELIG",158,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIELIG",159,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIELIG",160,0)
 Q
"RTN","BIELIG",161,0)
 ;
"RTN","BIELIG",162,0)
 ;
"RTN","BIELIG",163,0)
 ;----------
"RTN","BIELIG",164,0)
EXIT ;EP
"RTN","BIELIG",165,0)
 ;---> End of job cleanup.
"RTN","BIELIG",166,0)
 D KILLALL^BIUTL8()
"RTN","BIELIG",167,0)
 K ^TMP("BIELIG",$J)
"RTN","BIELIG",168,0)
 D CLEAR^VALM1
"RTN","BIELIG",169,0)
 D FULL^VALM1
"RTN","BIELIG",170,0)
 Q
"RTN","BIELIG",171,0)
 ;
"RTN","BIELIG",172,0)
 ;
"RTN","BIELIG",173,0)
 ;----------
"RTN","BIELIG",174,0)
ELIGC(IEN,FORM) ;EP
"RTN","BIELIG",175,0)
 ;---> Return Eligibility values from BI TABLE ELIGIBILITY CODES File.
"RTN","BIELIG",176,0)
 ;---> Parameters:
"RTN","BIELIG",177,0)
 ;     1 - IEN  (req) IEN of Elig Code.
"RTN","BIELIG",178,0)
 ;     2 - FORM (opt) FORM of Code to return:
"RTN","BIELIG",179,0)
 ;                        1=Actual Code (also default)
"RTN","BIELIG",180,0)
 ;                        2=Label Text of Code
"RTN","BIELIG",181,0)
 ;                        3=Active/Inactive Status (1
"RTN","BIELIG",182,0)
 ;                        4=Local Text
"RTN","BIELIG",183,0)
 ;                        5=Local Report Abbreviation
"RTN","BIELIG",184,0)
 ;
"RTN","BIELIG",185,0)
 Q:'$G(IEN) ""
"RTN","BIELIG",186,0)
 Q:'$D(^BIELIG(IEN,0)) "NO GLOBAL"
"RTN","BIELIG",187,0)
 N Y S Y=^BIELIG(IEN,0)
"RTN","BIELIG",188,0)
 ;
"RTN","BIELIG",189,0)
 Q:$G(FORM)=2 $P(Y,U,2)
"RTN","BIELIG",190,0)
 Q:$G(FORM)=3 $P(Y,U,3)
"RTN","BIELIG",191,0)
 Q:$G(FORM)=4 $P(Y,U,4)
"RTN","BIELIG",192,0)
 Q:$G(FORM)=5 $P(Y,U,5)
"RTN","BIELIG",193,0)
 Q:$G(FORM)=6 $S($P(Y,U,5)]"":$P(Y,U,5),1:$P(Y,U))
"RTN","BIELIG",194,0)
 Q $P(Y,U)
"RTN","BIELIG1")
0^22^B22465800
"RTN","BIELIG1",1,0)
BIELIG1 ;IHS/CMI/MWR - EDIT ELIGIBILITY CODES.; MAY 10, 2010
"RTN","BIELIG1",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIELIG1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIELIG1",4,0)
 ;;  EDIT ELIG CODE FIELDS: ACTIVE, LOCAL LABEL/TEXT, REPORT ABBREV.
"RTN","BIELIG1",5,0)
 ;;  PATCH 3: This entire routine to edit Eligibility Codes is new.
"RTN","BIELIG1",6,0)
 ;
"RTN","BIELIG1",7,0)
 ;
"RTN","BIELIG1",8,0)
 ;----------
"RTN","BIELIG1",9,0)
INIT ;EP
"RTN","BIELIG1",10,0)
 ;---> Initialize variables and list array.
"RTN","BIELIG1",11,0)
 ;
"RTN","BIELIG1",12,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BIELIG1",13,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIELIG1",14,0)
 ;
"RTN","BIELIG1",15,0)
 ;---> Build Listmanager array.
"RTN","BIELIG1",16,0)
 K ^TMP("BIELIG",$J),BIVAC
"RTN","BIELIG1",17,0)
 ;
"RTN","BIELIG1",18,0)
 N BILINE,BIENT,BIN,BIELIG1,I
"RTN","BIELIG1",19,0)
 S BILINE=0,BIENT=0,BIN=0
"RTN","BIELIG1",20,0)
 ;
"RTN","BIELIG1",21,0)
 ;---> Use this code for selection of xrefs or see rtn BILOT1 code.
"RTN","BIELIG1",22,0)
 ;D
"RTN","BIELIG1",23,0)
 ;.I '$D(BICVXD) S BIXREF="B" Q
"RTN","BIELIG1",24,0)
 ;.S BIXREF="C"
"RTN","BIELIG1",25,0)
 ;
"RTN","BIELIG1",26,0)
 N BIA
"RTN","BIELIG1",27,0)
 F BIA=0,1 D
"RTN","BIELIG1",28,0)
 .N BIN S BIN=0
"RTN","BIELIG1",29,0)
 .F  S BIN=$O(^BIELIG("AC",BIA,BIN)) Q:BIN=""  D
"RTN","BIELIG1",30,0)
 ..N BI0,BIIEN,X,Y
"RTN","BIELIG1",31,0)
 ..S BIIEN=$O(^BIELIG("AC",BIA,BIN,0))
"RTN","BIELIG1",32,0)
 ..Q:$D(BIELIG1(BIIEN))
"RTN","BIELIG1",33,0)
 ..S BIELIG1(BIIEN)="",BI0=^BIELIG(BIIEN,0)
"RTN","BIELIG1",34,0)
 ..;
"RTN","BIELIG1",35,0)
 ..;---> Set Item# and build Item# array=IEN of Vaccine.
"RTN","BIELIG1",36,0)
 ..S BIENT=BIENT+1,BIELIG(BIENT)=BIIEN
"RTN","BIELIG1",37,0)
 ..;
"RTN","BIELIG1",38,0)
 ..;---> Item#.
"RTN","BIELIG1",39,0)
 ..S X=" "_BIENT_$S(BIENT<10:"   ",BIENT<100:"  ",1:" ")
"RTN","BIELIG1",40,0)
 ..;
"RTN","BIELIG1",41,0)
 ..;---> Code.
"RTN","BIELIG1",42,0)
 ..S X=X_$P(BI0,U,1)
"RTN","BIELIG1",43,0)
 ..S X=$$PAD^BIUTL5(X,15,".")
"RTN","BIELIG1",44,0)
 ..;
"RTN","BIELIG1",45,0)
 ..;---> Label of Code.
"RTN","BIELIG1",46,0)
 ..S X=X_$E($P(BI0,U,2),1,21)
"RTN","BIELIG1",47,0)
 ..S X=$$PAD^BIUTL5(X,38,".")
"RTN","BIELIG1",48,0)
 ..;
"RTN","BIELIG1",49,0)
 ..;---> Active/Inactive.
"RTN","BIELIG1",50,0)
 ..S X=X_$S($P(BI0,U,3)=1:"Inactive",1:"Active")
"RTN","BIELIG1",51,0)
 ..S X=$$PAD^BIUTL5(X,48,".")
"RTN","BIELIG1",52,0)
 ..;
"RTN","BIELIG1",53,0)
 ..;---> Local Text.
"RTN","BIELIG1",54,0)
 ..S X=X_$E($P(BI0,U,4),1,20)
"RTN","BIELIG1",55,0)
 ..S X=$$PAD^BIUTL5(X,70,".")
"RTN","BIELIG1",56,0)
 ..;
"RTN","BIELIG1",57,0)
 ..;---> Forecast On/Off.
"RTN","BIELIG1",58,0)
 ..S X=X_$P(BI0,U,5)
"RTN","BIELIG1",59,0)
 ..;
"RTN","BIELIG1",60,0)
 ..;---> Set this Vaccine display row and index in ^TMP.
"RTN","BIELIG1",61,0)
 ..D WRITE(.BILINE,X,,BIENT)
"RTN","BIELIG1",62,0)
 ..;D WRITE(.BILINE,,,BIENT)
"RTN","BIELIG1",63,0)
 ;
"RTN","BIELIG1",64,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIELIG1",65,0)
 S VALMCNT=BILINE
"RTN","BIELIG1",66,0)
 I VALMCNT>12 D
"RTN","BIELIG1",67,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIELIG1",68,0)
 Q
"RTN","BIELIG1",69,0)
 ;
"RTN","BIELIG1",70,0)
 ;
"RTN","BIELIG1",71,0)
 ;----------
"RTN","BIELIG1",72,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIELIG1",73,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIELIG1",74,0)
 ;---> Parameters:
"RTN","BIELIG1",75,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIELIG1",76,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIELIG1",77,0)
 ;
"RTN","BIELIG1",78,0)
 Q:'$D(BILINE)
"RTN","BIELIG1",79,0)
 D WL^BIW(.BILINE,"BIELIG",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BIELIG1",80,0)
 Q
"RTN","BIELIG1",81,0)
 ;
"RTN","BIELIG1",82,0)
 ;
"RTN","BIELIG1",83,0)
 ;----------
"RTN","BIELIG1",84,0)
EDIT ;EP
"RTN","BIELIG1",85,0)
 ;---> Edit an Eligibility Code.
"RTN","BIELIG1",86,0)
 ;---> Called by Protocol: BI ELIGIBILITY CODE EDIT.
"RTN","BIELIG1",87,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BIELIG1",88,0)
 N VALMY
"RTN","BIELIG1",89,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIELIG1",90,0)
 ;
"RTN","BIELIG1",91,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIELIG1",92,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIELIG1",93,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BIELIG1",94,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIELIG1",95,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIELIG1",96,0)
 I $G(BIELIG(Y))="" D ERRCD^BIUTL2(514,,1) D RESET Q
"RTN","BIELIG1",97,0)
 N BIDA S BIDA=+BIELIG(Y)
"RTN","BIELIG1",98,0)
 I $G(^BIELIG(BIDA,0))="" D ERRCD^BIUTL2(514,,1) D RESET Q
"RTN","BIELIG1",99,0)
 ;---> Use next line and called code if you want to use Screenman.
"RTN","BIELIG1",100,0)
 ;D EDITSCR(BIDA)
"RTN","BIELIG1",101,0)
 D EDITFM(BIDA)
"RTN","BIELIG1",102,0)
 D FULL^VALM1
"RTN","BIELIG1",103,0)
 D RESET
"RTN","BIELIG1",104,0)
 Q
"RTN","BIELIG1",105,0)
 ;
"RTN","BIELIG1",106,0)
 ;
"RTN","BIELIG1",107,0)
 ;----------
"RTN","BIELIG1",108,0)
EDITFM(BIELIG) ;EP
"RTN","BIELIG1",109,0)
 ;---> Edit the fields of am Eligibility Code by Fileman.
"RTN","BIELIG1",110,0)
 ;---> Parameters:
"RTN","BIELIG1",111,0)
 ;     1 - BIELIG (req) Eligibility Code IEN.
"RTN","BIELIG1",112,0)
 ;
"RTN","BIELIG1",113,0)
 ;---> Check that IEN of Elig Code is present.
"RTN","BIELIG1",114,0)
 I '$G(BIELIG) D ERRCD^BIUTL2(514,,1) Q
"RTN","BIELIG1",115,0)
 N Y S Y=^BIELIG(BIELIG,0)
"RTN","BIELIG1",116,0)
 D TITLE^BIUTL5("EDIT ELIGIBILITY CODE")
"RTN","BIELIG1",117,0)
 W !?5,"          Elig Code: ",$P(Y,U)
"RTN","BIELIG1",118,0)
 W !?5,"    Code Label/Text: ",$P(Y,U,2)
"RTN","BIELIG1",119,0)
 W !?5,"      Active Status: ",$S($P(Y,U,3):"Inactive",1:"Active")
"RTN","BIELIG1",120,0)
 W !?5,"         Local Text: ",$P(Y,U,4)
"RTN","BIELIG1",121,0)
 W !?5,"Report Abbreviation: ",$P(Y,U,5),!!!
"RTN","BIELIG1",122,0)
 ;
"RTN","BIELIG1",123,0)
 S DR=".03;.04;.05"
"RTN","BIELIG1",124,0)
 D DIE^BIFMAN(9002084.83,DR,+BIELIG,.BIPOP)
"RTN","BIELIG1",125,0)
 Q
"RTN","BIELIG1",126,0)
 ;
"RTN","BIELIG1",127,0)
 ;
"RTN","BIELIG1",128,0)
 ;----------
"RTN","BIELIG1",129,0)
EDITSCR(BIVAC) ;EP
"RTN","BIELIG1",130,0)
 ;---> Edit the fields of a vaccine.
"RTN","BIELIG1",131,0)
 ;---> Parameters:
"RTN","BIELIG1",132,0)
 ;     1 - BIVAC (req) Vaccine IEN.
"RTN","BIELIG1",133,0)
 ;
"RTN","BIELIG1",134,0)
 ;---> Check that IEN of vaccine is present.
"RTN","BIELIG1",135,0)
 I '$G(BIVAC) D ERRCD^BIUTL2(441,,1) Q
"RTN","BIELIG1",136,0)
 N Y S Y=^BIELIG(BIVAC,0)
"RTN","BIELIG1",137,0)
 N BI
"RTN","BIELIG1",138,0)
 S BI("A")=$P(Y,U,4)      ;Default Lot Number IEN.
"RTN","BIELIG1",139,0)
 S BI("B")=$P(Y,U,7)      ;Active/Inactive.
"RTN","BIELIG1",140,0)
 S BI("C")=$P(Y,U,13)     ;VIS Default Date.
"RTN","BIELIG1",141,0)
 S BI("D")=$P(Y,U,18)     ;Default Volume.
"RTN","BIELIG1",142,0)
 ;
"RTN","BIELIG1",143,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIELIG1",144,0)
 N BISAVE
"RTN","BIELIG1",145,0)
 N DR S DR="[BI FORM-VACCINE EDIT]"
"RTN","BIELIG1",146,0)
 D DDS^BIFMAN(9999999.14,DR,BIVAC,"S",.BISAVE,.BIPOP)
"RTN","BIELIG1",147,0)
 ;
"RTN","BIELIG1",148,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIELIG1",149,0)
 Q:('$G(BISAVE))
"RTN","BIELIG1",150,0)
 ;
"RTN","BIELIG1",151,0)
 ;---> Update data for this vaccine.  (Make this an RPC in the future?)
"RTN","BIELIG1",152,0)
 ;---> Add contraindication with a reason of Immune Deficiency.
"RTN","BIELIG1",153,0)
 N BIERR,BIFLD
"RTN","BIELIG1",154,0)
 S BIFLD(.04)=BI("A"),BIFLD(.07)=BI("B")
"RTN","BIELIG1",155,0)
 S BIFLD(.13)=BI("C"),BIFLD(.18)=BI("D")
"RTN","BIELIG1",156,0)
 D FDIE^BIFMAN(9999999.14,BIVAC,.BIFLD,.BIERR)
"RTN","BIELIG1",157,0)
 ;
"RTN","BIELIG1",158,0)
 ;---> If there was an error, display it.
"RTN","BIELIG1",159,0)
 D:$G(BIERR)]""
"RTN","BIELIG1",160,0)
 .D CLEAR^VALM1,FULL^VALM1,TITLE^BIUTL5("EDIT VACCINE FIELDS")
"RTN","BIELIG1",161,0)
 .W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BIELIG1",162,0)
 ;
"RTN","BIELIG1",163,0)
 Q
"RTN","BIELIG1",164,0)
 ;
"RTN","BIELIG1",165,0)
 ;
"RTN","BIELIG1",166,0)
 ;----------
"RTN","BIELIG1",167,0)
LOADVAC ;EP
"RTN","BIELIG1",168,0)
 ;---> Code to load Vaccine data for ScreenMan Edit form.
"RTN","BIELIG1",169,0)
 ;---> Called by Pre Action of Block BI BLK-VACCINE EDIT on
"RTN","BIELIG1",170,0)
 ;---> Form BI FORM-VACCINE EDIT.
"RTN","BIELIG1",171,0)
 ;
"RTN","BIELIG1",172,0)
 ;---> Load Parent/Guardian.
"RTN","BIELIG1",173,0)
 I $G(BI("A"))]"" D PUT^DDSVALF(1,,,BI("A"),"I")
"RTN","BIELIG1",174,0)
 ;
"RTN","BIELIG1",175,0)
 ;---> Load Active status.
"RTN","BIELIG1",176,0)
 I $G(BI("B"))]"" D PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BIELIG1",177,0)
 ;
"RTN","BIELIG1",178,0)
 ;---> Load VIS Default Date.
"RTN","BIELIG1",179,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(3,,,BI("C"),"I")
"RTN","BIELIG1",180,0)
 ;
"RTN","BIELIG1",181,0)
 ;---> Load Mother's HBsAG Status.
"RTN","BIELIG1",182,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(4,,,BI("D"),"I")
"RTN","BIELIG1",183,0)
 ;
"RTN","BIELIG1",184,0)
 Q
"RTN","BIELIG1",185,0)
 ;
"RTN","BIELIG1",186,0)
 ;
"RTN","BIELIG1",187,0)
 ;----------
"RTN","BIELIG1",188,0)
RESET ;EP
"RTN","BIELIG1",189,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIELIG1",190,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIELIG1",191,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIELIG1",192,0)
 D INIT^BIELIG,HDR^BIELIG()
"RTN","BIELIG1",193,0)
 Q
"RTN","BIELIG1",194,0)
 ;
"RTN","BIELIG1",195,0)
 ;
"RTN","BIELIG1",196,0)
 ;----------
"RTN","BIELIG1",197,0)
CHGORDR ;EP
"RTN","BIELIG1",198,0)
 ;---> Change order of display of Vaccine Table (by Short Name or CVX).
"RTN","BIELIG1",199,0)
 D
"RTN","BIELIG1",200,0)
 .I '$D(BICVXD) S BICVXD="" Q
"RTN","BIELIG1",201,0)
 .K BICVXD
"RTN","BIELIG1",202,0)
 D RESET
"RTN","BIELIG1",203,0)
 Q
"RTN","BIELIG3")
0^23^B29251780
"RTN","BIELIG3",1,0)
BIELIG3 ;IHS/CMI/MWR - SCAN TO REMOVE VFC FOR IMMS WITH PATS>19YRS; APR 15, 2012
"RTN","BIELIG3",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIELIG3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIELIG3",4,0)
 ;;  SCAN PATIENT DATABASE FOR PATIENTS <36 MTHS NOT IN IMM DB.
"RTN","BIELIG3",5,0)
 ;   PATCH 2: This is a completely new routine to scan for and correct any
"RTN","BIELIG3",6,0)
 ;            immunization visits in which the patient was 19yrs or older
"RTN","BIELIG3",7,0)
 ;            and erroneously marked as VFC Eligible at the time of the visit.
"RTN","BIELIG3",8,0)
 ;
"RTN","BIELIG3",9,0)
 ;   PATCH 3: Scan for any V Imms with a .14 Eligibility=0, change to 8,
"RTN","BIELIG3",10,0)
 ;            which is the IEN of "Unknown" in the new BI TABLE ELIG File.
"RTN","BIELIG3",11,0)
 ;            Null values will be left null.                       SCAN+43
"RTN","BIELIG3",12,0)
 ;
"RTN","BIELIG3",13,0)
 ;----------
"RTN","BIELIG3",14,0)
START ;EP
"RTN","BIELIG3",15,0)
 ;---> Scan for patients in ^AUPNPAT <36 mths not in Imm database ^BIP.
"RTN","BIELIG3",16,0)
 ;
"RTN","BIELIG3",17,0)
 D SETVARS^BIUTL5
"RTN","BIELIG3",18,0)
 D
"RTN","BIELIG3",19,0)
 .;D PROMPT(.BIPOP)
"RTN","BIELIG3",20,0)
 .;Q:BIPOP
"RTN","BIELIG3",21,0)
 .D SCAN
"RTN","BIELIG3",22,0)
 D EXIT(BIPOP)
"RTN","BIELIG3",23,0)
 Q
"RTN","BIELIG3",24,0)
 ;
"RTN","BIELIG3",25,0)
 ;
"RTN","BIELIG3",26,0)
 ;----------
"RTN","BIELIG3",27,0)
PROMPT(BIPOP) ;EP
"RTN","BIELIG3",28,0)
 ;---> Describe conversion.
"RTN","BIELIG3",29,0)
 ;     1 - BIPOP (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BIELIG3",30,0)
 ;
"RTN","BIELIG3",31,0)
 N Z S Z="",BIPOP=0,Z="YES"
"RTN","BIELIG3",32,0)
 D TITLE,TEXT1
"RTN","BIELIG3",33,0)
 W ! D DIRZ^BIUTL3(.BIPOP) Q:BIPOP
"RTN","BIELIG3",34,0)
 Q
"RTN","BIELIG3",35,0)
 ;
"RTN","BIELIG3",36,0)
 ;
"RTN","BIELIG3",37,0)
 ;----------
"RTN","BIELIG3",38,0)
SCAN ;EP
"RTN","BIELIG3",39,0)
 ;---> Scan V Imm file of VFC Eligibility inappropriate age.
"RTN","BIELIG3",40,0)
 ;
"RTN","BIELIG3",41,0)
 N BICOUNT,BIERR,BIFACT,BIX,BIY,N
"RTN","BIELIG3",42,0)
 ;
"RTN","BIELIG3",43,0)
 ;---> Check for DUZ(2).
"RTN","BIELIG3",44,0)
 I '$G(DUZ(2)) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIELIG3",45,0)
 ;
"RTN","BIELIG3",46,0)
 W !!?12,"Please hold..."
"RTN","BIELIG3",47,0)
 ;
"RTN","BIELIG3",48,0)
 ;---> Get total number of visits to be checked (for progress bar below).
"RTN","BIELIG3",49,0)
 S BIFACT=1
"RTN","BIELIG3",50,0)
 S N=3080901 F  S N=$O(^AUPNVIMM("ADT",N)) Q:'N  D
"RTN","BIELIG3",51,0)
 .N M S M=0 F  S M=$O(^AUPNVIMM("ADT",N,M)) Q:'M  D
"RTN","BIELIG3",52,0)
 ..N P S P=0 F  S P=$O(^AUPNVIMM("ADT",N,M,P)) Q:'P  S BIFACT=BIFACT+1
"RTN","BIELIG3",53,0)
 ;
"RTN","BIELIG3",54,0)
 S:BIFACT<1 BIFACT=1 S BIFACT=BIFACT\50
"RTN","BIELIG3",55,0)
 S (BIPOP,BIX,BIY)=0
"RTN","BIELIG3",56,0)
 ;
"RTN","BIELIG3",57,0)
 D TITLE
"RTN","BIELIG3",58,0)
 W !!?12,"Repointing visits with Eligibility Unknown to new table..."
"RTN","BIELIG3",59,0)
 W !!?12,"0%---10---20---30---40---50---60---70---80---90---100%"
"RTN","BIELIG3",60,0)
 W !?12,"|"
"RTN","BIELIG3",61,0)
 ;
"RTN","BIELIG3",62,0)
 ;
"RTN","BIELIG3",63,0)
 ;---> Loop through the V Imm global, looking for VFC=Am Indian/AK Native
"RTN","BIELIG3",64,0)
 ;---> inappropriate for age (19yrs or greater) at time of visit.
"RTN","BIELIG3",65,0)
 ;
"RTN","BIELIG3",66,0)
 ;                  date  visit vimm ien
"RTN","BIELIG3",67,0)
 ;^AUPNVIMM("ADT",3071110,2102,2300)=""
"RTN","BIELIG3",68,0)
 ;
"RTN","BIELIG3",69,0)
 ;                   vac dfn visit       vfc(pc14)
"RTN","BIELIG3",70,0)
 ;^AUPNVIMM(2300,0)="133^6^2102^^^^^^^^^^^"
"RTN","BIELIG3",71,0)
 ;
"RTN","BIELIG3",72,0)
 ;^AUPNVSIT(2102,0)="3071110.12^3080508^I^^6^1665^E^^8^^^^3080508^
"RTN","BIELIG3",73,0)
 ;
"RTN","BIELIG3",74,0)
 S N=3080901,BICOUNT=0
"RTN","BIELIG3",75,0)
 F  S N=$O(^AUPNVIMM("ADT",N)) Q:'N  D
"RTN","BIELIG3",76,0)
 .N M S M=0 F  S M=$O(^AUPNVIMM("ADT",N,M)) Q:'M  D
"RTN","BIELIG3",77,0)
 ..N P S P=0 F  S P=$O(^AUPNVIMM("ADT",N,M,P)) Q:'P  D
"RTN","BIELIG3",78,0)
 ...S BIX=BIX+1 I BIFACT,'(BIX#BIFACT)&(BIY<51) W "=" S BIY=BIY+1
"RTN","BIELIG3",79,0)
 ...N BI0 S BI0=$G(^AUPNVIMM(P,0))
"RTN","BIELIG3",80,0)
 ...Q:(BI0="")
"RTN","BIELIG3",81,0)
 ...;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIELIG3",82,0)
 ...;---> Repointing visits with Eligibility Unknown to new table.
"RTN","BIELIG3",83,0)
 ...I $P(BI0,U,14)=0 S $P(^AUPNVIMM(P,0),U,14)=8
"RTN","BIELIG3",84,0)
 ...Q
"RTN","BIELIG3",85,0)
 ...;**********
"RTN","BIELIG3",86,0)
 ...;
"RTN","BIELIG3",87,0)
 ...;
"RTN","BIELIG3",88,0)
 ...;---> Quit if Elig Code is not Am In/AK Na.
"RTN","BIELIG3",89,0)
 ...;Q:($P(BI0,U,14)'=4)
"RTN","BIELIG3",90,0)
 ...;N BIDATE,BIDFN S BIDATE=N,BIDFN=$P(BI0,U,2)
"RTN","BIELIG3",91,0)
 ...;---> Quit if age on date of visit was less than 19yrs.
"RTN","BIELIG3",92,0)
 ...;Q:($$AGE^BIUTL1(BIDFN,1,BIDATE)<19)
"RTN","BIELIG3",93,0)
 ...;---> Okay, patient was 19yrs or greater and had Elig Code=4, so set
"RTN","BIELIG3",94,0)
 ...;---> piece 14="" and update BICOUNT.
"RTN","BIELIG3",95,0)
 ...;S $P(^AUPNVIMM(P,0),U,14)="",BICOUNT=BICOUNT+1
"RTN","BIELIG3",96,0)
 ;
"RTN","BIELIG3",97,0)
 N BII F BII=1:1:50-BIY W "="
"RTN","BIELIG3",98,0)
 W "|",!?33,"Complete"
"RTN","BIELIG3",99,0)
 ;W !!?12,"Immunization visits corrected for VFC Eligibility: ",BICOUNT
"RTN","BIELIG3",100,0)
 ;W !!!!!! D DIRZ^BIUTL3(.BIPOP) Q:BIPOP
"RTN","BIELIG3",101,0)
 W !!!!!! D DIRZ^BIUTL3()
"RTN","BIELIG3",102,0)
 ;
"RTN","BIELIG3",103,0)
 Q
"RTN","BIELIG3",104,0)
 ;
"RTN","BIELIG3",105,0)
 ;
"RTN","BIELIG3",106,0)
 ;----------
"RTN","BIELIG3",107,0)
CHGPTR(BICHG) ;EP
"RTN","BIELIG3",108,0)
 ;---> Change all records with one vaccine pointer to a different one.
"RTN","BIELIG3",109,0)
 ;---> Parameters:
"RTN","BIELIG3",110,0)
 ;     1 - BICHG   (opt) IF BICHG=1 then change entries from 214 to 235.
"RTN","BIELIG3",111,0)
 ;
"RTN","BIELIG3",112,0)
 D SETVARS^BIUTL5
"RTN","BIELIG3",113,0)
 D KGBL^BIUTL8("^MIKE") S ^MIKE(0)=^AUPNVIMM(0)
"RTN","BIELIG3",114,0)
 N BICOUNT,BIECOUNT,BIN S BIN=0,BICOUNT=0,BIECOUNT=0
"RTN","BIELIG3",115,0)
 F  S BIN=$O(^AUPNVIMM(BIN)) Q:'BIN  D
"RTN","BIELIG3",116,0)
 .N BIERR S BIERR=0
"RTN","BIELIG3",117,0)
 .Q:($P(^AUPNVIMM(BIN,0),U)'=214)
"RTN","BIELIG3",118,0)
 .S BICOUNT=BICOUNT+1
"RTN","BIELIG3",119,0)
 .Q:('$G(BICHG))
"RTN","BIELIG3",120,0)
 .S ^MIKE(BIN,0)=^AUPNVIMM(BIN,0)
"RTN","BIELIG3",121,0)
 .;
"RTN","BIELIG3",122,0)
 .;---> Change .01 pointer to VAccine Table.
"RTN","BIELIG3",123,0)
 .N BIFLD S BIFLD(.01)=235
"RTN","BIELIG3",124,0)
 .D FDIE^BIFMAN(9000010.11,BIN,.BIFLD,.BIERR)
"RTN","BIELIG3",125,0)
 .I BIERR=1 S BIECOUNT=BIECOUNT+1,^MIKE("ERR",N)=""  Q
"RTN","BIELIG3",126,0)
 ;
"RTN","BIELIG3",127,0)
 W !!,"COUNT: ",BICOUNT
"RTN","BIELIG3",128,0)
 W !,"ERRORS: ",BIECOUNT
"RTN","BIELIG3",129,0)
 Q
"RTN","BIELIG3",130,0)
 ;
"RTN","BIELIG3",131,0)
 ;
"RTN","BIELIG3",132,0)
 ;----------
"RTN","BIELIG3",133,0)
TEXT1 ;EP
"RTN","BIELIG3",134,0)
 ;;
"RTN","BIELIG3",135,0)
 ;;This program will scan the immunizations recorded in RPMS from
"RTN","BIELIG3",136,0)
 ;;September 2008 to the present for any VFC Eligibility Codes that
"RTN","BIELIG3",137,0)
 ;;would have been inappropriate for the patient's age on the day of
"RTN","BIELIG3",138,0)
 ;;the immunization visit.
"RTN","BIELIG3",139,0)
 ;;
"RTN","BIELIG3",140,0)
 ;;For any given immunization visit, if the patient was 19 years of age
"RTN","BIELIG3",141,0)
 ;;or older and incorrectly recorded as VFC Eligible (American Indian or
"RTN","BIELIG3",142,0)
 ;;Alaska Native), the Eligibility code for that visit will be permanently
"RTN","BIELIG3",143,0)
 ;;removed.  All other data will remain unchanged.
"RTN","BIELIG3",144,0)
 ;;
"RTN","BIELIG3",145,0)
 ;;This will prevent such visits from causing problems in future reports
"RTN","BIELIG3",146,0)
 ;;and exports to state registries.
"RTN","BIELIG3",147,0)
 ;;
"RTN","BIELIG3",148,0)
 ;;NO other data or immunizations visits are changed by this process.
"RTN","BIELIG3",149,0)
 ;;
"RTN","BIELIG3",150,0)
 D PRINTX("TEXT1",5)
"RTN","BIELIG3",151,0)
 Q
"RTN","BIELIG3",152,0)
 ;
"RTN","BIELIG3",153,0)
 ;
"RTN","BIELIG3",154,0)
 ;----------
"RTN","BIELIG3",155,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIELIG3",156,0)
 Q:$G(BILINL)=""
"RTN","BIELIG3",157,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIELIG3",158,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIELIG3",159,0)
 Q
"RTN","BIELIG3",160,0)
 ;
"RTN","BIELIG3",161,0)
 ;
"RTN","BIELIG3",162,0)
 ;----------
"RTN","BIELIG3",163,0)
EXIT(BIPOP) ;EP
"RTN","BIELIG3",164,0)
 ;---> EOJ Cleanup.
"RTN","BIELIG3",165,0)
 ;---> Parameters:
"RTN","BIELIG3",166,0)
 ;     1 - BIPOP   (opt) BIPOP=1 if DTOUT or DUOUT
"RTN","BIELIG3",167,0)
 ;
"RTN","BIELIG3",168,0)
 D:$G(BIPOP)
"RTN","BIELIG3",169,0)
 .W !!?5,"* SCAN ABORTED. *" D DIRZ^BIUTL3()
"RTN","BIELIG3",170,0)
 N BIPOP
"RTN","BIELIG3",171,0)
 D KILLALL^BIUTL8(1)
"RTN","BIELIG3",172,0)
 Q
"RTN","BIELIG3",173,0)
 ;
"RTN","BIELIG3",174,0)
 ;
"RTN","BIELIG3",175,0)
 ;----------
"RTN","BIELIG3",176,0)
TITLE ;EP
"RTN","BIELIG3",177,0)
 D TITLE^BIUTL5("UPDATING VISITS WITH ELIGIBILITY UNKNOWN")
"RTN","BIELIG3",178,0)
 Q
"RTN","BIENVCHK")
0^24^B18321502
"RTN","BIENVCHK",1,0)
BIENVCHK ;IHS/CMI/MWR - ENVIRONMENTAL CHECK FOR KIDS; DEC 15, 2010
"RTN","BIENVCHK",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIENVCHK",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIENVCHK",4,0)
 ;;  ENVIRONMENTAL CHECK ROUTINE FOR KIDS INSTALLATION.
"RTN","BIENVCHK",5,0)
 ;;  PATCH 9, v8.5: Check environment for IHS PCC REPORTS v3.0 patch 29.  START+56
"RTN","BIENVCHK",6,0)
 ;;                 Check environment for Imm v8.5 Patch 8.  START+63
"RTN","BIENVCHK",7,0)
 ;
"RTN","BIENVCHK",8,0)
 ;
"RTN","BIENVCHK",9,0)
 ;----------
"RTN","BIENVCHK",10,0)
START ;EP
"RTN","BIENVCHK",11,0)
 ;
"RTN","BIENVCHK",12,0)
 I '$G(DUZ) W !,"DUZ UNDEFINED OR 0." D SORRY(2) Q
"RTN","BIENVCHK",13,0)
 ;
"RTN","BIENVCHK",14,0)
 I '$L($G(DUZ(0))) W !,"DUZ(0) UNDEFINED OR NULL." D SORRY(2) Q
"RTN","BIENVCHK",15,0)
 ;
"RTN","BIENVCHK",16,0)
 N X,Z
"RTN","BIENVCHK",17,0)
 S X=$P(^VA(200,DUZ,0),U)
"RTN","BIENVCHK",18,0)
 W !!,$$CJ^XLFSTR("Hello, "_$P(X,",",2)_" "_$P(X,","),IOM)
"RTN","BIENVCHK",19,0)
 S X="Checking Environment for "_$P($T(+2),";",4)_" v"_$P($T(+2),";",3)
"RTN","BIENVCHK",20,0)
 S Z=$P($P($T(+2),";",5),"**",2)
"RTN","BIENVCHK",21,0)
 S:Z X=X_", Patch "_Z_"."
"RTN","BIENVCHK",22,0)
 W !!,$$CJ^XLFSTR(X,IOM),!
"RTN","BIENVCHK",23,0)
 ;
"RTN","BIENVCHK",24,0)
 S XPDQUIT=0
"RTN","BIENVCHK",25,0)
 ;
"RTN","BIENVCHK",26,0)
 ;---> REQUIREMENTS
"RTN","BIENVCHK",27,0)
 ;
"RTN","BIENVCHK",28,0)
 ;---> Kernel v8.
"RTN","BIENVCHK",29,0)
 I '$$VCHK("XU","8.0",2) S XPDQUIT=2
"RTN","BIENVCHK",30,0)
 ;
"RTN","BIENVCHK",31,0)
 ;
"RTN","BIENVCHK",32,0)
 ;---> Fileman v22.
"RTN","BIENVCHK",33,0)
 I '$$VCHK("DI","22",2) S XPDQUIT=2
"RTN","BIENVCHK",34,0)
 ;
"RTN","BIENVCHK",35,0)
 ;
"RTN","BIENVCHK",36,0)
 ;I '$$VCHK("AUT","98.1",2) S XPDQUIT=2
"RTN","BIENVCHK",37,0)
 ;S X=$$LAST("IHS DICTIONARIES (POINTERS)","98.1")
"RTN","BIENVCHK",38,0)
 ;I $P(X,U,1)'=14&($P(X,U,1)'>14) D  S XPDQUIT=2
"RTN","BIENVCHK",39,0)
 ;.W !,$$CJ^XLFSTR("AUT v98.1 Patch 14 NOT INSTALLED",IOM)
"RTN","BIENVCHK",40,0)
 ;
"RTN","BIENVCHK",41,0)
 ;---> XB/ZIB v3.0 patch 11.
"RTN","BIENVCHK",42,0)
 ;I '$$VCHK("XB","3.0",2) S XPDQUIT=2
"RTN","BIENVCHK",43,0)
 ;S X=$$LAST("IHS/VA UTILITIES","3.0")
"RTN","BIENVCHK",44,0)
 ;I $P(X,U)'=11&($P(X,U)'>11) D  S XPDQUIT=2
"RTN","BIENVCHK",45,0)
 ;.W !,$$CJ^XLFSTR("XB/ZIB v3.0 patch 11 NOT INSTALLED",IOM)
"RTN","BIENVCHK",46,0)
 ;
"RTN","BIENVCHK",47,0)
 ;---> IHS PCC REPORTS v3.0 patch 29.
"RTN","BIENVCHK",48,0)
 ;I '$$VCHK("APCL","3.0",2) S XPDQUIT=2
"RTN","BIENVCHK",49,0)
 ;S X=$$LAST("IHS PCC REPORTS","3.0")
"RTN","BIENVCHK",50,0)
 ;I $P(X,U)'=29&($P(X,U)'>29) D  S XPDQUIT=2
"RTN","BIENVCHK",51,0)
 ;.W !,$$CJ^XLFSTR("IHS PCC REPORTS v3.0 patch 29 NOT INSTALLED",IOM)
"RTN","BIENVCHK",52,0)
 ;
"RTN","BIENVCHK",53,0)
 ;---> PCC Suite v2.0 patch 2.
"RTN","BIENVCHK",54,0)
 ;I '$$VCHK("BJPC","2.0",2) S XPDQUIT=2
"RTN","BIENVCHK",55,0)
 ;S X=$$LAST("IHS PCC SUITE","2.0")
"RTN","BIENVCHK",56,0)
 ;I $P(X,U)'=2&($P(X,U)'>2) D  S XPDQUIT=2
"RTN","BIENVCHK",57,0)
 ;.W !,$$CJ^XLFSTR("BJPC v2.0 Patch 2 NOT INSTALLED",IOM)
"RTN","BIENVCHK",58,0)
 ;
"RTN","BIENVCHK",59,0)
 ;
"RTN","BIENVCHK",60,0)
 ;---> IHS Clinical Reporting System v9.0 patch 1.
"RTN","BIENVCHK",61,0)
 ;I '$$VCHK("BGP","9.0",2) S XPDQUIT=2
"RTN","BIENVCHK",62,0)
 ;S X=$$LAST("IHS CLINICAL REPORTING","9.0")
"RTN","BIENVCHK",63,0)
 ;I $P(X,U)'=1&($P(X,U)'>1) D  S XPDQUIT=2
"RTN","BIENVCHK",64,0)
 ;.W !,$$CJ^XLFSTR("BGP v9.0 Patch 1 NOT INSTALLED",IOM)
"RTN","BIENVCHK",65,0)
 ;
"RTN","BIENVCHK",66,0)
 ;---> IHS PCC REPORTS v3.0 patch 29.
"RTN","BIENVCHK",67,0)
 I '$$VCHK("APCL","3.0",2) S XPDQUIT=2
"RTN","BIENVCHK",68,0)
 S X=$$LAST("IHS PCC REPORTS","3.0")
"RTN","BIENVCHK",69,0)
 I $P(X,U)'=29&($P(X,U)'>29) D  S XPDQUIT=2
"RTN","BIENVCHK",70,0)
 .W !,$$CJ^XLFSTR("IHS PCC REPORTS v3.0 patch 29 NOT INSTALLED",IOM)
"RTN","BIENVCHK",71,0)
 ;
"RTN","BIENVCHK",72,0)
 ;
"RTN","BIENVCHK",73,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIENVCHK",74,0)
 ;---> Check environment for previous load of Imm v8.5.
"RTN","BIENVCHK",75,0)
 I '$$VCHK("BI","8.5",2) S XPDQUIT=2
"RTN","BIENVCHK",76,0)
 ;
"RTN","BIENVCHK",77,0)
 ;---> Check Patch Level of Imm.
"RTN","BIENVCHK",78,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIENVCHK",79,0)
 ;---> Check for Imm v8.5, required patch.
"RTN","BIENVCHK",80,0)
 D
"RTN","BIENVCHK",81,0)
 .S X=$$LAST("IMMUNIZATION","8.5")
"RTN","BIENVCHK",82,0)
 .;---> Patch 8.
"RTN","BIENVCHK",83,0)
 .I $P(X,U)'=8&($P(X,U)'>8) D  S XPDQUIT=2
"RTN","BIENVCHK",84,0)
 ..W !,$$CJ^XLFSTR("BI v8.5 Patch 8 NOT INSTALLED",IOM)
"RTN","BIENVCHK",85,0)
 .;
"RTN","BIENVCHK",86,0)
 .I XPDQUIT'=2 D
"RTN","BIENVCHK",87,0)
 ..W !,$$CJ^XLFSTR("Checking for Patch 8 of BI v8.5...Patch 8 Present",IOM)
"RTN","BIENVCHK",88,0)
 ;**********
"RTN","BIENVCHK",89,0)
 ;
"RTN","BIENVCHK",90,0)
 ;---> Check for multiple BI entries in the Package File.
"RTN","BIENVCHK",91,0)
 N DA,DIC
"RTN","BIENVCHK",92,0)
 S X="BI",DIC="^DIC(9.4,",DIC(0)="",D="C"
"RTN","BIENVCHK",93,0)
 D IX^DIC
"RTN","BIENVCHK",94,0)
 I Y<0,$D(^DIC(9.4,"C","BI")) D  S XPDQUIT=2
"RTN","BIENVCHK",95,0)
 .W !!,$$CJ^XLFSTR("You Have More Than One Entry In The",IOM)
"RTN","BIENVCHK",96,0)
 .W !,$$CJ^XLFSTR("PACKAGE File with a ""BI"" prefix.",IOM)
"RTN","BIENVCHK",97,0)
 .W !,$$CJ^XLFSTR("One entry needs to be deleted.",IOM)
"RTN","BIENVCHK",98,0)
 .W !,$$CJ^XLFSTR("Please do this before Proceeding.",IOM),!!
"RTN","BIENVCHK",99,0)
 .Q
"RTN","BIENVCHK",100,0)
 ;
"RTN","BIENVCHK",101,0)
 ;---> Do not allow KIDS installation to be queued (at DEVICE: prompt).
"RTN","BIENVCHK",102,0)
 S XPDNOQUE=1
"RTN","BIENVCHK",103,0)
 ;---> Do not ask "DISABLE Options...etc.?" question.
"RTN","BIENVCHK",104,0)
 S XPDDIQ("XPZ1")=0
"RTN","BIENVCHK",105,0)
 ;---> Do not ask "MOVE routines to other CPUs?" question.
"RTN","BIENVCHK",106,0)
 S XPDDIQ("XPZ2")=0
"RTN","BIENVCHK",107,0)
 ;
"RTN","BIENVCHK",108,0)
 I XPDQUIT D SORRY(XPDQUIT) Q
"RTN","BIENVCHK",109,0)
 ;
"RTN","BIENVCHK",110,0)
 W !!,$$CJ^XLFSTR("ENVIRONMENT OK.",IOM)
"RTN","BIENVCHK",111,0)
 ;
"RTN","BIENVCHK",112,0)
 I '$$DIR^XBDIR("E","","","","","",1) D SORRY(2) Q
"RTN","BIENVCHK",113,0)
 Q
"RTN","BIENVCHK",114,0)
 ;
"RTN","BIENVCHK",115,0)
SORRY(X) ;
"RTN","BIENVCHK",116,0)
 KILL DIFQ
"RTN","BIENVCHK",117,0)
 S XPDQUIT=X
"RTN","BIENVCHK",118,0)
 W:'$D(ZTQUEUED) !,$$CJ^XLFSTR("Sorry...",IOM),$$DIR^XBDIR("E","Press RETURN")
"RTN","BIENVCHK",119,0)
 Q
"RTN","BIENVCHK",120,0)
 ;
"RTN","BIENVCHK",121,0)
VCHK(ABMPRE,ABMVER,ABMQUIT) ; Check versions needed.
"RTN","BIENVCHK",122,0)
 ;
"RTN","BIENVCHK",123,0)
 NEW ABMV
"RTN","BIENVCHK",124,0)
 S ABMV=$$VERSION^XPDUTL(ABMPRE)
"RTN","BIENVCHK",125,0)
 W !,$$CJ^XLFSTR("Need at least "_ABMPRE_" v"_ABMVER_"..."_ABMPRE_" v"_ABMV_" Present",IOM)
"RTN","BIENVCHK",126,0)
 I ABMV<ABMVER W !,$$CJ^XLFSTR("^^^^**NEEDS TO BE INSTALLED**^^^^",IOM) Q 0
"RTN","BIENVCHK",127,0)
 Q 1
"RTN","BIENVCHK",128,0)
 ;
"RTN","BIENVCHK",129,0)
LAST(PKG,VER) ;EP - returns last patch applied for a Package, PATCH^DATE
"RTN","BIENVCHK",130,0)
 ;        Patch includes Seq # if Released
"RTN","BIENVCHK",131,0)
 N PKGIEN,VERIEN,LATEST,PATCH,SUBIEN
"RTN","BIENVCHK",132,0)
 I $G(VER)="" S VER=$$VERSION^XPDUTL(PKG) Q:'VER -1
"RTN","BIENVCHK",133,0)
 S PKGIEN=$O(^DIC(9.4,"B",PKG,"")) Q:'PKGIEN -1
"RTN","BIENVCHK",134,0)
 S VERIEN=$O(^DIC(9.4,PKGIEN,22,"B",VER,"")) Q:'VERIEN -1
"RTN","BIENVCHK",135,0)
 S LATEST=-1,PATCH=-1,SUBIEN=0
"RTN","BIENVCHK",136,0)
 F  S SUBIEN=$O(^DIC(9.4,PKGIEN,22,VERIEN,"PAH",SUBIEN)) Q:SUBIEN'>0  D
"RTN","BIENVCHK",137,0)
 . I $P(^DIC(9.4,PKGIEN,22,VERIEN,"PAH",SUBIEN,0),U,2)>LATEST S LATEST=$P(^(0),U,2),PATCH=$P(^(0),U)
"RTN","BIENVCHK",138,0)
 . I $P(^DIC(9.4,PKGIEN,22,VERIEN,"PAH",SUBIEN,0),U,2)=LATEST,$P(^(0),U)>PATCH S PATCH=$P(^(0),U)
"RTN","BIENVCHK",139,0)
 Q PATCH_U_LATEST
"RTN","BIETAB")
0^25^B5318670
"RTN","BIETAB",1,0)
BIETAB ;IHS/CMI/MWR - VIEW ERROR CODE TABLE; MAY 10, 2010
"RTN","BIETAB",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIETAB",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIETAB",4,0)
 ;;  VIEW BI TABLE ERROR CODE THROUGH LISTMANAGER.
"RTN","BIETAB",5,0)
 ;;  NOT CALLED FROM MENUS, PROGRAMMER USE.
"RTN","BIETAB",6,0)
 ;
"RTN","BIETAB",7,0)
 ;----------
"RTN","BIETAB",8,0)
START ;EP
"RTN","BIETAB",9,0)
 ;---> Display Error Code table.
"RTN","BIETAB",10,0)
 ;
"RTN","BIETAB",11,0)
 D SETVARS^BIUTL5
"RTN","BIETAB",12,0)
 D EN
"RTN","BIETAB",13,0)
 D EXIT
"RTN","BIETAB",14,0)
 Q
"RTN","BIETAB",15,0)
 ;
"RTN","BIETAB",16,0)
 ;
"RTN","BIETAB",17,0)
 ;----------
"RTN","BIETAB",18,0)
EN ;EP
"RTN","BIETAB",19,0)
 D EN^VALM("BI TABLE ERROR CODE VIEW")
"RTN","BIETAB",20,0)
 Q
"RTN","BIETAB",21,0)
 ;
"RTN","BIETAB",22,0)
 ;
"RTN","BIETAB",23,0)
 ;----------
"RTN","BIETAB",24,0)
INIT ;EP
"RTN","BIETAB",25,0)
 ;---> Initialize variables and list array.
"RTN","BIETAB",26,0)
 N N,I
"RTN","BIETAB",27,0)
 S N=0
"RTN","BIETAB",28,0)
 F I=1:1 S N=$O(^BIERR(N)) Q:'N  D
"RTN","BIETAB",29,0)
 .S ^TMP("BIETAB",$J,I,0)="  "_N_"  "_$P(^BIERR(N,0),U,2)
"RTN","BIETAB",30,0)
 S VALMCNT=I-1
"RTN","BIETAB",31,0)
 Q
"RTN","BIETAB",32,0)
 ;
"RTN","BIETAB",33,0)
 ;
"RTN","BIETAB",34,0)
 ;----------
"RTN","BIETAB",35,0)
RESET ;EP
"RTN","BIETAB",36,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIETAB",37,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIETAB",38,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIETAB",39,0)
 D INIT Q
"RTN","BIETAB",40,0)
 ;
"RTN","BIETAB",41,0)
 ;
"RTN","BIETAB",42,0)
 ;----------
"RTN","BIETAB",43,0)
HELP ;EP
"RTN","BIETAB",44,0)
 ;---> Help code.
"RTN","BIETAB",45,0)
 N BIX S BIX=X
"RTN","BIETAB",46,0)
 D FULL^VALM1
"RTN","BIETAB",47,0)
 W !!?5,"Use arrow keys to scroll up and down through the list, or"
"RTN","BIETAB",48,0)
 W !?5,"enter ""A"", then an Error Code Number in order  to Add, Edit"
"RTN","BIETAB",49,0)
 W !?5,"or Delete an Error Code, or"
"RTN","BIETAB",50,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIETAB",51,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIETAB",52,0)
 D:BIX'="??" RE^VALM4
"RTN","BIETAB",53,0)
 Q
"RTN","BIETAB",54,0)
 ;
"RTN","BIETAB",55,0)
 ;
"RTN","BIETAB",56,0)
 ;----------
"RTN","BIETAB",57,0)
EXIT ;EP
"RTN","BIETAB",58,0)
 ;---> Cleanup, EOJ.
"RTN","BIETAB",59,0)
 D KILLALL^BIUTL8()
"RTN","BIETAB",60,0)
 K ^TMP("BIETAB",$J)
"RTN","BIETAB",61,0)
 D CLEAR^VALM1
"RTN","BIETAB",62,0)
 D FULL^VALM1
"RTN","BIETAB",63,0)
 Q
"RTN","BIETAB",64,0)
 ;
"RTN","BIETAB",65,0)
 ;
"RTN","BIETAB",66,0)
 ;----------
"RTN","BIETAB",67,0)
ADDEDEL ;EP
"RTN","BIETAB",68,0)
 ;---> Add/Edit/Delete Error Codes.
"RTN","BIETAB",69,0)
 ;
"RTN","BIETAB",70,0)
 D FULL^VALM1
"RTN","BIETAB",71,0)
 D TITLE^BIUTL5("ADD/EDIT/DELETE ERROR CODES")
"RTN","BIETAB",72,0)
 W !!?3,"This is your big chance to add/edit/delete Error Codes!",!!
"RTN","BIETAB",73,0)
 N Y
"RTN","BIETAB",74,0)
 D DIC^BIFMAN(9002084.33,"QEMAL",.Y,"   Select ERROR CODE: ")
"RTN","BIETAB",75,0)
 I Y<1 D RESET Q
"RTN","BIETAB",76,0)
 S DR=".01;.02;.03"
"RTN","BIETAB",77,0)
 D DIE^BIFMAN(9002084.33,DR,+Y)
"RTN","BIETAB",78,0)
 D RESET
"RTN","BIETAB",79,0)
 Q
"RTN","BIEXP")
0^26^B26966562
"RTN","BIEXP",1,0)
BIEXP ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS.; MAY 10, 2010
"RTN","BIEXP",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIEXP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXP",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: MAIN DRIVER.
"RTN","BIEXP",5,0)
 ;;  PATCH 9: Changes to include Default Volume and Component fields in
"RTN","BIEXP",6,0)
 ;;           Vaccine Table export.  EXPVT+14
"RTN","BIEXP",7,0)
 ;
"RTN","BIEXP",8,0)
 ;
"RTN","BIEXP",9,0)
 ;----------
"RTN","BIEXP",10,0)
START ;EP
"RTN","BIEXP",11,0)
 ;---> Export Immunization Data.
"RTN","BIEXP",12,0)
 ;
"RTN","BIEXP",13,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIEXP",14,0)
 ;
"RTN","BIEXP",15,0)
 ;---> Introduction.
"RTN","BIEXP",16,0)
 N BIPOP S BIPOP=0
"RTN","BIEXP",17,0)
 S BITL="EXPORT IMMUNIZATION RECORDS"
"RTN","BIEXP",18,0)
 D TITLE^BIUTL5(BITL),TEXT1
"RTN","BIEXP",19,0)
 D DIRZ^BIUTL3(.BIPOP)
"RTN","BIEXP",20,0)
 Q:BIPOP
"RTN","BIEXP",21,0)
 ;
"RTN","BIEXP",22,0)
 ;
"RTN","BIEXP",23,0)
 F  D  Q:BIPOP
"RTN","BIEXP",24,0)
 .;---> Choose to select either individually or by group.
"RTN","BIEXP",25,0)
 .N A,X,Y
"RTN","BIEXP",26,0)
 .D TITLE^BIUTL5(BITL),TEXT2
"RTN","BIEXP",27,0)
 .S A="     Enter either 1 or 2: "
"RTN","BIEXP",28,0)
 .S X="SOAB^1:Individually;2:Group"
"RTN","BIEXP",29,0)
 .D DIR^BIFMAN(X,.Y,.BIPOP,A)
"RTN","BIEXP",30,0)
 .Q:BIPOP
"RTN","BIEXP",31,0)
 .;
"RTN","BIEXP",32,0)
 .;---> Select Patients individually and export data.
"RTN","BIEXP",33,0)
 .I Y=1 D ^BIEXP1 Q
"RTN","BIEXP",34,0)
 .;---> Select Patients by group and export data.
"RTN","BIEXP",35,0)
 .D ^BIEXP2
"RTN","BIEXP",36,0)
 ;
"RTN","BIEXP",37,0)
 D EXIT
"RTN","BIEXP",38,0)
 Q
"RTN","BIEXP",39,0)
 ;
"RTN","BIEXP",40,0)
 ;
"RTN","BIEXP",41,0)
 ;----------
"RTN","BIEXP",42,0)
TEXT1 ;EP
"RTN","BIEXP",43,0)
 ;;
"RTN","BIEXP",44,0)
 ;;This program will allow you to select a group of patients and to
"RTN","BIEXP",45,0)
 ;;export their demographic and immunization data either to a file
"RTN","BIEXP",46,0)
 ;;or to your screen (for capture by a PC).
"RTN","BIEXP",47,0)
 ;;
"RTN","BIEXP",48,0)
 ;;You will have the opportunity to either select individual patients
"RTN","BIEXP",49,0)
 ;;(by Name or Chart#), or to select a group of patients by specifying
"RTN","BIEXP",50,0)
 ;;Status in the Register, Visit History, Age Range, Facility, and
"RTN","BIEXP",51,0)
 ;;Current Community.  You will also be able to limit the export data
"RTN","BIEXP",52,0)
 ;;to specific Vaccines.
"RTN","BIEXP",53,0)
 ;;
"RTN","BIEXP",54,0)
 ;;Lastly, you will be given the option of exporting the data in
"RTN","BIEXP",55,0)
 ;;either an ASCII text format or Immserve data format.
"RTN","BIEXP",56,0)
 ;;
"RTN","BIEXP",57,0)
 D PRINTX("TEXT1")
"RTN","BIEXP",58,0)
 Q
"RTN","BIEXP",59,0)
 ;
"RTN","BIEXP",60,0)
 ;
"RTN","BIEXP",61,0)
 ;----------
"RTN","BIEXP",62,0)
TEXT2 ;EP
"RTN","BIEXP",63,0)
 ;;
"RTN","BIEXP",64,0)
 ;;Do you wish to:
"RTN","BIEXP",65,0)
 ;;
"RTN","BIEXP",66,0)
 ;;     1) Select patients INDIVIDUALLY by entering their Names
"RTN","BIEXP",67,0)
 ;;        or Chart Numbers,
"RTN","BIEXP",68,0)
 ;;or
"RTN","BIEXP",69,0)
 ;;     2) Select patients by GROUP, specifying Age Range, Status,
"RTN","BIEXP",70,0)
 ;;        Current Community, etc.
"RTN","BIEXP",71,0)
 ;;
"RTN","BIEXP",72,0)
 D PRINTX("TEXT2")
"RTN","BIEXP",73,0)
 Q
"RTN","BIEXP",74,0)
 ;
"RTN","BIEXP",75,0)
 ;
"RTN","BIEXP",76,0)
 ;----------
"RTN","BIEXP",77,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIEXP",78,0)
 Q:$G(BILINL)=""
"RTN","BIEXP",79,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIEXP",80,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIEXP",81,0)
 Q
"RTN","BIEXP",82,0)
 ;
"RTN","BIEXP",83,0)
 ;
"RTN","BIEXP",84,0)
 ;----------
"RTN","BIEXP",85,0)
EXIT ;EP
"RTN","BIEXP",86,0)
 ;---> EOJ cleanup.
"RTN","BIEXP",87,0)
 K ^TMP("BIEXP1",$J),^TMP("BIEXP2",$J)
"RTN","BIEXP",88,0)
 D KILLALL^BIUTL8(1)
"RTN","BIEXP",89,0)
 D CLEAR^VALM1
"RTN","BIEXP",90,0)
 D FULL^VALM1
"RTN","BIEXP",91,0)
 Q
"RTN","BIEXP",92,0)
 ;
"RTN","BIEXP",93,0)
 ;
"RTN","BIEXP",94,0)
 ;----------
"RTN","BIEXP",95,0)
EXPVT ;EP
"RTN","BIEXP",96,0)
 ;---> Export Vaccine Table to a CVS (Excel compatible) host file.
"RTN","BIEXP",97,0)
 D SETVARS^BIUTL5
"RTN","BIEXP",98,0)
 N BIFLNM,BIPATH,BIPOP
"RTN","BIEXP",99,0)
 S BIFLNM="RPMS Vaccine Table.csv"
"RTN","BIEXP",100,0)
 D HFS^BIEXPRT8(BIFLNM,.BIPATH,1,.BIPOP)
"RTN","BIEXP",101,0)
 I $G(BIPOP) D ^%ZISC W !!?3,"Failure to open Host File." D DIRZ^BIUTL3() Q
"RTN","BIEXP",102,0)
 ;
"RTN","BIEXP",103,0)
 ;---> Host file is open.
"RTN","BIEXP",104,0)
 ;---> Use "," for CSV delimiter.
"RTN","BIEXP",105,0)
 N Q,D S Q="""",D=Q_","_Q
"RTN","BIEXP",106,0)
 ;
"RTN","BIEXP",107,0)
 ;---> Write Header row.
"RTN","BIEXP",108,0)
 W Q_"CVX Code"_D_"Name"_D_"Short Name"_D_"Vaccine Group"_D_"VIS Date"_D_"Active"
"RTN","BIEXP",109,0)
 ;
"RTN","BIEXP",110,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIEXP",111,0)
 ;---> Include Default Volume and Component fields.
"RTN","BIEXP",112,0)
 W D_"Default Volume"
"RTN","BIEXP",113,0)
 W D_"Related Contra CVX's"_D_"1st Brand Name"_D_"2nd Brand Name"
"RTN","BIEXP",114,0)
 W D_"Component 1"_D_"Comp1 CVX"_D_"Component 2"_D_"Comp2 CVX"
"RTN","BIEXP",115,0)
 W D_"Component 3"_D_"Comp3 CVX"_D_"Component 4"_D_"Comp4 CVX"
"RTN","BIEXP",116,0)
 W D_"Component 5"_D_"Comp5 CVX"_D_"Component 6"_D_"Comp6 CVX"
"RTN","BIEXP",117,0)
 W D_"Long Name"_Q
"RTN","BIEXP",118,0)
 ;
"RTN","BIEXP",119,0)
 ;---> Write data records.
"RTN","BIEXP",120,0)
 N N S N=0
"RTN","BIEXP",121,0)
 F  S N=$O(^BITN(N)) Q:'N  D
"RTN","BIEXP",122,0)
 .N Y,Z S Y=^BITN(N,0),Z=$G(^BITN(N,1))
"RTN","BIEXP",123,0)
 .W !,Q_$P(Y,U,3)_D_$P(Y,U,1)_D_$P(Y,U,2)_D_$$VGROUP^BIUTL2($P(Y,U,9))
"RTN","BIEXP",124,0)
 .W D_$$SLDT1^BIUTL5($P(Y,U,13))_D_$S($P(Y,U,7)=1:"Inactive",1:"Active")
"RTN","BIEXP",125,0)
 .;
"RTN","BIEXP",126,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIEXP",127,0)
 .;---> Include Default Volume and Component Fields.
"RTN","BIEXP",128,0)
 .W D_$P(Y,U,18)
"RTN","BIEXP",129,0)
 .W D_$P(Y,U,12)_D_$P(Z,U,1)_D_$P(Z,U,3)
"RTN","BIEXP",130,0)
 .N I F I=21:1:26 D
"RTN","BIEXP",131,0)
 ..I '$P(Y,U,I) W D_D Q
"RTN","BIEXP",132,0)
 ..W D_$$VNAME^BIUTL2($P(Y,U,I))_D_$$CODE^BIUTL2($P(Y,U,I))
"RTN","BIEXP",133,0)
 .;**********
"RTN","BIEXP",134,0)
 .W D_$P(Z,U,14)_Q
"RTN","BIEXP",135,0)
 ;
"RTN","BIEXP",136,0)
 ;---> Close the host file and report its location.
"RTN","BIEXP",137,0)
 D ^%ZISC
"RTN","BIEXP",138,0)
 D TITLE^BIUTL5("EXPORT VACCINE TABLE TO EXCEL FILE")
"RTN","BIEXP",139,0)
 W !!?5,"The Vaccine Table has been exported to:"
"RTN","BIEXP",140,0)
 W !!?10,BIPATH_BIFLNM
"RTN","BIEXP",141,0)
 D TEXT3
"RTN","BIEXP",142,0)
 D DIRZ^BIUTL3()
"RTN","BIEXP",143,0)
 Q
"RTN","BIEXP",144,0)
 ;
"RTN","BIEXP",145,0)
 ;
"RTN","BIEXP",146,0)
 ;----------
"RTN","BIEXP",147,0)
TEXT3 ;EP
"RTN","BIEXP",148,0)
 ;;
"RTN","BIEXP",149,0)
 ;;
"RTN","BIEXP",150,0)
 ;;
"RTN","BIEXP",151,0)
 ;;Note that the path ("folder" or "directory") in which the file
"RTN","BIEXP",152,0)
 ;;was placed is taken from the Immunization Site Parameter #6.
"RTN","BIEXP",153,0)
 ;;You can change that to a different location by editing the site
"RTN","BIEXP",154,0)
 ;;parameter (IMM-->MGR-->ESP-->6).
"RTN","BIEXP",155,0)
 ;;
"RTN","BIEXP",156,0)
 ;
"RTN","BIEXP",157,0)
 D PRINTX("TEXT3")
"RTN","BIEXP",158,0)
 Q
"RTN","BIEXP1")
0^27^B41307343
"RTN","BIEXP1",1,0)
BIEXP1 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS.; MAY 10, 2010
"RTN","BIEXP1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIEXP1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXP1",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: SELECT BY INDIVIDUAL PATIENTS.
"RTN","BIEXP1",5,0)
 ;
"RTN","BIEXP1",6,0)
 ;
"RTN","BIEXP1",7,0)
 ;----------
"RTN","BIEXP1",8,0)
START ;EP
"RTN","BIEXP1",9,0)
 ;---> Listman Screen for selecting Export Parameters, by Individual.
"RTN","BIEXP1",10,0)
 ;
"RTN","BIEXP1",11,0)
 D SETVARS^BIUTL5
"RTN","BIEXP1",12,0)
 ;---> Main entry point for Export by Individual Patients.
"RTN","BIEXP1",13,0)
 D EN^VALM("BI EXPORT BY INDIVIDUALS")
"RTN","BIEXP1",14,0)
 D EXIT
"RTN","BIEXP1",15,0)
 Q
"RTN","BIEXP1",16,0)
 ;
"RTN","BIEXP1",17,0)
 ;
"RTN","BIEXP1",18,0)
 ;----------
"RTN","BIEXP1",19,0)
INIT ;EP
"RTN","BIEXP1",20,0)
 ;---> Initialize variables and list array.
"RTN","BIEXP1",21,0)
 S BIPG=9,BIAG="",BIHCF("ALL")="",BICC("ALL")=""
"RTN","BIEXP1",22,0)
 ;
"RTN","BIEXP1",23,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIEXP1",24,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIEXP1",25,0)
 N BILINE,X S BILINE=0
"RTN","BIEXP1",26,0)
 D WRITE(.BILINE)
"RTN","BIEXP1",27,0)
 S X=IOUON_"EXPORT DATA BY INDIVIDUALS" D CENTERT^BIUTL5(.X,42)
"RTN","BIEXP1",28,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIEXP1",29,0)
 K X
"RTN","BIEXP1",30,0)
 ;
"RTN","BIEXP1",31,0)
 ;---> Survey Date.
"RTN","BIEXP1",32,0)
 D WRITE(.BILINE,,1)
"RTN","BIEXP1",33,0)
 S:'$G(BISVDT) BISVDT=DT
"RTN","BIEXP1",34,0)
 S X="     1 - Survey Date..............: "_$$TXDT1^BIUTL5(BISVDT)
"RTN","BIEXP1",35,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP1",36,0)
 K X
"RTN","BIEXP1",37,0)
 ;
"RTN","BIEXP1",38,0)
 ;---> Patients, individuals.
"RTN","BIEXP1",39,0)
 N BII,BIPAT1 S BII=0,BIPAT1=""
"RTN","BIEXP1",40,0)
 D
"RTN","BIEXP1",41,0)
 .I '$D(BIPAT) S BIPAT1="None" Q
"RTN","BIEXP1",42,0)
 .I $D(BIPAT("ALL")) S BIPAT1="ALL" Q
"RTN","BIEXP1",43,0)
 .N M,N
"RTN","BIEXP1",44,0)
 .S N=0
"RTN","BIEXP1",45,0)
 .F BII=0:1 S N=$O(BIPAT(N)) Q:'N  S M=N
"RTN","BIEXP1",46,0)
 .I BII=1 S BIPAT1=$$NAME^BIUTL1(M) Q
"RTN","BIEXP1",47,0)
 .S BIPAT1="List (Select ""2"" to review list.)"
"RTN","BIEXP1",48,0)
 S X="     2 - Patient"_$S(BII=1:".",1:"s")
"RTN","BIEXP1",49,0)
 S X=X_".................: "_BIPAT1
"RTN","BIEXP1",50,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP1",51,0)
 K X
"RTN","BIEXP1",52,0)
 ;
"RTN","BIEXP1",53,0)
 ;---> Immunizations Received.
"RTN","BIEXP1",54,0)
 N BIMMR1 S BIMMR1=""
"RTN","BIEXP1",55,0)
 D
"RTN","BIEXP1",56,0)
 .S:'$D(BIMMR) BIMMR("ALL")=""
"RTN","BIEXP1",57,0)
 .I $D(BIMMR("ALL")) S BIMMR1="ALL" Q
"RTN","BIEXP1",58,0)
 .N I,M,N
"RTN","BIEXP1",59,0)
 .S N=0
"RTN","BIEXP1",60,0)
 .F I=0:1 S N=$O(BIMMR(N)) Q:'N  S M=N
"RTN","BIEXP1",61,0)
 .I I=1 S BIMMR1=$$VNAME^BIUTL2(M) Q
"RTN","BIEXP1",62,0)
 .S BIMMR1="List (Select ""3"" to review list.)"
"RTN","BIEXP1",63,0)
 S X="     3 - Immunizations Received...: "_BIMMR1
"RTN","BIEXP1",64,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP1",65,0)
 K X
"RTN","BIEXP1",66,0)
 ;
"RTN","BIEXP1",67,0)
 ;---> Data Elements.
"RTN","BIEXP1",68,0)
 N BIDE1 S BIDE1=""
"RTN","BIEXP1",69,0)
 D
"RTN","BIEXP1",70,0)
 .I '$D(BIDE) S BIDE1="None" Q
"RTN","BIEXP1",71,0)
 .I $D(BIDE("ALL")) S BIDE1="ALL" Q
"RTN","BIEXP1",72,0)
 .N I,M,N
"RTN","BIEXP1",73,0)
 .S N=0
"RTN","BIEXP1",74,0)
 .F I=0:1 S N=$O(BIDE(N)) Q:'N  S M=N
"RTN","BIEXP1",75,0)
 .I I=1 S BIDE1=$$DETX^BIUTL6(M) Q
"RTN","BIEXP1",76,0)
 .S BIDE1="List (Select ""4"" to review list.)"
"RTN","BIEXP1",77,0)
 S X="     4 - Data Elements............: "_BIDE1
"RTN","BIEXP1",78,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP1",79,0)
 K X
"RTN","BIEXP1",80,0)
 ;
"RTN","BIEXP1",81,0)
 ;---> File Format (1=ASCII,2=HL7,3=ImmServe).
"RTN","BIEXP1",82,0)
 S:'$G(BIFMT) BIFMT=1
"RTN","BIEXP1",83,0)
 N BIFMT1
"RTN","BIEXP1",84,0)
 S BIFMT1=$S(BIFMT=2:"HL7",BIFMT=3:"ImmServe",1:"ASCII")
"RTN","BIEXP1",85,0)
 S X="     5 - File Format..............: "_BIFMT1
"RTN","BIEXP1",86,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP1",87,0)
 K X
"RTN","BIEXP1",88,0)
 ;
"RTN","BIEXP1",89,0)
 ;---> Output.
"RTN","BIEXP1",90,0)
 D
"RTN","BIEXP1",91,0)
 .I '$G(BIOUT) S BIOUT=0,BIFLNM="" Q
"RTN","BIEXP1",92,0)
 .I $G(BIFLNM)="" S BIOUT=0
"RTN","BIEXP1",93,0)
 N BIOUT1
"RTN","BIEXP1",94,0)
 S BIOUT1=$S(BIOUT:"File: "_$G(BIPATH)_BIFLNM,1:"SCREEN")
"RTN","BIEXP1",95,0)
 S X="     6 - Output Device............: "_BIOUT1
"RTN","BIEXP1",96,0)
 D WRITE(.BILINE,X)
"RTN","BIEXP1",97,0)
 K X
"RTN","BIEXP1",98,0)
 ;
"RTN","BIEXP1",99,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIEXP1",100,0)
 S VALMCNT=BILINE
"RTN","BIEXP1",101,0)
 S BIRTN="BIEXP1"
"RTN","BIEXP1",102,0)
 Q
"RTN","BIEXP1",103,0)
 ;
"RTN","BIEXP1",104,0)
 ;
"RTN","BIEXP1",105,0)
 ;----------
"RTN","BIEXP1",106,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIEXP1",107,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIEXP1",108,0)
 ;---> Parameters:
"RTN","BIEXP1",109,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIEXP1",110,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIEXP1",111,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIEXP1",112,0)
 ;
"RTN","BIEXP1",113,0)
 Q:'$D(BILINE)
"RTN","BIEXP1",114,0)
 D WL^BIW(.BILINE,"BIEXP1",$G(BIVAL),$G(BIBLNK))
"RTN","BIEXP1",115,0)
 Q
"RTN","BIEXP1",116,0)
 ;
"RTN","BIEXP1",117,0)
 ;
"RTN","BIEXP1",118,0)
 ;----------
"RTN","BIEXP1",119,0)
RESET ;EP
"RTN","BIEXP1",120,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIEXP1",121,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIEXP1",122,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIEXP1",123,0)
 D INIT Q
"RTN","BIEXP1",124,0)
 ;
"RTN","BIEXP1",125,0)
 ;
"RTN","BIEXP1",126,0)
 ;----------
"RTN","BIEXP1",127,0)
HELP ;EP
"RTN","BIEXP1",128,0)
 ;---> Help code.
"RTN","BIEXP1",129,0)
 D FULL^VALM1 N BIPOP
"RTN","BIEXP1",130,0)
 D TITLE^BIUTL5("EXPORT DATA BY INDIVIDUALS - HELP, page 1 of 2")
"RTN","BIEXP1",131,0)
 D TEXT1,DIRZ^BIUTL3(.BIPOP)
"RTN","BIEXP1",132,0)
 I $G(BIPOP) D RESET Q
"RTN","BIEXP1",133,0)
 D TITLE^BIUTL5("EXPORT DATA BY INDIVIDUALS - HELP, page 2 of 2")
"RTN","BIEXP1",134,0)
 D TEXT2,DIRZ^BIUTL3()
"RTN","BIEXP1",135,0)
 D RESET
"RTN","BIEXP1",136,0)
 Q
"RTN","BIEXP1",137,0)
 ;
"RTN","BIEXP1",138,0)
 ;
"RTN","BIEXP1",139,0)
 ;----------
"RTN","BIEXP1",140,0)
TEXT1 ;
"RTN","BIEXP1",141,0)
 ;;The EXPORT DATA BY INDIVIDUALS screen provides a menu of options
"RTN","BIEXP1",142,0)
 ;;for exporting the data of individual patients.
"RTN","BIEXP1",143,0)
 ;;
"RTN","BIEXP1",144,0)
 ;;There are 6 items or "parameters" on the screen that you may
"RTN","BIEXP1",145,0)
 ;;change in order to specify which patients and which data will be
"RTN","BIEXP1",146,0)
 ;;exported, as well as the output device for the export.
"RTN","BIEXP1",147,0)
 ;;
"RTN","BIEXP1",148,0)
 ;;To change an item, enter its left column number (1-6) at the
"RTN","BIEXP1",149,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIEXP1",150,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIEXP1",151,0)
 ;;changing.
"RTN","BIEXP1",152,0)
 ;;
"RTN","BIEXP1",153,0)
 ;;Once you have the parameters set to retrieve the patients and data
"RTN","BIEXP1",154,0)
 ;;you want, select E to Export the data.
"RTN","BIEXP1",155,0)
 ;;
"RTN","BIEXP1",156,0)
 D PRINTX("TEXT1")
"RTN","BIEXP1",157,0)
 Q
"RTN","BIEXP1",158,0)
 ;
"RTN","BIEXP1",159,0)
 ;
"RTN","BIEXP1",160,0)
 ;----------
"RTN","BIEXP1",161,0)
TEXT2 ;EP
"RTN","BIEXP1",162,0)
 ;;SURVEY DATE: A past or prsent date, after which immunizations
"RTN","BIEXP1",163,0)
 ;;will not be included in the export.
"RTN","BIEXP1",164,0)
 ;;
"RTN","BIEXP1",165,0)
 ;;PATIENTS: Select the patients whose data you wish to export.
"RTN","BIEXP1",166,0)
 ;;
"RTN","BIEXP1",167,0)
 ;;VACCINES: If you select for specific Vaccines, only immunizations
"RTN","BIEXP1",168,0)
 ;;given with the selected vaccines will be included in the export.
"RTN","BIEXP1",169,0)
 ;;
"RTN","BIEXP1",170,0)
 ;;DATE ELEMENTS: Select the group of Data Elements you wish to export
"RTN","BIEXP1",171,0)
 ;;for each immunization.
"RTN","BIEXP1",172,0)
 ;;
"RTN","BIEXP1",173,0)
 ;;FILE FORMAT and OUTPUT DEVICE: Detailed help will be given when
"RTN","BIEXP1",174,0)
 ;;you select these items.
"RTN","BIEXP1",175,0)
 ;;
"RTN","BIEXP1",176,0)
 D PRINTX("TEXT2")
"RTN","BIEXP1",177,0)
 Q
"RTN","BIEXP1",178,0)
 ;
"RTN","BIEXP1",179,0)
 ;
"RTN","BIEXP1",180,0)
 ;----------
"RTN","BIEXP1",181,0)
TEXT3 ;
"RTN","BIEXP1",182,0)
 ;;                              NOTE
"RTN","BIEXP1",183,0)
 ;;                             ------
"RTN","BIEXP1",184,0)
 ;;
"RTN","BIEXP1",185,0)
 ;;The Quarterly Immunization Report may contain some patients who
"RTN","BIEXP1",186,0)
 ;;were ACTIVE prior to the Quarter Ending Date you selected, but who
"RTN","BIEXP1",187,0)
 ;;are now INACTIVE.
"RTN","BIEXP1",188,0)
 ;;
"RTN","BIEXP1",189,0)
 ;;The Due List you are about to view will contain only ACTIVE patients
"RTN","BIEXP1",190,0)
 ;;unless you specify otherwise.
"RTN","BIEXP1",191,0)
 ;;
"RTN","BIEXP1",192,0)
 ;;
"RTN","BIEXP1",193,0)
 ;;
"RTN","BIEXP1",194,0)
 ;;
"RTN","BIEXP1",195,0)
 ;;
"RTN","BIEXP1",196,0)
 D PRINTX("TEXT3")
"RTN","BIEXP1",197,0)
 Q
"RTN","BIEXP1",198,0)
 ;
"RTN","BIEXP1",199,0)
 ;
"RTN","BIEXP1",200,0)
 ;----------
"RTN","BIEXP1",201,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIEXP1",202,0)
 Q:$G(BILINL)=""
"RTN","BIEXP1",203,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIEXP1",204,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIEXP1",205,0)
 Q
"RTN","BIEXP1",206,0)
 ;
"RTN","BIEXP1",207,0)
 ;
"RTN","BIEXP1",208,0)
 ;----------
"RTN","BIEXP1",209,0)
EXIT ;EP
"RTN","BIEXP1",210,0)
 ;---> EOJ cleanup.
"RTN","BIEXP1",211,0)
 K ^TMP("BIEXP1",$J)
"RTN","BIEXP1",212,0)
 D CLEAR^VALM1
"RTN","BIEXP1",213,0)
 D FULL^VALM1
"RTN","BIEXP1",214,0)
 Q
"RTN","BIEXP2")
0^28^B51914490
"RTN","BIEXP2",1,0)
BIEXP2 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS.; MAY 10, 2010
"RTN","BIEXP2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIEXP2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXP2",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: SELECT PATIENTS BY GROUP.
"RTN","BIEXP2",5,0)
 ;
"RTN","BIEXP2",6,0)
 ;
"RTN","BIEXP2",7,0)
 ;----------
"RTN","BIEXP2",8,0)
START ;EP
"RTN","BIEXP2",9,0)
 ;---> Listman Screen for selecting Export Parameters, by Group.
"RTN","BIEXP2",10,0)
 ;
"RTN","BIEXP2",11,0)
 D SETVARS^BIUTL5
"RTN","BIEXP2",12,0)
 ;---> Main entry point for Export by Individual Patients.
"RTN","BIEXP2",13,0)
 D EN^VALM("BI EXPORT BY GROUP")
"RTN","BIEXP2",14,0)
 D EXIT
"RTN","BIEXP2",15,0)
 Q
"RTN","BIEXP2",16,0)
 ;
"RTN","BIEXP2",17,0)
 ;
"RTN","BIEXP2",18,0)
 ;----------
"RTN","BIEXP2",19,0)
INIT ;EP
"RTN","BIEXP2",20,0)
 ;---> Initialize variables and list array.
"RTN","BIEXP2",21,0)
 ;
"RTN","BIEXP2",22,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIEXP2",23,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIEXP2",24,0)
 N BILINE,X S BILINE=0
"RTN","BIEXP2",25,0)
 D WRITE(.BILINE)
"RTN","BIEXP2",26,0)
 S X=IOUON_"EXPORT DATA BY GROUP" D CENTERT^BIUTL5(.X,42)
"RTN","BIEXP2",27,0)
 D WRITE(.BILINE,X_IOINORM,1)
"RTN","BIEXP2",28,0)
 K X
"RTN","BIEXP2",29,0)
 ;
"RTN","BIEXP2",30,0)
 ;---> Survey Date.
"RTN","BIEXP2",31,0)
 S:'$G(BISVDT) BISVDT=DT
"RTN","BIEXP2",32,0)
 S X="     1 - Survey Date..............: "_$$TXDT1^BIUTL5(BISVDT)
"RTN","BIEXP2",33,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP2",34,0)
 K X
"RTN","BIEXP2",35,0)
 ;
"RTN","BIEXP2",36,0)
 ;---> Age Range.
"RTN","BIEXP2",37,0)
 S:$G(BIAG)="" BIAG="1-72"
"RTN","BIEXP2",38,0)
 N BIAG1
"RTN","BIEXP2",39,0)
 D
"RTN","BIEXP2",40,0)
 .I BIAG="ALL" S BIAG1="All Ages" Q
"RTN","BIEXP2",41,0)
 .S BIAG1=$$MTHYR^BIAGE(BIAG)
"RTN","BIEXP2",42,0)
 S X="     2 - Age Range................: "_BIAG1
"RTN","BIEXP2",43,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP2",44,0)
 K X
"RTN","BIEXP2",45,0)
 ;
"RTN","BIEXP2",46,0)
 ;
"RTN","BIEXP2",47,0)
 ;---> Patient Group.
"RTN","BIEXP2",48,0)
 S:('$G(BIPG)!($G(BIPG)=9)) BIPG=1 N X
"RTN","BIEXP2",49,0)
 D
"RTN","BIEXP2",50,0)
 .I BIPG=1 S X="ACTIVE in the Register." Q
"RTN","BIEXP2",51,0)
 .I BIPG=2 S X="BOTH Active and Inactive." Q
"RTN","BIEXP2",52,0)
 .I BIPG=3 S X="ALL who have had an Immunization." Q
"RTN","BIEXP2",53,0)
 .I BIPG=4 S X="ALL who have had a Visit of any kind." Q
"RTN","BIEXP2",54,0)
 .I BIPG=5 S X="ALL Patients (including those w/o a Visit)." Q
"RTN","BIEXP2",55,0)
 .S X="Make a selection." Q
"RTN","BIEXP2",56,0)
 S X="     3 - Patient Group............: "_X
"RTN","BIEXP2",57,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP2",58,0)
 K X
"RTN","BIEXP2",59,0)
 ;
"RTN","BIEXP2",60,0)
 ;---> Health Care Facility.
"RTN","BIEXP2",61,0)
 N BIHCF1 S BIHCF1=""
"RTN","BIEXP2",62,0)
 D
"RTN","BIEXP2",63,0)
 .S:'$D(BIHCF) BIHCF("ALL")=""
"RTN","BIEXP2",64,0)
 .I $D(BIHCF("ALL")) S BIHCF1="ALL" Q
"RTN","BIEXP2",65,0)
 .N I,M,N
"RTN","BIEXP2",66,0)
 .S N=0
"RTN","BIEXP2",67,0)
 .F I=0:1 S N=$O(BIHCF(N)) Q:'N  S M=N
"RTN","BIEXP2",68,0)
 .I I=1 S BIHCF1=$$INSTTX^BIUTL6(M) Q
"RTN","BIEXP2",69,0)
 .S BIHCF1="List (Select ""4"" to review list.)"
"RTN","BIEXP2",70,0)
 S X="     4 - Health Care Facility.....: "_BIHCF1
"RTN","BIEXP2",71,0)
 D WRITE(.BILINE,X)
"RTN","BIEXP2",72,0)
 K X
"RTN","BIEXP2",73,0)
 ;
"RTN","BIEXP2",74,0)
 ;---> Current Community.
"RTN","BIEXP2",75,0)
 N BICC1 S BICC1=""
"RTN","BIEXP2",76,0)
 D
"RTN","BIEXP2",77,0)
 .S:'$D(BICC) BICC("ALL")=""
"RTN","BIEXP2",78,0)
 .I $D(BICC("ALL")) S BICC1="ALL" Q
"RTN","BIEXP2",79,0)
 .N I,M,N
"RTN","BIEXP2",80,0)
 .S N=0
"RTN","BIEXP2",81,0)
 .F I=0:1 S N=$O(BICC(N)) Q:'N  S M=N
"RTN","BIEXP2",82,0)
 .I I=1 S BICC1=$$CCTX^BIUTL6(M) Q
"RTN","BIEXP2",83,0)
 .S BICC1="List (Select ""5"" to review list.)"
"RTN","BIEXP2",84,0)
 S X="     5 - Community................: "_BICC1
"RTN","BIEXP2",85,0)
 D WRITE(.BILINE,X)
"RTN","BIEXP2",86,0)
 K X
"RTN","BIEXP2",87,0)
 ;
"RTN","BIEXP2",88,0)
 ;---> Immunizations Received.
"RTN","BIEXP2",89,0)
 N BIMMR1 S BIMMR1=""
"RTN","BIEXP2",90,0)
 D
"RTN","BIEXP2",91,0)
 .S:'$D(BIMMR) BIMMR("ALL")=""
"RTN","BIEXP2",92,0)
 .I $D(BIMMR("ALL")) S BIMMR1="ALL" Q
"RTN","BIEXP2",93,0)
 .N I,M,N
"RTN","BIEXP2",94,0)
 .S N=0
"RTN","BIEXP2",95,0)
 .F I=0:1 S N=$O(BIMMR(N)) Q:'N  S M=N
"RTN","BIEXP2",96,0)
 .I I=1 S BIMMR1=$$VNAME^BIUTL2(M) Q
"RTN","BIEXP2",97,0)
 .S BIMMR1="List (Select ""6"" to review list.)"
"RTN","BIEXP2",98,0)
 S X="     6 - Immunizations Received...: "_BIMMR1
"RTN","BIEXP2",99,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP2",100,0)
 K X
"RTN","BIEXP2",101,0)
 ;
"RTN","BIEXP2",102,0)
 ;---> Data Elements.
"RTN","BIEXP2",103,0)
 N BIDE1 S BIDE1=""
"RTN","BIEXP2",104,0)
 D
"RTN","BIEXP2",105,0)
 .I '$D(BIDE) S BIDE1="None" Q
"RTN","BIEXP2",106,0)
 .I $D(BIDE("ALL")) S BIDE1="ALL" Q
"RTN","BIEXP2",107,0)
 .N I,M,N
"RTN","BIEXP2",108,0)
 .S N=0
"RTN","BIEXP2",109,0)
 .F I=0:1 S N=$O(BIDE(N)) Q:'N  S M=N
"RTN","BIEXP2",110,0)
 .I I=1 S BIDE1=$$DETX^BIUTL6(M) Q
"RTN","BIEXP2",111,0)
 .S BIDE1="List (Select ""7"" to review list.)"
"RTN","BIEXP2",112,0)
 S X="     7 - Data Elements............: "_BIDE1
"RTN","BIEXP2",113,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP2",114,0)
 K X
"RTN","BIEXP2",115,0)
 ;
"RTN","BIEXP2",116,0)
 ;---> File Format (1=ASCII,2=HL7,3=ImmServe).
"RTN","BIEXP2",117,0)
 S:'$G(BIFMT) BIFMT=1
"RTN","BIEXP2",118,0)
 N BIFMT1
"RTN","BIEXP2",119,0)
 S BIFMT1=$S(BIFMT=2:"HL7",BIFMT=3:"ImmServe",1:"ASCII")
"RTN","BIEXP2",120,0)
 S X="     8 - File Format..............: "_BIFMT1
"RTN","BIEXP2",121,0)
 D WRITE(.BILINE,X,1)
"RTN","BIEXP2",122,0)
 K X
"RTN","BIEXP2",123,0)
 ;
"RTN","BIEXP2",124,0)
 ;---> Output.
"RTN","BIEXP2",125,0)
 D
"RTN","BIEXP2",126,0)
 .I '$G(BIOUT) S BIOUT=0,BIFLNM="" Q
"RTN","BIEXP2",127,0)
 .I $G(BIFLNM)="" S BIOUT=0
"RTN","BIEXP2",128,0)
 N BIOUT1
"RTN","BIEXP2",129,0)
 S BIOUT1=$S(BIOUT:"File: "_$G(BIPATH)_BIFLNM,1:"SCREEN")
"RTN","BIEXP2",130,0)
 S X="     9 - Output Device............: "_BIOUT1
"RTN","BIEXP2",131,0)
 D WRITE(.BILINE,X)
"RTN","BIEXP2",132,0)
 K X
"RTN","BIEXP2",133,0)
 ;
"RTN","BIEXP2",134,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIEXP2",135,0)
 S VALMCNT=BILINE
"RTN","BIEXP2",136,0)
 S BIRTN="BIEXP2"
"RTN","BIEXP2",137,0)
 Q
"RTN","BIEXP2",138,0)
 ;
"RTN","BIEXP2",139,0)
 ;
"RTN","BIEXP2",140,0)
 ;----------
"RTN","BIEXP2",141,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIEXP2",142,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIEXP2",143,0)
 ;---> Parameters:
"RTN","BIEXP2",144,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIEXP2",145,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIEXP2",146,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIEXP2",147,0)
 ;
"RTN","BIEXP2",148,0)
 Q:'$D(BILINE)
"RTN","BIEXP2",149,0)
 D WL^BIW(.BILINE,"BIEXP2",$G(BIVAL),$G(BIBLNK))
"RTN","BIEXP2",150,0)
 Q
"RTN","BIEXP2",151,0)
 ;
"RTN","BIEXP2",152,0)
 ;
"RTN","BIEXP2",153,0)
 ;----------
"RTN","BIEXP2",154,0)
RESET ;EP
"RTN","BIEXP2",155,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIEXP2",156,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIEXP2",157,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIEXP2",158,0)
 D INIT Q
"RTN","BIEXP2",159,0)
 ;
"RTN","BIEXP2",160,0)
 ;
"RTN","BIEXP2",161,0)
 ;----------
"RTN","BIEXP2",162,0)
HELP ;EP
"RTN","BIEXP2",163,0)
 ;---> Help code.
"RTN","BIEXP2",164,0)
 D FULL^VALM1 N BIPOP
"RTN","BIEXP2",165,0)
 D TITLE^BIUTL5("EXPORT DATA BY GROUP - HELP, page 1 of 2")
"RTN","BIEXP2",166,0)
 D TEXT1,DIRZ^BIUTL3(.BIPOP)
"RTN","BIEXP2",167,0)
 I $G(BIPOP) D RESET Q
"RTN","BIEXP2",168,0)
 D TITLE^BIUTL5("EXPORT DATA BY GROUP - HELP, page 2 of 2")
"RTN","BIEXP2",169,0)
 D TEXT2,DIRZ^BIUTL3()
"RTN","BIEXP2",170,0)
 D RESET
"RTN","BIEXP2",171,0)
 Q
"RTN","BIEXP2",172,0)
 ;
"RTN","BIEXP2",173,0)
 ;
"RTN","BIEXP2",174,0)
 ;----------
"RTN","BIEXP2",175,0)
TEXT1 ;
"RTN","BIEXP2",176,0)
 ;;The EXPORT DATA BY GROUP screen provides a menu of options for
"RTN","BIEXP2",177,0)
 ;;exporting the data of groups of patients.
"RTN","BIEXP2",178,0)
 ;;
"RTN","BIEXP2",179,0)
 ;;There are 8 items or "parameters" on the screen that you may
"RTN","BIEXP2",180,0)
 ;;change in order to specify which patients and which data will be
"RTN","BIEXP2",181,0)
 ;;exported, as well as the output device for the export.
"RTN","BIEXP2",182,0)
 ;;
"RTN","BIEXP2",183,0)
 ;;To change an item, enter its left column number (1-8) at the
"RTN","BIEXP2",184,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIEXP2",185,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIEXP2",186,0)
 ;;changing.
"RTN","BIEXP2",187,0)
 ;;
"RTN","BIEXP2",188,0)
 ;;Once you have the parameters set to retrieve the patients and data
"RTN","BIEXP2",189,0)
 ;;you want, select E to Export the data.
"RTN","BIEXP2",190,0)
 ;;
"RTN","BIEXP2",191,0)
 D PRINTX("TEXT1")
"RTN","BIEXP2",192,0)
 Q
"RTN","BIEXP2",193,0)
 ;
"RTN","BIEXP2",194,0)
 ;
"RTN","BIEXP2",195,0)
 ;----------
"RTN","BIEXP2",196,0)
TEXT2 ;EP
"RTN","BIEXP2",197,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIEXP2",198,0)
 ;;whose Current Community (under Patient Registration) is one of the
"RTN","BIEXP2",199,0)
 ;;selected Communities will be included in the export.
"RTN","BIEXP2",200,0)
 ;;
"RTN","BIEXP2",201,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIEXP2",202,0)
 ;;Facilities, only patients who have had AT LEAST ONE immunization
"RTN","BIEXP2",203,0)
 ;;at one of the selected Health Care Facilities will be included in
"RTN","BIEXP2",204,0)
 ;;the export.
"RTN","BIEXP2",205,0)
 ;;
"RTN","BIEXP2",206,0)
 ;;VACCINES: If you select for specific Vaccines, only immunizations
"RTN","BIEXP2",207,0)
 ;;given with the selected vaccines will be included in the export.
"RTN","BIEXP2",208,0)
 ;;
"RTN","BIEXP2",209,0)
 ;;DATE ELEMENTS: Select the group of Data Elements you wish to export
"RTN","BIEXP2",210,0)
 ;;for each immunization.
"RTN","BIEXP2",211,0)
 ;;
"RTN","BIEXP2",212,0)
 ;;SURVEY DATE, PATIENT GROUP, FILE FORMAT and OUTPUT DEVICE:
"RTN","BIEXP2",213,0)
 ;;Detailed help will be given when you select these items.
"RTN","BIEXP2",214,0)
 D PRINTX("TEXT2")
"RTN","BIEXP2",215,0)
 Q
"RTN","BIEXP2",216,0)
 ;
"RTN","BIEXP2",217,0)
 ;
"RTN","BIEXP2",218,0)
 ;----------
"RTN","BIEXP2",219,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIEXP2",220,0)
 Q:$G(BILINL)=""
"RTN","BIEXP2",221,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIEXP2",222,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIEXP2",223,0)
 Q
"RTN","BIEXP2",224,0)
 ;
"RTN","BIEXP2",225,0)
 ;
"RTN","BIEXP2",226,0)
 ;----------
"RTN","BIEXP2",227,0)
EXIT ;EP
"RTN","BIEXP2",228,0)
 ;---> EOJ cleanup.
"RTN","BIEXP2",229,0)
 K ^TMP("BIEXP2",$J)
"RTN","BIEXP2",230,0)
 D CLEAR^VALM1
"RTN","BIEXP2",231,0)
 D FULL^VALM1
"RTN","BIEXP2",232,0)
 Q
"RTN","BIEXP3")
0^29^B10292097
"RTN","BIEXP3",1,0)
BIEXP3 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS.; MAY 10, 2010
"RTN","BIEXP3",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIEXP3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXP3",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: EXPORT ROUTINE
"RTN","BIEXP3",5,0)
 ;;  PATCH 9: Changes to limit export of imms to specific vaccines within
"RTN","BIEXP3",6,0)
 ;;           a date range.  START+75
"RTN","BIEXP3",7,0)
 ;
"RTN","BIEXP3",8,0)
 ;
"RTN","BIEXP3",9,0)
 ;----------
"RTN","BIEXP3",10,0)
START(BIRTN) ;EP
"RTN","BIEXP3",11,0)
 ;---> Export Data.
"RTN","BIEXP3",12,0)
 ;---> Parameters:
"RTN","BIEXP3",13,0)
 ;     1 - BIRTN (req) Calling routine for reset.
"RTN","BIEXP3",14,0)
 ;
"RTN","BIEXP3",15,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIEXP3",16,0)
 ;
"RTN","BIEXP3",17,0)
 ;---> Variables:
"RTN","BIEXP3",18,0)
 ;     1 - BISVDT (req) Survey Date
"RTN","BIEXP3",19,0)
 ;     2 - BIPG   (req) Group of patients (9=Individual)
"RTN","BIEXP3",20,0)
 ;     3 - BIPAT  (opt) Patient DFN's (array) if BIPG=9
"RTN","BIEXP3",21,0)
 ;     4 - BIAG   (req) Age Range (=0 if not limited by age)
"RTN","BIEXP3",22,0)
 ;     5 - BIHCF  (req) Facility (array)
"RTN","BIEXP3",23,0)
 ;     6 - BICC   (req) Current Community (array)
"RTN","BIEXP3",24,0)
 ;     7 - BIMMR  (req) Immunizations Received, IEN's (array)
"RTN","BIEXP3",25,0)
 ;     8 - BIDE   (req) Data Elements to be passed (array)
"RTN","BIEXP3",26,0)
 ;     9 - BIFMT  (req) Format: 1=ASCII,2=HL7,3=ImmServe
"RTN","BIEXP3",27,0)
 ;    10 - BIOUT  (req) Export: 0=screen, 1=host file
"RTN","BIEXP3",28,0)
 ;    11 - BIFLNM (opt) File name
"RTN","BIEXP3",29,0)
 ;    12 - BIPATH (opt) Path name for File
"RTN","BIEXP3",30,0)
 ;
"RTN","BIEXP3",31,0)
 ;    13 - BIMMRF (opt) Immunizations filtered for output, CVX's (array)
"RTN","BIEXP3",32,0)
 ;    14 - BIRDT  (opt) Date Range for Imms Received.
"RTN","BIEXP3",33,0)
 ;
"RTN","BIEXP3",34,0)
 ;
"RTN","BIEXP3",35,0)
 ;---> Check for required variables.
"RTN","BIEXP3",36,0)
 N BIERR S BIERR=""
"RTN","BIEXP3",37,0)
 D
"RTN","BIEXP3",38,0)
 .I '$D(BISVDT) S BIERR=640 Q
"RTN","BIEXP3",39,0)
 .I '$D(BIPG) S BIERR=641 Q
"RTN","BIEXP3",40,0)
 .I BIPG=9&('$O(BIPAT(0))) S BIERR=650 Q
"RTN","BIEXP3",41,0)
 .I '$D(BIAG) S BIERR=642 Q
"RTN","BIEXP3",42,0)
 .I '$D(BIHCF) S BIERR=643 Q
"RTN","BIEXP3",43,0)
 .I '$D(BICC) S BIERR=644 Q
"RTN","BIEXP3",44,0)
 .I '$D(BIMMR) S BIERR=645 Q
"RTN","BIEXP3",45,0)
 .I '$D(BIDE)&(BIFMT=1) S BIERR=646 Q
"RTN","BIEXP3",46,0)
 .I '$D(BIFMT) S BIERR=647 Q
"RTN","BIEXP3",47,0)
 .I '$D(BIOUT) S BIERR=648 Q
"RTN","BIEXP3",48,0)
 .I BIOUT,$G(BIFLNM)="" S BIERR=649 Q
"RTN","BIEXP3",49,0)
 .I BIOUT,$G(BIPATH)="" S BIERR=651 Q
"RTN","BIEXP3",50,0)
 ;
"RTN","BIEXP3",51,0)
 ;---> If an error exists, report it and return to first screen.
"RTN","BIEXP3",52,0)
 I BIERR D  Q
"RTN","BIEXP3",53,0)
 .D ERRCD^BIUTL2(BIERR,,1),@("RESET^"_BIRTN)
"RTN","BIEXP3",54,0)
 ;
"RTN","BIEXP3",55,0)
 ;
"RTN","BIEXP3",56,0)
 D INIT N BIPOP
"RTN","BIEXP3",57,0)
 ;
"RTN","BIEXP3",58,0)
 ;---> If exporting all Data Elements, set them now.
"RTN","BIEXP3",59,0)
 D:$D(BIDE("ALL")) BIDE(.BIDE)
"RTN","BIEXP3",60,0)
 ;
"RTN","BIEXP3",61,0)
 ;---> If format is ImmServe, set Data Elements necessary for ImmServe.
"RTN","BIEXP3",62,0)
 I BIFMT=3 D BIDE^BIPATUP(.BIDE)
"RTN","BIEXP3",63,0)
 ;
"RTN","BIEXP3",64,0)
 ;---> Get okay to proceed.
"RTN","BIEXP3",65,0)
 D FULL^VALM1
"RTN","BIEXP3",66,0)
 D TITLE^BIUTL5("EXPORT IMMUNIZATION RECORDS")
"RTN","BIEXP3",67,0)
 D OKAY^BIEXPRT8(.BIPOP)
"RTN","BIEXP3",68,0)
 I BIPOP D @("RESET^"_BIRTN) Q
"RTN","BIEXP3",69,0)
 ;
"RTN","BIEXP3",70,0)
 ;---> If export is to Host File, open Host File and test access,
"RTN","BIEXP3",71,0)
 ;---> and LEAVE OPEN for export.
"RTN","BIEXP3",72,0)
 D
"RTN","BIEXP3",73,0)
 .I BIOUT D HFS^BIEXPRT8(BIFLNM,.BIPATH,1,.BIPOP) Q
"RTN","BIEXP3",74,0)
 .S IOP=0 D ^%ZIS
"RTN","BIEXP3",75,0)
 I BIPOP D @("RESET^"_BIRTN) Q
"RTN","BIEXP3",76,0)
 ;
"RTN","BIEXP3",77,0)
 ;---> Patients.
"RTN","BIEXP3",78,0)
 D
"RTN","BIEXP3",79,0)
 .;---> If individuals in local array, store in ^BITMP.
"RTN","BIEXP3",80,0)
 .I BIPG=9 D  Q
"RTN","BIEXP3",81,0)
 ..N DFN S DFN=0 F  S DFN=$O(BIPAT(DFN)) Q:'DFN  S ^BITMP($J,1,DFN)=""
"RTN","BIEXP3",82,0)
 .;
"RTN","BIEXP3",83,0)
 .;---> Gather patients by group and store in ^BITMP.
"RTN","BIEXP3",84,0)
 .;
"RTN","BIEXP3",85,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIEXP3",86,0)
 .;---> Changes to limit export of imms to specific vaccines within
"RTN","BIEXP3",87,0)
 .;---> a date range. Parameters BIMMR and BIRDT added below.
"RTN","BIEXP3",88,0)
 .;D PATIENT^BIEXPRT2(BIPG,BIAG,BISVDT,.BIHCF,.BICC)
"RTN","BIEXP3",89,0)
 .D PATIENT^BIEXPRT2(BIPG,BIAG,BISVDT,.BIHCF,.BICC,.BIMMR,$G(BIRDT))
"RTN","BIEXP3",90,0)
 ;
"RTN","BIEXP3",91,0)
 ;---> Gather Immunization History for each patient stored.
"RTN","BIEXP3",92,0)
 ;---> (If not all vaccines, gather only ones selected--BIMMR.)
"RTN","BIEXP3",93,0)
 ;---> If ImmServe export, get vaccines that should not be forecast.
"RTN","BIEXP3",94,0)
 I BIFMT=3 D NOFORC^BIPATUP(.BINF)
"RTN","BIEXP3",95,0)
 ;
"RTN","BIEXP3",96,0)
 D HISTORY^BIEXPRT3(BIFMT,.BIDE,.BIMMRF,,,,.BINF)
"RTN","BIEXP3",97,0)
 ;**********
"RTN","BIEXP3",98,0)
 ;
"RTN","BIEXP3",99,0)
 ;---> Export data.
"RTN","BIEXP3",100,0)
 D WRITE^BIEXPRT4(BIOUT,BIFMT,$G(BIFLNM),$G(BIPATH),,1)
"RTN","BIEXP3",101,0)
 ;
"RTN","BIEXP3",102,0)
 ;---> If Data Element array was built for ImmServe, kill it.
"RTN","BIEXP3",103,0)
 K:BIFMT=3 BIDE
"RTN","BIEXP3",104,0)
 ;
"RTN","BIEXP3",105,0)
 ;---> Return to calling routine.
"RTN","BIEXP3",106,0)
 D @("RESET^"_BIRTN)
"RTN","BIEXP3",107,0)
 Q
"RTN","BIEXP3",108,0)
 ;
"RTN","BIEXP3",109,0)
 ;
"RTN","BIEXP3",110,0)
 ;----------
"RTN","BIEXP3",111,0)
INIT ;EP
"RTN","BIEXP3",112,0)
 ;---> Initialization.
"RTN","BIEXP3",113,0)
 K ^BITMP($J)
"RTN","BIEXP3",114,0)
 D SETVARS^BIUTL5
"RTN","BIEXP3",115,0)
 Q
"RTN","BIEXP3",116,0)
 ;
"RTN","BIEXP3",117,0)
 ;
"RTN","BIEXP3",118,0)
 ;----------
"RTN","BIEXP3",119,0)
BIDE(BIDE) ;EP
"RTN","BIEXP3",120,0)
 ;---> Build local array of ALL Data Elements (for cases when
"RTN","BIEXP3",121,0)
 ;---> user selects all data elements).
"RTN","BIEXP3",122,0)
 ;
"RTN","BIEXP3",123,0)
 N N S N=0
"RTN","BIEXP3",124,0)
 F  S N=$O(^BIEXPDD(N)) Q:'N  S BIDE(N)=""
"RTN","BIEXP3",125,0)
 Q
"RTN","BIEXPRT2")
0^30^B18826693
"RTN","BIEXPRT2",1,0)
BIEXPRT2 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS; MAY 10, 2010
"RTN","BIEXPRT2",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIEXPRT2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXPRT2",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: GATHER PATIENTS ACCORDING TO
"RTN","BIEXPRT2",5,0)
 ;;  CRITERIA AND STORE IN ^BITMP(1,.
"RTN","BIEXPRT2",6,0)
 ;
"RTN","BIEXPRT2",7,0)
 ;
"RTN","BIEXPRT2",8,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIEXPRT2",9,0)
 ;---> Changes to limit export of imms to specific vaccines within
"RTN","BIEXPRT2",10,0)
 ;---> a date range. Parameters BIMMR and BIRDT added below.
"RTN","BIEXPRT2",11,0)
 ;----------
"RTN","BIEXPRT2",12,0)
PATIENT(BIPG,BIAG,BISVDT,BIHCF,BICC,BIMMR,BIRDT) ;EP
"RTN","BIEXPRT2",13,0)
 ;---> Gather patients according to selection criteria and
"RTN","BIEXPRT2",14,0)
 ;---> store in ^BITMP(.
"RTN","BIEXPRT2",15,0)
 ;---> Parameters:
"RTN","BIEXPRT2",16,0)
 ;     1 - BIPG   (req) Patient Group
"RTN","BIEXPRT2",17,0)
 ;     2 - BIAG   (req) Age Range (=0 if not limited by age)
"RTN","BIEXPRT2",18,0)
 ;     3 - BISVDT (req) Survey Date
"RTN","BIEXPRT2",19,0)
 ;     4 - BIHCF  (req) Facility array
"RTN","BIEXPRT2",20,0)
 ;     5 - BICC   (req) Current Community array
"RTN","BIEXPRT2",21,0)
 ;     6 - BIMMR  (opt) Immunizations Received, IEN's (array)
"RTN","BIEXPRT2",22,0)
 ;     7 - BIRDT  (opt) Date Range for Imms received (YYYMMDD:YYYMMDD)
"RTN","BIEXPRT2",23,0)
 ;
"RTN","BIEXPRT2",24,0)
 S BIPOP=0 K ^BITMP($J)
"RTN","BIEXPRT2",25,0)
 ;
"RTN","BIEXPRT2",26,0)
 ;---> If there's an Age Range *or* if the Group is not limited to
"RTN","BIEXPRT2",27,0)
 ;---> the Immunization Register, then scan ^DPT(.
"RTN","BIEXPRT2",28,0)
 I BIAG]""!(BIPG=3) D  Q
"RTN","BIEXPRT2",29,0)
 .;
"RTN","BIEXPRT2",30,0)
 .;---> Set begin and end dates for search through PATIENT File.
"RTN","BIEXPRT2",31,0)
 .D AGEDATE^BIAGE(BIAG,BISVDT,.BIBEGDT,.BIENDDT)
"RTN","BIEXPRT2",32,0)
 .;---> Start 1 day prior to Begin Date and $O into the desired DOB's.
"RTN","BIEXPRT2",33,0)
 .S N=BIBEGDT-1
"RTN","BIEXPRT2",34,0)
 .F  S N=$O(^DPT("ADOB",N)) Q:(N>BIENDDT!('N))  D
"RTN","BIEXPRT2",35,0)
 ..S BIDFN=0
"RTN","BIEXPRT2",36,0)
 ..F  S BIDFN=$O(^DPT("ADOB",N,BIDFN)) Q:'BIDFN  D
"RTN","BIEXPRT2",37,0)
 ...D STORE(BIDFN,BISVDT,BIPG,.BIHCF,.BICC,1,.BIMMR,$G(BIRDT))
"RTN","BIEXPRT2",38,0)
 ;
"RTN","BIEXPRT2",39,0)
 ;---> If there is NO Age Range *and* the Group is limited to the
"RTN","BIEXPRT2",40,0)
 ;---> Immunization Register, then scan ^BIP(.
"RTN","BIEXPRT2",41,0)
 S BIDFN=0
"RTN","BIEXPRT2",42,0)
 F  S BIDFN=$O(^BIP(BIDFN)) Q:'BIDFN  D
"RTN","BIEXPRT2",43,0)
 .D STORE(BIDFN,BISVDT,BIPG,.BIHCF,.BICC,0,.BIMMR,$G(BIRDT))
"RTN","BIEXPRT2",44,0)
 Q
"RTN","BIEXPRT2",45,0)
 ;
"RTN","BIEXPRT2",46,0)
 ;
"RTN","BIEXPRT2",47,0)
 ;----------
"RTN","BIEXPRT2",48,0)
STORE(BIDFN,BISVDT,BIPG,BIHCF,BICC,BIDPT,BIMMR,BIRDT) ;EP
"RTN","BIEXPRT2",49,0)
 ;---> Store patients in ^BITMP if they pass all criteria.
"RTN","BIEXPRT2",50,0)
 ;---> Parameters:
"RTN","BIEXPRT2",51,0)
 ;     1 - BIDFN   (req) Patient Group
"RTN","BIEXPRT2",52,0)
 ;     2 - BISVDT  (req) Survey Date
"RTN","BIEXPRT2",53,0)
 ;     3 - BIPG    (req) Patient Group
"RTN","BIEXPRT2",54,0)
 ;     4 - BIHCF   (req) Facility array
"RTN","BIEXPRT2",55,0)
 ;     5 - BICC    (req) Current Community array
"RTN","BIEXPRT2",56,0)
 ;     6 - BIDPT   (opt) =1 if searching ^DPT, =0 if searching ^BIP.
"RTN","BIEXPRT2",57,0)
 ;     7 - BIMMR   (opt) Immunizations Received, IEN's (array)
"RTN","BIEXPRT2",58,0)
 ;     8 - BIRDT   (opt) Date Range for Imms received (YYYMMDD:YYYMMDD)
"RTN","BIEXPRT2",59,0)
 ;
"RTN","BIEXPRT2",60,0)
 ;---> If Group is ACTIVE and patient was not ACTIVE<BISVDT, Quit.
"RTN","BIEXPRT2",61,0)
 I BIPG=1 Q:$$ACTIVE(BIDFN,BISVDT)
"RTN","BIEXPRT2",62,0)
 ;
"RTN","BIEXPRT2",63,0)
 ;---> If Group is ACTIVE & INACTIVE and patient was not in the
"RTN","BIEXPRT2",64,0)
 ;---> Register, Quit.
"RTN","BIEXPRT2",65,0)
 I $G(BIDPT),BIPG=2 Q:'$D(^BIP(BIDFN))
"RTN","BIEXPRT2",66,0)
 ;
"RTN","BIEXPRT2",67,0)
 ;---> If patient has had NO IMMUNIZATIONS or has had none at
"RTN","BIEXPRT2",68,0)
 ;---> the selected Health Care Facilities, Quit.
"RTN","BIEXPRT2",69,0)
 Q:$$VIMM(BIDFN,.BIHCF)
"RTN","BIEXPRT2",70,0)
 ;
"RTN","BIEXPRT2",71,0)
 ;---> If patient does not have one of the selected Current
"RTN","BIEXPRT2",72,0)
 ;---> Communities, Quit.
"RTN","BIEXPRT2",73,0)
 Q:$$CURCOM(BIDFN,.BICC)
"RTN","BIEXPRT2",74,0)
 ;
"RTN","BIEXPRT2",75,0)
 ;
"RTN","BIEXPRT2",76,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIEXPRT2",77,0)
 ;---> If limited to specific vaccines within a date range, check and
"RTN","BIEXPRT2",78,0)
 ;---> store patient if it's a match.
"RTN","BIEXPRT2",79,0)
 I $O(BIMMR(0)) D  Q
"RTN","BIEXPRT2",80,0)
 .N N,Z S N=0,Z=0 F  S N=$O(BIMMR(N)) Q:'N  Q:Z  D
"RTN","BIEXPRT2",81,0)
 ..I $$GOTDOSE^BIUTL11(BIDFN,N,$G(BIRDT)) S ^BITMP($J,1,BIDFN)="",Z=1
"RTN","BIEXPRT2",82,0)
 ;**********
"RTN","BIEXPRT2",83,0)
 ;
"RTN","BIEXPRT2",84,0)
 ;---> Store this patient for data retrieval.
"RTN","BIEXPRT2",85,0)
 S ^BITMP($J,1,BIDFN)=""
"RTN","BIEXPRT2",86,0)
 Q
"RTN","BIEXPRT2",87,0)
 ;
"RTN","BIEXPRT2",88,0)
 ;
"RTN","BIEXPRT2",89,0)
 ;----------
"RTN","BIEXPRT2",90,0)
ACTIVE(BIDFN,BISVDT) ;EP
"RTN","BIEXPRT2",91,0)
 ;---> Return Active indicator: 0=Active, 1=Inactive.
"RTN","BIEXPRT2",92,0)
 ;---> Called if looking for Active Only.
"RTN","BIEXPRT2",93,0)
 ;---> Parameters:
"RTN","BIEXPRT2",94,0)
 ;     1 - BIDFN   (req) IEN of Patient in ^DPT.
"RTN","BIEXPRT2",95,0)
 ;     2 - BISVDT  (opt) Survey Date.
"RTN","BIEXPRT2",96,0)
 ;
"RTN","BIEXPRT2",97,0)
 ;
"RTN","BIEXPRT2",98,0)
 N X S X=$$INACT^BIUTL1(BIDFN)
"RTN","BIEXPRT2",99,0)
 ;---> If this patient is not in the Register, return 1.
"RTN","BIEXPRT2",100,0)
 Q:X]"A" 1
"RTN","BIEXPRT2",101,0)
 ;---> If this patient is Active, return 0.
"RTN","BIEXPRT2",102,0)
 Q:X="" 0
"RTN","BIEXPRT2",103,0)
 ;---> If this patient was Inactive PRIOR TO the Survey Date return 1.
"RTN","BIEXPRT2",104,0)
 Q:X<$G(BISVDT) 1
"RTN","BIEXPRT2",105,0)
 ;---> This patient became Inactive AFTER the Survey Date return 0.
"RTN","BIEXPRT2",106,0)
 Q 0
"RTN","BIEXPRT2",107,0)
 ;
"RTN","BIEXPRT2",108,0)
 ;
"RTN","BIEXPRT2",109,0)
 ;----------
"RTN","BIEXPRT2",110,0)
CURCOM(BIDFN,BICC) ;EP
"RTN","BIEXPRT2",111,0)
 ;---> Return Current Community indicator.
"RTN","BIEXPRT2",112,0)
 ;---> Return 1 if not selecting all CURRENT COMMUNITIES and if this
"RTN","BIEXPRT2",113,0)
 ;---> patient's CURRENT COMMUNITY is not one of the ones selected.
"RTN","BIEXPRT2",114,0)
 ;---> Parameters:
"RTN","BIEXPRT2",115,0)
 ;     1 - BIDFN  (req) IEN of Patient in ^DPT.
"RTN","BIEXPRT2",116,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIEXPRT2",117,0)
 ;
"RTN","BIEXPRT2",118,0)
 Q:$D(BICC("ALL")) 0
"RTN","BIEXPRT2",119,0)
 N BICUR S BICUR=$$CURCOM^BIUTL11(BIDFN)
"RTN","BIEXPRT2",120,0)
 Q:'BICUR 1
"RTN","BIEXPRT2",121,0)
 Q:'$D(BICC(BICUR)) 1
"RTN","BIEXPRT2",122,0)
 Q 0
"RTN","BIEXPRT2",123,0)
 ;
"RTN","BIEXPRT2",124,0)
 ;
"RTN","BIEXPRT2",125,0)
 ;----------
"RTN","BIEXPRT2",126,0)
VIMM(BIDFN,BIHCF) ;EP
"RTN","BIEXPRT2",127,0)
 ;---> Return Immunization Visit indicator: 1=None, 0=Yes.
"RTN","BIEXPRT2",128,0)
 ;---> Parameters:
"RTN","BIEXPRT2",129,0)
 ;     1 - BIDFN  (req) IEN of Patient in ^DPT.
"RTN","BIEXPRT2",130,0)
 ;     2 - BIHCF  (req) Current Community array.
"RTN","BIEXPRT2",131,0)
 ;
"RTN","BIEXPRT2",132,0)
 ;---> Return 1 if patient has no V IMMUNIZATIONS at all.
"RTN","BIEXPRT2",133,0)
 Q:'$D(^AUPNVIMM("AC",BIDFN)) 1
"RTN","BIEXPRT2",134,0)
 ;---> Return 0 if patient has a V IMMUNIZATION and "ALL" are selected.
"RTN","BIEXPRT2",135,0)
 Q:$D(BIHCF("ALL")) 0
"RTN","BIEXPRT2",136,0)
 ;---> Return 1 if patient does not have an Immunization Visit at the
"RTN","BIEXPRT2",137,0)
 ;---> selected Facilities.
"RTN","BIEXPRT2",138,0)
 N BIFLAG,N,X
"RTN","BIEXPRT2",139,0)
 S N=0,BIFLAG=1
"RTN","BIEXPRT2",140,0)
 F  S N=$O(^AUPNVIMM("AC",BIDFN,N)) Q:'N  Q:'BIFLAG  D
"RTN","BIEXPRT2",141,0)
 .Q:'$D(^AUPNVIMM(N,0))
"RTN","BIEXPRT2",142,0)
 .S Y=$P(^AUPNVIMM(N,0),U,3) Q:'Y
"RTN","BIEXPRT2",143,0)
 .Q:'$D(^AUPNVSIT(Y,0))
"RTN","BIEXPRT2",144,0)
 .S X=$P(^AUPNVSIT(Y,0),U,6)
"RTN","BIEXPRT2",145,0)
 .S:$D(BIHCF(X)) BIFLAG=0
"RTN","BIEXPRT2",146,0)
 Q BIFLAG
"RTN","BIEXPRT2",147,0)
 ;
"RTN","BIEXPRT2",148,0)
 ;
"RTN","BIEXPRT2",149,0)
 ;----------
"RTN","BIEXPRT2",150,0)
VISIT(BIDFN,BIHCF) ;EP
"RTN","BIEXPRT2",151,0)
 ;---> Return Visit indicator.
"RTN","BIEXPRT2",152,0)
 ;**** NOT USED FOR NOW.  Might be used if some report/list wants
"RTN","BIEXPRT2",153,0)
 ;     all patients who have had any type of Visit at a Facility.
"RTN","BIEXPRT2",154,0)
 ;
"RTN","BIEXPRT2",155,0)
 ;---> Return 1 if patient has no VISITS at all.
"RTN","BIEXPRT2",156,0)
 Q:'$D(^AUPNVSIT("AC",BIDFN)) 1
"RTN","BIEXPRT2",157,0)
 ;---> Return 0 if patient has a VISIT and "ALL" are selected.
"RTN","BIEXPRT2",158,0)
 Q:$D(BIHCF("ALL")) 0
"RTN","BIEXPRT2",159,0)
 ;---> Return 1 if patient does not have a VISIT at the selected
"RTN","BIEXPRT2",160,0)
 ;---> Facilities.
"RTN","BIEXPRT2",161,0)
 N BIFLAG,N,X
"RTN","BIEXPRT2",162,0)
 S N=0,BIFLAG=1
"RTN","BIEXPRT2",163,0)
 F  S N=$O(^AUPNVSIT("AC",BIDFN,N)) Q:'N  Q:'BIFLAG  D
"RTN","BIEXPRT2",164,0)
 .Q:'$D(^AUPNVSIT(N,0))
"RTN","BIEXPRT2",165,0)
 .S X=$P(^AUPNVSIT(N,0),U,6)
"RTN","BIEXPRT2",166,0)
 .S:$D(BIHCF(X)) BIFLAG=0
"RTN","BIEXPRT2",167,0)
 Q BIFLAG
"RTN","BIEXPRT2",168,0)
 ;
"RTN","BIEXPRT2",169,0)
 ;
"RTN","BIEXPRT2",170,0)
 ;----------
"RTN","BIEXPRT2",171,0)
HRCN(BIDFN,BIHCF,BIACT) ;EP
"RTN","BIEXPRT2",172,0)
 ;---> Return Health Record Number Indicator.
"RTN","BIEXPRT2",173,0)
 ;---> Return 1 if this patient DOES NOT HAVE an Active HRCN/Chart# at any
"RTN","BIEXPRT2",174,0)
 ;---> of the facilities in the BIHCF array; otherwise, return 0.
"RTN","BIEXPRT2",175,0)
 ;---> Also return 1 if patient has NO Chart# ANYWHERE.
"RTN","BIEXPRT2",176,0)
 ;---> Parameters:
"RTN","BIEXPRT2",177,0)
 ;     1 - BIDFN  (req) IEN of Patient in ^DPT.
"RTN","BIEXPRT2",178,0)
 ;     2 - BIHCF  (req) Health Care Facility array. Can be BIHCF("ALL").
"RTN","BIEXPRT2",179,0)
 ;     3 - BIACT  (opt) If BIACT=1 INCLUDE Patients whose Chart#'s are
"RTN","BIEXPRT2",180,0)
 ;                      INACTIVE.  In other words, return 0 for patients
"RTN","BIEXPRT2",181,0)
 ;                      that have Chart#'s even if they are INACTIVE.
"RTN","BIEXPRT2",182,0)
 ;
"RTN","BIEXPRT2",183,0)
 Q:'$G(BIDFN) 1
"RTN","BIEXPRT2",184,0)
 ;
"RTN","BIEXPRT2",185,0)
 ;---> Quit if patient has no Chart# anywhere.
"RTN","BIEXPRT2",186,0)
 Q:'$O(^AUPNPAT(BIDFN,41,0)) 1
"RTN","BIEXPRT2",187,0)
 ;
"RTN","BIEXPRT2",188,0)
 ;---> Build local array of patient's Chart#'s.
"RTN","BIEXPRT2",189,0)
 N BIHRCN,BIMATCH,M,N
"RTN","BIEXPRT2",190,0)
 S N=0
"RTN","BIEXPRT2",191,0)
 F  S N=$O(^AUPNPAT(BIDFN,41,N)) Q:'N  S BIHRCN(N)=^(N,0)
"RTN","BIEXPRT2",192,0)
 ;
"RTN","BIEXPRT2",193,0)
 ;---> Check for match between array of Chart# Sites and array of HCF's.
"RTN","BIEXPRT2",194,0)
 S BIMATCH=1,M=0
"RTN","BIEXPRT2",195,0)
 F  S M=$O(BIHRCN(M)) Q:'M  D  Q:'BIMATCH
"RTN","BIEXPRT2",196,0)
 .;
"RTN","BIEXPRT2",197,0)
 .;---> If there's a match or if accepting ALL, then check for Inactive.
"RTN","BIEXPRT2",198,0)
 .D:($D(BIHCF(M))!($D(BIHCF("ALL"))))
"RTN","BIEXPRT2",199,0)
 ..;
"RTN","BIEXPRT2",200,0)
 ..;---> Quit if the Chart# is Inactive and the flag to include
"RTN","BIEXPRT2",201,0)
 ..;---> Inactive is not set to 1.
"RTN","BIEXPRT2",202,0)
 ..Q:($P(BIHRCN(M),U,3)&('$G(BIACT)))
"RTN","BIEXPRT2",203,0)
 ..;
"RTN","BIEXPRT2",204,0)
 ..;---> Got a match.
"RTN","BIEXPRT2",205,0)
 ..S BIMATCH=0
"RTN","BIEXPRT2",206,0)
 ;
"RTN","BIEXPRT2",207,0)
 Q BIMATCH
"RTN","BIEXPRT3")
0^31^B81602127
"RTN","BIEXPRT3",1,0)
BIEXPRT3 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS; MAY 10, 2010
"RTN","BIEXPRT3",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIEXPRT3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXPRT3",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: GATHER IMM HISTORIES FOR PATIENTS
"RTN","BIEXPRT3",5,0)
 ;;  STORED IN ^BITMP(.
"RTN","BIEXPRT3",6,0)
 ;;  PATCH 5: Added BI01 for Admin Note at 1-node.  HISTORY+20,HISTORY1+13,+29
"RTN","BIEXPRT3",7,0)
 ;;  PATCH 5: Increase nodes to accommodate Admin Notes.  GLBSET+30
"RTN","BIEXPRT3",8,0)
 ;;  PATCH 8: Changes to accommodate new TCH Forecaster   HISTORY+99
"RTN","BIEXPRT3",9,0)
 ;
"RTN","BIEXPRT3",10,0)
 ;
"RTN","BIEXPRT3",11,0)
 ;----------
"RTN","BIEXPRT3",12,0)
HISTORY(BIFMT,BIDE,BIMM,BIFDT,BISKIN,BIDUZ2,BINF) ;EP
"RTN","BIEXPRT3",13,0)
 ;---> Gather Immunization History for each patient stored in
"RTN","BIEXPRT3",14,0)
 ;---> ^BITMP($J,1 and store data in ^BITMP($J.
"RTN","BIEXPRT3",15,0)
 ;---> Parameters:
"RTN","BIEXPRT3",16,0)
 ;     1 - BIFMT  (req) Format: 0=ASCII Split, 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIEXPRT3",17,0)
 ;     2 - BIDE   (req) Data Elements array (null if HL7)
"RTN","BIEXPRT3",18,0)
 ;     3 - BIMM   (req) Array of Vaccine Types
"RTN","BIEXPRT3",19,0)
 ;     4 - BIFDT  (opt) Forecast Date (date used to calc Imms due).
"RTN","BIEXPRT3",20,0)
 ;                      For when this call is used to pass Imm Hx
"RTN","BIEXPRT3",21,0)
 ;                      to ImmServe for forecasting.
"RTN","BIEXPRT3",22,0)
 ;     5 - BISKIN (opt) BISKIN=1 if skin tests should be included
"RTN","BIEXPRT3",23,0)
 ;                      (ASCII Format only).
"RTN","BIEXPRT3",24,0)
 ;     6 - BIDUZ2 (opt) User's DUZ(2) to indicate Immserve Forecasting
"RTN","BIEXPRT3",25,0)
 ;                      Rules in Patient History data string.
"RTN","BIEXPRT3",26,0)
 ;     7 - BINF   (opt) Array of Vaccine Grp IEN's that should not be forecast.
"RTN","BIEXPRT3",27,0)
 ;
"RTN","BIEXPRT3",28,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIEXPRT3",29,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIEXPRT3",30,0)
 ;
"RTN","BIEXPRT3",31,0)
 ;
"RTN","BIEXPRT3",32,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT3",33,0)
 ;---> Added BI01 for Admin Note at 1-node.
"RTN","BIEXPRT3",34,0)
 ;N BI0,BI012,BIDFN,BIVIMM,BIVSKN
"RTN","BIEXPRT3",35,0)
 N BI0,BI01,BI012,BIDFN,BIVIMM,BIVSKN
"RTN","BIEXPRT3",36,0)
 ;
"RTN","BIEXPRT3",37,0)
 ;---> Do not include Skin Test in HL7 or Immserve Formats.
"RTN","BIEXPRT3",38,0)
 S:BIFMT>1 BISKIN=0 S:'$G(BISKIN) BISKIN=0
"RTN","BIEXPRT3",39,0)
 ;
"RTN","BIEXPRT3",40,0)
 ;---> Gather Histories for all patients stored in ^BITMP($J,1,BIDFN.
"RTN","BIEXPRT3",41,0)
 N IX S IX=$S($$RPMS^BIUTL9():"AC",1:"C") ; Index is C in VISTA, AC in RPMS
"RTN","BIEXPRT3",42,0)
 S BIDFN=0
"RTN","BIEXPRT3",43,0)
 F  S BIDFN=$O(^BITMP($J,1,BIDFN)) Q:'BIDFN  D
"RTN","BIEXPRT3",44,0)
 .;
"RTN","BIEXPRT3",45,0)
 .;---> Gather Immunization History for one patient (BIDFN).
"RTN","BIEXPRT3",46,0)
 .S BIVIMM=0
"RTN","BIEXPRT3",47,0)
 .F  S BIVIMM=$O(^AUPNVIMM(IX,BIDFN,BIVIMM)) Q:'BIVIMM  D
"RTN","BIEXPRT3",48,0)
 ..;
"RTN","BIEXPRT3",49,0)
 ..;---> Gather Immunization data for one visit.
"RTN","BIEXPRT3",50,0)
 ..;---> If this is an invalid pointer, clean up and quit.
"RTN","BIEXPRT3",51,0)
 ..N BIVDATA  S BIVDATA=$G(^AUPNVIMM(BIVIMM,0))
"RTN","BIEXPRT3",52,0)
 ..I BIVDATA="" K ^AUPNVIMM(IX,BIDFN,BIVIMM) Q
"RTN","BIEXPRT3",53,0)
 ..I $P(BIVDATA,U,2)'=BIDFN K ^AUPNVIMM(IX,BIDFN,BIVIMM) Q
"RTN","BIEXPRT3",54,0)
 ..;
"RTN","BIEXPRT3",55,0)
 ..;---> Quit if not selecting all Immunization Types and if this
"RTN","BIEXPRT3",56,0)
 ..;---> record is not one of the Immunization Types selected.
"RTN","BIEXPRT3",57,0)
 ..I '$D(BIMM("ALL")) Q:'$D(BIMM(+BIVDATA))
"RTN","BIEXPRT3",58,0)
 ..;
"RTN","BIEXPRT3",59,0)
 ..;---> Don't pass this if format is ImmServe and it is HL7=0, "OTHER".
"RTN","BIEXPRT3",60,0)
 ..I BIFMT=3 Q:+BIVDATA=137
"RTN","BIEXPRT3",61,0)
 ..;
"RTN","BIEXPRT3",62,0)
 ..;---> If format=0 or 1, build ASCII record; format=3 build IMM/SERVE rec.
"RTN","BIEXPRT3",63,0)
 ..;I BIFMT=1!(BIFMT=3) D HISTORY1(BIVIMM,.BIDE,BIFMT,"I") Q  ;v8.0
"RTN","BIEXPRT3",64,0)
 ..I BIFMT'=2 D HISTORY1(BIVIMM,.BIDE,BIFMT,"I") Q
"RTN","BIEXPRT3",65,0)
 ..;
"RTN","BIEXPRT3",66,0)
 ..;---> If format=2, build HL7 record.
"RTN","BIEXPRT3",67,0)
 ..I BIFMT=2 D HISTORY2(BIVIMM) Q
"RTN","BIEXPRT3",68,0)
 .;
"RTN","BIEXPRT3",69,0)
 .;
"RTN","BIEXPRT3",70,0)
 .;---> NEXT SECTION IS ONLY FOR GATHERING PATIENT SKIN TESTS
"RTN","BIEXPRT3",71,0)
 .;---> TO RETURN IN ASCII CSV.
"RTN","BIEXPRT3",72,0)
 .;---> Quit if not gathering Skin Test history.
"RTN","BIEXPRT3",73,0)
 .Q:'BISKIN
"RTN","BIEXPRT3",74,0)
 .;
"RTN","BIEXPRT3",75,0)
 .;---> Gather Skin Test History for one patient (BIDFN).
"RTN","BIEXPRT3",76,0)
 .;
"RTN","BIEXPRT3",77,0)
 .;---> If BIDE local array for Data Elements is not passed, set
"RTN","BIEXPRT3",78,0)
 .;---> the following Data Elements to be returned by default.
"RTN","BIEXPRT3",79,0)
 .;---> The following are IEN's in ^BIEXPDD(.
"RTN","BIEXPRT3",80,0)
 .;---> IEN PC  DATA
"RTN","BIEXPRT3",81,0)
 .;---> --- --  ----
"RTN","BIEXPRT3",82,0)
 .;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIEXPRT3",83,0)
 .;---> 24  2 = IEN, V File Visit.
"RTN","BIEXPRT3",84,0)
 .;---> 26  3 = Location (or Outside Location) of Visit.
"RTN","BIEXPRT3",85,0)
 .;---> 29  4 = Date of Visit (DD-Mmm-YYYY @HHMM).
"RTN","BIEXPRT3",86,0)
 .;---> 38  5 = Skin Test Result.
"RTN","BIEXPRT3",87,0)
 .;---> 39  6 = Skin Test Reading.
"RTN","BIEXPRT3",88,0)
 .;---> 40  7 = Skin Test date read.
"RTN","BIEXPRT3",89,0)
 .;---> 41  8 = Skin Test Name.
"RTN","BIEXPRT3",90,0)
 .;---> 42  9 = Skin Test Name IEN.
"RTN","BIEXPRT3",91,0)
 .;
"RTN","BIEXPRT3",92,0)
 .D:'$D(BIDE)
"RTN","BIEXPRT3",93,0)
 ..N I F I=24,26,29,38,39,40,41 S BIDE(I)=""
"RTN","BIEXPRT3",94,0)
 .;
"RTN","BIEXPRT3",95,0)
 .S BIVSKN=0
"RTN","BIEXPRT3",96,0)
 .F  S BIVSKN=$O(^AUPNVSK(IX,BIDFN,BIVSKN)) Q:'BIVSKN  D
"RTN","BIEXPRT3",97,0)
 ..;
"RTN","BIEXPRT3",98,0)
 ..;---> Gather Skin Test data for one visit.
"RTN","BIEXPRT3",99,0)
 ..;---> If this is an invalid pointer, clean up and quit.
"RTN","BIEXPRT3",100,0)
 ..I '$D(^AUPNVSK(BIVSKN,0)) K ^AUPNVSK(IX,BIDFN,BIVSKN) Q
"RTN","BIEXPRT3",101,0)
 ..I $P(^AUPNVSK(BIVSKN,0),U,2)'=BIDFN K ^AUPNVSK(IX,BIDFN,BIVSKN) Q
"RTN","BIEXPRT3",102,0)
 ..;
"RTN","BIEXPRT3",103,0)
 ..;---> If format=1, build ASCII record.
"RTN","BIEXPRT3",104,0)
 ..D HISTORY1(BIVSKN,.BIDE,BIFMT,"S") Q
"RTN","BIEXPRT3",105,0)
 ;
"RTN","BIEXPRT3",106,0)
 ;---> If format=HL7, call HL7 generator to populate ^BITMP($J,2.
"RTN","BIEXPRT3",107,0)
 ;I BIFMT=2 S BIHMH=0 D ^BIHIM Q
"RTN","BIEXPRT3",108,0)
 ;
"RTN","BIEXPRT3",109,0)
 ;---> If format=IMM/SERVE, call ^BIEXPRT5 to populate ^BITMP($J,2
"RTN","BIEXPRT3",110,0)
 ;---> with Patient Imm History in ImmServe format.
"RTN","BIEXPRT3",111,0)
 ;
"RTN","BIEXPRT3",112,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIEXPRT3",113,0)
 ;---> Call to new TCH Forecaster.
"RTN","BIEXPRT3",114,0)
 ;I BIFMT=3 D IMMSERV^BIEXPRT5(BIFDT,$G(BIDUZ2),.BINF)
"RTN","BIEXPRT3",115,0)
 I BIFMT=3 D TCHHIST^BIEXPRT6(BIFDT,$G(BIDUZ2),.BINF)
"RTN","BIEXPRT3",116,0)
 ;**********
"RTN","BIEXPRT3",117,0)
 ;
"RTN","BIEXPRT3",118,0)
 Q
"RTN","BIEXPRT3",119,0)
 ;
"RTN","BIEXPRT3",120,0)
 ;
"RTN","BIEXPRT3",121,0)
 ;----------
"RTN","BIEXPRT3",122,0)
HISTORY1(BIVIEN,BIDE,BIFMT,BIVTYPE,BIDATA,BIERR,BISTOR) ;EP
"RTN","BIEXPRT3",123,0)
 ;---> Build a record from one Imm Visit for ASCII export
"RTN","BIEXPRT3",124,0)
 ;---> and set in ^BITMP($J,1/2,.
"RTN","BIEXPRT3",125,0)
 ;---> NOTE: Might actually build TWO/more records if splitting out Combos.
"RTN","BIEXPRT3",126,0)
 ;---> Parameters:
"RTN","BIEXPRT3",127,0)
 ;     1 - BIVIEN  (req) V FILE IEN for unique subscript in ^BITMP(.
"RTN","BIEXPRT3",128,0)
 ;     2 - BIDE    (req) Array of DATA ELEMENTS to be exported.
"RTN","BIEXPRT3",129,0)
 ;     3 - BIFMT   (req) Format: 0=ASCII Split, 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIEXPRT3",130,0)
 ;     4 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIEXPRT3",131,0)
 ;     5 - BIDATA  (ret) Value of the built record for this visit.
"RTN","BIEXPRT3",132,0)
 ;     6 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIEXPRT3",133,0)
 ;     7 - BISTOR  (opt) Store: zero or null=store in ^BITMP; 1=don't.
"RTN","BIEXPRT3",134,0)
 ;
"RTN","BIEXPRT3",135,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT3",136,0)
 ;---> Added BI01 for Admin Note at 1-node.
"RTN","BIEXPRT3",137,0)
 ;N BI0,BI012,BIDATE,BIVG,BISUB,BITMP,BIVPTR,N,Q,V
"RTN","BIEXPRT3",138,0)
 N BI0,BI01,BI012,BIDATE,BIVG,BISUB,BITMP,BIVPTR,N,Q,V
"RTN","BIEXPRT3",139,0)
 ;
"RTN","BIEXPRT3",140,0)
 ;---> Set local variables necessary for collection of Data Elements.
"RTN","BIEXPRT3",141,0)
 ;---> Set subscripts and delimiters necessary for selected format.
"RTN","BIEXPRT3",142,0)
 S BIERR="",BISUB=1,Q="",V=U
"RTN","BIEXPRT3",143,0)
 ;S:BIFMT=1 BISUB=2,Q="""",V="""|"""  ;v8.0
"RTN","BIEXPRT3",144,0)
 S:(BIFMT=1!(BIFMT=0)) BISUB=2,Q="""",V="""|"""
"RTN","BIEXPRT3",145,0)
 ;
"RTN","BIEXPRT3",146,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIEXPRT3",147,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIEXPRT3",148,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIEXPRT3",149,0)
 .D ERRCD^BIUTL2(410,.BIERR)
"RTN","BIEXPRT3",150,0)
 ;
"RTN","BIEXPRT3",151,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT3",152,0)
 ;---> Added BI01 for Admin Note at 1-node.
"RTN","BIEXPRT3",153,0)
 ;---> BI0=Zero node of V FILE Visit; BI012=12 node of V FILE Visit.
"RTN","BIEXPRT3",154,0)
 ;S:BIVTYPE="I" BI0=$G(^AUPNVIMM(BIVIEN,0)),BI012=$G(^(12))
"RTN","BIEXPRT3",155,0)
 ;S:BIVTYPE="S" BI0=$G(^AUPNVSK(BIVIEN,0)),BI012=$G(^(12))
"RTN","BIEXPRT3",156,0)
 S:BIVTYPE="I" BI0=$G(^AUPNVIMM(BIVIEN,0)),BI01=$G(^(1)),BI012=$G(^(12))
"RTN","BIEXPRT3",157,0)
 S:BIVTYPE="S" BI0=$G(^AUPNVSK(BIVIEN,0)),BI01=$G(^(1)),BI012=$G(^(12))
"RTN","BIEXPRT3",158,0)
 I BI0="" D ERRCD^BIUTL2(412,.BIERR) Q
"RTN","BIEXPRT3",159,0)
 ;
"RTN","BIEXPRT3",160,0)
 ;---> Quit if Format is Immserve and Vaccine is "OTHER" (HL7=0).
"RTN","BIEXPRT3",161,0)
 Q:BIFMT=3&($P(BI0,U)=137)
"RTN","BIEXPRT3",162,0)
 ;
"RTN","BIEXPRT3",163,0)
 ;---> BIDFN=DFN of the patient.
"RTN","BIEXPRT3",164,0)
 S BIDFN=$P(BI0,U,2)
"RTN","BIEXPRT3",165,0)
 Q:BIDFN'>0
"RTN","BIEXPRT3",166,0)
 ;
"RTN","BIEXPRT3",167,0)
 ;---> BIVG=Vaccine Group (for grouping).
"RTN","BIEXPRT3",168,0)
 D
"RTN","BIEXPRT3",169,0)
 .I BIVTYPE="I" S BIVG=$$IMMVG^BIUTL2($P(BI0,U),4) Q
"RTN","BIEXPRT3",170,0)
 .;---> If this is not an Immunization (i.e., is a Skin Test),
"RTN","BIEXPRT3",171,0)
 .;---> make it last in grouping order.
"RTN","BIEXPRT3",172,0)
 .S BIVG=99
"RTN","BIEXPRT3",173,0)
 ;
"RTN","BIEXPRT3",174,0)
 ;---> BIVPTR=Visit pointer.
"RTN","BIEXPRT3",175,0)
 S BIVPTR=$P(BI0,U,3)
"RTN","BIEXPRT3",176,0)
 ;
"RTN","BIEXPRT3",177,0)
 ;---> Check for valid pointer to Visit.
"RTN","BIEXPRT3",178,0)
 ;---> Fixed for v8.1.
"RTN","BIEXPRT3",179,0)
 ;I '$G(BIVPTR)!('$D(^AUPNVSIT(BIVPTR,0))) D ERRCD^BIUTL2(412,.BIERR) Q
"RTN","BIEXPRT3",180,0)
 I '$G(BIVPTR) D ERRCD^BIUTL2(412,.BIERR) Q
"RTN","BIEXPRT3",181,0)
 I '$D(^AUPNVSIT(BIVPTR,0)) D ERRCD^BIUTL2(412,.BIERR) Q
"RTN","BIEXPRT3",182,0)
 ;
"RTN","BIEXPRT3",183,0)
 ;---> BIDATE=Date of Immunization (for subscript).
"RTN","BIEXPRT3",184,0)
 S BIDATE=$P($P(^AUPNVSIT(BIVPTR,0),U),".")
"RTN","BIEXPRT3",185,0)
 ;
"RTN","BIEXPRT3",186,0)
 ;---> Build record according to selected Data Elements.
"RTN","BIEXPRT3",187,0)
 ;S:BIFMT=1 BITMP=Q_BIVTYPE  ;v8.0
"RTN","BIEXPRT3",188,0)
 S:(BIFMT=1!(BIFMT=0)) BITMP=Q_BIVTYPE
"RTN","BIEXPRT3",189,0)
 S N=0
"RTN","BIEXPRT3",190,0)
 F  S N=$O(BIDE(N)) Q:'N  D
"RTN","BIEXPRT3",191,0)
 .N X,Y,Z
"RTN","BIEXPRT3",192,0)
 .S Z=^BIEXPDD(N,0),Y=""
"RTN","BIEXPRT3",193,0)
 .;
"RTN","BIEXPRT3",194,0)
 .;---> If this Data Element pertains to this Visit Type (Imm or Skin),
"RTN","BIEXPRT3",195,0)
 .;---> then set Y=value; otherwise leave Y null.
"RTN","BIEXPRT3",196,0)
 .I BIVTYPE=$P(Z,U,4)!($P(Z,U,4)="A") D
"RTN","BIEXPRT3",197,0)
 ..S X=$TR($P(Z,U,2),"~",U) X X
"RTN","BIEXPRT3",198,0)
 .;
"RTN","BIEXPRT3",199,0)
 .I '$D(BITMP) S BITMP=Q_Y Q
"RTN","BIEXPRT3",200,0)
 .S BITMP=BITMP_V_Y
"RTN","BIEXPRT3",201,0)
 S BIDATA=BITMP_Q
"RTN","BIEXPRT3",202,0)
 ;
"RTN","BIEXPRT3",203,0)
 ;---> Get possible components of this immunization.
"RTN","BIEXPRT3",204,0)
 N BICOMPS
"RTN","BIEXPRT3",205,0)
 D
"RTN","BIEXPRT3",206,0)
 .N Y,X,Z S Z=^BIEXPDD(8,0),X=$TR($P(Z,U,2),"~",U) X X
"RTN","BIEXPRT3",207,0)
 .S BICOMPS=Y
"RTN","BIEXPRT3",208,0)
 ;
"RTN","BIEXPRT3",209,0)
 ;---> This Visit data now ready to be returned in BIDATA.
"RTN","BIEXPRT3",210,0)
 ;---> Store record in ^BITMP( for export unless BISTOR>0.
"RTN","BIEXPRT3",211,0)
 Q:$G(BISTOR)
"RTN","BIEXPRT3",212,0)
 ;
"RTN","BIEXPRT3",213,0)
 ;---> BISPLIT is a flag that indicates one or more components have been
"RTN","BIEXPRT3",214,0)
 ;---> GLBSET; therefore do not GLBSET the combination (at end of this sub).
"RTN","BIEXPRT3",215,0)
 N BISPLIT S BISPLIT=0
"RTN","BIEXPRT3",216,0)
 ;---> Only split out combos if format requests it (BIFMT)=0.
"RTN","BIEXPRT3",217,0)
 D:BIFMT=0
"RTN","BIEXPRT3",218,0)
 .N I,Y
"RTN","BIEXPRT3",219,0)
 .;---> For each possible component, set a new node in ^BITMP.
"RTN","BIEXPRT3",220,0)
 .F I=1:1:6 S Y=$P(BICOMPS,";",I) D:Y
"RTN","BIEXPRT3",221,0)
 ..;
"RTN","BIEXPRT3",222,0)
 ..N BIDATA1 S BIDATA1=BIDATA
"RTN","BIEXPRT3",223,0)
 ..;
"RTN","BIEXPRT3",224,0)
 ..;---> If Vaccine Component Name is requested, swap in Component Name.
"RTN","BIEXPRT3",225,0)
 ..D:$D(BIDE(4))
"RTN","BIEXPRT3",226,0)
 ...N BICOMBNM,J,K S K=0
"RTN","BIEXPRT3",227,0)
 ...F J=2:1 S K=$O(BIDE(K)) Q:'K  Q:K=4
"RTN","BIEXPRT3",228,0)
 ...S BICOMBNM=$P(BIDATA1,V,J)
"RTN","BIEXPRT3",229,0)
 ...S $P(BIDATA1,V,J)=$$VNAME^BIUTL2(Y)_" ("_BICOMBNM_")"
"RTN","BIEXPRT3",230,0)
 ..;
"RTN","BIEXPRT3",231,0)
 ..;---> If Vaccine Group IEN is requested, swap in Component Group IEN.
"RTN","BIEXPRT3",232,0)
 ..D:$D(BIDE(55))
"RTN","BIEXPRT3",233,0)
 ...N J,K S K=0
"RTN","BIEXPRT3",234,0)
 ...F J=2:1 S K=$O(BIDE(K)) Q:'K  Q:K=55
"RTN","BIEXPRT3",235,0)
 ...S $P(BIDATA1,V,J)=$$IMMVG^BIUTL2(Y,2)
"RTN","BIEXPRT3",236,0)
 ..;
"RTN","BIEXPRT3",237,0)
 ..;---> If Vaccine Group is requested, swap in Component Group.
"RTN","BIEXPRT3",238,0)
 ..D:$D(BIDE(27))
"RTN","BIEXPRT3",239,0)
 ...N J,K S K=0
"RTN","BIEXPRT3",240,0)
 ...F J=2:1 S K=$O(BIDE(K)) Q:'K  Q:K=27
"RTN","BIEXPRT3",241,0)
 ...S $P(BIDATA1,V,J)=$$IMMVG^BIUTL2(Y,1)
"RTN","BIEXPRT3",242,0)
 ..;
"RTN","BIEXPRT3",243,0)
 ..;---> If Vaccine Component CVX Code is requested, insert in Component CVX.
"RTN","BIEXPRT3",244,0)
 ..D:$D(BIDE(69))
"RTN","BIEXPRT3",245,0)
 ...N J,K S K=0
"RTN","BIEXPRT3",246,0)
 ...F J=2:1 S K=$O(BIDE(K)) Q:'K  Q:K=69
"RTN","BIEXPRT3",247,0)
 ...S $P(BIDATA1,V,J)=$$CODE^BIUTL2(Y)
"RTN","BIEXPRT3",248,0)
 ..;
"RTN","BIEXPRT3",249,0)
 ..;---> Now get Vaccine Component Vaccine Group (for collating below).
"RTN","BIEXPRT3",250,0)
 ..N BIVG S BIVG=$$IMMVG^BIUTL2(Y,4)
"RTN","BIEXPRT3",251,0)
 ..;---> Add a decimal value to each component's Visit IEN for uniqueness.
"RTN","BIEXPRT3",252,0)
 ..N BIVIEN1 S BIVIEN1=BIVIEN_"."_I
"RTN","BIEXPRT3",253,0)
 ..D GLBSET(BISUB,BIDFN,BIVG,BIDATE,BIVIEN1,BIDATA1)
"RTN","BIEXPRT3",254,0)
 ..S BISPLIT=1
"RTN","BIEXPRT3",255,0)
 ;
"RTN","BIEXPRT3",256,0)
 ;---> If components have not aleady been set, then set this immunization.
"RTN","BIEXPRT3",257,0)
 D:'BISPLIT GLBSET(BISUB,BIDFN,BIVG,BIDATE,BIVIEN,BIDATA)
"RTN","BIEXPRT3",258,0)
 Q
"RTN","BIEXPRT3",259,0)
 ;
"RTN","BIEXPRT3",260,0)
 ;
"RTN","BIEXPRT3",261,0)
 ;----------
"RTN","BIEXPRT3",262,0)
GLBSET(BISUB,BIDFN,BIVG,BIDATE,BIVIEN,BIDATA) ;EP
"RTN","BIEXPRT3",263,0)
 ;---> Set this immunization in the ^BITMP global.
"RTN","BIEXPRT3",264,0)
 ;---> This was the point where <MXSTR> errors could occur.
"RTN","BIEXPRT3",265,0)
 ;---> Allow for Maximum Global Length to be as small as 255.
"RTN","BIEXPRT3",266,0)
 ;---> These nodes get picked up in +63^BIEXPRT4.
"RTN","BIEXPRT3",267,0)
 ;---> Parameters:
"RTN","BIEXPRT3",268,0)
 ;     1 - BISUB  (req) Subnode for storing ASCII versus Immserve.
"RTN","BIEXPRT3",269,0)
 ;     2 - BIDFN  (req) Patient IEN.
"RTN","BIEXPRT3",270,0)
 ;     3 - BIVG   (req) Volume Group for this vaccine.
"RTN","BIEXPRT3",271,0)
 ;     4 - BIDATE (req) Date of immunization.
"RTN","BIEXPRT3",272,0)
 ;     5 - BIVIEN (req) V FILE IEN for unique subscript in ^BITMP(.
"RTN","BIEXPRT3",273,0)
 ;     6 - BIDATA (req) Data string for this immunization.
"RTN","BIEXPRT3",274,0)
 ;
"RTN","BIEXPRT3",275,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN)=$E(BIDATA,1,250)
"RTN","BIEXPRT3",276,0)
 Q:$L(BITMP)<251
"RTN","BIEXPRT3",277,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,1)=$E(BIDATA,251,500)
"RTN","BIEXPRT3",278,0)
 Q:$L(BITMP)<501
"RTN","BIEXPRT3",279,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,2)=$E(BIDATA,501,750)
"RTN","BIEXPRT3",280,0)
 Q:$L(BITMP)<751
"RTN","BIEXPRT3",281,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,3)=$E(BIDATA,751,1000)
"RTN","BIEXPRT3",282,0)
 Q:$L(BITMP)<1001
"RTN","BIEXPRT3",283,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,4)=$E(BIDATA,1001,1250)
"RTN","BIEXPRT3",284,0)
 Q:$L(BITMP)<1251
"RTN","BIEXPRT3",285,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,5)=$E(BIDATA,1251,1500)
"RTN","BIEXPRT3",286,0)
 Q:$L(BITMP)<1501
"RTN","BIEXPRT3",287,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,6)=$E(BIDATA,1501,1750)
"RTN","BIEXPRT3",288,0)
 Q:$L(BITMP)<1751
"RTN","BIEXPRT3",289,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,7)=$E(BIDATA,1751,2000)
"RTN","BIEXPRT3",290,0)
 ;
"RTN","BIEXPRT3",291,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT3",292,0)
 ;---> Increase nodes to accommodate Admin Notes.
"RTN","BIEXPRT3",293,0)
 Q:$L(BITMP)<2001
"RTN","BIEXPRT3",294,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,8)=$E(BIDATA,2001,2250)
"RTN","BIEXPRT3",295,0)
 Q:$L(BITMP)<2251
"RTN","BIEXPRT3",296,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,9)=$E(BIDATA,2251,2500)
"RTN","BIEXPRT3",297,0)
 Q:$L(BITMP)<2501
"RTN","BIEXPRT3",298,0)
 S ^BITMP($J,BISUB,BIDFN,BIVG,BIDATE,BIVIEN,10)=$E(BIDATA,2501,2750)
"RTN","BIEXPRT3",299,0)
 ;**********
"RTN","BIEXPRT3",300,0)
 Q
"RTN","BIEXPRT3",301,0)
 ;
"RTN","BIEXPRT3",302,0)
 ;
"RTN","BIEXPRT3",303,0)
 ;----------
"RTN","BIEXPRT3",304,0)
HISTORY2(BIVIMM) ;EP
"RTN","BIEXPRT3",305,0)
 ;---> Build a record for HL7 export and set in ^BITMP($J,1.
"RTN","BIEXPRT3",306,0)
 ;---> Parameters:
"RTN","BIEXPRT3",307,0)
 ;     1 - BIVIMM (req) V IMM IEN for unique subscript in ^BITMP(.
"RTN","BIEXPRT3",308,0)
 ;
"RTN","BIEXPRT3",309,0)
 N BI0,BIDFN,Y
"RTN","BIEXPRT3",310,0)
 ;
"RTN","BIEXPRT3",311,0)
 ;---> BI0=Zero node of V IMM Visit.
"RTN","BIEXPRT3",312,0)
 S BI0=$G(^AUPNVIMM(BIVIMM,0))
"RTN","BIEXPRT3",313,0)
 Q:BI0=""
"RTN","BIEXPRT3",314,0)
 ;
"RTN","BIEXPRT3",315,0)
 ;---> BIDFN=DFN of the patient.
"RTN","BIEXPRT3",316,0)
 S BIDFN=$P(BI0,U,2)
"RTN","BIEXPRT3",317,0)
 Q:BIDFN'>0
"RTN","BIEXPRT3",318,0)
 ;
"RTN","BIEXPRT3",319,0)
 S Y=$P($P(^AUPNVSIT($P(BI0,U,3),0),U),".") ;   get visit date
"RTN","BIEXPRT3",320,0)
 S ^BITMP($J,1,BIDFN,$P(BI0,U),Y,BIVIMM)=""
"RTN","BIEXPRT3",321,0)
 Q
"RTN","BIEXPRT4")
0^32^B18669815
"RTN","BIEXPRT4",1,0)
BIEXPRT4 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS; MAY 10, 2010
"RTN","BIEXPRT4",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIEXPRT4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXPRT4",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: WRITE IMM HISTORIES OF PATIENTS
"RTN","BIEXPRT4",5,0)
 ;;  STORED IN ^BITMP( TO SCREEN, HOST FILE, OR RETURN AS A STRING.
"RTN","BIEXPRT4",6,0)
 ;;  PATCH 1: If string of patient data is too long, set error and quit. WRITE+72
"RTN","BIEXPRT4",7,0)
 ;;  PATCH 5: Increase nodes to accommodate Admin Notes.  WRITE+63
"RTN","BIEXPRT4",8,0)
 ;;  PATCH 8: Changes to accommodate new TCH Forecaster   WRITE+83
"RTN","BIEXPRT4",9,0)
 ;
"RTN","BIEXPRT4",10,0)
 ;
"RTN","BIEXPRT4",11,0)
 ;----------
"RTN","BIEXPRT4",12,0)
WRITE(BIOUT,BIFMT,BIFLNM,BIPATH,BISTRING,BICSV) ;EP
"RTN","BIEXPRT4",13,0)
 ;---> Write (export) data from ^BITMP( to Screen or to Host File.
"RTN","BIEXPRT4",14,0)
 ;---> Parameters:
"RTN","BIEXPRT4",15,0)
 ;     1 - BIOUT    (req) Export: 0=screen, 1=host file, 2=string
"RTN","BIEXPRT4",16,0)
 ;     2 - BIFMT    (req) Format: 1=ASCII, 2=HL7, 3=TCH
"RTN","BIEXPRT4",17,0)
 ;     3 - BIFLNM   (opt) File name
"RTN","BIEXPRT4",18,0)
 ;     4 - BIPATH   (opt) BI Path name for host files
"RTN","BIEXPRT4",19,0)
 ;     5 - BISTRING (ret) Immunization History in "|"-delimited string
"RTN","BIEXPRT4",20,0)
 ;     6 - BICSV    (opt) If BICSV=1 exported data to screen or host
"RTN","BIEXPRT4",21,0)
 ;                        file will be Comma Separated Values; also
"RTN","BIEXPRT4",22,0)
 ;                        first piece "I" for Imm or "S" for Skin Test
"RTN","BIEXPRT4",23,0)
 ;                        will be removed.
"RTN","BIEXPRT4",24,0)
 ;
"RTN","BIEXPRT4",25,0)
 I '$D(^BITMP($J,2)) D  Q
"RTN","BIEXPRT4",26,0)
 .I BIOUT=2 S BISTRING="NO RECORDS TO BE EXPORTED" Q
"RTN","BIEXPRT4",27,0)
 .D ^%ZISC,IO^BIO("NO RECORDS TO BE EXPORTED.","!!?5")
"RTN","BIEXPRT4",28,0)
 .D DIRZ^BIUTL3()
"RTN","BIEXPRT4",29,0)
 ;
"RTN","BIEXPRT4",30,0)
 N BIPOP S BIPOP=0
"RTN","BIEXPRT4",31,0)
 ;
"RTN","BIEXPRT4",32,0)
 ;---> Output to Screen.
"RTN","BIEXPRT4",33,0)
 I 'BIOUT D  Q:BIPOP
"RTN","BIEXPRT4",34,0)
 .D FULL^VALM1
"RTN","BIEXPRT4",35,0)
 .N A S A="Turn on your screen capture now.  Data will follow..."
"RTN","BIEXPRT4",36,0)
 .D IO^BIO(A,"!!?5")
"RTN","BIEXPRT4",37,0)
 .D DIRZ^BIUTL3(.BIPOP) W !
"RTN","BIEXPRT4",38,0)
 .I BIPOP D ^%ZISC,IO^BIO("NO RECORDS EXPORTED.","!?5"),DIRZ^BIUTL3()
"RTN","BIEXPRT4",39,0)
 ;
"RTN","BIEXPRT4",40,0)
 ;
"RTN","BIEXPRT4",41,0)
 ;---> Use IO if output to either SCREEN or FILE (not STRING).
"RTN","BIEXPRT4",42,0)
 U:BIOUT<2 IO
"RTN","BIEXPRT4",43,0)
 N BICOUNT,I,N,M,P,Q,V
"RTN","BIEXPRT4",44,0)
 S BICOUNT=0,BISTRING="",N=0,V=""""
"RTN","BIEXPRT4",45,0)
 ;---> If format=1, ASCII, write field names in first record.
"RTN","BIEXPRT4",46,0)
 I BIFMT=1&(BIOUT'=2) D  W !
"RTN","BIEXPRT4",47,0)
 .F I=0:1 S N=$O(BIDE(N)) Q:'N  W:I "," W V,$P(^BIEXPDD(N,0),U),V
"RTN","BIEXPRT4",48,0)
 ;
"RTN","BIEXPRT4",49,0)
 S N=0
"RTN","BIEXPRT4",50,0)
 F  S N=$O(^BITMP($J,2,N)) Q:'N  D
"RTN","BIEXPRT4",51,0)
 .S M=0
"RTN","BIEXPRT4",52,0)
 .F  S M=$O(^BITMP($J,2,N,M)) Q:'M  D
"RTN","BIEXPRT4",53,0)
 ..;
"RTN","BIEXPRT4",54,0)
 ..;---> Stop at this level subscript for HL7 format.
"RTN","BIEXPRT4",55,0)
 ..I BIFMT=2 W ^BITMP($J,2,N,M),! S BICOUNT=BICOUNT+1 Q
"RTN","BIEXPRT4",56,0)
 ..;
"RTN","BIEXPRT4",57,0)
 ..S P=0
"RTN","BIEXPRT4",58,0)
 ..F  S P=$O(^BITMP($J,2,N,M,P)) Q:'P  D
"RTN","BIEXPRT4",59,0)
 ...S Q=0
"RTN","BIEXPRT4",60,0)
 ...;---> Continue to this level subscript for ASCII and TCH formats.
"RTN","BIEXPRT4",61,0)
 ...F  S Q=$O(^BITMP($J,2,N,M,P,Q)) Q:'Q  D
"RTN","BIEXPRT4",62,0)
 ....;
"RTN","BIEXPRT4",63,0)
 ....N X
"RTN","BIEXPRT4",64,0)
 ....S X=^BITMP($J,2,N,M,P,Q)
"RTN","BIEXPRT4",65,0)
 ....;---> These additional nodes may be set in +170^BIEXPRT5
"RTN","BIEXPRT4",66,0)
 ....;---> or in +182^BIEXPRT3.
"RTN","BIEXPRT4",67,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,1)) X=X_^(1)
"RTN","BIEXPRT4",68,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,2)) X=X_^(2)
"RTN","BIEXPRT4",69,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,3)) X=X_^(3)
"RTN","BIEXPRT4",70,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,4)) X=X_^(4)
"RTN","BIEXPRT4",71,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,5)) X=X_^(5)
"RTN","BIEXPRT4",72,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,6)) X=X_^(6)
"RTN","BIEXPRT4",73,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,7)) X=X_^(7)
"RTN","BIEXPRT4",74,0)
 ....;
"RTN","BIEXPRT4",75,0)
 ....;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT4",76,0)
 ....;---> Increase nodes to accommodate Admin Notes.
"RTN","BIEXPRT4",77,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,8)) X=X_^(8)
"RTN","BIEXPRT4",78,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,9)) X=X_^(9)
"RTN","BIEXPRT4",79,0)
 ....S:$D(^BITMP($J,2,N,M,P,Q,10)) X=X_^(10)
"RTN","BIEXPRT4",80,0)
 ....;**********
"RTN","BIEXPRT4",81,0)
 ....;
"RTN","BIEXPRT4",82,0)
 ....;---> If BICSV=1, translate to Comma Separated Values,
"RTN","BIEXPRT4",83,0)
 ....;---> and remove first piece ("I" for Imm, "S" for Skin Test).
"RTN","BIEXPRT4",84,0)
 ....I $G(BICSV)&(BIFMT=1) S X=$TR(X,"|",","),X=$P(X,",",2,99)
"RTN","BIEXPRT4",85,0)
 ....;
"RTN","BIEXPRT4",86,0)
 ....;---> If export is to a string; build string and quit.
"RTN","BIEXPRT4",87,0)
 ....;
"RTN","BIEXPRT4",88,0)
 ....;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIEXPRT4",89,0)
 ....;---> If string of patient data is too long, set error and quit.
"RTN","BIEXPRT4",90,0)
 ....;I BIOUT=2 S BISTRING=BISTRING_X_U Q
"RTN","BIEXPRT4",91,0)
 ....I BIOUT=2 D  Q
"RTN","BIEXPRT4",92,0)
 .....I ($L(BISTRING)+$L(X))>32760 D  Q
"RTN","BIEXPRT4",93,0)
 ......S BISTRING="PATIENT HISTORY EXCEEDS MAXIMUM LENGTH"
"RTN","BIEXPRT4",94,0)
 .....;
"RTN","BIEXPRT4",95,0)
 .....;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIEXPRT4",96,0)
 .....;---> Do not terminate BISTRING with "^" if Format=TCH.
"RTN","BIEXPRT4",97,0)
 .....I BIFMT=3 S BISTRING=BISTRING_X Q
"RTN","BIEXPRT4",98,0)
 .....;---> Format is ASCII, so terminate Imms with "^".
"RTN","BIEXPRT4",99,0)
 .....S BISTRING=BISTRING_X_U
"RTN","BIEXPRT4",100,0)
 .....;**********
"RTN","BIEXPRT4",101,0)
 ....;
"RTN","BIEXPRT4",102,0)
 ....;---> Export is to host file or screen.
"RTN","BIEXPRT4",103,0)
 ....W X,! S BICOUNT=BICOUNT+1
"RTN","BIEXPRT4",104,0)
 ;
"RTN","BIEXPRT4",105,0)
 I BIOUT=2 S BISTRING=$TR(BISTRING,"""","") Q
"RTN","BIEXPRT4",106,0)
 D ^%ZISC
"RTN","BIEXPRT4",107,0)
 I BIOUT D
"RTN","BIEXPRT4",108,0)
 .N A S A="File "_BIPATH_BIFLNM_" saved to Host File Server."
"RTN","BIEXPRT4",109,0)
 .D IO^BIO(A,"!!?5")
"RTN","BIEXPRT4",110,0)
 D IO^BIO("Records exported: "_BICOUNT,"!!?5")
"RTN","BIEXPRT4",111,0)
 D DIRZ^BIUTL3()
"RTN","BIEXPRT4",112,0)
 Q
"RTN","BIEXPRT5")
0^33^B115588358
"RTN","BIEXPRT5",1,0)
BIEXPRT5 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS; OCT 15, 2010
"RTN","BIEXPRT5",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIEXPRT5",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXPRT5",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: BUILD IMMSERVE EXPORT.
"RTN","BIEXPRT5",5,0)
 ;;  CALLED BY BIEXPRT3.
"RTN","BIEXPRT5",6,0)
 ;;  PATCH 2: Include CVX 20 (DTaP) in translation to -13, so that
"RTN","BIEXPRT5",7,0)
 ;;           DTaP satisfies Tdap.   DOSES+42
"RTN","BIEXPRT5",8,0)
 ;;  PATCH 5: Translate new Flu codes to 15 for Immserve.  DOSES+54
"RTN","BIEXPRT5",9,0)
 ;
"RTN","BIEXPRT5",10,0)
 ;
"RTN","BIEXPRT5",11,0)
 ;----------
"RTN","BIEXPRT5",12,0)
IMMSERV(BIFDT,BIDUZ2,BINF) ;EP
"RTN","BIEXPRT5",13,0)
 ;---> Called by BIEXPRT3.
"RTN","BIEXPRT5",14,0)
 ;---> Construct ^BITMP($J,2 nodes for ImmServe exports from the
"RTN","BIEXPRT5",15,0)
 ;---> ^BITMP($J,1 nodes (gathered in ^BIEXPRT2).
"RTN","BIEXPRT5",16,0)
 ;---> This prepares the string of Patient Data to be sent to
"RTN","BIEXPRT5",17,0)
 ;---> Immserve for forecasting.
"RTN","BIEXPRT5",18,0)
 ;---> Parameters:
"RTN","BIEXPRT5",19,0)
 ;     1 - BIFDT  (opt) Forecast Date (date used to calc Imms due).
"RTN","BIEXPRT5",20,0)
 ;     2 - BIDUZ2 (opt) User's DUZ(2) for BISITE parameters,
"RTN","BIEXPRT5",21,0)
 ;                      which affect forecasting rules.
"RTN","BIEXPRT5",22,0)
 ;     3 - BINF   (opt) Array of Vaccine IEN's that should not be forecast.
"RTN","BIEXPRT5",23,0)
 ;
"RTN","BIEXPRT5",24,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIEXPRT5",25,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIEXPRT5",26,0)
 ;
"RTN","BIEXPRT5",27,0)
 ;---> If no BIDUZ2, try DUZ(2); otherwise, defaults will be used.
"RTN","BIEXPRT5",28,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIEXPRT5",29,0)
 ;
"RTN","BIEXPRT5",30,0)
 N BIDFN S BIDFN=0
"RTN","BIEXPRT5",31,0)
 F  S BIDFN=$O(^BITMP($J,1,BIDFN)) Q:'BIDFN  D
"RTN","BIEXPRT5",32,0)
 .N BIAGE,BIDOSES,BIMM,BITMP,BITMP1 S BIDOSES=0,BIMM=0,BITMP=""
"RTN","BIEXPRT5",33,0)
 .;---> Set Patient Age in Years for this Forecast Date.
"RTN","BIEXPRT5",34,0)
 .S BIAGE=$$AGE^BIUTL1(BIDFN,1,BIFDT)
"RTN","BIEXPRT5",35,0)
 .F  S BIMM=$O(^BITMP($J,1,BIDFN,BIMM)) Q:'BIMM  D
"RTN","BIEXPRT5",36,0)
 ..N BIDATE,Y S BIDATE=0
"RTN","BIEXPRT5",37,0)
 ..F  S BIDATE=$O(^BITMP($J,1,BIDFN,BIMM,BIDATE)) Q:'BIDATE  D
"RTN","BIEXPRT5",38,0)
 ...N BIVIMM,Y S BIVIMM=0
"RTN","BIEXPRT5",39,0)
 ...F  S BIVIMM=$O(^BITMP($J,1,BIDFN,BIMM,BIDATE,BIVIMM)) Q:'BIVIMM  D
"RTN","BIEXPRT5",40,0)
 ....;---> Tack on V Imm IEN for matching ImmServe History.
"RTN","BIEXPRT5",41,0)
 ....S Y=^BITMP($J,1,BIDFN,BIMM,BIDATE,BIVIMM)_"^"_BIVIMM
"RTN","BIEXPRT5",42,0)
 ....D DOSES(Y,BIAGE,.BITMP,.BIDOSES)
"RTN","BIEXPRT5",43,0)
 .;
"RTN","BIEXPRT5",44,0)
 .;---> Log Errors (Field 1).  1=Do log errors, 0=Do NOT log errors.   vvv83
"RTN","BIEXPRT5",45,0)
 .S BITMP1=+$P($G(^BISITE(+BIDUZ2,0)),U,26)
"RTN","BIEXPRT5",46,0)
 .;
"RTN","BIEXPRT5",47,0)
 .;---> Date used for Forecast (Field 2).
"RTN","BIEXPRT5",48,0)
 .S BITMP1=BITMP1_U_$$NOSLDT^BIUTL5(BIFDT)
"RTN","BIEXPRT5",49,0)
 .;
"RTN","BIEXPRT5",50,0)
 .;---> Fields 3-8 ignored by ImmServe.
"RTN","BIEXPRT5",51,0)
 .S BITMP1=BITMP1_"^0^0^0^0^0^0"
"RTN","BIEXPRT5",52,0)
 .;
"RTN","BIEXPRT5",53,0)
 .;---> Forecasting Mode: Minimum vs. Recommended Age (Field 9).
"RTN","BIEXPRT5",54,0)
 .S BITMP1=BITMP1_U_$$MINAGE^BIUTL2(BIDUZ2)
"RTN","BIEXPRT5",55,0)
 .;
"RTN","BIEXPRT5",56,0)
 .;---> Numbered Dose Processing Flag: Ignore Dose Numbers (Field 10).
"RTN","BIEXPRT5",57,0)
 .S BITMP1=BITMP1_U_"I"
"RTN","BIEXPRT5",58,0)
 .;
"RTN","BIEXPRT5",59,0)
 .;---> Invalid/Valid Dose Forecasting Interval: I-Consider Interval (Field 11).
"RTN","BIEXPRT5",60,0)
 .S BITMP1=BITMP1_U_"I"
"RTN","BIEXPRT5",61,0)
 .;
"RTN","BIEXPRT5",62,0)
 .;---> HEP B Series (Vaccine Group) Activation Flag (Field 12).
"RTN","BIEXPRT5",63,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(4)):0,1:1)
"RTN","BIEXPRT5",64,0)
 .;
"RTN","BIEXPRT5",65,0)
 .;---> DTP Series (Vaccine Group) Activation Flag (Field 13).
"RTN","BIEXPRT5",66,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(1)):0,1:1)
"RTN","BIEXPRT5",67,0)
 .;
"RTN","BIEXPRT5",68,0)
 .;---> Td ADULT/Booster Series (V Group) Activation Flag (Field 14).
"RTN","BIEXPRT5",69,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(8)):0,1:1)
"RTN","BIEXPRT5",70,0)
 .;
"RTN","BIEXPRT5",71,0)
 .;---> HIB Series (Vaccine Group) Activation Flag (Field 15).
"RTN","BIEXPRT5",72,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(3)):0,1:1)
"RTN","BIEXPRT5",73,0)
 .;
"RTN","BIEXPRT5",74,0)
 .;---> POLIO Series (Vaccine Group) Activation Flag (Field 16).
"RTN","BIEXPRT5",75,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(2)):0,1:1)
"RTN","BIEXPRT5",76,0)
 .;
"RTN","BIEXPRT5",77,0)
 .;---> MMR Series (Vaccine Group) Activation Flag (Field 17).
"RTN","BIEXPRT5",78,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(6)):0,1:1)
"RTN","BIEXPRT5",79,0)
 .;
"RTN","BIEXPRT5",80,0)
 .;---> HEP A Series (Vaccine Group) Activation Flag (Field 18).
"RTN","BIEXPRT5",81,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(9)):0,1:1)
"RTN","BIEXPRT5",82,0)
 .;
"RTN","BIEXPRT5",83,0)
 .;---> VARICELLA Series (Vaccine Group) Activation Flag (Field 19).
"RTN","BIEXPRT5",84,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(7)):0,1:1)
"RTN","BIEXPRT5",85,0)
 .;
"RTN","BIEXPRT5",86,0)
 .;---> ROTAVIRUS Series (Vaccine Group) Activation Flag (Field 20).
"RTN","BIEXPRT5",87,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(15)):0,1:1)
"RTN","BIEXPRT5",88,0)
 .;
"RTN","BIEXPRT5",89,0)
 .;---> PNEUMO-CONJ Series (Vaccine Group) Activation Flag (Field 21).
"RTN","BIEXPRT5",90,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(11)):0,1:1)
"RTN","BIEXPRT5",91,0)
 .;
"RTN","BIEXPRT5",92,0)
 .;---> INFLUENZA Series (Vaccine Group) Activation Flag (Field 22).
"RTN","BIEXPRT5",93,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(10)):0,1:1)
"RTN","BIEXPRT5",94,0)
 .;
"RTN","BIEXPRT5",95,0)
 .;---> MENINGOCOCAL Series (Vaccine Group) Activation Flag (Field 23).
"RTN","BIEXPRT5",96,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(16)):0,1:1)
"RTN","BIEXPRT5",97,0)
 .;
"RTN","BIEXPRT5",98,0)
 .;---> HPV Series (Vaccine Group) Activation Flag (Field 24).
"RTN","BIEXPRT5",99,0)
 .S BITMP1=BITMP1_U_$S($D(BINF(17)):0,1:1)
"RTN","BIEXPRT5",100,0)
 .;
"RTN","BIEXPRT5",101,0)
 .;---> H1N1 Series (Vaccine Group) Activation Flag (Field 25).
"RTN","BIEXPRT5",102,0)
 .;---> Imm Program has said to disable H1N1 forecasting.
"RTN","BIEXPRT5",103,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT5",104,0)
 .;
"RTN","BIEXPRT5",105,0)
 .;---> Version (Field 26).
"RTN","BIEXPRT5",106,0)
 .S BITMP1=BITMP1_U_$$RULES^BIUTL2(BIDUZ2)
"RTN","BIEXPRT5",107,0)
 .;
"RTN","BIEXPRT5",108,0)
 .;---> Forecasting days/month (Field 27).
"RTN","BIEXPRT5",109,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT5",110,0)
 .;
"RTN","BIEXPRT5",111,0)
 .;---> Retrospective Analysis days/month (Field 28).
"RTN","BIEXPRT5",112,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT5",113,0)
 .;
"RTN","BIEXPRT5",114,0)
 .;---> Personal ID: Patient Name and Chart# (Field 29)
"RTN","BIEXPRT5",115,0)
 .S BITMP1=BITMP1_U_$$NAME^BIUTL1(BIDFN)
"RTN","BIEXPRT5",116,0)
 .S BITMP1=BITMP1_"  Chart#: "_$$HRCN^BIUTL1(BIDFN)
"RTN","BIEXPRT5",117,0)
 .;
"RTN","BIEXPRT5",118,0)
 .;---> User Note: DFN  (Field 30)
"RTN","BIEXPRT5",119,0)
 .S BITMP1=BITMP1_U_BIDFN
"RTN","BIEXPRT5",120,0)
 .;
"RTN","BIEXPRT5",121,0)
 .;---> Date of Birth (Field 31).
"RTN","BIEXPRT5",122,0)
 .S BITMP1=BITMP1_U_$$NOSLDT^BIUTL5($$DOB^BIUTL1(BIDFN))
"RTN","BIEXPRT5",123,0)
 .;
"RTN","BIEXPRT5",124,0)
 .;---> Gender (Field 32).
"RTN","BIEXPRT5",125,0)
 .S BITMP1=BITMP1_U_$$SEXW^BIUTL1(BIDFN)
"RTN","BIEXPRT5",126,0)
 .;
"RTN","BIEXPRT5",127,0)
 .;---> Mother HBsAg Status: P,N,U,A  (Field 33).
"RTN","BIEXPRT5",128,0)
 .S BITMP1=BITMP1_U_$$MOTHER^BIUTL11(BIDFN)
"RTN","BIEXPRT5",129,0)
 .;
"RTN","BIEXPRT5",130,0)
 .;---> Build array of contraindicated HL7 Codes for this Patient.
"RTN","BIEXPRT5",131,0)
 .N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIEXPRT5",132,0)
 .;
"RTN","BIEXPRT5",133,0)
 .;---> Pertussis Indication (Field 34).
"RTN","BIEXPRT5",134,0)
 .D
"RTN","BIEXPRT5",135,0)
 ..;---> If patient has contra to DTP or DTaP, pass contra to pertussis.
"RTN","BIEXPRT5",136,0)
 ..N I,J S J=0 F I=1,11,20 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT5",137,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT5",138,0)
 .;
"RTN","BIEXPRT5",139,0)
 .;---> Diphtheria Indication (Field 35).
"RTN","BIEXPRT5",140,0)
 .D
"RTN","BIEXPRT5",141,0)
 ..;---> If pt has contra to DT-PEDS or TD-Adult, pass contra to Diph.
"RTN","BIEXPRT5",142,0)
 ..N I,J S J=0 F I=28,9 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT5",143,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT5",144,0)
 .;
"RTN","BIEXPRT5",145,0)
 .;---> Tetanus Indication (Field 36).
"RTN","BIEXPRT5",146,0)
 .D
"RTN","BIEXPRT5",147,0)
 ..;---> If pt has contra to TET TOX,
"RTN","BIEXPRT5",148,0)
 ..;---> pass contra to Tetanus.
"RTN","BIEXPRT5",149,0)
 ..N I,J S J=0 F I=28,9,35 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT5",150,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT5",151,0)
 .;
"RTN","BIEXPRT5",152,0)
 .;---> Hib Indication (Field 37).
"RTN","BIEXPRT5",153,0)
 .D
"RTN","BIEXPRT5",154,0)
 ..;---> If pt has contra to any HIB, pass contra to HIB.
"RTN","BIEXPRT5",155,0)
 ..N I,J S J=0 F I=17,46,47,48,49 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT5",156,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT5",157,0)
 .;
"RTN","BIEXPRT5",158,0)
 .;---> HBIG Indication (Field 38).
"RTN","BIEXPRT5",159,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(30)):1,1:0)
"RTN","BIEXPRT5",160,0)
 .;
"RTN","BIEXPRT5",161,0)
 .;---> HepB Indication (Field 39).
"RTN","BIEXPRT5",162,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(45)):1,1:0)
"RTN","BIEXPRT5",163,0)
 .;
"RTN","BIEXPRT5",164,0)
 .;---> OPV Indication (Field 40).
"RTN","BIEXPRT5",165,0)
 .;---> 2003: ImmServe no longer forecasts OPV.
"RTN","BIEXPRT5",166,0)
 .;S BITMP1=BITMP1_U_$S($D(BICT(2)):1,$D(BINF(2)):1,1:0)
"RTN","BIEXPRT5",167,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT5",168,0)
 .;
"RTN","BIEXPRT5",169,0)
 .;---> IPV Indication (Field 41).
"RTN","BIEXPRT5",170,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(10)):1,1:0)
"RTN","BIEXPRT5",171,0)
 .;
"RTN","BIEXPRT5",172,0)
 .;---> Measles Indication (Field 42).
"RTN","BIEXPRT5",173,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(5)):1,1:0)
"RTN","BIEXPRT5",174,0)
 .;
"RTN","BIEXPRT5",175,0)
 .;---> Mumps Indication (Field 43).
"RTN","BIEXPRT5",176,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(7)):1,1:0)
"RTN","BIEXPRT5",177,0)
 .;
"RTN","BIEXPRT5",178,0)
 .;---> Rubella Indication (Field 44).
"RTN","BIEXPRT5",179,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(6)):1,1:0)
"RTN","BIEXPRT5",180,0)
 .;
"RTN","BIEXPRT5",181,0)
 .;---> Varicella Indication (Field 45).
"RTN","BIEXPRT5",182,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(21)):1,1:0)
"RTN","BIEXPRT5",183,0)
 .;
"RTN","BIEXPRT5",184,0)
 .;---> HepA Indication (Field 46).
"RTN","BIEXPRT5",185,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(85)):1,1:0)
"RTN","BIEXPRT5",186,0)
 .;
"RTN","BIEXPRT5",187,0)
 .;---> Rotavirus Indication (Field 47).
"RTN","BIEXPRT5",188,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(74)):1,1:0)
"RTN","BIEXPRT5",189,0)
 .;
"RTN","BIEXPRT5",190,0)
 .;---> Pneumococcal Indication (Field 48).
"RTN","BIEXPRT5",191,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(100)):1,1:0)
"RTN","BIEXPRT5",192,0)
 .;
"RTN","BIEXPRT5",193,0)
 .;---> Influenza Indication (Field 49).
"RTN","BIEXPRT5",194,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(88)):1,1:0)
"RTN","BIEXPRT5",195,0)
 .;
"RTN","BIEXPRT5",196,0)
 .;---> Meningococcal Indication (Field 50).
"RTN","BIEXPRT5",197,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(32)):1,1:0)
"RTN","BIEXPRT5",198,0)
 .;
"RTN","BIEXPRT5",199,0)
 .;---> HPV Indication (Field 51).
"RTN","BIEXPRT5",200,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(62)):1,1:0)
"RTN","BIEXPRT5",201,0)
 .;
"RTN","BIEXPRT5",202,0)
 .;---> H1N1 Indication (Field 52).
"RTN","BIEXPRT5",203,0)
 .D
"RTN","BIEXPRT5",204,0)
 ..;---> If pt has contra to any H1N1, pass contra to H1N1.
"RTN","BIEXPRT5",205,0)
 ..N I,J S J=0 F I=125,126,127,128 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT5",206,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT5",207,0)
 .;
"RTN","BIEXPRT5",208,0)
 .;---> Number of Input Doses (Field 53).
"RTN","BIEXPRT5",209,0)
 .S BITMP1=BITMP1_U_BIDOSES
"RTN","BIEXPRT5",210,0)
 .;
"RTN","BIEXPRT5",211,0)
 .;---> Allow for Maximum Global Length to be as small as 255.
"RTN","BIEXPRT5",212,0)
 .;---> This gets picked up in +63^BIEXPRT4.
"RTN","BIEXPRT5",213,0)
 .S BITMP=BITMP1_BITMP
"RTN","BIEXPRT5",214,0)
 .S ^BITMP($J,2,BIDFN,1,1,1)=$E(BITMP,1,250)
"RTN","BIEXPRT5",215,0)
 .S:$L(BITMP)>250 ^BITMP($J,2,BIDFN,1,1,1,1)=$E(BITMP,251,500)
"RTN","BIEXPRT5",216,0)
 .S:$L(BITMP)>500 ^BITMP($J,2,BIDFN,1,1,1,2)=$E(BITMP,501,750)
"RTN","BIEXPRT5",217,0)
 .S:$L(BITMP)>750 ^BITMP($J,2,BIDFN,1,1,1,3)=$E(BITMP,751,1000)
"RTN","BIEXPRT5",218,0)
 .S:$L(BITMP)>1000 ^BITMP($J,2,BIDFN,1,1,1,4)=$E(BITMP,1001,1250)
"RTN","BIEXPRT5",219,0)
 .S:$L(BITMP)>1250 ^BITMP($J,2,BIDFN,1,1,1,5)=$E(BITMP,1251,1500)
"RTN","BIEXPRT5",220,0)
 .S:$L(BITMP)>1500 ^BITMP($J,2,BIDFN,1,1,1,6)=$E(BITMP,1501,1750)
"RTN","BIEXPRT5",221,0)
 .S:$L(BITMP)>1750 ^BITMP($J,2,BIDFN,1,1,1,7)=$E(BITMP,1751,2000)
"RTN","BIEXPRT5",222,0)
 Q
"RTN","BIEXPRT5",223,0)
 ;
"RTN","BIEXPRT5",224,0)
 ;----------
"RTN","BIEXPRT5",225,0)
DOSES(Y,BIAGE,BITMP,BIDOSES) ;EP
"RTN","BIEXPRT5",226,0)
 ;---> Add data (5 Immserve fields) for one dose to BITMP.
"RTN","BIEXPRT5",227,0)
 ;---> Parameters:
"RTN","BIEXPRT5",228,0)
 ;     1 - Y       (req) Data for one visit, stored in ^BITMP($J,1,BIDFN...
"RTN","BIEXPRT5",229,0)
 ;                       Date^HL7 Code^Dose Override^V Imm IEN.
"RTN","BIEXPRT5",230,0)
 ;     2 - BIAGE   (req) Patient Age in years (for translating Td).
"RTN","BIEXPRT5",231,0)
 ;     3 - BITMP   (ret) Data returned for one "Input Dose" to ImmServe.
"RTN","BIEXPRT5",232,0)
 ;                       Dose Note (V Imm IEN)^HL7 Code^Dose Number^Date of Dose
"RTN","BIEXPRT5",233,0)
 ;                       ^Dose Override.
"RTN","BIEXPRT5",234,0)
 ;     4 - BIDOSES (ret) Total number of doses being collected to
"RTN","BIEXPRT5",235,0)
 ;                       pass to ImmServe.
"RTN","BIEXPRT5",236,0)
 ;
"RTN","BIEXPRT5",237,0)
 Q:$G(Y)=""
"RTN","BIEXPRT5",238,0)
 S:$G(BITMP)="" BITMP=""
"RTN","BIEXPRT5",239,0)
 S:$G(BIDOSES)="" BIDOSES=0
"RTN","BIEXPRT5",240,0)
 ;
"RTN","BIEXPRT5",241,0)
 ;---> Quit if no Dose HL7 Code or if NULL.
"RTN","BIEXPRT5",242,0)
 Q:"NULL"[$P(Y,U,2)
"RTN","BIEXPRT5",243,0)
 ;
"RTN","BIEXPRT5",244,0)
 ;************************
"RTN","BIEXPRT5",245,0)
 ;---> Temp fix for Kinrix until v8.31.
"RTN","BIEXPRT5",246,0)
 ;
"RTN","BIEXPRT5",247,0)
 ;********** PATCH 1, v8.3.1, Dec 30,2008, IHS/CMI/MWR
"RTN","BIEXPRT5",248,0)
 ;---> Next line commented out; KINFIX call no longer necessary (Immserve updated).
"RTN","BIEXPRT5",249,0)
 ;---> But retain this call in case a future vaccine combo needs to be interpreted
"RTN","BIEXPRT5",250,0)
 ;---> ahead of an Immserve update.
"RTN","BIEXPRT5",251,0)
 ;
"RTN","BIEXPRT5",252,0)
 ;I $P(Y,U,2)=130 D KINFIX(Y) Q
"RTN","BIEXPRT5",253,0)
 ;
"RTN","BIEXPRT5",254,0)
 ;---> Temp fix for Kinrix until v8.31.
"RTN","BIEXPRT5",255,0)
 ;************************
"RTN","BIEXPRT5",256,0)
 ;
"RTN","BIEXPRT5",257,0)
 ;---> Dose Note - ^V Imm IEN (Field 52).
"RTN","BIEXPRT5",258,0)
 S BITMP=BITMP_U_$P(Y,U,4)
"RTN","BIEXPRT5",259,0)
 ;
"RTN","BIEXPRT5",260,0)
 ;---> Dose HL7/CVX Code (Field 53)  * * * ALL OUTGOING TRANSLATIONS HERE * * *
"RTN","BIEXPRT5",261,0)
 D
"RTN","BIEXPRT5",262,0)
 .;---> If this is an Adult Td Booster and patient age>7, send -10 to ImmServe.
"RTN","BIEXPRT5",263,0)
 .I $P(Y,U,2)=9!($P(Y,U,2)=113) I BIAGE>6 S BITMP=BITMP_U_-10 Q
"RTN","BIEXPRT5",264,0)
 .;
"RTN","BIEXPRT5",265,0)
 .;---> If this is Tdap, send -13 to ImmServe.
"RTN","BIEXPRT5",266,0)
 .;
"RTN","BIEXPRT5",267,0)
 .;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BIEXPRT5",268,0)
 .;---> Include CVX 20 (DTaP) in translation to -13, so that DTaP satisfies Tdap.
"RTN","BIEXPRT5",269,0)
 .;---> During Beta Test decision was made to abandon this for now, due to
"RTN","BIEXPRT5",270,0)
 .;---> complications.  However, Tdap CVX 115 translated to -13 on 7yrs and older.
"RTN","BIEXPRT5",271,0)
 .I $P(Y,U,2)=115 I BIAGE>6 S BITMP=BITMP_U_-13 Q
"RTN","BIEXPRT5",272,0)
 .;I $P(Y,U,2)=115!($P(Y,U,2)=20) I BIAGE>6 S BITMP=BITMP_U_-13 Q
"RTN","BIEXPRT5",273,0)
 .;**********
"RTN","BIEXPRT5",274,0)
 .;
"RTN","BIEXPRT5",275,0)
 .;********** PATCH 2, v8.4.2, Oct 15,2010, IHS/CMI/MWR
"RTN","BIEXPRT5",276,0)
 .;---> Translate new Flu CVX Codes 140 & 141 to 15 until Immserve can accommodate.
"RTN","BIEXPRT5",277,0)
 .;---> If this is a new Flu, send 15.
"RTN","BIEXPRT5",278,0)
 .;
"RTN","BIEXPRT5",279,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT5",280,0)
 .;---> Recognize new Flu Codes.
"RTN","BIEXPRT5",281,0)
 .;I ($P(Y,U,2)=140)!($P(Y,U,2)=141)  S BITMP=BITMP_U_15 Q
"RTN","BIEXPRT5",282,0)
 .N Z S Z=($P(Y,U,2))
"RTN","BIEXPRT5",283,0)
 .I (Z=149)!(Z=150)!(Z=151)!(Z=153)!(Z=155)!(Z=158)  S BITMP=BITMP_U_15 Q
"RTN","BIEXPRT5",284,0)
 .;**********
"RTN","BIEXPRT5",285,0)
 .;
"RTN","BIEXPRT5",286,0)
 .;---> No translation of this dose.
"RTN","BIEXPRT5",287,0)
 .S BITMP=BITMP_U_$P(Y,U,2)
"RTN","BIEXPRT5",288,0)
 ;
"RTN","BIEXPRT5",289,0)
 ;---> Dose Number--or "Series Number" (Field 54).
"RTN","BIEXPRT5",290,0)
 ;---> New Version 8.x+ no longer tracks dose numbers (Field 54, 55, 56).
"RTN","BIEXPRT5",291,0)
 S BITMP=BITMP_"^0^0^0"
"RTN","BIEXPRT5",292,0)
 ;
"RTN","BIEXPRT5",293,0)
 ;---> Date of Dose Administration--Visit Date (Field 57).
"RTN","BIEXPRT5",294,0)
 S BITMP=BITMP_U_$P(Y,U)
"RTN","BIEXPRT5",295,0)
 ;
"RTN","BIEXPRT5",296,0)
 ;---> Dose Override: (Field 58).
"RTN","BIEXPRT5",297,0)
 ;---> 0=Exclude if violates screening rules
"RTN","BIEXPRT5",298,0)
 ;---> 1=Include even if violates screening rules
"RTN","BIEXPRT5",299,0)
 ;---> 2=Exclude per user input (invalidated by user, e.g., expired vaccine).
"RTN","BIEXPRT5",300,0)
 D
"RTN","BIEXPRT5",301,0)
 .;---> Interpret Dose Override for ImmServe.
"RTN","BIEXPRT5",302,0)
 .N X S X=(+$P(Y,U,3))
"RTN","BIEXPRT5",303,0)
 .D:X
"RTN","BIEXPRT5",304,0)
 ..I X=9 S X=1 Q
"RTN","BIEXPRT5",305,0)
 ..S X=2
"RTN","BIEXPRT5",306,0)
 .S BITMP=BITMP_U_X
"RTN","BIEXPRT5",307,0)
 ;
"RTN","BIEXPRT5",308,0)
 ;---> Keep count of doses.
"RTN","BIEXPRT5",309,0)
 S BIDOSES=BIDOSES+1
"RTN","BIEXPRT5",310,0)
 Q
"RTN","BIEXPRT5",311,0)
 ;
"RTN","BIEXPRT5",312,0)
 ;
"RTN","BIEXPRT5",313,0)
KINFIX(Y) ;EP
"RTN","BIEXPRT5",314,0)
 ;---> TO ACCOMODATE IMMSERVE NOT RECOGNIZING KINRIX.
"RTN","BIEXPRT5",315,0)
 ;---> DELETE THIS SECTION WITH NEW IMMSERVE, IMM V8.31.
"RTN","BIEXPRT5",316,0)
 N BIX F BIX=10,20 D
"RTN","BIEXPRT5",317,0)
 .;
"RTN","BIEXPRT5",318,0)
 .;---> Dose Note - ^V Imm IEN (Field 52).
"RTN","BIEXPRT5",319,0)
 .S BITMP=BITMP_U_$P(Y,U,4)
"RTN","BIEXPRT5",320,0)
 .;
"RTN","BIEXPRT5",321,0)
 .S BITMP=BITMP_U_BIX
"RTN","BIEXPRT5",322,0)
 .;
"RTN","BIEXPRT5",323,0)
 .;---> Dose Number--or "Series Number" (Field 54).
"RTN","BIEXPRT5",324,0)
 .;---> New Version 8.x+ no longer tracks dose numbers (Field 54, 55, 56).
"RTN","BIEXPRT5",325,0)
 .S BITMP=BITMP_"^0^0^0"
"RTN","BIEXPRT5",326,0)
 .;
"RTN","BIEXPRT5",327,0)
 .;---> Date of Dose Administration--Visit Date (Field 57).
"RTN","BIEXPRT5",328,0)
 .S BITMP=BITMP_U_$P(Y,U)
"RTN","BIEXPRT5",329,0)
 .;
"RTN","BIEXPRT5",330,0)
 .;---> Dose Override: (Field 58).
"RTN","BIEXPRT5",331,0)
 .;---> 0=Exclude if violates screening rules
"RTN","BIEXPRT5",332,0)
 .;---> 1=Include even if violates screening rules
"RTN","BIEXPRT5",333,0)
 .;---> 2=Exclude per user input (invalidated by user, e.g., expired vaccine).
"RTN","BIEXPRT5",334,0)
 .D
"RTN","BIEXPRT5",335,0)
 ..;---> Interpret Dose Override for ImmServe.
"RTN","BIEXPRT5",336,0)
 ..N X S X=(+$P(Y,U,3))
"RTN","BIEXPRT5",337,0)
 ..D:X
"RTN","BIEXPRT5",338,0)
 ...I X=9 S X=1 Q
"RTN","BIEXPRT5",339,0)
 ...S X=2
"RTN","BIEXPRT5",340,0)
 ..S BITMP=BITMP_U_X
"RTN","BIEXPRT5",341,0)
 .;
"RTN","BIEXPRT5",342,0)
 .;---> Keep count of doses.
"RTN","BIEXPRT5",343,0)
 .S BIDOSES=BIDOSES+1
"RTN","BIEXPRT5",344,0)
 Q
"RTN","BIEXPRT6")
0^34^B73221766
"RTN","BIEXPRT6",1,0)
BIEXPRT6 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS; OCT 15, 2010
"RTN","BIEXPRT6",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIEXPRT6",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXPRT6",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: BUILD PATIENT HISTORY EXPORT FOR FORECASTING.
"RTN","BIEXPRT6",5,0)
 ;;  CALLED BY BIEXPRT3.
"RTN","BIEXPRT6",6,0)
 ;;  PATCH 8: New routine to accommodate new TCH Forecaster   TCHHIST+0
"RTN","BIEXPRT6",7,0)
 ;
"RTN","BIEXPRT6",8,0)
 ;
"RTN","BIEXPRT6",9,0)
 ;
"RTN","BIEXPRT6",10,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIEXPRT6",11,0)
 ;---> New Entry Point called from HISTORY+99^BIEXPRT3.
"RTN","BIEXPRT6",12,0)
 ;----------
"RTN","BIEXPRT6",13,0)
TCHHIST(BIFDT,BIDUZ2,BINF) ;EP
"RTN","BIEXPRT6",14,0)
 ;---> Called by BIEXPRT3.
"RTN","BIEXPRT6",15,0)
 ;---> Construct ^BITMP($J,2 nodes for Forecast exports from the
"RTN","BIEXPRT6",16,0)
 ;---> ^BITMP($J,1 nodes (gathered in ^BIEXPRT2).
"RTN","BIEXPRT6",17,0)
 ;---> This prepares the string of Patient Data to be sent to
"RTN","BIEXPRT6",18,0)
 ;---> TCH for forecasting.
"RTN","BIEXPRT6",19,0)
 ;---> Parameters:
"RTN","BIEXPRT6",20,0)
 ;     1 - BIFDT  (opt) Forecast Date (date used to calc Imms due).
"RTN","BIEXPRT6",21,0)
 ;     2 - BIDUZ2 (opt) User's DUZ(2) for BISITE parameters,
"RTN","BIEXPRT6",22,0)
 ;                      which affect forecasting rules.
"RTN","BIEXPRT6",23,0)
 ;     3 - BINF   (opt) Array of Vaccine IEN's that should not be forecast.
"RTN","BIEXPRT6",24,0)
 ;
"RTN","BIEXPRT6",25,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIEXPRT6",26,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIEXPRT6",27,0)
 ;
"RTN","BIEXPRT6",28,0)
 ;---> If no BIDUZ2, try DUZ(2); otherwise, defaults will be used.
"RTN","BIEXPRT6",29,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIEXPRT6",30,0)
 ;
"RTN","BIEXPRT6",31,0)
 N BIDFN S BIDFN=0
"RTN","BIEXPRT6",32,0)
 F  S BIDFN=$O(^BITMP($J,1,BIDFN)) Q:'BIDFN  D
"RTN","BIEXPRT6",33,0)
 .N BIAGE,BIDOSES,BITMP1 S BIDOSES=0
"RTN","BIEXPRT6",34,0)
 .;---> Set Patient Age in Years for this Forecast Date.
"RTN","BIEXPRT6",35,0)
 .S BIAGE=$$AGE^BIUTL1(BIDFN,1,BIFDT)
"RTN","BIEXPRT6",36,0)
 .;
"RTN","BIEXPRT6",37,0)
 .;---> Date used for Forecast (Field 1).
"RTN","BIEXPRT6",38,0)
 .S BITMP1=$$FMTCHDT^BIUTL5(BIFDT)
"RTN","BIEXPRT6",39,0)
 .;
"RTN","BIEXPRT6",40,0)
 .;---> Forecasting Mode: Minimum vs. Recommended Age (Field 2).
"RTN","BIEXPRT6",41,0)
 .S BITMP1=BITMP1_U_$$MINAGE^BIUTL2(BIDUZ2)
"RTN","BIEXPRT6",42,0)
 .;
"RTN","BIEXPRT6",43,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIEXPRT6",44,0)
 .;---> Transmit Grace Period option instead of version.
"RTN","BIEXPRT6",45,0)
 .;---> Version (Field 3).
"RTN","BIEXPRT6",46,0)
 .;S BITMP1=BITMP1_U_$$RULES^BIUTL2(BIDUZ2)
"RTN","BIEXPRT6",47,0)
 .;---> Grace Period (Field 3).
"RTN","BIEXPRT6",48,0)
 .S BITMP1=BITMP1_U_$P($G(^BISITE(BIDUZ2,0)),U,21)
"RTN","BIEXPRT6",49,0)
 .;
"RTN","BIEXPRT6",50,0)
 .;---> Reserved for future use (Field 4).
"RTN","BIEXPRT6",51,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT6",52,0)
 .;
"RTN","BIEXPRT6",53,0)
 .;---> Reserved for future use (Field 5).
"RTN","BIEXPRT6",54,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT6",55,0)
 .;
"RTN","BIEXPRT6",56,0)
 .;---> Personal ID: Patient Name and Chart# (Field 6)
"RTN","BIEXPRT6",57,0)
 .S BITMP1=BITMP1_U_$$NAME^BIUTL1(BIDFN)
"RTN","BIEXPRT6",58,0)
 .S BITMP1=BITMP1_"  Chart#: "_$$HRCN^BIUTL1(BIDFN)
"RTN","BIEXPRT6",59,0)
 .;
"RTN","BIEXPRT6",60,0)
 .;---> User Note: DFN  (Field 7)
"RTN","BIEXPRT6",61,0)
 .S BITMP1=BITMP1_U_BIDFN
"RTN","BIEXPRT6",62,0)
 .;
"RTN","BIEXPRT6",63,0)
 .;---> Date of Birth (Field 8).
"RTN","BIEXPRT6",64,0)
 .S BITMP1=BITMP1_U_$$FMTCHDT^BIUTL5($$DOB^BIUTL1(BIDFN))
"RTN","BIEXPRT6",65,0)
 .;
"RTN","BIEXPRT6",66,0)
 .;---> Gender (Field 9).
"RTN","BIEXPRT6",67,0)
 .S BITMP1=BITMP1_U_$$SEXW^BIUTL1(BIDFN)
"RTN","BIEXPRT6",68,0)
 .;
"RTN","BIEXPRT6",69,0)
 .;---> Mother HBsAg Status: P,N,U,A  (Field 10).
"RTN","BIEXPRT6",70,0)
 .S BITMP1=BITMP1_U_$$MOTHER^BIUTL11(BIDFN)
"RTN","BIEXPRT6",71,0)
 .;
"RTN","BIEXPRT6",72,0)
 .;---> Build array of contraindicated HL7 Codes for this Patient.
"RTN","BIEXPRT6",73,0)
 .N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIEXPRT6",74,0)
 .;
"RTN","BIEXPRT6",75,0)
 .;---> Pertussis Indication (Field 11).
"RTN","BIEXPRT6",76,0)
 .D
"RTN","BIEXPRT6",77,0)
 ..;---> If patient has contra to DTP or DTaP, pass contra to pertussis.
"RTN","BIEXPRT6",78,0)
 ..N I,J S J=0 F I=1,11,20 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT6",79,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT6",80,0)
 .;
"RTN","BIEXPRT6",81,0)
 .;---> Diphtheria Indication (Field 12).
"RTN","BIEXPRT6",82,0)
 .D
"RTN","BIEXPRT6",83,0)
 ..;---> If pt has contra to DT-PEDS or TD-Adult, pass contra to Diph.
"RTN","BIEXPRT6",84,0)
 ..N I,J S J=0 F I=28,9 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT6",85,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT6",86,0)
 .;
"RTN","BIEXPRT6",87,0)
 .;---> Tetanus Indication (Field 13).
"RTN","BIEXPRT6",88,0)
 .D
"RTN","BIEXPRT6",89,0)
 ..;---> If pt has contra to TET TOX,
"RTN","BIEXPRT6",90,0)
 ..;---> pass contra to Tetanus.
"RTN","BIEXPRT6",91,0)
 ..N I,J S J=0 F I=28,9,35 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT6",92,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT6",93,0)
 .;
"RTN","BIEXPRT6",94,0)
 .;---> Hib Indication (Field 14).
"RTN","BIEXPRT6",95,0)
 .D
"RTN","BIEXPRT6",96,0)
 ..;---> If pt has contra to any HIB, pass contra to HIB.
"RTN","BIEXPRT6",97,0)
 ..N I,J S J=0 F I=17,46,47,48,49 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT6",98,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT6",99,0)
 .;
"RTN","BIEXPRT6",100,0)
 .;---> HBIG Indication (Field 15).
"RTN","BIEXPRT6",101,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(30)):1,1:0)
"RTN","BIEXPRT6",102,0)
 .;
"RTN","BIEXPRT6",103,0)
 .;---> HepB Indication (Field 16).
"RTN","BIEXPRT6",104,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(45)):1,1:0)
"RTN","BIEXPRT6",105,0)
 .;
"RTN","BIEXPRT6",106,0)
 .;---> OPV Indication (Field 17).
"RTN","BIEXPRT6",107,0)
 .;---> 2003: ImmServe no longer forecasts OPV.
"RTN","BIEXPRT6",108,0)
 .;S BITMP1=BITMP1_U_$S($D(BICT(2)):1,$D(BINF(2)):1,1:0)
"RTN","BIEXPRT6",109,0)
 .S BITMP1=BITMP1_U_0
"RTN","BIEXPRT6",110,0)
 .;
"RTN","BIEXPRT6",111,0)
 .;---> IPV Indication (Field 18).
"RTN","BIEXPRT6",112,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(10)):1,1:0)
"RTN","BIEXPRT6",113,0)
 .;
"RTN","BIEXPRT6",114,0)
 .;---> Measles Indication (Field 19).
"RTN","BIEXPRT6",115,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(5)):1,1:0)
"RTN","BIEXPRT6",116,0)
 .;
"RTN","BIEXPRT6",117,0)
 .;---> Mumps Indication (Field 20).
"RTN","BIEXPRT6",118,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(7)):1,1:0)
"RTN","BIEXPRT6",119,0)
 .;
"RTN","BIEXPRT6",120,0)
 .;---> Rubella Indication (Field 21).
"RTN","BIEXPRT6",121,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(6)):1,1:0)
"RTN","BIEXPRT6",122,0)
 .;
"RTN","BIEXPRT6",123,0)
 .;---> Varicella Indication (Field 22).
"RTN","BIEXPRT6",124,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(21)):1,1:0)
"RTN","BIEXPRT6",125,0)
 .;
"RTN","BIEXPRT6",126,0)
 .;---> HepA Indication (Field 23).
"RTN","BIEXPRT6",127,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(85)):1,1:0)
"RTN","BIEXPRT6",128,0)
 .;
"RTN","BIEXPRT6",129,0)
 .;---> Rotavirus Indication (Field 24).
"RTN","BIEXPRT6",130,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(74)):1,1:0)
"RTN","BIEXPRT6",131,0)
 .;
"RTN","BIEXPRT6",132,0)
 .;---> Pneumococcal Indication (Field 25).
"RTN","BIEXPRT6",133,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIEXPRT6",134,0)
 .;---> Add ALL Pneumos.
"RTN","BIEXPRT6",135,0)
 .D
"RTN","BIEXPRT6",136,0)
 ..;---> If pt has contra to any Pneumo, pass contra to Pneumo.
"RTN","BIEXPRT6",137,0)
 ..N I,J S J=0 F I=33,100,109,133 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT6",138,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT6",139,0)
 .;
"RTN","BIEXPRT6",140,0)
 .;---> Influenza Indication (Field 26).
"RTN","BIEXPRT6",141,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(88)):1,1:0)
"RTN","BIEXPRT6",142,0)
 .;
"RTN","BIEXPRT6",143,0)
 .;---> Meningococcal Indication (Field 27).
"RTN","BIEXPRT6",144,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(32)):1,1:0)
"RTN","BIEXPRT6",145,0)
 .;
"RTN","BIEXPRT6",146,0)
 .;---> HPV Indication (Field 28).
"RTN","BIEXPRT6",147,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(62)):1,1:0)
"RTN","BIEXPRT6",148,0)
 .;
"RTN","BIEXPRT6",149,0)
 .;---> H1N1 Indication (Field 29).
"RTN","BIEXPRT6",150,0)
 .D
"RTN","BIEXPRT6",151,0)
 ..;---> If pt has contra to any H1N1, pass contra to H1N1.
"RTN","BIEXPRT6",152,0)
 ..N I,J S J=0 F I=125,126,127,128 I $D(BICT(I)) S J=1 Q
"RTN","BIEXPRT6",153,0)
 ..S BITMP1=BITMP1_U_J
"RTN","BIEXPRT6",154,0)
 .;
"RTN","BIEXPRT6",155,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIEXPRT6",156,0)
 .;---> Add Zoster Contraindication field.
"RTN","BIEXPRT6",157,0)
 .;---> Zoster Indication (Field 30).
"RTN","BIEXPRT6",158,0)
 .S BITMP1=BITMP1_U_$S($D(BICT(121)):1,1:0)
"RTN","BIEXPRT6",159,0)
 .;
"RTN","BIEXPRT6",160,0)
 .;---> Delimiter between Patient Case Data and Imm History Doses.
"RTN","BIEXPRT6",161,0)
 .S BITMP1=BITMP1_U_"~~~"
"RTN","BIEXPRT6",162,0)
 .;**********
"RTN","BIEXPRT6",163,0)
 .;
"RTN","BIEXPRT6",164,0)
 .;
"RTN","BIEXPRT6",165,0)
 .N BIMM,BITMP S BIMM=0,BITMP=""
"RTN","BIEXPRT6",166,0)
 .F  S BIMM=$O(^BITMP($J,1,BIDFN,BIMM)) Q:'BIMM  D
"RTN","BIEXPRT6",167,0)
 ..N BIDATE,Y S BIDATE=0
"RTN","BIEXPRT6",168,0)
 ..F  S BIDATE=$O(^BITMP($J,1,BIDFN,BIMM,BIDATE)) Q:'BIDATE  D
"RTN","BIEXPRT6",169,0)
 ...N BIVIMM,Y S BIVIMM=0
"RTN","BIEXPRT6",170,0)
 ...F  S BIVIMM=$O(^BITMP($J,1,BIDFN,BIMM,BIDATE,BIVIMM)) Q:'BIVIMM  D
"RTN","BIEXPRT6",171,0)
 ....;---> Tack on V Imm IEN for matching ImmServe History.
"RTN","BIEXPRT6",172,0)
 ....N BIDOSE S Y=^BITMP($J,1,BIDFN,BIMM,BIDATE,BIVIMM)_"^"_BIVIMM
"RTN","BIEXPRT6",173,0)
 ....D DOSES(Y,BIAGE,.BIDOSE,.BIDOSES)
"RTN","BIEXPRT6",174,0)
 ....S BITMP=BITMP_BIDOSE
"RTN","BIEXPRT6",175,0)
 .;
"RTN","BIEXPRT6",176,0)
 .;---> Allow for Maximum Global Length to be as small as 255.
"RTN","BIEXPRT6",177,0)
 .;---> This gets picked up in +63^BIEXPRT4.
"RTN","BIEXPRT6",178,0)
 .S BITMP=BITMP1_BITMP
"RTN","BIEXPRT6",179,0)
 .S ^BITMP($J,2,BIDFN,1,1,1)=$E(BITMP,1,250)
"RTN","BIEXPRT6",180,0)
 .S:$L(BITMP)>250 ^BITMP($J,2,BIDFN,1,1,1,1)=$E(BITMP,251,500)
"RTN","BIEXPRT6",181,0)
 .S:$L(BITMP)>500 ^BITMP($J,2,BIDFN,1,1,1,2)=$E(BITMP,501,750)
"RTN","BIEXPRT6",182,0)
 .S:$L(BITMP)>750 ^BITMP($J,2,BIDFN,1,1,1,3)=$E(BITMP,751,1000)
"RTN","BIEXPRT6",183,0)
 .S:$L(BITMP)>1000 ^BITMP($J,2,BIDFN,1,1,1,4)=$E(BITMP,1001,1250)
"RTN","BIEXPRT6",184,0)
 .S:$L(BITMP)>1250 ^BITMP($J,2,BIDFN,1,1,1,5)=$E(BITMP,1251,1500)
"RTN","BIEXPRT6",185,0)
 .S:$L(BITMP)>1500 ^BITMP($J,2,BIDFN,1,1,1,6)=$E(BITMP,1501,1750)
"RTN","BIEXPRT6",186,0)
 .S:$L(BITMP)>1750 ^BITMP($J,2,BIDFN,1,1,1,7)=$E(BITMP,1751,2000)
"RTN","BIEXPRT6",187,0)
 Q
"RTN","BIEXPRT6",188,0)
 ;
"RTN","BIEXPRT6",189,0)
 ;----------
"RTN","BIEXPRT6",190,0)
DOSES(Y,BIAGE,BIDOSE,BIDOSES) ;EP
"RTN","BIEXPRT6",191,0)
 ;---> Add data (4 TCH fields) for one dose to BITMP.
"RTN","BIEXPRT6",192,0)
 ;---> Parameters:
"RTN","BIEXPRT6",193,0)
 ;     1 - Y       (req) Data for one visit, stored in ^BITMP($J,1,BIDFN...
"RTN","BIEXPRT6",194,0)
 ;                       CVX Code^Dose Override^TCH Date^V Imm IEN.
"RTN","BIEXPRT6",195,0)
 ;     2 - BIAGE   (req) Patient Age in years (for translating Td).
"RTN","BIEXPRT6",196,0)
 ;     3 - BIDOSE  (ret) Data returned for one "Input Dose":
"RTN","BIEXPRT6",197,0)
 ;                       Dose Note(V Imm IEN)^CVX Code^Date of Dose
"RTN","BIEXPRT6",198,0)
 ;                       ^Dose Override^Reserved^Reserved
"RTN","BIEXPRT6",199,0)
 ;     4 - BIDOSES (ret) Total number of doses collected (not used for now).
"RTN","BIEXPRT6",200,0)
 ;
"RTN","BIEXPRT6",201,0)
 Q:$G(Y)=""
"RTN","BIEXPRT6",202,0)
 S:$G(BIDOSE)="" BIDOSE=""
"RTN","BIEXPRT6",203,0)
 S:$G(BIDOSES)="" BIDOSES=0
"RTN","BIEXPRT6",204,0)
 ;
"RTN","BIEXPRT6",205,0)
 ;---> Quit if no Dose CVX Code or if NULL.
"RTN","BIEXPRT6",206,0)
 Q:"NULL"[$P(Y,U,1)
"RTN","BIEXPRT6",207,0)
 ;
"RTN","BIEXPRT6",208,0)
 ;---> Dose Note - ^V Imm IEN (Field 1).
"RTN","BIEXPRT6",209,0)
 S BIDOSE=$P(Y,U,4)
"RTN","BIEXPRT6",210,0)
 ;
"RTN","BIEXPRT6",211,0)
 ;---> Dose HL7/CVX Code (Field 2)  * * * ALL OUTGOING TRANSLATIONS HERE * * *
"RTN","BIEXPRT6",212,0)
 ;***** TRANSLATIONS NECESSARY??? ****
"RTN","BIEXPRT6",213,0)
 D
"RTN","BIEXPRT6",214,0)
 .;---> If this is an Adult Td Booster and patient age>7, send -10 to ImmServe.
"RTN","BIEXPRT6",215,0)
 .;I $P(Y,U,1)=9!($P(Y,U,1)=113) I BIAGE>6 S BIDOSE=BIDOSE_U_-10 Q
"RTN","BIEXPRT6",216,0)
 .;
"RTN","BIEXPRT6",217,0)
 .;---> If this is Tdap, send -13 to ImmServe.
"RTN","BIEXPRT6",218,0)
 .;
"RTN","BIEXPRT6",219,0)
 .;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BIEXPRT6",220,0)
 .;---> Include CVX 20 (DTaP) in translation to -13, so that DTaP satisfies Tdap.
"RTN","BIEXPRT6",221,0)
 .;---> During Beta Test decision was made to abandon this for now, due to
"RTN","BIEXPRT6",222,0)
 .;---> complications.  However, Tdap CVX 115 translated to -13 on 7yrs and older.
"RTN","BIEXPRT6",223,0)
 .;I $P(Y,U,1)=115 I BIAGE>6 S BIDOSE=BIDOSE_U_-13 Q
"RTN","BIEXPRT6",224,0)
 .;I $P(Y,U,2)=115!($P(Y,U,2)=20) I BIAGE>6 S BIDOSE=BIDOSE_U_-13 Q
"RTN","BIEXPRT6",225,0)
 .;**********
"RTN","BIEXPRT6",226,0)
 .;
"RTN","BIEXPRT6",227,0)
 .;********** PATCH 2, v8.4.2, Oct 15,2010, IHS/CMI/MWR
"RTN","BIEXPRT6",228,0)
 .;---> Translate new Flu CVX Codes 140 & 141 to 15 until Immserve can accommodate.
"RTN","BIEXPRT6",229,0)
 .;---> If this is a new Flu, send 15.
"RTN","BIEXPRT6",230,0)
 .;
"RTN","BIEXPRT6",231,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIEXPRT6",232,0)
 .;---> Recognize new Flu Codes.
"RTN","BIEXPRT6",233,0)
 .;I ($P(Y,U,2)=140)!($P(Y,U,2)=141)  S BIDOSE=BIDOSE_U_15 Q
"RTN","BIEXPRT6",234,0)
 .;N Z S Z=($P(Y,U,1))
"RTN","BIEXPRT6",235,0)
 .;I (Z=149)!(Z=150)!(Z=151)!(Z=153)!(Z=155)!(Z=158)  S BIDOSE=BIDOSE_U_15 Q
"RTN","BIEXPRT6",236,0)
 .;**********
"RTN","BIEXPRT6",237,0)
 .;
"RTN","BIEXPRT6",238,0)
 .;---> No translation of this dose.
"RTN","BIEXPRT6",239,0)
 .S BIDOSE=BIDOSE_U_$P(Y,U,1)
"RTN","BIEXPRT6",240,0)
 ;
"RTN","BIEXPRT6",241,0)
 ;
"RTN","BIEXPRT6",242,0)
 ;---> Date of Dose Administration--Visit Date (Field 3).
"RTN","BIEXPRT6",243,0)
 S BIDOSE=BIDOSE_U_$P(Y,U,3)
"RTN","BIEXPRT6",244,0)
 ;
"RTN","BIEXPRT6",245,0)
 ;---> Dose Override: (Field 4).
"RTN","BIEXPRT6",246,0)
 ;---> 0=Exclude if violates screening rules
"RTN","BIEXPRT6",247,0)
 ;---> 1=Include even if violates screening rules
"RTN","BIEXPRT6",248,0)
 ;---> 2=Exclude per user input (invalidated by user, e.g., expired vaccine).
"RTN","BIEXPRT6",249,0)
 D
"RTN","BIEXPRT6",250,0)
 .;---> Interpret Dose Override for ImmServe.
"RTN","BIEXPRT6",251,0)
 .N X S X=(+$P(Y,U,2))
"RTN","BIEXPRT6",252,0)
 .D:X
"RTN","BIEXPRT6",253,0)
 ..I X=9 S X=1 Q
"RTN","BIEXPRT6",254,0)
 ..S X=2
"RTN","BIEXPRT6",255,0)
 .S BIDOSE=BIDOSE_U_X
"RTN","BIEXPRT6",256,0)
 ;
"RTN","BIEXPRT6",257,0)
 ;---> Reserved for future use (Field 5).
"RTN","BIEXPRT6",258,0)
 S BIDOSE=BIDOSE_"^0"
"RTN","BIEXPRT6",259,0)
 ;
"RTN","BIEXPRT6",260,0)
 ;---> Reserved for future use (Field 6).
"RTN","BIEXPRT6",261,0)
 S BIDOSE=BIDOSE_"^0"
"RTN","BIEXPRT6",262,0)
 ;
"RTN","BIEXPRT6",263,0)
 ;---> End of Dose Delimiter.
"RTN","BIEXPRT6",264,0)
 S BIDOSE=BIDOSE_"|||"
"RTN","BIEXPRT6",265,0)
 ;
"RTN","BIEXPRT6",266,0)
 ;---> Keep count of doses.
"RTN","BIEXPRT6",267,0)
 S BIDOSES=BIDOSES+1
"RTN","BIEXPRT6",268,0)
 Q
"RTN","BIEXPRT8")
0^35^B3833545
"RTN","BIEXPRT8",1,0)
BIEXPRT8 ;IHS/CMI/MWR - EXPORT IMMUNIZATION RECORDS; MAY 10, 2010
"RTN","BIEXPRT8",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIEXPRT8",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIEXPRT8",4,0)
 ;;  EXPORT IMMUNIZATION RECORDS: HFS ACCESS, OTHER PROMPTS.
"RTN","BIEXPRT8",5,0)
 ;
"RTN","BIEXPRT8",6,0)
 ;
"RTN","BIEXPRT8",7,0)
 ;----------
"RTN","BIEXPRT8",8,0)
HFS(BIFLNM,BIPATH,BIOPEN,BIPOP) ;EP
"RTN","BIEXPRT8",9,0)
 ;---> Return path, open Host File and test access.
"RTN","BIEXPRT8",10,0)
 ;---> Parameters:
"RTN","BIEXPRT8",11,0)
 ;     1 - BIFLNM (req) File name given by the user.
"RTN","BIEXPRT8",12,0)
 ;     2 - BIPATH (ret) Path name set in Site Parameters.
"RTN","BIEXPRT8",13,0)
 ;     3 - BIOPEN (opt) If BIOPEN=1, leave Device (Host File) open;
"RTN","BIEXPRT8",14,0)
 ;                      otherwise, close Host File with %ZISC.
"RTN","BIEXPRT8",15,0)
 ;     4 - BIPOP  (ret) BIPOP=1 if failed to open Host File.
"RTN","BIEXPRT8",16,0)
 ;
"RTN","BIEXPRT8",17,0)
 S BIPOP=0
"RTN","BIEXPRT8",18,0)
 ;---> No file name.
"RTN","BIEXPRT8",19,0)
 I $G(BIFLNM)']"" D ERRCD^BIUTL2(102,,1) S BIPOP=1 Q
"RTN","BIEXPRT8",20,0)
 ;
"RTN","BIEXPRT8",21,0)
 ;---> No site parameter entry.
"RTN","BIEXPRT8",22,0)
 I $G(^BISITE(DUZ(2),0))']"" D ERRCD^BIUTL2(103,,1) S BIPOP=1 Q
"RTN","BIEXPRT8",23,0)
 ;
"RTN","BIEXPRT8",24,0)
 ;---> Path not set.
"RTN","BIEXPRT8",25,0)
 S BIPATH=$P(^BISITE(DUZ(2),0),U,14)  N X S X="I"_"O(1)" K @X
"RTN","BIEXPRT8",26,0)
 I BIPATH']"" D ERRCD^BIUTL2(104,,1) S BIPOP=1 Q
"RTN","BIEXPRT8",27,0)
 ;
"RTN","BIEXPRT8",28,0)
 ;---> Attempt to open Host File Server.
"RTN","BIEXPRT8",29,0)
 S BIPOP=$$OPEN^%ZISH(BIPATH,BIFLNM,"W")
"RTN","BIEXPRT8",30,0)
 ;
"RTN","BIEXPRT8",31,0)
 ;---> If not valid PATH, will bomb with a <MODER>.
"RTN","BIEXPRT8",32,0)
 ;---> Purpose here is to test Host File access before beginning search.
"RTN","BIEXPRT8",33,0)
 I BIPOP D ^%ZISC,ERRCD^BIUTL2(101,,1) Q
"RTN","BIEXPRT8",34,0)
 U IO W ""
"RTN","BIEXPRT8",35,0)
 D:'$G(BIOPEN) ^%ZISC
"RTN","BIEXPRT8",36,0)
 Q
"RTN","BIEXPRT8",37,0)
 ;
"RTN","BIEXPRT8",38,0)
 ;----------
"RTN","BIEXPRT8",39,0)
OKAY(BIPOP) ;EP
"RTN","BIEXPRT8",40,0)
 ;---> Get final okay to continue.
"RTN","BIEXPRT8",41,0)
 ;---> Parameters:
"RTN","BIEXPRT8",42,0)
 ;     1 - BIPOP   (ret) BIPOP=1 if DIRUT *or* if Not OK to proceed.
"RTN","BIEXPRT8",43,0)
 ;
"RTN","BIEXPRT8",44,0)
 D IO^BIO("Do you REALLY wish to export records now?")
"RTN","BIEXPRT8",45,0)
 N A S BIPOP=0
"RTN","BIEXPRT8",46,0)
 S A="     Enter YES to export records, enter NO to abort this process."
"RTN","BIEXPRT8",47,0)
 D DIR^BIFMAN("Y",.Y,.BIPOP,"   Enter Yes or No","YES",A)
"RTN","BIEXPRT8",48,0)
 I BIPOP!(Y=0) D  Q
"RTN","BIEXPRT8",49,0)
 .D IO^BIO("* NO RECORDS EXPORTED. *","!!?25")
"RTN","BIEXPRT8",50,0)
 .D DIRZ^BIUTL3(.BIPOP) S BIPOP=1  ;---> If Y=0 flag "not okay".
"RTN","BIEXPRT8",51,0)
 ;
"RTN","BIEXPRT8",52,0)
 S A="Please hold while records are scanned.  This may take awhile..."
"RTN","BIEXPRT8",53,0)
 D IO^BIO(A,"!!?3")
"RTN","BIEXPRT8",54,0)
 Q
"RTN","BIFMAN")
0^36^B40044488
"RTN","BIFMAN",1,0)
BIFMAN ;IHS/CMI/MWR - FILEMAN CALLS; MAY 10, 2010
"RTN","BIFMAN",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIFMAN",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIFMAN",4,0)
 ;;  CALLS TO FILEMAN WITH PRE- AND POST-CALL VARIABLE SETTING.
"RTN","BIFMAN",5,0)
 ;
"RTN","BIFMAN",6,0)
 ;
"RTN","BIFMAN",7,0)
 ;----------
"RTN","BIFMAN",8,0)
DIC(DIC,DIC0,BIY,DICA,DICB,DICS,BIX,BIPOP,DICDR) ;EP
"RTN","BIFMAN",9,0)
 ;---> CALL TO ^DIC - File lookup and/or add new entry.
"RTN","BIFMAN",10,0)
 ;---> Parameters:
"RTN","BIFMAN",11,0)
 ;     1 - DIC=DIC         (req)
"RTN","BIFMAN",12,0)
 ;     2 - DIC0=DIC(0)     (req)
"RTN","BIFMAN",13,0)
 ;     3 - BIY             (ret) Equal to Y from call to ^DIC.
"RTN","BIFMAN",14,0)
 ;     4 - DICA=DIC("A")   (opt) Prompt
"RTN","BIFMAN",15,0)
 ;     5 - DICB=DIC("B")   (opt) DEFAULT
"RTN","BIFMAN",16,0)
 ;     6 - DICS=DIC("S")   (opt) Screen
"RTN","BIFMAN",17,0)
 ;     7 - BIX             (opt) Equal to X if DIC(0)'["A".
"RTN","BIFMAN",18,0)
 ;     8 - BIPOP           (opt) BIPOP=1 if DTOUT or DUOUT
"RTN","BIFMAN",19,0)
 ;     9 - DICDR=DIC("DR") (opt) To specify fields to be asked when
"RTN","BIFMAN",20,0)
 ;                               adding a new entry.
"RTN","BIFMAN",21,0)
 ;
"RTN","BIFMAN",22,0)
 ;---> Example: D DIC^BIFMAN(9002086,"QEMAL",.Y,"   Select PATIENT: ")
"RTN","BIFMAN",23,0)
 ;              To stuff an entry:
"RTN","BIFMAN",24,0)
 ;              D DIC^BIFMAN(9002086,"QEML",.Y,,,,"NewEntry")
"RTN","BIFMAN",25,0)
 ;
"RTN","BIFMAN",26,0)
 N X,Y
"RTN","BIFMAN",27,0)
 S:$G(BIX)]"" X=BIX
"RTN","BIFMAN",28,0)
 I $G(DIC)']""!($G(DIC0)']"") S BIPOP=1 Q
"RTN","BIFMAN",29,0)
 S BIPOP=0 S:DIC DLAYGO=$P(DIC,".")
"RTN","BIFMAN",30,0)
 S DIC(0)=DIC0
"RTN","BIFMAN",31,0)
 S:$G(DICA)]"" DIC("A")=DICA
"RTN","BIFMAN",32,0)
 S:$G(DICB)]"" DIC("B")=DICB
"RTN","BIFMAN",33,0)
 S:$G(DICDR)]"" DIC("DR")=DICDR
"RTN","BIFMAN",34,0)
 S:$G(DICS)]"" DIC("S")=DICS
"RTN","BIFMAN",35,0)
 D ^DIC
"RTN","BIFMAN",36,0)
 S BIY=Y
"RTN","BIFMAN",37,0)
 S:($D(DTOUT))!($D(DUOUT)) BIPOP=1
"RTN","BIFMAN",38,0)
 D DKILLS
"RTN","BIFMAN",39,0)
 Q
"RTN","BIFMAN",40,0)
 ;
"RTN","BIFMAN",41,0)
 ;
"RTN","BIFMAN",42,0)
 ;----------
"RTN","BIFMAN",43,0)
UPDATE(BIFN,BIIEN,BIFLD,BIERR,BIEXT) ;EP
"RTN","BIFMAN",44,0)
 ;---> CALL TO UPDATE^DIE - To *ADD* new entry or subentry to a file.
"RTN","BIFMAN",45,0)
 ;---> Parameters:
"RTN","BIFMAN",46,0)
 ;     1 - BIFN   (req) File Number.
"RTN","BIFMAN",47,0)
 ;     2 - BIIEN  (opt) IENS Array setting Seq Number=desire IEN in global.
"RTN","BIFMAN",48,0)
 ;     3 - BIFLD  (req) Array of BIFLD(Field#)=Value, esp. need a .01 node,
"RTN","BIFMAN",49,0)
 ;                      may need other required fields.
"RTN","BIFMAN",50,0)
 ;     4 - BIERR  (ret) Text of error, if any.
"RTN","BIFMAN",51,0)
 ;     5 - BIEXT  (opt) If BIEXT="E", tell UPDATE^DIE values are External.
"RTN","BIFMAN",52,0)
 ;
"RTN","BIFMAN",53,0)
 ;---> Example:  N BIERR,BIFLD,BIIEN
"RTN","BIFMAN",54,0)
 ;               S BIIEN(1)=777  (This is to S DINUM=X; specify IEN in global)
"RTN","BIFMAN",55,0)
 ;               S BIFLD(.01)=777
"RTN","BIFMAN",56,0)
 ;               S BIFLD(.02)="This is a test of UPDATE~DIE."
"RTN","BIFMAN",57,0)
 ;               D UPDATE^BIFMAN(9002084.33,.BIIEN,.BIFLD,.BIERR)
"RTN","BIFMAN",58,0)
 ;               I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BIFMAN",59,0)
 ;            OR
"RTN","BIFMAN",60,0)
 ;               NOTE!: 2nd Parameter, BIIEN, is optional;
"RTN","BIFMAN",61,0)
 ;                      But you must set BIFLD(.01)=something.
"RTN","BIFMAN",62,0)
 ;               N BIERR,BIFLD
"RTN","BIFMAN",63,0)
 ;               S BIFLD(.01)=BIDFN,BIFLD(.02)=BIPTR,BIFLD(.03)=BIREAS
"RTN","BIFMAN",64,0)
 ;               D UPDATE^BIFMAN(9002084.11,,.BIFLD,.BIERR)
"RTN","BIFMAN",65,0)
 ;
"RTN","BIFMAN",66,0)
 N BIFDA,BIMSG,BISEQN
"RTN","BIFMAN",67,0)
 ;
"RTN","BIFMAN",68,0)
 ;---Check for valid File Number and Data Dictionary.
"RTN","BIFMAN",69,0)
 I '$G(BIFN) D ERRCD^BIUTL2(671,.BIERR) Q
"RTN","BIFMAN",70,0)
 I '$D(^DD($G(BIFN),0)) D ERRCD^BIUTL2(671,.BIERR) Q
"RTN","BIFMAN",71,0)
 ;
"RTN","BIFMAN",72,0)
 ;---> Set BISEQN is Sequence Number #1 set to ADD new top level entry.
"RTN","BIFMAN",73,0)
 S BISEQN="+1,"
"RTN","BIFMAN",74,0)
 ;---> Process External/Internal Flag value.
"RTN","BIFMAN",75,0)
 S BIEXT=$S($G(BIEXT)=1:"E",1:"")
"RTN","BIFMAN",76,0)
 ;
"RTN","BIFMAN",77,0)
 ;---> Create FDA.
"RTN","BIFMAN",78,0)
 N N S N=0
"RTN","BIFMAN",79,0)
 F  S N=$O(BIFLD(N)) Q:'N  D
"RTN","BIFMAN",80,0)
 .S BIFDA(BIFN,BISEQN,N)=BIFLD(N)
"RTN","BIFMAN",81,0)
 ;
"RTN","BIFMAN",82,0)
 D UPDATE^DIE(BIEXT,"BIFDA","BIIEN","BIMSG")
"RTN","BIFMAN",83,0)
 ;
"RTN","BIFMAN",84,0)
 S BIERR=$G(BIMSG("DIERR",1,"TEXT",1))
"RTN","BIFMAN",85,0)
 I BIERR'="" S BIERR=BIERR_" (software error) #674"
"RTN","BIFMAN",86,0)
 D DKILLS
"RTN","BIFMAN",87,0)
 Q
"RTN","BIFMAN",88,0)
 ;
"RTN","BIFMAN",89,0)
 ;
"RTN","BIFMAN",90,0)
 ;----------
"RTN","BIFMAN",91,0)
DDS(DDSFILE,DR,DA,DDSPARM,DDSSAVE,BIPOP) ;EP
"RTN","BIFMAN",92,0)
 ;---> CALL TO ^DDS
"RTN","BIFMAN",93,0)
 ;---> NOTE: Screenman automatically uses incremental locks.
"RTN","BIFMAN",94,0)
 ;---> Parameters:
"RTN","BIFMAN",95,0)
 ;     1 - DDSFILE=FILE# (req)
"RTN","BIFMAN",96,0)
 ;     2 - DR=FORM       (req)
"RTN","BIFMAN",97,0)
 ;     3 - DA=RECORD     (req)
"RTN","BIFMAN",98,0)
 ;     4 - DDSPARM (C/E) (opt) C=Register change in DDSCHANG
"RTN","BIFMAN",99,0)
 ;     5 - DDSSAVE       (ret) $G(DDSSAVE)=1 if user saved changes.
"RTN","BIFMAN",100,0)
 ;     6 - BIPOP         (ret) FAIL/QUIT/TIMEOUT
"RTN","BIFMAN",101,0)
 ;
"RTN","BIFMAN",102,0)
 ;---> Examples:
"RTN","BIFMAN",103,0)
 ;     D DDS^BIFMAN(9002086.02,"[BI SITE PARAMS-FORM-1]",+Y)
"RTN","BIFMAN",104,0)
 ;     D DDS^BIFMAN(9002086.1,"[BI PROC-FORM-LAB]",DA,"C",.BICHG,.BIPOP)
"RTN","BIFMAN",105,0)
 ;
"RTN","BIFMAN",106,0)
 N BIDA,X,Y S BIDA=DA,BIPOP=0
"RTN","BIFMAN",107,0)
 I DDSFILE S DDSFILE=^DIC(DDSFILE,0,"GL")
"RTN","BIFMAN",108,0)
 I $G(BIDA) L +@(DDSFILE_BIDA_")"):5 I '$T S BIPOP=1 D LOCKED^BIUTL3 Q
"RTN","BIFMAN",109,0)
 K ^TMP("DDS",$J)
"RTN","BIFMAN",110,0)
 I '$D(IOST(0)) D HOME^%ZIS,ENS^%ZISS
"RTN","BIFMAN",111,0)
 D ^DDS
"RTN","BIFMAN",112,0)
 S:$D(DTOUT) BIPOP=1
"RTN","BIFMAN",113,0)
 I $D(DIMSG)!($D(DIERR)) D  S BIPOP=1
"RTN","BIFMAN",114,0)
 .W !?5,"* The Screen Manager could not edit this record."
"RTN","BIFMAN",115,0)
 .W !?7,"Please contact your Site Manager." D DIRZ^BIUTL3(.BIPOP)
"RTN","BIFMAN",116,0)
 I $G(BIDA) L -@(DDSFILE_BIDA_")")
"RTN","BIFMAN",117,0)
 D DKILLS
"RTN","BIFMAN",118,0)
 Q
"RTN","BIFMAN",119,0)
 ;
"RTN","BIFMAN",120,0)
 ;
"RTN","BIFMAN",121,0)
 ;----------
"RTN","BIFMAN",122,0)
DIE(DIE,DR,DA,BIPOP,Z) ;EP
"RTN","BIFMAN",123,0)
 ;---> CALL TO ^DIE - Edit entry in a file.
"RTN","BIFMAN",124,0)
 ;---> Parameters:
"RTN","BIFMAN",125,0)
 ;     1 - DIE=DIE (req)
"RTN","BIFMAN",126,0)
 ;     2 - DR=DR   (req)
"RTN","BIFMAN",127,0)
 ;     3 - DA=DA   (req)
"RTN","BIFMAN",128,0)
 ;     4 - BIPOP   (ret) BIPOP=1 indicates failure/quit
"RTN","BIFMAN",129,0)
 ;     5 - Z       (opt) Z=1 if user should *NOT* be notified
"RTN","BIFMAN",130,0)
 ;                            record was locked.
"RTN","BIFMAN",131,0)
 ;
"RTN","BIFMAN",132,0)
 ;---> Example: D DIE^BIFMAN(9002086,DR,+Y,.BIPOP)
"RTN","BIFMAN",133,0)
 ;              (+Y from DIC call, DR could be literal if short.)
"RTN","BIFMAN",134,0)
 ;
"RTN","BIFMAN",135,0)
 N BIDA,X,Y S BIDA=DA,BIPOP=0
"RTN","BIFMAN",136,0)
 I DIE S DIE=^DIC(DIE,0,"GL")
"RTN","BIFMAN",137,0)
 L +@(DIE_BIDA_")"):5 I '$T S BIPOP=1 D:'$G(Z) LOCKED^BIUTL3 Q
"RTN","BIFMAN",138,0)
 D ^DIE
"RTN","BIFMAN",139,0)
 S:($D(DTOUT))!($D(Y)) BIPOP=1
"RTN","BIFMAN",140,0)
 L -@(DIE_BIDA_")")
"RTN","BIFMAN",141,0)
 D DKILLS
"RTN","BIFMAN",142,0)
 Q
"RTN","BIFMAN",143,0)
 ;
"RTN","BIFMAN",144,0)
 ;
"RTN","BIFMAN",145,0)
 ;----------
"RTN","BIFMAN",146,0)
FDIE(BIFN,BIIENS,BIFLD,BIERR,BIEXT) ;EP - Call to FILE^DIE.
"RTN","BIFMAN",147,0)
 ;---> CALL TO FILE^DIE - File validated data into an *EXISTING* entry in a file.
"RTN","BIFMAN",148,0)
 ;---> Parameters:
"RTN","BIFMAN",149,0)
 ;     1 - BIFN   (req) File Number.
"RTN","BIFMAN",150,0)
 ;     2 - BIIENS (req) IENS comma-delimited String.
"RTN","BIFMAN",151,0)
 ;     3 - BIFLD  (req) Array of BIFLD(Field#)=Value
"RTN","BIFMAN",152,0)
 ;     4 - BIERR  (ret) Text of error, if any.
"RTN","BIFMAN",153,0)
 ;     5 - BIEXT  (opt) If BIEXT=1, tell FILE^DIE values are External.
"RTN","BIFMAN",154,0)
 ;
"RTN","BIFMAN",155,0)
 ;---> Example:
"RTN","BIFMAN",156,0)
 ;---> Build FDA field=value array.
"RTN","BIFMAN",157,0)
 ;N BIFLD
"RTN","BIFMAN",158,0)
 ;S BIFLD(.08)=E
"RTN","BIFMAN",159,0)
 ;S BIFLD(.09)=C
"RTN","BIFMAN",160,0)
 ;S BIFLD(.1)=B
"RTN","BIFMAN",161,0)
 ;S BIFLD(.11)=D
"RTN","BIFMAN",162,0)
 ;
"RTN","BIFMAN",163,0)
 ;---> Store edit data.
"RTN","BIFMAN",164,0)
 ;---> Example: D FDIE^BIFMAN(9002084,+BIIEN,.BIFLD,.BIERR)
"RTN","BIFMAN",165,0)
 ;
"RTN","BIFMAN",166,0)
 ;
"RTN","BIFMAN",167,0)
 N BIDA,BIFDA,BIGBL,BIMSG
"RTN","BIFMAN",168,0)
 ;
"RTN","BIFMAN",169,0)
 ;---Check for valid File Number and Data Dictionary.
"RTN","BIFMAN",170,0)
 I '$G(BIFN) D ERRCD^BIUTL2(671,.BIERR) Q
"RTN","BIFMAN",171,0)
 I '$D(^DD($G(BIFN),0)) D ERRCD^BIUTL2(671,.BIERR) Q
"RTN","BIFMAN",172,0)
 ;
"RTN","BIFMAN",173,0)
 ;---> Check for valid IEN.
"RTN","BIFMAN",174,0)
 I '$G(BIIENS) D ERRCD^BIUTL2(672,.BIERR) Q
"RTN","BIFMAN",175,0)
 ;---> Append mandatory terminating comma to IENS if not present.
"RTN","BIFMAN",176,0)
 S:($E(BIIENS,$L(BIIENS))'=",") BIIENS=BIIENS_","
"RTN","BIFMAN",177,0)
 S BIDA=$P(BIIENS,",",($L(BIIENS,",")-1))
"RTN","BIFMAN",178,0)
 ;
"RTN","BIFMAN",179,0)
 ;---Check for valid global.
"RTN","BIFMAN",180,0)
 S BIGBL=$G(^DIC(BIFN,0,"GL"))
"RTN","BIFMAN",181,0)
 I BIGBL="" D ERRCD^BIUTL2(601,.BIERR) Q
"RTN","BIFMAN",182,0)
 ;
"RTN","BIFMAN",183,0)
 ;---> Check for existence of the top level entry to be edited.
"RTN","BIFMAN",184,0)
 I '$D(@(BIGBL_BIDA_",0)")) D ERRCD^BIUTL2(673,.BIERR) Q
"RTN","BIFMAN",185,0)
 ;
"RTN","BIFMAN",186,0)
 ;---> Lock entry or quit if unavailable.
"RTN","BIFMAN",187,0)
 L +@(BIGBL_BIDA_")"):5 I '$T D ERRCD^BIUTL2(670,.BIERR) Q
"RTN","BIFMAN",188,0)
 ;
"RTN","BIFMAN",189,0)
 ;---> Process External/Internal Flag value.
"RTN","BIFMAN",190,0)
 S BIEXT=$S($G(BIEXT)=1:"E",1:"")
"RTN","BIFMAN",191,0)
 ;
"RTN","BIFMAN",192,0)
 ;---> Create FDA.
"RTN","BIFMAN",193,0)
 N N S N=0
"RTN","BIFMAN",194,0)
 F  S N=$O(BIFLD(N)) Q:'N  D
"RTN","BIFMAN",195,0)
 .S BIFDA(BIFN,BIIENS,N)=BIFLD(N)
"RTN","BIFMAN",196,0)
 ;
"RTN","BIFMAN",197,0)
 D FILE^DIE(BIEXT,"BIFDA","BIMSG")
"RTN","BIFMAN",198,0)
 L -@(BIGBL_BIDA_")")
"RTN","BIFMAN",199,0)
 S BIERR=$G(BIMSG("DIERR",1,"TEXT",1))
"RTN","BIFMAN",200,0)
 I BIERR'="" S BIERR=$E(BIERR,1,($L(BIERR)-1))_" (software error). #674"
"RTN","BIFMAN",201,0)
 D DKILLS
"RTN","BIFMAN",202,0)
 Q
"RTN","BIFMAN",203,0)
 ;
"RTN","BIFMAN",204,0)
 ;
"RTN","BIFMAN",205,0)
 ;----------
"RTN","BIFMAN",206,0)
DIR(DIR0,Y,BIPOP,DIRA,DIRB,DIRQ,DIRQ1) ;EP
"RTN","BIFMAN",207,0)
 ;---> Call to ^DIR - General purpose reader, for prompts, etc.
"RTN","BIFMAN",208,0)
 ;---> Parameters:
"RTN","BIFMAN",209,0)
 ;     1 - DIR0=DIR(0)      (req) Indicate type of read
"RTN","BIFMAN",210,0)
 ;     2 - Y                (ret) From call to ^DIR
"RTN","BIFMAN",211,0)
 ;     3 - BIPOP            (ret) BIPOP=1 if DIRUT
"RTN","BIFMAN",212,0)
 ;     4 - DIRA=DIR("A")    (opt) Prompt
"RTN","BIFMAN",213,0)
 ;     5 - DIRB=DIR("B")    (opt) Default
"RTN","BIFMAN",214,0)
 ;     6 - DIRQ=DIR("?")    (opt) Help
"RTN","BIFMAN",215,0)
 ;     7 - DIRQ1=DIR("?",1) (opt) Addtional help
"RTN","BIFMAN",216,0)
 ;
"RTN","BIFMAN",217,0)
 ;---> Example: D DIR^BIFMAN("SAM",.Y,.BIPOP,"   Select FORMAT: ")
"RTN","BIFMAN",218,0)
 ;
"RTN","BIFMAN",219,0)
 I $G(DIR0)']"" S BIPOP=1 Q
"RTN","BIFMAN",220,0)
 N DIR,X S BIPOP=0,DIR(0)=DIR0
"RTN","BIFMAN",221,0)
 S:$G(DIRA)]"" DIR("A")=DIRA
"RTN","BIFMAN",222,0)
 S:$G(DIRB)]"" DIR("B")=DIRB
"RTN","BIFMAN",223,0)
 S:$G(DIRQ)]"" DIR("?")=DIRQ
"RTN","BIFMAN",224,0)
 S:$G(DIRQ1)]"" DIR("?",1)=DIRQ1
"RTN","BIFMAN",225,0)
 D ^DIR
"RTN","BIFMAN",226,0)
 S:$D(DIRUT) BIPOP=1
"RTN","BIFMAN",227,0)
 D DKILLS
"RTN","BIFMAN",228,0)
 Q
"RTN","BIFMAN",229,0)
 ;
"RTN","BIFMAN",230,0)
 ;
"RTN","BIFMAN",231,0)
YESNO ; EP
"RTN","BIFMAN",232,0)
 ;---> * NOT USED! *
"RTN","BIFMAN",233,0)
 ;---> Sample Code for Yes/No question.
"RTN","BIFMAN",234,0)
 W !!?3,"Should this patient's Status be Yes or No?",!
"RTN","BIFMAN",235,0)
 N DIR
"RTN","BIFMAN",236,0)
 S DIR(0)="YA"  ; Add "O" (YAO) to make answer optional.
"RTN","BIFMAN",237,0)
 ;              ; "A" means Append nothing to the DIR("A") prompt.
"RTN","BIFMAN",238,0)
 S DIR("A")="   Enter Yes or No: "  ; Prompt.
"RTN","BIFMAN",239,0)
 S DIR("B")="NO"  ; Default.
"RTN","BIFMAN",240,0)
 S DIR("?",1)="     Enter YES to say Yes."  ; First line of "?" help.
"RTN","BIFMAN",241,0)
 S DIR("?")="     Enter No to say No."  ; Last line of "?" help.
"RTN","BIFMAN",242,0)
 D ^DIR W !
"RTN","BIFMAN",243,0)
 ;---> If answer is YES, Y=1.
"RTN","BIFMAN",244,0)
 D:Y=1
"RTN","BIFMAN",245,0)
 .N BIFLD,BIERR S BIFLD(.08)="",BIFLD(.16)=""
"RTN","BIFMAN",246,0)
 .D FDIE^BIFMAN(9002084,BIDFN,.BIFLD,.BIERR,1)
"RTN","BIFMAN",247,0)
 .I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIFMAN",248,0)
 Q
"RTN","BIFMAN",249,0)
 ;
"RTN","BIFMAN",250,0)
 ;
"RTN","BIFMAN",251,0)
 ;----------
"RTN","BIFMAN",252,0)
FILE(DIC,X,DIC0,DICDR,DINUM,Y,BIPOP) ; EP - Call FILE^DICN
"RTN","BIFMAN",253,0)
 ;---> Add a new entry to a file.
"RTN","BIFMAN",254,0)
 ;---> Parameters:
"RTN","BIFMAN",255,0)
 ;     1 - DIC    (req) DIC, numeric or global ref
"RTN","BIFMAN",256,0)
 ;     2 - X      (req) .01 value to be added
"RTN","BIFMAN",257,0)
 ;     3 - DIC0   (req) DIC(0), input parameter string
"RTN","BIFMAN",258,0)
 ;     4 - DICDR  (opt) DIC("DR")
"RTN","BIFMAN",259,0)
 ;     5 - DINUM  (opt) IEN of entry to be added
"RTN","BIFMAN",260,0)
 ;     6 - Y      (ret) Value of Y returned by ^DICN
"RTN","BIFMAN",261,0)
 ;     7 - BIPOP  (ret) BIPOP=1 if DTOUT OR DUOUT
"RTN","BIFMAN",262,0)
 ;
"RTN","BIFMAN",263,0)
 ;---> Example: D FILE^BIFMAN(9002084.35,N,"ML",".02////3")
"RTN","BIFMAN",264,0)
 ;
"RTN","BIFMAN",265,0)
 K DD,DO
"RTN","BIFMAN",266,0)
 I DIC S DLAYGO=DIC,DIC=^DIC(DIC,0,"GL")
"RTN","BIFMAN",267,0)
 S:$G(DICDR)]"" DIC("DR")=DICDR S DIC(0)=DIC0
"RTN","BIFMAN",268,0)
 D FILE^DICN
"RTN","BIFMAN",269,0)
 S BIPOP=$S(($D(DTOUT)!($D(DUOUT))):1,1:0)
"RTN","BIFMAN",270,0)
 D DKILLS
"RTN","BIFMAN",271,0)
 Q
"RTN","BIFMAN",272,0)
 ;
"RTN","BIFMAN",273,0)
 ;
"RTN","BIFMAN",274,0)
 ;----------
"RTN","BIFMAN",275,0)
DIK ; EP - CALL ^DIK
"RTN","BIFMAN",276,0)
 D ^DIK
"RTN","BIFMAN",277,0)
 D DKILLS
"RTN","BIFMAN",278,0)
 Q
"RTN","BIFMAN",279,0)
 ;
"RTN","BIFMAN",280,0)
 ;
"RTN","BIFMAN",281,0)
 ;----------
"RTN","BIFMAN",282,0)
DIQ ; EP - CALL ^DIQ
"RTN","BIFMAN",283,0)
 D EN^DIQ
"RTN","BIFMAN",284,0)
 D DKILLS
"RTN","BIFMAN",285,0)
 Q
"RTN","BIFMAN",286,0)
 ;
"RTN","BIFMAN",287,0)
 ;
"RTN","BIFMAN",288,0)
 ;----------
"RTN","BIFMAN",289,0)
DIQ1 ; EP - CALL ^DIQ1
"RTN","BIFMAN",290,0)
 D EN^DIQ1
"RTN","BIFMAN",291,0)
 D DKILLS
"RTN","BIFMAN",292,0)
 Q
"RTN","BIFMAN",293,0)
 ;
"RTN","BIFMAN",294,0)
 ;
"RTN","BIFMAN",295,0)
 ;----------
"RTN","BIFMAN",296,0)
DKILLS ;EP
"RTN","BIFMAN",297,0)
 K D,D0,D1,DA,DD,DDH,DI,DIADD,DIC,DIC1,DICR,DIE,DIG,DIH,DIK,DILC
"RTN","BIFMAN",298,0)
 K DINUM,DIRUT,DIQ,DIQ2,DIR,DIU,DIW,DIWF,DIWL,DIWR,DIWT,DK,DL
"RTN","BIFMAN",299,0)
 K DLAYGO,DN,DQ,DR,DTOUT,DUOUT,DX
"RTN","BIFMAN",300,0)
 D CLEAN^DILF
"RTN","BIFMAN",301,0)
 Q
"RTN","BIHELP")
0^37^B6184348
"RTN","BIHELP",1,0)
BIHELP ;IHS/CMI/MWR - DISPLAY HELP TEXT; MAY 10, 2010
"RTN","BIHELP",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIHELP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIHELP",4,0)
 ;;  VIEW OR PRINT HELP TEXT.
"RTN","BIHELP",5,0)
 ;
"RTN","BIHELP",6,0)
 ;----------
"RTN","BIHELP",7,0)
START(BIHEADER,BITEXT) ;EP
"RTN","BIHELP",8,0)
 ;---> Display in Listman the passed array of Help Text.
"RTN","BIHELP",9,0)
 ;---> Parameters:
"RTN","BIHELP",10,0)
 ;     1 - BIHEADER (opt) Header.
"RTN","BIHELP",11,0)
 ;     2 - BITEXT   (req) Array of Text to be displayed.
"RTN","BIHELP",12,0)
 ;
"RTN","BIHELP",13,0)
 I '$O(BITEXT(0)) D
"RTN","BIHELP",14,0)
 .N X D ERRCD^BIUTL2(666,.X) S BITEXT(1)=" ",BITEXT(2)="     "_X
"RTN","BIHELP",15,0)
 ;
"RTN","BIHELP",16,0)
 ;*** DO NOT NEW VALM* GOING INTO A LIST TEMPLATE FROM ANOTHER ONE
"RTN","BIHELP",17,0)
 ;*** --WILL CAUSE ERRORS!
"RTN","BIHELP",18,0)
 N VALMCNT
"RTN","BIHELP",19,0)
 D SETVARS^BIUTL5 K ^TMP("BIHELP",$J)
"RTN","BIHELP",20,0)
 D EN
"RTN","BIHELP",21,0)
 Q
"RTN","BIHELP",22,0)
 ;
"RTN","BIHELP",23,0)
 ;
"RTN","BIHELP",24,0)
 ;----------
"RTN","BIHELP",25,0)
EN ;EP
"RTN","BIHELP",26,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIHELP",27,0)
 D EN^VALM("BI GENERIC HELP VIEW")
"RTN","BIHELP",28,0)
 Q
"RTN","BIHELP",29,0)
 ;
"RTN","BIHELP",30,0)
 ;
"RTN","BIHELP",31,0)
 ;----------
"RTN","BIHELP",32,0)
HDR ;EP
"RTN","BIHELP",33,0)
 ;---> Header code
"RTN","BIHELP",34,0)
 ;D HEAD^BIREPA2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIHELP",35,0)
 ;
"RTN","BIHELP",36,0)
 ;---> Header code.
"RTN","BIHELP",37,0)
 N BIDASH,BILINE,X,Y S BILINE=0
"RTN","BIHELP",38,0)
 D WH^BIW(.BILINE)
"RTN","BIHELP",39,0)
 S:$G(BIHEADER)="" BIHEADER="HELP SCREEN"
"RTN","BIHELP",40,0)
 S X=BIHEADER
"RTN","BIHELP",41,0)
 S BIDASH=$L(X)+2
"RTN","BIHELP",42,0)
 D CENTERT^BIUTL5(.X)
"RTN","BIHELP",43,0)
 D WH^BIW(.BILINE,X)
"RTN","BIHELP",44,0)
 Q
"RTN","BIHELP",45,0)
 ;
"RTN","BIHELP",46,0)
 ;
"RTN","BIHELP",47,0)
 ;----------
"RTN","BIHELP",48,0)
INIT ;EP
"RTN","BIHELP",49,0)
 ;---> Initialize variables and list array.
"RTN","BIHELP",50,0)
 S VALM("TITLE")=" (Immunization v"_$$VER^BILOGO_")"
"RTN","BIHELP",51,0)
 ;
"RTN","BIHELP",52,0)
 ;---> Gather text from ^BINFO( Word Processing global.
"RTN","BIHELP",53,0)
 N BILINE,N
"RTN","BIHELP",54,0)
 S BILINE=0,N=0
"RTN","BIHELP",55,0)
 F  S N=$O(BITEXT(N)) Q:'N  D
"RTN","BIHELP",56,0)
 .D WL^BIW(.BILINE,"BIHELP",BITEXT(N))
"RTN","BIHELP",57,0)
 S VALMCNT=BILINE
"RTN","BIHELP",58,0)
 I VALMCNT>15 D
"RTN","BIHELP",59,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIHELP",60,0)
 Q
"RTN","BIHELP",61,0)
 ;
"RTN","BIHELP",62,0)
 ;
"RTN","BIHELP",63,0)
 ;----------
"RTN","BIHELP",64,0)
RESET ;EP
"RTN","BIHELP",65,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIHELP",66,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIHELP",67,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIHELP",68,0)
 D INIT,HDR Q
"RTN","BIHELP",69,0)
 ;
"RTN","BIHELP",70,0)
 ;
"RTN","BIHELP",71,0)
 ;----------
"RTN","BIHELP",72,0)
HELP ;EP
"RTN","BIHELP",73,0)
 ;---> Help code.
"RTN","BIHELP",74,0)
 N BIX S BIX=X
"RTN","BIHELP",75,0)
 D FULL^VALM1
"RTN","BIHELP",76,0)
 W !!?5,"Use arrow keys to scroll up and down through the text, or"
"RTN","BIHELP",77,0)
 W !?5,"type ""??"" for more actions, such as Search and Print."
"RTN","BIHELP",78,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIHELP",79,0)
 D:BIX'="??" RE^VALM4
"RTN","BIHELP",80,0)
 Q
"RTN","BIHELP",81,0)
 ;
"RTN","BIHELP",82,0)
 ;
"RTN","BIHELP",83,0)
 ;----------
"RTN","BIHELP",84,0)
EXIT ;EP
"RTN","BIHELP",85,0)
 ;---> Cleanup, EOJ.
"RTN","BIHELP",86,0)
 K ^TMP("BIHELP",$J)
"RTN","BIHELP",87,0)
 D CLEAR^VALM1
"RTN","BIHELP",88,0)
 D FULL^VALM1
"RTN","BIHELP",89,0)
 Q
"RTN","BIHELP",90,0)
 ;
"RTN","BIHELP",91,0)
 ;
"RTN","BIHELP",92,0)
 ;----------
"RTN","BIHELP",93,0)
DEVICE(BIPOP) ;EP
"RTN","BIHELP",94,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIHELP",95,0)
 ;---> Parameters:
"RTN","BIHELP",96,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIHELP",97,0)
 ;
"RTN","BIHELP",98,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIHELP",99,0)
 ;S ZTRTN="DEQUEUE^BIHELP"
"RTN","BIHELP",100,0)
 ;D ZSAVES^BIUTL3
"RTN","BIHELP",101,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIHELP",102,0)
 Q
"RTN","BIHELP",103,0)
 ;
"RTN","BIHELP",104,0)
 ;
"RTN","BIHELP",105,0)
 ;----------
"RTN","BIHELP",106,0)
DEQUEUE ;EP
"RTN","BIHELP",107,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIHELP",108,0)
 ;K VALMHDR,^TMP("BIHELP",$J)
"RTN","BIHELP",109,0)
 ;D HDR
"RTN","BIHELP",110,0)
 ;D INIT?
"RTN","BIHELP",111,0)
 ;I $G(BIPOP) D EXIT Q
"RTN","BIHELP",112,0)
 ;D PRTLST^BIUTL8("BIREPA1"),EXIT
"RTN","BIHELP",113,0)
 Q
"RTN","BIHELP",114,0)
 ;
"RTN","BIHELP",115,0)
 ;
"RTN","BIHELP",116,0)
 ;----------
"RTN","BIHELP",117,0)
ERROR(BIERR) ;EP
"RTN","BIHELP",118,0)
 ;---> Report error, either to screen or print.
"RTN","BIHELP",119,0)
 ;---> Parameters:
"RTN","BIHELP",120,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIHELP",121,0)
 ;
"RTN","BIHELP",122,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIHELP",123,0)
 Q
"RTN","BIHS")
0^38^B8292268
"RTN","BIHS",1,0)
BIHS ;IHS/CMI/MWR - DISPLAY HEALTH SUMMARY; MAY 10, 2010
"RTN","BIHS",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIHS",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIHS",4,0)
 ;;  CALLS APCH SOFTWARE TO DISPLAY HEALTH SUMMARY.
"RTN","BIHS",5,0)
 ;;  CALLED BY PROTOCOL: BI HEALTH SUMMARY.
"RTN","BIHS",6,0)
 ;
"RTN","BIHS",7,0)
 ;
"RTN","BIHS",8,0)
 ;----------
"RTN","BIHS",9,0)
HS ;EP
"RTN","BIHS",10,0)
 ; ZEXCEPT: BIDFN
"RTN","BIHS",11,0)
 ;---> Called from Protocol to display Health Summary.
"RTN","BIHS",12,0)
 ;
"RTN","BIHS",13,0)
 Q:'$G(BIDFN)
"RTN","BIHS",14,0)
 N DFN,X,Y
"RTN","BIHS",15,0)
 D FULL^VALM1
"RTN","BIHS",16,0)
 ;
"RTN","BIHS",17,0)
 I '$$RPMS^BIUTL9() D VISTA QUIT
"RTN","BIHS",18,0)
 ;
"RTN","BIHS",19,0)
 ;---> Set Health Summary Type default.
"RTN","BIHS",20,0)
 D
"RTN","BIHS",21,0)
 .;---> Look for user's last choice.
"RTN","BIHS",22,0)
 .N Y S Y=$G(^DISV($G(DUZ),"^APCHSCTL("))
"RTN","BIHS",23,0)
 .S X=$P($G(^APCHSCTL(+Y,0)),U,1)
"RTN","BIHS",24,0)
 .Q:X]""
"RTN","BIHS",25,0)
 .;
"RTN","BIHS",26,0)
 .;---> Get default from PCC MASTER CONTROL File.
"RTN","BIHS",27,0)
 .I $D(^APCCCTRL($G(DUZ(2)),0))#2 S X=$P(^(0),U,3) Q
"RTN","BIHS",28,0)
 .;
"RTN","BIHS",29,0)
 .S X="ADULT REGULAR"
"RTN","BIHS",30,0)
 ;
"RTN","BIHS",31,0)
 ;---> Select Health Summary Type.
"RTN","BIHS",32,0)
 D DIC^BIFMAN(9001015,"QEMA",.Y,,$G(X))
"RTN","BIHS",33,0)
 Q:Y<0
"RTN","BIHS",34,0)
 ;
"RTN","BIHS",35,0)
 N APCHSPAT,APCHSTYP,APCHSTAT,APCHSMTY,AMCHDAYS,AMCHDOB,APCDHDR
"RTN","BIHS",36,0)
 S APCHSTYP=+Y,(APCHSPAT,DFN)=BIDFN
"RTN","BIHS",37,0)
 S APCDHDR="PCC Health Summary for "_$P(^DPT(DFN,0),U)
"RTN","BIHS",38,0)
 D
"RTN","BIHS",39,0)
 .;---> Preserve BIDFN.
"RTN","BIHS",40,0)
 .N BIDFN
"RTN","BIHS",41,0)
 .;---> Call Viewer.
"RTN","BIHS",42,0)
 .D VIEWR^XBLM("EN^APCHS",APCDHDR)
"RTN","BIHS",43,0)
 .;---> Use next line the instead of the previous if there are problems
"RTN","BIHS",44,0)
 .;---> with Listmanager display of Health Summary.  ;MWRZZZ
"RTN","BIHS",45,0)
 .;D HSOUT^APCHS,DIRZ^BIUTL3()
"RTN","BIHS",46,0)
 ;
"RTN","BIHS",47,0)
 Q
"RTN","BIHS",48,0)
 ;
"RTN","BIHS",49,0)
VISTA ; [Internal Only] EP Print VISTA Health Summary
"RTN","BIHS",50,0)
 ; ZEXCEPT: BIDFN
"RTN","BIHS",51,0)
 ; Use IA 242
"RTN","BIHS",52,0)
 N DIC,X,Y,DLAYGO,DINUM,DTOUT,DUOUT
"RTN","BIHS",53,0)
 S DIC=142,DIC(0)="AEMQ" D ^DIC  ; Select Health Summary type
"RTN","BIHS",54,0)
 I $G(DTOUT)!$G(DUOUT) QUIT
"RTN","BIHS",55,0)
 N TYP S TYP=+Y
"RTN","BIHS",56,0)
 ;
"RTN","BIHS",57,0)
 N %ZIS S %ZIS="Q"  ; queueing allowed
"RTN","BIHS",58,0)
 D ^%ZIS
"RTN","BIHS",59,0)
 Q:$G(POP)
"RTN","BIHS",60,0)
 ;
"RTN","BIHS",61,0)
 I $D(IO("Q")) D  ; queueing requested
"RTN","BIHS",62,0)
 . N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTUCI,ZTCPU,ZTPRI,ZTSAVE,ZTKIL,ZTSYNC,ZTSK
"RTN","BIHS",63,0)
 . S ZTRTN="ENX^GMTSDVR(BIDFN,TYP)",ZTDTH=$H,ZTDESC="Health Summary from Immunizations Package"
"RTN","BIHS",64,0)
 . S ZTSAVE("BIDFN")="",ZTSAVE("TYP")=""
"RTN","BIHS",65,0)
 . D ^%ZTLOAD
"RTN","BIHS",66,0)
 . I $G(ZTSK) W "Printing off as task number "_ZTSK_" ."
"RTN","BIHS",67,0)
 . E  W "Couldn't task this. Please call support."
"RTN","BIHS",68,0)
 . N DIR,X,Y,DA,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BIHS",69,0)
 . S DIR(0)="E" D ^DIR
"RTN","BIHS",70,0)
 ;
"RTN","BIHS",71,0)
 E  D  ; no queueing. Print in process.
"RTN","BIHS",72,0)
 . U IO
"RTN","BIHS",73,0)
 . D ENX^GMTSDVR(BIDFN,TYP)
"RTN","BIHS",74,0)
 ;
"RTN","BIHS",75,0)
 D ^%ZISC  ; close device in either case
"RTN","BIHS",76,0)
 QUIT
"RTN","BIKEY")
0^39^B18843758
"RTN","BIKEY",1,0)
BIKEY ;IHS/CMI/MWR - UTIL: VIEW/ALLOCATE BI KEYS; MAY 10, 2010
"RTN","BIKEY",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIKEY",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIKEY",4,0)
 ;;  VIEW HOLDERS OF BI KEYS AND ALLOCATE/DEALLOCATE KEYS.
"RTN","BIKEY",5,0)
 ;
"RTN","BIKEY",6,0)
 ;
"RTN","BIKEY",7,0)
 ;----------
"RTN","BIKEY",8,0)
START ;EP
"RTN","BIKEY",9,0)
 ;---> Main entry point for option BI KEYS ALLOCATE.
"RTN","BIKEY",10,0)
 D SETVARS^BIUTL5 K ^TMP("BIKEYS",$J) N BITMP,DIR
"RTN","BIKEY",11,0)
 D EN
"RTN","BIKEY",12,0)
 D EXIT
"RTN","BIKEY",13,0)
 Q
"RTN","BIKEY",14,0)
 ;
"RTN","BIKEY",15,0)
 ;
"RTN","BIKEY",16,0)
 ;----------
"RTN","BIKEY",17,0)
EN ;EP
"RTN","BIKEY",18,0)
 D EN^VALM("BI KEY HOLDERS VIEW/EDIT")
"RTN","BIKEY",19,0)
 Q
"RTN","BIKEY",20,0)
 ;
"RTN","BIKEY",21,0)
 ;
"RTN","BIKEY",22,0)
 ;----------
"RTN","BIKEY",23,0)
HDR ;EP
"RTN","BIKEY",24,0)
 ;---> Header code
"RTN","BIKEY",25,0)
 N BIDASH,BILINE,X,Y S BILINE=0
"RTN","BIKEY",26,0)
 D WH^BIW(.BILINE)
"RTN","BIKEY",27,0)
 S X="HOLDERS OF IMMUNIZATION KEYS AT "_$$INSTTX^BIUTL6($G(DUZ(2)))
"RTN","BIKEY",28,0)
 S BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIKEY",29,0)
 D WH^BIW(.BILINE,X)
"RTN","BIKEY",30,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIKEY",31,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIKEY",32,0)
 S X=" HOLDER                 BIZMENU   BIZ EDIT PATIENTS"
"RTN","BIKEY",33,0)
 S X=X_"   BIZ MANAGER   BIZ LOT ONLY"
"RTN","BIKEY",34,0)
 D WH^BIW(.BILINE,X)
"RTN","BIKEY",35,0)
 Q
"RTN","BIKEY",36,0)
 ;
"RTN","BIKEY",37,0)
 ;
"RTN","BIKEY",38,0)
 ;----------
"RTN","BIKEY",39,0)
INIT ;EP
"RTN","BIKEY",40,0)
 ;---> Initialize variables and list array.
"RTN","BIKEY",41,0)
 ;
"RTN","BIKEY",42,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BIKEY",43,0)
 S VALM("TITLE")=$$LMVER^BILOGO()
"RTN","BIKEY",44,0)
 ;
"RTN","BIKEY",45,0)
 K ^TMP("BIHOLD",$J),^TMP("BIKEYS",$J)
"RTN","BIKEY",46,0)
 N BIKEY S BIKEY="BIZ"
"RTN","BIKEY",47,0)
 ;F  S BIKEY=$O(^DIC(19.1,"B",BIKEY)) Q:BIKEY=""  Q:BIKEY]"BIZZ"  D
"RTN","BIKEY",48,0)
 F BIKEY="BIZMENU","BIZ EDIT PATIENTS","BIZ MANAGER","BIZ LOT ONLY" D
"RTN","BIKEY",49,0)
 .N BIKIEN
"RTN","BIKEY",50,0)
 .S BIKIEN=$O(^DIC(19.1,"B",BIKEY,0))
"RTN","BIKEY",51,0)
 .Q:'BIKIEN
"RTN","BIKEY",52,0)
 .;
"RTN","BIKEY",53,0)
 .N BIDUZ S BIDUZ=0
"RTN","BIKEY",54,0)
 .F  S BIDUZ=$O(^XUSEC(BIKEY,BIDUZ)) Q:BIDUZ=""  D
"RTN","BIKEY",55,0)
 ..S ^TMP("BIHOLD",$J,$$PERSON^BIUTL1(BIDUZ),BIKEY)=""
"RTN","BIKEY",56,0)
 ;
"RTN","BIKEY",57,0)
 ;
"RTN","BIKEY",58,0)
 N BIHLDRS,BINAME S BIHLDRS=0,BINAME=0
"RTN","BIKEY",59,0)
 F  S BINAME=$O(^TMP("BIHOLD",$J,BINAME)) Q:BINAME=""  D
"RTN","BIKEY",60,0)
 .N BIY
"RTN","BIKEY",61,0)
 .S BIY=" "_$E(BINAME,1,20)
"RTN","BIKEY",62,0)
 .;
"RTN","BIKEY",63,0)
 .I $D(^TMP("BIHOLD",$J,BINAME,"BIZMENU")) D
"RTN","BIKEY",64,0)
 ..S BIY=$$PAD^BIUTL5(BIY,24,"."),BIY=BIY_"YES"
"RTN","BIKEY",65,0)
 .;
"RTN","BIKEY",66,0)
 .I $D(^TMP("BIHOLD",$J,BINAME,"BIZ EDIT PATIENTS")) D
"RTN","BIKEY",67,0)
 ..S BIY=$$PAD^BIUTL5(BIY,34,"."),BIY=BIY_"YES"
"RTN","BIKEY",68,0)
 .;
"RTN","BIKEY",69,0)
 .I $D(^TMP("BIHOLD",$J,BINAME,"BIZ MANAGER")) D
"RTN","BIKEY",70,0)
 ..S BIY=$$PAD^BIUTL5(BIY,54,"."),BIY=BIY_"YES"
"RTN","BIKEY",71,0)
 .;
"RTN","BIKEY",72,0)
 .;  vvv83
"RTN","BIKEY",73,0)
 .I $D(^TMP("BIHOLD",$J,BINAME,"BIZ LOT ONLY")) D
"RTN","BIKEY",74,0)
 ..S BIY=$$PAD^BIUTL5(BIY,68,"."),BIY=BIY_"YES"
"RTN","BIKEY",75,0)
 .;
"RTN","BIKEY",76,0)
 .S BIHLDRS=BIHLDRS+1
"RTN","BIKEY",77,0)
 .S ^TMP("BIKEYS",$J,BIHLDRS,0)=BIY
"RTN","BIKEY",78,0)
 ;
"RTN","BIKEY",79,0)
 S VALMCNT=BIHLDRS
"RTN","BIKEY",80,0)
 I VALMCNT>13 D
"RTN","BIKEY",81,0)
 .S VALMSG="Scroll down to view more.  Type ?? for more actions."
"RTN","BIKEY",82,0)
 Q
"RTN","BIKEY",83,0)
 ;
"RTN","BIKEY",84,0)
 ;
"RTN","BIKEY",85,0)
 ;----------
"RTN","BIKEY",86,0)
RESET ;EP
"RTN","BIKEY",87,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIKEY",88,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIKEY",89,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIKEY",90,0)
 D INIT,HDR Q
"RTN","BIKEY",91,0)
 ;
"RTN","BIKEY",92,0)
 ;
"RTN","BIKEY",93,0)
 ;----------
"RTN","BIKEY",94,0)
HELP ;EP
"RTN","BIKEY",95,0)
 ;---> Help code.
"RTN","BIKEY",96,0)
 N BIX S BIX=X
"RTN","BIKEY",97,0)
 D FULL^VALM1
"RTN","BIKEY",98,0)
 D TITLE^BIUTL5("HOLDERS OF IMMUNIZATION KEYS - HELP")
"RTN","BIKEY",99,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIKEY",100,0)
 D:BIX'="??" RE^VALM4
"RTN","BIKEY",101,0)
 Q
"RTN","BIKEY",102,0)
 ;
"RTN","BIKEY",103,0)
 ;
"RTN","BIKEY",104,0)
 ;----------
"RTN","BIKEY",105,0)
TEXT1 ;EP
"RTN","BIKEY",106,0)
 ;;This screen displays all users who hold any of the four Keys to
"RTN","BIKEY",107,0)
 ;;the Immunization Package.  The Keys, which begin with BIZ, are
"RTN","BIKEY",108,0)
 ;;listed as column headers at the top of the screen.
"RTN","BIKEY",109,0)
 ;;
"RTN","BIKEY",110,0)
 ;;A "YES" in the column under a Key name indicates that the user
"RTN","BIKEY",111,0)
 ;;listed on that line holds the Key in the column header.
"RTN","BIKEY",112,0)
 ;;
"RTN","BIKEY",113,0)
 ;;There are two Actions presented at the bottom of the screen:
"RTN","BIKEY",114,0)
 ;;
"RTN","BIKEY",115,0)
 ;;1 - "Add/Edit a Holder" allows you to allocate or deallocate the
"RTN","BIKEY",116,0)
 ;;    Immunization Keys to users.
"RTN","BIKEY",117,0)
 ;;
"RTN","BIKEY",118,0)
 ;;2 - "Help" presents a detailed explanation of the privileges each Key
"RTN","BIKEY",119,0)
 ;;    bestows upon holders of the Key.
"RTN","BIKEY",120,0)
 ;;
"RTN","BIKEY",121,0)
 ;;
"RTN","BIKEY",122,0)
 ;
"RTN","BIKEY",123,0)
 D PRINTX("TEXT1")
"RTN","BIKEY",124,0)
 Q
"RTN","BIKEY",125,0)
 ;
"RTN","BIKEY",126,0)
 ;
"RTN","BIKEY",127,0)
 ;----------
"RTN","BIKEY",128,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIKEY",129,0)
 Q:$G(BILINL)=""
"RTN","BIKEY",130,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIKEY",131,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIKEY",132,0)
 Q
"RTN","BIKEY",133,0)
 ;
"RTN","BIKEY",134,0)
 ;
"RTN","BIKEY",135,0)
 ;----------
"RTN","BIKEY",136,0)
EXIT ;EP
"RTN","BIKEY",137,0)
 ;---> EOJ cleanup.
"RTN","BIKEY",138,0)
 K ^TMP("BIHOLD",$J),^TMP("BIKEYS",$J)
"RTN","BIKEY",139,0)
 D CLEAR^VALM1
"RTN","BIKEY",140,0)
 D FULL^VALM1
"RTN","BIKEY",141,0)
 Q
"RTN","BIKEY1")
0^40^B39893921
"RTN","BIKEY1",1,0)
BIKEY1 ;IHS/CMI/MWR - ALLOCATE/DEALLOCATE BI KEYS; MAY 10, 2010
"RTN","BIKEY1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIKEY1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIKEY1",4,0)
 ;;  ALLOCATE/DEALLOCATE BI KEYS TO USERS.
"RTN","BIKEY1",5,0)
 ;
"RTN","BIKEY1",6,0)
 ;
"RTN","BIKEY1",7,0)
 ;----------
"RTN","BIKEY1",8,0)
START ;EP
"RTN","BIKEY1",9,0)
 ;
"RTN","BIKEY1",10,0)
 ;---> If DUZ is undefined or User does not hold BIZ MANAGER Key, quit.
"RTN","BIKEY1",11,0)
 D SETVARS^BIUTL5
"RTN","BIKEY1",12,0)
 D FULL^VALM1
"RTN","BIKEY1",13,0)
 I '$G(DUZ) D TITLE,ERRCD^BIUTL2(106,,1),RESET^BIKEY Q
"RTN","BIKEY1",14,0)
 I '$D(^XUSEC("BIZ MANAGER",DUZ)) D  Q
"RTN","BIKEY1",15,0)
 .D TITLE,ERRCD^BIUTL2(631,,1),RESET^BIKEY Q
"RTN","BIKEY1",16,0)
 ;
"RTN","BIKEY1",17,0)
 ;---> Select Person/User loop.
"RTN","BIKEY1",18,0)
 N Y
"RTN","BIKEY1",19,0)
 F  D  Q:Y<0
"RTN","BIKEY1",20,0)
 .D TITLE
"RTN","BIKEY1",21,0)
 .W !!?5,"Select the Person to whom you wish to Allocate or Deallocate"
"RTN","BIKEY1",22,0)
 .W !?5,"an Immunization (BIZ) Key.",!
"RTN","BIKEY1",23,0)
 .D DIC^BIFMAN(200,"QEMA",.Y,"     Select PERSON: ")
"RTN","BIKEY1",24,0)
 .Q:Y<0
"RTN","BIKEY1",25,0)
 .D SELECT(+Y)
"RTN","BIKEY1",26,0)
 D RESET^BIKEY
"RTN","BIKEY1",27,0)
 Q
"RTN","BIKEY1",28,0)
 ;
"RTN","BIKEY1",29,0)
 ;
"RTN","BIKEY1",30,0)
 ;----------
"RTN","BIKEY1",31,0)
SELECT(BIDUZ) ;EP
"RTN","BIKEY1",32,0)
 ;---> Select Key and action.
"RTN","BIKEY1",33,0)
 ;---> Parameters:
"RTN","BIKEY1",34,0)
 ;     1 - BIDUZ  (req) Person's IEN in New Person File #200.
"RTN","BIKEY1",35,0)
 ;
"RTN","BIKEY1",36,0)
 I '$G(BIDUZ) S BIERR=106 Q
"RTN","BIKEY1",37,0)
 I '$D(^VA(200,BIDUZ,0)) S BIERR=112 Q
"RTN","BIKEY1",38,0)
 ;
"RTN","BIKEY1",39,0)
 ;---> Allocate or Deallocate.
"RTN","BIKEY1",40,0)
 N BIHOLDER S BIHOLDER=$$PERSON^BIUTL1(BIDUZ,1)
"RTN","BIKEY1",41,0)
 W !!?5,"Do you wish to Allocate or Deallocate the Keys to "
"RTN","BIKEY1",42,0)
 W BIHOLDER,"?"
"RTN","BIKEY1",43,0)
 N DIR
"RTN","BIKEY1",44,0)
 S DIR("?",1)="     Choose Allocate to give a Key to a user."
"RTN","BIKEY1",45,0)
 S DIR("?")="     Choose Deallocate to take away a Key from a user."
"RTN","BIKEY1",46,0)
 S DIR(0)="SOM^A:Allocate;D:Deallocate"
"RTN","BIKEY1",47,0)
 S DIR("A")="     Enter A or D"
"RTN","BIKEY1",48,0)
 D ^DIR K DIR W !
"RTN","BIKEY1",49,0)
 I $D(DIRUT) D NOCHANGE Q
"RTN","BIKEY1",50,0)
 ;---> BIALL=1=Allocate, BIALL=0=Deallocate.
"RTN","BIKEY1",51,0)
 N BIALL S BIALL=$S(Y="A":1,1:0)
"RTN","BIKEY1",52,0)
 ;
"RTN","BIKEY1",53,0)
 ;---> Select Key.
"RTN","BIKEY1",54,0)
 D TITLE
"RTN","BIKEY1",55,0)
 W !!?5,"Select the Key(s) you wish to "
"RTN","BIKEY1",56,0)
 W:'BIALL "DE" W "ALLOCATE ",$S(BIALL:"to ",1:"from "),BIHOLDER,":"
"RTN","BIKEY1",57,0)
 D @$S(BIALL:"TEXT1",1:"TEXT2"),TEXT3
"RTN","BIKEY1",58,0)
 ;
"RTN","BIKEY1",59,0)
 N DIR
"RTN","BIKEY1",60,0)
 S DIR("?")="^D HELP1^BIKEY1"
"RTN","BIKEY1",61,0)
 S DIR(0)="LAO^1:4"
"RTN","BIKEY1",62,0)
 S DIR("A")="     Enter 1, 2, 3, or 4: "
"RTN","BIKEY1",63,0)
 D ^DIR W !
"RTN","BIKEY1",64,0)
 I Y<1!($D(DIRUT)) D NOCHANGE Q
"RTN","BIKEY1",65,0)
 K DIR N BIKEYS,BIPL,I S BIPL=0
"RTN","BIKEY1",66,0)
 ;
"RTN","BIKEY1",67,0)
 ;---> If Manager Key selected, automatically allocate all Keys.
"RTN","BIKEY1",68,0)
 I BIALL,Y[3 S Y="1,2,3"
"RTN","BIKEY1",69,0)
 F I=1,2,3,4 I Y[I S BIKEYS(I)="",BIPL=BIPL+1
"RTN","BIKEY1",70,0)
 I '$D(BIKEYS) D NOCHANGE Q
"RTN","BIKEY1",71,0)
 ;
"RTN","BIKEY1",72,0)
 ;
"RTN","BIKEY1",73,0)
 ;---> Confirm.
"RTN","BIKEY1",74,0)
 D TITLE
"RTN","BIKEY1",75,0)
 W !!?5 W:'BIALL "DE" W "ALLOCATE the Key" W:(BIPL>1) "s" W ":",!
"RTN","BIKEY1",76,0)
 W:$D(BIKEYS(1)) !?10,"1 - BIZMENU"
"RTN","BIKEY1",77,0)
 W:$D(BIKEYS(2)) !?10,"2 - BIZ EDIT PATIENTS"
"RTN","BIKEY1",78,0)
 W:$D(BIKEYS(3)) !?10,"3 - BIZ MANAGER"
"RTN","BIKEY1",79,0)
 W:$D(BIKEYS(4)) !?10,"4 - BIZ LOT ONLY"
"RTN","BIKEY1",80,0)
 ;
"RTN","BIKEY1",81,0)
 W !!?5,$S(BIALL:"To ",1:"From "),$$PERSON^BIUTL1(BIDUZ,1),"?",!
"RTN","BIKEY1",82,0)
 ;
"RTN","BIKEY1",83,0)
 N B S B(1)="     Enter YES to "_$S('BIALL:"DE",1:"")
"RTN","BIKEY1",84,0)
 S B(1)=B(1)_"ALLOCATE the Key"_$S(BIPL>1:"s ",1:" ")
"RTN","BIKEY1",85,0)
 S B(1)=B(1)_$S(BIALL:"to ",1:"from ")_$$PERSON^BIUTL1(BIDUZ,1)_"."
"RTN","BIKEY1",86,0)
 S B(2)="     Enter NO to make no changes."
"RTN","BIKEY1",87,0)
 D DIR^BIFMAN("Y",.Y,,"     Enter Yes or No","NO",B(2),B(1))
"RTN","BIKEY1",88,0)
 ;
"RTN","BIKEY1",89,0)
 ;---> Failed to confirm.
"RTN","BIKEY1",90,0)
 I Y<1!($D(DIRUT)) D NOCHANGE Q
"RTN","BIKEY1",91,0)
 ;
"RTN","BIKEY1",92,0)
 ;---> Allocate/Deallocate.
"RTN","BIKEY1",93,0)
 N BIERR
"RTN","BIKEY1",94,0)
 F I=1,2,3,4 D:$D(BIKEYS(I))
"RTN","BIKEY1",95,0)
 .D ALLOC(BIDUZ,I,BIALL,.BIERR)
"RTN","BIKEY1",96,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,,1) Q
"RTN","BIKEY1",97,0)
 ;
"RTN","BIKEY1",98,0)
 I '$G(BIERR) W !!?5,"Done." D DIRZ^BIUTL3()
"RTN","BIKEY1",99,0)
 Q
"RTN","BIKEY1",100,0)
 ;
"RTN","BIKEY1",101,0)
 ;
"RTN","BIKEY1",102,0)
 ;----------
"RTN","BIKEY1",103,0)
HELP1 ;EP
"RTN","BIKEY1",104,0)
 D TEXT4,DIRZ^BIUTL3()
"RTN","BIKEY1",105,0)
 D TITLE
"RTN","BIKEY1",106,0)
 W !!?5,"Select the Key(s) you wish to "
"RTN","BIKEY1",107,0)
 W:'BIALL "DE" W "ALLOCATE to ",BIHOLDER,":"
"RTN","BIKEY1",108,0)
 D @$S(BIALL:"TEXT1",1:"TEXT2"),TEXT3
"RTN","BIKEY1",109,0)
 Q
"RTN","BIKEY1",110,0)
 ;
"RTN","BIKEY1",111,0)
 ;
"RTN","BIKEY1",112,0)
 ;----------
"RTN","BIKEY1",113,0)
TEXT1 ;EP
"RTN","BIKEY1",114,0)
 ;;
"RTN","BIKEY1",115,0)
 ;;Enter the number of the Key you wish to allocate.  To select more
"RTN","BIKEY1",116,0)
 ;;than one key, enter the numbers separated by commas.  For example,
"RTN","BIKEY1",117,0)
 ;;entering 1,2 will select the first two Keys.
"RTN","BIKEY1",118,0)
 ;;
"RTN","BIKEY1",119,0)
 ;;(NOTE: If you select Key #3, BIZ MANAGER, then the Keys BIZMENU and
"RTN","BIKEY1",120,0)
 ;; BIZ EDIT PATIENTS will be allocated automatically.)
"RTN","BIKEY1",121,0)
 ;;
"RTN","BIKEY1",122,0)
 D PRINTX("TEXT1")
"RTN","BIKEY1",123,0)
 Q
"RTN","BIKEY1",124,0)
 ;
"RTN","BIKEY1",125,0)
 ;
"RTN","BIKEY1",126,0)
 ;----------
"RTN","BIKEY1",127,0)
TEXT2 ;EP
"RTN","BIKEY1",128,0)
 ;;
"RTN","BIKEY1",129,0)
 ;;Enter the number of the Key you wish to deallocate.  To select more
"RTN","BIKEY1",130,0)
 ;;than one key, enter the numbers separated by commas.  For example,
"RTN","BIKEY1",131,0)
 ;;entering 1,2 will select the first two Keys.
"RTN","BIKEY1",132,0)
 ;;
"RTN","BIKEY1",133,0)
 D PRINTX("TEXT2")
"RTN","BIKEY1",134,0)
 Q
"RTN","BIKEY1",135,0)
 ;
"RTN","BIKEY1",136,0)
 ;
"RTN","BIKEY1",137,0)
 ;----------
"RTN","BIKEY1",138,0)
TEXT3 ;EP
"RTN","BIKEY1",139,0)
 ;;
"RTN","BIKEY1",140,0)
 ;;1 - BIZMENU
"RTN","BIKEY1",141,0)
 ;;2 - BIZ EDIT PATIENTS
"RTN","BIKEY1",142,0)
 ;;3 - BIZ MANAGER
"RTN","BIKEY1",143,0)
 ;;4 - BIZ LOT ONLY
"RTN","BIKEY1",144,0)
 ;;
"RTN","BIKEY1",145,0)
 D PRINTX("TEXT3",10)
"RTN","BIKEY1",146,0)
 Q
"RTN","BIKEY1",147,0)
 ;
"RTN","BIKEY1",148,0)
 ;
"RTN","BIKEY1",149,0)
 ;----------
"RTN","BIKEY1",150,0)
TEXT4 ;EP
"RTN","BIKEY1",151,0)
 ;;
"RTN","BIKEY1",152,0)
 ;;  Enter 1 for BIZMENU, or 2 for BIZ EDIT PATIENTS, 3 for BIZ MANAGER
"RTN","BIKEY1",153,0)
 ;;  MANAGER, or 4 for BIZ LOT ONLY.
"RTN","BIKEY1",154,0)
 ;;  Or enter any combination of 1, 2 and 3 using commas.
"RTN","BIKEY1",155,0)
 ;;
"RTN","BIKEY1",156,0)
 ;;* For a more complete explanation of the Keys and the privileges
"RTN","BIKEY1",157,0)
 ;;  they confer, return to the first screen listing Holders of Keys
"RTN","BIKEY1",158,0)
 ;;  and choose the Action "H Help".
"RTN","BIKEY1",159,0)
 ;;
"RTN","BIKEY1",160,0)
 D PRINTX("TEXT4",8)
"RTN","BIKEY1",161,0)
 Q
"RTN","BIKEY1",162,0)
 ;
"RTN","BIKEY1",163,0)
 ;
"RTN","BIKEY1",164,0)
 ;----------
"RTN","BIKEY1",165,0)
ALLOC(BIDUZ,BIKEY,BIALL,BIERR) ;EP
"RTN","BIKEY1",166,0)
 ;---> Allocate BIZ Key to a Person.
"RTN","BIKEY1",167,0)
 ;---> Parameters:
"RTN","BIKEY1",168,0)
 ;     1 - BIDUZ  (req) Person's IEN in New Person File #200.
"RTN","BIKEY1",169,0)
 ;     2 - BIKEY  (req) Number of Key (1,2,or3).
"RTN","BIKEY1",170,0)
 ;     3 - BIALL  (req) 0=Deallocate, 1=Allocate.
"RTN","BIKEY1",171,0)
 ;     4 - BIERR  (ret) Text of any error returned.
"RTN","BIKEY1",172,0)
 ;
"RTN","BIKEY1",173,0)
 ;
"RTN","BIKEY1",174,0)
 I '$G(BIDUZ) S BIERR=106 Q
"RTN","BIKEY1",175,0)
 I '$D(^VA(200,BIDUZ,0)) S BIERR=112 Q
"RTN","BIKEY1",176,0)
 ;
"RTN","BIKEY1",177,0)
 ;---> Quit if Key not provided.
"RTN","BIKEY1",178,0)
 I '$G(BIKEY) S BIERR=635 Q
"RTN","BIKEY1",179,0)
 ;
"RTN","BIKEY1",180,0)
 N BIKEYNM
"RTN","BIKEY1",181,0)
 D
"RTN","BIKEY1",182,0)
 .I BIKEY=1 S BIKEYNM="BIZMENU" Q
"RTN","BIKEY1",183,0)
 .I BIKEY=2 S BIKEYNM="BIZ EDIT PATIENTS" Q
"RTN","BIKEY1",184,0)
 .I BIKEY=3 S BIKEYNM="BIZ MANAGER" Q
"RTN","BIKEY1",185,0)
 .I BIKEY=4 S BIKEYNM="BIZ LOT ONLY"
"RTN","BIKEY1",186,0)
 I $G(BIKEYNM)="" S BIERR=635 Q
"RTN","BIKEY1",187,0)
 ;
"RTN","BIKEY1",188,0)
 ;---> Set BIKIEN=Key IEN.
"RTN","BIKEY1",189,0)
 N BIKIEN S BIKIEN=$O(^DIC(19.1,"B",BIKEYNM,0))
"RTN","BIKEY1",190,0)
 ;---> Quit if Key does not exist.
"RTN","BIKEY1",191,0)
 I 'BIKIEN S BIERR=632 Q
"RTN","BIKEY1",192,0)
 ;---> Quit if there are duplicate keys.
"RTN","BIKEY1",193,0)
 I $O(^DIC(19.1,"B",BIKEY,BIKIEN)) S BIERR=633 Q
"RTN","BIKEY1",194,0)
 ;
"RTN","BIKEY1",195,0)
 ;---> Quit if BIALL not specified.
"RTN","BIKEY1",196,0)
 I ($G(BIALL)'=0)&($G(BIALL)'=1) S BIERR=634 Q
"RTN","BIKEY1",197,0)
 ;
"RTN","BIKEY1",198,0)
 ;---> Deallocate, quit.
"RTN","BIKEY1",199,0)
 I BIALL=0 D  Q
"RTN","BIKEY1",200,0)
 .N DIK,DA S DIK="^VA(200,"_BIDUZ_",51,",DA(1)=BIDUZ,DA=BIKIEN
"RTN","BIKEY1",201,0)
 .D ^DIK
"RTN","BIKEY1",202,0)
 ;
"RTN","BIKEY1",203,0)
 ;---> Allocate.
"RTN","BIKEY1",204,0)
 Q:$D(^XUSEC(BIKEYNM,BIDUZ))  ;already has new key
"RTN","BIKEY1",205,0)
 N DIC,DD,DO  K DO
"RTN","BIKEY1",206,0)
 S DIC(0)="NMQ",DIC("P")="200.051PA"
"RTN","BIKEY1",207,0)
 S DIC="^VA(200,"_BIDUZ_",51,",DA(1)=BIDUZ,X=BIKIEN,DINUM=X
"RTN","BIKEY1",208,0)
 D FILE^DICN
"RTN","BIKEY1",209,0)
 I Y<0 S BIERR=636
"RTN","BIKEY1",210,0)
 K DIC,DINUM,DA
"RTN","BIKEY1",211,0)
 Q
"RTN","BIKEY1",212,0)
 ;
"RTN","BIKEY1",213,0)
 ;
"RTN","BIKEY1",214,0)
 ;----------
"RTN","BIKEY1",215,0)
TITLE ;EP
"RTN","BIKEY1",216,0)
 ;---> Clear screen and write title.
"RTN","BIKEY1",217,0)
 D TITLE^BIUTL5("ALLOCATE/DEALLOCATE IMM KEYS")
"RTN","BIKEY1",218,0)
 Q
"RTN","BIKEY1",219,0)
 ;
"RTN","BIKEY1",220,0)
 ;
"RTN","BIKEY1",221,0)
 ;----------
"RTN","BIKEY1",222,0)
NOCHANGE ;EP
"RTN","BIKEY1",223,0)
 W !!?5,"NO changes made." D DIRZ^BIUTL3()
"RTN","BIKEY1",224,0)
 Q
"RTN","BIKEY1",225,0)
 ;
"RTN","BIKEY1",226,0)
 ;
"RTN","BIKEY1",227,0)
 ;----------
"RTN","BIKEY1",228,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIKEY1",229,0)
 Q:$G(BILINL)=""
"RTN","BIKEY1",230,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIKEY1",231,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIKEY1",232,0)
 Q
"RTN","BIKEY2")
0^41^B4203955
"RTN","BIKEY2",1,0)
BIKEY2 ;IHS/CMI/MWR - VIEW BIZ KEYS EXPLANATION.; MAY 10, 2010
"RTN","BIKEY2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIKEY2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIKEY2",4,0)
 ;;  VIEW IMMUNIZATION PACKAGE BIZ KEYS EXPLANATION IN LISTMAN.
"RTN","BIKEY2",5,0)
 ;
"RTN","BIKEY2",6,0)
 ;----------
"RTN","BIKEY2",7,0)
START ;EP
"RTN","BIKEY2",8,0)
 ;---> View explanation of Keys.
"RTN","BIKEY2",9,0)
 D SETVARS^BIUTL5 K ^TMP("BIKEY2",$J) N BITMP,DIR
"RTN","BIKEY2",10,0)
 D EN
"RTN","BIKEY2",11,0)
 D EXIT
"RTN","BIKEY2",12,0)
 Q
"RTN","BIKEY2",13,0)
 ;
"RTN","BIKEY2",14,0)
 ;
"RTN","BIKEY2",15,0)
 ;----------
"RTN","BIKEY2",16,0)
EN ;EP
"RTN","BIKEY2",17,0)
 D EN^VALM("BI KEYS EXPLANATION VIEW")
"RTN","BIKEY2",18,0)
 Q
"RTN","BIKEY2",19,0)
 ;
"RTN","BIKEY2",20,0)
 ;
"RTN","BIKEY2",21,0)
 ;----------
"RTN","BIKEY2",22,0)
HDR ;EP
"RTN","BIKEY2",23,0)
 ;---> Header code.
"RTN","BIKEY2",24,0)
 N BIDASH,BILINE,X,Y S BILINE=0
"RTN","BIKEY2",25,0)
 D WH^BIW(.BILINE)
"RTN","BIKEY2",26,0)
 S X="SECURITY KEYS FOR IMMUNIZATION, Version "_$$VER^BILOGO
"RTN","BIKEY2",27,0)
 S BIDASH=$L(X)+2
"RTN","BIKEY2",28,0)
 D CENTERT^BIUTL5(.X)
"RTN","BIKEY2",29,0)
 D WH^BIW(.BILINE,X)
"RTN","BIKEY2",30,0)
 Q
"RTN","BIKEY2",31,0)
 ;
"RTN","BIKEY2",32,0)
 ;
"RTN","BIKEY2",33,0)
 ;----------
"RTN","BIKEY2",34,0)
INIT ;EP
"RTN","BIKEY2",35,0)
 ;ZEXCEPT: VALM,VALMCNT,VALMSG
"RTN","BIKEY2",36,0)
 ;---> Initialize variables and list array.
"RTN","BIKEY2",37,0)
 S VALM("TITLE")=" (Immunization v"_$$VER^BILOGO_")"
"RTN","BIKEY2",38,0)
 ;
"RTN","BIKEY2",39,0)
 ;---> Gather text from ^BINFO( Word Processing global.
"RTN","BIKEY2",40,0)
 ;---> On VISTA, get it from the Dialog file entry 9200001
"RTN","BIKEY2",41,0)
 N BILINE,N
"RTN","BIKEY2",42,0)
 S BILINE=0,N=0
"RTN","BIKEY2",43,0)
 I $$RPMS^BIUTL9() F  S N=$O(^BINFO(2,1,N)) Q:'N  D
"RTN","BIKEY2",44,0)
 .D WL^BIW(.BILINE,"BIKEY2",$G(^BINFO(2,1,N,0)))
"RTN","BIKEY2",45,0)
 E  D
"RTN","BIKEY2",46,0)
 .N TXT
"RTN","BIKEY2",47,0)
 .D BLD^DIALOG(9200001,,,$NAME(TXT))
"RTN","BIKEY2",48,0)
 .F  S N=$O(TXT(N)) Q:'N  D WL^BIW(.BILINE,"BIKEY2",$G(TXT(N)))
"RTN","BIKEY2",49,0)
 S VALMCNT=BILINE
"RTN","BIKEY2",50,0)
 I VALMCNT>15 D
"RTN","BIKEY2",51,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIKEY2",52,0)
 Q
"RTN","BIKEY2",53,0)
 ;
"RTN","BIKEY2",54,0)
 ;
"RTN","BIKEY2",55,0)
 ;----------
"RTN","BIKEY2",56,0)
RESET ;EP
"RTN","BIKEY2",57,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIKEY2",58,0)
 ;ZEXCEPT: VALMBCK,VALMQUIT
"RTN","BIKEY2",59,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIKEY2",60,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIKEY2",61,0)
 D INIT,HDR Q
"RTN","BIKEY2",62,0)
 ;
"RTN","BIKEY2",63,0)
 ;
"RTN","BIKEY2",64,0)
 ;----------
"RTN","BIKEY2",65,0)
HELP ;EP
"RTN","BIKEY2",66,0)
 ;---> Help code.
"RTN","BIKEY2",67,0)
 W !!?5,"Use arrow keys to scroll up and down.  "
"RTN","BIKEY2",68,0)
 W "Enter ?? for more actions."
"RTN","BIKEY2",69,0)
 D DIRZ^BIUTL3()
"RTN","BIKEY2",70,0)
 Q
"RTN","BIKEY2",71,0)
 ;
"RTN","BIKEY2",72,0)
 ;
"RTN","BIKEY2",73,0)
 ;----------
"RTN","BIKEY2",74,0)
EXIT ;EP
"RTN","BIKEY2",75,0)
 ;---> EOJ cleanup.
"RTN","BIKEY2",76,0)
 K ^TMP("BIKEY2",$J)
"RTN","BIKEY2",77,0)
 D CLEAR^VALM1
"RTN","BIKEY2",78,0)
 D FULL^VALM1
"RTN","BIKEY2",79,0)
 Q
"RTN","BILETPR")
0^42^B37830369
"RTN","BILETPR",1,0)
BILETPR ;IHS/CMI/MWR - PRINT PATIENT LETTERS.; MAY 10, 2010
"RTN","BILETPR",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BILETPR",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR",4,0)
 ;;  PRINT PATIENT LETTERS.
"RTN","BILETPR",5,0)
 ;;  PATCH 5: Add call to log Notification by iCARE API.  PRINT+65
"RTN","BILETPR",6,0)
 ;
"RTN","BILETPR",7,0)
 ;
"RTN","BILETPR",8,0)
 ;----------
"RTN","BILETPR",9,0)
START ; EP
"RTN","BILETPR",10,0)
 ;---> Print letters for individual patients (loop).
"RTN","BILETPR",11,0)
 ;---> Allows selection of patient and letter.
"RTN","BILETPR",12,0)
 ;
"RTN","BILETPR",13,0)
 D SETVARS^BIUTL5 S (BIPOP1,BIPOP)=0
"RTN","BILETPR",14,0)
 N BILET,BITITLE
"RTN","BILETPR",15,0)
 F  S BIPOP=0 D  Q:BIPOP1
"RTN","BILETPR",16,0)
 .D PATIENT(.BIDFN,.BIPOP1) Q:BIPOP1
"RTN","BILETPR",17,0)
 .D ASKLET(.BILET,.BIDLOC,.BIPOP) Q:BIPOP
"RTN","BILETPR",18,0)
 .D DEVICE Q:BIPOP
"RTN","BILETPR",19,0)
 .D PRINT(BIDFN,BILET,$G(BIDLOC),ION)
"RTN","BILETPR",20,0)
 D ^%ZISC
"RTN","BILETPR",21,0)
 D EXIT
"RTN","BILETPR",22,0)
 Q
"RTN","BILETPR",23,0)
 ;
"RTN","BILETPR",24,0)
 ;
"RTN","BILETPR",25,0)
 ;----------
"RTN","BILETPR",26,0)
PATIENT(BIDFN,BIPOP) ;EP
"RTN","BILETPR",27,0)
 ;---> Select Patient.
"RTN","BILETPR",28,0)
 ;---> Parameters:
"RTN","BILETPR",29,0)
 ;     1 - BIDFN  (ret) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR",30,0)
 ;     2 - BIPOP  (ret) BIPOP=1 if selection failed.
"RTN","BILETPR",31,0)
 ;
"RTN","BILETPR",32,0)
 S BIPOP=0
"RTN","BILETPR",33,0)
 D TITLE^BIUTL5("PRINT INDIVIDUAL LETTERS")
"RTN","BILETPR",34,0)
 D PATLKUP^BIUTL8(.BIDFN)
"RTN","BILETPR",35,0)
 S:BIDFN<1 BIPOP=1
"RTN","BILETPR",36,0)
 Q
"RTN","BILETPR",37,0)
 ;
"RTN","BILETPR",38,0)
 ;
"RTN","BILETPR",39,0)
 ;----------
"RTN","BILETPR",40,0)
ASKLET(BILET,BIDLOC,BIPOP,BIDFLT) ;EP
"RTN","BILETPR",41,0)
 ;---> Select Form Letter.
"RTN","BILETPR",42,0)
 ;---> Parameters:
"RTN","BILETPR",43,0)
 ;     1 - BILET  (ret) IEN of Form Letter.
"RTN","BILETPR",44,0)
 ;     2 - BIDLOC (ret) Text of Date/Location line.
"RTN","BILETPR",45,0)
 ;     3 - BIPOP  (ret) BIPOP=1 if selection failed.
"RTN","BILETPR",46,0)
 ;     3 - BIDFLT (opt) IEN of default letter.
"RTN","BILETPR",47,0)
 ;
"RTN","BILETPR",48,0)
 N X,Y S BIPOP=0
"RTN","BILETPR",49,0)
 ;
"RTN","BILETPR",50,0)
 D
"RTN","BILETPR",51,0)
 .I $G(BIDFLT) I $D(^BILET(BIDFLT,0)) S BIDFLT=$P(^(0),U) Q
"RTN","BILETPR",52,0)
 .S BIDFLT=""
"RTN","BILETPR",53,0)
 ;
"RTN","BILETPR",54,0)
 ;---> Select Form Letter.
"RTN","BILETPR",55,0)
 W !!?3,"Please select the Form Letter you wish to use."
"RTN","BILETPR",56,0)
 W !?3,"Type ""?"" (no quotes) to see a list of available letters.",!!
"RTN","BILETPR",57,0)
 D DIC^BIFMAN(9002084.4,"QEMA",.Y,"   Select Form Letter: ",BIDFLT)
"RTN","BILETPR",58,0)
 I Y<1 S BIPOP=1 Q
"RTN","BILETPR",59,0)
 S BILET=+Y
"RTN","BILETPR",60,0)
 ;
"RTN","BILETPR",61,0)
 ;---> If this letter prints a Date/Location line, prompt for it.
"RTN","BILETPR",62,0)
 D ASKDLOC(BILET,.BIDLOC,.BIPOP)
"RTN","BILETPR",63,0)
 Q
"RTN","BILETPR",64,0)
 ;
"RTN","BILETPR",65,0)
 ;
"RTN","BILETPR",66,0)
 ;----------
"RTN","BILETPR",67,0)
ASKDLOC(BILET,BIDLOC,BIPOP) ;EP
"RTN","BILETPR",68,0)
 ;---> Ask for Date/Location line (up to 70 characters).
"RTN","BILETPR",69,0)
 ;---> Parameters:
"RTN","BILETPR",70,0)
 ;     1 - BILET  (req) IEN of Form Letter.
"RTN","BILETPR",71,0)
 ;     2 - BIDLOC (ret) Text of Date/Location line.
"RTN","BILETPR",72,0)
 ;     3 - BIPOP  (ret) BIPOP=1 if selection failed.
"RTN","BILETPR",73,0)
 ;
"RTN","BILETPR",74,0)
 Q:'$G(BILET)  Q:'$D(^BILET(BILET,0))
"RTN","BILETPR",75,0)
 ;---> Quit if this letter does not print a Date/Location line.
"RTN","BILETPR",76,0)
 Q:'$P(^BILET(BILET,0),U,4)
"RTN","BILETPR",77,0)
 D TITLE^BIUTL5("DATE/LOCATION LINE"),TEXT1
"RTN","BILETPR",78,0)
 N DIR,DIRUT S BIPOP=0
"RTN","BILETPR",79,0)
 S DIR("?")="     Enter the text of the Date/Location Line (up to 70 "
"RTN","BILETPR",80,0)
 S DIR("?")=DIR("?")_"characters long)"
"RTN","BILETPR",81,0)
 S DIR(0)="FA^1:70",DIR("A")="        "
"RTN","BILETPR",82,0)
 S:$D(^BIDLOC(DUZ,0)) DIR("B")=$P(^(0),U,2)
"RTN","BILETPR",83,0)
 D ^DIR
"RTN","BILETPR",84,0)
 I $D(DIRUT) S BIPOP=1 Q
"RTN","BILETPR",85,0)
 S BIDLOC=Y
"RTN","BILETPR",86,0)
 ;
"RTN","BILETPR",87,0)
 ;---> Now store user's Date-Loc Line.
"RTN","BILETPR",88,0)
 Q:BIDLOC=""
"RTN","BILETPR",89,0)
 Q:DUZ=0
"RTN","BILETPR",90,0)
 ;---> Clear any previous Date-Loc Line for this user.
"RTN","BILETPR",91,0)
 K ^BIDLOC(DUZ),^BIDLOC("B",DUZ)
"RTN","BILETPR",92,0)
 ;---> Store this Date-Loc Line for this user.
"RTN","BILETPR",93,0)
 S ^BIDLOC(DUZ,0)=DUZ_U_BIDLOC,^BIDLOC("B",DUZ,DUZ)=""
"RTN","BILETPR",94,0)
 Q
"RTN","BILETPR",95,0)
 ;
"RTN","BILETPR",96,0)
 ;
"RTN","BILETPR",97,0)
 ;----------
"RTN","BILETPR",98,0)
PRINT(BIDFN,BILET,BIDLOC,IOP,BIFDT,BIPOP) ;EP
"RTN","BILETPR",99,0)
 ;---> Print a letter for a  patient.
"RTN","BILETPR",100,0)
 ;---> Parameters:
"RTN","BILETPR",101,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR",102,0)
 ;     2 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR",103,0)
 ;     3 - BIDLOC (opt) Text of Date/Location line.
"RTN","BILETPR",104,0)
 ;     4 - IOP    (req) Output Device Name. (Will inhibit ^DIWF from
"RTN","BILETPR",105,0)
 ;                      prompting for Device. Should be equal to ION.)
"RTN","BILETPR",106,0)
 ;     5 - BIFDT  (opt) Forecast Date (=Today if not given).
"RTN","BILETPR",107,0)
 ;     6 - BIPOP  (ret) If BIPOP=1, output was to screen and user
"RTN","BILETPR",108,0)
 ;                      entered "^".
"RTN","BILETPR",109,0)
 ;
"RTN","BILETPR",110,0)
 ;---> CodeChange for v7.1 - IHS/CMI/MWR 12/01/2000:
"RTN","BILETPR",111,0)
 ;---> Next line, if IOP not passed, set to ION.
"RTN","BILETPR",112,0)
 ;S:'$D(IOP) IOP="HOME"
"RTN","BILETPR",113,0)
 S:'$D(IOP) IOP=$G(ION) S:IOP="" IOP="HOME"
"RTN","BILETPR",114,0)
 S BIPOP=0
"RTN","BILETPR",115,0)
 ;
"RTN","BILETPR",116,0)
 ;---> If this is not a printer, set BICRT=1
"RTN","BILETPR",117,0)
 N BICRT
"RTN","BILETPR",118,0)
 S BICRT=$S(($E(IOST)="C")!(IOST["BROWSER"):1,1:0)
"RTN","BILETPR",119,0)
 ;
"RTN","BILETPR",120,0)
 U IO
"RTN","BILETPR",121,0)
 N BIERR
"RTN","BILETPR",122,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) Q
"RTN","BILETPR",123,0)
 I '$D(^DPT(BIDFN,0)) D ERRCD^BIUTL2(203,,1) Q
"RTN","BILETPR",124,0)
 I '$G(BILET) D ERRCD^BIUTL2(609,,1) Q
"RTN","BILETPR",125,0)
 I '$D(^BILET(BILET,0)) D ERRCD^BIUTL2(610,,1) Q
"RTN","BILETPR",126,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BILETPR",127,0)
 ;
"RTN","BILETPR",128,0)
 ;
"RTN","BILETPR",129,0)
 ;---> Quit if Patient is locked.
"RTN","BILETPR",130,0)
 L +^BIP(BIDFN):1 I '$T U IO D  Q
"RTN","BILETPR",131,0)
 .W !!?5,"The selected Patient is being edited by another user."
"RTN","BILETPR",132,0)
 .W !?5,"Please try printing this letter later."
"RTN","BILETPR",133,0)
 .W:'BICRT @IOF D:BICRT DIRZ^BIUTL3()
"RTN","BILETPR",134,0)
 ;
"RTN","BILETPR",135,0)
 ;---> If patient is deceased, don't print letter; print explanation.
"RTN","BILETPR",136,0)
 I $$DECEASED^BIUTL1(BIDFN) D  Q
"RTN","BILETPR",137,0)
 .D DECEASED(BIDFN,BICRT),UNLOCK^BIPATUP(BIDFN)
"RTN","BILETPR",138,0)
 ;
"RTN","BILETPR",139,0)
 ;---> Build temporary global of populated letter in ^TMP("BILET",$J).
"RTN","BILETPR",140,0)
 D BUILD^BILETPR1(BIDFN,BILET,$G(BIDLOC),$G(BIFDT))
"RTN","BILETPR",141,0)
 ;
"RTN","BILETPR",142,0)
 ;---> Now print.
"RTN","BILETPR",143,0)
 ;---> Call homegrown letter printer.
"RTN","BILETPR",144,0)
 D PRINT^BILETPR4(BIDFN,IO,IOST,.BIERR)
"RTN","BILETPR",145,0)
 ;
"RTN","BILETPR",146,0)
 ;---> If error printing, display/write and quit.
"RTN","BILETPR",147,0)
 I $G(BIERR) D  Q
"RTN","BILETPR",148,0)
 .D ERRCD^BIUTL2(BIERR,,1),UNLOCK^BIPATUP(BIDFN),^%ZISC
"RTN","BILETPR",149,0)
 ;
"RTN","BILETPR",150,0)
 ;---> If this was to the screen, don't store "DATE OF LAST LETTER".
"RTN","BILETPR",151,0)
 D:BICRT
"RTN","BILETPR",152,0)
 .W !!?3,"NOTE: Because this letter was only displayed on a screen and"
"RTN","BILETPR",153,0)
 .W !?9,"not printed on a printer, it will NOT yet be logged by the"
"RTN","BILETPR",154,0)
 .W !?9,"program as having been printed and sent to the patient.",!
"RTN","BILETPR",155,0)
 .D DIRZ^BIUTL3(.BIPOP)
"RTN","BILETPR",156,0)
 ;
"RTN","BILETPR",157,0)
 ;---> Close Device.
"RTN","BILETPR",158,0)
 D ^%ZISC
"RTN","BILETPR",159,0)
 ;
"RTN","BILETPR",160,0)
 ;---> Store the date of this letter in the DATE OF LAST LETTER
"RTN","BILETPR",161,0)
 ;---> field of the BI PATIENT File.
"RTN","BILETPR",162,0)
 ;
"RTN","BILETPR",163,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BILETPR",164,0)
 ;---> Add call to log Notification by iCARE API.
"RTN","BILETPR",165,0)
 ;I 'BICRT,$D(^BIP(BIDFN,0)) D DIE^BIFMAN(9002084,".14////"_DT,BIDFN)
"RTN","BILETPR",166,0)
 I 'BICRT,$D(^BIP(BIDFN,0)) D
"RTN","BILETPR",167,0)
 .D DIE^BIFMAN(9002084,".14////"_DT,BIDFN)
"RTN","BILETPR",168,0)
 .I $T(LOG^BQINOTR)]"" D LOG^BQINOTR(BIDFN,"LETTER","",BILET,"","IMMUNIZATIONS","")
"RTN","BILETPR",169,0)
 ;**********
"RTN","BILETPR",170,0)
 ;
"RTN","BILETPR",171,0)
 D UNLOCK^BIPATUP(BIDFN)
"RTN","BILETPR",172,0)
 Q
"RTN","BILETPR",173,0)
 ;
"RTN","BILETPR",174,0)
 ;
"RTN","BILETPR",175,0)
 ;----------
"RTN","BILETPR",176,0)
DEVICE ;EP
"RTN","BILETPR",177,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BILETPR",178,0)
 K %ZIS,IOP
"RTN","BILETPR",179,0)
 S ZTRTN="PRINT^BILETPR(BIDFN,BILET,$G(BIDLOC),,$G(BIFDT))"
"RTN","BILETPR",180,0)
 D ZSAVES^BIUTL3
"RTN","BILETPR",181,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BILETPR",182,0)
 Q
"RTN","BILETPR",183,0)
 ;
"RTN","BILETPR",184,0)
 ;
"RTN","BILETPR",185,0)
 ;----------
"RTN","BILETPR",186,0)
DECEASED(BIDFN,BICRT) ;EP
"RTN","BILETPR",187,0)
 ;---> If the patient is deceased, display message.
"RTN","BILETPR",188,0)
 ;---> Parameters:
"RTN","BILETPR",189,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR",190,0)
 ;     2 - BICRT  (req) BICRT=1 if output is to screen or Browser.
"RTN","BILETPR",191,0)
 ;
"RTN","BILETPR",192,0)
 W !!?3,"NOTE: Because this patient"
"RTN","BILETPR",193,0)
 I $G(BIDFN) I $D(^DPT(BIDFN,0)) D
"RTN","BILETPR",194,0)
 .W ", ",$$NAME^BIUTL1(BIDFN)," #",$$HRCN^BIUTL1(BIDFN),","
"RTN","BILETPR",195,0)
 W " is now"
"RTN","BILETPR",196,0)
 W !?9,"registered as deceased, the letter will NOT be printed."
"RTN","BILETPR",197,0)
 W !?9,"This patient should be inactivated in the Immunization "
"RTN","BILETPR",198,0)
 W "Register."
"RTN","BILETPR",199,0)
 D:BICRT DIRZ^BIUTL3() W:'BICRT @IOF
"RTN","BILETPR",200,0)
 Q
"RTN","BILETPR",201,0)
 ;
"RTN","BILETPR",202,0)
 ;
"RTN","BILETPR",203,0)
 ;----------
"RTN","BILETPR",204,0)
EXIT ;EP
"RTN","BILETPR",205,0)
 D KILLALL^BIUTL8(1)
"RTN","BILETPR",206,0)
 Q
"RTN","BILETPR",207,0)
 ;
"RTN","BILETPR",208,0)
 ;
"RTN","BILETPR",209,0)
 ;----------
"RTN","BILETPR",210,0)
TEXT1 ;EP
"RTN","BILETPR",211,0)
 ;;The letter you have selected prints a Date/Location line between
"RTN","BILETPR",212,0)
 ;;between the Bottom Section and the Closing Section of the letter.
"RTN","BILETPR",213,0)
 ;;An example would be:
"RTN","BILETPR",214,0)
 ;;
"RTN","BILETPR",215,0)
 ;;   5-May-1998 at the Children's Clinic, Alaska Native Medical Center
"RTN","BILETPR",216,0)
 ;;
"RTN","BILETPR",217,0)
 ;;This line may be up to 70 characters long.
"RTN","BILETPR",218,0)
 ;;Please enter/edit the Date/Location line now.
"RTN","BILETPR",219,0)
 ;;
"RTN","BILETPR",220,0)
 ;;Line:
"RTN","BILETPR",221,0)
 ;;
"RTN","BILETPR",222,0)
 D PRINTX("TEXT1",5)
"RTN","BILETPR",223,0)
 Q
"RTN","BILETPR",224,0)
 ;
"RTN","BILETPR",225,0)
 ;
"RTN","BILETPR",226,0)
 ;----------
"RTN","BILETPR",227,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILETPR",228,0)
 N BITEXT,I,T,X S T="" F I=1:1:BITAB S T=T_" "
"RTN","BILETPR",229,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BILETPR",230,0)
 D EN^DDIOL(.BITEXT)
"RTN","BILETPR",231,0)
 Q
"RTN","BILETPR1")
0^43^B118603047
"RTN","BILETPR1",1,0)
BILETPR1 ;IHS/CMI/MWR - PRINT PATIENT LETTERS.; DEC 15, 2011
"RTN","BILETPR1",2,0)
 ;;8.5;IMMUNIZATION;**1**;JAN 03,2012;Build 2
"RTN","BILETPR1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR1",4,0)
 ;;  BUILD ^TMP WP ARRAY FOR PRINTING LETTERS.
"RTN","BILETPR1",5,0)
 ;   PATCH 1: Fix Date/Loc line.  DATELOC+2
"RTN","BILETPR1",6,0)
 ;
"RTN","BILETPR1",7,0)
 ;
"RTN","BILETPR1",8,0)
 ;----------
"RTN","BILETPR1",9,0)
BUILD(BIDFN,BILET,BIDLOC,BIFDT) ;EP
"RTN","BILETPR1",10,0)
 ;---> Build temporary global of populated letter in ^TMP("BILET",$J).
"RTN","BILETPR1",11,0)
 ;---> Parameters:
"RTN","BILETPR1",12,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",13,0)
 ;     2 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",14,0)
 ;     3 - BIDLOC (opt) Text of Date/Location line.
"RTN","BILETPR1",15,0)
 ;     4 - BIFDT  (opt) Forecast Date.
"RTN","BILETPR1",16,0)
 ;
"RTN","BILETPR1",17,0)
 K ^TMP("BILET",$J)
"RTN","BILETPR1",18,0)
 N BILINE,BI31 S BILINE=0,BI31=$C(31)_$C(31)
"RTN","BILETPR1",19,0)
 ;
"RTN","BILETPR1",20,0)
 ;---> Error check.
"RTN","BILETPR1",21,0)
 N BIERR S BIERR=""
"RTN","BILETPR1",22,0)
 D  I BIERR]"" D WRITE(.BILINE,BIERR) Q
"RTN","BILETPR1",23,0)
 .I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BILETPR1",24,0)
 .I '$D(^DPT(BIDFN,0)) D ERRCD^BIUTL2(203,.BIERR) Q
"RTN","BILETPR1",25,0)
 .I '$G(BILET) D ERRCD^BIUTL2(609,.BIERR) Q
"RTN","BILETPR1",26,0)
 .I '$D(^BILET(BILET,0)) D ERRCD^BIUTL2(610,.BIERR) Q
"RTN","BILETPR1",27,0)
 .S:'$G(BIFDT) BIFDT=DT
"RTN","BILETPR1",28,0)
 ;
"RTN","BILETPR1",29,0)
 ;---> Get forecast string (BIFORCST) and problem dose string (BIPDSS).
"RTN","BILETPR1",30,0)
 ;---> Pass BIPDSS to HISTORY to mark problem doses with asterisks.
"RTN","BILETPR1",31,0)
 ;---> Pass BIFORCST to FORECAST for display.
"RTN","BILETPR1",32,0)
 N BIFORCST,BIPDSS S BIPDSS=""
"RTN","BILETPR1",33,0)
 D IMMFORC^BIRPC(.BIFORCST,BIDFN,BIFDT,,$G(BIDUZ2),.BIPDSS)
"RTN","BILETPR1",34,0)
 ;---> If Forecast comes first, set BIFF=1
"RTN","BILETPR1",35,0)
 N BIFF S BIFF=$P(^BILET(BILET,0),U,6)
"RTN","BILETPR1",36,0)
 ;
"RTN","BILETPR1",37,0)
 ;---> Retrieve and store sections of letter in WP ^TMP global.
"RTN","BILETPR1",38,0)
 D SECTION(BILET,.BILINE,1)
"RTN","BILETPR1",39,0)
 D
"RTN","BILETPR1",40,0)
 .I BIFF D FORECAST(BILET,.BILINE,BIFORCST,BIFDT) Q
"RTN","BILETPR1",41,0)
 .D HISTORY(BILET,.BILINE,BIDFN,BIPDSS)
"RTN","BILETPR1",42,0)
 D SECTION(BILET,.BILINE,2)
"RTN","BILETPR1",43,0)
 D
"RTN","BILETPR1",44,0)
 .I BIFF D HISTORY(BILET,.BILINE,BIDFN,BIPDSS) Q
"RTN","BILETPR1",45,0)
 .D FORECAST(BILET,.BILINE,BIFORCST,BIFDT)
"RTN","BILETPR1",46,0)
 D SECTION(BILET,.BILINE,3)
"RTN","BILETPR1",47,0)
 D DATELOC(BILET,.BILINE,BIDLOC)
"RTN","BILETPR1",48,0)
 D SECTION(BILET,.BILINE,4)
"RTN","BILETPR1",49,0)
 Q
"RTN","BILETPR1",50,0)
 ;
"RTN","BILETPR1",51,0)
 ;
"RTN","BILETPR1",52,0)
 ;----------
"RTN","BILETPR1",53,0)
SECTION(BILET,BILINE,BISEC) ;EP
"RTN","BILETPR1",54,0)
 ;---> Store Section of letter in ^TMP("BILET",$J).
"RTN","BILETPR1",55,0)
 ;---> Parameters:
"RTN","BILETPR1",56,0)
 ;     1 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",57,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",58,0)
 ;     3 - BISEC  (req) Section of Form Letter to retrieve.
"RTN","BILETPR1",59,0)
 ;
"RTN","BILETPR1",60,0)
 N N S N=0
"RTN","BILETPR1",61,0)
 F  S N=$O(^BILET(BILET,BISEC,N)) Q:'N  D
"RTN","BILETPR1",62,0)
 .D WRITE(.BILINE,^BILET(BILET,BISEC,N,0))
"RTN","BILETPR1",63,0)
 Q
"RTN","BILETPR1",64,0)
 ;
"RTN","BILETPR1",65,0)
 ;
"RTN","BILETPR1",66,0)
 ;----------
"RTN","BILETPR1",67,0)
HISTORY(BILET,BILINE,BIDFN,BIPDSS) ;EP
"RTN","BILETPR1",68,0)
 ;---> Retrieve and store Imm History in WP ^TMP global.
"RTN","BILETPR1",69,0)
 ;---> Parameters:
"RTN","BILETPR1",70,0)
 ;     1 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",71,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",72,0)
 ;     3 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",73,0)
 ;     4 - BIPDSS (opt) Returned string of Visit IEN's that are
"RTN","BILETPR1",74,0)
 ;                        Problem Doses, according to ImmServe.
"RTN","BILETPR1",75,0)
 ;
"RTN","BILETPR1",76,0)
 ;---> Quit if this Form Letter does not included Imm History.
"RTN","BILETPR1",77,0)
 N BIFORM S BIFORM=$P(^BILET(BILET,0),U,2)
"RTN","BILETPR1",78,0)
 N BINVAL S BINVAL=+$P(^BILET(BILET,0),U,5)
"RTN","BILETPR1",79,0)
 Q:'BIFORM
"RTN","BILETPR1",80,0)
 ;
"RTN","BILETPR1",81,0)
 ;---> If History should be listed by Date, BIFORM=1 or 2;
"RTN","BILETPR1",82,0)
 ;---> If History should be listed by Vaccine, BIFORM=3 or 4.
"RTN","BILETPR1",83,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",84,0)
 D HISTORY1(.BILINE,BIDFN,BIFORM,BINVAL,"BILET",BIPDSS)
"RTN","BILETPR1",85,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",86,0)
 D CONTRAS(.BILINE,BIDFN,"BILET")
"RTN","BILETPR1",87,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",88,0)
 Q
"RTN","BILETPR1",89,0)
 ;
"RTN","BILETPR1",90,0)
 ;
"RTN","BILETPR1",91,0)
 ;----------
"RTN","BILETPR1",92,0)
HISTORY1(BILINE,BIDFN,BIFORM,BINVAL,BIGBL,BIPDSS,BIHDRS,BINOSK,BILOC,BIMMRF,BIMMLF) ;EP
"RTN","BILETPR1",93,0)
 ;---> Retrieve and store Imm History in WP ^TMP global.
"RTN","BILETPR1",94,0)
 ;---> Parameters:
"RTN","BILETPR1",95,0)
 ;     1 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",96,0)
 ;     2 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",97,0)
 ;     3 - BIFORM (opt) 1=List by Date (default), 2=by Date w/Lot#,
"RTN","BILETPR1",98,0)
 ;                      3=List by Vaccine, 4=by Vaccine w/Lot#,
"RTN","BILETPR1",99,0)
 ;                      5=by Date w/VFC, 6=by Vaccine w/VFC
"RTN","BILETPR1",100,0)
 ;                      7=by Date w/Lot & VFC, 8=by Vaccine w/Lot & VFC.
"RTN","BILETPR1",101,0)
 ;     4 - BINVAL (opt) 0=Include Invalid Doses, 1=Exclude Invalid Doses.
"RTN","BILETPR1",102,0)
 ;     5 - BIGBL  (opt) ^TMP global node to write to (def="BILET").
"RTN","BILETPR1",103,0)
 ;     6 - BIPDSS (opt) Returned string of Visit IEN's that are
"RTN","BILETPR1",104,0)
 ;                        Problem Doses, according to ImmServe.
"RTN","BILETPR1",105,0)
 ;     7 - BIHDRS (opt) 0=Print Imm and Skin Subheaders; 1=No Subeaders.
"RTN","BILETPR1",106,0)
 ;     8 - BINOSK (opt) 0=Include Skin Tests, 1=Do not include Skin Tests
"RTN","BILETPR1",107,0)
 ;                      2=Include Skin Tests ONLY (NO Immunizations).
"RTN","BILETPR1",108,0)
 ;     9 - BILOC  (opt) 1=Add Location in the form: [4-char] for BIFORM 1&2.
"RTN","BILETPR1",109,0)
 ;    10 - BIMMRF (opt) Imms Received Filter array (subscript=CVX's included).
"RTN","BILETPR1",110,0)
 ;    11 - BIMMLF (opt) Lot Number Filter array (subscript=lot number text).
"RTN","BILETPR1",111,0)
 ;
"RTN","BILETPR1",112,0)
 S:$G(BIGBL)="" BIGBL="BILET"
"RTN","BILETPR1",113,0)
 S:$G(BIFORM)="" BIFORM=1 S:$G(BINVAL)="" BINVAL=0
"RTN","BILETPR1",114,0)
 ;
"RTN","BILETPR1",115,0)
 ;---> RPC to gather Immunization History.
"RTN","BILETPR1",116,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BILETPR1",117,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BILETPR1",118,0)
 ;
"RTN","BILETPR1",119,0)
 N BIDE,BIRETVAL,BIRETERR,I S BIRETVAL=""
"RTN","BILETPR1",120,0)
 ;
"RTN","BILETPR1",121,0)
 ;---> Set BIDE local array for Data Elements to be returned.
"RTN","BILETPR1",122,0)
 ;---> The following are IEN's in ^BIEXPDD(.
"RTN","BILETPR1",123,0)
 ;---> IEN PC  DATA
"RTN","BILETPR1",124,0)
 ;---> --- --  ----
"RTN","BILETPR1",125,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR1",126,0)
 ;--->  4  2 = Vaccine Name, Short.
"RTN","BILETPR1",127,0)
 ;--->  8  3 = Vaccine Components.  ;v8.0
"RTN","BILETPR1",128,0)
 ;---> 24  4 = IEN, V File Visit.
"RTN","BILETPR1",129,0)
 ;---> 26  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR1",130,0)
 ;---> 27  6 = Vaccine Group (Series Type) for grouping of vaccines.
"RTN","BILETPR1",131,0)
 ;---> 33  7 = Vaccine Lot#, Text.
"RTN","BILETPR1",132,0)
 ;---> 38  8 = Skin Test Result.
"RTN","BILETPR1",133,0)
 ;---> 39  9 = Skin Test Reading.
"RTN","BILETPR1",134,0)
 ;---> 41 10 = Skin Test Name.
"RTN","BILETPR1",135,0)
 ;---> 44 11 = Reaction to Immunization, text.
"RTN","BILETPR1",136,0)
 ;---> 56 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR1",137,0)
 ;---> 65 13 = Dose Override.
"RTN","BILETPR1",138,0)
 ;---> 69 14 = Vaccine Component CVX Code.
"RTN","BILETPR1",139,0)
 ;---> 77 15 = VFC for this immunization.
"RTN","BILETPR1",140,0)
 ;
"RTN","BILETPR1",141,0)
 ;
"RTN","BILETPR1",142,0)
 F I=4,8,24,26,27,33,38,39,41,44,56,65,69,77 S BIDE(I)=""
"RTN","BILETPR1",143,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,1,0)
"RTN","BILETPR1",144,0)
 ;
"RTN","BILETPR1",145,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BILETPR1",146,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BILETPR1",147,0)
 I BIRETERR]"" D  Q
"RTN","BILETPR1",148,0)
 .D WRITE(.BILINE,"     "_BIRETERR,BIGBL)
"RTN","BILETPR1",149,0)
 .D WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",150,0)
 ;
"RTN","BILETPR1",151,0)
 ;---> Set BIHX=to a valid Immunization History for this patient.
"RTN","BILETPR1",152,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BILETPR1",153,0)
 ;
"RTN","BILETPR1",154,0)
 ;---> Build Listmanager array from BIHX string.
"RTN","BILETPR1",155,0)
 ;
"RTN","BILETPR1",156,0)
 ;---> List Immunization (and Skin Test)  History by Vaccine, and quit.
"RTN","BILETPR1",157,0)
 I (BIFORM=3)!(BIFORM=4) D HISTORY2^BILETPR3(.BILINE,BIHX,BIDFN,BIFORM,BINVAL,BIPDSS) Q
"RTN","BILETPR1",158,0)
 ;
"RTN","BILETPR1",159,0)
 D:$G(BINOSK)'=2 WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",160,0)
 ;
"RTN","BILETPR1",161,0)
 N BIAR,I,V,Y S V="|"
"RTN","BILETPR1",162,0)
 ;
"RTN","BILETPR1",163,0)
 ;---> List Immunization History by Date (if call is not for Skin Test ONLY).
"RTN","BILETPR1",164,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BILETPR1",165,0)
 I $G(BINOSK)'=2 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR1",166,0)
 .;---> Quit if this is not an Immunization.
"RTN","BILETPR1",167,0)
 .Q:$P(Y,V)'="I"
"RTN","BILETPR1",168,0)
 .;
"RTN","BILETPR1",169,0)
 .;---> Set BIPD=1 if Immserve has a problem with this dose.
"RTN","BILETPR1",170,0)
 .N BIPD S BIPD=$$PDSS^BIUTL8($P(Y,V,4),$P(Y,V,14),$G(BIPDSS))
"RTN","BILETPR1",171,0)
 .;
"RTN","BILETPR1",172,0)
 .;---> Quit if not displaying Invalid Doses (but will display a Forced Valid).
"RTN","BILETPR1",173,0)
 .;Q:((BINVAL=1)&(($P(Y,V,13)&($P(Y,V,13)'=9))!BIPD))
"RTN","BILETPR1",174,0)
 .;
"RTN","BILETPR1",175,0)
 .;---> Do not display if this vaccine is not in the display filter array.
"RTN","BILETPR1",176,0)
 .I $D(BIMMRF) Q:('$D(BIMMRF(+$P(Y,V,14))))
"RTN","BILETPR1",177,0)
 .;
"RTN","BILETPR1",178,0)
 .;---> Do not display if this lot number is not in the display filter array.
"RTN","BILETPR1",179,0)
 .I $D(BIMMLF) Q:('$D(BIMMLF(+$P(Y,V,7))))
"RTN","BILETPR1",180,0)
 .;
"RTN","BILETPR1",181,0)
 .;---> Set Vaccine Name.
"RTN","BILETPR1",182,0)
 .N X S X=$P(Y,V,2)
"RTN","BILETPR1",183,0)
 .;
"RTN","BILETPR1",184,0)
 .;---> Tack on Lot# if specified.
"RTN","BILETPR1",185,0)
 .N BILOT S BILOT=$P(Y,V,7)
"RTN","BILETPR1",186,0)
 .S:((BIFORM=2)&(BILOT]"")) X=X_" (#"_BILOT_")"
"RTN","BILETPR1",187,0)
 .;
"RTN","BILETPR1",188,0)
 .;---> Tack on VFC if specified.
"RTN","BILETPR1",189,0)
 .N BIVFC S BIVFC=$P(Y,V,15)
"RTN","BILETPR1",190,0)
 .S:((BIFORM=5)&(BIVFC>1)) X=X_" (VFC+)"
"RTN","BILETPR1",191,0)
 .;
"RTN","BILETPR1",192,0)
 .;---> Tack on Lot# & VFC if specified.
"RTN","BILETPR1",193,0)
 .I BIFORM=7 D
"RTN","BILETPR1",194,0)
 ..I (BILOT="")&(BIVFC<2) Q
"RTN","BILETPR1",195,0)
 ..S X=X_" ("
"RTN","BILETPR1",196,0)
 ..I BILOT]"" S X=X_"#"_BILOT
"RTN","BILETPR1",197,0)
 ..I (BILOT]"")&(BIVFC>1) S X=X_", "
"RTN","BILETPR1",198,0)
 ..I BIVFC>1 S X=X_"VFC+"
"RTN","BILETPR1",199,0)
 ..S X=X_")"
"RTN","BILETPR1",200,0)
 .;
"RTN","BILETPR1",201,0)
 .;---> Tack on Location if specified.
"RTN","BILETPR1",202,0)
 .S:$G(BILOC) X=X_" ["_$E($P(Y,V,5),1,4)_"]"
"RTN","BILETPR1",203,0)
 .;
"RTN","BILETPR1",204,0)
 .;---> If this Dose has a User Override or is an ImmServe Problem Dose,
"RTN","BILETPR1",205,0)
 .;---> prepend an asterisk and tack the reason on the end.
"RTN","BILETPR1",206,0)
 .D
"RTN","BILETPR1",207,0)
 ..I $P(Y,V,13) D  Q
"RTN","BILETPR1",208,0)
 ...;---> But don't display text "Force Valid" ($P(Y,V,13)'=9).
"RTN","BILETPR1",209,0)
 ...S X="*"_X
"RTN","BILETPR1",210,0)
 ...;---> Next line would display Invalid Reason.
"RTN","BILETPR1",211,0)
 ...;I $P(Y,V,13)'=9 S X=X_"-"_$$DOVER^BIUTL8($P(Y,V,13))_"-"
"RTN","BILETPR1",212,0)
 ..;
"RTN","BILETPR1",213,0)
 ..S:BIPD X="*"_X
"RTN","BILETPR1",214,0)
 ..;---> Next line would display Immserve problem.
"RTN","BILETPR1",215,0)
 ..;_"-INVALID--SEE IMMSERVE-"
"RTN","BILETPR1",216,0)
 .;
"RTN","BILETPR1",217,0)
 .;---> If there was a Reaction, tack it on.
"RTN","BILETPR1",218,0)
 .I $P(Y,V,11)]"" S X=X_" Reaction: "_$P(Y,V,11)
"RTN","BILETPR1",219,0)
 .;
"RTN","BILETPR1",220,0)
 .;---> Set this Immunization in the array:
"RTN","BILETPR1",221,0)
 .;---> BIAR(VisitDate,VaccineName,VisitIEN)=VaccineName (Lot#)--Problem Dose
"RTN","BILETPR1",222,0)
 .S BIAR($P(Y,V,12),$P(Y,V,2),$P(Y,V,4))=X
"RTN","BILETPR1",223,0)
 ;
"RTN","BILETPR1",224,0)
 ;---> Build Imm History lines for History Section of Form Letter.
"RTN","BILETPR1",225,0)
 N N S N=0
"RTN","BILETPR1",226,0)
 F  S N=$O(BIAR(N)) Q:'N  D
"RTN","BILETPR1",227,0)
 .N BIHXLN
"RTN","BILETPR1",228,0)
 .S BIHXLN=$$SLDT2^BIUTL5(N,1)_": "
"RTN","BILETPR1",229,0)
 .N I,M S M=0
"RTN","BILETPR1",230,0)
 .;---> Note: I and J below are counters for inserting ", ".
"RTN","BILETPR1",231,0)
 .;---> In v8.1 come back here and allow for extremely long immunizations
"RTN","BILETPR1",232,0)
 .;---> that have Combo name + Lot# + Invalid text + reaction text.
"RTN","BILETPR1",233,0)
 .F I=1:1 S M=$O(BIAR(N,M)) Q:M=""  D
"RTN","BILETPR1",234,0)
 ..N J,P S P=0
"RTN","BILETPR1",235,0)
 ..F J=1:1 S P=$O(BIAR(N,M,P)) Q:'P  D
"RTN","BILETPR1",236,0)
 ...N X S X=BIAR(N,M,P)
"RTN","BILETPR1",237,0)
 ...;---> If this line will be too long, write it and start a new line.
"RTN","BILETPR1",238,0)
 ...I $L(BIHXLN_X)>70 D  Q
"RTN","BILETPR1",239,0)
 ....D WRITE(.BILINE,"     "_BIHXLN_",",BIGBL)
"RTN","BILETPR1",240,0)
 ....S BIHXLN="          "_X
"RTN","BILETPR1",241,0)
 ...S BIHXLN=BIHXLN_$S((I>1!(J>1)):", ",1:"")_X
"RTN","BILETPR1",242,0)
 .D:$O(BIAR(0)) WRITE(.BILINE,"     "_BIHXLN,BIGBL)
"RTN","BILETPR1",243,0)
 ;
"RTN","BILETPR1",244,0)
 ;---> If there are no previous immunizations and this call is NOT for
"RTN","BILETPR1",245,0)
 ;---> Skin Tests ONLY, then store next line.
"RTN","BILETPR1",246,0)
 I '$O(BIAR(0)),$G(BINOSK)'=2 D
"RTN","BILETPR1",247,0)
 .D WRITE(.BILINE,"        No previous immunizations recorded.",BIGBL)
"RTN","BILETPR1",248,0)
 .;D WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",249,0)
 ;
"RTN","BILETPR1",250,0)
 ;---> Quit if NOT including Skin Tests.
"RTN","BILETPR1",251,0)
 Q:($G(BINOSK))=1
"RTN","BILETPR1",252,0)
 ;
"RTN","BILETPR1",253,0)
 ;---> SKIN TESTS
"RTN","BILETPR1",254,0)
 ;---> PC  DATA
"RTN","BILETPR1",255,0)
 ;---> --  ----
"RTN","BILETPR1",256,0)
 ;--->  1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR1",257,0)
 ;--->  4 = V Skin Test File IEN.
"RTN","BILETPR1",258,0)
 ;--->  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR1",259,0)
 ;--->  8 = Skin Test Result.
"RTN","BILETPR1",260,0)
 ;--->  9 = Skin Test Reading.
"RTN","BILETPR1",261,0)
 ;---> 10 = Skin Test Name.
"RTN","BILETPR1",262,0)
 ;---> 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR1",263,0)
 ;
"RTN","BILETPR1",264,0)
 ;---> List Skin Test History by Date.
"RTN","BILETPR1",265,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BILETPR1",266,0)
 K BIAR
"RTN","BILETPR1",267,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR1",268,0)
 .;---> Quit if this is not a Skin Test.
"RTN","BILETPR1",269,0)
 .Q:$P(Y,V)'="S"
"RTN","BILETPR1",270,0)
 .;---> Set display line for this Skin Test Name and Date.
"RTN","BILETPR1",271,0)
 .S X=$P(Y,V,10),X=$$PAD^BIUTL5(X,12)
"RTN","BILETPR1",272,0)
 .;
"RTN","BILETPR1",273,0)
 .D
"RTN","BILETPR1",274,0)
 ..I $P(Y,V,8)]"" S X=X_$P(Y,V,8) Q
"RTN","BILETPR1",275,0)
 ..I $P(Y,V,9) S X=X_$P(Y,V,9)_" mm" Q
"RTN","BILETPR1",276,0)
 ..S X=X_"Not recorded"
"RTN","BILETPR1",277,0)
 .;
"RTN","BILETPR1",278,0)
 .;---> Set this Skin Test in the array:
"RTN","BILETPR1",279,0)
 .;---> BIAR(VisitDate,SkinTestName,VisitIEN)=Skin Test display line.
"RTN","BILETPR1",280,0)
 .S BIAR($P(Y,V,12),$P(Y,V,10),$P(Y,V,4))=X
"RTN","BILETPR1",281,0)
 ;
"RTN","BILETPR1",282,0)
 Q:'$D(BIAR)
"RTN","BILETPR1",283,0)
 ;---> Skin Test Header.
"RTN","BILETPR1",284,0)
 D:$G(BINOSK)'=2 WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",285,0)
 D:'$G(BIHDRS)
"RTN","BILETPR1",286,0)
 .S X="               Skin Tests:"
"RTN","BILETPR1",287,0)
 .D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",288,0)
 .S X="               -----------------------"
"RTN","BILETPR1",289,0)
 .D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",290,0)
 ;
"RTN","BILETPR1",291,0)
 ;---> Build Skin Test History lines for History Section of Form Letter.
"RTN","BILETPR1",292,0)
 N N S N=0
"RTN","BILETPR1",293,0)
 F  S N=$O(BIAR(N)) Q:'N  D
"RTN","BILETPR1",294,0)
 .N BIDT
"RTN","BILETPR1",295,0)
 .S BIDT=$$SLDT2^BIUTL5(N,1)
"RTN","BILETPR1",296,0)
 .N I,M S M=0
"RTN","BILETPR1",297,0)
 .F I=1:1 S M=$O(BIAR(N,M)) Q:M=""  D
"RTN","BILETPR1",298,0)
 ..N P S P=0
"RTN","BILETPR1",299,0)
 ..F  S P=$O(BIAR(N,M,P)) Q:'P  D
"RTN","BILETPR1",300,0)
 ...N X S X=BIAR(N,M,P)
"RTN","BILETPR1",301,0)
 ...S X="     "_$S(I=1:BIDT_": ",1:"          ")_X
"RTN","BILETPR1",302,0)
 ...D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",303,0)
 ;
"RTN","BILETPR1",304,0)
 Q
"RTN","BILETPR1",305,0)
 ;
"RTN","BILETPR1",306,0)
 ;
"RTN","BILETPR1",307,0)
 ;----------
"RTN","BILETPR1",308,0)
CONTRAS(BILINE,BIDFN,BIGBL) ;EP
"RTN","BILETPR1",309,0)
 ;---> Retrieve and store Contraindications in WP ^TMP global.
"RTN","BILETPR1",310,0)
 ;---> Parameters:
"RTN","BILETPR1",311,0)
 ;     1 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",312,0)
 ;     2 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",313,0)
 ;     3 - BIGBL  (opt) ^TMP global node to write to (def="BILET").
"RTN","BILETPR1",314,0)
 ;
"RTN","BILETPR1",315,0)
 S:$G(BIGBL)="" BIGBL="BILET"
"RTN","BILETPR1",316,0)
 N BIRETVAL,BIRETERR,I S BIRETVAL=""
"RTN","BILETPR1",317,0)
 ;
"RTN","BILETPR1",318,0)
 ;---> RPC to retrieve Contraindications.
"RTN","BILETPR1",319,0)
 D CONTRAS^BIRPC5(.BIRETVAL,BIDFN)
"RTN","BILETPR1",320,0)
 ;
"RTN","BILETPR1",321,0)
 ;---> If BIRETERR has a value, display it and quit.
"RTN","BILETPR1",322,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BILETPR1",323,0)
 I BIRETERR]"" D  Q
"RTN","BILETPR1",324,0)
 .D WRITE(.BILINE,"     "_BIRETERR,BIGBL)
"RTN","BILETPR1",325,0)
 .D WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",326,0)
 ;
"RTN","BILETPR1",327,0)
 ;---> Set BICONT=to a string of Contraindications for this patient.
"RTN","BILETPR1",328,0)
 N BICONT S BICONT=$P(BIRETVAL,BI31,1)
"RTN","BILETPR1",329,0)
 Q:BICONT=""
"RTN","BILETPR1",330,0)
 ;
"RTN","BILETPR1",331,0)
 ;---> Build Listmanager array from BICONT string.
"RTN","BILETPR1",332,0)
 ;
"RTN","BILETPR1",333,0)
 N J S J=1
"RTN","BILETPR1",334,0)
 F I=1:1 S Y=$P(BICONT,U,I) Q:Y=""  D
"RTN","BILETPR1",335,0)
 .;---> Build display line for this Contraindication.
"RTN","BILETPR1",336,0)
 .N V S V="|",X="     "
"RTN","BILETPR1",337,0)
 .S:J X=X_"* Contraindications:",J=0 S X=$$PAD^BIUTL5(X,28)
"RTN","BILETPR1",338,0)
 .;
"RTN","BILETPR1",339,0)
 .;---> Display "Vaccine:  Date  Reason"
"RTN","BILETPR1",340,0)
 .;---> Quit if Reason is a "Refusal."  Also, if it's the first line of Contras
"RTN","BILETPR1",341,0)
 .;---> reset J so that "Contraindications:" header displays on the next one.
"RTN","BILETPR1",342,0)
 .I Y["Refusal" D  Q
"RTN","BILETPR1",343,0)
 ..I I=1 S J=1
"RTN","BILETPR1",344,0)
 .S X=X_$P(Y,V,2)_":",X=$$PAD^BIUTL5(X,40)_$P(Y,V,4)
"RTN","BILETPR1",345,0)
 .S X=$$PAD^BIUTL5(X,53)_$P(Y,V,3)
"RTN","BILETPR1",346,0)
 .;---> Set formatted Contraindication line and index in ^TMP.
"RTN","BILETPR1",347,0)
 .D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",348,0)
 Q
"RTN","BILETPR1",349,0)
 ;
"RTN","BILETPR1",350,0)
 ;
"RTN","BILETPR1",351,0)
 ;----------
"RTN","BILETPR1",352,0)
FORECAST(BILET,BILINE,BIFORCST,BIFDT) ;EP
"RTN","BILETPR1",353,0)
 ;---> Calculate and store Forecast in WP ^TMP global.
"RTN","BILETPR1",354,0)
 ;---> Parameters:
"RTN","BILETPR1",355,0)
 ;     1 - BILET    (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",356,0)
 ;     2 - BILINE   (ret) Last line written into ^TMP array.
"RTN","BILETPR1",357,0)
 ;     3 - BIFORCST (req) Raw forecast string back from call to IMMFORC^BIRPC.
"RTN","BILETPR1",358,0)
 ;     4 - BIFDT    (opt) Forecast Date.
"RTN","BILETPR1",359,0)
 ;
"RTN","BILETPR1",360,0)
 ;---> Quit if this Form Letter does not included a Forecast.
"RTN","BILETPR1",361,0)
 Q:'$P(^BILET(BILET,0),U,3)
"RTN","BILETPR1",362,0)
 ;
"RTN","BILETPR1",363,0)
 ;---> If Forecast Date not provided, set it equal to today.
"RTN","BILETPR1",364,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BILETPR1",365,0)
 ;
"RTN","BILETPR1",366,0)
 ;---> RPC to gather Immunization History.
"RTN","BILETPR1",367,0)
 ;     BIFORCST - Return value of valid data from RPC.
"RTN","BILETPR1",368,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BILETPR1",369,0)
 ;
"RTN","BILETPR1",370,0)
 N BIRETERR S BIRETVAL=""
"RTN","BILETPR1",371,0)
 ;
"RTN","BILETPR1",372,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BILETPR1",373,0)
 S BIRETERR=$P(BIFORCST,BI31,2)
"RTN","BILETPR1",374,0)
 I BIRETERR]"" D  Q
"RTN","BILETPR1",375,0)
 .D WRITE(.BILINE),WRITE(.BILINE,"     "_BIRETERR),WRITE(.BILINE)
"RTN","BILETPR1",376,0)
 ;
"RTN","BILETPR1",377,0)
 ;---> Set BIFORC=to the Immunization Forecast for this patient.
"RTN","BILETPR1",378,0)
 N BIFORC,I,V S V="|",BIFORC=$P(BIFORCST,BI31,1)
"RTN","BILETPR1",379,0)
 ;
"RTN","BILETPR1",380,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",381,0)
 ;
"RTN","BILETPR1",382,0)
 ;---> If Forecast Date is not Today, display Forecast Date in letter.
"RTN","BILETPR1",383,0)
 D:BIFDT'=DT
"RTN","BILETPR1",384,0)
 .;---> Set Forecast Date external form for letter text.
"RTN","BILETPR1",385,0)
 .N BIFDT1 S BIFDT1=$$TXDT1^BIUTL5(BIFDT)
"RTN","BILETPR1",386,0)
 .D WRITE(.BILINE,"        For "_BIFDT1_":")
"RTN","BILETPR1",387,0)
 ;
"RTN","BILETPR1",388,0)
 ;---> Loop through "^"-pieces of Imm Forecast, getting data.
"RTN","BILETPR1",389,0)
 F I=1:1 S Y=$P(BIFORC,U,I) Q:Y=""  D
"RTN","BILETPR1",390,0)
 .;
"RTN","BILETPR1",391,0)
 .;---> CodeChange for v7.1 - IHS/CMI/MWR 12/01/2000:
"RTN","BILETPR1",392,0)
 .;---> Remove Dose#.
"RTN","BILETPR1",393,0)
 .;S Y=$P(Y,V) S:((Y["-")&(Y'["Td")) Y=$P(Y,"-",2)
"RTN","BILETPR1",394,0)
 .S Y=$P(Y,V) I +Y&($E(Y,2)="-") S Y=$E(Y,3,99)
"RTN","BILETPR1",395,0)
 .;
"RTN","BILETPR1",396,0)
 .D WRITE(.BILINE,"        "_$$STRIP^BIUTL5(.Y))
"RTN","BILETPR1",397,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",398,0)
 Q
"RTN","BILETPR1",399,0)
 ;
"RTN","BILETPR1",400,0)
 ;
"RTN","BILETPR1",401,0)
 ;----------
"RTN","BILETPR1",402,0)
DATELOC(BILET,BILINE,BIDLOC) ;EP
"RTN","BILETPR1",403,0)
 ;
"RTN","BILETPR1",404,0)
 ;********** PATCH 1, v8.5, JAN 03,2012, IHS/CMI/MWR
"RTN","BILETPR1",405,0)
 ;---> Include "." in front of BILINE to receive new value from call.
"RTN","BILETPR1",406,0)
 ;D DATELOC^BILETPR2(BILET,BILINE,BIDLOC)
"RTN","BILETPR1",407,0)
 D DATELOC^BILETPR2(BILET,.BILINE,BIDLOC)
"RTN","BILETPR1",408,0)
 ;**********
"RTN","BILETPR1",409,0)
 Q
"RTN","BILETPR1",410,0)
 ;
"RTN","BILETPR1",411,0)
 ;
"RTN","BILETPR1",412,0)
 ;----------
"RTN","BILETPR1",413,0)
WRITE(BILINE,BIVAL,BIGBL) ;EP
"RTN","BILETPR1",414,0)
 ;---> Write a line to the ^TMP global for WP or Listman.
"RTN","BILETPR1",415,0)
 ;---> NOTE: DUPLICATE CODE IN ^BILETPR3 FOR SPEED.
"RTN","BILETPR1",416,0)
 ;---> Parameters:
"RTN","BILETPR1",417,0)
 ;     1 - BILINE (ret) Last line# in the WP ^TMP global.
"RTN","BILETPR1",418,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BILETPR1",419,0)
 ;     3 - BIGBL  (opt) ^TMP global node to write to (def="BILET").
"RTN","BILETPR1",420,0)
 ;
"RTN","BILETPR1",421,0)
 Q:'$D(BILINE)
"RTN","BILETPR1",422,0)
 S:$G(BIGBL)="" BIGBL="BILET"
"RTN","BILETPR1",423,0)
 D WL^BIW(.BILINE,BIGBL,$G(BIVAL))
"RTN","BILETPR1",424,0)
 Q
"RTN","BILETPR2")
0^44^B5971720
"RTN","BILETPR2",1,0)
BILETPR2 ;IHS/CMI/MWR - PRINT PATIENT LETTERS; MAY 10, 2010
"RTN","BILETPR2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BILETPR2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR2",4,0)
 ;;  PRINT PATIENT LETTERS.
"RTN","BILETPR2",5,0)
 ;
"RTN","BILETPR2",6,0)
 ;
"RTN","BILETPR2",7,0)
 ;----------
"RTN","BILETPR2",8,0)
INDIVLET(BIDFN,BIRTN) ;EP
"RTN","BILETPR2",9,0)
 ;---> Select and Print a letter for an individual patient.
"RTN","BILETPR2",10,0)
 ;---> Steps:
"RTN","BILETPR2",11,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETPR2",12,0)
 ;               BI LETTER PRINT INDIVDUAL, an action on the
"RTN","BILETPR2",13,0)
 ;               Listmanager menu protocol: BI MENU PATIENT VIEW.
"RTN","BILETPR2",14,0)
 ;
"RTN","BILETPR2",15,0)
 ;---> Parameters:
"RTN","BILETPR2",16,0)
 ;     1 - BIDFN (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR2",17,0)
 ;     2 - BIRTN (opt) Calling routine for reset.
"RTN","BILETPR2",18,0)
 ;
"RTN","BILETPR2",19,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) S VALMBCK="R" Q
"RTN","BILETPR2",20,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BILETPR2",21,0)
 ;
"RTN","BILETPR2",22,0)
 D
"RTN","BILETPR2",23,0)
 .D FULL^VALM1 S BIPOP=0
"RTN","BILETPR2",24,0)
 .D TITLE^BIUTL5("LETTER SELECTION")
"RTN","BILETPR2",25,0)
 .D ASKLET^BILETPR(.BILET,.BIDLOC,.BIPOP) Q:BIPOP
"RTN","BILETPR2",26,0)
 .D DEVICE^BILETPR Q:BIPOP
"RTN","BILETPR2",27,0)
 .D PRINT^BILETPR(BIDFN,BILET,$G(BIDLOC),ION,BIFDT)
"RTN","BILETPR2",28,0)
 .D ^%ZISC
"RTN","BILETPR2",29,0)
 ;
"RTN","BILETPR2",30,0)
 Q:$G(BIRTN)=""
"RTN","BILETPR2",31,0)
 S VALMBCK="R"
"RTN","BILETPR2",32,0)
 D @("RESET^"_BIRTN)
"RTN","BILETPR2",33,0)
 Q
"RTN","BILETPR2",34,0)
 ;
"RTN","BILETPR2",35,0)
 ;
"RTN","BILETPR2",36,0)
 ;----------
"RTN","BILETPR2",37,0)
PATLETS ;EP
"RTN","BILETPR2",38,0)
 ;---> Lookup patients, select and print letters.
"RTN","BILETPR2",39,0)
 ;
"RTN","BILETPR2",40,0)
 D SETVARS^BIUTL5 N BIDFN,BIFDT
"RTN","BILETPR2",41,0)
 F  D  Q:$G(BIDFN)<1
"RTN","BILETPR2",42,0)
 .D TITLE^BIUTL5("PRINT INDIVIDUAL PATIENT LETTERS")
"RTN","BILETPR2",43,0)
 .D PATLKUP^BIUTL8(.BIDFN)
"RTN","BILETPR2",44,0)
 .Q:$G(BIDFN)<1
"RTN","BILETPR2",45,0)
 .D INDIVLET(BIDFN)
"RTN","BILETPR2",46,0)
 .D UNLOCK^BIPATVW($G(BIDFN))
"RTN","BILETPR2",47,0)
 Q
"RTN","BILETPR2",48,0)
 ;
"RTN","BILETPR2",49,0)
 ;
"RTN","BILETPR2",50,0)
 ;----------
"RTN","BILETPR2",51,0)
OFFICIAL(BIDFN,BIRTN) ;EP
"RTN","BILETPR2",52,0)
 ;---> Print Official Immunization Record for a patient.
"RTN","BILETPR2",53,0)
 ;---> Steps:
"RTN","BILETPR2",54,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETPR2",55,0)
 ;               BI LETTER PRINT INDIVDUAL, an action on the
"RTN","BILETPR2",56,0)
 ;               Listmanager menu protocol: BI MENU PATIENT VIEW.
"RTN","BILETPR2",57,0)
 ;
"RTN","BILETPR2",58,0)
 ;---> Parameters:
"RTN","BILETPR2",59,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR2",60,0)
 ;     2 - BIRTN  (opt) Calling routine for reset.
"RTN","BILETPR2",61,0)
 ;
"RTN","BILETPR2",62,0)
 ;---> Required Variable:
"RTN","BILETPR2",63,0)
 ;     1 - DUZ(2) (req) User's Site IEN.
"RTN","BILETPR2",64,0)
 ;
"RTN","BILETPR2",65,0)
 D
"RTN","BILETPR2",66,0)
 .D FULL^VALM1 S BIPOP=0
"RTN","BILETPR2",67,0)
 .I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) Q
"RTN","BILETPR2",68,0)
 .N BILET S BILET=$$DEFLET^BIUTL2(DUZ(2),,1)
"RTN","BILETPR2",69,0)
 .I 'BILET D ERRCD^BIUTL2(113,,1) Q
"RTN","BILETPR2",70,0)
 .I '$D(^BILET(BILET,0)) D  Q
"RTN","BILETPR2",71,0)
 ..N DA,DIE S DIE="^BISITE(",DA=DUZ(2),DR=".13////@" D ^DIE
"RTN","BILETPR2",72,0)
 ..D ERRCD^BIUTL2(114,,1)
"RTN","BILETPR2",73,0)
 .;
"RTN","BILETPR2",74,0)
 .D DEVICE^BILETPR Q:BIPOP
"RTN","BILETPR2",75,0)
 .D PRINT^BILETPR(BIDFN,BILET,,ION,$G(DT))
"RTN","BILETPR2",76,0)
 .D ^%ZISC
"RTN","BILETPR2",77,0)
 ;
"RTN","BILETPR2",78,0)
 I $G(BIRTN)]"" S VALMBCK="R" D @("RESET^"_BIRTN)
"RTN","BILETPR2",79,0)
 Q
"RTN","BILETPR2",80,0)
 ;
"RTN","BILETPR2",81,0)
 ;
"RTN","BILETPR2",82,0)
 ;----------
"RTN","BILETPR2",83,0)
DATELOC(BILET,BILINE,BIDLOC) ;EP
"RTN","BILETPR2",84,0)
 ;---> Store Date/Location line in WP ^TMP global.
"RTN","BILETPR2",85,0)
 ;---> Parameters:
"RTN","BILETPR2",86,0)
 ;     1 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR2",87,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR2",88,0)
 ;     3 - BIDLOC (req) Text of Date/Location line.
"RTN","BILETPR2",89,0)
 ;
"RTN","BILETPR2",90,0)
 ;---> Quit if this Form Letter does not included a Date/Loc line.
"RTN","BILETPR2",91,0)
 Q:'$P(^BILET(BILET,0),U,4)
"RTN","BILETPR2",92,0)
 S:$G(BIDLOC)="" BIDLOC="     Date/Location line not provided."
"RTN","BILETPR2",93,0)
 D WRITE^BILETPR1(.BILINE),WRITE^BILETPR1(.BILINE,"     "_BIDLOC),WRITE^BILETPR1(.BILINE)
"RTN","BILETPR2",94,0)
 Q
"RTN","BILETPR3")
0^45^B22264364
"RTN","BILETPR3",1,0)
BILETPR3 ;IHS/CMI/MWR - PRINT PATIENT LETTERS.; MAY 10, 2010
"RTN","BILETPR3",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BILETPR3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR3",4,0)
 ;;  BUILD ^TMP WP ARRAY FOR PRINTING LETTERS.
"RTN","BILETPR3",5,0)
 ;
"RTN","BILETPR3",6,0)
 ;
"RTN","BILETPR3",7,0)
 ;----------
"RTN","BILETPR3",8,0)
HISTORY2(BILINE,BIHX,BIDFN,BIFORM,BINVAL,BIPDSS) ;EP
"RTN","BILETPR3",9,0)
 ;---> Set Immunization History in Listman Letter array, sorted
"RTN","BILETPR3",10,0)
 ;---> by Vaccine.
"RTN","BILETPR3",11,0)
 ;---> Parameters:
"RTN","BILETPR3",12,0)
 ;     1 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR3",13,0)
 ;     2 - BIHX   (req) Patient's Immunization History (string).
"RTN","BILETPR3",14,0)
 ;     3 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR3",15,0)
 ;     4 - BIFORM (opt) 3=List by Vaccine, 4=Vaccine w/Lot#.
"RTN","BILETPR3",16,0)
 ;     5 - BINVAL (opt) 0=Include Invalid Doses, 1=Exclude Invalid Doses.
"RTN","BILETPR3",17,0)
 ;     6 - BIPDSS (opt) Returned string of Visit IEN's that are
"RTN","BILETPR3",18,0)
 ;                        Problem Doses, according to ImmServe.
"RTN","BILETPR3",19,0)
 ;
"RTN","BILETPR3",20,0)
 S:'$G(BIFORM) BIFORM=3
"RTN","BILETPR3",21,0)
 N I,V,X,Y,Z S V="|",Z=""
"RTN","BILETPR3",22,0)
 ;
"RTN","BILETPR3",23,0)
 ;---> IMMUNIZATIONS
"RTN","BILETPR3",24,0)
 ;---> PC  DATA
"RTN","BILETPR3",25,0)
 ;---> --  ----
"RTN","BILETPR3",26,0)
 ;--->  1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR3",27,0)
 ;--->  2 = Vaccine Name, Short.
"RTN","BILETPR3",28,0)
 ;--->  3 = Vaccine Components.  ;v8.0
"RTN","BILETPR3",29,0)
 ;--->  4 = IEN, V File Visit.
"RTN","BILETPR3",30,0)
 ;--->  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR3",31,0)
 ;--->  6 = Vaccine Group (Series Type) for grouping of vaccines.
"RTN","BILETPR3",32,0)
 ;--->  7 = Vaccine Lot#, Text.
"RTN","BILETPR3",33,0)
 ;--->  8 = Skin Test Result.
"RTN","BILETPR3",34,0)
 ;--->  9 = Skin Test Reading.
"RTN","BILETPR3",35,0)
 ;---> 10 = Skin Test Name.
"RTN","BILETPR3",36,0)
 ;---> 11 = Reaction to Immunization, text.
"RTN","BILETPR3",37,0)
 ;---> 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR3",38,0)
 ;---> 13 = Dose Override.
"RTN","BILETPR3",39,0)
 ;---> 14 = Vaccine Component CVX Code.
"RTN","BILETPR3",40,0)
 ;
"RTN","BILETPR3",41,0)
 S X="       Immunization          Date Received   Location"
"RTN","BILETPR3",42,0)
 S:BIFORM=4 X=X_"           Lot#"
"RTN","BILETPR3",43,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",44,0)
 S X="       ------------          -------------   ---------------"
"RTN","BILETPR3",45,0)
 S:BIFORM=4 X=X_"    ----------"
"RTN","BILETPR3",46,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",47,0)
 ;
"RTN","BILETPR3",48,0)
 ;---> Loop through "^"-pieces of Imm History, displaying Immunizations.
"RTN","BILETPR3",49,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR3",50,0)
 .;
"RTN","BILETPR3",51,0)
 .;---> Quit if this is not an Immunization.
"RTN","BILETPR3",52,0)
 .Q:$P(Y,V)'="I"
"RTN","BILETPR3",53,0)
 .;
"RTN","BILETPR3",54,0)
 .;---> If not the same Vaccine Group, insert a blank line.
"RTN","BILETPR3",55,0)
 .I $P(Y,V,6)'=Z D:I>1 WRITE(.BILINE) S Z=$P(Y,V,6)
"RTN","BILETPR3",56,0)
 .;
"RTN","BILETPR3",57,0)
 .;---> Set display line for this Immunization and Date.
"RTN","BILETPR3",58,0)
 .N BIPDSSA S BIPDSSA=0
"RTN","BILETPR3",59,0)
 .D
"RTN","BILETPR3",60,0)
 ..;---> Prepend asterisk if this Dose has a User Override or is
"RTN","BILETPR3",61,0)
 ..;---> an ImmServe Problem Dose (flag stored in BIPDSSA).
"RTN","BILETPR3",62,0)
 ..I $P(Y,V,13) S X="      *" Q
"RTN","BILETPR3",63,0)
 ..I $$PDSS^BIUTL8($P(Y,V,4),$P(Y,V,14),$G(BIPDSS)) S X="      *",BIPDSSA=1 Q
"RTN","BILETPR3",64,0)
 ..S X="       "
"RTN","BILETPR3",65,0)
 .;
"RTN","BILETPR3",66,0)
 .S X=X_$P(Y,V,2),X=$$PAD^BIUTL5(X,29)
"RTN","BILETPR3",67,0)
 .S X=X_$$TXDT1^BIUTL5($P(Y,V,12))
"RTN","BILETPR3",68,0)
 .;
"RTN","BILETPR3",69,0)
 .;---> Pad with spaces to line up in columns, add Location.
"RTN","BILETPR3",70,0)
 .S X=$$PAD^BIUTL5(X,45)_$E($P(Y,V,5),1,17)
"RTN","BILETPR3",71,0)
 .;
"RTN","BILETPR3",72,0)
 .;---> If Lot#'s specified, pad with spaces, add Lot#.
"RTN","BILETPR3",73,0)
 .D:BIFORM=4
"RTN","BILETPR3",74,0)
 ..S X=$$PAD^BIUTL5(X,64)_$P(Y,V,7)
"RTN","BILETPR3",75,0)
 .D WRITE(.BILINE,X)
"RTN","BILETPR3",76,0)
 .;
"RTN","BILETPR3",77,0)
 .;
"RTN","BILETPR3",78,0)
 .;---> If this is a Dose Override by user, set another line to display it.
"RTN","BILETPR3",79,0)
 .;---> NOT USED FOR NOW.
"RTN","BILETPR3",80,0)
 .;D:$P(Y,V,13)
"RTN","BILETPR3",81,0)
 .;.;---> Do not display if Override Reason is "FORCED VALID" (per Ros Singleton).
"RTN","BILETPR3",82,0)
 .;.Q:$P(Y,V,13)=9
"RTN","BILETPR3",83,0)
 .;.S X="                             -"_$$DOVER^BIUTL8($P(Y,V,13))_"-"
"RTN","BILETPR3",84,0)
 .;.D WRITE(.BILINE,X)
"RTN","BILETPR3",85,0)
 .;
"RTN","BILETPR3",86,0)
 .;---> If this is a Problem Dose by ImmServe, set another line to display it.
"RTN","BILETPR3",87,0)
 .;---> NOT USED FOR NOW.
"RTN","BILETPR3",88,0)
 .;D:$G(BIPDSSA)
"RTN","BILETPR3",89,0)
 .;.S X="                             -INVALID--SEE IMMSERVE-"
"RTN","BILETPR3",90,0)
 .;.;---> Pad Result with trailing spaces to justify columns.
"RTN","BILETPR3",91,0)
 .;.D WRITE(.BILINE,X)
"RTN","BILETPR3",92,0)
 .;
"RTN","BILETPR3",93,0)
 .;
"RTN","BILETPR3",94,0)
 .;---> If there was a Reaction, set another line to display it.
"RTN","BILETPR3",95,0)
 .D:$P(Y,V,11)]""
"RTN","BILETPR3",96,0)
 ..S X="                                Reaction: "_$P(Y,V,11)
"RTN","BILETPR3",97,0)
 ..;---> Pad Result with trailing spaces to justify columns.
"RTN","BILETPR3",98,0)
 ..D WRITE(.BILINE,X)
"RTN","BILETPR3",99,0)
 ;
"RTN","BILETPR3",100,0)
 ;
"RTN","BILETPR3",101,0)
 ;---> SKIN TESTS
"RTN","BILETPR3",102,0)
 ;---> PC  DATA
"RTN","BILETPR3",103,0)
 ;---> --  ----
"RTN","BILETPR3",104,0)
 ;--->  1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR3",105,0)
 ;--->  4 = V Skin Test File IEN.
"RTN","BILETPR3",106,0)
 ;--->  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR3",107,0)
 ;--->  8 = Skin Test Result.
"RTN","BILETPR3",108,0)
 ;--->  9 = Skin Test Reading.
"RTN","BILETPR3",109,0)
 ;---> 10 = Skin Test Name.
"RTN","BILETPR3",110,0)
 ;---> 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR3",111,0)
 ;
"RTN","BILETPR3",112,0)
 ;---> Do not print Skin Test headers if patient has no Skin Tests.
"RTN","BILETPR3",113,0)
 I $G(BIDFN) Q:'$D(^AUPNVSK("AC",BIDFN))
"RTN","BILETPR3",114,0)
 ;
"RTN","BILETPR3",115,0)
 D WRITE(.BILINE),WRITE(.BILINE)
"RTN","BILETPR3",116,0)
 S X="       Skin Test      Date Received     Location"
"RTN","BILETPR3",117,0)
 S X=X_"            Result"
"RTN","BILETPR3",118,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",119,0)
 S X="       ------------   -------------     ---------------"
"RTN","BILETPR3",120,0)
 S X=X_"     ---------"
"RTN","BILETPR3",121,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",122,0)
 ;
"RTN","BILETPR3",123,0)
 ;---> Loop through "^"-pieces of Imm History, displaying Skin Tests.
"RTN","BILETPR3",124,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR3",125,0)
 .;
"RTN","BILETPR3",126,0)
 .;---> Quit if this is not a Skin Test.
"RTN","BILETPR3",127,0)
 .Q:$P(Y,V)'="S"
"RTN","BILETPR3",128,0)
 .;
"RTN","BILETPR3",129,0)
 .;---> Set display line for this Skin Test Name and Date.
"RTN","BILETPR3",130,0)
 .S X="       "_$P(Y,V,10),X=$$PAD^BIUTL5(X,22)
"RTN","BILETPR3",131,0)
 .S X=X_$$TXDT1^BIUTL5($P(Y,V,12))
"RTN","BILETPR3",132,0)
 .;
"RTN","BILETPR3",133,0)
 .;---> Pad with spaces to line up in columns, add Location.
"RTN","BILETPR3",134,0)
 .S X=$$PAD^BIUTL5(X,40)_$E($P(Y,V,5),1,15)
"RTN","BILETPR3",135,0)
 .;
"RTN","BILETPR3",136,0)
 .;---> Pad with spaces to line up in columns, add Result.
"RTN","BILETPR3",137,0)
 .S X=$$PAD^BIUTL5(X,60)
"RTN","BILETPR3",138,0)
 .D
"RTN","BILETPR3",139,0)
 ..I $P(Y,V,8)]"" S X=X_$P(Y,V,8) Q
"RTN","BILETPR3",140,0)
 ..I $P(Y,V,9) S X=X_$P(Y,V,9)_" mm" Q
"RTN","BILETPR3",141,0)
 ..S X=X_"Not recorded"
"RTN","BILETPR3",142,0)
 .D WRITE(.BILINE,X)
"RTN","BILETPR3",143,0)
 ;
"RTN","BILETPR3",144,0)
 Q
"RTN","BILETPR3",145,0)
 ;
"RTN","BILETPR3",146,0)
 ;
"RTN","BILETPR3",147,0)
 ;----------
"RTN","BILETPR3",148,0)
WRITE(BILINE,BIVAL) ;EP
"RTN","BILETPR3",149,0)
 ;---> Write a line to the ^TMP global for WP or Listman.
"RTN","BILETPR3",150,0)
 ;---> Parameters:
"RTN","BILETPR3",151,0)
 ;     1 - BILINE (ret) Last line# in the WP ^TMP global.
"RTN","BILETPR3",152,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BILETPR3",153,0)
 ;
"RTN","BILETPR3",154,0)
 Q:'$D(BILINE)
"RTN","BILETPR3",155,0)
 D WRITE^BILETPR1(.BILINE,$G(BIVAL))
"RTN","BILETPR3",156,0)
 Q
"RTN","BILETPR4")
0^46^B8005164
"RTN","BILETPR4",1,0)
BILETPR4 ;IHS/CMI/MWR - PRINT PATIENT LETTER; MAY 10, 2010
"RTN","BILETPR4",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BILETPR4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR4",4,0)
 ;;  PRINT INDIVIDUAL PATIENT LETTERS.
"RTN","BILETPR4",5,0)
 ;;  PATCH 1: Add ability to print a second street address line.  PRINT+23
"RTN","BILETPR4",6,0)
 ;
"RTN","BILETPR4",7,0)
 ;
"RTN","BILETPR4",8,0)
 ;----------
"RTN","BILETPR4",9,0)
PRINT(BIDFN,IO,IOST,BIERR) ;EP
"RTN","BILETPR4",10,0)
 ;---> Print patient letter.
"RTN","BILETPR4",11,0)
 ;---> Parameters:
"RTN","BILETPR4",12,0)
 ;     1 - BIDFN (req) Patient's IEN (DFN).
"RTN","BILETPR4",13,0)
 ;     2 - IO    (req) Output Device $I.
"RTN","BILETPR4",14,0)
 ;     3 - IOST  (req) Subtype Name.
"RTN","BILETPR4",15,0)
 ;     4 - BIERR (ret) Error Code, if any.
"RTN","BILETPR4",16,0)
 ;
"RTN","BILETPR4",17,0)
 ;---> CodeChange for v7.1 - IHS/CMI/MWR 12/01/2000:
"RTN","BILETPR4",18,0)
 ;---> To eliminate control chars from printouts.
"RTN","BILETPR4",19,0)
 ;D FULL^VALM1
"RTN","BILETPR4",20,0)
 N BICRT S BICRT=$S(($E(IOST)="C")!(IOST["BROWSER"):1,1:0)
"RTN","BILETPR4",21,0)
 ;
"RTN","BILETPR4",22,0)
 I '$G(BIDFN) S BIERR=201 Q
"RTN","BILETPR4",23,0)
 I '$D(^DPT(BIDFN,0)) S BIERR=203 Q
"RTN","BILETPR4",24,0)
 I '$D(^TMP("BILET",$J)) S BIERR=637 Q
"RTN","BILETPR4",25,0)
 ;
"RTN","BILETPR4",26,0)
 ;
"RTN","BILETPR4",27,0)
 U IO
"RTN","BILETPR4",28,0)
 ;---> To eliminate control chars from printouts.
"RTN","BILETPR4",29,0)
 I BICRT D FULL^VALM1 W @IOF
"RTN","BILETPR4",30,0)
 ;
"RTN","BILETPR4",31,0)
 ;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BILETPR4",32,0)
 ;---> Several line changes follow to allow printing of second street
"RTN","BILETPR4",33,0)
 ;---> address line, if it is on the form letter and if the patient
"RTN","BILETPR4",34,0)
 ;---> has data.  Otherwise, skip printing that line (do not print blank).
"RTN","BILETPR4",35,0)
 ;
"RTN","BILETPR4",36,0)
 ;---> Loop through ^TMP("BILET",$J, writing lines of letter.
"RTN","BILETPR4",37,0)
 N N S N=0
"RTN","BILETPR4",38,0)
 F  S N=$O(^TMP("BILET",$J,N)) Q:'N  D  Q:BIPOP
"RTN","BILETPR4",39,0)
 .;
"RTN","BILETPR4",40,0)
 .;---> Set BILINE=text of a line in the letter.
"RTN","BILETPR4",41,0)
 .N BILINE S BILINE=^TMP("BILET",$J,N,0)
"RTN","BILETPR4",42,0)
 .N BIBLNKL,BISTRT2 S BISTRT2=0,BIBLNKL=$$PAD^BIUTL5(" ",80," ")
"RTN","BILETPR4",43,0)
 .;
"RTN","BILETPR4",44,0)
 .;---> Won't fit on the bottom of this page, do formfeed.
"RTN","BILETPR4",45,0)
 .I N>1 I $Y+5>IOSL D  Q:BIPOP  W @IOF
"RTN","BILETPR4",46,0)
 ..D:BICRT DIRZ^BIUTL3(.BIPOP)
"RTN","BILETPR4",47,0)
 .;
"RTN","BILETPR4",48,0)
 .;---> If line contains Functions, process them.
"RTN","BILETPR4",49,0)
 .D:BILINE["|"
"RTN","BILETPR4",50,0)
 ..;---> BIPCS=number of "|"-pieces in this line.
"RTN","BILETPR4",51,0)
 ..S BIPCS=$L(BILINE,"|")
"RTN","BILETPR4",52,0)
 ..N BILINE1 S BILINE1=""
"RTN","BILETPR4",53,0)
 ..F I=1:1:BIPCS D
"RTN","BILETPR4",54,0)
 ...N X S X=$P(BILINE,"|",I)
"RTN","BILETPR4",55,0)
 ...;
"RTN","BILETPR4",56,0)
 ...;---> If this is an even piece, it should contain a function.
"RTN","BILETPR4",57,0)
 ...D:'(I#2)
"RTN","BILETPR4",58,0)
 ....Q:X=""
"RTN","BILETPR4",59,0)
 ....I X="BI MAILING ADD-STREET-2" S BISTRT2=1
"RTN","BILETPR4",60,0)
 ....;---> Look up function by name.
"RTN","BILETPR4",61,0)
 ....N Z S Z=$O(^DD("FUNC","B",X,0))
"RTN","BILETPR4",62,0)
 ....Q:'Z
"RTN","BILETPR4",63,0)
 ....S X=$G(^DD("FUNC",Z,1))
"RTN","BILETPR4",64,0)
 ....Q:X=""
"RTN","BILETPR4",65,0)
 ....X X
"RTN","BILETPR4",66,0)
 ....;---> If "Street-2" is blank, pad it in case more follows on that line.
"RTN","BILETPR4",67,0)
 ....I X=""&$G(BISTRT2) S X="                         "
"RTN","BILETPR4",68,0)
 ...S BILINE1=BILINE1_X
"RTN","BILETPR4",69,0)
 ..;
"RTN","BILETPR4",70,0)
 ..;---> Reset line with functions processed.
"RTN","BILETPR4",71,0)
 ..S BILINE=BILINE1
"RTN","BILETPR4",72,0)
 .;
"RTN","BILETPR4",73,0)
 .;---> If this is a "Street-2" line but it's entirely blank, don't print it.
"RTN","BILETPR4",74,0)
 .I ($G(BISTRT2))&(BIBLNKL[BILINE) Q
"RTN","BILETPR4",75,0)
 .;---> Okay, print.
"RTN","BILETPR4",76,0)
 .W !,BILINE
"RTN","BILETPR4",77,0)
 ;
"RTN","BILETPR4",78,0)
 W:'BICRT @IOF D:(BICRT&('BIPOP)) DIRZ^BIUTL3()
"RTN","BILETPR4",79,0)
 Q
"RTN","BILETVW")
0^47^B29025411
"RTN","BILETVW",1,0)
BILETVW ;IHS/CMI/MWR - VIEW/EDIT FORM LETTERS; MAY 10, 2010
"RTN","BILETVW",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BILETVW",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETVW",4,0)
 ;;  VIEW/EDIT FORM LETTERS.
"RTN","BILETVW",5,0)
 ;
"RTN","BILETVW",6,0)
 ;----------
"RTN","BILETVW",7,0)
START ;EP
"RTN","BILETVW",8,0)
 ;---> Lookup and edit Form Letters in the file BI LETTER.
"RTN","BILETVW",9,0)
 D SETVARS^BIUTL5 N BIY
"RTN","BILETVW",10,0)
 F  D  Q:$G(BIY)<1
"RTN","BILETVW",11,0)
 .D TITLE^BIUTL5("VIEW/EDIT FORM LETTERS"),TEXT3
"RTN","BILETVW",12,0)
 .N BIIEN
"RTN","BILETVW",13,0)
 .D DIC^BIFMAN(9002084.4,"QEMAL",.BIY,"     Select Form Letter: ")
"RTN","BILETVW",14,0)
 .Q:$G(BIY)<1
"RTN","BILETVW",15,0)
 .S BIIEN=+BIY
"RTN","BILETVW",16,0)
 .;---> If this is a new letter, select and copy  Sample Form Letter.
"RTN","BILETVW",17,0)
 .D:$P(BIY,U,3) ADDNEW^BILETVW2(.BIIEN)
"RTN","BILETVW",18,0)
 .;---> Quit if Sample Form Letter not selected (new IEN deleted).
"RTN","BILETVW",19,0)
 .Q:'$G(BIIEN)
"RTN","BILETVW",20,0)
 .D EN(+BIIEN)
"RTN","BILETVW",21,0)
 D EXIT
"RTN","BILETVW",22,0)
 Q
"RTN","BILETVW",23,0)
 ;
"RTN","BILETVW",24,0)
 ;
"RTN","BILETVW",25,0)
 ;----------
"RTN","BILETVW",26,0)
HAVELET(BIIEN) ;EP
"RTN","BILETVW",27,0)
 ;---> NOT CALLED AT THIS TIME?  8/9/99
"RTN","BILETVW",28,0)
 ;---> Entry point when letter is already known.
"RTN","BILETVW",29,0)
 D SETVARS^BIUTL5
"RTN","BILETVW",30,0)
 K ^TMP("BILMLT",$J)
"RTN","BILETVW",31,0)
 D EN(BIIEN),EXIT
"RTN","BILETVW",32,0)
 Q
"RTN","BILETVW",33,0)
 ;
"RTN","BILETVW",34,0)
 ;
"RTN","BILETVW",35,0)
 ;----------
"RTN","BILETVW",36,0)
EN(BIIEN) ;EP
"RTN","BILETVW",37,0)
 ;---> Main entry point for BI LETTER VIEW/EDIT.
"RTN","BILETVW",38,0)
 ;---> If BIIEN not supplied, set Error Code and quit.
"RTN","BILETVW",39,0)
 I '$G(BIIEN) D ERRCD^BIUTL2(609,,1) Q
"RTN","BILETVW",40,0)
 D EN^VALM("BI LETTER FORM")
"RTN","BILETVW",41,0)
 Q
"RTN","BILETVW",42,0)
 ;
"RTN","BILETVW",43,0)
 ;
"RTN","BILETVW",44,0)
 ;----------
"RTN","BILETVW",45,0)
HDR ;EP
"RTN","BILETVW",46,0)
 ;---> Header code.
"RTN","BILETVW",47,0)
 N X S X="Form Letter: "_$P(^BILET(BIIEN,0),U)
"RTN","BILETVW",48,0)
 D CENTERT^BIUTL5(.X)
"RTN","BILETVW",49,0)
 S VALMHDR(1)=""
"RTN","BILETVW",50,0)
 S VALMHDR(2)=X
"RTN","BILETVW",51,0)
 Q
"RTN","BILETVW",52,0)
 ;
"RTN","BILETVW",53,0)
 ;
"RTN","BILETVW",54,0)
 ;----------
"RTN","BILETVW",55,0)
INIT ;EP
"RTN","BILETVW",56,0)
 ;---> Initialize variables and list array.
"RTN","BILETVW",57,0)
 D INIT^BILETVW1
"RTN","BILETVW",58,0)
 Q
"RTN","BILETVW",59,0)
 ;
"RTN","BILETVW",60,0)
 ;
"RTN","BILETVW",61,0)
 ;----------
"RTN","BILETVW",62,0)
RESET ;EP
"RTN","BILETVW",63,0)
 ;---> Update partition for return to Listmanager.
"RTN","BILETVW",64,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BILETVW",65,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BILETVW",66,0)
 D INIT,HDR Q
"RTN","BILETVW",67,0)
 ;
"RTN","BILETVW",68,0)
 ;
"RTN","BILETVW",69,0)
 ;----------
"RTN","BILETVW",70,0)
RESET2 ;EP
"RTN","BILETVW",71,0)
 ;---> Update partition without recreating display array.
"RTN","BILETVW",72,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BILETVW",73,0)
 D TERM^VALM0 S VALMBCK="R" D HDR Q
"RTN","BILETVW",74,0)
 Q
"RTN","BILETVW",75,0)
 ;
"RTN","BILETVW",76,0)
 ;
"RTN","BILETVW",77,0)
 ;----------
"RTN","BILETVW",78,0)
HELP ;EP
"RTN","BILETVW",79,0)
 ;---> Help code.
"RTN","BILETVW",80,0)
 N BIX S BIX=X
"RTN","BILETVW",81,0)
 D FULL^VALM1 N BIPOP
"RTN","BILETVW",82,0)
 D TITLE^BIUTL5("FORM LETTER EDIT - HELP, page 1 of 2")
"RTN","BILETVW",83,0)
 D TEXT1,DIRZ^BIUTL3(.BIPOP)
"RTN","BILETVW",84,0)
 I $G(BIPOP) D RE^VALM4 Q
"RTN","BILETVW",85,0)
 D TITLE^BIUTL5("FORM LETTER EDIT - HELP, page 2 of 2")
"RTN","BILETVW",86,0)
 D TEXT2,DIRZ^BIUTL3()
"RTN","BILETVW",87,0)
 D:BIX'="??" RE^VALM4
"RTN","BILETVW",88,0)
 Q
"RTN","BILETVW",89,0)
 ;
"RTN","BILETVW",90,0)
 ;
"RTN","BILETVW",91,0)
 ;----------
"RTN","BILETVW",92,0)
TEXT1 ;EP
"RTN","BILETVW",93,0)
 ;;The Form Letter Edit Screen allows you to customize Form Letters.
"RTN","BILETVW",94,0)
 ;;
"RTN","BILETVW",95,0)
 ;;The TOP section of the screen displays the name of the Form Letter.
"RTN","BILETVW",96,0)
 ;;
"RTN","BILETVW",97,0)
 ;;The MIDDLE section of the letter displays the body of the letter
"RTN","BILETVW",98,0)
 ;;in a scrollable region.  Use the up and down arrow keys to view
"RTN","BILETVW",99,0)
 ;;all parts of the letter.
"RTN","BILETVW",100,0)
 ;;
"RTN","BILETVW",101,0)
 ;;The BOTTOM section of the screen lists actions you can take to
"RTN","BILETVW",102,0)
 ;;edit secions of the letter or to print or delete the letter.
"RTN","BILETVW",103,0)
 ;;
"RTN","BILETVW",104,0)
 ;;Fields in the letter are signified by uppercase text within vertical
"RTN","BILETVW",105,0)
 ;;bars, such as |PATIENT NAME|.  These Fields may be moved within the
"RTN","BILETVW",106,0)
 ;;letter or they may be deleted.   However, the text within the
"RTN","BILETVW",107,0)
 ;;vertical bars must NOT be altered.
"RTN","BILETVW",108,0)
 ;;
"RTN","BILETVW",109,0)
 D PRINTX("TEXT1")
"RTN","BILETVW",110,0)
 Q
"RTN","BILETVW",111,0)
 ;
"RTN","BILETVW",112,0)
 ;
"RTN","BILETVW",113,0)
 ;----------
"RTN","BILETVW",114,0)
TEXT2 ;EP
"RTN","BILETVW",115,0)
 ;;A Form Letter may contain up to 7 Sections.  Each section is
"RTN","BILETVW",116,0)
 ;;represented by an Action at the bottom of the screen: Top, History,
"RTN","BILETVW",117,0)
 ;;Middle, Forecast, Bottom, Date/Loc, and Closing.
"RTN","BILETVW",118,0)
 ;;
"RTN","BILETVW",119,0)
 ;;When selected, some Sections take you to the word processor in order
"RTN","BILETVW",120,0)
 ;;to allow you to edit the section. (Your Preferred Editor should be
"RTN","BILETVW",121,0)
 ;;"Full Screen" for this; if not, contact your Site Manager.)
"RTN","BILETVW",122,0)
 ;;
"RTN","BILETVW",123,0)
 ;;Other Sections provide helpful information when they are selected.
"RTN","BILETVW",124,0)
 ;;
"RTN","BILETVW",125,0)
 ;;In order to add a NEW Form Letter, simply enter a name for the
"RTN","BILETVW",126,0)
 ;;new letter at the very first prompt, "Select Form Letter: ".
"RTN","BILETVW",127,0)
 ;;A generic sample letter will then appear under the newly named Form
"RTN","BILETVW",128,0)
 ;;Letter, which you can then edit to suit the intended purposes.
"RTN","BILETVW",129,0)
 ;;
"RTN","BILETVW",130,0)
 D PRINTX("TEXT2")
"RTN","BILETVW",131,0)
 Q
"RTN","BILETVW",132,0)
 ;
"RTN","BILETVW",133,0)
 ;
"RTN","BILETVW",134,0)
 ;----------
"RTN","BILETVW",135,0)
TEXT3 ;EP
"RTN","BILETVW",136,0)
 ;;This screen will allow you to add and edit Form Letters.
"RTN","BILETVW",137,0)
 ;;
"RTN","BILETVW",138,0)
 ;;Please select a Form Letter, or enter the name of a new Form Letter
"RTN","BILETVW",139,0)
 ;;you wish to add.  (Enter "?" to see a list of existing Form Letters.)
"RTN","BILETVW",140,0)
 ;;
"RTN","BILETVW",141,0)
 D PRINTX("TEXT3")
"RTN","BILETVW",142,0)
 Q
"RTN","BILETVW",143,0)
 ;
"RTN","BILETVW",144,0)
 ;
"RTN","BILETVW",145,0)
 ;----------
"RTN","BILETVW",146,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILETVW",147,0)
 Q:$G(BILINL)=""
"RTN","BILETVW",148,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILETVW",149,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BILETVW",150,0)
 Q
"RTN","BILETVW",151,0)
 ;
"RTN","BILETVW",152,0)
 ;
"RTN","BILETVW",153,0)
 ;----------
"RTN","BILETVW",154,0)
EXIT ;EP
"RTN","BILETVW",155,0)
 ;---> End of job cleanup.
"RTN","BILETVW",156,0)
 D KILLALL^BIUTL8(1)
"RTN","BILETVW",157,0)
 K ^TMP("BILMLT",$J)
"RTN","BILETVW",158,0)
 D CLEAR^VALM1
"RTN","BILETVW",159,0)
 D FULL^VALM1
"RTN","BILETVW",160,0)
 Q
"RTN","BILETVW1")
0^48^B37659707
"RTN","BILETVW1",1,0)
BILETVW1 ;IHS/CMI/MWR - VIEW/EDIT FORM LETTERS; MAY 10, 2010
"RTN","BILETVW1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BILETVW1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETVW1",4,0)
 ;;  INIT FOR VIEW/EDIT FORM LETTERS.
"RTN","BILETVW1",5,0)
 ;
"RTN","BILETVW1",6,0)
 ;
"RTN","BILETVW1",7,0)
 ;----------
"RTN","BILETVW1",8,0)
INIT ;EP
"RTN","BILETVW1",9,0)
 ;---> Initialize variables and list array.
"RTN","BILETVW1",10,0)
 ;
"RTN","BILETVW1",11,0)
 ;---> If BIIEN not supplied, set Error Code and quit.
"RTN","BILETVW1",12,0)
 I '$G(BIIEN) D ERRCD^BIUTL2(609,,1) S VALMQUIT="" Q
"RTN","BILETVW1",13,0)
 I '$D(^BILET(BIIEN,0)) D ERRCD^BIUTL2(610,,1) S VALMQUIT="" Q
"RTN","BILETVW1",14,0)
 ;
"RTN","BILETVW1",15,0)
 ;---> Set Lower Frame Bar and Screen Title.
"RTN","BILETVW1",16,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BILETVW1",17,0)
 ;
"RTN","BILETVW1",18,0)
 ;---> Build Listmanager array from Form Letter global.
"RTN","BILETVW1",19,0)
 K ^TMP("BILMLT",$J)
"RTN","BILETVW1",20,0)
 S BILINE=0
"RTN","BILETVW1",21,0)
 ;
"RTN","BILETVW1",22,0)
 ;---> If Forecast comes first, set BIFF=1
"RTN","BILETVW1",23,0)
 N BIFF S BIFF=$P(^BILET(BIIEN,0),U,6)
"RTN","BILETVW1",24,0)
 ;
"RTN","BILETVW1",25,0)
 D SECTION(BIIEN,.BILINE,1,"top")
"RTN","BILETVW1",26,0)
 D
"RTN","BILETVW1",27,0)
 .I BIFF D FORECAST(BIIEN,.BILINE) Q
"RTN","BILETVW1",28,0)
 .D HISTORY(BIIEN,.BILINE)
"RTN","BILETVW1",29,0)
 D SECTION(BIIEN,.BILINE,2,"middle")
"RTN","BILETVW1",30,0)
 D
"RTN","BILETVW1",31,0)
 .I BIFF D HISTORY(BIIEN,.BILINE) Q
"RTN","BILETVW1",32,0)
 .D FORECAST(BIIEN,.BILINE)
"RTN","BILETVW1",33,0)
 D SECTION(BIIEN,.BILINE,3,"bottom")
"RTN","BILETVW1",34,0)
 D DATELOC(BIIEN,.BILINE)
"RTN","BILETVW1",35,0)
 D SECTION(BIIEN,.BILINE,4,"closing")
"RTN","BILETVW1",36,0)
 ;
"RTN","BILETVW1",37,0)
 ;---> Finish up Listmanager List Count.
"RTN","BILETVW1",38,0)
 S VALMCNT=BILINE
"RTN","BILETVW1",39,0)
 I VALMCNT>12 D
"RTN","BILETVW1",40,0)
 .S VALMSG="Scroll down to view more.  Type ?? for more actions."
"RTN","BILETVW1",41,0)
 Q
"RTN","BILETVW1",42,0)
 ;
"RTN","BILETVW1",43,0)
 ;
"RTN","BILETVW1",44,0)
 ;----------
"RTN","BILETVW1",45,0)
SECTION(BIIEN,BILINE,BISEC,BISECLB) ;EP
"RTN","BILETVW1",46,0)
 ;---> Set a Section of a Form Letter into Listman array.
"RTN","BILETVW1",47,0)
 ;---> Parameters:
"RTN","BILETVW1",48,0)
 ;     1 - BIIEN   (req) IEN of Form Letter.
"RTN","BILETVW1",49,0)
 ;     2 - BILINE  (ret) Last line written into Listman array.
"RTN","BILETVW1",50,0)
 ;     3 - BISEC   (req) Section of Form Letter to retrieve.
"RTN","BILETVW1",51,0)
 ;     4 - BISECLB (req) Section Label.
"RTN","BILETVW1",52,0)
 ;
"RTN","BILETVW1",53,0)
 Q:'$G(BIIEN)
"RTN","BILETVW1",54,0)
 Q:'$G(BISEC)
"RTN","BILETVW1",55,0)
 S:'$G(BILINE) BILINE=0
"RTN","BILETVW1",56,0)
 S:$G(BISECLB)="" BISECLB="UNLABELED SECTION"
"RTN","BILETVW1",57,0)
 ;
"RTN","BILETVW1",58,0)
 D SECTBRK(.BILINE,BISECLB)
"RTN","BILETVW1",59,0)
 ;
"RTN","BILETVW1",60,0)
 D:$D(^BILET(BIIEN,BISEC,0))
"RTN","BILETVW1",61,0)
 .N N S N=0
"RTN","BILETVW1",62,0)
 .F  S N=$O(^BILET(BIIEN,BISEC,N)) Q:'N  D
"RTN","BILETVW1",63,0)
 ..S BILINE=BILINE+1
"RTN","BILETVW1",64,0)
 ..S ^TMP("BILMLT",$J,BILINE,0)=^BILET(BIIEN,BISEC,N,0)
"RTN","BILETVW1",65,0)
 ;
"RTN","BILETVW1",66,0)
 Q
"RTN","BILETVW1",67,0)
 ;
"RTN","BILETVW1",68,0)
 ;
"RTN","BILETVW1",69,0)
 ;----------
"RTN","BILETVW1",70,0)
HISTORY(BIIEN,L) ;EP
"RTN","BILETVW1",71,0)
 ;---> Set an example of a patient's Immunization History Section
"RTN","BILETVW1",72,0)
 ;---> of a Form Letter into Listman array.
"RTN","BILETVW1",73,0)
 ;---> Parameters:
"RTN","BILETVW1",74,0)
 ;     1 - BIIEN   (req) IEN of Form Letter.
"RTN","BILETVW1",75,0)
 ;     2 - L  (ret) Last line written into Listman array.
"RTN","BILETVW1",76,0)
 ;
"RTN","BILETVW1",77,0)
 Q:'$G(BIIEN)
"RTN","BILETVW1",78,0)
 S:'$G(L) L=0
"RTN","BILETVW1",79,0)
 Q:'$P(^BILET(BIIEN,0),U,2)
"RTN","BILETVW1",80,0)
 D SECTBRK(.L,"history")
"RTN","BILETVW1",81,0)
 ;
"RTN","BILETVW1",82,0)
 N BIFORM,X
"RTN","BILETVW1",83,0)
 S BIFORM=$P(^BILET(BIIEN,0),U,2)
"RTN","BILETVW1",84,0)
 I BIFORM=1 D  Q
"RTN","BILETVW1",85,0)
 .;---> Example list of Immunization History by Date.
"RTN","BILETVW1",86,0)
 .S X="        12-Aug-1994:  1-DTP, 1-OPV, 1-PEDVAXHIB, 1-HEP B VAC"
"RTN","BILETVW1",87,0)
 .D WRITE(.L,X)
"RTN","BILETVW1",88,0)
 .S X="        10-Oct-1994:  2-DTP, 2-OPV, 2-PEDVAXHIB, 2-HEP B VAC"
"RTN","BILETVW1",89,0)
 .D WRITE(.L,X)
"RTN","BILETVW1",90,0)
 ;
"RTN","BILETVW1",91,0)
 I BIFORM=2 D  Q
"RTN","BILETVW1",92,0)
 .;---> Example list of Immunization History by Date.
"RTN","BILETVW1",93,0)
 .S X="        12-Aug-1994:  1-DTP (099E), 1-OPV (7845F), 1-PEDVAXHIB"
"RTN","BILETVW1",94,0)
 .S X=X_" (78T032)"
"RTN","BILETVW1",95,0)
 .D WRITE(.L,X)
"RTN","BILETVW1",96,0)
 .S X="                      2-HEP B VAC (900RT4)"
"RTN","BILETVW1",97,0)
 .D WRITE(.L,X)
"RTN","BILETVW1",98,0)
 .S X="        10-Oct-1994:  2-DTP (101E2), 2-OPV (877K1), 2-PEDVAXHIB"
"RTN","BILETVW1",99,0)
 .D WRITE(.L,X)
"RTN","BILETVW1",100,0)
 ;
"RTN","BILETVW1",101,0)
 ;---> Example list of Immunization History by Vaccine.
"RTN","BILETVW1",102,0)
 S X="       Immunization   Date Received     Location"
"RTN","BILETVW1",103,0)
 S:BIFORM=4 X=X_"            Lot#"
"RTN","BILETVW1",104,0)
 D WRITE(.L,X)
"RTN","BILETVW1",105,0)
 S X="       ------------   -------------     ---------------"
"RTN","BILETVW1",106,0)
 S:BIFORM=4 X=X_"     ----------"
"RTN","BILETVW1",107,0)
 D WRITE(.L,X)
"RTN","BILETVW1",108,0)
 S X="       1-DTP          12-Aug-1994       Anch Med Ctr"
"RTN","BILETVW1",109,0)
 S:BIFORM=4 X=X_"        0900E"
"RTN","BILETVW1",110,0)
 D WRITE(.L,X)
"RTN","BILETVW1",111,0)
 S X="       2-DTP          12-Oct-1994       Kotzebue Hospital"
"RTN","BILETVW1",112,0)
 S:BIFORM=4 X=X_"   94-56t"
"RTN","BILETVW1",113,0)
 D WRITE(.L,X)
"RTN","BILETVW1",114,0)
 S X="       3-DTP          19-Dec-1994       Anch Med Ctr"
"RTN","BILETVW1",115,0)
 S:BIFORM=4 X=X_"        0901F"
"RTN","BILETVW1",116,0)
 D WRITE(.L,X)
"RTN","BILETVW1",117,0)
 D WRITE(.L)
"RTN","BILETVW1",118,0)
 S X="       1-OPV          12-Aug-1994       Anch Med Ctr"
"RTN","BILETVW1",119,0)
 S:BIFORM=4 X=X_"        468-781b"
"RTN","BILETVW1",120,0)
 D WRITE(.L,X)
"RTN","BILETVW1",121,0)
 S X="       2-OPV          12-Oct-1994       Kotzebue Hospital"
"RTN","BILETVW1",122,0)
 S:BIFORM=4 X=X_"   468-732f"
"RTN","BILETVW1",123,0)
 D WRITE(.L,X)
"RTN","BILETVW1",124,0)
 S X="       3-OPV          25-Oct-1995       RedLake Hospital"
"RTN","BILETVW1",125,0)
 S:BIFORM=4 X=X_"    468-81a"
"RTN","BILETVW1",126,0)
 D WRITE(.L,X)
"RTN","BILETVW1",127,0)
 D WRITE(.L)
"RTN","BILETVW1",128,0)
 S X="       1-PEDVAXHIB    12-Aug-1994       Anch Med Ctr"
"RTN","BILETVW1",129,0)
 D WRITE(.L,X)
"RTN","BILETVW1",130,0)
 S X="       2-PEDVAXHIB    12-Oct-1994       Kotzebue Hospital"
"RTN","BILETVW1",131,0)
 S:BIFORM=4 X=X_"   zr987v"
"RTN","BILETVW1",132,0)
 D WRITE(.L,X)
"RTN","BILETVW1",133,0)
 S X="       3-PEDVAXHIB    12-Jul-1995       Anch Med Ctr"
"RTN","BILETVW1",134,0)
 D WRITE(.L,X)
"RTN","BILETVW1",135,0)
 D WRITE(.L)
"RTN","BILETVW1",136,0)
 S X="       1-HEP B        29-Jun-1994       Anch Med Ctr"
"RTN","BILETVW1",137,0)
 S:BIFORM=4 X=X_"        500s-01"
"RTN","BILETVW1",138,0)
 D WRITE(.L,X)
"RTN","BILETVW1",139,0)
 S X="       2-HEP B        12-Aug-1994       Anch Med Ctr"
"RTN","BILETVW1",140,0)
 D WRITE(.L,X)
"RTN","BILETVW1",141,0)
 S X="       3-HEP B        19-Dec-1994       Anch Med Ctr"
"RTN","BILETVW1",142,0)
 D WRITE(.L,X)
"RTN","BILETVW1",143,0)
 D WRITE(.L)
"RTN","BILETVW1",144,0)
 S X="       1-MMR          12-Jul-1995       Anch Med Ctr"
"RTN","BILETVW1",145,0)
 S:BIFORM=4 X=X_"        345-101t"
"RTN","BILETVW1",146,0)
 D WRITE(.L,X)
"RTN","BILETVW1",147,0)
 ;
"RTN","BILETVW1",148,0)
 ;---> Example list of Skin Tests.
"RTN","BILETVW1",149,0)
 D WRITE(.L),WRITE(.L)
"RTN","BILETVW1",150,0)
 S X="       Skin Test      Date Received     Location"
"RTN","BILETVW1",151,0)
 S X=X_"            Result"
"RTN","BILETVW1",152,0)
 D WRITE(.L,X)
"RTN","BILETVW1",153,0)
 S X="       ------------   -------------     ---------------"
"RTN","BILETVW1",154,0)
 S X=X_"     ---------"
"RTN","BILETVW1",155,0)
 D WRITE(.L,X)
"RTN","BILETVW1",156,0)
 S X="       MONO-VAC       12-Aug-1994       Anch Med Ctr"
"RTN","BILETVW1",157,0)
 S X=X_"        Negative"
"RTN","BILETVW1",158,0)
 D WRITE(.L,X)
"RTN","BILETVW1",159,0)
 Q
"RTN","BILETVW1",160,0)
 ;
"RTN","BILETVW1",161,0)
 ;
"RTN","BILETVW1",162,0)
 ;----------
"RTN","BILETVW1",163,0)
WRITE(BILINE,X) ;EP
"RTN","BILETVW1",164,0)
 ;---> Set text (X) in Listman Edit Letter temp global.
"RTN","BILETVW1",165,0)
 ;---> Parameters:
"RTN","BILETVW1",166,0)
 ;     1 - BILINE (req) Last line written into Listman array.
"RTN","BILETVW1",167,0)
 ;     2 - X      (opt) Text of line.  If X=null, insert blank line.
"RTN","BILETVW1",168,0)
 ;
"RTN","BILETVW1",169,0)
 S BILINE=BILINE+1
"RTN","BILETVW1",170,0)
 S:$G(X)="" X=" "
"RTN","BILETVW1",171,0)
 S ^TMP("BILMLT",$J,BILINE,0)=X
"RTN","BILETVW1",172,0)
 Q
"RTN","BILETVW1",173,0)
 ;
"RTN","BILETVW1",174,0)
 ;
"RTN","BILETVW1",175,0)
 ;----------
"RTN","BILETVW1",176,0)
FORECAST(BIIEN,BILINE) ;EP
"RTN","BILETVW1",177,0)
 ;---> Set an example of a patient's Immunization Forecast Section
"RTN","BILETVW1",178,0)
 ;---> of a Form Letter into Listman array.
"RTN","BILETVW1",179,0)
 ;---> Parameters:
"RTN","BILETVW1",180,0)
 ;     1 - BIIEN   (req) IEN of Form Letter.
"RTN","BILETVW1",181,0)
 ;     2 - BILINE  (ret) Last line written into Listman array.
"RTN","BILETVW1",182,0)
 ;
"RTN","BILETVW1",183,0)
 Q:'$G(BIIEN)
"RTN","BILETVW1",184,0)
 S:'$G(BILINE) BILINE=0
"RTN","BILETVW1",185,0)
 Q:'$P(^BILET(BIIEN,0),U,3)
"RTN","BILETVW1",186,0)
 D SECTBRK(.BILINE,"forecast")
"RTN","BILETVW1",187,0)
 ;
"RTN","BILETVW1",188,0)
 N X
"RTN","BILETVW1",189,0)
 S BILINE=BILINE+1
"RTN","BILETVW1",190,0)
 S X="        DTP"
"RTN","BILETVW1",191,0)
 S ^TMP("BILMLT",$J,BILINE,0)=X
"RTN","BILETVW1",192,0)
 S BILINE=BILINE+1
"RTN","BILETVW1",193,0)
 S X="        HEP B VAC"
"RTN","BILETVW1",194,0)
 S ^TMP("BILMLT",$J,BILINE,0)=X
"RTN","BILETVW1",195,0)
 Q
"RTN","BILETVW1",196,0)
 ;
"RTN","BILETVW1",197,0)
 ;
"RTN","BILETVW1",198,0)
 ;----------
"RTN","BILETVW1",199,0)
DATELOC(BIIEN,BILINE) ;EP
"RTN","BILETVW1",200,0)
 ;---> Set an example of a Date Location line of a Form Letter
"RTN","BILETVW1",201,0)
 ;---> into Listman array.
"RTN","BILETVW1",202,0)
 ;---> Parameters:
"RTN","BILETVW1",203,0)
 ;     1 - BIIEN   (req) IEN of Form Letter.
"RTN","BILETVW1",204,0)
 ;     2 - BILINE  (ret) Last line written into Listman array.
"RTN","BILETVW1",205,0)
 ;
"RTN","BILETVW1",206,0)
 Q:'$G(BIIEN)
"RTN","BILETVW1",207,0)
 S:'$G(BILINE) BILINE=0
"RTN","BILETVW1",208,0)
 Q:'$P(^BILET(BIIEN,0),U,4)
"RTN","BILETVW1",209,0)
 D SECTBRK(.BILINE,"date/location")
"RTN","BILETVW1",210,0)
 ;
"RTN","BILETVW1",211,0)
 N X
"RTN","BILETVW1",212,0)
 S BILINE=BILINE+1
"RTN","BILETVW1",213,0)
 S X="     10-Dec-1994  at Kiddy Klinic, Alaska Native Medical Center"
"RTN","BILETVW1",214,0)
 S ^TMP("BILMLT",$J,BILINE,0)=X
"RTN","BILETVW1",215,0)
 Q
"RTN","BILETVW1",216,0)
 ;
"RTN","BILETVW1",217,0)
 ;
"RTN","BILETVW1",218,0)
 ;----------
"RTN","BILETVW1",219,0)
SECTBRK(BILINE,BISECLB) ;EP
"RTN","BILETVW1",220,0)
 ;---> Insert a Section Break in Listman array.
"RTN","BILETVW1",221,0)
 ;---> Parameters:
"RTN","BILETVW1",222,0)
 ;     1 - BILINE  (ret) IEN of Form Letter.
"RTN","BILETVW1",223,0)
 ;     2 - BISECLB (req) Section Label.
"RTN","BILETVW1",224,0)
 ;
"RTN","BILETVW1",225,0)
 S:'$G(BILINE) BILINE=0
"RTN","BILETVW1",226,0)
 S:$G(BISECLB)="" BISECLB="UNLABELED SECTION"
"RTN","BILETVW1",227,0)
 S BISECLB="* "_BISECLB_": *"
"RTN","BILETVW1",228,0)
 N BISECBK S BISECBK=$$SP^BIUTL5(79,"-")
"RTN","BILETVW1",229,0)
 ;
"RTN","BILETVW1",230,0)
 S BILINE=BILINE+1,^TMP("BILMLT",$J,BILINE,0)=BISECBK
"RTN","BILETVW1",231,0)
 S BILINE=BILINE+1,^TMP("BILMLT",$J,BILINE,0)=BISECLB
"RTN","BILETVW1",232,0)
 S BILINE=BILINE+1,^TMP("BILMLT",$J,BILINE,0)=""
"RTN","BILETVW1",233,0)
 Q
"RTN","BILETVW2")
0^49^B101256737
"RTN","BILETVW2",1,0)
BILETVW2 ;IHS/CMI/MWR - VIEW/EDIT FORM LETTERS; MAY 10, 2010
"RTN","BILETVW2",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BILETVW2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETVW2",4,0)
 ;;  EDIT SECTIONS OF FORM LETTERS.
"RTN","BILETVW2",5,0)
 ;;  PATCH 9: New feature to allow copying of existing Form Letter. ADDNEW+11
"RTN","BILETVW2",6,0)
 ;
"RTN","BILETVW2",7,0)
 ;
"RTN","BILETVW2",8,0)
 ;----------
"RTN","BILETVW2",9,0)
EDITSEC(BINODE) ;EP
"RTN","BILETVW2",10,0)
 ;---> Edit Section of Form Letter.
"RTN","BILETVW2",11,0)
 ;---> Parameters:
"RTN","BILETVW2",12,0)
 ;     1 - BINODE (req) WP Node in BI LETTER entry to edit.
"RTN","BILETVW2",13,0)
 ;
"RTN","BILETVW2",14,0)
 ;---> Variables:
"RTN","BILETVW2",15,0)
 ;     1 - BIIEN  (req) IEN of the BI LETTER entry being edited
"RTN","BILETVW2",16,0)
 ;                      (selected in ^BILETVW).
"RTN","BILETVW2",17,0)
 ;
"RTN","BILETVW2",18,0)
 ;---> Steps:
"RTN","BILETVW2",19,0)
 ;            1) This entry point is called by the Protocols:
"RTN","BILETVW2",20,0)
 ;               BI LETTER EDIT TOP/MIDDLE/BOTTOM, actions on the
"RTN","BILETVW2",21,0)
 ;               List Manager menu protocol: BI MENU LETTER FORM.
"RTN","BILETVW2",22,0)
 ;
"RTN","BILETVW2",23,0)
 ;            2) This code calls ^DIWE to allow the user to edit
"RTN","BILETVW2",24,0)
 ;               those sections of the Form Letter in WP mode.
"RTN","BILETVW2",25,0)
 ;
"RTN","BILETVW2",26,0)
 Q:$$LETCHECK($G(BIIEN))
"RTN","BILETVW2",27,0)
 ;
"RTN","BILETVW2",28,0)
 ;---> If BINODE not supplied, set Error Code and quit.
"RTN","BILETVW2",29,0)
 I '$G(BINODE) D ERRCD^BIUTL2(611,,1) D RESET^BILETVW Q
"RTN","BILETVW2",30,0)
 D:'$D(^BILET(BIIEN,BINODE,0))
"RTN","BILETVW2",31,0)
 .S ^BILET(BIIEN,BINODE,0)="^^1^1^"_DT,^(1,0)="     Place text here."
"RTN","BILETVW2",32,0)
 ;
"RTN","BILETVW2",33,0)
 N DIC S DIC="^BILET("_BIIEN_","_BINODE_","
"RTN","BILETVW2",34,0)
 D EN^DIWE
"RTN","BILETVW2",35,0)
 ;
"RTN","BILETVW2",36,0)
 D RESET^BILETVW
"RTN","BILETVW2",37,0)
 Q
"RTN","BILETVW2",38,0)
 ;
"RTN","BILETVW2",39,0)
 ;
"RTN","BILETVW2",40,0)
 ;----------
"RTN","BILETVW2",41,0)
HISTORY ;EP
"RTN","BILETVW2",42,0)
 ;---> Add/Remove Immunization History to/from a Form Letter.
"RTN","BILETVW2",43,0)
 ;---> Variables:
"RTN","BILETVW2",44,0)
 ;     1 - BIIEN  (req) IEN of the BI LETTER entry being edited.
"RTN","BILETVW2",45,0)
 ;
"RTN","BILETVW2",46,0)
 ;---> Steps:
"RTN","BILETVW2",47,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETVW2",48,0)
 ;               BI LETTER HISTORY, an action on the Listmanager
"RTN","BILETVW2",49,0)
 ;               menu protocol: BI MENU LETTER FORM.
"RTN","BILETVW2",50,0)
 ;
"RTN","BILETVW2",51,0)
 Q:$$LETCHECK($G(BIIEN))
"RTN","BILETVW2",52,0)
 ;
"RTN","BILETVW2",53,0)
 D FULL^VALM1
"RTN","BILETVW2",54,0)
 D TITLE^BIUTL5("INCLUDE IMM HISTORY IN LETTER")
"RTN","BILETVW2",55,0)
 N DIR,DIRUT
"RTN","BILETVW2",56,0)
 W !!!,"   Include patient's Immunization History in this Form Letter?"
"RTN","BILETVW2",57,0)
 W ! D HELP1
"RTN","BILETVW2",58,0)
 S DIR(0)="YOA",DIR("A")="   Enter Yes or No: "
"RTN","BILETVW2",59,0)
 S DIR("B")=$S(+$P(^BILET(BIIEN,0),U,2):"Yes",1:"No")
"RTN","BILETVW2",60,0)
 D ^DIR
"RTN","BILETVW2",61,0)
 I $D(DIRUT) D RESET^BILETVW Q
"RTN","BILETVW2",62,0)
 ;
"RTN","BILETVW2",63,0)
 I 'Y S $P(^BILET(BIIEN,0),U,2)=0 D RESET^BILETVW Q
"RTN","BILETVW2",64,0)
 ;
"RTN","BILETVW2",65,0)
 K DIR,DIRUT
"RTN","BILETVW2",66,0)
 W !!!,"   List the Immunization History by Date or by Vaccine,"
"RTN","BILETVW2",67,0)
 W " with or without",!,"   Lot Numbers?"
"RTN","BILETVW2",68,0)
 D HELP2
"RTN","BILETVW2",69,0)
 S DIR(0)="SOM^1:Date;2:Date w/Lot#;3:Vaccine;4:Vaccine w/Lot#"
"RTN","BILETVW2",70,0)
 S DIR("A")="   Enter a number"
"RTN","BILETVW2",71,0)
 S DIR("B")=+$P(^BILET(BIIEN,0),U,2) S:DIR("B")=0 DIR("B")=1
"RTN","BILETVW2",72,0)
 D ^DIR
"RTN","BILETVW2",73,0)
 I $D(DIRUT) D RESET^BILETVW Q
"RTN","BILETVW2",74,0)
 S $P(^BILET(BIIEN,0),U,2)=+Y
"RTN","BILETVW2",75,0)
 K DIR,DIRUT
"RTN","BILETVW2",76,0)
 ;
"RTN","BILETVW2",77,0)
 ;---> Next section not used, but preserved in case they want to be
"RTN","BILETVW2",78,0)
 ;---> able to exclude invalid doses from letter for particular letters.
"RTN","BILETVW2",79,0)
 ;N DIR,DIRUT
"RTN","BILETVW2",80,0)
 ;W !!!,"   Include Invalid Doses in this Form Letter?"
"RTN","BILETVW2",81,0)
 ;W ! D HELP6
"RTN","BILETVW2",82,0)
 ;S DIR(0)="YOA",DIR("A")="   Enter Yes or No: "
"RTN","BILETVW2",83,0)
 ;S DIR("B")=$S(+$P(^BILET(BIIEN,0),U,5):"No",1:"Yes")
"RTN","BILETVW2",84,0)
 ;D ^DIR
"RTN","BILETVW2",85,0)
 ;I $D(DIRUT) D RESET^BILETVW Q
"RTN","BILETVW2",86,0)
 ;S $P(^BILET(BIIEN,0),U,5)=+Y
"RTN","BILETVW2",87,0)
 ;
"RTN","BILETVW2",88,0)
 D RESET^BILETVW
"RTN","BILETVW2",89,0)
 Q
"RTN","BILETVW2",90,0)
 ;
"RTN","BILETVW2",91,0)
 ;
"RTN","BILETVW2",92,0)
 ;----------
"RTN","BILETVW2",93,0)
HELP1 ;EP
"RTN","BILETVW2",94,0)
 ;;Enter YES to have the patient's Immunization History appear between
"RTN","BILETVW2",95,0)
 ;;the top and middle sections of the Form Letter.  Enter NO to exclude
"RTN","BILETVW2",96,0)
 ;;the Immunization History from this Form Letter.
"RTN","BILETVW2",97,0)
 D HELPTX("HELP1",5)
"RTN","BILETVW2",98,0)
 Q
"RTN","BILETVW2",99,0)
 ;
"RTN","BILETVW2",100,0)
 ;
"RTN","BILETVW2",101,0)
 ;----------
"RTN","BILETVW2",102,0)
HELP2 ;EP
"RTN","BILETVW2",103,0)
 ;;Enter 1 to list the Immunization History in the letter by DATE,
"RTN","BILETVW2",104,0)
 ;;enter 2 to list the History by DATE with LOT NUMBERS,
"RTN","BILETVW2",105,0)
 ;;enter 3 to list the History by VACCINE, or
"RTN","BILETVW2",106,0)
 ;;enter 4 to list the History by VACCINE with LOT NUMBERS.
"RTN","BILETVW2",107,0)
 D HELPTX("HELP2",5)
"RTN","BILETVW2",108,0)
 Q
"RTN","BILETVW2",109,0)
 ;
"RTN","BILETVW2",110,0)
 ;
"RTN","BILETVW2",111,0)
 ;----------
"RTN","BILETVW2",112,0)
HELP6 ;EP
"RTN","BILETVW2",113,0)
 ;;Enter YES if you would like to have doses that are considered Invalid
"RTN","BILETVW2",114,0)
 ;;(and their reasons) appear in the list of immunizations on this letter.
"RTN","BILETVW2",115,0)
 ;;Enter NO to prevent any Invalid Doses from appearing in this letter.
"RTN","BILETVW2",116,0)
 D HELPTX("HELP6",5)
"RTN","BILETVW2",117,0)
 Q
"RTN","BILETVW2",118,0)
 ;
"RTN","BILETVW2",119,0)
 ;
"RTN","BILETVW2",120,0)
 ;----------
"RTN","BILETVW2",121,0)
FORECAST ;EP
"RTN","BILETVW2",122,0)
 ;---> Add/Remove Immunization Forecast to/from a Form Letter.
"RTN","BILETVW2",123,0)
 ;---> Variables:
"RTN","BILETVW2",124,0)
 ;     1 - BIIEN  (req) IEN of the BI LETTER entry being edited.
"RTN","BILETVW2",125,0)
 ;
"RTN","BILETVW2",126,0)
 ;---> Steps:
"RTN","BILETVW2",127,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETVW2",128,0)
 ;               BI LETTER FORECAST, an action on the Listmanager
"RTN","BILETVW2",129,0)
 ;               menu protocol: BI MENU LETTER FORM.
"RTN","BILETVW2",130,0)
 ;
"RTN","BILETVW2",131,0)
 Q:$$LETCHECK($G(BIIEN))
"RTN","BILETVW2",132,0)
 ;
"RTN","BILETVW2",133,0)
 N DIR,DIRUT
"RTN","BILETVW2",134,0)
 W !!!!,"   Include patient's Forecast in this Form Letter?"
"RTN","BILETVW2",135,0)
 S DIR(0)="YO",DIR("A")="   Enter Yes or No" D HELP3
"RTN","BILETVW2",136,0)
 D ^DIR
"RTN","BILETVW2",137,0)
 S:'$D(DIRUT) $P(^BILET(BIIEN,0),U,3)=+Y
"RTN","BILETVW2",138,0)
 D RESET^BILETVW
"RTN","BILETVW2",139,0)
 Q
"RTN","BILETVW2",140,0)
 ;
"RTN","BILETVW2",141,0)
 ;
"RTN","BILETVW2",142,0)
 ;----------
"RTN","BILETVW2",143,0)
HELP3 ;EP
"RTN","BILETVW2",144,0)
 ;;Enter YES to have the patient's Immunization Forecast appear between
"RTN","BILETVW2",145,0)
 ;;the middle and bottom sections of the Form Letter.
"RTN","BILETVW2",146,0)
 D HELPTX("HELP3",5)
"RTN","BILETVW2",147,0)
 Q
"RTN","BILETVW2",148,0)
 ;
"RTN","BILETVW2",149,0)
 ;
"RTN","BILETVW2",150,0)
 ;----------
"RTN","BILETVW2",151,0)
DATELOC ;EP
"RTN","BILETVW2",152,0)
 ;---> Add/Remove Date/Location to/from a Form Letter.
"RTN","BILETVW2",153,0)
 ;---> Variables:
"RTN","BILETVW2",154,0)
 ;     1 - BIIEN  (req) IEN of the BI LETTER entry being edited.
"RTN","BILETVW2",155,0)
 ;
"RTN","BILETVW2",156,0)
 ;---> Steps:
"RTN","BILETVW2",157,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETVW2",158,0)
 ;               BI LETTER DATE/LOCATION, an action on the Listmanager
"RTN","BILETVW2",159,0)
 ;               menu protocol: BI MENU LETTER FORM.
"RTN","BILETVW2",160,0)
 ;
"RTN","BILETVW2",161,0)
 Q:$$LETCHECK($G(BIIEN))
"RTN","BILETVW2",162,0)
 ;
"RTN","BILETVW2",163,0)
 N DIR,DIRUT
"RTN","BILETVW2",164,0)
 W !!!!,"   Include Date/Location for appointment in this Form Letter?"
"RTN","BILETVW2",165,0)
 S DIR(0)="YO",DIR("A")="   Enter Yes or No" D HELP4
"RTN","BILETVW2",166,0)
 D ^DIR
"RTN","BILETVW2",167,0)
 S:'$D(DIRUT) $P(^BILET(BIIEN,0),U,4)=+Y
"RTN","BILETVW2",168,0)
 D RESET^BILETVW
"RTN","BILETVW2",169,0)
 Q
"RTN","BILETVW2",170,0)
 ;
"RTN","BILETVW2",171,0)
 ;
"RTN","BILETVW2",172,0)
 ;----------
"RTN","BILETVW2",173,0)
HELP4 ;EP
"RTN","BILETVW2",174,0)
 ;;Enter YES to have the Date and Location for an appointment appear
"RTN","BILETVW2",175,0)
 ;;between the bottom and closing sections of the Form Letter.
"RTN","BILETVW2",176,0)
 D HELPTX("HELP4",5)
"RTN","BILETVW2",177,0)
 Q
"RTN","BILETVW2",178,0)
 ;
"RTN","BILETVW2",179,0)
 ;
"RTN","BILETVW2",180,0)
 ;----------
"RTN","BILETVW2",181,0)
PRINTSAM ;EP
"RTN","BILETVW2",182,0)
 ;---> Print a sample of a Form Letter.
"RTN","BILETVW2",183,0)
 ;---> Variables:
"RTN","BILETVW2",184,0)
 ;     1 - BIIEN  (req) IEN of the BI LETTER entry being edited.
"RTN","BILETVW2",185,0)
 ;
"RTN","BILETVW2",186,0)
 ;---> Steps:
"RTN","BILETVW2",187,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETVW2",188,0)
 ;               BI LETTER PRINT SAMPLE, an action on the Listmanager
"RTN","BILETVW2",189,0)
 ;               menu protocol: BI MENU LETTER FORM.
"RTN","BILETVW2",190,0)
 ;
"RTN","BILETVW2",191,0)
 Q:$$LETCHECK($G(BIIEN))
"RTN","BILETVW2",192,0)
 ;
"RTN","BILETVW2",193,0)
 ;---> Print sample letters for individual patient.
"RTN","BILETVW2",194,0)
 D
"RTN","BILETVW2",195,0)
 .D FULL^VALM1 S BIPOP=0 N BIDFN
"RTN","BILETVW2",196,0)
 .D TITLE^BIUTL5("PRINT SAMPLE LETTER")
"RTN","BILETVW2",197,0)
 .D PATLKUP^BIUTL8(.BIDFN)
"RTN","BILETVW2",198,0)
 .Q:BIDFN<1
"RTN","BILETVW2",199,0)
 .D ASKDLOC^BILETPR(BIIEN,.BIDLOC,.BIPOP) Q:BIPOP
"RTN","BILETVW2",200,0)
 .D DEVICE^BILETPR Q:BIPOP
"RTN","BILETVW2",201,0)
 .D PRINT^BILETPR(BIDFN,BIIEN,$G(BIDLOC),ION)
"RTN","BILETVW2",202,0)
 .D ^%ZISC
"RTN","BILETVW2",203,0)
 ;
"RTN","BILETVW2",204,0)
 D RESET^BILETVW
"RTN","BILETVW2",205,0)
 Q
"RTN","BILETVW2",206,0)
 ;
"RTN","BILETVW2",207,0)
 ;
"RTN","BILETVW2",208,0)
 ;----------
"RTN","BILETVW2",209,0)
LETCHECK(BIIEN) ;EP
"RTN","BILETVW2",210,0)
 ;---> If BIIEN not supplied, set Error Code and quit.
"RTN","BILETVW2",211,0)
 I '$G(BIIEN) D ERRCD^BIUTL2(609,,1) Q 1
"RTN","BILETVW2",212,0)
 I '$D(^BILET(BIIEN,0)) D ERRCD^BIUTL2(610,,1) Q 1
"RTN","BILETVW2",213,0)
 Q 0
"RTN","BILETVW2",214,0)
 ;
"RTN","BILETVW2",215,0)
 ;
"RTN","BILETVW2",216,0)
 ;----------
"RTN","BILETVW2",217,0)
ADDNEW(BIIEN) ;EP
"RTN","BILETVW2",218,0)
 ;---> Copy the Generic Sample Letter to this new Form Letter.
"RTN","BILETVW2",219,0)
 ;---> Parameters:
"RTN","BILETVW2",220,0)
 ;     1 - BIIEN (req) IEN of new Form Letter.
"RTN","BILETVW2",221,0)
 ;               (ret) BIIEN="" if Sample Form Letter not chosen.
"RTN","BILETVW2",222,0)
 ;
"RTN","BILETVW2",223,0)
 I '$G(BIIEN) D ERRCD^BIUTL2(609,,1) Q
"RTN","BILETVW2",224,0)
 ;
"RTN","BILETVW2",225,0)
 D TITLE^BIUTL5("ADD A NEW FORM LETTER"),TEXT1
"RTN","BILETVW2",226,0)
 N BIACT,BISIEN,DIR
"RTN","BILETVW2",227,0)
 ;
"RTN","BILETVW2",228,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BILETVW2",229,0)
 ;---> New feature to allow copying of existing Form Letter.
"RTN","BILETVW2",230,0)
 ;S DIR("A")="     Enter 1, 2, or 3: ",DIR("B")=1
"RTN","BILETVW2",231,0)
 S DIR("A")="     Enter 1, 2, 3, or C: "
"RTN","BILETVW2",232,0)
 S DIR(0)="SAM^1:Standard Due Letter;2:Official Immunization Record"
"RTN","BILETVW2",233,0)
 S DIR(0)=DIR(0)_";3:Standard Due Letter, Forecast First"
"RTN","BILETVW2",234,0)
 S DIR(0)=DIR(0)_";C:Copy Existing Form Letter"
"RTN","BILETVW2",235,0)
 D ^DIR K DIR
"RTN","BILETVW2",236,0)
 ;---> If user backed out, delete new letter and quit.
"RTN","BILETVW2",237,0)
 I ($D(DIRUT)!(Y=-1)) D  Q
"RTN","BILETVW2",238,0)
 .N DA,DIK S DA=BIIEN,DIK="^BILET(" D ^DIK S BIIEN=""
"RTN","BILETVW2",239,0)
 .W !!?5,"New Form Letter not added."  D DIRZ^BIUTL3()
"RTN","BILETVW2",240,0)
 ;
"RTN","BILETVW2",241,0)
 ;---> If copy existing, do so and quit.
"RTN","BILETVW2",242,0)
 I Y="C" D COPYEX(.BIIEN,.Y) Q
"RTN","BILETVW2",243,0)
 ;**********
"RTN","BILETVW2",244,0)
 ;
"RTN","BILETVW2",245,0)
 S BISIEN=+Y
"RTN","BILETVW2",246,0)
 N I
"RTN","BILETVW2",247,0)
 F I=1:1:4 D
"RTN","BILETVW2",248,0)
 .Q:'$D(^BILETS(BISIEN,I,0))
"RTN","BILETVW2",249,0)
 .S ^BILET(BIIEN,I,0)=^BILETS(BISIEN,I,0)
"RTN","BILETVW2",250,0)
 .N N S N=0
"RTN","BILETVW2",251,0)
 .F  S N=$O(^BILETS(BISIEN,I,N)) Q:'N  D
"RTN","BILETVW2",252,0)
 ..S ^BILET(BIIEN,I,N,0)=^BILETS(BISIEN,I,N,0)
"RTN","BILETVW2",253,0)
 ;
"RTN","BILETVW2",254,0)
 F I=2,3,4,6 S $P(^BILET(BIIEN,0),U,I)=$P(^BILETS(BISIEN,0),U,I)
"RTN","BILETVW2",255,0)
 Q
"RTN","BILETVW2",256,0)
 ;
"RTN","BILETVW2",257,0)
 ;
"RTN","BILETVW2",258,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BILETVW2",259,0)
 ;---> New feature to allow copying of existing Form Letter.
"RTN","BILETVW2",260,0)
 ;----------
"RTN","BILETVW2",261,0)
COPYEX(BIIEN,Y) ;EP
"RTN","BILETVW2",262,0)
 ;---> Copy existing Form Letter.
"RTN","BILETVW2",263,0)
 ;---> Parameters:
"RTN","BILETVW2",264,0)
 ;     1 - BIIEN (req) IEN of new Form Letter.
"RTN","BILETVW2",265,0)
 ;
"RTN","BILETVW2",266,0)
 D TITLE^BIUTL5("ADD A NEW FORM LETTER")
"RTN","BILETVW2",267,0)
 W !!?5,"You have chosen to copy an existing Form Letter to your new Form Letter."
"RTN","BILETVW2",268,0)
 W !?5,"Please select the existing Form Letter you wish to copy.",!
"RTN","BILETVW2",269,0)
 D DIC^BIFMAN(9002084.4,"QEMA",.Y,"     Select Form Letter: ")
"RTN","BILETVW2",270,0)
 I ($D(DIRUT)!(Y=-1)) D  Q
"RTN","BILETVW2",271,0)
 .N DA,DIK S DA=BIIEN,DIK="^BILET(" D ^DIK S BIIEN=""
"RTN","BILETVW2",272,0)
 .W !!?5,"New Form Letter not added."  D DIRZ^BIUTL3()
"RTN","BILETVW2",273,0)
 S BISIEN=+Y
"RTN","BILETVW2",274,0)
 N I
"RTN","BILETVW2",275,0)
 F I=1:1:4 D
"RTN","BILETVW2",276,0)
 .Q:'$D(^BILET(BISIEN,I,0))
"RTN","BILETVW2",277,0)
 .S ^BILET(BIIEN,I,0)=^BILET(BISIEN,I,0)
"RTN","BILETVW2",278,0)
 .N N S N=0
"RTN","BILETVW2",279,0)
 .F  S N=$O(^BILET(BISIEN,I,N)) Q:'N  D
"RTN","BILETVW2",280,0)
 ..S ^BILET(BIIEN,I,N,0)=^BILET(BISIEN,I,N,0)
"RTN","BILETVW2",281,0)
 ;
"RTN","BILETVW2",282,0)
 F I=2,3,4,6 S $P(^BILET(BIIEN,0),U,I)=$P(^BILET(BISIEN,0),U,I)
"RTN","BILETVW2",283,0)
 Q
"RTN","BILETVW2",284,0)
 ;**********
"RTN","BILETVW2",285,0)
 ;
"RTN","BILETVW2",286,0)
 ;
"RTN","BILETVW2",287,0)
 ;----------
"RTN","BILETVW2",288,0)
TEXT1 ;EP
"RTN","BILETVW2",289,0)
 ;;You have chosen to add a new Form Letter.
"RTN","BILETVW2",290,0)
 ;;In order to save you time, this program will load a Sample Form Letter,
"RTN","BILETVW2",291,0)
 ;;which you may then edit to suit the purpose of your new Form Letter.
"RTN","BILETVW2",292,0)
 ;;
"RTN","BILETVW2",293,0)
 ;;There are three Sample Form Letters to choose from:
"RTN","BILETVW2",294,0)
 ;;
"RTN","BILETVW2",295,0)
 ;;   1) Standard Due Letter
"RTN","BILETVW2",296,0)
 ;;   2) Official Immunization Record
"RTN","BILETVW2",297,0)
 ;;   3) Standard Due Letter--Forecast First
"RTN","BILETVW2",298,0)
 ;;
"RTN","BILETVW2",299,0)
 ;;Or you may choose to copy an existing customized Form Letter and
"RTN","BILETVW2",300,0)
 ;;then make changes to it under the new Form Letter you are creating.
"RTN","BILETVW2",301,0)
 ;;
"RTN","BILETVW2",302,0)
 ;;Please enter "1" to select the Standard Due Letter, "2" to select
"RTN","BILETVW2",303,0)
 ;;the Official Immunization Record, "3" to select the Standard Due
"RTN","BILETVW2",304,0)
 ;;Letter (with the Forecast listed first and the History following),
"RTN","BILETVW2",305,0)
 ;;or enter "C" to copy an existing Form Letter.
"RTN","BILETVW2",306,0)
 ;;
"RTN","BILETVW2",307,0)
 ;
"RTN","BILETVW2",308,0)
 D PRINTX("TEXT1")
"RTN","BILETVW2",309,0)
 Q
"RTN","BILETVW2",310,0)
 ;
"RTN","BILETVW2",311,0)
 ;
"RTN","BILETVW2",312,0)
 ;----------
"RTN","BILETVW2",313,0)
DELETLET ;EP
"RTN","BILETVW2",314,0)
 ;---> Delete a Form Letter.
"RTN","BILETVW2",315,0)
 ;---> Variables:
"RTN","BILETVW2",316,0)
 ;     1 - BIIEN  (req) IEN of the BI LETTER entry being deleted.
"RTN","BILETVW2",317,0)
 ;
"RTN","BILETVW2",318,0)
 ;---> Steps:
"RTN","BILETVW2",319,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILETVW2",320,0)
 ;               BI LETTER DELETE, an action on the Listmanager
"RTN","BILETVW2",321,0)
 ;               menu protocol: BI MENU LETTER FORM.
"RTN","BILETVW2",322,0)
 ;
"RTN","BILETVW2",323,0)
 Q:$$LETCHECK($G(BIIEN))
"RTN","BILETVW2",324,0)
 ;
"RTN","BILETVW2",325,0)
 N DIR,DIRUT
"RTN","BILETVW2",326,0)
 W !!!!,"   Are you sure you want to DELETE this entire Form Letter?"
"RTN","BILETVW2",327,0)
 S DIR(0)="YO",DIR("A")="   Enter Yes or No",DIR("B")="NO" D HELP5
"RTN","BILETVW2",328,0)
 D ^DIR
"RTN","BILETVW2",329,0)
 I $D(DIRUT)!('Y) D RESET^BILETVW Q
"RTN","BILETVW2",330,0)
 ;
"RTN","BILETVW2",331,0)
 ;---> Delete Form Letter.
"RTN","BILETVW2",332,0)
 N DA,DIK S DA=BIIEN,DIK="^BILET(" D ^DIK
"RTN","BILETVW2",333,0)
 ;
"RTN","BILETVW2",334,0)
 ;---> If a Site Parameter points to this entry, delete it.
"RTN","BILETVW2",335,0)
 N N S N=0
"RTN","BILETVW2",336,0)
 F  S N=$O(^BISITE(N)) Q:'N  D
"RTN","BILETVW2",337,0)
 .S:$P(^BISITE(N,0),U,4)=BIIEN $P(^BISITE(N,0),U,4)=""
"RTN","BILETVW2",338,0)
 .S:$P(^BISITE(N,0),U,13)=BIIEN $P(^BISITE(N,0),U,13)=""
"RTN","BILETVW2",339,0)
 ;
"RTN","BILETVW2",340,0)
 S VALMQUIT="" Q
"RTN","BILETVW2",341,0)
 Q
"RTN","BILETVW2",342,0)
 ;
"RTN","BILETVW2",343,0)
 ;
"RTN","BILETVW2",344,0)
 ;----------
"RTN","BILETVW2",345,0)
HELP5 ;EP
"RTN","BILETVW2",346,0)
 ;;If you enter YES, this Form Letter will be deleted and no longer
"RTN","BILETVW2",347,0)
 ;;available for editing or sending to patients."
"RTN","BILETVW2",348,0)
 D HELPTX("HELP5",5)
"RTN","BILETVW2",349,0)
 Q
"RTN","BILETVW2",350,0)
 ;
"RTN","BILETVW2",351,0)
 ;
"RTN","BILETVW2",352,0)
 ;----------
"RTN","BILETVW2",353,0)
HELPTX(BILINL,BITAB) ;
"RTN","BILETVW2",354,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILETVW2",355,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BILETVW2",356,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BILETVW2",357,0)
 Q
"RTN","BILETVW2",358,0)
 ;
"RTN","BILETVW2",359,0)
 ;
"RTN","BILETVW2",360,0)
 ;----------
"RTN","BILETVW2",361,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILETVW2",362,0)
 Q:$G(BILINL)=""
"RTN","BILETVW2",363,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILETVW2",364,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BILETVW2",365,0)
 Q
"RTN","BILOGO")
0^50^B23635240
"RTN","BILOGO",1,0)
BILOGO ;IHS/CMI/MWR - DISPLAY LOGO WHRN ENTERING PKG; OCT 15, 2010
"RTN","BILOGO",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BILOGO",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILOGO",4,0)
 ;;  DISPLAYS LOGO.  GETS VERSION FROM LINE 2 OF THIS ROUTINE.
"RTN","BILOGO",5,0)
 ;
"RTN","BILOGO",6,0)
 D SETVARS^BIUTL5
"RTN","BILOGO",7,0)
 ;---> Set Imm Package Version Number.
"RTN","BILOGO",8,0)
 S BIVER=$$VER
"RTN","BILOGO",9,0)
 ;
"RTN","BILOGO",10,0)
 W @IOF
"RTN","BILOGO",11,0)
 W !?13,"     .. --- ..         *     *         .. --- .."
"RTN","BILOGO",12,0)
 W !?13,"   *          ~ *.      \   /      .* ~          *"
"RTN","BILOGO",13,0)
 W !?13," *                *      \ /      *                *"
"RTN","BILOGO",14,0)
 W !?13,"(         RPMS      *    (|)    *     Version       )"
"RTN","BILOGO",15,0)
 W !?13," *    IMMUNIZATION    *  ***  *         "
"RTN","BILOGO",16,0)
 W $$PAD^BIUTL5($$VER,11),"*"
"RTN","BILOGO",17,0)
 W !?13,"   *.                   *   *                   .*"
"RTN","BILOGO",18,0)
 W !?13,"      *                *     *                *"
"RTN","BILOGO",19,0)
 W !?13,"        >              *     *              <"
"RTN","BILOGO",20,0)
 W !?13,"       *                *   *                *"
"RTN","BILOGO",21,0)
 W !?13,"     *               * *     * *               *"
"RTN","BILOGO",22,0)
 W !?13,"    *     @        *   *     *   *        @     *"
"RTN","BILOGO",23,0)
 W !?13,"   (             *      *   *      *             )"
"RTN","BILOGO",24,0)
 W !?13,"    *.        *          ***          *        .*"
"RTN","BILOGO",25,0)
 W !?13,"      / /-- ~             ~             ~ --\ \"
"RTN","BILOGO",26,0)
 N X S X="MAIN MENU at "_$P(^DIC(4,DUZ(2),0),U)
"RTN","BILOGO",27,0)
 D CENTERT^BIUTL5(.X)
"RTN","BILOGO",28,0)
 W !!,X
"RTN","BILOGO",29,0)
 Q
"RTN","BILOGO",30,0)
 ;
"RTN","BILOGO",31,0)
 ;
"RTN","BILOGO",32,0)
 ;----------
"RTN","BILOGO",33,0)
CHECK ;EP
"RTN","BILOGO",34,0)
 ;---> Check User's DUZ(2), BI SITE PARAMETER File for this site,
"RTN","BILOGO",35,0)
 ;---> and Standard Vaccine Table (IMMUNIZATION File).
"RTN","BILOGO",36,0)
 ;---> Called by ENTRY ACTION of Option BIMENU.
"RTN","BILOGO",37,0)
 ;
"RTN","BILOGO",38,0)
 ;---> Set Imm Package Version Number.
"RTN","BILOGO",39,0)
 S BIVER=$$VER
"RTN","BILOGO",40,0)
 ;
"RTN","BILOGO",41,0)
 ;---> User's DUZ(2) undefined.
"RTN","BILOGO",42,0)
 I '$G(DUZ(2)) D  Q
"RTN","BILOGO",43,0)
 .D WARN
"RTN","BILOGO",44,0)
 .W !?5,"Your DUZ(2) variable is not defined.",!
"RTN","BILOGO",45,0)
 .D TEXT1
"RTN","BILOGO",46,0)
 .D DIRZ^BIUTL3()
"RTN","BILOGO",47,0)
 ;
"RTN","BILOGO",48,0)
 ;
"RTN","BILOGO",49,0)
 ;---> BI SITE PARAMETER File not set up for this Site (DUZ(2)).
"RTN","BILOGO",50,0)
 I '$D(^BISITE(DUZ(2),0)) D  Q
"RTN","BILOGO",51,0)
 .D WARN
"RTN","BILOGO",52,0)
 .W !?5,"Immunization Site Parameters have NOT been set for the site"
"RTN","BILOGO",53,0)
 .W !?5,"you are logged on as: ",$P(^DIC(4,DUZ(2),0),U),!
"RTN","BILOGO",54,0)
 .D TEXT1
"RTN","BILOGO",55,0)
 .D:$$MAYMANAG^BIUTL11() TEXT2
"RTN","BILOGO",56,0)
 .D DIRZ^BIUTL3()
"RTN","BILOGO",57,0)
 ;
"RTN","BILOGO",58,0)
 ;
"RTN","BILOGO",59,0)
 ;---> Check for valid Immserve Forecasting Rules choice.
"RTN","BILOGO",60,0)
 ;---> If not a current, valid choice "IHS_1m18" will be used at RULES+6^BIUTL2.
"RTN","BILOGO",61,0)
 ;
"RTN","BILOGO",62,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BILOGO",63,0)
 ;---> Immserve Rule Set no longer relevant.
"RTN","BILOGO",64,0)
 ;D:'$$VALIDRUL^BIUTL2(DUZ(2))
"RTN","BILOGO",65,0)
 ;.D WARN
"RTN","BILOGO",66,0)
 ;.W !?5,"The ImmServe Forecasting site parameter is not currently set to"
"RTN","BILOGO",67,0)
 ;.W !?5,"a valid choice for the site you are logged on to: "
"RTN","BILOGO",68,0)
 ;.W !?5,$P(^DIC(4,DUZ(2),0),U),!
"RTN","BILOGO",69,0)
 ;.I $$MAYMANAG^BIUTL11() D TEXT4,DIRZ^BIUTL3() Q
"RTN","BILOGO",70,0)
 ;.D TEXT5,DIRZ^BIUTL3()
"RTN","BILOGO",71,0)
 ;
"RTN","BILOGO",72,0)
 ;
"RTN","BILOGO",73,0)
 ;---> Vaccine Table (^AUTTIMM global) not standard.
"RTN","BILOGO",74,0)
 D CHKSTAND^BIRESTD(.BIERROR)
"RTN","BILOGO",75,0)
 Q:$G(BIERROR)=""
"RTN","BILOGO",76,0)
 D WARN W !!?5,BIERROR,!
"RTN","BILOGO",77,0)
 D TEXT1
"RTN","BILOGO",78,0)
 D:$D(^XUSEC("BIZ MANAGER",$G(DUZ))) TEXT3
"RTN","BILOGO",79,0)
 D DIRZ^BIUTL3()
"RTN","BILOGO",80,0)
 Q
"RTN","BILOGO",81,0)
 ;
"RTN","BILOGO",82,0)
 ;
"RTN","BILOGO",83,0)
 ;----------
"RTN","BILOGO",84,0)
WARN ;EP
"RTN","BILOGO",85,0)
 W:$D(IOF) @IOF
"RTN","BILOGO",86,0)
 W " "_$$LMVER,!!?35,"WARNING",!?34,"---------",!!
"RTN","BILOGO",87,0)
 Q
"RTN","BILOGO",88,0)
 ;
"RTN","BILOGO",89,0)
 ;
"RTN","BILOGO",90,0)
 ;----------
"RTN","BILOGO",91,0)
TEXT1 ;EP
"RTN","BILOGO",92,0)
 ;;At this point you should back out of the Immunization Package
"RTN","BILOGO",93,0)
 ;;and contact your site manager or the person in charge of the
"RTN","BILOGO",94,0)
 ;;Immunization Software.
"RTN","BILOGO",95,0)
 ;;
"RTN","BILOGO",96,0)
 D PRINTX("TEXT1",5)
"RTN","BILOGO",97,0)
 Q
"RTN","BILOGO",98,0)
 ;
"RTN","BILOGO",99,0)
 ;
"RTN","BILOGO",100,0)
 ;----------
"RTN","BILOGO",101,0)
TEXT2 ;EP
"RTN","BILOGO",102,0)
 ;;Or, if you wish to set up Site Parameters for this site,
"RTN","BILOGO",103,0)
 ;;you may proceed to the Edit Site Parameters option and enter
"RTN","BILOGO",104,0)
 ;;parameters for this site.  (Menu Synonyms: MGR-->ESP)
"RTN","BILOGO",105,0)
 ;;
"RTN","BILOGO",106,0)
 D PRINTX("TEXT2",5)
"RTN","BILOGO",107,0)
 Q
"RTN","BILOGO",108,0)
 ;
"RTN","BILOGO",109,0)
 ;
"RTN","BILOGO",110,0)
 ;----------
"RTN","BILOGO",111,0)
TEXT3 ;EP
"RTN","BILOGO",112,0)
 ;;Or, you may fix this by Restandardizing the Immunization File.
"RTN","BILOGO",113,0)
 ;;To do so, proceed to the Manager Menu and select Restandardize.
"RTN","BILOGO",114,0)
 ;;(Menu Synonyms: MGR-->RES)
"RTN","BILOGO",115,0)
 ;;
"RTN","BILOGO",116,0)
 D PRINTX("TEXT3",5)
"RTN","BILOGO",117,0)
 Q
"RTN","BILOGO",118,0)
 ;
"RTN","BILOGO",119,0)
 ;
"RTN","BILOGO",120,0)
 ;----------
"RTN","BILOGO",121,0)
TEXT4 ;EP
"RTN","BILOGO",122,0)
 ;;To correct this problem, go to the Manager Menu, select the
"RTN","BILOGO",123,0)
 ;;option "ESP  Site Parameters Edit" and choose parameter 9,
"RTN","BILOGO",124,0)
 ;;"Immserve Forecasting Option," then select the Immserve option
"RTN","BILOGO",125,0)
 ;;that is most appropriate for your site.
"RTN","BILOGO",126,0)
 ;;(Menu Path: IMM-->MGR-->ESP-->9)
"RTN","BILOGO",127,0)
 ;;
"RTN","BILOGO",128,0)
 ;;Until that parameter is set correctly, forecasting will default
"RTN","BILOGO",129,0)
 ;;to Immserve Option #1.
"RTN","BILOGO",130,0)
 ;;
"RTN","BILOGO",131,0)
 D PRINTX("TEXT4",5)
"RTN","BILOGO",132,0)
 Q
"RTN","BILOGO",133,0)
 ;
"RTN","BILOGO",134,0)
 ;
"RTN","BILOGO",135,0)
 ;----------
"RTN","BILOGO",136,0)
TEXT5 ;EP
"RTN","BILOGO",137,0)
 ;;To correct this problem, notify your immunization coordinator or
"RTN","BILOGO",138,0)
 ;;site manager that this site parameter needs attention.
"RTN","BILOGO",139,0)
 ;;
"RTN","BILOGO",140,0)
 ;;Until that parameter is set correctly, forecasting will default
"RTN","BILOGO",141,0)
 ;;to Immserve Option #1.
"RTN","BILOGO",142,0)
 ;;
"RTN","BILOGO",143,0)
 D PRINTX("TEXT5",5)
"RTN","BILOGO",144,0)
 Q
"RTN","BILOGO",145,0)
 ;
"RTN","BILOGO",146,0)
 ;
"RTN","BILOGO",147,0)
 ;----------
"RTN","BILOGO",148,0)
VER() ;PEP - Return Version# and Patch Level (if any).
"RTN","BILOGO",149,0)
 ;
"RTN","BILOGO",150,0)
 N X,Y,Z
"RTN","BILOGO",151,0)
 S X=$P($T(BILOGO+1),";;",2)
"RTN","BILOGO",152,0)
 S Y=$P(X,";")
"RTN","BILOGO",153,0)
 S Z=$P(X,";",3)
"RTN","BILOGO",154,0)
 ;---> If no patch level, return version# and quit.
"RTN","BILOGO",155,0)
 Q:Z="" Y
"RTN","BILOGO",156,0)
 S Z=$TR(Z,"*","")
"RTN","BILOGO",157,0)
 Q Y_"*"_$P(Z,",",$L(Z,","))
"RTN","BILOGO",158,0)
 ;
"RTN","BILOGO",159,0)
 ;
"RTN","BILOGO",160,0)
 ;----------
"RTN","BILOGO",161,0)
LMVER() ;EP
"RTN","BILOGO",162,0)
 ;---> Return "Immunization"_version# for Listman screens,
"RTN","BILOGO",163,0)
 ;---> displayed in top left corner.
"RTN","BILOGO",164,0)
 ;
"RTN","BILOGO",165,0)
 Q " Immunization v"_$$VER
"RTN","BILOGO",166,0)
 ;
"RTN","BILOGO",167,0)
 ;
"RTN","BILOGO",168,0)
 ;----------
"RTN","BILOGO",169,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILOGO",170,0)
 ;---> Print text at specified line label.
"RTN","BILOGO",171,0)
 ;
"RTN","BILOGO",172,0)
 Q:$G(BILINL)=""
"RTN","BILOGO",173,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILOGO",174,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BILOGO",175,0)
 Q
"RTN","BILOT")
0^51^B159288316
"RTN","BILOT",1,0)
BILOT ;IHS/CMI/MWR - EDIT LOT NUMBERS.; MAY 10, 2010
"RTN","BILOT",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BILOT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILOT",4,0)
 ;;  EDIT LOT NUMBER FIELDS.
"RTN","BILOT",5,0)
 ;   PATCH 2: Redisplay Message area (with # of Lots) in List Template. HELP1+5
"RTN","BILOT",6,0)
 ;   PATCH 9: Removed until perhaps Patch 10.  Update help text.  HELP+5
"RTN","BILOT",7,0)
 ;
"RTN","BILOT",8,0)
 ;
"RTN","BILOT",9,0)
 ;
"RTN","BILOT",10,0)
 ;----------
"RTN","BILOT",11,0)
START ;EP
"RTN","BILOT",12,0)
 ;---> Lookup Lot Numbers and edit their fields.  vvv83
"RTN","BILOT",13,0)
 D SETVARS^BIUTL5 K ^TMP("BILOT",$J) N BICOLL,BISUBT,BITMP,BIINACT
"RTN","BILOT",14,0)
 S BISUBT="1:Unused Doses;2:Expiration Date;3:Lot Number"
"RTN","BILOT",15,0)
 S BISUBT=BISUBT_";4:Vaccine Name, then by Unused Doses"
"RTN","BILOT",16,0)
 S BISUBT=BISUBT_";5:Vaccine Name, then by Exp Date"
"RTN","BILOT",17,0)
 S BISUBT=BISUBT_";6:Vaccine Name, then by Lot Number"
"RTN","BILOT",18,0)
 ;
"RTN","BILOT",19,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BILOT",20,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BILOT",21,0)
 ;
"RTN","BILOT",22,0)
 D EN
"RTN","BILOT",23,0)
 D EXIT
"RTN","BILOT",24,0)
 Q
"RTN","BILOT",25,0)
 ;
"RTN","BILOT",26,0)
 ;
"RTN","BILOT",27,0)
 ;----------
"RTN","BILOT",28,0)
EN ;EP
"RTN","BILOT",29,0)
 D EN^VALM("BI LOT TABLE EDIT")
"RTN","BILOT",30,0)
 Q
"RTN","BILOT",31,0)
 ;
"RTN","BILOT",32,0)
 ;
"RTN","BILOT",33,0)
 ;----------
"RTN","BILOT",34,0)
PRINT ;EP
"RTN","BILOT",35,0)
 ;---> Print Lot Number Table.
"RTN","BILOT",36,0)
 ;---> Called by Protocol BI LOT NUMBER TABLE PRINT, which is the
"RTN","BILOT",37,0)
 ;---> Print List Protocol for the List: BI LOT NUMBER TABLE EDIT.
"RTN","BILOT",38,0)
 ;
"RTN","BILOT",39,0)
 D DEVICE(.BIPOP)
"RTN","BILOT",40,0)
 I $G(BIPOP) D RESET Q
"RTN","BILOT",41,0)
 ;
"RTN","BILOT",42,0)
 D HDR(1),INIT^BILOT1
"RTN","BILOT",43,0)
 D PRTLST^BIUTL8("BILOT")
"RTN","BILOT",44,0)
 D RESET
"RTN","BILOT",45,0)
 Q
"RTN","BILOT",46,0)
 ;
"RTN","BILOT",47,0)
 ;
"RTN","BILOT",48,0)
 ;----------
"RTN","BILOT",49,0)
HDR(BIPRT) ;EP
"RTN","BILOT",50,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BILOT",51,0)
 ;---> Parameters:
"RTN","BILOT",52,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Change column
"RTN","BILOT",53,0)
 ;                      header line and add Site Header line.
"RTN","BILOT",54,0)
 ;
"RTN","BILOT",55,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BILOT",56,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BILOT",57,0)
 ;
"RTN","BILOT",58,0)
 D WH^BIW(.BILINE)
"RTN","BILOT",59,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BILOT",60,0)
 D WH^BIW(.BILINE,X)
"RTN","BILOT",61,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BILOT",62,0)
 D WH^BIW(.BILINE,X)
"RTN","BILOT",63,0)
 ;
"RTN","BILOT",64,0)
 S X="LOT NUMBER TABLE" S:'$G(BIPRT) X="EDIT "_X
"RTN","BILOT",65,0)
 D CENTERT^BIUTL5(.X)
"RTN","BILOT",66,0)
 S:BICRT X=IOINHI_X_IOINORM
"RTN","BILOT",67,0)
 D WH^BIW(.BILINE,X)
"RTN","BILOT",68,0)
 ;
"RTN","BILOT",69,0)
 ;---> Subtitle: indicate order of listing.
"RTN","BILOT",70,0)
 D:($G(BICOLL)&$D(BISUBT))
"RTN","BILOT",71,0)
 .N Y S Y=$P($P(BISUBT,BICOLL_":",2),";") S X=" (Listed by "_Y_")"
"RTN","BILOT",72,0)
 .D CENTERT^BIUTL5(.X) S:BICRT X=IOINHI_X_IOINORM D WH^BIW(.BILINE,X)
"RTN","BILOT",73,0)
 ;
"RTN","BILOT",74,0)
 D:$G(BIPRT)
"RTN","BILOT",75,0)
 .S X=$$SP^BIUTL5(51)_"Printed: "_$$NOW^BIUTL5()
"RTN","BILOT",76,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BILOT",77,0)
 .S X="  #  Lot Number            Vaccine     Status  Exp Date  Start Unused  Facility"
"RTN","BILOT",78,0)
 .D WH^BIW(.BILINE,X)
"RTN","BILOT",79,0)
 Q
"RTN","BILOT",80,0)
 ;
"RTN","BILOT",81,0)
 ;
"RTN","BILOT",82,0)
 ;----------
"RTN","BILOT",83,0)
INIT ;EP
"RTN","BILOT",84,0)
 ;---> Initialize variables and list array.
"RTN","BILOT",85,0)
 D INIT^BILOT1
"RTN","BILOT",86,0)
 Q
"RTN","BILOT",87,0)
 ;
"RTN","BILOT",88,0)
 ;
"RTN","BILOT",89,0)
 ;----------
"RTN","BILOT",90,0)
RESET ;EP
"RTN","BILOT",91,0)
 ;---> Update partition for return to Listmanager.
"RTN","BILOT",92,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BILOT",93,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BILOT",94,0)
 D INIT,HDR() Q
"RTN","BILOT",95,0)
 ;
"RTN","BILOT",96,0)
 ;
"RTN","BILOT",97,0)
 ;----------
"RTN","BILOT",98,0)
DEVICE(BIPOP) ;EP
"RTN","BILOT",99,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BILOT",100,0)
 ;---> Parameters:
"RTN","BILOT",101,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BILOT",102,0)
 ;
"RTN","BILOT",103,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BILOT",104,0)
 S ZTRTN="DEQUEUE^BILOT"
"RTN","BILOT",105,0)
 D ZSAVES^BIUTL3
"RTN","BILOT",106,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BILOT",107,0)
 Q
"RTN","BILOT",108,0)
 ;
"RTN","BILOT",109,0)
 ;
"RTN","BILOT",110,0)
 ;----------
"RTN","BILOT",111,0)
DEQUEUE ;EP
"RTN","BILOT",112,0)
 ;---> Print Patient Data screen.
"RTN","BILOT",113,0)
 D HDR(1),INIT^BILOT1
"RTN","BILOT",114,0)
 D PRTLST^BIUTL8("BILOT"),EXIT
"RTN","BILOT",115,0)
 Q
"RTN","BILOT",116,0)
 ;
"RTN","BILOT",117,0)
 ;
"RTN","BILOT",118,0)
 ;----------
"RTN","BILOT",119,0)
HELP ;EP
"RTN","BILOT",120,0)
 ;---> Help code.
"RTN","BILOT",121,0)
 N BIX S BIX=X
"RTN","BILOT",122,0)
 D FULL^VALM1
"RTN","BILOT",123,0)
 W !!?5,"Enter ""A"" to add or edit a Lot Number, enter ""S"" to Select a Lot"
"RTN","BILOT",124,0)
 W !?5,"Number from the left column, enter ""C"" to change the order of the list,"
"RTN","BILOT",125,0)
 W !?5,"""S"" to Search for a particular Lot Number, ""D"" to include Inactive Lot"
"RTN","BILOT",126,0)
 W !?5,"enter ""I"" to Inactivate expired Lot Numbers, and enter ""H"" to view"
"RTN","BILOT",127,0)
 W !?5,"the full help text for the lot number list and its parameters."
"RTN","BILOT",128,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BILOT",129,0)
 D:BIX'="??" RE^VALM4
"RTN","BILOT",130,0)
 Q
"RTN","BILOT",131,0)
 ;
"RTN","BILOT",132,0)
 ;
"RTN","BILOT",133,0)
 ;----------
"RTN","BILOT",134,0)
HELPNEXT ;EP
"RTN","BILOT",135,0)
 ;
"RTN","BILOT",136,0)
 ;********** PATCH 10?, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BILOT",137,0)
 ;---> Requested removed from Patch 9 by Michelle Ruslavage. Possibly include
"RTN","BILOT",138,0)
 ;---> in next patch.
"RTN","BILOT",139,0)
 ;---> Update help text below to include new actions from patch.
"RTN","BILOT",140,0)
 ;---> Help code.
"RTN","BILOT",141,0)
 N BIX S BIX=X
"RTN","BILOT",142,0)
 D FULL^VALM1
"RTN","BILOT",143,0)
 W !!?5,"Enter ""A"" to add or edit a Lot Number, enter ""E"" to select and Edit a Lot"
"RTN","BILOT",144,0)
 W !?5,"Number from the left column, enter ""C"" to change the order of the list,"
"RTN","BILOT",145,0)
 W !?5,"""S"" to Search for a particular Lot Number, ""D"" to include Inactive Lot"
"RTN","BILOT",146,0)
 W !?5,"Numbers in the display (will appear after all Active Lot Numbers),"
"RTN","BILOT",147,0)
 W !?5,"enter ""I"" to Inactivate expired Lot Numbers, and enter ""H"" to view"
"RTN","BILOT",148,0)
 W !?5,"the full help text for the lot number list and its parameters."
"RTN","BILOT",149,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BILOT",150,0)
 D:BIX'="??" RE^VALM4
"RTN","BILOT",151,0)
 Q
"RTN","BILOT",152,0)
 ;**********
"RTN","BILOT",153,0)
 ;
"RTN","BILOT",154,0)
 ;
"RTN","BILOT",155,0)
 ;----------
"RTN","BILOT",156,0)
HELP1 ;EP
"RTN","BILOT",157,0)
 ;----> Explanation of this report.
"RTN","BILOT",158,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BILOT",159,0)
 D START^BIHELP("EDIT LOT NUMBERS - HELP",.BITEXT)
"RTN","BILOT",160,0)
 ;
"RTN","BILOT",161,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BILOT",162,0)
 ;---> Redisplay Message area (with number of Lots) in List Template.
"RTN","BILOT",163,0)
 D RESET^BILOT1
"RTN","BILOT",164,0)
 ;**********
"RTN","BILOT",165,0)
 Q
"RTN","BILOT",166,0)
 ;
"RTN","BILOT",167,0)
 ;   vvv83
"RTN","BILOT",168,0)
 ;----------
"RTN","BILOT",169,0)
TEXT1(BITEXT) ;EP
"RTN","BILOT",170,0)
 ;;
"RTN","BILOT",171,0)
 ;;This screen allows you to add and edit the eight fields of Lot Numbers.
"RTN","BILOT",172,0)
 ;;
"RTN","BILOT",173,0)
 ;;NOTE: To show INACTIVE Lot Numbers, select "D  Display Inactives."
"RTN","BILOT",174,0)
 ;;
"RTN","BILOT",175,0)
 ;;To Add a new Lot Number, type "A".  If the Lot Number already exists in
"RTN","BILOT",176,0)
 ;;the Table, a message will display, directIng you select that Lot Number
"RTN","BILOT",177,0)
 ;;for editing.
"RTN","BILOT",178,0)
 ;;
"RTN","BILOT",179,0)
 ;;To edit an existing Lot Number type "E" and then select the left column
"RTN","BILOT",180,0)
 ;;number that corresponds to the Lot Number you wish to edit.
"RTN","BILOT",181,0)
 ;;
"RTN","BILOT",182,0)
 ;;You may also SEARCH the entire list for any number, name, or combination
"RTN","BILOT",183,0)
 ;;of characters by usinng the "S Search List" action.
"RTN","BILOT",184,0)
 ;;
"RTN","BILOT",185,0)
 ;;You may list the Lots in a variety of manners by using the "C Change List"
"RTN","BILOT",186,0)
 ;;action.
"RTN","BILOT",187,0)
 ;;
"RTN","BILOT",188,0)
 ;;Lastly, you may automatically inactivate ALL Lot Numbers that either
"RTN","BILOT",189,0)
 ;;have expired or have no expiration date, by typing "I".
"RTN","BILOT",190,0)
 ;;
"RTN","BILOT",191,0)
 ;;The fields for each Lot Number are:
"RTN","BILOT",192,0)
 ;;
"RTN","BILOT",193,0)
 ;;Vaccine - This is the vaccine to which the Lot Number is assigned.
"RTN","BILOT",194,0)
 ;;     A Vaccine is REQUIRED when entering a New Lot Number.
"RTN","BILOT",195,0)
 ;;
"RTN","BILOT",196,0)
 ;;Manufacturer (MVX) - This is the standard CDC/HL7 Manufacturer Code
"RTN","BILOT",197,0)
 ;;     assigned to the company that produced the Lot.  Enter ?? in order
"RTN","BILOT",198,0)
 ;;     to view the entire Manufacturer Code list.
"RTN","BILOT",199,0)
 ;;     A Manufacturer is REQUIRED when entering a New Lot Number.
"RTN","BILOT",200,0)
 ;;
"RTN","BILOT",201,0)
 ;;Status - If a Lot Number is set to "Inactive", users will not be
"RTN","BILOT",202,0)
 ;;     able to select it when entering NEW patient immunizations for this.
"RTN","BILOT",203,0)
 ;;     vaccine.  However, previous immunizations with this Lot Number will
"RTN","BILOT",204,0)
 ;;     continue to show up on the patient histories.
"RTN","BILOT",205,0)
 ;;
"RTN","BILOT",206,0)
 ;;Source - Choice are VFC, Other State, or IHS/Tribal,.
"RTN","BILOT",207,0)
 ;;
"RTN","BILOT",208,0)
 ;;NDC Code - This is the NDC on the box or vial for this lot.  Available
"RTN","BILOT",209,0)
 ;;      NDC's are limited by virtue of the particular vaccine chosen for
"RTN","BILOT",210,0)
 ;;      this lot number.
"RTN","BILOT",211,0)
 ;;
"RTN","BILOT",212,0)
 ;;Expiration Date - This is the date that the Lot expires.
"RTN","BILOT",213,0)
 ;;
"RTN","BILOT",214,0)
 ;;Starting Count - Total number of doses in the starting inventory for
"RTN","BILOT",215,0)
 ;;    the Lot when it was first received.
"RTN","BILOT",216,0)
 ;;
"RTN","BILOT",217,0)
 ;;Doses Unused - Number of doses of a lot remaining or unused.
"RTN","BILOT",218,0)
 ;;    This number will decrease each time an immunization of that Lot Number
"RTN","BILOT",219,0)
 ;;    is entered into RPMS through the Immunization package or data entry.
"RTN","BILOT",220,0)
 ;;    The pharmacist or user can also reset this number if it becomes
"RTN","BILOT",221,0)
 ;;    incorrect, such as might occur with wasted doses, data entry errors,
"RTN","BILOT",222,0)
 ;;    etc.
"RTN","BILOT",223,0)
 ;;
"RTN","BILOT",224,0)
 ;;    NOTE: This number may become NEGATIVE.  A negative number for the
"RTN","BILOT",225,0)
 ;;    Doses Unused would indicate that deletions, data entry errors, or
"RTN","BILOT",226,0)
 ;;    testing have caused the number to become negative by mere subtraction
"RTN","BILOT",227,0)
 ;;    each time it is used in the computer--even if it has not actually
"RTN","BILOT",228,0)
 ;;    been used clinically.  Therefore, it is entirely appropriate for
"RTN","BILOT",229,0)
 ;;    the vaccine manager or pharmacist to correct the Doses Unused
"RTN","BILOT",230,0)
 ;;    in order to have it accurately reflect the number of doses that are
"RTN","BILOT",231,0)
 ;;    still unused in the inventory (in other words, sitting on the shelf).
"RTN","BILOT",232,0)
 ;;
"RTN","BILOT",233,0)
 ;;Doses Used - This is merely a the Doses Unused subtracted from the
"RTN","BILOT",234,0)
 ;;    Starting Count.
"RTN","BILOT",235,0)
 ;;
"RTN","BILOT",236,0)
 ;;Vaccine Source - VFC or non-VFC.  Note: If there are two issues of the
"RTN","BILOT",237,0)
 ;;    same lot, and one issue is VFC and the other is not VFC, it may
"RTN","BILOT",238,0)
 ;;    be helpful the create a new lot for the VFC issue and give it the
"RTN","BILOT",239,0)
 ;;    same lot number but append "-vfc" to the end.  This way, the two
"RTN","BILOT",240,0)
 ;;    issues can be tracked, inventoried, and reported on separately
"RTN","BILOT",241,0)
 ;;    (yet easily identified by the common, original lot number).
"RTN","BILOT",242,0)
 ;;
"RTN","BILOT",243,0)
 ;;Low Supply Alert - During entry of immunizations, if the number of Unused
"RTN","BILOT",244,0)
 ;;    Doses falls below the Low Supply Alert for this Lot Number, an alert
"RTN","BILOT",245,0)
 ;;    will be displayed.
"RTN","BILOT",246,0)
 ;;
"RTN","BILOT",247,0)
 ;;Health Care Facility - Adding a Health Care Facility to a Lot Number will
"RTN","BILOT",248,0)
 ;;    will cause that Lot Number to become unavailable for any user who is
"RTN","BILOT",249,0)
 ;;    NOT logged on to the named Facility.
"RTN","BILOT",250,0)
 ;;
"RTN","BILOT",251,0)
 ;;    In general, there is NO NEED to assign Lot Numbers to specific
"RTN","BILOT",252,0)
 ;;    Facilities.  However, if more than one Facility uses the same
"RTN","BILOT",253,0)
 ;;    computer (dialing in from remote sites), then it may be desirable
"RTN","BILOT",254,0)
 ;;    to assign Lot Numbers to specific Facilities. That way, users from
"RTN","BILOT",255,0)
 ;;    another Facility will be prevented from erroneously using a Lot
"RTN","BILOT",256,0)
 ;;    Number that is not at their Facility.
"RTN","BILOT",257,0)
 ;;
"RTN","BILOT",258,0)
 ;;    In cases where a Lot Number is truly shared by multiple Facilities
"RTN","BILOT",259,0)
 ;;    all using the same computer, it may be desirable to create "sub-Lots"
"RTN","BILOT",260,0)
 ;;    by appending "-a", "-b", "-c", etc. to the Lot Number.  For example,
"RTN","BILOT",261,0)
 ;;    Facility A would get "#1234-a", Facility B would get "#1234-b",
"RTN","BILOT",262,0)
 ;;    Facility C would get "#1234-c", and so on.
"RTN","BILOT",263,0)
 ;;
"RTN","BILOT",264,0)
 ;;    This would enable the manager or pharmacist to assign a Starting Amount
"RTN","BILOT",265,0)
 ;;    for each "sub-Lot" to each Facility and ensure that the inventory at
"RTN","BILOT",266,0)
 ;;    each site individually is accurate.
"RTN","BILOT",267,0)
 ;;
"RTN","BILOT",268,0)
 ;;
"RTN","BILOT",269,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BILOT",270,0)
 Q
"RTN","BILOT",271,0)
 ;
"RTN","BILOT",272,0)
 ;
"RTN","BILOT",273,0)
 ;----------
"RTN","BILOT",274,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BILOT",275,0)
 Q:$G(BILINL)=""
"RTN","BILOT",276,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILOT",277,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BILOT",278,0)
 Q
"RTN","BILOT",279,0)
 ;
"RTN","BILOT",280,0)
 ;
"RTN","BILOT",281,0)
 ;----------
"RTN","BILOT",282,0)
TEXT3 ;EP
"RTN","BILOT",283,0)
 ;;
"RTN","BILOT",284,0)
 ;;This option will automatically INACTIVATE ALL Lot Numbers that
"RTN","BILOT",285,0)
 ;;have EXPIRED (an Expiration Date prior to today).
"RTN","BILOT",286,0)
 ;;
"RTN","BILOT",287,0)
 ;;It will also automatically INACTIVATE ALL Lot Numbers that have
"RTN","BILOT",288,0)
 ;;NO Expiration Date (as viewed in the Lot Number Table).
"RTN","BILOT",289,0)
 ;;
"RTN","BILOT",290,0)
 ;;   Note: You can REACTIVATE any Lot Number individually at any time
"RTN","BILOT",291,0)
 ;;   by editing the Lot Number individually from the Edit Lot Numbers
"RTN","BILOT",292,0)
 ;;   Screen (and resetting the Active Field for that Lot Number).
"RTN","BILOT",293,0)
 ;;
"RTN","BILOT",294,0)
 ;;Do you wish to INACTIVATE ALL Lot Numbers that either have EXPIRED
"RTN","BILOT",295,0)
 ;;or have NO Expiration Date?
"RTN","BILOT",296,0)
 ;;
"RTN","BILOT",297,0)
 D PRINTX("TEXT3")
"RTN","BILOT",298,0)
 Q
"RTN","BILOT",299,0)
 ;
"RTN","BILOT",300,0)
 ;
"RTN","BILOT",301,0)
 ;----------
"RTN","BILOT",302,0)
TEXT33 ;EP
"RTN","BILOT",303,0)
 ;;
"RTN","BILOT",304,0)
 ;;Okay.
"RTN","BILOT",305,0)
 ;;Please confirm that you wish Inactivate all Lot Numbers that
"RTN","BILOT",306,0)
 ;;either have EXPIRED or have NO Expiration Eate, by typing "YES"
"RTN","BILOT",307,0)
 ;;a second time.  (Enter NO to discontinue this process.)
"RTN","BILOT",308,0)
 ;;
"RTN","BILOT",309,0)
 D PRINTX("TEXT33")
"RTN","BILOT",310,0)
 Q
"RTN","BILOT",311,0)
 ;
"RTN","BILOT",312,0)
 ;
"RTN","BILOT",313,0)
 ;----------
"RTN","BILOT",314,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILOT",315,0)
 Q:$G(BILINL)=""
"RTN","BILOT",316,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILOT",317,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BILOT",318,0)
 Q
"RTN","BILOT",319,0)
 ;
"RTN","BILOT",320,0)
 ;
"RTN","BILOT",321,0)
 ;----------
"RTN","BILOT",322,0)
EXIT ;EP
"RTN","BILOT",323,0)
 ;---> End of job cleanup.
"RTN","BILOT",324,0)
 D KILLALL^BIUTL8()
"RTN","BILOT",325,0)
 K ^TMP("BILOT",$J)
"RTN","BILOT",326,0)
 D CLEAR^VALM1
"RTN","BILOT",327,0)
 D FULL^VALM1
"RTN","BILOT",328,0)
 Q
"RTN","BILOT1")
0^52^B159461320
"RTN","BILOT1",1,0)
BILOT1 ;IHS/CMI/MWR - EDIT LOT NUMBERS.; MAY 10, 2010
"RTN","BILOT1",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BILOT1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILOT1",4,0)
 ;;  EDIT LOT NUMBER FIELDS.
"RTN","BILOT1",5,0)
 ;   PATCH 2: Display number of Lots in list.  INIT+50
"RTN","BILOT1",6,0)
 ;
"RTN","BILOT1",7,0)
 ;
"RTN","BILOT1",8,0)
 ;----------
"RTN","BILOT1",9,0)
INIT ;EP
"RTN","BILOT1",10,0)
 ;---> Initialize variables and list array.
"RTN","BILOT1",11,0)
 ;
"RTN","BILOT1",12,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BILOT1",13,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BILOT1",14,0)
 ;
"RTN","BILOT1",15,0)
 ;---> Build Listmanager array.
"RTN","BILOT1",16,0)
 K ^TMP("BILOT",$J),BILOT,BITMP
"RTN","BILOT1",17,0)
 N BIENT,BILINE,BITMP S BIENT=0,BILINE=0
"RTN","BILOT1",18,0)
 ;---> BICOLL=Order of Listing (see linelabel CHGORDR below.
"RTN","BILOT1",19,0)
 S:'$G(BICOLL) BICOLL=1
"RTN","BILOT1",20,0)
 ;---> Exclude inactive lots unless BIINACT=1.  vvv83
"RTN","BILOT1",21,0)
 S:'$G(BIINACT) BIINACT=0
"RTN","BILOT1",22,0)
 ;
"RTN","BILOT1",23,0)
 N BIIEN S BIIEN=0
"RTN","BILOT1",24,0)
 F  S BIIEN=$O(^AUTTIML(BIIEN)) Q:'BIIEN  D
"RTN","BILOT1",25,0)
 .I '$D(^AUTTIML(BIIEN,0)) K ^AUTTIML(BIIEN) Q
"RTN","BILOT1",26,0)
 .N BIACT,BIEXP,BILOT,BIVNAM,BIUNSD,Y,X,Z
"RTN","BILOT1",27,0)
 .S Y=^AUTTIML(BIIEN,0),BILOT=$P(Y,U),BIACT=+$P(Y,U,3)
"RTN","BILOT1",28,0)
 .S BIUNSD=$P(Y,U,12) S:BIUNSD="" BIUNSD="NA"
"RTN","BILOT1",29,0)
 .;---> Quit if excluding Inactive Lots.
"RTN","BILOT1",30,0)
 .Q:('BIINACT&BIACT=1)
"RTN","BILOT1",31,0)
 .S:BILOT="" BILOT="UNKNOWN"
"RTN","BILOT1",32,0)
 .;---> If no Exp Date, set Exp Date=last in list.
"RTN","BILOT1",33,0)
 .S BIEXP=+$P(Y,U,9) S:'BIEXP BIEXP=9999999
"RTN","BILOT1",34,0)
 .S BIVNAM=+$P(Y,U,4),BIVNAM=$$VNAME^BIUTL2(BIVNAM)
"RTN","BILOT1",35,0)
 .D
"RTN","BILOT1",36,0)
 ..I BICOLL=2 S W=BIEXP,X=BIVNAM,Y=BIUNSD,Z=BILOT Q  ;vvv83
"RTN","BILOT1",37,0)
 ..I BICOLL=3 S W=BILOT,X=BIVNAM,Y=BIEXP,Z=BIUNSD Q
"RTN","BILOT1",38,0)
 ..I BICOLL=4 S W=BIVNAM,X=BIUNSD,Y=BIEXP,Z=BILOT Q
"RTN","BILOT1",39,0)
 ..I BICOLL=5 S W=BIVNAM,X=BIEXP,Y=BIUNSD,Z=BILOT Q
"RTN","BILOT1",40,0)
 ..I BICOLL=6 S W=BIVNAM,X=BILOT,Y=BIEXP,Z=BILOT Q
"RTN","BILOT1",41,0)
 ..           S W=BIUNSD,X=BIVNAM,Y=BIEXP,Z=BILOT Q
"RTN","BILOT1",42,0)
 .S BITMP(BIACT,W,X,Y,Z,BIIEN)=BIIEN
"RTN","BILOT1",43,0)
 ;
"RTN","BILOT1",44,0)
 N N S N="" F  S N=$O(BITMP(N)) Q:(N="")  D
"RTN","BILOT1",45,0)
 .;---> Place a linefeed between Active and Inactive.
"RTN","BILOT1",46,0)
 .I N D WRITE(.BILINE,,,BIENT)
"RTN","BILOT1",47,0)
 .;
"RTN","BILOT1",48,0)
 .N M S M="" F  S M=$O(BITMP(N,M)) Q:(M="")  D
"RTN","BILOT1",49,0)
 ..N L S L="" F  S L=$O(BITMP(N,M,L)) Q:(L="")  D
"RTN","BILOT1",50,0)
 ...N K S K="" F  S K=$O(BITMP(N,M,L,K)) Q:(K="")  D
"RTN","BILOT1",51,0)
 ....N J S J="" F  S J=$O(BITMP(N,M,L,K,J)) Q:(J="")  D
"RTN","BILOT1",52,0)
 .....N P S P="" F  S P=$O(BITMP(N,M,L,K,J,P)) Q:(P="")  D
"RTN","BILOT1",53,0)
 ......D LINE(BITMP(N,M,L,K,J,P),.BILINE,.BIENT)
"RTN","BILOT1",54,0)
 ;
"RTN","BILOT1",55,0)
 ;---> Finish up Listmanager List Count.
"RTN","BILOT1",56,0)
 S VALMCNT=BILINE
"RTN","BILOT1",57,0)
 I VALMCNT>12 D
"RTN","BILOT1",58,0)
 .;
"RTN","BILOT1",59,0)
 .;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BILOT1",60,0)
 .;---> Display number of Lots in list.
"RTN","BILOT1",61,0)
 .;S VALMSG="Scroll down to view more. Type ?? for more actions"
"RTN","BILOT1",62,0)
 .N Y S Y=VALMCNT S:$G(BIINACT) Y=Y-1
"RTN","BILOT1",63,0)
 .S VALMSG=Y_" Lots: Scroll down to view more, or type ??."
"RTN","BILOT1",64,0)
 .;**********
"RTN","BILOT1",65,0)
 Q
"RTN","BILOT1",66,0)
 ;
"RTN","BILOT1",67,0)
 ;
"RTN","BILOT1",68,0)
 ;----------
"RTN","BILOT1",69,0)
LINE(BIIEN,BILINE,BIENT) ;EP
"RTN","BILOT1",70,0)
 ;---> Gather data for each Lot and write to ^TMP.
"RTN","BILOT1",71,0)
 ;---> Parameters:
"RTN","BILOT1",72,0)
 ;     1 - BIIEN  (req) IEN of Lot.
"RTN","BILOT1",73,0)
 ;     2 - BILINE (ret) Last line# written.
"RTN","BILOT1",74,0)
 ;     3 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BILOT1",75,0)
 ;
"RTN","BILOT1",76,0)
 N BI0,X,Y
"RTN","BILOT1",77,0)
 S BI0=^AUTTIML(BIIEN,0)
"RTN","BILOT1",78,0)
 ;
"RTN","BILOT1",79,0)
 ;---> Set Item# and build Item# array=IEN of Vaccine.
"RTN","BILOT1",80,0)
 S BIENT=BIENT+1,BILOT(BIENT)=BIIEN
"RTN","BILOT1",81,0)
 ;
"RTN","BILOT1",82,0)
 ;---> Item#.
"RTN","BILOT1",83,0)
 S X=" "_$S(BIENT<10:" "_BIENT,1:BIENT)
"RTN","BILOT1",84,0)
 ;
"RTN","BILOT1",85,0)
 ;---> Lot Number.
"RTN","BILOT1",86,0)
 S X=X_"  "_$P(BI0,U)
"RTN","BILOT1",87,0)
 S X=$$PAD^BIUTL5(X,27,".")
"RTN","BILOT1",88,0)
 ;
"RTN","BILOT1",89,0)
 ;---> Vaccine.
"RTN","BILOT1",90,0)
 S X=X_$$VNAME^BIUTL2($P(BI0,U,4))
"RTN","BILOT1",91,0)
 S X=$$PAD^BIUTL5(X,39,".")
"RTN","BILOT1",92,0)
 ;
"RTN","BILOT1",93,0)
 ;---> Active/Inactive/(VISTA:Expried)
"RTN","BILOT1",94,0)
 ; NB: Trick here: +$P makes the value 0, which is active. B/c I don't want
"RTN","BILOT1",95,0)
 ; EXT^DILFD to give me back an empty string for null entries.
"RTN","BILOT1",96,0)
 N EXT S EXT=$$EXTERNAL^DILFD(9999999.41,.03,,+$P(BI0,U,3))
"RTN","BILOT1",97,0)
 S X=X_$$TITLE^XLFSTR(EXT)
"RTN","BILOT1",98,0)
 ; S X=X_$S($P(BI0,U,3)=1:"Inactive",1:"Active") ven/smh
"RTN","BILOT1",99,0)
 S X=$$PAD^BIUTL5(X,47,".")
"RTN","BILOT1",100,0)
 ;
"RTN","BILOT1",101,0)
 ;---> Expiration Date.
"RTN","BILOT1",102,0)
 I $P(BI0,U,9) S X=X_$$LOTEXP^BIRPC3(BIIEN,1)
"RTN","BILOT1",103,0)
 S X=$$PAD^BIUTL5(X,57,".")
"RTN","BILOT1",104,0)
 ;
"RTN","BILOT1",105,0)
 ;---> Starting Count.
"RTN","BILOT1",106,0)
 I $P(BI0,U,11) S X=X_$J($P(BI0,U,11),5)
"RTN","BILOT1",107,0)
 S X=$$PAD^BIUTL5(X,64,".")
"RTN","BILOT1",108,0)
 ;
"RTN","BILOT1",109,0)
 ;---> Doses Unused (amount left).
"RTN","BILOT1",110,0)
 I $P(BI0,U,11) S X=X_$J($$LOTRBAL^BIRPC3(BIIEN),5)
"RTN","BILOT1",111,0)
 S X=$$PAD^BIUTL5(X,71,".")
"RTN","BILOT1",112,0)
 ;
"RTN","BILOT1",113,0)
 ;---> Facility (if entered).
"RTN","BILOT1",114,0)
 I $P(BI0,U,14) S X=X_$E($$INSTTX^BIUTL6($P(BI0,U,14)),1,8)
"RTN","BILOT1",115,0)
 S X=$$PAD^BIUTL5(X,80,".")
"RTN","BILOT1",116,0)
 ;
"RTN","BILOT1",117,0)
 ;---> Set this Vaccine display row and index in ^TMP.
"RTN","BILOT1",118,0)
 D WRITE(.BILINE,X,,BIENT)
"RTN","BILOT1",119,0)
 Q
"RTN","BILOT1",120,0)
 ;
"RTN","BILOT1",121,0)
 ;
"RTN","BILOT1",122,0)
 ;----------
"RTN","BILOT1",123,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BILOT1",124,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BILOT1",125,0)
 ;---> Parameters:
"RTN","BILOT1",126,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BILOT1",127,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BILOT1",128,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BILOT1",129,0)
 ;     4 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BILOT1",130,0)
 ;
"RTN","BILOT1",131,0)
 Q:'$D(BILINE)
"RTN","BILOT1",132,0)
 D WL^BIW(.BILINE,"BILOT",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BILOT1",133,0)
 Q
"RTN","BILOT1",134,0)
 ;
"RTN","BILOT1",135,0)
 ;
"RTN","BILOT1",136,0)
 ;----------
"RTN","BILOT1",137,0)
EDITLOT(BINEW) ;EP
"RTN","BILOT1",138,0)
 ;---> Edit a Lot Number.
"RTN","BILOT1",139,0)
 ;---> Parameters:
"RTN","BILOT1",140,0)
 ;     2 - BINEW (opt) 1=new lot number being added; 0/""=edit.
"RTN","BILOT1",141,0)
 ;
"RTN","BILOT1",142,0)
 ;---> Steps:
"RTN","BILOT1",143,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BILOT1",144,0)
 ;               BI LOT NUMBER SELECT, an action on the
"RTN","BILOT1",145,0)
 ;               List Manager menu protocol: BI MENU LOT NUMBER EDIT.
"RTN","BILOT1",146,0)
 ;
"RTN","BILOT1",147,0)
 ;            2) This code calls ScreenMan form:
"RTN","BILOT1",148,0)
 ;               BI FORM-LOT NUMBER EDIT to build BI local array
"RTN","BILOT1",149,0)
 ;               of data for add/edit of a Lot Number.
"RTN","BILOT1",150,0)
 ;               Data already stored in the BI local array is loaded
"RTN","BILOT1",151,0)
 ;               into the form by LOADLOT^BILOT1, which is called
"RTN","BILOT1",152,0)
 ;               by the Pre-Action of Block for Vaccine Edit.
"RTN","BILOT1",153,0)
 ;
"RTN","BILOT1",154,0)
 ;            3) Use BI local array to send data to FDIE^BIFMAN.
"RTN","BILOT1",155,0)
 ;
"RTN","BILOT1",156,0)
 ;---> If BINEW, add a new Lot Number and quit.
"RTN","BILOT1",157,0)
 I $G(BINEW) D EDITSCR(,1) D RESET Q
"RTN","BILOT1",158,0)
 ;
"RTN","BILOT1",159,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BILOT1",160,0)
 N VALMY
"RTN","BILOT1",161,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BILOT1",162,0)
 ;
"RTN","BILOT1",163,0)
 ;---> Check that a Listman Item was passed.
"RTN","BILOT1",164,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BILOT1",165,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BILOT1",166,0)
 N Y S Y=$O(VALMY(0))
"RTN","BILOT1",167,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BILOT1",168,0)
 I $G(BILOT(Y))="" D ERRCD^BIUTL2(511,,1) D RESET Q
"RTN","BILOT1",169,0)
 D EDITSCR(+BILOT(Y))
"RTN","BILOT1",170,0)
 D FULL^VALM1
"RTN","BILOT1",171,0)
 D RESET
"RTN","BILOT1",172,0)
 Q
"RTN","BILOT1",173,0)
 ;
"RTN","BILOT1",174,0)
 ;
"RTN","BILOT1",175,0)
 ;----------
"RTN","BILOT1",176,0)
EDITSCR(BILOT,BINEW) ;EP
"RTN","BILOT1",177,0)
 ;---> Add or edit the fields of a Lot Number.
"RTN","BILOT1",178,0)
 ;---> (Make this an RPC in the future?)
"RTN","BILOT1",179,0)
 ;---> Parameters:
"RTN","BILOT1",180,0)
 ;     1 - BILOT (opt) Lot Number IEN.
"RTN","BILOT1",181,0)
 ;     2 - BINEW (opt) 1=new lot number being added; 0=edit.
"RTN","BILOT1",182,0)
 ;
"RTN","BILOT1",183,0)
 ;---> If this is an edit, check that IEN of Lot Number.
"RTN","BILOT1",184,0)
 I '$G(BINEW),$G(^AUTTIML(+$G(BILOT),0))="" D ERRCD^BIUTL2(511,,1) Q
"RTN","BILOT1",185,0)
 ;
"RTN","BILOT1",186,0)
 ;---> If this is an edit, preload existing values for Screenman form.
"RTN","BILOT1",187,0)
 N BI D:$G(BILOT)
"RTN","BILOT1",188,0)
 .N Y S Y=^AUTTIML(BILOT,0)
"RTN","BILOT1",189,0)
 .S BI("AS")=$P(Y,U,1)     ;Full Lot Number Text.
"RTN","BILOT1",190,0)
 .S BI("A")=$P(BI("AS"),"*")      ;Lot Number Text.
"RTN","BILOT1",191,0)
 .S BI("S")=$P(BI("AS"),"*",2)      ;Lot Number Text.
"RTN","BILOT1",192,0)
 .S BI("B")=$P(Y,U,4)      ;Vaccine.
"RTN","BILOT1",193,0)
 .S BI("C")=+$P(Y,U,3)     ;Status Active/Inactive.
"RTN","BILOT1",194,0)
 .S BI("D")=$P(Y,U,9)      ;Expiration Date.
"RTN","BILOT1",195,0)
 .S BI("E")=$P(Y,U,11)     ;Starting Count.
"RTN","BILOT1",196,0)
 .S BI("F")=$P(Y,U,12)     ;Doses Unused.
"RTN","BILOT1",197,0)
 .S BI("G")=$P(Y,U,15)     ;Low Supply Alert.
"RTN","BILOT1",198,0)
 .S BI("H")=$P(Y,U,13)     ;Source VFC or NON-VFC.
"RTN","BILOT1",199,0)
 .S BI("M")=$P(Y,U,2)      ;Manufacturer.
"RTN","BILOT1",200,0)
 .S BI("N")=$P(Y,U,14)     ;Facility.
"RTN","BILOT1",201,0)
 .S BI("O")=$P(Y,U,17)     ;NDC Code.
"RTN","BILOT1",202,0)
 ;
"RTN","BILOT1",203,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BILOT1",204,0)
 N BISAVE
"RTN","BILOT1",205,0)
 N DR S DR="[BI FORM-LOT NUMBER EDIT]"
"RTN","BILOT1",206,0)
 D DDS^BIFMAN(9999999.41,DR,$G(BILOT),"S",.BISAVE,.BIPOP)
"RTN","BILOT1",207,0)
 ;
"RTN","BILOT1",208,0)
 ;---> Quit if user did not save this data.
"RTN","BILOT1",209,0)
 Q:('$G(BISAVE))
"RTN","BILOT1",210,0)
 ;
"RTN","BILOT1",211,0)
 ;---> Build local array for this Lot Number.
"RTN","BILOT1",212,0)
 N BIERR,BIFLD
"RTN","BILOT1",213,0)
 S BI("AS")=BI("A")
"RTN","BILOT1",214,0)
 I $G(BI("S"))]"" S BI("AS")=BI("AS")_"*"_BI("S")
"RTN","BILOT1",215,0)
 ;
"RTN","BILOT1",216,0)
 ;---> v8.5: If Active Status="", set it to 0, so PCC will be happy.
"RTN","BILOT1",217,0)
 I $G(BI("C"))="" S BI("C")=0
"RTN","BILOT1",218,0)
 ;
"RTN","BILOT1",219,0)
 S BIFLD(.01)=$G(BI("AS")),BIFLD(.03)=$G(BI("C")),BIFLD(.09)=$G(BI("D"))
"RTN","BILOT1",220,0)
 S BIFLD(.11)=$G(BI("E")),BIFLD(.12)=$G(BI("F")),BIFLD(.15)=$G(BI("G"))
"RTN","BILOT1",221,0)
 S BIFLD(.13)=$G(BI("H")),BIFLD(.02)=$G(BI("M")),BIFLD(.14)=$G(BI("N"))
"RTN","BILOT1",222,0)
 S BIFLD(.16)=$G(BI("A")),BIFLD(.17)=$G(BI("O"))
"RTN","BILOT1",223,0)
 ;---> If this is a new Lot Number, include the Vaccine.
"RTN","BILOT1",224,0)
 S:$G(BINEW) BIFLD(.04)=$G(BI("B"))
"RTN","BILOT1",225,0)
 ;
"RTN","BILOT1",226,0)
 ;
"RTN","BILOT1",227,0)
 ;---> If this is a new Lot Number and it already exists (not a sub-lot),
"RTN","BILOT1",228,0)
 ;---> then display error and quit.
"RTN","BILOT1",229,0)
 I $G(BINEW),$D(^AUTTIML("B",BI("AS"))) D  Q
"RTN","BILOT1",230,0)
 .D CLEAR^VALM1,FULL^VALM1,TITLE^BIUTL5("EDIT LOT NUMBER FIELDS")
"RTN","BILOT1",231,0)
 .W !!?23,"This Lot Number already exists!"
"RTN","BILOT1",232,0)
 .W !!?18,"Please exit and select it from the list."
"RTN","BILOT1",233,0)
 .W !!!!?5,"NOTE: It It may be Inactive. Try displaying Inactive Lot Numbers"
"RTN","BILOT1",234,0)
 .W !?11,"as well as Active ones.",!
"RTN","BILOT1",235,0)
 .D DIRZ^BIUTL3()
"RTN","BILOT1",236,0)
 ;
"RTN","BILOT1",237,0)
 ;
"RTN","BILOT1",238,0)
 ;---> Add/update the Lot Number.
"RTN","BILOT1",239,0)
 D
"RTN","BILOT1",240,0)
 .I $G(BINEW) D UPDATE^BIFMAN(9999999.41,.BILOT,.BIFLD,.BIERR) Q
"RTN","BILOT1",241,0)
 .D FDIE^BIFMAN(9999999.41,BILOT,.BIFLD,.BIERR)
"RTN","BILOT1",242,0)
 ;
"RTN","BILOT1",243,0)
 ;---> If there was an error, display it.
"RTN","BILOT1",244,0)
 I $G(BIERR)]"" D  Q
"RTN","BILOT1",245,0)
 .D CLEAR^VALM1,FULL^VALM1,TITLE^BIUTL5("EDIT LOT NUMBER FIELDS")
"RTN","BILOT1",246,0)
 .W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BILOT1",247,0)
 ;
"RTN","BILOT1",248,0)
 Q
"RTN","BILOT1",249,0)
 ;
"RTN","BILOT1",250,0)
 ;
"RTN","BILOT1",251,0)
 ;----------
"RTN","BILOT1",252,0)
LOADLOT ;EP
"RTN","BILOT1",253,0)
 ;---> Code to load Lot Number data for ScreenMan Edit form.
"RTN","BILOT1",254,0)
 ;---> Called by Pre Action of Block BI BLK-LOT NUMBER EDIT on
"RTN","BILOT1",255,0)
 ;---> Form BI FORM-LOT NUMBER EDIT.
"RTN","BILOT1",256,0)
 ;
"RTN","BILOT1",257,0)
 ;---> If this is a NEW Lot Number, enable editing of Vaccine, Field 2.
"RTN","BILOT1",258,0)
 I $G(BINEW) D UNED^DDSUTL(2,,,0)
"RTN","BILOT1",259,0)
 ;
"RTN","BILOT1",260,0)
 ;---> Load Lot Number.
"RTN","BILOT1",261,0)
 I $G(BI("A"))]"" D PUT^DDSVALF(1,,,BI("A"),"I")
"RTN","BILOT1",262,0)
 ;
"RTN","BILOT1",263,0)
 ;---> Load Sub-lot, if it exists.
"RTN","BILOT1",264,0)
 I $G(BI("S"))]"" D PUT^DDSVALF(1.5,,,BI("S"),"I")
"RTN","BILOT1",265,0)
 ;
"RTN","BILOT1",266,0)
 ;---> Load Vaccine Name (.01).
"RTN","BILOT1",267,0)
 I $G(BI("B"))]"" D PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BILOT1",268,0)
 ;
"RTN","BILOT1",269,0)
 ;---> Load Vaccine Short Name (.02).
"RTN","BILOT1",270,0)
 I $G(BI("B"))]"" D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(BI("B"))_")")
"RTN","BILOT1",271,0)
 ;
"RTN","BILOT1",272,0)
 ;---> Load Lot Number Status Active/Inactive.
"RTN","BILOT1",273,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(3,,,BI("C"),"I")
"RTN","BILOT1",274,0)
 ;
"RTN","BILOT1",275,0)
 ;---> Load Lot Number Expiration Date.
"RTN","BILOT1",276,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(4,,,BI("D"),"I")
"RTN","BILOT1",277,0)
 ;
"RTN","BILOT1",278,0)
 ;---> Load the Starting Count.
"RTN","BILOT1",279,0)
 I $G(BI("E"))]"" D PUT^DDSVALF(5,,,BI("E"),"I")
"RTN","BILOT1",280,0)
 ;
"RTN","BILOT1",281,0)
 ;---> Load the Doses Unused.
"RTN","BILOT1",282,0)
 I $G(BI("F"))]"" D PUT^DDSVALF(6,,,BI("F"),"I")
"RTN","BILOT1",283,0)
 ;
"RTN","BILOT1",284,0)
 ;---> Load the Low Supply Alert.
"RTN","BILOT1",285,0)
 I $G(BI("G"))]"" D PUT^DDSVALF(7,,,BI("G"),"I")
"RTN","BILOT1",286,0)
 ;
"RTN","BILOT1",287,0)
 ;---> Load the Source (VFC or NON-VFC).
"RTN","BILOT1",288,0)
 I $G(BI("H"))]"" D PUT^DDSVALF(11,,,BI("H"),"I")
"RTN","BILOT1",289,0)
 ;
"RTN","BILOT1",290,0)
 ;---> Load Manufacturer.
"RTN","BILOT1",291,0)
 I $G(BI("M"))]"" D PUT^DDSVALF(10,,,BI("M"),"I")
"RTN","BILOT1",292,0)
 ;
"RTN","BILOT1",293,0)
 ;---> Load Facility.
"RTN","BILOT1",294,0)
 I $G(BI("N"))]"" D PUT^DDSVALF(9,,,BI("N"),"I")
"RTN","BILOT1",295,0)
 ;
"RTN","BILOT1",296,0)
 ;---> Load NDC Code.
"RTN","BILOT1",297,0)
 I $G(BI("O"))]"" D PUT^DDSVALF(4.5,,,BI("O"),"I")
"RTN","BILOT1",298,0)
 ;
"RTN","BILOT1",299,0)
 ;---> Calculate the number of doses that have been used.
"RTN","BILOT1",300,0)
 D CALCDOS($G(BI("E")),$G(BI("F")))
"RTN","BILOT1",301,0)
 Q
"RTN","BILOT1",302,0)
 ;
"RTN","BILOT1",303,0)
 ;
"RTN","BILOT1",304,0)
 ;----------
"RTN","BILOT1",305,0)
INVOFF(BIZ) ;EP
"RTN","BILOT1",306,0)
 ;---> Trigger Popup that Doses Unused cannot be greater than
"RTN","BILOT1",307,0)
 ;---> the Starting Count.
"RTN","BILOT1",308,0)
 ;---> Called from Fields 5 & 6 on Form BI FORM-LOT NUMBER EDIT.
"RTN","BILOT1",309,0)
 ;---> Parameters:
"RTN","BILOT1",310,0)
 ;     1 - BIZ (req) Field triggered from: 1=Starting Count
"RTN","BILOT1",311,0)
 ;                                         2=Doses Unused
"RTN","BILOT1",312,0)
 ;
"RTN","BILOT1",313,0)
 Q:'$G(BIZ)
"RTN","BILOT1",314,0)
 S DDSSTACK="BI PAGE-INVENTORY OFF"
"RTN","BILOT1",315,0)
 I BIZ=1 D PUT^DDSVALF(5,,,$G(DDSOLD),"I") Q
"RTN","BILOT1",316,0)
 I BIZ=2 D PUT^DDSVALF(6,,,$G(DDSOLD),"I") Q
"RTN","BILOT1",317,0)
 Q
"RTN","BILOT1",318,0)
 ;
"RTN","BILOT1",319,0)
 ;
"RTN","BILOT1",320,0)
 ;----------
"RTN","BILOT1",321,0)
CALCDOS(E,F) ;EP
"RTN","BILOT1",322,0)
 ;---> Calculate the number of doses of a Lot Number that have been used.
"RTN","BILOT1",323,0)
 ;---> Called from Fields 5 & 6 on Form BI FORM-LOT NUMBER EDIT.
"RTN","BILOT1",324,0)
 ;---> Parameters:
"RTN","BILOT1",325,0)
 ;     1 - E (req) Starting Count
"RTN","BILOT1",326,0)
 ;     2 - F (req) Doses Unused
"RTN","BILOT1",327,0)
 ;
"RTN","BILOT1",328,0)
 Q:($G(E)="")  Q:($G(F)="")
"RTN","BILOT1",329,0)
 D PUT^DDSVALF(8,,,(E-F),"I")
"RTN","BILOT1",330,0)
 Q
"RTN","BILOT1",331,0)
 ;
"RTN","BILOT1",332,0)
 ;
"RTN","BILOT1",333,0)
 ;----------
"RTN","BILOT1",334,0)
VACINA1 ;EP
"RTN","BILOT1",335,0)
 ;---> Trigger Popup that says vaccine must be Active.
"RTN","BILOT1",336,0)
 ;---> Called from Fields 2 on Form BI FORM-LOT NUMBER EDIT.
"RTN","BILOT1",337,0)
 ;
"RTN","BILOT1",338,0)
 ;---> If this vaccine is Inactive, display popup.
"RTN","BILOT1",339,0)
 ;---> Ex
"RTN","BILOT1",340,0)
 I $P($G(^AUTTIMM(+X,0)),U,7) D  Q
"RTN","BILOT1",341,0)
 .S DDSSTACK="BI PAGE-INACTIVE VACCINE"
"RTN","BILOT1",342,0)
 ;
"RTN","BILOT1",343,0)
 S BINEW(1)=1 S DDSBR=10
"RTN","BILOT1",344,0)
 I $G(X) S BI("B")=X D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(X)_")")
"RTN","BILOT1",345,0)
 Q
"RTN","BILOT1",346,0)
 ;
"RTN","BILOT1",347,0)
 ;
"RTN","BILOT1",348,0)
 ;----------
"RTN","BILOT1",349,0)
VACINA2 ;EP
"RTN","BILOT1",350,0)
 ;---> Called from Fields 3 on Form BI FORM-LOT NUMBER EDIT.
"RTN","BILOT1",351,0)
 ;---> If no vaccine was selected, send user back to Field 2 (vaccine).
"RTN","BILOT1",352,0)
 I '$G(BI("B")) S DDSBR=2 D  Q
"RTN","BILOT1",353,0)
 .;D HLP^DDSUTL("Select  the Vaccine that corresponds to this Lot Number.")
"RTN","BILOT1",354,0)
 ;
"RTN","BILOT1",355,0)
 N BIT S BIT="Select whether this Lot Number should be Active or Inactive."
"RTN","BILOT1",356,0)
 S BIT=BIT_"  Note that users will not be able to select an Inactive Lot "
"RTN","BILOT1",357,0)
 S BIT=BIT_"Number if the Category is Ambulatory."
"RTN","BILOT1",358,0)
 D HLP^DDSUTL(BIT)
"RTN","BILOT1",359,0)
 Q
"RTN","BILOT1",360,0)
 ;
"RTN","BILOT1",361,0)
 ;
"RTN","BILOT1",362,0)
 ;----------
"RTN","BILOT1",363,0)
VACINA3 ;EP
"RTN","BILOT1",364,0)
 ;---> After code from popup, going back to Form BI FORM-LOT NUMBER EDIT.
"RTN","BILOT1",365,0)
 ;---> To get there: Get to the form (above), press F1-P,  then page 5,
"RTN","BILOT1",366,0)
 ;---> then F1-V, tab to BI BLK-..., spacebar, F4, Post Action at the bottom.
"RTN","BILOT1",367,0)
 ;
"RTN","BILOT1",368,0)
 ;---> Kill the vaccine node, null out the display of vaccine names.
"RTN","BILOT1",369,0)
 K BI("B") D PUT^DDSVALF(2,2,1,,"E"),PUT^DDSVALF(2.5,2,1,,"E")
"RTN","BILOT1",370,0)
 Q
"RTN","BILOT1",371,0)
 ;
"RTN","BILOT1",372,0)
 ;
"RTN","BILOT1",373,0)
 ;----------
"RTN","BILOT1",374,0)
RESET ;EP
"RTN","BILOT1",375,0)
 ;---> Update partition for return to Listmanager.
"RTN","BILOT1",376,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BILOT1",377,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BILOT1",378,0)
 D INIT^BILOT,HDR^BILOT()
"RTN","BILOT1",379,0)
 Q
"RTN","BILOT1",380,0)
 ;
"RTN","BILOT1",381,0)
 ;
"RTN","BILOT1",382,0)
 ;----------
"RTN","BILOT1",383,0)
CHGORDR ;EP
"RTN","BILOT1",384,0)
 ;
"RTN","BILOT1",385,0)
 D CHGORDR^BILOT2
"RTN","BILOT1",386,0)
 Q
"RTN","BILOT1",387,0)
 ;
"RTN","BILOT1",388,0)
 ;
"RTN","BILOT1",389,0)
 ;----------
"RTN","BILOT1",390,0)
TEXT2 ;EP
"RTN","BILOT1",391,0)
 ;;
"RTN","BILOT1",392,0)
 ;;The Lot Number Table will always be listed with the group of
"RTN","BILOT1",393,0)
 ;;all ACTIVE Lot Numbers first, followed by all INACTIVE Lot Numbers.
"RTN","BILOT1",394,0)
 ;;However, within those two groups you may select the order in which
"RTN","BILOT1",395,0)
 ;;the Lot Numbers are displayed, as follows:
"RTN","BILOT1",396,0)
 ;;
"RTN","BILOT1",397,0)
 ;;   1) By Unused Doses (least first)
"RTN","BILOT1",398,0)
 ;;   2) By Expiration Date
"RTN","BILOT1",399,0)
 ;;   3) By Lot Number
"RTN","BILOT1",400,0)
 ;;   4) By Vaccine Name, then by Unused Doses
"RTN","BILOT1",401,0)
 ;;   5) By Vaccine Name, then by Exp Date
"RTN","BILOT1",402,0)
 ;;   6) By Vaccine Name, then by Lot Number
"RTN","BILOT1",403,0)
 ;;
"RTN","BILOT1",404,0)
 D PRINTX("TEXT2")
"RTN","BILOT1",405,0)
 Q
"RTN","BILOT1",406,0)
 ;
"RTN","BILOT1",407,0)
 ;
"RTN","BILOT1",408,0)
 ;----------
"RTN","BILOT1",409,0)
INACTA ;EP
"RTN","BILOT1",410,0)
 ;---> Automatically Inactivate old Lot Numbers that either have expired
"RTN","BILOT1",411,0)
 ;---> or have no Expiration Date.
"RTN","BILOT1",412,0)
 ;
"RTN","BILOT1",413,0)
 D FULL^VALM1,TITLE^BIUTL5("INACTIVATE OLD LOT NUMBERS"),TEXT3^BILOT
"RTN","BILOT1",414,0)
 N DIR,Y D INACTA1
"RTN","BILOT1",415,0)
 D ^DIR
"RTN","BILOT1",416,0)
 S:$D(DIRUT) BIPOP=1
"RTN","BILOT1",417,0)
 I Y'=1 D  Q
"RTN","BILOT1",418,0)
 .W !!?5,"Okay.  NO changes made!"  D DIRZ^BIUTL3()
"RTN","BILOT1",419,0)
 .D RESET
"RTN","BILOT1",420,0)
 ;
"RTN","BILOT1",421,0)
 D TITLE^BIUTL5("INACTIVATE OLD LOT NUMBERS"),TEXT33^BILOT,INACTA1
"RTN","BILOT1",422,0)
 D ^DIR
"RTN","BILOT1",423,0)
 S:$D(DIRUT) BIPOP=1
"RTN","BILOT1",424,0)
 I Y'=1 D  Q
"RTN","BILOT1",425,0)
 .W !!?5,"Okay.  NO changes made!"  D DIRZ^BIUTL3()
"RTN","BILOT1",426,0)
 .D RESET
"RTN","BILOT1",427,0)
 ;
"RTN","BILOT1",428,0)
 D INACTLN
"RTN","BILOT1",429,0)
 D RESET
"RTN","BILOT1",430,0)
 Q
"RTN","BILOT1",431,0)
 ;
"RTN","BILOT1",432,0)
 ;
"RTN","BILOT1",433,0)
 ;----------
"RTN","BILOT1",434,0)
INACTA1 ;EP
"RTN","BILOT1",435,0)
 ;---> Set DIR values for linelabel INACTA.
"RTN","BILOT1",436,0)
 S DIR(0)="YA"
"RTN","BILOT1",437,0)
 S DIR("A")="     Please answer either YES or NO: ",DIR("B")="NO"
"RTN","BILOT1",438,0)
 S DIR("?",1)="     Enter YES to automatically Inactivate Lot Numbers, "
"RTN","BILOT1",439,0)
 S DIR("?")="     enter NO to make no changes."
"RTN","BILOT1",440,0)
 Q
"RTN","BILOT1",441,0)
 ;
"RTN","BILOT1",442,0)
 ;
"RTN","BILOT1",443,0)
 ;----------
"RTN","BILOT1",444,0)
INACTLN ;EP
"RTN","BILOT1",445,0)
 ;---> Inactivate all Lot Numbers that either have expired or have
"RTN","BILOT1",446,0)
 ;---> no Expiration Date.
"RTN","BILOT1",447,0)
 ;
"RTN","BILOT1",448,0)
 ; D ^XBKVAR ; ven/smh - now this is just silly! Why here?
"RTN","BILOT1",449,0)
 N M,N S M=0,N=0
"RTN","BILOT1",450,0)
 F  S N=$O(^AUTTIML(N)) Q:'N  D
"RTN","BILOT1",451,0)
 .Q:'$D(^AUTTIML(N,0))
"RTN","BILOT1",452,0)
 .;---> Do not Inactivate if Exp Date is later than Today.
"RTN","BILOT1",453,0)
 .Q:($P(^AUTTIML(N,0),"^",9)>$G(DT))
"RTN","BILOT1",454,0)
 .;---> Quit if this Lot Number is already Inactive.
"RTN","BILOT1",455,0)
 .Q:($P(^AUTTIML(N,0),"^",3)=1)
"RTN","BILOT1",456,0)
 .;---> Inactivate this Lot Number.
"RTN","BILOT1",457,0)
 .I $$RPMS^BIUTL9 S $P(^AUTTIML(N,0),"^",3)=1,M=M+1
"RTN","BILOT1",458,0)
 .E  S $P(^AUTTIML(N,0),"^",3)=2,M=M+1               ; Vista has code 2 = expired.
"RTN","BILOT1",459,0)
 .                                                   ; Mike: you prob want that for RPMS
"RTN","BILOT1",460,0)
 .;---> Re-index (TODO: not tested-->must test prior to release to prod. Create index and see if it gets set correctly.)
"RTN","BILOT1",461,0)
 .N DA,DIK S DA=N,DIK="^AUTTIML(",DIK(1)=".03" D EN^DIK  ; kill and then set.
"RTN","BILOT1",462,0)
 W !!?5,"Done.  ",M," Lot Numbers have been Inactivated." D DIRZ^BIUTL3()
"RTN","BILOT1",463,0)
 Q
"RTN","BILOT1",464,0)
 ;
"RTN","BILOT1",465,0)
 ;
"RTN","BILOT1",466,0)
 ;----------
"RTN","BILOT1",467,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILOT1",468,0)
 Q:$G(BILINL)=""
"RTN","BILOT1",469,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILOT1",470,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BILOT1",471,0)
 Q
"RTN","BILOT1",472,0)
 ;
"RTN","BILOT1",473,0)
 ;
"RTN","BILOT1",474,0)
 ;----------
"RTN","BILOT1",475,0)
NULLACT ;EP
"RTN","BILOT1",476,0)
 ;---> Activate all Lot Numbers that have a Status=null.
"RTN","BILOT1",477,0)
 ;---> Call by postinit for Imm v8.5.
"RTN","BILOT1",478,0)
 ;
"RTN","BILOT1",479,0)
 ; D ^XBKVAR
"RTN","BILOT1",480,0)
 W !!?5,"Checking Lot Numbers for null Status..."
"RTN","BILOT1",481,0)
 N M,N S M=0,N=0
"RTN","BILOT1",482,0)
 F  S N=$O(^AUTTIML(N)) Q:'N  D
"RTN","BILOT1",483,0)
 .Q:'$D(^AUTTIML(N,0))
"RTN","BILOT1",484,0)
 .;---> Quit if this lot number has a Status .
"RTN","BILOT1",485,0)
 .Q:($P(^AUTTIML(N,0),"^",3)'="")
"RTN","BILOT1",486,0)
 .;---> Okay, Status must be null, so set it to Active.
"RTN","BILOT1",487,0)
 .S $P(^AUTTIML(N,0),"^",3)=0,M=M+1
"RTN","BILOT1",488,0)
 W !!?5,"Done.  ",M," Lot Numbers have been fixed." D DIRZ^BIUTL3()
"RTN","BILOT1",489,0)
 Q
"RTN","BILOT2")
0^53^B10609281
"RTN","BILOT2",1,0)
BILOT2 ;IHS/CMI/MWR - EDIT LOT NUMBERS.; MAY 10, 2010
"RTN","BILOT2",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BILOT2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILOT2",4,0)
 ;;  EDIT VACCINE FIELDS: CURRENT LOT, ACTIVE, VIS DATE DEFAULT.
"RTN","BILOT2",5,0)
 ;   PATCH 2: Make Display Inactives a separate Action.  CHGORDR+11
"RTN","BILOT2",6,0)
 ;   PATCH 3: Correct leftover prompt from Inactive question. DISPLYI+7
"RTN","BILOT2",7,0)
 ;
"RTN","BILOT2",8,0)
 ;
"RTN","BILOT2",9,0)
 ;----------
"RTN","BILOT2",10,0)
LOTDVAL(BIX) ;EP
"RTN","BILOT2",11,0)
 ;---> Sub-Lot data validation for Field 1.5, BI FORM-LOT NUMBER EDIT
"RTN","BILOT2",12,0)
 ;---> Parameters:
"RTN","BILOT2",13,0)
 ;     1 - BIX (req) The value of the Lot Number.
"RTN","BILOT2",14,0)
 ;
"RTN","BILOT2",15,0)
 Q:($G(X)="")  Q:($G(X)=0)
"RTN","BILOT2",16,0)
 ;
"RTN","BILOT2",17,0)
 I $D(^AUTTIML("B",BIX)) D  Q
"RTN","BILOT2",18,0)
 .S DDSSTACK="BI PAGE-LOT DUPLICATE WARNING"
"RTN","BILOT2",19,0)
 .;N Y S Y="This Lot Number already exists.  Please exit and select it from"
"RTN","BILOT2",20,0)
 .;S Y=Y_" the list.  (NOTE: It It may be Inactive. Try displaying Inactive as"
"RTN","BILOT2",21,0)
 .;S Y=Y_"well as Active.)"
"RTN","BILOT2",22,0)
 .;D HLP^DDSUTL(Y) S DDSERROR=1
"RTN","BILOT2",23,0)
 ;
"RTN","BILOT2",24,0)
 I BIX["*" D
"RTN","BILOT2",25,0)
 .S Y="The Lot Number may not contain an asterisk, ""*"". (This symbol is used to"
"RTN","BILOT2",26,0)
 .S Y=Y_" separate the Lot Number from the Sub-lot, if one is appended.)"
"RTN","BILOT2",27,0)
 .D HLP^DDSUTL(Y) S DDSERROR=1
"RTN","BILOT2",28,0)
 Q
"RTN","BILOT2",29,0)
 ;
"RTN","BILOT2",30,0)
 ;
"RTN","BILOT2",31,0)
 ;----------
"RTN","BILOT2",32,0)
SUBLOTD(BIA,BIX) ;EP
"RTN","BILOT2",33,0)
 ;---> Sub-Lot data validation for Field 1.5, BI FORM-LOT NUMBER EDIT
"RTN","BILOT2",34,0)
 ;---> Parameters:
"RTN","BILOT2",35,0)
 ;     1 - BIA (req) The value of the Lot Number.
"RTN","BILOT2",36,0)
 ;     2 - BIX   (req) The sub-lot entered.
"RTN","BILOT2",37,0)
 ;
"RTN","BILOT2",38,0)
 N Y,X
"RTN","BILOT2",39,0)
 Q:($G(BIX)="")
"RTN","BILOT2",40,0)
 S X=+(19-$L($G(BIA)))
"RTN","BILOT2",41,0)
 I $L($G(BIX))>(19-$L($G(BIA))) D  Q
"RTN","BILOT2",42,0)
 .S Y="The Sub-lot you entered, "_$G(BIX)_", is too long for this Lot Number."
"RTN","BILOT2",43,0)
 .S Y=Y_"  This Sub-lot must be "_X_" characters or less."
"RTN","BILOT2",44,0)
 .D HLP^DDSUTL(Y) S DDSERROR=1
"RTN","BILOT2",45,0)
 ;
"RTN","BILOT2",46,0)
 I BIX["*" D
"RTN","BILOT2",47,0)
 .S Y="The Sub-lot may not contain an asterisk, ""*"".  This symbol is used to"
"RTN","BILOT2",48,0)
 .S Y=Y_" separate the Lot Number from the Sub-lot."
"RTN","BILOT2",49,0)
 .D HLP^DDSUTL(Y) S DDSERROR=1
"RTN","BILOT2",50,0)
 Q
"RTN","BILOT2",51,0)
 ;
"RTN","BILOT2",52,0)
 ;
"RTN","BILOT2",53,0)
 ;----------
"RTN","BILOT2",54,0)
SUBLOTH(BIA) ;EP
"RTN","BILOT2",55,0)
 ;---> Sub-Lot Help for Field 1.5, BI FORM-LOT NUMBER EDIT
"RTN","BILOT2",56,0)
 ;---> Parameters:
"RTN","BILOT2",57,0)
 ;     1 - BIA (req) The value of the Lot Number.
"RTN","BILOT2",58,0)
 ;
"RTN","BILOT2",59,0)
 N X,Y
"RTN","BILOT2",60,0)
 S X=+(19-$L($G(BIA)))
"RTN","BILOT2",61,0)
 S Y="Enter/edit the Sub-lot suffix, if desired.  "
"RTN","BILOT2",62,0)
 D
"RTN","BILOT2",63,0)
 .I X S Y=Y_"The suffix for this Lot Number may be up to "_X_" characters long." Q
"RTN","BILOT2",64,0)
 .S Y=Y_"This Lot Number is too long for a sub-lot suffix."
"RTN","BILOT2",65,0)
 D HLP^DDSUTL(Y)
"RTN","BILOT2",66,0)
 Q
"RTN","BILOT2",67,0)
 ;
"RTN","BILOT2",68,0)
 ;
"RTN","BILOT2",69,0)
 ;----------
"RTN","BILOT2",70,0)
CHGORDR ;EP
"RTN","BILOT2",71,0)
 ;---> Menu for selecting Lot listing order.
"RTN","BILOT2",72,0)
 ;
"RTN","BILOT2",73,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT LOT LISTING ORDER"),TEXT2^BILOT1
"RTN","BILOT2",74,0)
 N DIR,Y
"RTN","BILOT2",75,0)
 S DIR(0)="SOA^"_$G(BISUBT)
"RTN","BILOT2",76,0)
 S DIR("A")="     Please select 1, 2, 3, 4, 5, or 6: "
"RTN","BILOT2",77,0)
 S DIR("B")=$G(BICOLL)
"RTN","BILOT2",78,0)
 D ^DIR
"RTN","BILOT2",79,0)
 S:(Y>0) BICOLL=Y
"RTN","BILOT2",80,0)
 ;
"RTN","BILOT2",81,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BILOT2",82,0)
 ;---> Make Display Inactives a separate Action.
"RTN","BILOT2",83,0)
 ;I Y="^" D RESET^BILOT1 Q
"RTN","BILOT2",84,0)
 D RESET^BILOT1
"RTN","BILOT2",85,0)
 Q
"RTN","BILOT2",86,0)
 ;
"RTN","BILOT2",87,0)
 ;
"RTN","BILOT2",88,0)
 ;----------
"RTN","BILOT2",89,0)
DISPLYI ;EP
"RTN","BILOT2",90,0)
 ;---> Display Inactive Lot Numbers.
"RTN","BILOT2",91,0)
 ;---> Called by Protocol:
"RTN","BILOT2",92,0)
 ;
"RTN","BILOT2",93,0)
 D FULL^VALM1,TITLE^BIUTL5("DISPLAY INACTIVE LOT NUMBERS YES/NO")
"RTN","BILOT2",94,0)
 W !!,"   Do you wish to include INACTIVE Lots in this display?"
"RTN","BILOT2",95,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BILOT2",96,0)
 ;---> Remove leftover "NO" prompt by N DIR.
"RTN","BILOT2",97,0)
 N DIR
"RTN","BILOT2",98,0)
 ;**********
"RTN","BILOT2",99,0)
 S DIR("?")="     Enter YES to include INACTIVE Lots."
"RTN","BILOT2",100,0)
 S DIR(0)="Y",DIR("A")="   Enter Yes or No",DIR("B")="NO"
"RTN","BILOT2",101,0)
 D ^DIR
"RTN","BILOT2",102,0)
 S BIINACT=$S(Y>0:1,1:0)
"RTN","BILOT2",103,0)
 D RESET^BILOT1
"RTN","BILOT2",104,0)
 Q
"RTN","BILOT2",105,0)
 ;**********
"RTN","BIMFI")
0^54^B8271751
"RTN","BIMFI",1,0)
BIMFI ;IHS/CMI/MWR - MFI INTERFACE CODE; MAY 10, 2010
"RTN","BIMFI",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIMFI",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIMFI",4,0)
 ;;  CODE FOR MFI INTERFACE WITH MACHINES STILL USING OLD IHS CODES.
"RTN","BIMFI",5,0)
 ;
"RTN","BIMFI",6,0)
 ;
"RTN","BIMFI",7,0)
 ;----------
"RTN","BIMFI",8,0)
INBOUND(BIMSG) ;EP
"RTN","BIMFI",9,0)
 ;---> Translate Inbound Vaccine carrying Old IHS Code to HL7 Code
"RTN","BIMFI",10,0)
 ;---> by scanning Inbound Message and replacing Old IHS Code
"RTN","BIMFI",11,0)
 ;---> with HL7 Code.
"RTN","BIMFI",12,0)
 ;---> Called by ^APMFPRM.
"RTN","BIMFI",13,0)
 ;---> Parameters:
"RTN","BIMFI",14,0)
 ;     1 - BIMSG (req) IEN of Inbound Immunization Visit Filegram
"RTN","BIMFI",15,0)
 ;                     in ^XMB(3.9.
"RTN","BIMFI",16,0)
 Q:$$CHECK(BIMSG)
"RTN","BIMFI",17,0)
 ;
"RTN","BIMFI",18,0)
 N BIN S BIN=1
"RTN","BIMFI",19,0)
 F  S BIN=$O(^XMB(3.9,BIMSG,2,BIN)) Q:'BIN  D
"RTN","BIMFI",20,0)
 .Q:^XMB(3.9,BIMSG,2,BIN,0)'["BEGIN:IMMUNIZATION^9999999.14"
"RTN","BIMFI",21,0)
 .S BIN=BIN+1
"RTN","BIMFI",22,0)
 .N BIX S BIX=^XMB(3.9,BIMSG,2,BIN,0)
"RTN","BIMFI",23,0)
 .Q:BIX'["KEY:CODE^.03^C="
"RTN","BIMFI",24,0)
 .;
"RTN","BIMFI",25,0)
 .;---> BIOLD=Old IHS Code.
"RTN","BIMFI",26,0)
 .N BIOLD S BIOLD=$P(BIX,"=",2)
"RTN","BIMFI",27,0)
 .;
"RTN","BIMFI",28,0)
 .;---> Quit if no match for this IHS Code.
"RTN","BIMFI",29,0)
 .Q:'$D(^AUTTIMM("AZ",BIOLD))
"RTN","BIMFI",30,0)
 .;
"RTN","BIMFI",31,0)
 .;---> Set BIDA=IEN of Vaccine, based on Old IHS Code (in X).
"RTN","BIMFI",32,0)
 .N BIDA S BIDA=$O(^AUTTIMM("AZ",BIOLD,0))
"RTN","BIMFI",33,0)
 .;
"RTN","BIMFI",34,0)
 .;---> Quit if entry doesn't exist.
"RTN","BIMFI",35,0)
 .Q:'$D(^AUTTIMM(BIDA,0))
"RTN","BIMFI",36,0)
 .;
"RTN","BIMFI",37,0)
 .;---> BINEW=New HL7 Code
"RTN","BIMFI",38,0)
 .N BINEW S BINEW=$P(^AUTTIMM(BIDA,0),U,3)
"RTN","BIMFI",39,0)
 .Q:'BINEW
"RTN","BIMFI",40,0)
 .;
"RTN","BIMFI",41,0)
 .;---> Replace Old IHS Code in Message with New HL7 Code.
"RTN","BIMFI",42,0)
 .S $P(^XMB(3.9,BIMSG,2,BIN,0),"=",2)=BINEW
"RTN","BIMFI",43,0)
 Q
"RTN","BIMFI",44,0)
 ;
"RTN","BIMFI",45,0)
 ;
"RTN","BIMFI",46,0)
 ;
"RTN","BIMFI",47,0)
 ;----------
"RTN","BIMFI",48,0)
OUTBOUND(BIMSG) ;EP
"RTN","BIMFI",49,0)
 ;---> Translate Outbound Vaccine carrying New HL7 Code to
"RTN","BIMFI",50,0)
 ;---> Old IHS Code by scanning Outbound Message and replacing
"RTN","BIMFI",51,0)
 ;---> HL7 Code with Old IHS Code.
"RTN","BIMFI",52,0)
 ;---> Called by ^APMFVFG.
"RTN","BIMFI",53,0)
 ;---> Parameters:
"RTN","BIMFI",54,0)
 ;     1 - BIMSG (req) IEN of Outbound Immunization Visit Filegram
"RTN","BIMFI",55,0)
 ;                     in ^XMB(3.9.
"RTN","BIMFI",56,0)
 Q:$$CHECK(BIMSG)
"RTN","BIMFI",57,0)
 ;
"RTN","BIMFI",58,0)
 N BIN S BIN=1
"RTN","BIMFI",59,0)
 F  S BIN=$O(^XMB(3.9,BIMSG,2,BIN)) Q:'BIN  D
"RTN","BIMFI",60,0)
 .Q:^XMB(3.9,BIMSG,2,BIN,0)'["BEGIN:IMMUNIZATION^9999999.14"
"RTN","BIMFI",61,0)
 .S BIN=BIN+1
"RTN","BIMFI",62,0)
 .N BIX S BIX=^XMB(3.9,BIMSG,2,BIN,0)
"RTN","BIMFI",63,0)
 .Q:BIX'["KEY:HL7 CODE^.03^C="
"RTN","BIMFI",64,0)
 .;
"RTN","BIMFI",65,0)
 .;---> BIOLD=Old IHS Code.
"RTN","BIMFI",66,0)
 .N BIHL7 S BIHL7=$P(BIX,"=",2)
"RTN","BIMFI",67,0)
 .;
"RTN","BIMFI",68,0)
 .;---> Quit if no match for this IHS Code.
"RTN","BIMFI",69,0)
 .Q:'$D(^AUTTIMM("C",BIHL7))
"RTN","BIMFI",70,0)
 .;
"RTN","BIMFI",71,0)
 .;---> Set BIDA=IEN of Vaccine, based on Old IHS Code (in X).
"RTN","BIMFI",72,0)
 .N BIDA S BIDA=$O(^AUTTIMM("C",BIHL7,0))
"RTN","BIMFI",73,0)
 .;
"RTN","BIMFI",74,0)
 .;---> Quit if entry doesn't exist.
"RTN","BIMFI",75,0)
 .Q:'$D(^AUTTIMM(BIDA,0))
"RTN","BIMFI",76,0)
 .;
"RTN","BIMFI",77,0)
 .;---> BINEW=Old IHS Code.
"RTN","BIMFI",78,0)
 .N BINEW S BINEW=$P(^AUTTIMM(BIDA,0),U,20)
"RTN","BIMFI",79,0)
 .Q:BINEW=""
"RTN","BIMFI",80,0)
 .;
"RTN","BIMFI",81,0)
 .;---> Replace New HL7 Code in Message with Old IHS Code.
"RTN","BIMFI",82,0)
 .S $P(^XMB(3.9,BIMSG,2,BIN,0),"KEY:",2)="CODE^.03^C="_BINEW
"RTN","BIMFI",83,0)
 Q
"RTN","BIMFI",84,0)
 ;
"RTN","BIMFI",85,0)
 ;
"RTN","BIMFI",86,0)
 ;----------
"RTN","BIMFI",87,0)
CHECK(BIMSG) ;EP
"RTN","BIMFI",88,0)
 ;---> Check required variables.
"RTN","BIMFI",89,0)
 ;---> Parameters:
"RTN","BIMFI",90,0)
 ;     1 - BIMSG (req) IEN of Immunization Visit Filegram
"RTN","BIMFI",91,0)
 ;
"RTN","BIMFI",92,0)
 ;---> Get Site IEN.
"RTN","BIMFI",93,0)
 S BIDUZ2=$G(DUZ(2))
"RTN","BIMFI",94,0)
 I 'BIDUZ2 Q:'$G(^AUTTSITE(1,0))  S BIDUZ2=+^(0)
"RTN","BIMFI",95,0)
 Q:'BIDUZ2 1
"RTN","BIMFI",96,0)
 ;
"RTN","BIMFI",97,0)
 ;---> Quit if Site Parameter says to send HL7 Standard Codes.
"RTN","BIMFI",98,0)
 Q:$P($G(^BISITE(BIDUZ2,0)),U,20) 1
"RTN","BIMFI",99,0)
 ;
"RTN","BIMFI",100,0)
 ;---> Quit if Message does not exist.
"RTN","BIMFI",101,0)
 Q:'$D(^XMB(3.9,BIMSG,2)) 1
"RTN","BIMFI",102,0)
 ;
"RTN","BIMFI",103,0)
 ;---> All okay.
"RTN","BIMFI",104,0)
 Q 0
"RTN","BINDC")
0^55^B48072258
"RTN","BINDC",1,0)
BINDC ;IHS/CMI/MWR - EDIT NDC CODES.; MAY 10, 2010
"RTN","BINDC",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BINDC",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BINDC",4,0)
 ;;  EDIT NDC NUMBER FIELDS.
"RTN","BINDC",5,0)
 ;   PATCH 2: Redisplay Message area (with # of NDCs) in List Template. HELP+5
"RTN","BINDC",6,0)
 ;
"RTN","BINDC",7,0)
 ;
"RTN","BINDC",8,0)
 ;
"RTN","BINDC",9,0)
 ;----------
"RTN","BINDC",10,0)
START ;EP
"RTN","BINDC",11,0)
 ;---> Lookup NDC CODES and edit their fields.  vvv83
"RTN","BINDC",12,0)
 D SETVARS^BIUTL5 K ^TMP("BINDC",$J) N BICOLL,BISUBT,BITMP,BIINACT
"RTN","BINDC",13,0)
 S BISUBT="1:NDC Code;2:Vaccine Name, then by NDC Code"
"RTN","BINDC",14,0)
 ;S BISUBT=BISUBT_";5:Vaccine Name, then by Exp Date"
"RTN","BINDC",15,0)
 ;
"RTN","BINDC",16,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BINDC",17,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BINDC",18,0)
 ;
"RTN","BINDC",19,0)
 D EN
"RTN","BINDC",20,0)
 D EXIT
"RTN","BINDC",21,0)
 Q
"RTN","BINDC",22,0)
 ;
"RTN","BINDC",23,0)
 ;
"RTN","BINDC",24,0)
 ;----------
"RTN","BINDC",25,0)
EN ;EP
"RTN","BINDC",26,0)
 D EN^VALM("BI NDC TABLE EDIT")
"RTN","BINDC",27,0)
 Q
"RTN","BINDC",28,0)
 ;
"RTN","BINDC",29,0)
 ;
"RTN","BINDC",30,0)
 ;----------
"RTN","BINDC",31,0)
PRINT ;EP
"RTN","BINDC",32,0)
 ;---> Print NDC Number Table.
"RTN","BINDC",33,0)
 ;---> Called by Protocol BI NDC NUMBER TABLE PRINT, which is the
"RTN","BINDC",34,0)
 ;---> Print List Protocol for the List: BI NDC NUMBER TABLE EDIT.
"RTN","BINDC",35,0)
 ;
"RTN","BINDC",36,0)
 D DEVICE(.BIPOP)
"RTN","BINDC",37,0)
 I $G(BIPOP) D RESET Q
"RTN","BINDC",38,0)
 ;
"RTN","BINDC",39,0)
 D HDR(1),INIT^BINDC1
"RTN","BINDC",40,0)
 D PRTLST^BIUTL8("BINDC")
"RTN","BINDC",41,0)
 D RESET
"RTN","BINDC",42,0)
 Q
"RTN","BINDC",43,0)
 ;
"RTN","BINDC",44,0)
 ;
"RTN","BINDC",45,0)
 ;----------
"RTN","BINDC",46,0)
HDR(BIPRT) ;EP
"RTN","BINDC",47,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BINDC",48,0)
 ;---> Parameters:
"RTN","BINDC",49,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Change column
"RTN","BINDC",50,0)
 ;                      header line and add Site Header line.
"RTN","BINDC",51,0)
 ;
"RTN","BINDC",52,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BINDC",53,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BINDC",54,0)
 ;
"RTN","BINDC",55,0)
 D WH^BIW(.BILINE)
"RTN","BINDC",56,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BINDC",57,0)
 D WH^BIW(.BILINE,X)
"RTN","BINDC",58,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BINDC",59,0)
 D WH^BIW(.BILINE,X)
"RTN","BINDC",60,0)
 ;
"RTN","BINDC",61,0)
 S X="NDC NUMBER TABLE" S:'$G(BIPRT) X="EDIT "_X
"RTN","BINDC",62,0)
 D CENTERT^BIUTL5(.X)
"RTN","BINDC",63,0)
 S:BICRT X=IOINHI_X_IOINORM
"RTN","BINDC",64,0)
 D WH^BIW(.BILINE,X)
"RTN","BINDC",65,0)
 ;
"RTN","BINDC",66,0)
 ;---> Subtitle: indicate order of listing.
"RTN","BINDC",67,0)
 D:($G(BICOLL)&$D(BISUBT))
"RTN","BINDC",68,0)
 .N Y S Y=$P($P(BISUBT,BICOLL_":",2),";") S X=" (Listed by "_Y_")"
"RTN","BINDC",69,0)
 .D CENTERT^BIUTL5(.X) S:BICRT X=IOINHI_X_IOINORM D WH^BIW(.BILINE,X)
"RTN","BINDC",70,0)
 ;
"RTN","BINDC",71,0)
 D:$G(BIPRT)
"RTN","BINDC",72,0)
 .S X=$$SP^BIUTL5(51)_"Printed: "_$$NOW^BIUTL5()
"RTN","BINDC",73,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BINDC",74,0)
 .S X="  #  NDC Code         Vaccine     CVX  Manufacturer  Product         Status"
"RTN","BINDC",75,0)
 .D WH^BIW(.BILINE,X)
"RTN","BINDC",76,0)
 Q
"RTN","BINDC",77,0)
 ;
"RTN","BINDC",78,0)
 ;
"RTN","BINDC",79,0)
 ;----------
"RTN","BINDC",80,0)
INIT ;EP
"RTN","BINDC",81,0)
 ;---> Initialize variables and list array.
"RTN","BINDC",82,0)
 D INIT^BINDC1
"RTN","BINDC",83,0)
 Q
"RTN","BINDC",84,0)
 ;
"RTN","BINDC",85,0)
 ;
"RTN","BINDC",86,0)
 ;----------
"RTN","BINDC",87,0)
RESET ;EP
"RTN","BINDC",88,0)
 ;---> Update partition for return to Listmanager.
"RTN","BINDC",89,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BINDC",90,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BINDC",91,0)
 D INIT,HDR() Q
"RTN","BINDC",92,0)
 ;
"RTN","BINDC",93,0)
 ;
"RTN","BINDC",94,0)
 ;----------
"RTN","BINDC",95,0)
DEVICE(BIPOP) ;EP
"RTN","BINDC",96,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BINDC",97,0)
 ;---> Parameters:
"RTN","BINDC",98,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BINDC",99,0)
 ;
"RTN","BINDC",100,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BINDC",101,0)
 S ZTRTN="DEQUEUE^BINDC"
"RTN","BINDC",102,0)
 D ZSAVES^BIUTL3
"RTN","BINDC",103,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BINDC",104,0)
 Q
"RTN","BINDC",105,0)
 ;
"RTN","BINDC",106,0)
 ;
"RTN","BINDC",107,0)
 ;----------
"RTN","BINDC",108,0)
DEQUEUE ;EP
"RTN","BINDC",109,0)
 ;---> Print Patient Data screen.
"RTN","BINDC",110,0)
 D HDR(1),INIT^BINDC1
"RTN","BINDC",111,0)
 D PRTLST^BIUTL8("BINDC"),EXIT
"RTN","BINDC",112,0)
 Q
"RTN","BINDC",113,0)
 ;
"RTN","BINDC",114,0)
 ;
"RTN","BINDC",115,0)
 ;----------
"RTN","BINDC",116,0)
HELP ;EP
"RTN","BINDC",117,0)
 ;---> Help code.
"RTN","BINDC",118,0)
 N BIX S BIX=X
"RTN","BINDC",119,0)
 D FULL^VALM1
"RTN","BINDC",120,0)
 W !!?5,"Enter ""A"" to add or edit an NDC Code, enter ""E"" to select and Edit an"
"RTN","BINDC",121,0)
 W !?5,"NDC Code from the left column, enter ""C"" to change the order of the list,"
"RTN","BINDC",122,0)
 W !?5,"""S"" to Search for a particular NDC Code, ""D"" to include NDC Codes"
"RTN","BINDC",123,0)
 W !?5,"in the display (will appear after all Active Lot Numbers),and enter ""H"""
"RTN","BINDC",124,0)
 W !?5,"to view the full help text for the NDC list and its parameters."
"RTN","BINDC",125,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BINDC",126,0)
 D:BIX'="??" RE^VALM4
"RTN","BINDC",127,0)
 Q
"RTN","BINDC",128,0)
 ;
"RTN","BINDC",129,0)
 ;
"RTN","BINDC",130,0)
 ;----------
"RTN","BINDC",131,0)
HELP1 ;EP
"RTN","BINDC",132,0)
 ;----> Explanation of this report.
"RTN","BINDC",133,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BINDC",134,0)
 D START^BIHELP("EDIT NDC CODES - HELP",.BITEXT)
"RTN","BINDC",135,0)
 ;
"RTN","BINDC",136,0)
 ;---> Redisplay Message area (with number of NDCs) in List Template.
"RTN","BINDC",137,0)
 D RESET^BINDC1
"RTN","BINDC",138,0)
 Q
"RTN","BINDC",139,0)
 ;
"RTN","BINDC",140,0)
 ;   vvv83
"RTN","BINDC",141,0)
 ;----------
"RTN","BINDC",142,0)
TEXT1(BITEXT) ;EP
"RTN","BINDC",143,0)
 ;;
"RTN","BINDC",144,0)
 ;;This screen allows you to view and edit the fields of NDC CODES.
"RTN","BINDC",145,0)
 ;;
"RTN","BINDC",146,0)
 ;;NOTE: To show INACTIVE NDC CODES, select "D Display Inactives."
"RTN","BINDC",147,0)
 ;;
"RTN","BINDC",148,0)
 ;;To Add a new NDC Number, type "A".  If the NDC Number already exists in
"RTN","BINDC",149,0)
 ;;the Table, a message will display, directng you select that NDC Number
"RTN","BINDC",150,0)
 ;;for editing.
"RTN","BINDC",151,0)
 ;;
"RTN","BINDC",152,0)
 ;;To edit an existing NDC Number type "E" and then select the left column
"RTN","BINDC",153,0)
 ;;number that corresponds to the NDC Number you wish to edit.
"RTN","BINDC",154,0)
 ;;
"RTN","BINDC",155,0)
 ;;You may also SEARCH the entire list for any number, name, or combination
"RTN","BINDC",156,0)
 ;;of characters by usinng the "S Search List" action.
"RTN","BINDC",157,0)
 ;;
"RTN","BINDC",158,0)
 ;;You may list the NDCs by either NDC Code or Vaccine (alphabetically) using
"RTN","BINDC",159,0)
 ;;the Change List Order action.
"RTN","BINDC",160,0)
 ;;
"RTN","BINDC",161,0)
 ;;
"RTN","BINDC",162,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BINDC",163,0)
 Q
"RTN","BINDC",164,0)
 ;
"RTN","BINDC",165,0)
 ;
"RTN","BINDC",166,0)
 ;----------
"RTN","BINDC",167,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BINDC",168,0)
 Q:$G(BILINL)=""
"RTN","BINDC",169,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BINDC",170,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BINDC",171,0)
 Q
"RTN","BINDC",172,0)
 ;
"RTN","BINDC",173,0)
 ;
"RTN","BINDC",174,0)
 ;----------
"RTN","BINDC",175,0)
TEXT3 ;EP
"RTN","BINDC",176,0)
 ;;
"RTN","BINDC",177,0)
 ;;This option will automatically INACTIVATE ALL NDC CODES that
"RTN","BINDC",178,0)
 ;;have EXPIRED (an Expiration Date prior to today).
"RTN","BINDC",179,0)
 ;;
"RTN","BINDC",180,0)
 ;;It will also automatically INACTIVATE ALL NDC CODES that have
"RTN","BINDC",181,0)
 ;;NO Expiration Date (as viewed in the NDC Number Table).
"RTN","BINDC",182,0)
 ;;
"RTN","BINDC",183,0)
 ;;   Note: You can REACTIVATE any NDC Number individually at any time
"RTN","BINDC",184,0)
 ;;   by editing the NDC Number individually from the Edit NDC CODES
"RTN","BINDC",185,0)
 ;;   Screen (and resetting the Active Field for that NDC Number).
"RTN","BINDC",186,0)
 ;;
"RTN","BINDC",187,0)
 ;;Do you wish to INACTIVATE ALL NDC CODES that either have EXPIRED
"RTN","BINDC",188,0)
 ;;or have NO Expiration Date?
"RTN","BINDC",189,0)
 ;;
"RTN","BINDC",190,0)
 D PRINTX("TEXT3")
"RTN","BINDC",191,0)
 Q
"RTN","BINDC",192,0)
 ;
"RTN","BINDC",193,0)
 ;
"RTN","BINDC",194,0)
 ;----------
"RTN","BINDC",195,0)
TEXT33 ;EP
"RTN","BINDC",196,0)
 ;;
"RTN","BINDC",197,0)
 ;;Okay.
"RTN","BINDC",198,0)
 ;;Please confirm that you wish Inactivate all NDC CODES that
"RTN","BINDC",199,0)
 ;;either have EXPIRED or have NO Expiration Eate, by typing "YES"
"RTN","BINDC",200,0)
 ;;a second time.  (Enter NO to discontinue this process.)
"RTN","BINDC",201,0)
 ;;
"RTN","BINDC",202,0)
 D PRINTX("TEXT33")
"RTN","BINDC",203,0)
 Q
"RTN","BINDC",204,0)
 ;
"RTN","BINDC",205,0)
 ;
"RTN","BINDC",206,0)
 ;----------
"RTN","BINDC",207,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BINDC",208,0)
 Q:$G(BILINL)=""
"RTN","BINDC",209,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BINDC",210,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BINDC",211,0)
 Q
"RTN","BINDC",212,0)
 ;
"RTN","BINDC",213,0)
 ;
"RTN","BINDC",214,0)
 ;----------
"RTN","BINDC",215,0)
EXIT ;EP
"RTN","BINDC",216,0)
 ;---> End of job cleanup.
"RTN","BINDC",217,0)
 D KILLALL^BIUTL8()
"RTN","BINDC",218,0)
 K ^TMP("BINDC",$J)
"RTN","BINDC",219,0)
 D CLEAR^VALM1
"RTN","BINDC",220,0)
 D FULL^VALM1
"RTN","BINDC",221,0)
 Q
"RTN","BINDC",222,0)
 ;
"RTN","BINDC",223,0)
 ;
"RTN","BINDC",224,0)
 ;----------
"RTN","BINDC",225,0)
NDC(IEN,FORM) ;EP
"RTN","BINDC",226,0)
 ;---> Return NDC Code values from BI TABLE NDC CODES File.
"RTN","BINDC",227,0)
 ;---> Parameters:
"RTN","BINDC",228,0)
 ;     1 - IEN  (req) IEN of NDC Code.
"RTN","BINDC",229,0)
 ;     2 - FORM (opt) FORM of Code to return:
"RTN","BINDC",230,0)
 ;                        1=Actual NDC Code (also default)
"RTN","BINDC",231,0)
 ;                        2=Vaccine Pointer (use for Vaccine Name or CVX)
"RTN","BINDC",232,0)
 ;                        3=Manufacturer Pointer
"RTN","BINDC",233,0)
 ;                        4=Product Name
"RTN","BINDC",234,0)
 ;                        5=Status
"RTN","BINDC",235,0)
 ;
"RTN","BINDC",236,0)
 Q:'$G(IEN) ""
"RTN","BINDC",237,0)
 Q:'$D(^BINDC(IEN,0)) "NO GLOBAL"
"RTN","BINDC",238,0)
 N Y S Y=^BINDC(IEN,0)
"RTN","BINDC",239,0)
 ;
"RTN","BINDC",240,0)
 Q:$G(FORM)=2 $P(Y,U,2)
"RTN","BINDC",241,0)
 Q:$G(FORM)=3 $P(Y,U,3)
"RTN","BINDC",242,0)
 Q:$G(FORM)=4 $P(Y,U,4)
"RTN","BINDC",243,0)
 Q:$G(FORM)=5 $P(Y,U,5)
"RTN","BINDC",244,0)
 Q $P(Y,U)
"RTN","BINDC1")
0^56^B110347257
"RTN","BINDC1",1,0)
BINDC1 ;IHS/CMI/MWR - EDIT NDC NUMBERS.; MAY 10, 2010
"RTN","BINDC1",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BINDC1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BINDC1",4,0)
 ;;  EDIT NDC NUMBER FIELDS.
"RTN","BINDC1",5,0)
 ;
"RTN","BINDC1",6,0)
 ;
"RTN","BINDC1",7,0)
 ;----------
"RTN","BINDC1",8,0)
INIT ;EP
"RTN","BINDC1",9,0)
 ;---> Initialize variables and list array.
"RTN","BINDC1",10,0)
 ;
"RTN","BINDC1",11,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BINDC1",12,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BINDC1",13,0)
 ;
"RTN","BINDC1",14,0)
 ;---> Build Listmanager array.
"RTN","BINDC1",15,0)
 K ^TMP("BINDC",$J),BINDC,BITMP
"RTN","BINDC1",16,0)
 N BIENT,BILINE,BITMP S BIENT=0,BILINE=0
"RTN","BINDC1",17,0)
 ;---> BICOLL=Order of Listing (see linelabel CHGORDR below.
"RTN","BINDC1",18,0)
 S:'$G(BICOLL) BICOLL=1
"RTN","BINDC1",19,0)
 ;---> Exclude inactive NDCs unless BIINACT=1.  vvv83
"RTN","BINDC1",20,0)
 S:'$G(BIINACT) BIINACT=0
"RTN","BINDC1",21,0)
 ;
"RTN","BINDC1",22,0)
 N BIIEN S BIIEN=0
"RTN","BINDC1",23,0)
 F  S BIIEN=$O(^BINDC(BIIEN)) Q:'BIIEN  D
"RTN","BINDC1",24,0)
 .I '$D(^BINDC(BIIEN,0)) K ^BINDC(BIIEN) Q
"RTN","BINDC1",25,0)
 .N BINDC,BIVACP,BIVNAM,BICVX,BIMAN,BIPROD,BIACT,W,X,Y,Z
"RTN","BINDC1",26,0)
 .S Y=^BINDC(BIIEN,0),BINDC=$P(Y,U),BIVACP=+$P(Y,U,2)
"RTN","BINDC1",27,0)
 .S BIVNAM=$$VNAME^BIUTL2(BIVACP)
"RTN","BINDC1",28,0)
 .S BICVX=$$CODE^BIUTL2(BIVACP,6) S:BICVX="" BICVX=999
"RTN","BINDC1",29,0)
 .S BIPROD=$E($P(Y,U,4),1,12) S:BIPROD="" BIPROD="Not Recorded"
"RTN","BINDC1",30,0)
 .S BIMAN=+$P(Y,U,3),BIMAN=$$MNAME^BIUTL2(BIMAN)
"RTN","BINDC1",31,0)
 .S BIACT=+$P(Y,U,6) ;1=inactive
"RTN","BINDC1",32,0)
 .;---> Quit if excluding Inactive NDCs.
"RTN","BINDC1",33,0)
 .Q:('BIINACT&BIACT=1)
"RTN","BINDC1",34,0)
 .;---> If no Exp Date, set Exp Date=last in list.
"RTN","BINDC1",35,0)
 .;Future, if Exp Date: S BIEXP=+$P(Y,U,?) S:'BIEXP BIEXP=9999999
"RTN","BINDC1",36,0)
 .D
"RTN","BINDC1",37,0)
 ..I BICOLL=2 S W=BIVNAM,X=BINDC,Y=BIPROD,Z=BIMAN Q
"RTN","BINDC1",38,0)
 ..S W=BINDC,X=BIVNAM,Y=BIPROD,Z=BIMAN Q
"RTN","BINDC1",39,0)
 ..;---> Other possible orders:
"RTN","BINDC1",40,0)
 ..;I BICOLL=3 S W=BINDC,X=BIVNAM,Y=BIEXP,Z=BICVX Q
"RTN","BINDC1",41,0)
 ..;I BICOLL=4 S W=BIVNAM,X=BICVX,Y=BIEXP,Z=BINDC Q
"RTN","BINDC1",42,0)
 .S BITMP(BIACT,W,X,Y,Z,BIIEN)=BIIEN
"RTN","BINDC1",43,0)
 ;
"RTN","BINDC1",44,0)
 N N S N="" F  S N=$O(BITMP(N)) Q:(N="")  D
"RTN","BINDC1",45,0)
 .;---> Place a linefeed between Active and Inactive.
"RTN","BINDC1",46,0)
 .I N D WRITE(.BILINE,,,BIENT)
"RTN","BINDC1",47,0)
 .;
"RTN","BINDC1",48,0)
 .N M S M="" F  S M=$O(BITMP(N,M)) Q:(M="")  D
"RTN","BINDC1",49,0)
 ..N L S L="" F  S L=$O(BITMP(N,M,L)) Q:(L="")  D
"RTN","BINDC1",50,0)
 ...N K S K="" F  S K=$O(BITMP(N,M,L,K)) Q:(K="")  D
"RTN","BINDC1",51,0)
 ....N J S J="" F  S J=$O(BITMP(N,M,L,K,J)) Q:(J="")  D
"RTN","BINDC1",52,0)
 .....N P S P="" F  S P=$O(BITMP(N,M,L,K,J,P)) Q:(P="")  D
"RTN","BINDC1",53,0)
 ......D LINE(BITMP(N,M,L,K,J,P),.BILINE,.BIENT)
"RTN","BINDC1",54,0)
 ;
"RTN","BINDC1",55,0)
 ;---> Finish up Listmanager List Count.
"RTN","BINDC1",56,0)
 S VALMCNT=BILINE
"RTN","BINDC1",57,0)
 I VALMCNT>12 D
"RTN","BINDC1",58,0)
 .;
"RTN","BINDC1",59,0)
 .;---> Display number of NDCs in list.
"RTN","BINDC1",60,0)
 .N Y S Y=VALMCNT S:$G(BIINACT) Y=Y-1
"RTN","BINDC1",61,0)
 .S VALMSG=Y_" NDCs: Scroll down to view more, or type ??."
"RTN","BINDC1",62,0)
 Q
"RTN","BINDC1",63,0)
 ;
"RTN","BINDC1",64,0)
 ;
"RTN","BINDC1",65,0)
 ;----------
"RTN","BINDC1",66,0)
LINE(BIIEN,BILINE,BIENT) ;EP
"RTN","BINDC1",67,0)
 ;---> Gather data for each NDC and write to ^TMP.
"RTN","BINDC1",68,0)
 ;---> Parameters:
"RTN","BINDC1",69,0)
 ;     1 - BIIEN  (req) IEN of NDC.
"RTN","BINDC1",70,0)
 ;     2 - BILINE (ret) Last line# written.
"RTN","BINDC1",71,0)
 ;     3 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BINDC1",72,0)
 ;
"RTN","BINDC1",73,0)
 N BI0,X,Y
"RTN","BINDC1",74,0)
 S BI0=^BINDC(BIIEN,0)
"RTN","BINDC1",75,0)
 ;
"RTN","BINDC1",76,0)
 ;---> Set Item# and build Item# array=IEN of Vaccine.
"RTN","BINDC1",77,0)
 S BIENT=BIENT+1,BINDC(BIENT)=BIIEN
"RTN","BINDC1",78,0)
 ;
"RTN","BINDC1",79,0)
 ;---> Item#.
"RTN","BINDC1",80,0)
 S X=" "_$S(BIENT<10:" "_BIENT,1:BIENT)
"RTN","BINDC1",81,0)
 ;
"RTN","BINDC1",82,0)
 ;---> NDC Code.
"RTN","BINDC1",83,0)
 S X=X_"  "_$P(BI0,U)
"RTN","BINDC1",84,0)
 S X=$$PAD^BIUTL5(X,21,".")
"RTN","BINDC1",85,0)
 ;
"RTN","BINDC1",86,0)
 ;---> Vaccine.
"RTN","BINDC1",87,0)
 N BIVACP S BIVACP=+$P(BI0,U,2)
"RTN","BINDC1",88,0)
 D
"RTN","BINDC1",89,0)
 .I 'BIVACP S X=X_"UNKNOWN" Q
"RTN","BINDC1",90,0)
 .S X=X_$$VNAME^BIUTL2(BIVACP)
"RTN","BINDC1",91,0)
 S X=$$PAD^BIUTL5(X,32,".")
"RTN","BINDC1",92,0)
 ;
"RTN","BINDC1",93,0)
 ;---> CVX.
"RTN","BINDC1",94,0)
 N BICVX S BICVX=$$CODE^BIUTL2(BIVACP,6) S:('BICVX) BICVX="UNK"
"RTN","BINDC1",95,0)
 S:($L(BICVX))=1 BICVX=".."_BICVX  S:($L(BICVX))=2 BICVX="."_BICVX
"RTN","BINDC1",96,0)
 S X=X_BICVX
"RTN","BINDC1",97,0)
 S X=$$PAD^BIUTL5(X,38,".")
"RTN","BINDC1",98,0)
 ;
"RTN","BINDC1",99,0)
 ;---> Product.
"RTN","BINDC1",100,0)
 N BIPROD S BIPROD=$E($P(BI0,U,4),1,12) S:BIPROD="" BIPROD="Not Recorded"
"RTN","BINDC1",101,0)
 S X=X_BIPROD
"RTN","BINDC1",102,0)
 S X=$$PAD^BIUTL5(X,53,".")
"RTN","BINDC1",103,0)
 ;
"RTN","BINDC1",104,0)
 ;---> Manufacturer.
"RTN","BINDC1",105,0)
 N BIMAN D
"RTN","BINDC1",106,0)
 .S BIMAN=+$P(BI0,U,3)
"RTN","BINDC1",107,0)
 .I 'BIMAN S BIMAN="Not Recorded" Q
"RTN","BINDC1",108,0)
 .S BIMAN=$E($$MNAME^BIUTL2(BIMAN),1,16)
"RTN","BINDC1",109,0)
 S X=X_BIMAN
"RTN","BINDC1",110,0)
 S X=$$PAD^BIUTL5(X,71,".")
"RTN","BINDC1",111,0)
 ;
"RTN","BINDC1",112,0)
 ;---> Active/Inactive Status.
"RTN","BINDC1",113,0)
 S X=X_$S($P(BI0,U,6)=1:"Inactive",1:"Active")
"RTN","BINDC1",114,0)
 ;
"RTN","BINDC1",115,0)
 ;---> Set this Vaccine display row and index in ^TMP.
"RTN","BINDC1",116,0)
 D WRITE(.BILINE,X,,BIENT)
"RTN","BINDC1",117,0)
 Q
"RTN","BINDC1",118,0)
 ;
"RTN","BINDC1",119,0)
 ;
"RTN","BINDC1",120,0)
 ;----------
"RTN","BINDC1",121,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BINDC1",122,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BINDC1",123,0)
 ;---> Parameters:
"RTN","BINDC1",124,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BINDC1",125,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BINDC1",126,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BINDC1",127,0)
 ;     4 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BINDC1",128,0)
 ;
"RTN","BINDC1",129,0)
 Q:'$D(BILINE)
"RTN","BINDC1",130,0)
 D WL^BIW(.BILINE,"BINDC",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BINDC1",131,0)
 Q
"RTN","BINDC1",132,0)
 ;
"RTN","BINDC1",133,0)
 ;
"RTN","BINDC1",134,0)
 ;----------
"RTN","BINDC1",135,0)
EDITNDC(BINEW) ;EP
"RTN","BINDC1",136,0)
 ;---> Add or Edit an NDC Number.
"RTN","BINDC1",137,0)
 ;---> Parameters:
"RTN","BINDC1",138,0)
 ;     2 - BINEW (opt) 1=new NDC number being added; 0/""=edit.
"RTN","BINDC1",139,0)
 ;
"RTN","BINDC1",140,0)
 N BIDA
"RTN","BINDC1",141,0)
 ;---> If BINEW, add a new NDC Number and quit.
"RTN","BINDC1",142,0)
 ;I $G(BINEW) D EDITSCR(,1) D RESET Q
"RTN","BINDC1",143,0)
 I $G(BINEW) D  Q
"RTN","BINDC1",144,0)
 .D ADDFM
"RTN","BINDC1",145,0)
 .D FULL^VALM1,RESET
"RTN","BINDC1",146,0)
 ;
"RTN","BINDC1",147,0)
 ;---> This is an Edit, so continue.
"RTN","BINDC1",148,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BINDC1",149,0)
 N VALMY
"RTN","BINDC1",150,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BINDC1",151,0)
 ;
"RTN","BINDC1",152,0)
 ;---> Check that a Listman Item was passed.
"RTN","BINDC1",153,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BINDC1",154,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BINDC1",155,0)
 N Y S Y=$O(VALMY(0))
"RTN","BINDC1",156,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BINDC1",157,0)
 I $G(BINDC(Y))="" D ERRCD^BIUTL2(511,,1) D RESET Q
"RTN","BINDC1",158,0)
 N BIDA S BIDA=+BINDC(Y)
"RTN","BINDC1",159,0)
 I $G(^BINDC(BIDA,0))="" D ERRCD^BIUTL2(515,,1) D RESET Q
"RTN","BINDC1",160,0)
 ;---> Use next line and called code if you want to use Screenman.
"RTN","BINDC1",161,0)
 ;D EDITSCR(+BINDC(Y))
"RTN","BINDC1",162,0)
 D EDITFM(BIDA)
"RTN","BINDC1",163,0)
 D FULL^VALM1
"RTN","BINDC1",164,0)
 D RESET
"RTN","BINDC1",165,0)
 Q
"RTN","BINDC1",166,0)
 ;
"RTN","BINDC1",167,0)
 ;
"RTN","BINDC1",168,0)
 ;----------
"RTN","BINDC1",169,0)
ADDFM ;EP
"RTN","BINDC1",170,0)
 ;---> Add a new NDC Code by Fileman (not Screenman).
"RTN","BINDC1",171,0)
 ;
"RTN","BINDC1",172,0)
 D SETVARS^BIUTL5
"RTN","BINDC1",173,0)
 N BIDA,DIR,Y
"RTN","BINDC1",174,0)
 F  D  Q:($G(Y)=-1)
"RTN","BINDC1",175,0)
 .D TITLE^BIUTL5("ADD A NEW NDC CODE")
"RTN","BINDC1",176,0)
 .D TEXT1
"RTN","BINDC1",177,0)
 .;
"RTN","BINDC1",178,0)
 .N DIR S DIR(0)="FOA",DIR("A")="     Enter NDC Code: "
"RTN","BINDC1",179,0)
 .S DIR("?")="     Entry must contain 10 or 11 digits and 2 dashes."
"RTN","BINDC1",180,0)
 .D ^DIR
"RTN","BINDC1",181,0)
 .I $D(DIRUT) S Y=-1 Q
"RTN","BINDC1",182,0)
 .S BIENTRY=Y
"RTN","BINDC1",183,0)
 .;---> Pattern match for NDC format. ALT: I $L($P(X,"-")),$L($P(X,"-",2)),$L($P(X,"-",3))
"RTN","BINDC1",184,0)
 .I ($L(BIENTRY)>13)!($L(BIENTRY)<12)!(BIENTRY'?.N1"-".N1"-".N) D  Q
"RTN","BINDC1",185,0)
 ..W !!?5,"Entry must contain 10 or 11 digits and 2 dashes.  Try again."
"RTN","BINDC1",186,0)
 ..N BIPOP D DIRZ^BIUTL3(.BIPOP) S:$G(BIPOP) Y=-1
"RTN","BINDC1",187,0)
 .;
"RTN","BINDC1",188,0)
 .;---> Pattern match is good, now check for duplicate.
"RTN","BINDC1",189,0)
 .;---> If this "new" NDC Number already exists, give opportunity to edit.
"RTN","BINDC1",190,0)
 .I $D(^BINDC("B",BIENTRY)) D  Q
"RTN","BINDC1",191,0)
 ..S BIDA=$O(^BINDC("B",BIENTRY,0))
"RTN","BINDC1",192,0)
 ..D CLEAR^VALM1,FULL^VALM1,TITLE^BIUTL5("ADD A NEW NDC CODE")
"RTN","BINDC1",193,0)
 ..W !!?5,"The NDC Number you entered, ",BIENTRY,", already exists!"
"RTN","BINDC1",194,0)
 ..W !!?5,"NOTE: It may be Inactive. Try displaying Inactive NDC Numbers"
"RTN","BINDC1",195,0)
 ..W !?11,"as well as Active ones."
"RTN","BINDC1",196,0)
 ..W !!?5,"Would you like to edit this NDC Code?"
"RTN","BINDC1",197,0)
 ..S DIR("?")="     Enter YES to edit this NDC Code, or NO to try again."
"RTN","BINDC1",198,0)
 ..S DIR(0)="Y",DIR("A")="     Enter Yes or No",DIR("B")="Yes"
"RTN","BINDC1",199,0)
 ..D ^DIR W !
"RTN","BINDC1",200,0)
 ..I $D(DIRUT)!'Y K BIDA Q
"RTN","BINDC1",201,0)
 ..;---> Edit this NDC, then quit Add loop.
"RTN","BINDC1",202,0)
 ..D EDITFM(BIDA) S Y=-1 Q
"RTN","BINDC1",203,0)
 .;
"RTN","BINDC1",204,0)
 .;---> Okay, so this is a valid NEW NDC Code.  Now get Vaccine/CVX.
"RTN","BINDC1",205,0)
 .D CLEAR^VALM1,FULL^VALM1,TITLE^BIUTL5("ADD A NEW NDC CODE")
"RTN","BINDC1",206,0)
 .W !!?5,"New NDC Code: ",BIENTRY
"RTN","BINDC1",207,0)
 .W !!,"     Please choose the Vaccine/CVX Code associated with this NDC Code.",!
"RTN","BINDC1",208,0)
 .D DIC^BIFMAN(9999999.14,"QEMA",.Y,"     Select Vaccine: ")
"RTN","BINDC1",209,0)
 .I Y<0 K Y Q
"RTN","BINDC1",210,0)
 .N BIVAC S BIVAC=+Y K Y
"RTN","BINDC1",211,0)
 .;---> Now file new NDC Code.
"RTN","BINDC1",212,0)
 .D FILE^BIFMAN(9002084.95,BIENTRY,"ML",".02////"_BIVAC,,.Y)
"RTN","BINDC1",213,0)
 .;---> IF Y<0, CHECK PERMISSIONS.
"RTN","BINDC1",214,0)
 .I Y<0 D ERRCD^BIUTL2(517,,1) S Y=-1 Q
"RTN","BINDC1",215,0)
 .;---> New entry successful, now edit.
"RTN","BINDC1",216,0)
 .S BIDA=+Y
"RTN","BINDC1",217,0)
 .D EDITFM(+BIDA) S Y=-1 Q
"RTN","BINDC1",218,0)
 ;
"RTN","BINDC1",219,0)
 Q
"RTN","BINDC1",220,0)
 ;
"RTN","BINDC1",221,0)
 ;
"RTN","BINDC1",222,0)
 ;----------
"RTN","BINDC1",223,0)
EDITFM(BIDA) ;EP
"RTN","BINDC1",224,0)
 ;---> Edit the fields of am NDC Code by Fileman.
"RTN","BINDC1",225,0)
 ;---> Parameters:
"RTN","BINDC1",226,0)
 ;     1 - BINDC (req) NDC Code IEN.
"RTN","BINDC1",227,0)
 ;
"RTN","BINDC1",228,0)
 ;---> Check that IEN of NDC Code is present.
"RTN","BINDC1",229,0)
 I '$G(BIDA) D ERRCD^BIUTL2(515,,1) Q
"RTN","BINDC1",230,0)
 I '$D(^BINDC(BIDA,0)) D ERRCD^BIUTL2(516,,1) Q
"RTN","BINDC1",231,0)
 N BI0 S BI0=^BINDC(BIDA,0)
"RTN","BINDC1",232,0)
 N BIVACP S BIVACP=+$P(BI0,U,2)
"RTN","BINDC1",233,0)
 D TITLE^BIUTL5("EDIT NDC CODE")
"RTN","BINDC1",234,0)
 W !?5,"     NDC Code: ",$P(BI0,U)
"RTN","BINDC1",235,0)
 W !?5,"      Vaccine: ",$S(BIVACP:$$VNAME^BIUTL2(BIVACP),1:"Not recorded")
"RTN","BINDC1",236,0)
 W !?5,"          CVX: ",$S(BIVACP:$$CODE^BIUTL2(BIVACP,6),1:"")
"RTN","BINDC1",237,0)
 W !?5,"      Product: ",$P(BI0,U,4)
"RTN","BINDC1",238,0)
 W !?5," Manufacturer: " W:+$P(BI0,U,3) $$MNAME^BIUTL2(+$P(BI0,U,3))
"RTN","BINDC1",239,0)
 W !?5,"Active Status: ",$S($P(BI0,U,6):"Inactive",1:"Active"),!!!
"RTN","BINDC1",240,0)
 ;
"RTN","BINDC1",241,0)
 S DR=".02;.04;.03;.06"
"RTN","BINDC1",242,0)
 D DIE^BIFMAN(9002084.95,DR,+BIDA,.BIPOP)
"RTN","BINDC1",243,0)
 Q
"RTN","BINDC1",244,0)
 ;
"RTN","BINDC1",245,0)
 ;
"RTN","BINDC1",246,0)
 ;----------
"RTN","BINDC1",247,0)
RESET ;EP
"RTN","BINDC1",248,0)
 ;---> Update partition for return to Listmanager.
"RTN","BINDC1",249,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BINDC1",250,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BINDC1",251,0)
 D INIT^BINDC,HDR^BINDC()
"RTN","BINDC1",252,0)
 Q
"RTN","BINDC1",253,0)
 ;
"RTN","BINDC1",254,0)
 ;
"RTN","BINDC1",255,0)
 ;----------
"RTN","BINDC1",256,0)
CHGORDR ;EP
"RTN","BINDC1",257,0)
 ;
"RTN","BINDC1",258,0)
 D CHGORDR^BINDC2
"RTN","BINDC1",259,0)
 Q
"RTN","BINDC1",260,0)
 ;
"RTN","BINDC1",261,0)
 ;
"RTN","BINDC1",262,0)
 ;----------
"RTN","BINDC1",263,0)
TEXT1 ;EP
"RTN","BINDC1",264,0)
 ;;The National Drug Code (NDC) is a unique ten- or eleven-digit
"RTN","BINDC1",265,0)
 ;;3-segment numeric identifier, which serves as a universal product
"RTN","BINDC1",266,0)
 ;;identifier for drugs in commercial distribution.
"RTN","BINDC1",267,0)
 ;;
"RTN","BINDC1",268,0)
 ;;The format for an NDC contains three segments of digits,
"RTN","BINDC1",269,0)
 ;;separated by dashes: labeler code - product code - package code.
"RTN","BINDC1",270,0)
 ;;NDC codes occur in the following grouping of digits:
"RTN","BINDC1",271,0)
 ;;   5-4-2, 4-4-2, 5-3-2, or 5-4-1
"RTN","BINDC1",272,0)
 ;;
"RTN","BINDC1",273,0)
 ;;To enter a new NDC code into the Immunization NDC Table, your entry
"RTN","BINDC1",274,0)
 ;;can take any of the above forms; however, it must contain a total of
"RTN","BINDC1",275,0)
 ;;ten or eleven digits and two dashes.
"RTN","BINDC1",276,0)
 ;;
"RTN","BINDC1",277,0)
 ;;
"RTN","BINDC1",278,0)
 D PRINTX("TEXT1")
"RTN","BINDC1",279,0)
 Q
"RTN","BINDC1",280,0)
 ;
"RTN","BINDC1",281,0)
 ;
"RTN","BINDC1",282,0)
 ;----------
"RTN","BINDC1",283,0)
TEXT2 ;EP
"RTN","BINDC1",284,0)
 ;;
"RTN","BINDC1",285,0)
 ;;The NDC Number Table will always be listed with the group of
"RTN","BINDC1",286,0)
 ;;all ACTIVE NDC Numbers first, followed by all INACTIVE NDC Numbers.
"RTN","BINDC1",287,0)
 ;;However, within those two groups you may select the order in which
"RTN","BINDC1",288,0)
 ;;the NDC Numbers are displayed, as follows:
"RTN","BINDC1",289,0)
 ;;
"RTN","BINDC1",290,0)
 ;;   1) By NDC Code (alphanumeric)
"RTN","BINDC1",291,0)
 ;;   2) By Vaccine Name, then by NDC Code
"RTN","BINDC1",292,0)
 ;;
"RTN","BINDC1",293,0)
 D PRINTX("TEXT2")
"RTN","BINDC1",294,0)
 Q
"RTN","BINDC1",295,0)
 ;
"RTN","BINDC1",296,0)
 ;
"RTN","BINDC1",297,0)
 ;----------
"RTN","BINDC1",298,0)
INACTA ;EP
"RTN","BINDC1",299,0)
 ;---> Automatically Inactivate old NDC Numbers that either have expired
"RTN","BINDC1",300,0)
 ;---> or have no Expiration Date.
"RTN","BINDC1",301,0)
 ;
"RTN","BINDC1",302,0)
 D FULL^VALM1,TITLE^BIUTL5("INACTIVATE OLD NDC NUMBERS"),TEXT3^BINDC
"RTN","BINDC1",303,0)
 N DIR,Y D INACTA1
"RTN","BINDC1",304,0)
 D ^DIR
"RTN","BINDC1",305,0)
 S:$D(DIRUT) BIPOP=1
"RTN","BINDC1",306,0)
 I Y'=1 D  Q
"RTN","BINDC1",307,0)
 .W !!?5,"Okay.  NO changes made!"  D DIRZ^BIUTL3()
"RTN","BINDC1",308,0)
 .D RESET
"RTN","BINDC1",309,0)
 ;
"RTN","BINDC1",310,0)
 D TITLE^BIUTL5("INACTIVATE OLD NDC NUMBERS"),TEXT33^BINDC,INACTA1
"RTN","BINDC1",311,0)
 D ^DIR
"RTN","BINDC1",312,0)
 S:$D(DIRUT) BIPOP=1
"RTN","BINDC1",313,0)
 I Y'=1 D  Q
"RTN","BINDC1",314,0)
 .W !!?5,"Okay.  NO changes made!"  D DIRZ^BIUTL3()
"RTN","BINDC1",315,0)
 .D RESET
"RTN","BINDC1",316,0)
 ;
"RTN","BINDC1",317,0)
 D INACTLN
"RTN","BINDC1",318,0)
 D RESET
"RTN","BINDC1",319,0)
 Q
"RTN","BINDC1",320,0)
 ;
"RTN","BINDC1",321,0)
 ;
"RTN","BINDC1",322,0)
 ;----------
"RTN","BINDC1",323,0)
INACTA1 ;EP
"RTN","BINDC1",324,0)
 ;---> Set DIR values for linelabel INACTA.
"RTN","BINDC1",325,0)
 S DIR(0)="YA"
"RTN","BINDC1",326,0)
 S DIR("A")="     Please answer either YES or NO: ",DIR("B")="NO"
"RTN","BINDC1",327,0)
 S DIR("?",1)="     Enter YES to automatically Inactivate NDC Numbers, "
"RTN","BINDC1",328,0)
 S DIR("?")="     enter NO to make no changes."
"RTN","BINDC1",329,0)
 Q
"RTN","BINDC1",330,0)
 ;
"RTN","BINDC1",331,0)
 ;
"RTN","BINDC1",332,0)
 ;----------
"RTN","BINDC1",333,0)
INACTLN ;EP
"RTN","BINDC1",334,0)
 ;---> Inactivate all NDC Numbers that either have expired or have
"RTN","BINDC1",335,0)
 ;---> no Expiration Date.
"RTN","BINDC1",336,0)
 ;
"RTN","BINDC1",337,0)
 D ^XBKVAR
"RTN","BINDC1",338,0)
 N M,N S M=0,N=0
"RTN","BINDC1",339,0)
 F  S N=$O(^BINDC(N)) Q:'N  D
"RTN","BINDC1",340,0)
 .Q:'$D(^BINDC(N,0))
"RTN","BINDC1",341,0)
 .;---> Do not Inactivate if Exp Date is later than Today.
"RTN","BINDC1",342,0)
 .Q:($P(^BINDC(N,0),"^",9)>$G(DT))
"RTN","BINDC1",343,0)
 .;---> Quit if this NDC Number is already Inactive.
"RTN","BINDC1",344,0)
 .Q:($P(^BINDC(N,0),"^",3)=1)
"RTN","BINDC1",345,0)
 .;---> Inactivate this NDC Number.
"RTN","BINDC1",346,0)
 .S $P(^BINDC(N,0),"^",3)=1,M=M+1
"RTN","BINDC1",347,0)
 W !!?5,"Done.  ",M," NDC Numbers have been Inactivated." D DIRZ^BIUTL3()
"RTN","BINDC1",348,0)
 Q
"RTN","BINDC1",349,0)
 ;
"RTN","BINDC1",350,0)
 ;
"RTN","BINDC1",351,0)
 ;----------
"RTN","BINDC1",352,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BINDC1",353,0)
 Q:$G(BILINL)=""
"RTN","BINDC1",354,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BINDC1",355,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BINDC1",356,0)
 Q
"RTN","BINDC2")
0^57^B5010819
"RTN","BINDC2",1,0)
BINDC2 ;IHS/CMI/MWR - EDIT NDC NUMBERS.; MAY 10, 2010
"RTN","BINDC2",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BINDC2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BINDC2",4,0)
 ;;  EDIT VACCINE FIELDS: CURRENT NDC, ACTIVE, VIS DATE DEFAULT.
"RTN","BINDC2",5,0)
 ;   PATCH 2: Make Display Inactives a separate Action.  CHGORDR+11
"RTN","BINDC2",6,0)
 ;   PATCH 3: Correct leftover prompt from Inactive question. DISPLYI+7
"RTN","BINDC2",7,0)
 ;
"RTN","BINDC2",8,0)
 ;
"RTN","BINDC2",9,0)
 ;----------
"RTN","BINDC2",10,0)
NDCDVAL(BIX) ;EP
"RTN","BINDC2",11,0)
 ;---> Sub-Lot data validation for Field 1.5, BI FORM-NDC NUMBER EDIT
"RTN","BINDC2",12,0)
 ;---> Parameters:
"RTN","BINDC2",13,0)
 ;     1 - BIX (req) The value of the Lot Number.
"RTN","BINDC2",14,0)
 ;
"RTN","BINDC2",15,0)
 Q:($G(X)="")  Q:($G(X)=0)
"RTN","BINDC2",16,0)
 ;
"RTN","BINDC2",17,0)
 I $D(^AUTTIML("B",BIX)) D  Q
"RTN","BINDC2",18,0)
 .S DDSSTACK="BI PAGE-NDC DUPLICATE WARNING"
"RTN","BINDC2",19,0)
 .;N Y S Y="This NDC Code already exists.  Please exit and select it from"
"RTN","BINDC2",20,0)
 .;S Y=Y_" the list.  (NOTE: It It may be Inactive. Try displaying Inactive as"
"RTN","BINDC2",21,0)
 .;S Y=Y_"well as Active.)"
"RTN","BINDC2",22,0)
 .;D HLP^DDSUTL(Y) S DDSERROR=1
"RTN","BINDC2",23,0)
 ;
"RTN","BINDC2",24,0)
 I BIX["*" D
"RTN","BINDC2",25,0)
 .S Y="The Lot Number may not contain an asterisk, ""*"". (This symbol is used to"
"RTN","BINDC2",26,0)
 .S Y=Y_" separate the Lot Number from the Sub-lot, if one is appended.)"
"RTN","BINDC2",27,0)
 .D HLP^DDSUTL(Y) S DDSERROR=1
"RTN","BINDC2",28,0)
 Q
"RTN","BINDC2",29,0)
 ;
"RTN","BINDC2",30,0)
 ;
"RTN","BINDC2",31,0)
 ;----------
"RTN","BINDC2",32,0)
CHGORDR ;EP
"RTN","BINDC2",33,0)
 ;---> Menu for selecting Lot listing order.
"RTN","BINDC2",34,0)
 ;
"RTN","BINDC2",35,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT NDC LISTING ORDER"),TEXT2^BINDC1
"RTN","BINDC2",36,0)
 N DIR,Y
"RTN","BINDC2",37,0)
 S DIR(0)="SOA^"_$G(BISUBT)
"RTN","BINDC2",38,0)
 S DIR("A")="     Please select 1 or 2: "
"RTN","BINDC2",39,0)
 S DIR("B")=$G(BICOLL)
"RTN","BINDC2",40,0)
 D ^DIR
"RTN","BINDC2",41,0)
 S:(Y>0) BICOLL=Y
"RTN","BINDC2",42,0)
 ;
"RTN","BINDC2",43,0)
 D RESET^BINDC1
"RTN","BINDC2",44,0)
 Q
"RTN","BINDC2",45,0)
 ;
"RTN","BINDC2",46,0)
 ;
"RTN","BINDC2",47,0)
 ;----------
"RTN","BINDC2",48,0)
DISPLYI ;EP
"RTN","BINDC2",49,0)
 ;---> Display Inactive Lot Numbers.
"RTN","BINDC2",50,0)
 ;---> Called by Protocol:
"RTN","BINDC2",51,0)
 ;
"RTN","BINDC2",52,0)
 D FULL^VALM1,TITLE^BIUTL5("DISPLAY INACTIVE NDC NUMBERS YES/NO")
"RTN","BINDC2",53,0)
 W !!,"   Do you wish to include INACTIVE NDC Codes in this display?"
"RTN","BINDC2",54,0)
 N DIR
"RTN","BINDC2",55,0)
 S DIR("?")="     Enter YES to include INACTIVE NDC Codes."
"RTN","BINDC2",56,0)
 S DIR(0)="Y",DIR("A")="   Enter Yes or No",DIR("B")="NO"
"RTN","BINDC2",57,0)
 D ^DIR
"RTN","BINDC2",58,0)
 S BIINACT=$S(Y>0:1,1:0)
"RTN","BINDC2",59,0)
 D RESET^BINDC1
"RTN","BINDC2",60,0)
 Q
"RTN","BINFO")
0^58^B3651355
"RTN","BINFO",1,0)
BINFO ;IHS/CMI/MWR - VIEW PACKAGE INFORMATION.; MAY 10, 2010
"RTN","BINFO",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BINFO",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BINFO",4,0)
 ;;  VIEW PACKAGE INFORMATION IN LISTMAN.  ALSO, CALLED FROM
"RTN","BINFO",5,0)
 ;;  BIPOST, AFTER PACKAGE INSTALLATION.
"RTN","BINFO",6,0)
 ;
"RTN","BINFO",7,0)
 ;
"RTN","BINFO",8,0)
 ;----------
"RTN","BINFO",9,0)
START ;EP
"RTN","BINFO",10,0)
 D SETVARS^BIUTL5 K ^TMP("BINFO",$J) N BITMP,DIR
"RTN","BINFO",11,0)
 D EN
"RTN","BINFO",12,0)
 D EXIT
"RTN","BINFO",13,0)
 Q
"RTN","BINFO",14,0)
 ;
"RTN","BINFO",15,0)
 ;
"RTN","BINFO",16,0)
 ;----------
"RTN","BINFO",17,0)
EN ;EP
"RTN","BINFO",18,0)
 ;---> Main entry point for option BI REPORT VACCINE TRANSLAT.
"RTN","BINFO",19,0)
 D EN^VALM("BI PACKAGE INFORMATION VIEW")
"RTN","BINFO",20,0)
 Q
"RTN","BINFO",21,0)
 ;
"RTN","BINFO",22,0)
 ;
"RTN","BINFO",23,0)
 ;----------
"RTN","BINFO",24,0)
HDR ;EP
"RTN","BINFO",25,0)
 ;---> Header code.
"RTN","BINFO",26,0)
 N BIDASH,BILINE,X,Y S BILINE=0
"RTN","BINFO",27,0)
 D WH^BIW(.BILINE)
"RTN","BINFO",28,0)
 S X="PACKAGE INFORMATION for IMMUNIZATION, Version "_$$VER^BILOGO
"RTN","BINFO",29,0)
 S BIDASH=$L(X)+2
"RTN","BINFO",30,0)
 D CENTERT^BIUTL5(.X)
"RTN","BINFO",31,0)
 D WH^BIW(.BILINE,X)
"RTN","BINFO",32,0)
 Q
"RTN","BINFO",33,0)
 ;
"RTN","BINFO",34,0)
 ;
"RTN","BINFO",35,0)
 ;----------
"RTN","BINFO",36,0)
INIT ;EP
"RTN","BINFO",37,0)
 ;---> Initialize variables and list array.
"RTN","BINFO",38,0)
 S VALM("TITLE")=" (Immunization v"_$$VER^BILOGO_")"
"RTN","BINFO",39,0)
 ;
"RTN","BINFO",40,0)
 ;---> Gather text from ^BINFO( Word Processing global.
"RTN","BINFO",41,0)
 N BILINE,N
"RTN","BINFO",42,0)
 S BILINE=0,N=0
"RTN","BINFO",43,0)
 F  S N=$O(^BINFO(1,1,N)) Q:'N  D
"RTN","BINFO",44,0)
 .D WL^BIW(.BILINE,"BINFO",$G(^BINFO(1,1,N,0)))
"RTN","BINFO",45,0)
 S VALMCNT=BILINE
"RTN","BINFO",46,0)
 I VALMCNT>15 D
"RTN","BINFO",47,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BINFO",48,0)
 Q
"RTN","BINFO",49,0)
 ;
"RTN","BINFO",50,0)
 ;
"RTN","BINFO",51,0)
 ;----------
"RTN","BINFO",52,0)
RESET ;EP
"RTN","BINFO",53,0)
 ;---> Update partition for return to Listmanager.
"RTN","BINFO",54,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BINFO",55,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BINFO",56,0)
 D INIT,HDR Q
"RTN","BINFO",57,0)
 ;
"RTN","BINFO",58,0)
 ;
"RTN","BINFO",59,0)
 ;----------
"RTN","BINFO",60,0)
HELP ;EP
"RTN","BINFO",61,0)
 ;---> Help code.
"RTN","BINFO",62,0)
 W !!?5,"Use arrow keys to scroll up and down.  "
"RTN","BINFO",63,0)
 W "Enter ?? for more actions."
"RTN","BINFO",64,0)
 D DIRZ^BIUTL3()
"RTN","BINFO",65,0)
 Q
"RTN","BINFO",66,0)
 ;
"RTN","BINFO",67,0)
 ;
"RTN","BINFO",68,0)
 ;----------
"RTN","BINFO",69,0)
EXIT ;EP
"RTN","BINFO",70,0)
 ;---> EOJ cleanup.
"RTN","BINFO",71,0)
 K ^TMP("BINFO",$J)
"RTN","BINFO",72,0)
 D CLEAR^VALM1
"RTN","BINFO",73,0)
 D FULL^VALM1
"RTN","BINFO",74,0)
 Q
"RTN","BINTEG")
0^59^B4929716
"RTN","BINTEG",1,0)
BINTEG ;INTEGRITY CHECKER;OCT 30, 2014
"RTN","BINTEG",2,0)
 ;;8.5;IMMUNIZATION;;OCT 30, 2014;Build 2
"RTN","BINTEG",3,0)
 ;
"RTN","BINTEG",4,0)
START ;
"RTN","BINTEG",5,0)
 NEW BYTE,COUNT,RTN
"RTN","BINTEG",6,0)
 K ^UTILITY($J)
"RTN","BINTEG",7,0)
 F I=1:1 S X=$T(LIST+I) Q:X=""  S X=$P(X,";;",2),R=$P(X,"^",1),B=$P(X,"^",2),C=$P(X,"^",3),^UTILITY($J,R)=B_"^"_C
"RTN","BINTEG",8,0)
 F I=1:1:6 S X=$P($T(@("LINE"_I)),";;",2,99),@("XBSUMBLD("_I_")=X")
"RTN","BINTEG",9,0)
 X XBSUMBLD(1)
"RTN","BINTEG",10,0)
 Q
"RTN","BINTEG",11,0)
 ;
"RTN","BINTEG",12,0)
LINE1 ;;X XBSUMBLD(2),XBSUMBLD(6)
"RTN","BINTEG",13,0)
LINE2 ;;S RTN=0 F  S RTN=$O(^UTILITY($J,RTN)) Q:RTN=""  W !,RTN ZL @RTN S (BYTE,COUNT)=0 S X=$T(+1),X=$P(X," [ ",1) X XBSUMBLD(4),XBSUMBLD(3),XBSUMBLD(5)
"RTN","BINTEG",14,0)
LINE3 ;;F I=2:1 S X=$T(+I) Q:X=""  X XBSUMBLD(4)
"RTN","BINTEG",15,0)
LINE4 ;;F J=1:1 S Y=$E(X,J) Q:Y=""  S BYTE=BYTE+1,COUNT=COUNT+$A(Y)
"RTN","BINTEG",16,0)
LINE5 ;;S B=$P(^UTILITY($J,RTN),"^",1),C=$P(^(RTN),"^",2) I B'=BYTE!(C'=COUNT) W "  has been modified"
"RTN","BINTEG",17,0)
LINE6 ;;K XBSUMBLD,B,C,I,J,R,X,Y
"RTN","BINTEG",18,0)
 ;
"RTN","BINTEG",19,0)
LIST ;
"RTN","BINTEG",20,0)
 ;;BIDE^6036^400438
"RTN","BINTEG",21,0)
 ;;BIDX^6963^487156
"RTN","BINTEG",22,0)
 ;;BIENVCHK^4508^293225
"RTN","BINTEG",23,0)
 ;;BIEXP^4045^299360
"RTN","BINTEG",24,0)
 ;;BIEXP3^3623^257545
"RTN","BINTEG",25,0)
 ;;BIEXPRT2^6718^484971
"RTN","BINTEG",26,0)
 ;;BILETVW2^10204^734332
"RTN","BINTEG",27,0)
 ;;BILOGO^4633^314410
"RTN","BINTEG",28,0)
 ;;BILOT^10598^832234
"RTN","BINTEG",29,0)
 ;;BINDC^6063^434315
"RTN","BINTEG",30,0)
 ;;BINDC1^10110^702421
"RTN","BINTEG",31,0)
 ;;BINDC2^1720^122558
"RTN","BINTEG",32,0)
 ;;BIOUTPT3^13205^1013870
"RTN","BINTEG",33,0)
 ;;BIPATUP^7919^563249
"RTN","BINTEG",34,0)
 ;;BIPATUP1^13665^984270
"RTN","BINTEG",35,0)
 ;;BIPATUP2^4676^326856
"RTN","BINTEG",36,0)
 ;;BIPATVW2^11732^823805
"RTN","BINTEG",37,0)
 ;;BIPATVW3^9856^732907
"RTN","BINTEG",38,0)
 ;;BIPOST^7345^501886
"RTN","BINTEG",39,0)
 ;;BIPRE^5002^358442
"RTN","BINTEG",40,0)
 ;;BIRPC^9825^709536
"RTN","BINTEG",41,0)
 ;;BIRPC1^6777^479599
"RTN","BINTEG",42,0)
 ;;BIRPC3^11026^784945
"RTN","BINTEG",43,0)
 ;;BISITE1^6787^475385
"RTN","BINTEG",44,0)
 ;;BISITE3^12538^942728
"RTN","BINTEG",45,0)
 ;;BISITE4^9694^741561
"RTN","BINTEG",46,0)
 ;;BITN^14243^1094284
"RTN","BINTEG",47,0)
 ;;BITN2^11628^872750
"RTN","BINTEG",48,0)
 ;;BITX^562^37872
"RTN","BINTEG",49,0)
 ;;BITXD^2544^135599
"RTN","BINTEG",50,0)
 ;;BIUTL11^13659^973629
"RTN","BINTEG",51,0)
 ;;BIUTL4^13832^998083
"RTN","BINTEG",52,0)
 ;;BIUTL6^14076^1004282
"RTN","BINTEG",53,0)
 ;;BIUTL7^13636^936909
"RTN","BINTEG",54,0)
 ;;BIUTL8^10976^748929
"RTN","BINTEG",55,0)
 ;;BIUTL9^1544^106188
"RTN","BINTEG",56,0)
 ;;BIVISIT^14097^978526
"RTN","BINTEG",57,0)
 ;;BIXTCH^3423^254233
"RTN","BIO")
0^60^B281375
"RTN","BIO",1,0)
BIO ;IHS/CMI/MWR - CALL DDIOL TO WRITE TO DISPLAY; MAY 10, 2010
"RTN","BIO",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIO",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIO",4,0)
 ;;  WRITE TEXT TO SCREEN.
"RTN","BIO",5,0)
 ;
"RTN","BIO",6,0)
 ;---------
"RTN","BIO",7,0)
IO(BIIO,BIF) ; EP
"RTN","BIO",8,0)
 ;---> Write one line.
"RTN","BIO",9,0)
 ;---> Parameters:
"RTN","BIO",10,0)
 ;     1 - BIIO   (req) Text to be displayed; should be <70 chars.
"RTN","BIO",11,0)
 ;     2 - BIF    (opt) Format; Default="!!?3", pass "" to override.
"RTN","BIO",12,0)
 ;
"RTN","BIO",13,0)
 S:'$D(BIF) BIF="!!?3"
"RTN","BIO",14,0)
 D EN^DDIOL(BIIO,"",BIF)
"RTN","BIO",15,0)
 Q
"RTN","BIOUTPT")
0^61^B171725916
"RTN","BIOUTPT",1,0)
BIOUTPT ;IHS/CMI/MWR - HEADERS & PROMPTS FOR REPORTS.; MAY 10, 2010
"RTN","BIOUTPT",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIOUTPT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIOUTPT",4,0)
 ;;  COMMON HEADERS FOR REPORTS AND PROMPTS FOR REPORT PARAMETERS.
"RTN","BIOUTPT",5,0)
 ;
"RTN","BIOUTPT",6,0)
 ;
"RTN","BIOUTPT",7,0)
 ;----------
"RTN","BIOUTPT",8,0)
FDATE(BIFDT,BIRTN) ;EP
"RTN","BIOUTPT",9,0)
 ;---> Ask Forecast Date.  Called by Protocol BI OUTPUT FORECAST DATE.
"RTN","BIOUTPT",10,0)
 ;---> Parameters:
"RTN","BIOUTPT",11,0)
 ;     1 - BIFDT (ret) Forecast Date, Fileman format.
"RTN","BIOUTPT",12,0)
 ;               (opt) Default Date.
"RTN","BIOUTPT",13,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT",14,0)
 ;
"RTN","BIOUTPT",15,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",16,0)
 ;
"RTN","BIOUTPT",17,0)
FDATE1 ;EP
"RTN","BIOUTPT",18,0)
 S:$G(BIFDT)="" BIFDT=DT
"RTN","BIOUTPT",19,0)
 N BIDFLT,DIR S BIDFLT=$$TXDT^BIUTL5(BIFDT)
"RTN","BIOUTPT",20,0)
 S DIR(0)="DA^::FEX"
"RTN","BIOUTPT",21,0)
 S DIR("A")="     Please enter a Forecast Date: ",DIR("B")=BIDFLT
"RTN","BIOUTPT",22,0)
 D FULL^VALM1
"RTN","BIOUTPT",23,0)
 D TITLE^BIUTL5("SELECT FORECAST DATE")
"RTN","BIOUTPT",24,0)
 D TEXT1
"RTN","BIOUTPT",25,0)
 D ^DIR W !
"RTN","BIOUTPT",26,0)
 I $D(DIRUT) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT",27,0)
 S BIFDT=$P(Y,".")
"RTN","BIOUTPT",28,0)
 I BIFDT<DT D  G FDATE1
"RTN","BIOUTPT",29,0)
 .W !?5,"The date may not be in the past.  "
"RTN","BIOUTPT",30,0)
 .W "It must be today or in the future."
"RTN","BIOUTPT",31,0)
 .K BIFDT D DIRZ^BIUTL3()
"RTN","BIOUTPT",32,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",33,0)
 Q
"RTN","BIOUTPT",34,0)
 ;
"RTN","BIOUTPT",35,0)
 ;
"RTN","BIOUTPT",36,0)
 ;----------
"RTN","BIOUTPT",37,0)
TEXT1 ;EP
"RTN","BIOUTPT",38,0)
 ;;The "Forecast Date" (or "Clinic Date") is the date that will
"RTN","BIOUTPT",39,0)
 ;;be used for calculating which immunizations patients are due for.
"RTN","BIOUTPT",40,0)
 ;;
"RTN","BIOUTPT",41,0)
 ;;For example, if you choose today, the letter or report will
"RTN","BIOUTPT",42,0)
 ;;list the immunizations that patients are due for today.
"RTN","BIOUTPT",43,0)
 ;;If you choose a future date (the date of a clinic), the letter
"RTN","BIOUTPT",44,0)
 ;;or report will list immunizations due on that future date.
"RTN","BIOUTPT",45,0)
 ;;
"RTN","BIOUTPT",46,0)
 ;;NOTE: If you select a Forecast date in the future, some patients
"RTN","BIOUTPT",47,0)
 ;;      may appear as PAST DUE for that date in the future, even
"RTN","BIOUTPT",48,0)
 ;;      though they are not PAST DUE today.
"RTN","BIOUTPT",49,0)
 ;;
"RTN","BIOUTPT",50,0)
 ;;
"RTN","BIOUTPT",51,0)
 D PRINTX("TEXT1")
"RTN","BIOUTPT",52,0)
 Q
"RTN","BIOUTPT",53,0)
 ;
"RTN","BIOUTPT",54,0)
 ;
"RTN","BIOUTPT",55,0)
 ;----------
"RTN","BIOUTPT",56,0)
QDATE(BIQDT,BIRTN) ;EP
"RTN","BIOUTPT",57,0)
 ;---> Ask Quarter Ending Date.
"RTN","BIOUTPT",58,0)
 ;---> Called by Protocol BI OUTPUT QUARTER DATE.
"RTN","BIOUTPT",59,0)
 ;---> Parameters:
"RTN","BIOUTPT",60,0)
 ;     1 - BIQDT (ret) Quarter Ending Date, Fileman format.
"RTN","BIOUTPT",61,0)
 ;               (opt) Default Date.
"RTN","BIOUTPT",62,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT",63,0)
 ;
"RTN","BIOUTPT",64,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",65,0)
 ;
"RTN","BIOUTPT",66,0)
 N DIR
"RTN","BIOUTPT",67,0)
 S:$G(BIQDT) DIR("B")=$$TXDT^BIUTL5(BIQDT)
"RTN","BIOUTPT",68,0)
 S DIR(0)="DA^::PE"
"RTN","BIOUTPT",69,0)
 S DIR("A")="   Please enter a Quarter Ending Date: "
"RTN","BIOUTPT",70,0)
 D FULL^VALM1
"RTN","BIOUTPT",71,0)
 D TITLE^BIUTL5("SELECT QUARTER ENDING DATE")
"RTN","BIOUTPT",72,0)
 D TEXT2 W !
"RTN","BIOUTPT",73,0)
 D ^DIR W !
"RTN","BIOUTPT",74,0)
 I $D(DIRUT) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT",75,0)
 S BIQDT=$P(Y,".")
"RTN","BIOUTPT",76,0)
 I $E(BIQDT,6,7)="00" D
"RTN","BIOUTPT",77,0)
 .N X S X=$E(BIQDT,4,5) D
"RTN","BIOUTPT",78,0)
 ..I +X=2 S X=28 Q
"RTN","BIOUTPT",79,0)
 ..I +X=1 S X=31 Q
"RTN","BIOUTPT",80,0)
 ..I 94611[+X S X=30 Q
"RTN","BIOUTPT",81,0)
 ..S X=31
"RTN","BIOUTPT",82,0)
 .S BIQDT=BIQDT+X
"RTN","BIOUTPT",83,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",84,0)
 Q
"RTN","BIOUTPT",85,0)
 ;
"RTN","BIOUTPT",86,0)
 ;
"RTN","BIOUTPT",87,0)
 ;----------
"RTN","BIOUTPT",88,0)
TEXT2 ;EP
"RTN","BIOUTPT",89,0)
 ;;The "Quarter Ending Date" should be the last day of the quarter
"RTN","BIOUTPT",90,0)
 ;;being reported on.  Typically, this date is either March 31,
"RTN","BIOUTPT",91,0)
 ;;June 30, September 30, or December 31.  However, you may enter
"RTN","BIOUTPT",92,0)
 ;;any date you choose and the report will generate immunization
"RTN","BIOUTPT",93,0)
 ;;statistics based on the date entered.  NOTE: The patient ages
"RTN","BIOUTPT",94,0)
 ;;(3 months, 5 months, 91 years, etc.) will be calculated as of
"RTN","BIOUTPT",95,0)
 ;;the Quarter Ending Date you enter here.
"RTN","BIOUTPT",96,0)
 ;;
"RTN","BIOUTPT",97,0)
 ;;For convenience's sake, if you enter only month/year, such as 9/98,
"RTN","BIOUTPT",98,0)
 ;;the program will automatically assign the report to the last day
"RTN","BIOUTPT",99,0)
 ;;of that month, such as 9/30/1998.
"RTN","BIOUTPT",100,0)
 ;;
"RTN","BIOUTPT",101,0)
 D PRINTX("TEXT2")
"RTN","BIOUTPT",102,0)
 Q
"RTN","BIOUTPT",103,0)
 ;
"RTN","BIOUTPT",104,0)
 ;
"RTN","BIOUTPT",105,0)
 ;----------
"RTN","BIOUTPT",106,0)
DTRANGE(BIBEGDT,BIENDDT,BIPOP,BIRTN,BIBEGDF,BIENDDF) ;EP
"RTN","BIOUTPT",107,0)
 ;---> Ask date range.
"RTN","BIOUTPT",108,0)
 ;---> Called by Protocol BI OUTPUT DATE RANGE.
"RTN","BIOUTPT",109,0)
 ;---> Parameters:
"RTN","BIOUTPT",110,0)
 ;     1 - BIBEGDT (ret) Begin Date, Fileman format.
"RTN","BIOUTPT",111,0)
 ;     2 - BIENDDT (ret) End Date, Fileman format.
"RTN","BIOUTPT",112,0)
 ;     3 - BIPOP   (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BIOUTPT",113,0)
 ;     4 - BIRTN   (req) Calling routine for reset.
"RTN","BIOUTPT",114,0)
 ;     5 - BIBEGDF (opt) Begin Date default, Fileman format.
"RTN","BIOUTPT",115,0)
 ;     6 - BIENDDF (opt) End Date default, Fileman format.
"RTN","BIOUTPT",116,0)
 ;
"RTN","BIOUTPT",117,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",118,0)
 ;
"RTN","BIOUTPT",119,0)
 D TITLE^BIUTL5("SELECT DATE RANGE")
"RTN","BIOUTPT",120,0)
 D TEXT3 W !
"RTN","BIOUTPT",121,0)
 D ASKDATES^BIUTL3(.BIBEGDT,.BIENDDT,.BIPOP,$G(BIBEGDT),$G(BIENDDT))
"RTN","BIOUTPT",122,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",123,0)
 Q
"RTN","BIOUTPT",124,0)
 ;
"RTN","BIOUTPT",125,0)
 ;
"RTN","BIOUTPT",126,0)
 ;----------
"RTN","BIOUTPT",127,0)
TEXT3 ;EP
"RTN","BIOUTPT",128,0)
 ;;Please enter the beginning and ending dates for the period you
"RTN","BIOUTPT",129,0)
 ;;wish this report to cover.  (NOTE: The ending date must be after
"RTN","BIOUTPT",130,0)
 ;;the beginning date.)
"RTN","BIOUTPT",131,0)
 ;;
"RTN","BIOUTPT",132,0)
 D PRINTX("TEXT3")
"RTN","BIOUTPT",133,0)
 Q
"RTN","BIOUTPT",134,0)
 ;
"RTN","BIOUTPT",135,0)
 ;
"RTN","BIOUTPT",136,0)
 ;----------
"RTN","BIOUTPT",137,0)
AGE(BIAG,BIRTN) ;EP
"RTN","BIOUTPT",138,0)
 ;---> Select age range.  Called by Protocol BI OUTPUT AGE.
"RTN","BIOUTPT",139,0)
 ;---> If not limited to an age range, BIAG="".
"RTN","BIOUTPT",140,0)
 ;---> Parameters:
"RTN","BIOUTPT",141,0)
 ;     1 - BIAG  (ret) Age Range in months.
"RTN","BIOUTPT",142,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT",143,0)
 ;
"RTN","BIOUTPT",144,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",145,0)
 ;
"RTN","BIOUTPT",146,0)
 D AGERNG^BIAGE(.BIAG,.BIPOP,"1-72",0)
"RTN","BIOUTPT",147,0)
 I $G(BIPOP) S BIAG="" D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT",148,0)
 S:BIAG="" BIAG="ALL"
"RTN","BIOUTPT",149,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",150,0)
 Q
"RTN","BIOUTPT",151,0)
 ;
"RTN","BIOUTPT",152,0)
 ;
"RTN","BIOUTPT",153,0)
 ;----------
"RTN","BIOUTPT",154,0)
TAR(BITAR,BIRTN) ;EP
"RTN","BIOUTPT",155,0)
 ;---> Select Two-Yr-Old Age Range for same Report.
"RTN","BIOUTPT",156,0)
 ;---> Called by Protocol BI OUTPUT TWO-YR-OLD REPORT AGE RANGE.
"RTN","BIOUTPT",157,0)
 ;---> Parameters:
"RTN","BIOUTPT",158,0)
 ;     1 - BITAR (ret) Two-Yr-Old Age Range in months;
"RTN","BIOUTPT",159,0)
 ;                     either "19-35" or "24-35".
"RTN","BIOUTPT",160,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT",161,0)
 ;
"RTN","BIOUTPT",162,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",163,0)
 ;
"RTN","BIOUTPT",164,0)
 D FULL^VALM1
"RTN","BIOUTPT",165,0)
 D TITLE^BIUTL5("TWO-YR-OLD AGE RANGE")
"RTN","BIOUTPT",166,0)
 D TEXT6
"RTN","BIOUTPT",167,0)
 N A,X,Y S A="     Choose either 1 or 2"
"RTN","BIOUTPT",168,0)
 S X="SO^1:19-35 months;2:24-35 months"
"RTN","BIOUTPT",169,0)
 D DIR^BIFMAN(X,.Y,.BIPOP,A,$G(BITAR))
"RTN","BIOUTPT",170,0)
 S BITAR=$S(Y=2:"24-35",1:"19-35")
"RTN","BIOUTPT",171,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",172,0)
 Q
"RTN","BIOUTPT",173,0)
 ;
"RTN","BIOUTPT",174,0)
 ;
"RTN","BIOUTPT",175,0)
 ;----------
"RTN","BIOUTPT",176,0)
TEXT6 ;EP
"RTN","BIOUTPT",177,0)
 ;;This parameter allows you to select the Age Range of Patients for
"RTN","BIOUTPT",178,0)
 ;;the Two-Yr-Old Report.
"RTN","BIOUTPT",179,0)
 ;;
"RTN","BIOUTPT",180,0)
 ;;Selecting "19-35 months" will include in the report all children who
"RTN","BIOUTPT",181,0)
 ;;were between those ages on the date entered in the "Quarter Ending Date"
"RTN","BIOUTPT",182,0)
 ;;parameter.
"RTN","BIOUTPT",183,0)
 ;;
"RTN","BIOUTPT",184,0)
 ;;Selecting "24-35 months" will only include children who were between
"RTN","BIOUTPT",185,0)
 ;;those ages on the date entered in the "Quarter Ending Date" parameter.
"RTN","BIOUTPT",186,0)
 ;;
"RTN","BIOUTPT",187,0)
 D PRINTX("TEXT6")
"RTN","BIOUTPT",188,0)
 Q
"RTN","BIOUTPT",189,0)
 ;
"RTN","BIOUTPT",190,0)
 ;
"RTN","BIOUTPT",191,0)
 ;----------
"RTN","BIOUTPT",192,0)
CC(BICC,BIRTN,BIPOP) ;EP
"RTN","BIOUTPT",193,0)
 ;---> Select Current Community(s).
"RTN","BIOUTPT",194,0)
 ;---> Called by Protocol BI OUTPUT COMMUNITY.
"RTN","BIOUTPT",195,0)
 ;---> Parameters:
"RTN","BIOUTPT",196,0)
 ;     1 - BICC  (ret) Local array of Current Community IENs.
"RTN","BIOUTPT",197,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT",198,0)
 ;     3 - BIPOP (opt) BIQUIT=1 if user quit, ^-arrowed.
"RTN","BIOUTPT",199,0)
 ;
"RTN","BIOUTPT",200,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",201,0)
 ;
"RTN","BIOUTPT",202,0)
 S BIPOP=0
"RTN","BIOUTPT",203,0)
 D TITLE^BIUTL5("SELECTION OF COMMUNITIES")
"RTN","BIOUTPT",204,0)
 D TEXT8
"RTN","BIOUTPT",205,0)
 ;
"RTN","BIOUTPT",206,0)
 N DIR S DIR("A")="     Select G, L, or P: ",DIR("B")="Load"
"RTN","BIOUTPT",207,0)
 S DIR(0)="SAM^G:GPRA;L:LOAD;P:PREVIOUS"
"RTN","BIOUTPT",208,0)
 D ^DIR K DIR
"RTN","BIOUTPT",209,0)
 I Y=-1!($D(DIRUT)) D @("RESET^"_BIRTN) S BIPOP=1 Q
"RTN","BIOUTPT",210,0)
 ;
"RTN","BIOUTPT",211,0)
 K BICC
"RTN","BIOUTPT",212,0)
 ;---> Load GPRA Set of Communities.
"RTN","BIOUTPT",213,0)
 I "GL"[Y D GETGPRA^BISITE4(.BICC,$G(DUZ(2)))
"RTN","BIOUTPT",214,0)
 ;
"RTN","BIOUTPT",215,0)
 D:Y'="G"
"RTN","BIOUTPT",216,0)
 .;---> Select cases for one or more CURRENT COMMUNITY (OR ALL).
"RTN","BIOUTPT",217,0)
 .N BIID S BIID="3;I $G(X) S:$D(^DIC(5,X,0)) X=$P(^(0),U);25"
"RTN","BIOUTPT",218,0)
 .N BICOL S BICOL="    #  Community           State"
"RTN","BIOUTPT",219,0)
 .D SEL^BISELECT(9999999.05,"BICC","Community",,,,BIID,BICOL,.BIPOP)
"RTN","BIOUTPT",220,0)
 ;
"RTN","BIOUTPT",221,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",222,0)
 Q
"RTN","BIOUTPT",223,0)
 ;
"RTN","BIOUTPT",224,0)
 ;
"RTN","BIOUTPT",225,0)
 ;----------
"RTN","BIOUTPT",226,0)
TEXT8 ;EP
"RTN","BIOUTPT",227,0)
 ;;You have the opportunity here to use the GPRA set of Communities.
"RTN","BIOUTPT",228,0)
 ;;
"RTN","BIOUTPT",229,0)
 ;;* Enter "G" to automatically use the GPRA set and proceed.
"RTN","BIOUTPT",230,0)
 ;;* Enter "L" to LOAD the GPRA set and then edit your list before proceeding.
"RTN","BIOUTPT",231,0)
 ;;* Enter "P" to load the PREVIOUS set of Communities you used.
"RTN","BIOUTPT",232,0)
 ;;
"RTN","BIOUTPT",233,0)
 D PRINTX("TEXT8")
"RTN","BIOUTPT",234,0)
 Q
"RTN","BIOUTPT",235,0)
 ;
"RTN","BIOUTPT",236,0)
 ;
"RTN","BIOUTPT",237,0)
 ;----------
"RTN","BIOUTPT",238,0)
HCF(BIHCF,BIRTN) ;EP
"RTN","BIOUTPT",239,0)
 ;---> Select Health Care Facility(s).
"RTN","BIOUTPT",240,0)
 ;---> Called by Protocol BI OUTPUT FACILITY.
"RTN","BIOUTPT",241,0)
 ;---> Parameters:
"RTN","BIOUTPT",242,0)
 ;     1 - BIHCF (ret) Local array of Health Care Facility IENs.
"RTN","BIOUTPT",243,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT",244,0)
 ;
"RTN","BIOUTPT",245,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",246,0)
 ;
"RTN","BIOUTPT",247,0)
 ;---> Default Facilty=DUZ(0); but if user decides to select more than
"RTN","BIOUTPT",248,0)
 ;---> DUZ(0) site, goes to ^BISELECT and get user's previous list
"RTN","BIOUTPT",249,0)
 ;---> (by killing the single BIHCF(DUZ(0))).
"RTN","BIOUTPT",250,0)
 N M,N S (M,N)=0
"RTN","BIOUTPT",251,0)
 F  S N=$O(BIHCF(N)) Q:'N  S M=M+1
"RTN","BIOUTPT",252,0)
 K:M=1 BIHCF
"RTN","BIOUTPT",253,0)
 ;
"RTN","BIOUTPT",254,0)
 ;---> Code to display Area as an identifier.
"RTN","BIOUTPT",255,0)
 N BIID
"RTN","BIOUTPT",256,0)
 S BIID="1;I $G(BIIEN) S X=$P($G(^AUTTLOC(BIIEN,0)),U,4)"
"RTN","BIOUTPT",257,0)
 S BIID=BIID_" I X S:$D(^AUTTAREA(X,0)) X=""  ""_$P(^(0),U);28"
"RTN","BIOUTPT",258,0)
 N BICOL S BICOL="    #  Health Care Facility     IHS Area"
"RTN","BIOUTPT",259,0)
 D SEL^BISELECT(4,"BIHCF","Health Care Facility",,,,BIID,BICOL,.BIPOP)
"RTN","BIOUTPT",260,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",261,0)
 Q
"RTN","BIOUTPT",262,0)
 ;
"RTN","BIOUTPT",263,0)
 ;
"RTN","BIOUTPT",264,0)
 ;----------
"RTN","BIOUTPT",265,0)
CMGR(BICM,BIRTN) ;EP
"RTN","BIOUTPT",266,0)
 ;---> Select Case Managers.
"RTN","BIOUTPT",267,0)
 ;---> Called by Protocol BI OUTPUT CASE MANAGER.
"RTN","BIOUTPT",268,0)
 ;---> Parameters:
"RTN","BIOUTPT",269,0)
 ;     1 - BICM   (ret) Local array of Current Community IENs.
"RTN","BIOUTPT",270,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT",271,0)
 ;
"RTN","BIOUTPT",272,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",273,0)
 ;
"RTN","BIOUTPT",274,0)
 ;---> Select cases for one or more CASE MANAGERS (OR ALL).
"RTN","BIOUTPT",275,0)
 N BISCRN S BISCRN="I $D(^BIMGR(Y,0))"
"RTN","BIOUTPT",276,0)
 D SEL^BISELECT(9002084.01,"BICM","Case Manager",BISCRN,,,,,.BIPOP)
"RTN","BIOUTPT",277,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",278,0)
 Q
"RTN","BIOUTPT",279,0)
 ;
"RTN","BIOUTPT",280,0)
 ;
"RTN","BIOUTPT",281,0)
 ;----------
"RTN","BIOUTPT",282,0)
DPRV(BIDPRV,BIRTN) ;EP
"RTN","BIOUTPT",283,0)
 ;---> Select Designated Provider.
"RTN","BIOUTPT",284,0)
 ;---> Called by Protocol BI OUTPUT DESIGNATED PROVIDER.
"RTN","BIOUTPT",285,0)
 ;---> Parameters:
"RTN","BIOUTPT",286,0)
 ;     1 - BIDPRV (ret) Designated Provider IENs.
"RTN","BIOUTPT",287,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT",288,0)
 ;
"RTN","BIOUTPT",289,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",290,0)
 ;
"RTN","BIOUTPT",291,0)
 ;---> Select cases for one or more DESIGNATED PROVIDERS (OR ALL).
"RTN","BIOUTPT",292,0)
 N BISCRN S BISCRN="I $D(^XUSEC(""PROVIDER"",Y))"
"RTN","BIOUTPT",293,0)
 D SEL^BISELECT(200,"BIDPRV","Designated Provider",BISCRN,,,,,.BIPOP)
"RTN","BIOUTPT",294,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",295,0)
 Q
"RTN","BIOUTPT",296,0)
 ;
"RTN","BIOUTPT",297,0)
 ;
"RTN","BIOUTPT",298,0)
 ;----------
"RTN","BIOUTPT",299,0)
BEN(BIBEN,BIRTN) ;EP
"RTN","BIOUTPT",300,0)
 ;---> Select Types of Beneficiaries.
"RTN","BIOUTPT",301,0)
 ;---> Called by Protocol BI OUTPUT CASE MANAGER.
"RTN","BIOUTPT",302,0)
 ;---> Parameters:
"RTN","BIOUTPT",303,0)
 ;     1 - BIBEN  (ret) Local array of Beneficiary Types.
"RTN","BIOUTPT",304,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT",305,0)
 ;
"RTN","BIOUTPT",306,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",307,0)
 ;
"RTN","BIOUTPT",308,0)
 ;---> Select cases for one or more BENEFICIARY TYPES (OR ALL).
"RTN","BIOUTPT",309,0)
 N BINAM S BINAM="Beneficiary Type"
"RTN","BIOUTPT",310,0)
 N BIID S BIID="2;;34"
"RTN","BIOUTPT",311,0)
 N BICOL S BICOL="    #  Beneficiary Type             Code"
"RTN","BIOUTPT",312,0)
 D SEL^BISELECT(9999999.25,"BIBEN",BINAM,,,,BIID,BICOL,.BIPOP)
"RTN","BIOUTPT",313,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",314,0)
 Q
"RTN","BIOUTPT",315,0)
 ;
"RTN","BIOUTPT",316,0)
 ;
"RTN","BIOUTPT",317,0)
 ;----------
"RTN","BIOUTPT",318,0)
VTYPE(BIVT,BIRTN) ;EP
"RTN","BIOUTPT",319,0)
 ;---> Select Visit Types.
"RTN","BIOUTPT",320,0)
 ;---> Called by Protocol BI OUTPUT CASE MANAGER.
"RTN","BIOUTPT",321,0)
 ;---> Parameters:
"RTN","BIOUTPT",322,0)
 ;     1 - BIBEN  (ret) Local array of VISIT Types.
"RTN","BIOUTPT",323,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT",324,0)
 ;
"RTN","BIOUTPT",325,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",326,0)
 ;
"RTN","BIOUTPT",327,0)
 ;---> Select cases for one or more VISIT TYPES (OR ALL).
"RTN","BIOUTPT",328,0)
 N BINAM S BINAM="Visit Type"
"RTN","BIOUTPT",329,0)
 N BICOL S BICOL="    #  Visit Type                     Code"
"RTN","BIOUTPT",330,0)
 D SEL^BISELECT(9000010,"BIVT",BINAM,,,,,BICOL,.BIPOP,,".03")
"RTN","BIOUTPT",331,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",332,0)
 Q
"RTN","BIOUTPT",333,0)
 ;
"RTN","BIOUTPT",334,0)
 ;
"RTN","BIOUTPT",335,0)
 ;----------
"RTN","BIOUTPT",336,0)
INCLHPV(BIHPV,BIRTN) ;EP
"RTN","BIOUTPT",337,0)
 ;---> Answer Yes/No to include Hepatitis A in Quarterly Report.
"RTN","BIOUTPT",338,0)
 ;---> Called by Protocol BI OUTPUT INCLUDE HPV.
"RTN","BIOUTPT",339,0)
 ;---> Parameters:
"RTN","BIOUTPT",340,0)
 ;     1 - BIHPV  (ret) 1=YES, 0=NO.
"RTN","BIOUTPT",341,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT",342,0)
 ;
"RTN","BIOUTPT",343,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",344,0)
 ;
"RTN","BIOUTPT",345,0)
 D FULL^VALM1
"RTN","BIOUTPT",346,0)
 D TITLE^BIUTL5("INCLUDE VARICELLA & PNEUMO IN REPORT")
"RTN","BIOUTPT",347,0)
 D TEXT4 W ! N Y
"RTN","BIOUTPT",348,0)
 D DIR^BIFMAN("YAO",.Y,,"   Include Varicella & Pneumo? (YES/NO): ","YES")
"RTN","BIOUTPT",349,0)
 S:Y=0 BIHPV=0 S:Y=1 BIHPV=1
"RTN","BIOUTPT",350,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",351,0)
 Q
"RTN","BIOUTPT",352,0)
 ;
"RTN","BIOUTPT",353,0)
 ;
"RTN","BIOUTPT",354,0)
 ;----------
"RTN","BIOUTPT",355,0)
TEXT4 ;EP
"RTN","BIOUTPT",356,0)
 ;;This option allows you to include Varicella and Pneumo
"RTN","BIOUTPT",357,0)
 ;;in the statistics of the "Appropriate for Age" row at the
"RTN","BIOUTPT",358,0)
 ;;top of the report.
"RTN","BIOUTPT",359,0)
 ;;
"RTN","BIOUTPT",360,0)
 ;;If you answer "YES,"  Varicella & Pneumo will appear in the
"RTN","BIOUTPT",361,0)
 ;;Minimum needs header row at the top of the report and will
"RTN","BIOUTPT",362,0)
 ;;count when computing whether patients are Appropriate for Age.
"RTN","BIOUTPT",363,0)
 ;;
"RTN","BIOUTPT",364,0)
 ;;Answer "NO" in order to exclude Varicella & Pneumo from the
"RTN","BIOUTPT",365,0)
 ;;Minimum Needs when computing Appropriate for Age statistics.
"RTN","BIOUTPT",366,0)
 ;;
"RTN","BIOUTPT",367,0)
 ;;In both cases, the statistics for Varicella & Pneumo will be
"RTN","BIOUTPT",368,0)
 ;;displayed individually in additional rows at the bottom of the
"RTN","BIOUTPT",369,0)
 ;;report.
"RTN","BIOUTPT",370,0)
 ;;
"RTN","BIOUTPT",371,0)
 D PRINTX("TEXT4")
"RTN","BIOUTPT",372,0)
 Q
"RTN","BIOUTPT",373,0)
 ;
"RTN","BIOUTPT",374,0)
 ;
"RTN","BIOUTPT",375,0)
 ;----------
"RTN","BIOUTPT",376,0)
INCLCPT(BICPT,BIRTN) ;EP
"RTN","BIOUTPT",377,0)
 ;---> Answer Yes/No to include CPT Coded Visits in report.
"RTN","BIOUTPT",378,0)
 ;---> Called by Protocol BI OUTPUT INCLUDE CPT.
"RTN","BIOUTPT",379,0)
 ;---> Parameters:
"RTN","BIOUTPT",380,0)
 ;     1 - BICPT  (ret) 1=YES, 0=NO.
"RTN","BIOUTPT",381,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT",382,0)
 ;
"RTN","BIOUTPT",383,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",384,0)
 ;
"RTN","BIOUTPT",385,0)
 D FULL^VALM1
"RTN","BIOUTPT",386,0)
 D TITLE^BIUTL5("INCLUDE CPT CODED VISITS IN REPORT")
"RTN","BIOUTPT",387,0)
 D TEXT5 W ! N Y
"RTN","BIOUTPT",388,0)
 D DIR^BIFMAN("YAO",.Y,,"   Include CPT Coded Visits in report? (YES/NO): ")
"RTN","BIOUTPT",389,0)
 S:Y=0 BICPT=0 S:Y=1 BICPT=1
"RTN","BIOUTPT",390,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",391,0)
 Q
"RTN","BIOUTPT",392,0)
 ;
"RTN","BIOUTPT",393,0)
 ;
"RTN","BIOUTPT",394,0)
 ;----------
"RTN","BIOUTPT",395,0)
TEXT5 ;EP
"RTN","BIOUTPT",396,0)
 ;;This option allows you to include CPT Coded Visits in the report.
"RTN","BIOUTPT",397,0)
 ;;
"RTN","BIOUTPT",398,0)
 ;;Explanation: Most immunizations will be recorded as Immunization
"RTN","BIOUTPT",399,0)
 ;;Visits and will be included in this report.  However, it is possible
"RTN","BIOUTPT",400,0)
 ;;that some immunizations were recorded only by CPT Code for the
"RTN","BIOUTPT",401,0)
 ;;patient's visit and not actually recorded in the Immunization Files;
"RTN","BIOUTPT",402,0)
 ;;in other words, not entered via the Immunization Package.
"RTN","BIOUTPT",403,0)
 ;;
"RTN","BIOUTPT",404,0)
 ;;Answer "YES" to this question if you wish to have the report search
"RTN","BIOUTPT",405,0)
 ;;for any immunizations that were only entered as CPT Codes, and to
"RTN","BIOUTPT",406,0)
 ;;include those immunizations in the statistical results of this report.
"RTN","BIOUTPT",407,0)
 ;;NOTE: Including CPT Coded visits may cause some patients to appear on
"RTN","BIOUTPT",408,0)
 ;;the report's patient roster who do not have immunizations recorded in
"RTN","BIOUTPT",409,0)
 ;;the Immunization Package.
"RTN","BIOUTPT",410,0)
 ;;
"RTN","BIOUTPT",411,0)
 ;;Answer "NO" to ignore any immunizations that might have been recorded
"RTN","BIOUTPT",412,0)
 ;;only by CPT Coding.
"RTN","BIOUTPT",413,0)
 D PRINTX("TEXT5")
"RTN","BIOUTPT",414,0)
 Q
"RTN","BIOUTPT",415,0)
 ;
"RTN","BIOUTPT",416,0)
 ;
"RTN","BIOUTPT",417,0)
 ;----------
"RTN","BIOUTPT",418,0)
DISP24M(BIAGRPS,BIRTN) ;EP
"RTN","BIOUTPT",419,0)
 ;---> Answer Yes/No to display the 24-month column in the Two-Yr-Old Report.
"RTN","BIOUTPT",420,0)
 ;---> Called by Protocol BI OUTPUT DISPLAY 24-MO COLUMN.
"RTN","BIOUTPT",421,0)
 ;---> Parameters:
"RTN","BIOUTPT",422,0)
 ;     1 - BIAGRPS (ret) 1=Display 24-Month Column, 0=Do not.
"RTN","BIOUTPT",423,0)
 ;     2 - BIRTN   (req) Calling routine for reset.
"RTN","BIOUTPT",424,0)
 ;
"RTN","BIOUTPT",425,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT",426,0)
 ;
"RTN","BIOUTPT",427,0)
 D FULL^VALM1
"RTN","BIOUTPT",428,0)
 D TITLE^BIUTL5("DISPLAY 24-MONTH COLUMN")
"RTN","BIOUTPT",429,0)
 D TEXT7 W ! N Y
"RTN","BIOUTPT",430,0)
 D DIR^BIFMAN("YAO",.Y,,"     Display 24-Month column on report? (YES/NO): ")
"RTN","BIOUTPT",431,0)
 S:Y=0 BIAGRPS="3,5,7,16,19,36" S:Y=1 BIAGRPS="3,5,7,16,19,24,36"
"RTN","BIOUTPT",432,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT",433,0)
 Q
"RTN","BIOUTPT",434,0)
 ;
"RTN","BIOUTPT",435,0)
 ;
"RTN","BIOUTPT",436,0)
 ;----------
"RTN","BIOUTPT",437,0)
TEXT7 ;EP
"RTN","BIOUTPT",438,0)
 ;;This option allows you to specifiy whether the 24-Month Column
"RTN","BIOUTPT",439,0)
 ;;should appear in the Two-Yr-Old Report.  The final totals in the
"RTN","BIOUTPT",440,0)
 ;;report will not be affected by this choice.
"RTN","BIOUTPT",441,0)
 ;;
"RTN","BIOUTPT",442,0)
 D PRINTX("TEXT7")
"RTN","BIOUTPT",443,0)
 Q
"RTN","BIOUTPT",444,0)
 ;
"RTN","BIOUTPT",445,0)
 ;
"RTN","BIOUTPT",446,0)
 ;----------
"RTN","BIOUTPT",447,0)
HELPTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT",448,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT",449,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BIOUTPT",450,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BIOUTPT",451,0)
 Q
"RTN","BIOUTPT",452,0)
 ;
"RTN","BIOUTPT",453,0)
 ;
"RTN","BIOUTPT",454,0)
 ;----------
"RTN","BIOUTPT",455,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT",456,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT",457,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT",458,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIOUTPT",459,0)
 Q
"RTN","BIOUTPT1")
0^62^B131538211
"RTN","BIOUTPT1",1,0)
BIOUTPT1 ;IHS/CMI/MWR - PROMPTS FOR REPORTS.; MAY 10, 2010
"RTN","BIOUTPT1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIOUTPT1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIOUTPT1",4,0)
 ;;  PROMPTS FOR REPORTS.
"RTN","BIOUTPT1",5,0)
 ;
"RTN","BIOUTPT1",6,0)
 ;
"RTN","BIOUTPT1",7,0)
 ;----------
"RTN","BIOUTPT1",8,0)
ORDER(BIORD) ;EP
"RTN","BIOUTPT1",9,0)
 ;---> Select Order by which list will be sorted.
"RTN","BIOUTPT1",10,0)
 ;---> Called by Protocol BI OUTPUT ORDER.
"RTN","BIOUTPT1",11,0)
 ;---> Parameters:
"RTN","BIOUTPT1",12,0)
 ;     1 - BIORD (ret) Order by which list will be sorted.
"RTN","BIOUTPT1",13,0)
 ;
"RTN","BIOUTPT1",14,0)
 ;---> Select Order of sort.
"RTN","BIOUTPT1",15,0)
 S:'$G(BIORD) BIORD=1
"RTN","BIOUTPT1",16,0)
 D FULL^VALM1
"RTN","BIOUTPT1",17,0)
 D TITLE^BIUTL5("SELECT ORDER")
"RTN","BIOUTPT1",18,0)
 N DIR
"RTN","BIOUTPT1",19,0)
 W !!?3,"Select the Order by which patients should sorted.",!
"RTN","BIOUTPT1",20,0)
 W !?5,"1     Patient Age"
"RTN","BIOUTPT1",21,0)
 W !?5,"2     Patient Name (alphabetically)"
"RTN","BIOUTPT1",22,0)
 W !?5,"3     Patient Chart#"
"RTN","BIOUTPT1",23,0)
 W !?5,"4     Case Manager"
"RTN","BIOUTPT1",24,0)
 W !?5,"5     Case Manager, then Community"
"RTN","BIOUTPT1",25,0)
 W !?5,"6     Community, then Case Manager"
"RTN","BIOUTPT1",26,0)
 W !?5,"7     Community, then Patient Age"
"RTN","BIOUTPT1",27,0)
 W !?5,"8     Community, then Patient Name"
"RTN","BIOUTPT1",28,0)
 W !?5,"9     Community, then Patient Chart#"
"RTN","BIOUTPT1",29,0)
 W !?4,"10     Zipcode, then Patient Name"
"RTN","BIOUTPT1",30,0)
 W !?4,"11     Designated Provider",!
"RTN","BIOUTPT1",31,0)
 N X S X="SAM^1:Patient Age"
"RTN","BIOUTPT1",32,0)
 S X=X_";2:Patient Name (alphabetically)"
"RTN","BIOUTPT1",33,0)
 S X=X_";3:Patient Chart#"
"RTN","BIOUTPT1",34,0)
 S X=X_";4:Case Manager"
"RTN","BIOUTPT1",35,0)
 S X=X_";5:Case Manager, then Community"
"RTN","BIOUTPT1",36,0)
 S X=X_";6:Community, then Case Manager"
"RTN","BIOUTPT1",37,0)
 S X=X_";7:Community, then Patient Age"
"RTN","BIOUTPT1",38,0)
 S X=X_";8:Community, then Patient Name"
"RTN","BIOUTPT1",39,0)
 S X=X_";9:Community, then Patient Chart#"
"RTN","BIOUTPT1",40,0)
 S X=X_";10:Zipcode, then Patient Name"
"RTN","BIOUTPT1",41,0)
 S X=X_";11:Designated Provider"
"RTN","BIOUTPT1",42,0)
 ;S DIR("B")=$P($P(X,BIORD_":",2),";")
"RTN","BIOUTPT1",43,0)
 S DIR("A")="   Select Order: "
"RTN","BIOUTPT1",44,0)
 S DIR("B")=BIORD
"RTN","BIOUTPT1",45,0)
 S DIR(0)=X K X S DIR("?")="^D ORDERH^BIOUTPT1"
"RTN","BIOUTPT1",46,0)
 D ^DIR
"RTN","BIOUTPT1",47,0)
 S:+Y>0 BIORD=+Y
"RTN","BIOUTPT1",48,0)
 D RESET^BIDU
"RTN","BIOUTPT1",49,0)
 Q
"RTN","BIOUTPT1",50,0)
 ;
"RTN","BIOUTPT1",51,0)
 ;
"RTN","BIOUTPT1",52,0)
 ;----------
"RTN","BIOUTPT1",53,0)
ORDERH ;EP
"RTN","BIOUTPT1",54,0)
 ;---> Help for Select Order prompt.
"RTN","BIOUTPT1",55,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIOUTPT1",56,0)
 D START^BIHELP("SELECT ORDER - HELP",.BITEXT)
"RTN","BIOUTPT1",57,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT ORDER")
"RTN","BIOUTPT1",58,0)
 Q
"RTN","BIOUTPT1",59,0)
 ;
"RTN","BIOUTPT1",60,0)
 ;
"RTN","BIOUTPT1",61,0)
 ;----------
"RTN","BIOUTPT1",62,0)
TEXT1(BITEXT) ;EP
"RTN","BIOUTPT1",63,0)
 ;;You may select the order by which patients will sorted in this list.
"RTN","BIOUTPT1",64,0)
 ;;
"RTN","BIOUTPT1",65,0)
 ;;* Patient Age - will list patients in order of increasing age.
"RTN","BIOUTPT1",66,0)
 ;;
"RTN","BIOUTPT1",67,0)
 ;;* Patient Name - will list patients by "LAST NAME, FIRST NAME"
"RTN","BIOUTPT1",68,0)
 ;;     alphabetically.
"RTN","BIOUTPT1",69,0)
 ;;
"RTN","BIOUTPT1",70,0)
 ;;* Patient Chart# - will list patients by increasing Chart# (Health
"RTN","BIOUTPT1",71,0)
 ;;     Record Number).
"RTN","BIOUTPT1",72,0)
 ;;
"RTN","BIOUTPT1",73,0)
 ;;* Case Manager - will list patients grouped by Case Manager (and then
"RTN","BIOUTPT1",74,0)
 ;;     by Patient Name alphabetically under each Case Manager).
"RTN","BIOUTPT1",75,0)
 ;;
"RTN","BIOUTPT1",76,0)
 ;;* Case Manager, then Community - will list patients grouped first by
"RTN","BIOUTPT1",77,0)
 ;;     Case Manager and then by Community.
"RTN","BIOUTPT1",78,0)
 ;;
"RTN","BIOUTPT1",79,0)
 ;;* Community, then Case Manager - will list patients grouped first by
"RTN","BIOUTPT1",80,0)
 ;;     Community and then by Case Manager.
"RTN","BIOUTPT1",81,0)
 ;;
"RTN","BIOUTPT1",82,0)
 ;;* Community, then Patient Age - will list patients grouped first by
"RTN","BIOUTPT1",83,0)
 ;;     Community and then by Patient Age.
"RTN","BIOUTPT1",84,0)
 ;;
"RTN","BIOUTPT1",85,0)
 ;;* Community, then Patient Name - will list patients grouped first by
"RTN","BIOUTPT1",86,0)
 ;;     Community and then by Patient Name.
"RTN","BIOUTPT1",87,0)
 ;;
"RTN","BIOUTPT1",88,0)
 ;;* Community, then Patient Chart# - will list patients grouped first
"RTN","BIOUTPT1",89,0)
 ;;     by Community and then by Patient Chart#.
"RTN","BIOUTPT1",90,0)
 ;;
"RTN","BIOUTPT1",91,0)
 ;;* Zipcode, then Patient Name - will begin with lowest zipcodes first.
"RTN","BIOUTPT1",92,0)
 ;;
"RTN","BIOUTPT1",93,0)
 ;;* Designated Provider - will list patients grouped by Designated Provider
"RTN","BIOUTPT1",94,0)
 ;;     (and then by Patient Name alphabetically).
"RTN","BIOUTPT1",95,0)
 ;;
"RTN","BIOUTPT1",96,0)
 ;;Select the number (1-10) to indicate the order in which you wish to
"RTN","BIOUTPT1",97,0)
 ;;have patients listed.
"RTN","BIOUTPT1",98,0)
 ;;
"RTN","BIOUTPT1",99,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIOUTPT1",100,0)
 Q
"RTN","BIOUTPT1",101,0)
 ;
"RTN","BIOUTPT1",102,0)
 ;
"RTN","BIOUTPT1",103,0)
 ;----------
"RTN","BIOUTPT1",104,0)
ADDINFO(BINFO) ;EP
"RTN","BIOUTPT1",105,0)
 ;---> Select Additional Information to be included in Due List.
"RTN","BIOUTPT1",106,0)
 ;---> Called by Protocol BI OUTPUT ADDITIONAL INFO.
"RTN","BIOUTPT1",107,0)
 ;---> Parameters:
"RTN","BIOUTPT1",108,0)
 ;     1 - BINFO (ret) Array of Additional Information Items.
"RTN","BIOUTPT1",109,0)
 ;
"RTN","BIOUTPT1",110,0)
 ;---> NOTE: Sending BINONE=1 param tells BISELECT that NO Items selected
"RTN","BIOUTPT1",111,0)
 ;---> means "None" not "ALL." v8.4
"RTN","BIOUTPT1",112,0)
 ;
"RTN","BIOUTPT1",113,0)
 N BINAM S BINAM="Information Item"
"RTN","BIOUTPT1",114,0)
 N BICOL S BICOL="    #  Information Item"
"RTN","BIOUTPT1",115,0)
 D SEL^BISELECT(9002084.82,"BINFO",BINAM,,13,,,BICOL,,1)
"RTN","BIOUTPT1",116,0)
 D RESET^BIDU
"RTN","BIOUTPT1",117,0)
 Q
"RTN","BIOUTPT1",118,0)
 ;
"RTN","BIOUTPT1",119,0)
 ;
"RTN","BIOUTPT1",120,0)
 ;----------
"RTN","BIOUTPT1",121,0)
TEXT6 ;EP
"RTN","BIOUTPT1",122,0)
 ;;Please select any Items of Additional Patient Information you wish to
"RTN","BIOUTPT1",123,0)
 ;;be included in this Patient List by entering the corresponding number(s).
"RTN","BIOUTPT1",124,0)
 ;;
"RTN","BIOUTPT1",125,0)
 ;;   * To include more than one Item, separate the numbers with commas.
"RTN","BIOUTPT1",126,0)
 ;;     Example: 1,2,6  would be Phone Number, Address, and Directions.
"RTN","BIOUTPT1",127,0)
 ;;
"RTN","BIOUTPT1",128,0)
 ;;     0     No Additional Information
"RTN","BIOUTPT1",129,0)
 ;;     1     Phone Number
"RTN","BIOUTPT1",130,0)
 ;;     2     Address
"RTN","BIOUTPT1",131,0)
 ;;     3     Immunization History
"RTN","BIOUTPT1",132,0)
 ;;     4     Immunization History w/Lot#'s
"RTN","BIOUTPT1",133,0)
 ;;     5     Immunization Forecast
"RTN","BIOUTPT1",134,0)
 ;;     6     Directions to House
"RTN","BIOUTPT1",135,0)
 ;;     7     Parent/Guardian
"RTN","BIOUTPT1",136,0)
 ;;     8     Case Manager
"RTN","BIOUTPT1",137,0)
 ;;     9     Reason Inactivated
"RTN","BIOUTPT1",138,0)
 ;;    10     Skin Tests
"RTN","BIOUTPT1",139,0)
 ;;    11     Next Appointment (RPMS Scheduling)
"RTN","BIOUTPT1",140,0)
 ;;
"RTN","BIOUTPT1",141,0)
 D PRINTX("TEXT6")
"RTN","BIOUTPT1",142,0)
 Q
"RTN","BIOUTPT1",143,0)
 ;
"RTN","BIOUTPT1",144,0)
 ;
"RTN","BIOUTPT1",145,0)
 ;----------
"RTN","BIOUTPT1",146,0)
ADDHELP ;EP
"RTN","BIOUTPT1",147,0)
 ;----> Explanation of this report.
"RTN","BIOUTPT1",148,0)
 N BITEXT D TEXT7(.BITEXT)
"RTN","BIOUTPT1",149,0)
 D START^BIHELP("ADDITIONAL INFORMATION - HELP",.BITEXT)
"RTN","BIOUTPT1",150,0)
 D FULL^VALM1,TITLE^BIUTL5("ADDITIONAL INFORMATION"),TEXT6
"RTN","BIOUTPT1",151,0)
 Q
"RTN","BIOUTPT1",152,0)
 ;
"RTN","BIOUTPT1",153,0)
 ;
"RTN","BIOUTPT1",154,0)
 ;----------
"RTN","BIOUTPT1",155,0)
TEXT7(BITEXT) ;EP
"RTN","BIOUTPT1",156,0)
 ;;You may select additional Items of Patient Information to be
"RTN","BIOUTPT1",157,0)
 ;;included in the display or printout of this Patient List.
"RTN","BIOUTPT1",158,0)
 ;;(This selection does not pertain to the printing of Letters.)
"RTN","BIOUTPT1",159,0)
 ;;
"RTN","BIOUTPT1",160,0)
 ;;Any combination of Items may be selected by entering the
"RTN","BIOUTPT1",161,0)
 ;;corresponding numbers, separated by commas.  Items may also
"RTN","BIOUTPT1",162,0)
 ;;be selected inclusively by using a "-" dash.  For example, 1-5
"RTN","BIOUTPT1",163,0)
 ;;will include items 1,2,3,4,and 5.
"RTN","BIOUTPT1",164,0)
 ;;
"RTN","BIOUTPT1",165,0)
 ;;"Directions to House", Item 6, refers to the physical "Location of
"RTN","BIOUTPT1",166,0)
 ;;Patient's Home", as edited on Page 9 of Patient Registration.
"RTN","BIOUTPT1",167,0)
 ;;
"RTN","BIOUTPT1",168,0)
 ;;"Parent/Guardian", Item 7, refers to the patient's parent or guardian
"RTN","BIOUTPT1",169,0)
 ;;AS LISTED under "Additional Patient Information" of the Patient View
"RTN","BIOUTPT1",170,0)
 ;;in Immunization.
"RTN","BIOUTPT1",171,0)
 ;;(NOTE: This is not necessarily the same as the "Father's Name" or
"RTN","BIOUTPT1",172,0)
 ;;"Mother's Maiden Name" as listed in the RPMS Patient Registration
"RTN","BIOUTPT1",173,0)
 ;;module.)
"RTN","BIOUTPT1",174,0)
 ;;
"RTN","BIOUTPT1",175,0)
 ;;"Next Appointment", Item 11, refers to the patient's next appointment,
"RTN","BIOUTPT1",176,0)
 ;;*if* the RPMS Scheduling package is in use on this system and
"RTN","BIOUTPT1",177,0)
 ;;*if* the patient has a future appointment scheduled.
"RTN","BIOUTPT1",178,0)
 ;;
"RTN","BIOUTPT1",179,0)
 ;;Also note that "Current Community" will automatically appear in the
"RTN","BIOUTPT1",180,0)
 ;;right-most column of the Due List when it displays or print.
"RTN","BIOUTPT1",181,0)
 ;;"Current Community" here refers to Page 1 (Field# 8) of Patient
"RTN","BIOUTPT1",182,0)
 ;;Registration.
"RTN","BIOUTPT1",183,0)
 ;;
"RTN","BIOUTPT1",184,0)
 D LOADTX("TEXT7",,.BITEXT)
"RTN","BIOUTPT1",185,0)
 Q
"RTN","BIOUTPT1",186,0)
 ;
"RTN","BIOUTPT1",187,0)
 ;
"RTN","BIOUTPT1",188,0)
 ;----------
"RTN","BIOUTPT1",189,0)
INCLDEC(BIDED,BIRTN) ;EP
"RTN","BIOUTPT1",190,0)
 ;---> Answer Yes/No to include CPT Coded Visits in report.
"RTN","BIOUTPT1",191,0)
 ;---> Called by Protocol BI OUTPUT INCLUDE CPT.
"RTN","BIOUTPT1",192,0)
 ;---> Parameters:
"RTN","BIOUTPT1",193,0)
 ;     1 - BICPT  (ret) 1=YES, 0=NO.
"RTN","BIOUTPT1",194,0)
 ;     2 - BIRTN  (ret) Calling routine for reset.
"RTN","BIOUTPT1",195,0)
 ;
"RTN","BIOUTPT1",196,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT1",197,0)
 ;
"RTN","BIOUTPT1",198,0)
 D FULL^VALM1
"RTN","BIOUTPT1",199,0)
 D TITLE^BIUTL5("INCLUDE DECEASED PATIENTS IN LIST/REPORT")
"RTN","BIOUTPT1",200,0)
 D TEXT2 W ! N B,Y
"RTN","BIOUTPT1",201,0)
 S B=$S($G(BIDED):"Yes",1:"No")
"RTN","BIOUTPT1",202,0)
 D DIR^BIFMAN("YAO",.Y,,"   Include Deceased Patients in this list/report? (Yes/No): ",B)
"RTN","BIOUTPT1",203,0)
 S:Y=0 BIDED=0 S:Y=1 BIDED=1
"RTN","BIOUTPT1",204,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT1",205,0)
 Q
"RTN","BIOUTPT1",206,0)
 ;
"RTN","BIOUTPT1",207,0)
 ;
"RTN","BIOUTPT1",208,0)
 ;----------
"RTN","BIOUTPT1",209,0)
TEXT2 ;EP
"RTN","BIOUTPT1",210,0)
 ;;This option allows you to include deceased patients in the
"RTN","BIOUTPT1",211,0)
 ;;list or report.  In general deceased patients are left off
"RTN","BIOUTPT1",212,0)
 ;;of lists and reports; however, it is sometimes necessary for
"RTN","BIOUTPT1",213,0)
 ;;purposes such as tracking recipients of a particular vaccine
"RTN","BIOUTPT1",214,0)
 ;;or reconciling various statistical reports.
"RTN","BIOUTPT1",215,0)
 ;;
"RTN","BIOUTPT1",216,0)
 D PRINTX("TEXT2")
"RTN","BIOUTPT1",217,0)
 Q
"RTN","BIOUTPT1",218,0)
 ;
"RTN","BIOUTPT1",219,0)
 ;
"RTN","BIOUTPT1",220,0)
 ;----------
"RTN","BIOUTPT1",221,0)
FLH1N1(BIFH,BIRTN) ;EP
"RTN","BIOUTPT1",222,0)
 ;---> Answer Yes/No to include CPT Coded Visits in report.
"RTN","BIOUTPT1",223,0)
 ;---> Called by Protocol BI OUTPUT INCLUDE CPT.
"RTN","BIOUTPT1",224,0)
 ;---> Parameters:
"RTN","BIOUTPT1",225,0)
 ;     1 - BICPT  (ret) 1=YES, 0=NO.
"RTN","BIOUTPT1",226,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT1",227,0)
 ;
"RTN","BIOUTPT1",228,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT1",229,0)
 ;
"RTN","BIOUTPT1",230,0)
 D FULL^VALM1
"RTN","BIOUTPT1",231,0)
 D TITLE^BIUTL5("REPORT TYPE: STANDARD FLU OR H1N1")
"RTN","BIOUTPT1",232,0)
 W ! D TEXT3 W !
"RTN","BIOUTPT1",233,0)
 N DIR,Y
"RTN","BIOUTPT1",234,0)
 S DIR("A")="     Select Standard or H1N1: "
"RTN","BIOUTPT1",235,0)
 S DIR("B")=$S($G(BIFH)="H":"H1N1",1:"Standard")
"RTN","BIOUTPT1",236,0)
 S DIR(0)="SAM^s:Standard;h:H1N1"
"RTN","BIOUTPT1",237,0)
 D ^DIR K DIR
"RTN","BIOUTPT1",238,0)
 D
"RTN","BIOUTPT1",239,0)
 .I Y="h" S BIFH="H" Q
"RTN","BIOUTPT1",240,0)
 .S BIFH="F"
"RTN","BIOUTPT1",241,0)
 ;
"RTN","BIOUTPT1",242,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT1",243,0)
 Q
"RTN","BIOUTPT1",244,0)
 ;
"RTN","BIOUTPT1",245,0)
 ;
"RTN","BIOUTPT1",246,0)
 ;----------
"RTN","BIOUTPT1",247,0)
TEXT3 ;EP
"RTN","BIOUTPT1",248,0)
 ;;Do you want to run the Standard Flu Report or the H1N1 Report?
"RTN","BIOUTPT1",249,0)
 ;;
"RTN","BIOUTPT1",250,0)
 D PRINTX("TEXT3")
"RTN","BIOUTPT1",251,0)
 Q
"RTN","BIOUTPT1",252,0)
 ;
"RTN","BIOUTPT1",253,0)
 ;
"RTN","BIOUTPT1",254,0)
 ;----------
"RTN","BIOUTPT1",255,0)
USERPOP(BIUP,BIRTN) ;EP - Select User Population Parameter.
"RTN","BIOUTPT1",256,0)
 ;---> Called by Protocol BI OUTPUT USER POPULATION.
"RTN","BIOUTPT1",257,0)
 ;---> Parameters:
"RTN","BIOUTPT1",258,0)
 ;     1 - BIUP  (ret) R=Registered Patients; U=User Population (1+ visits)
"RTN","BIOUTPT1",259,0)
 ;                     A=Active Users.
"RTN","BIOUTPT1",260,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT1",261,0)
 ;
"RTN","BIOUTPT1",262,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT1",263,0)
USERPP1 ;
"RTN","BIOUTPT1",264,0)
 D FULL^VALM1
"RTN","BIOUTPT1",265,0)
 D TITLE^BIUTL5("PATIENT POPULATION GROUP")
"RTN","BIOUTPT1",266,0)
 W !?5,"Select the User Population Group you which to include in this report."
"RTN","BIOUTPT1",267,0)
 N DIR,Y,BIGPRA,BIPOP
"RTN","BIOUTPT1",268,0)
 S (BIGPRA,BIPOP)=0
"RTN","BIOUTPT1",269,0)
 ;
"RTN","BIOUTPT1",270,0)
 ;---> If GPRA is set up, set BIGPRA=1.
"RTN","BIOUTPT1",271,0)
 I $$GPRAIEN^BIUTL6 S BIGPRA=1
"RTN","BIOUTPT1",272,0)
 ;
"RTN","BIOUTPT1",273,0)
 S DIR(0)="SM^r:"_$$BIUPTX^BIUTL6("r")_";i:"_$$BIUPTX^BIUTL6("i")
"RTN","BIOUTPT1",274,0)
 S DIR(0)=DIR(0)_";u:"_$$BIUPTX^BIUTL6("u")_";a:"_$$BIUPTX^BIUTL6("a")
"RTN","BIOUTPT1",275,0)
 ;
"RTN","BIOUTPT1",276,0)
 S DIR("A")="     Select User Population Group"
"RTN","BIOUTPT1",277,0)
 D
"RTN","BIOUTPT1",278,0)
 .I $G(BIUP)]"" S DIR("B")=$P($P(DIR(0),BIUP_":",2),";") Q
"RTN","BIOUTPT1",279,0)
 .I BIGPRA=1 S DIR("B")="Active Clinical Users (2+ visits)" Q
"RTN","BIOUTPT1",280,0)
 .S DIR("B")="User Population (1+ visits)"
"RTN","BIOUTPT1",281,0)
 ;
"RTN","BIOUTPT1",282,0)
 D HELP1
"RTN","BIOUTPT1",283,0)
 D ^DIR K DIR
"RTN","BIOUTPT1",284,0)
 ;
"RTN","BIOUTPT1",285,0)
 D:((Y="a")&('BIGPRA))
"RTN","BIOUTPT1",286,0)
 .W !!?5,"You cannont select for Active Users because the GPRA Software is"
"RTN","BIOUTPT1",287,0)
 .W !?5,"not loaded or set up correctly."
"RTN","BIOUTPT1",288,0)
 .W !?5,"Contact your site manager or RPMS support for further information."
"RTN","BIOUTPT1",289,0)
 .D DIRZ^BIUTL3(.BIPOP)
"RTN","BIOUTPT1",290,0)
 ;
"RTN","BIOUTPT1",291,0)
 I BIPOP D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT1",292,0)
 G:((Y="a")&('BIGPRA)) USERPP1
"RTN","BIOUTPT1",293,0)
 ;
"RTN","BIOUTPT1",294,0)
 S BIUP=Y
"RTN","BIOUTPT1",295,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT1",296,0)
 Q
"RTN","BIOUTPT1",297,0)
 ;
"RTN","BIOUTPT1",298,0)
 ;
"RTN","BIOUTPT1",299,0)
 ;----------
"RTN","BIOUTPT1",300,0)
HELP1 ; EP
"RTN","BIOUTPT1",301,0)
 ;;
"RTN","BIOUTPT1",302,0)
 ;;Select the User Population Group you which to include in this report.
"RTN","BIOUTPT1",303,0)
 ;;
"RTN","BIOUTPT1",304,0)
 ;;If you select "R" for Registered Patients, all patients who have an
"RTN","BIOUTPT1",305,0)
 ;;active Health Record in the system and meet the other criteria you
"RTN","BIOUTPT1",306,0)
 ;;select will be included in the report.
"RTN","BIOUTPT1",307,0)
 ;;
"RTN","BIOUTPT1",308,0)
 ;;If you select "I" for Immunization Registry patients, all the patients
"RTN","BIOUTPT1",309,0)
 ;;who have an Active Status in the Immunization Registry and meet the
"RTN","BIOUTPT1",310,0)
 ;;other criteria you select will be included in the report.
"RTN","BIOUTPT1",311,0)
 ;;
"RTN","BIOUTPT1",312,0)
 ;;If you select "U" for User Population, only patients who have had at
"RTN","BIOUTPT1",313,0)
 ;;least ONE visit in the last 3 years will be included in the report.
"RTN","BIOUTPT1",314,0)
 ;;
"RTN","BIOUTPT1",315,0)
 ;;If you select "A" for Active Clinical Users, only patients who have had
"RTN","BIOUTPT1",316,0)
 ;;at least TWO qualifying visits in the last 3 years will be included in
"RTN","BIOUTPT1",317,0)
 ;;the report.  (NOTE: The RPMS GPRA software must be installed for this
"RTN","BIOUTPT1",318,0)
 ;;selection.)
"RTN","BIOUTPT1",319,0)
 D HELPTX("HELP1",5)
"RTN","BIOUTPT1",320,0)
 Q
"RTN","BIOUTPT1",321,0)
 ;
"RTN","BIOUTPT1",322,0)
 ;
"RTN","BIOUTPT1",323,0)
 ;----------
"RTN","BIOUTPT1",324,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIOUTPT1",325,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT1",326,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT1",327,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIOUTPT1",328,0)
 Q
"RTN","BIOUTPT1",329,0)
 ;
"RTN","BIOUTPT1",330,0)
 ;
"RTN","BIOUTPT1",331,0)
 ;----------
"RTN","BIOUTPT1",332,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT1",333,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT1",334,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT1",335,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIOUTPT1",336,0)
 Q
"RTN","BIOUTPT1",337,0)
 ;
"RTN","BIOUTPT1",338,0)
 ;
"RTN","BIOUTPT1",339,0)
 ;----------
"RTN","BIOUTPT1",340,0)
HELPTX(BILINL,BITAB) ;
"RTN","BIOUTPT1",341,0)
 ;---> Set DIR("?") help array from the specified line label.
"RTN","BIOUTPT1",342,0)
 ;
"RTN","BIOUTPT1",343,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT1",344,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BIOUTPT1",345,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BIOUTPT1",346,0)
 Q
"RTN","BIOUTPT2")
0^63^B95782122
"RTN","BIOUTPT2",1,0)
BIOUTPT2 ;IHS/CMI/MWR - PROMPTS FOR REPORTS.; MAY 10, 2010
"RTN","BIOUTPT2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIOUTPT2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIOUTPT2",4,0)
 ;;  PROMPTS FOR REPORT PARAMETERS.
"RTN","BIOUTPT2",5,0)
 ;
"RTN","BIOUTPT2",6,0)
 ;
"RTN","BIOUTPT2",7,0)
 ;----------
"RTN","BIOUTPT2",8,0)
SVDATE(BISVDT,BIPG,BIRTN) ;EP
"RTN","BIOUTPT2",9,0)
 ;---> Select Survey Date.  Called by Protocol BI EXPORT SURVEY DATE.
"RTN","BIOUTPT2",10,0)
 ;---> Parameters:
"RTN","BIOUTPT2",11,0)
 ;     1 - BISVDT (ret) Survey Date, Fileman format.
"RTN","BIOUTPT2",12,0)
 ;                (opt) Default Date.
"RTN","BIOUTPT2",13,0)
 ;     2 - BIPG   (req) Patient Group being surveyed.
"RTN","BIOUTPT2",14,0)
 ;     3 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT2",15,0)
 ;
"RTN","BIOUTPT2",16,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT2",17,0)
 I $G(BIPG)="" D ERRCD^BIUTL2(639,,1),@("RESET^"_BIRTN) Q
"RTN","BIOUTPT2",18,0)
 ;
"RTN","BIOUTPT2",19,0)
 ;
"RTN","BIOUTPT2",20,0)
SVDATE1 ;EP
"RTN","BIOUTPT2",21,0)
 S:$G(BISVDT)="" BISVDT=DT
"RTN","BIOUTPT2",22,0)
 N BIDFLT,DIR S BIDFLT=$$TXDT^BIUTL5(BISVDT)
"RTN","BIOUTPT2",23,0)
 S DIR(0)="DA^::PEX"
"RTN","BIOUTPT2",24,0)
 S DIR("A")="     Please enter a Survey Date: ",DIR("B")=BIDFLT
"RTN","BIOUTPT2",25,0)
 D FULL^VALM1
"RTN","BIOUTPT2",26,0)
 D TITLE^BIUTL5("SELECT SURVEY DATE")
"RTN","BIOUTPT2",27,0)
 D TEXT1 D:BIPG'=9 TEXT2,HELP2
"RTN","BIOUTPT2",28,0)
 D ^DIR W !
"RTN","BIOUTPT2",29,0)
 I $D(DIRUT) D RESET^BIDU Q
"RTN","BIOUTPT2",30,0)
 S BISVDT=$P(Y,".")
"RTN","BIOUTPT2",31,0)
 I BISVDT>DT D  G SVDATE1
"RTN","BIOUTPT2",32,0)
 .W !?5,"The date may not be in the future.  "
"RTN","BIOUTPT2",33,0)
 .W "It must be today or in the past."
"RTN","BIOUTPT2",34,0)
 .K BISVDT D DIRZ^BIUTL3()
"RTN","BIOUTPT2",35,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT2",36,0)
 Q
"RTN","BIOUTPT2",37,0)
 ;
"RTN","BIOUTPT2",38,0)
 ;
"RTN","BIOUTPT2",39,0)
 ;----------
"RTN","BIOUTPT2",40,0)
TEXT1 ;EP
"RTN","BIOUTPT2",41,0)
 ;;Please select a Survey Date (no future dates).
"RTN","BIOUTPT2",42,0)
 ;;
"RTN","BIOUTPT2",43,0)
 ;;If the Survey Date is in the past, patient age(s) will be calculated
"RTN","BIOUTPT2",44,0)
 ;;for that date, and immunizations given after that Survey Date will
"RTN","BIOUTPT2",45,0)
 ;;not be included.
"RTN","BIOUTPT2",46,0)
 ;;
"RTN","BIOUTPT2",47,0)
 D PRINTX("TEXT1")
"RTN","BIOUTPT2",48,0)
 Q
"RTN","BIOUTPT2",49,0)
 ;
"RTN","BIOUTPT2",50,0)
 ;
"RTN","BIOUTPT2",51,0)
 ;----------
"RTN","BIOUTPT2",52,0)
TEXT2 ;EP
"RTN","BIOUTPT2",53,0)
 ;;If you specify Age Range or Active Status, these will be calculated
"RTN","BIOUTPT2",54,0)
 ;;based on the Survey Date you select here.
"RTN","BIOUTPT2",55,0)
 ;;
"RTN","BIOUTPT2",56,0)
 ;;If you specify a Patient Group based on visits, only visits up to
"RTN","BIOUTPT2",57,0)
 ;;and including the Survey Date will be examined.
"RTN","BIOUTPT2",58,0)
 ;;
"RTN","BIOUTPT2",59,0)
 ;;Enter a "?" for further explanation.
"RTN","BIOUTPT2",60,0)
 ;;
"RTN","BIOUTPT2",61,0)
 D PRINTX("TEXT2")
"RTN","BIOUTPT2",62,0)
 Q
"RTN","BIOUTPT2",63,0)
 ;
"RTN","BIOUTPT2",64,0)
 ;
"RTN","BIOUTPT2",65,0)
 ;----------
"RTN","BIOUTPT2",66,0)
HELP2 ;EP
"RTN","BIOUTPT2",67,0)
 ;;If you select a specific Age Range and a Survey Date in the past,
"RTN","BIOUTPT2",68,0)
 ;;only patients whose ages fell within the Age Range on Survey Date
"RTN","BIOUTPT2",69,0)
 ;;will be included in the export.
"RTN","BIOUTPT2",70,0)
 ;;
"RTN","BIOUTPT2",71,0)
 ;;If you select a group of patients based on Active Status, only
"RTN","BIOUTPT2",72,0)
 ;;those patients who were Active on the Survey Date will be included.
"RTN","BIOUTPT2",73,0)
 ;;Patients who became Inactive prior to the Survey Date will not be
"RTN","BIOUTPT2",74,0)
 ;;included.
"RTN","BIOUTPT2",75,0)
 ;;
"RTN","BIOUTPT2",76,0)
 ;;If you select for all patients who have had immunizations, only
"RTN","BIOUTPT2",77,0)
 ;;patients who have had immunizations on or before the Survey Date
"RTN","BIOUTPT2",78,0)
 ;;will be included.
"RTN","BIOUTPT2",79,0)
 D HELPTX("HELP2")
"RTN","BIOUTPT2",80,0)
 Q
"RTN","BIOUTPT2",81,0)
 ;
"RTN","BIOUTPT2",82,0)
 ;
"RTN","BIOUTPT2",83,0)
 ;----------
"RTN","BIOUTPT2",84,0)
PATIENT(BIPAT,BIRTN) ;EP
"RTN","BIOUTPT2",85,0)
 ;---> Select Patient.  Called by Protocol BI EXPORT PATIENT.
"RTN","BIOUTPT2",86,0)
 ;---> Parameters:
"RTN","BIOUTPT2",87,0)
 ;     1 - BIPAT (ret) Local array of Patient DFNs.
"RTN","BIOUTPT2",88,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT2",89,0)
 ;
"RTN","BIOUTPT2",90,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT2",91,0)
 ;
"RTN","BIOUTPT2",92,0)
 ;---> Select one or more Patients.
"RTN","BIOUTPT2",93,0)
 ;---> Display Identifiers: Sex, DOB, Chart#.
"RTN","BIOUTPT2",94,0)
 N BIID S BIID="2;S X=$P(BI0,U,2)_""  ""_$$DOBF^BIUTL1(BIIEN,,1)"
"RTN","BIOUTPT2",95,0)
 S BIID=BIID_"_""  ""_$$HRCN^BIUTL1(BIIEN,$G(DUZ(2)));40"
"RTN","BIOUTPT2",96,0)
 N BIABBR S BIABBR=$$LOCABBR^BIUTL6($G(DUZ(2)))
"RTN","BIOUTPT2",97,0)
 S:BIABBR="" BIABBR=$E($$INSTTX^BIUTL6($G(DUZ(2))),1,11)
"RTN","BIOUTPT2",98,0)
 N BICOL S BICOL="    #  Patient                          Sex  DOB"
"RTN","BIOUTPT2",99,0)
 S BICOL=BICOL_"          Chart# at "_BIABBR
"RTN","BIOUTPT2",100,0)
 D SEL^BISELECT(9000001,"BIPAT","Patient",,,,BIID,BICOL,.BIPOP,1)
"RTN","BIOUTPT2",101,0)
 I $D(BIPAT("ALL")) D  Q
"RTN","BIOUTPT2",102,0)
 .D FULL^VALM1,TITLE^BIUTL5("SELECTING PATIENTS"),TEXT7
"RTN","BIOUTPT2",103,0)
 .K BIPAT D DIRZ^BIUTL3()
"RTN","BIOUTPT2",104,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT2",105,0)
 Q
"RTN","BIOUTPT2",106,0)
 ;
"RTN","BIOUTPT2",107,0)
 ;
"RTN","BIOUTPT2",108,0)
 ;----------
"RTN","BIOUTPT2",109,0)
TEXT7 ;EP
"RTN","BIOUTPT2",110,0)
 ;;
"RTN","BIOUTPT2",111,0)
 ;;You have selected ALL patients.  In order to work with a group of
"RTN","BIOUTPT2",112,0)
 ;;this size, other information is needed (such as Active Status, Age
"RTN","BIOUTPT2",113,0)
 ;;Range, Communities, etc.).
"RTN","BIOUTPT2",114,0)
 ;;
"RTN","BIOUTPT2",115,0)
 ;;Please begin this export process again.  The very first question
"RTN","BIOUTPT2",116,0)
 ;;asks if you wish to select patients INDIVIDUALLY or by GROUP.
"RTN","BIOUTPT2",117,0)
 ;;Choose "2) Select patients by GROUP", and proceed from there.
"RTN","BIOUTPT2",118,0)
 ;;
"RTN","BIOUTPT2",119,0)
 D PRINTX("TEXT7")
"RTN","BIOUTPT2",120,0)
 Q
"RTN","BIOUTPT2",121,0)
 ;
"RTN","BIOUTPT2",122,0)
 ;
"RTN","BIOUTPT2",123,0)
 ;----------
"RTN","BIOUTPT2",124,0)
DATAEL(BIDE,BIRTN) ;EP
"RTN","BIOUTPT2",125,0)
 ;---> Select Data Elements.
"RTN","BIOUTPT2",126,0)
 ;---> Called by Protocol BI OUTPUT DATA ELEMENTS.
"RTN","BIOUTPT2",127,0)
 ;---> Parameters:
"RTN","BIOUTPT2",128,0)
 ;     1 - BIDE  (ret) Local array of Lot Number IENs.
"RTN","BIOUTPT2",129,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT2",130,0)
 ;
"RTN","BIOUTPT2",131,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT2",132,0)
 ;
"RTN","BIOUTPT2",133,0)
 D FULL^VALM1 N BIPOP
"RTN","BIOUTPT2",134,0)
 D TITLE^BIUTL5("SELECT DATA ELEMENTS"),TEXT3
"RTN","BIOUTPT2",135,0)
 D DIRZ^BIUTL3(.BIPOP)
"RTN","BIOUTPT2",136,0)
 I $G(BIPOP) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT2",137,0)
 ;
"RTN","BIOUTPT2",138,0)
 ;---> Screen: only Data Elements for Immunizations or All.
"RTN","BIOUTPT2",139,0)
 N BIIT S BIIT="Data Element"
"RTN","BIOUTPT2",140,0)
 N BISCR S BISCR="I ""AI""[$P(^BIEXPDD(Y,0),U,4)"
"RTN","BIOUTPT2",141,0)
 N BICOL S BICOL="    #  Data Element                       Synonym"
"RTN","BIOUTPT2",142,0)
 D SEL^BISELECT(9002084.91,"BIDE",BIIT,BISCR,,,"3;;40",BICOL,.BIPOP,1)
"RTN","BIOUTPT2",143,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT2",144,0)
 Q
"RTN","BIOUTPT2",145,0)
 ;
"RTN","BIOUTPT2",146,0)
 ;
"RTN","BIOUTPT2",147,0)
 ;----------
"RTN","BIOUTPT2",148,0)
TEXT3 ;EP
"RTN","BIOUTPT2",149,0)
 ;;
"RTN","BIOUTPT2",150,0)
 ;;                               NOTES
"RTN","BIOUTPT2",151,0)
 ;;                              -------
"RTN","BIOUTPT2",152,0)
 ;;Data Element selection only pertains to exports with ASCII Format.
"RTN","BIOUTPT2",153,0)
 ;;(ImmServe Data Elements are predetermined.)
"RTN","BIOUTPT2",154,0)
 ;;
"RTN","BIOUTPT2",155,0)
 ;;The very first (or top) record will list, by title, the selected
"RTN","BIOUTPT2",156,0)
 ;;Data Elements in the order in which they occur in the following
"RTN","BIOUTPT2",157,0)
 ;;records.
"RTN","BIOUTPT2",158,0)
 ;;
"RTN","BIOUTPT2",159,0)
 D PRINTX("TEXT3")
"RTN","BIOUTPT2",160,0)
 Q
"RTN","BIOUTPT2",161,0)
 ;;(HL7 and ImmServe Data Elements are predetermined.)
"RTN","BIOUTPT2",162,0)
 ;;
"RTN","BIOUTPT2",163,0)
 ;;If you intend to export in HL7 or ImmServe formats, disregard this
"RTN","BIOUTPT2",164,0)
 ;;Data Element selection.
"RTN","BIOUTPT2",165,0)
 Q
"RTN","BIOUTPT2",166,0)
 ;
"RTN","BIOUTPT2",167,0)
 ;
"RTN","BIOUTPT2",168,0)
 ;----------
"RTN","BIOUTPT2",169,0)
FORMAT(BIFMT,BIRTN) ;EP
"RTN","BIOUTPT2",170,0)
 ;---> Select Format for record export.
"RTN","BIOUTPT2",171,0)
 ;---> Called by Protocol BI EXPORT FORMAT.
"RTN","BIOUTPT2",172,0)
 ;---> Parameters:
"RTN","BIOUTPT2",173,0)
 ;     1 - BIFMT (ret) File Format (1=ASCII,2=HL7,3=ImmServe).
"RTN","BIOUTPT2",174,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT2",175,0)
 ;
"RTN","BIOUTPT2",176,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT2",177,0)
 ;
"RTN","BIOUTPT2",178,0)
 D FULL^VALM1
"RTN","BIOUTPT2",179,0)
 D TITLE^BIUTL5("SELECT EXPORT FORMAT"),TEXT4
"RTN","BIOUTPT2",180,0)
 N Y S:'$G(BIFMT) BIFMT=1
"RTN","BIOUTPT2",181,0)
 S A="     Please select a Format: "
"RTN","BIOUTPT2",182,0)
 ;
"RTN","BIOUTPT2",183,0)
 ;---> Remove HL7, at least for now.
"RTN","BIOUTPT2",184,0)
 ;D DIR^BIFMAN("SM^1:ASCII;2:HL7;3:ImmServe",.Y,.BIPOP,A,"ASCII")
"RTN","BIOUTPT2",185,0)
 D DIR^BIFMAN("SM^1:ASCII;3:ImmServe",.Y,.BIPOP,A,"ASCII")
"RTN","BIOUTPT2",186,0)
 S:Y BIFMT=Y
"RTN","BIOUTPT2",187,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT2",188,0)
 Q
"RTN","BIOUTPT2",189,0)
 ;
"RTN","BIOUTPT2",190,0)
 ;
"RTN","BIOUTPT2",191,0)
 ;----------
"RTN","BIOUTPT2",192,0)
TEXT4 ;EP
"RTN","BIOUTPT2",193,0)
 ;;You may export records in either ASCII or ImmServe format.
"RTN","BIOUTPT2",194,0)
 ;;
"RTN","BIOUTPT2",195,0)
 ;;ASCII format will produce the Data Elements you specify for each
"RTN","BIOUTPT2",196,0)
 ;;immunization on a separate line or record.  Data Elements will be
"RTN","BIOUTPT2",197,0)
 ;;separated by quote-comma-quote (known as a CSV file).
"RTN","BIOUTPT2",198,0)
 ;;
"RTN","BIOUTPT2",199,0)
 ;;ImmServe is a commercial, vendor-specific format of use only to
"RTN","BIOUTPT2",200,0)
 ;;programmers working with this software.
"RTN","BIOUTPT2",201,0)
 D PRINTX("TEXT4")
"RTN","BIOUTPT2",202,0)
 Q
"RTN","BIOUTPT2",203,0)
 ;;---> Removed from above, for now at least.
"RTN","BIOUTPT2",204,0)
 ;;HL7 will produce Immunization records according to the HL7 standard.
"RTN","BIOUTPT2",205,0)
 ;
"RTN","BIOUTPT2",206,0)
 ;
"RTN","BIOUTPT2",207,0)
 ;----------
"RTN","BIOUTPT2",208,0)
OUTPUT(BIOUT,BIFLNM,BIPATH,BIRTN) ;EP
"RTN","BIOUTPT2",209,0)
 ;---> Select Output Device for Export Data.
"RTN","BIOUTPT2",210,0)
 ;---> Called by Protocol BI EXPORT OUTPUT DEVICE.
"RTN","BIOUTPT2",211,0)
 ;---> Parameters:
"RTN","BIOUTPT2",212,0)
 ;     1 - BIOUT  (ret) 0=Screen, 1=File.
"RTN","BIOUTPT2",213,0)
 ;     2 - BIFLNM (ret) File name given by the user.
"RTN","BIOUTPT2",214,0)
 ;     3 - BIPATH (ret) Path name set in Site Parameters.
"RTN","BIOUTPT2",215,0)
 ;     4 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT2",216,0)
 ;
"RTN","BIOUTPT2",217,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT2",218,0)
 ;
"RTN","BIOUTPT2",219,0)
 D FULL^VALM1
"RTN","BIOUTPT2",220,0)
 D TITLE^BIUTL5("SELECT OUTPUT DEVICE"),TEXT5
"RTN","BIOUTPT2",221,0)
 N BIPOP,Y S:'$D(BIOUT) BIOUT=0
"RTN","BIOUTPT2",222,0)
 ;
"RTN","BIOUTPT2",223,0)
 N A,B S A="   Select SCREEN or FILE: "
"RTN","BIOUTPT2",224,0)
 S B=$S(BIOUT:"FILE",1:"SCREEN")
"RTN","BIOUTPT2",225,0)
 D DIR^BIFMAN("SAM^0:SCREEN;1:FILE",.Y,.BIPOP,A,B)
"RTN","BIOUTPT2",226,0)
 ;
"RTN","BIOUTPT2",227,0)
 ;---> If user chose Screen, or ^out, quit.
"RTN","BIOUTPT2",228,0)
 S BIOUT=Y
"RTN","BIOUTPT2",229,0)
 I 'BIOUT!($G(BIPOP)) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT2",230,0)
 ;
"RTN","BIOUTPT2",231,0)
 ;---> Enter file name, if required.
"RTN","BIOUTPT2",232,0)
 D TITLE^BIUTL5("ENTER OUTPUT FILE NAME")
"RTN","BIOUTPT2",233,0)
 F  D  Q:BIPOP  Q:BIFLNM]""
"RTN","BIOUTPT2",234,0)
 .N Q,Z D TEXT6
"RTN","BIOUTPT2",235,0)
 .S Q="     Contact your site manager for assistance."
"RTN","BIOUTPT2",236,0)
 .S Z="     Enter the file name without any path "
"RTN","BIOUTPT2",237,0)
 .S Z=Z_"--just the file name itself."
"RTN","BIOUTPT2",238,0)
 .D DIR^BIFMAN("FA",.BIFLNM,.BIPOP,"   Enter file name: ","",Q,Z)
"RTN","BIOUTPT2",239,0)
 .Q:BIPOP
"RTN","BIOUTPT2",240,0)
 .I BIFLNM["\"!(BIFLNM["/")!(BIFLNM[":")!(BIFLNM[";")!(BIFLNM[" ") D
"RTN","BIOUTPT2",241,0)
 ..W !!?5,"File name must not contain ""\"", ""/"", "":"" or spaces."
"RTN","BIOUTPT2",242,0)
 ..S BIFLNM=""
"RTN","BIOUTPT2",243,0)
 ;
"RTN","BIOUTPT2",244,0)
 ;---> Quit if user up-arrowed out.
"RTN","BIOUTPT2",245,0)
 I BIFLNM["^" S BIFLNM="" D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT2",246,0)
 ;
"RTN","BIOUTPT2",247,0)
 ;---> Return path, open Host File and test access and close it.
"RTN","BIOUTPT2",248,0)
 D HFS^BIEXPRT8(BIFLNM,.BIPATH,0,.BIPOP)
"RTN","BIOUTPT2",249,0)
 I $G(BIPOP) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT2",250,0)
 ;
"RTN","BIOUTPT2",251,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT2",252,0)
 Q
"RTN","BIOUTPT2",253,0)
 ;
"RTN","BIOUTPT2",254,0)
 ;
"RTN","BIOUTPT2",255,0)
 ;----------
"RTN","BIOUTPT2",256,0)
TEXT5 ;EP
"RTN","BIOUTPT2",257,0)
 ;;There are two methods of exporting the data.
"RTN","BIOUTPT2",258,0)
 ;;
"RTN","BIOUTPT2",259,0)
 ;;You may either:
"RTN","BIOUTPT2",260,0)
 ;;
"RTN","BIOUTPT2",261,0)
 ;; * Select SCREEN to send the data to your screen.  If you are using
"RTN","BIOUTPT2",262,0)
 ;;   a PC, this method will allow you to capture the output of data to
"RTN","BIOUTPT2",263,0)
 ;;   your screen and then save it as a file.  However, you must refer
"RTN","BIOUTPT2",264,0)
 ;;   to your PC software documentation for help with this procedure.
"RTN","BIOUTPT2",265,0)
 ;;or
"RTN","BIOUTPT2",266,0)
 ;;
"RTN","BIOUTPT2",267,0)
 ;; * Select FILE, to send the exported data to a host file.
"RTN","BIOUTPT2",268,0)
 ;;   If your data is sent to a host file, it can then be copied to
"RTN","BIOUTPT2",269,0)
 ;;   a floppy or transmitted to another computer for processing.
"RTN","BIOUTPT2",270,0)
 ;;   See your sitemanager for help with this procedure.
"RTN","BIOUTPT2",271,0)
 ;;
"RTN","BIOUTPT2",272,0)
 D PRINTX("TEXT5")
"RTN","BIOUTPT2",273,0)
 Q
"RTN","BIOUTPT2",274,0)
 ;
"RTN","BIOUTPT2",275,0)
 ;
"RTN","BIOUTPT2",276,0)
 ;----------
"RTN","BIOUTPT2",277,0)
TEXT6 ;EP
"RTN","BIOUTPT2",278,0)
 ;;
"RTN","BIOUTPT2",279,0)
 ;;Enter a name for the file you are exporting.  The file name must
"RTN","BIOUTPT2",280,0)
 ;;conform the filenaming conventions of your operating system.
"RTN","BIOUTPT2",281,0)
 ;;Do not include any slashes, colons, or spaces in the file name.
"RTN","BIOUTPT2",282,0)
 ;;
"RTN","BIOUTPT2",283,0)
 ;;The Export File will have a path name prepended to the filename you
"RTN","BIOUTPT2",284,0)
 ;;enter here.  The path is set in the Site Parameters (MGR-->ESP) by
"RTN","BIOUTPT2",285,0)
 ;;your Site Manager or Package Manager.
"RTN","BIOUTPT2",286,0)
 ;;
"RTN","BIOUTPT2",287,0)
 D PRINTX("TEXT6")
"RTN","BIOUTPT2",288,0)
 Q
"RTN","BIOUTPT2",289,0)
 ;
"RTN","BIOUTPT2",290,0)
 ;
"RTN","BIOUTPT2",291,0)
 ;----------
"RTN","BIOUTPT2",292,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT2",293,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT2",294,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT2",295,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIOUTPT2",296,0)
 Q
"RTN","BIOUTPT2",297,0)
 ;
"RTN","BIOUTPT2",298,0)
 ;
"RTN","BIOUTPT2",299,0)
 ;----------
"RTN","BIOUTPT2",300,0)
HELPTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT2",301,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT2",302,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BIOUTPT2",303,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BIOUTPT2",304,0)
 Q
"RTN","BIOUTPT3")
0^64^B200232267
"RTN","BIOUTPT3",1,0)
BIOUTPT3 ;IHS/CMI/MWR - PROMPTS FOR REPORTS.; MAY 10, 2010
"RTN","BIOUTPT3",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIOUTPT3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIOUTPT3",4,0)
 ;;  PROMPTS FOR REPORT PARAMETERS.
"RTN","BIOUTPT3",5,0)
 ;;  PATCH 1: Clarify Date Range on Imms Received with added prompt.  IMMRCV+20
"RTN","BIOUTPT3",6,0)
 ;;  PATCH 2: Add two more questions, U19 and DELIM.
"RTN","BIOUTPT3",7,0)
 ;;  PATCH 9: Corrected spelling and setting of parameter BIMMRF.  IMMRCV+0
"RTN","BIOUTPT3",8,0)
 ;
"RTN","BIOUTPT3",9,0)
 ;
"RTN","BIOUTPT3",10,0)
 ;----------
"RTN","BIOUTPT3",11,0)
MINDAYS(BIMD,BIPOP) ;EP
"RTN","BIOUTPT3",12,0)
 ;---> Select Minimum Number of days since last letter sent.
"RTN","BIOUTPT3",13,0)
 ;---> Called by routine BIDUPLT.
"RTN","BIOUTPT3",14,0)
 ;---> Parameters:
"RTN","BIOUTPT3",15,0)
 ;     1 - BIMD (ret) Minimum Days since Last Letter.
"RTN","BIOUTPT3",16,0)
 ;     2 - BIPOP  (ret) BIPOP=1 if DTOUT or DUOUT
"RTN","BIOUTPT3",17,0)
 ;
"RTN","BIOUTPT3",18,0)
 D FULL^VALM1
"RTN","BIOUTPT3",19,0)
 D TITLE^BIUTL5("SELECT MINIMUM DAYS SINCE LAST LETTER")
"RTN","BIOUTPT3",20,0)
 W !!?3,"Please specify the minimum number of days between a patient's"
"RTN","BIOUTPT3",21,0)
 W !?3,"previous letter and today's letter."
"RTN","BIOUTPT3",22,0)
 W !?3,"Type ""?"" (no quotes) for further explanation.",!!
"RTN","BIOUTPT3",23,0)
 N DIR,DIRUT D HELP2
"RTN","BIOUTPT3",24,0)
 S DIR(0)="NOA^0:9999:0"
"RTN","BIOUTPT3",25,0)
 S DIR("A")="   Enter Number of Days: "
"RTN","BIOUTPT3",26,0)
 S DIR("B")=$$MINDAYS^BIUTL2(DUZ(2))
"RTN","BIOUTPT3",27,0)
 D FULL^VALM1
"RTN","BIOUTPT3",28,0)
 D ^DIR
"RTN","BIOUTPT3",29,0)
 I $D(DIRUT) S BIPOP=1 Q
"RTN","BIOUTPT3",30,0)
 S BIMD=+Y S:BIMD<0 BIMD=$$MINDAYS^BIUTL2(DUZ(2))
"RTN","BIOUTPT3",31,0)
 Q
"RTN","BIOUTPT3",32,0)
 ;
"RTN","BIOUTPT3",33,0)
 ;
"RTN","BIOUTPT3",34,0)
 ;----------
"RTN","BIOUTPT3",35,0)
HELP2 ;EP
"RTN","BIOUTPT3",36,0)
 ;;The Minimum Days Since Last Letter is the least number of days that
"RTN","BIOUTPT3",37,0)
 ;;must elapse--after a letter has been sent to a patient--before the
"RTN","BIOUTPT3",38,0)
 ;;software will automatically send another letter to that same patient.
"RTN","BIOUTPT3",39,0)
 ;;
"RTN","BIOUTPT3",40,0)
 ;;For example, if a patient received a letter 2 weeks ago and
"RTN","BIOUTPT3",41,0)
 ;;the Minimum Days Last Letter is 60 days, then this software will
"RTN","BIOUTPT3",42,0)
 ;;not generate a new letter for that patient today, even if the patient
"RTN","BIOUTPT3",43,0)
 ;;fits the other criteria you have selected for Age, Community,
"RTN","BIOUTPT3",44,0)
 ;;Immunizations Due, etc.
"RTN","BIOUTPT3",45,0)
 D HELPTX("HELP2")
"RTN","BIOUTPT3",46,0)
 Q
"RTN","BIOUTPT3",47,0)
 ;
"RTN","BIOUTPT3",48,0)
 ;
"RTN","BIOUTPT3",49,0)
 ;----------
"RTN","BIOUTPT3",50,0)
LOTNUM(BILOT,BIRTN) ;EP
"RTN","BIOUTPT3",51,0)
 ;---> Select Lot Numbers.
"RTN","BIOUTPT3",52,0)
 ;---> Called by Protocol BI OUTPUT LOT NUMBER.
"RTN","BIOUTPT3",53,0)
 ;---> Parameters:
"RTN","BIOUTPT3",54,0)
 ;     1 - BILOT (ret) Local array of Lot Number IENs.
"RTN","BIOUTPT3",55,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT3",56,0)
 ;
"RTN","BIOUTPT3",57,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",58,0)
 ;
"RTN","BIOUTPT3",59,0)
 ;---> Select cases for one or more LOT NUMBERS (OR ALL).
"RTN","BIOUTPT3",60,0)
 N BIID S BIID="2;I $G(X) S:$D(^AUTTIMAN(X,0)) X=$P(^(0),U);17"
"RTN","BIOUTPT3",61,0)
 N BICOL S BICOL="    #  Lot Number  Manufacturer"
"RTN","BIOUTPT3",62,0)
 D SEL^BISELECT(9999999.41,"BILOT","Lot Number",,,,BIID,BICOL,.BIPOP)
"RTN","BIOUTPT3",63,0)
 ;
"RTN","BIOUTPT3",64,0)
 ;
"RTN","BIOUTPT3",65,0)
 D:('$D(BILOT("ALL")))
"RTN","BIOUTPT3",66,0)
 .D TITLE^BIUTL5("FULL OR LIMITED HISTORY")
"RTN","BIOUTPT3",67,0)
 .D TEXT7
"RTN","BIOUTPT3",68,0)
 .S B=$S($D(BI):"Yes",1:"No")
"RTN","BIOUTPT3",69,0)
 .D DIR^BIFMAN("YAO",.Y,,"     Limit histories to selected lot numbers? (Yes/No): ",B)
"RTN","BIOUTPT3",70,0)
 .I 'Y K BIMMLF Q
"RTN","BIOUTPT3",71,0)
 .N N S N=0
"RTN","BIOUTPT3",72,0)
 .F  S N=$O(BILOT(N)) Q:'N  D
"RTN","BIOUTPT3",73,0)
 ..N M S M=$$LOTTX^BIUTL6(N)
"RTN","BIOUTPT3",74,0)
 ..S:M BIMMLF(M)=""
"RTN","BIOUTPT3",75,0)
 ;
"RTN","BIOUTPT3",76,0)
 ;
"RTN","BIOUTPT3",77,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",78,0)
 Q
"RTN","BIOUTPT3",79,0)
 ;
"RTN","BIOUTPT3",80,0)
 ;
"RTN","BIOUTPT3",81,0)
 ;----------
"RTN","BIOUTPT3",82,0)
PGROUP2(BIPG,BIRTN) ;EP
"RTN","BIOUTPT3",83,0)
 ;---> Selecting Patient Group (instead of individually).
"RTN","BIOUTPT3",84,0)
 ;---> Called by Protocol BI OUTPUT IMMUNIZATION DUE.
"RTN","BIOUTPT3",85,0)
 ;---> Parameters:
"RTN","BIOUTPT3",86,0)
 ;     1 - BIPG  (ret) Patient Group.
"RTN","BIOUTPT3",87,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT3",88,0)
 ;
"RTN","BIOUTPT3",89,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",90,0)
 ;
"RTN","BIOUTPT3",91,0)
 ;---> Select group of patients to be exported.
"RTN","BIOUTPT3",92,0)
 S:'$G(BIPG) BIPG=1
"RTN","BIOUTPT3",93,0)
 N DIR,X
"RTN","BIOUTPT3",94,0)
 D FULL^VALM1
"RTN","BIOUTPT3",95,0)
 D TITLE^BIUTL5("SELECT PATIENT GROUP"),TEXT1,HELP1
"RTN","BIOUTPT3",96,0)
 S X="SO^1:Active only;2:Active + Inactive"
"RTN","BIOUTPT3",97,0)
 S X=X_";3:All who have had an Immunization Visit"
"RTN","BIOUTPT3",98,0)
 S DIR(0)=X,DIR("B")=BIPG
"RTN","BIOUTPT3",99,0)
 D ^DIR
"RTN","BIOUTPT3",100,0)
 S:'$D(DIRUT) BIPG=+Y
"RTN","BIOUTPT3",101,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",102,0)
 Q
"RTN","BIOUTPT3",103,0)
 ;
"RTN","BIOUTPT3",104,0)
 ;
"RTN","BIOUTPT3",105,0)
 ;----------
"RTN","BIOUTPT3",106,0)
TEXT1 ;EP
"RTN","BIOUTPT3",107,0)
 ;;Please select a Patient Group from the following:
"RTN","BIOUTPT3",108,0)
 ;;
"RTN","BIOUTPT3",109,0)
 ;; 1) Only patients who were ACTIVE in the Immunization Register on
"RTN","BIOUTPT3",110,0)
 ;;    the Survey Date.
"RTN","BIOUTPT3",111,0)
 ;;
"RTN","BIOUTPT3",112,0)
 ;; 2) BOTH Active and Inactive patients in the Immunization Register.
"RTN","BIOUTPT3",113,0)
 ;;
"RTN","BIOUTPT3",114,0)
 ;; 3) ALL patients who have had an Immunization at the selected
"RTN","BIOUTPT3",115,0)
 ;;    facility(s), including those NOT in the Immunization Register.
"RTN","BIOUTPT3",116,0)
 ;;
"RTN","BIOUTPT3",117,0)
 D PRINTX("TEXT1",3)
"RTN","BIOUTPT3",118,0)
 Q
"RTN","BIOUTPT3",119,0)
 ;
"RTN","BIOUTPT3",120,0)
 ;
"RTN","BIOUTPT3",121,0)
 ;----------
"RTN","BIOUTPT3",122,0)
HELP1 ;EP
"RTN","BIOUTPT3",123,0)
 ;;
"RTN","BIOUTPT3",124,0)
 ;;
"RTN","BIOUTPT3",125,0)
 ;;Choose a number 1-3 that represents the group of Patients whose
"RTN","BIOUTPT3",126,0)
 ;;data you wish to export.
"RTN","BIOUTPT3",127,0)
 ;;
"RTN","BIOUTPT3",128,0)
 ;;NOTE: This group will be subject to the other selections you make
"RTN","BIOUTPT3",129,0)
 ;;      regarding Age Range, Community, Health Care Facility, etc.
"RTN","BIOUTPT3",130,0)
 ;;
"RTN","BIOUTPT3",131,0)
 D HELPTX("HELP1")
"RTN","BIOUTPT3",132,0)
 Q
"RTN","BIOUTPT3",133,0)
 ;
"RTN","BIOUTPT3",134,0)
 ;
"RTN","BIOUTPT3",135,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIOUTPT3",136,0)
 ;---> Corrected spelling and setting of parameter BIMMRF below.
"RTN","BIOUTPT3",137,0)
 ;----------
"RTN","BIOUTPT3",138,0)
IMMRCV(BIMMR,BIRDT,BIMMRF,BIRTN) ;EP
"RTN","BIOUTPT3",139,0)
 ;---> Select Immunizations Received.
"RTN","BIOUTPT3",140,0)
 ;---> Called by Protocol BI OUTPUT IMMUNIZATION RECEIVED.
"RTN","BIOUTPT3",141,0)
 ;---> Parameters:
"RTN","BIOUTPT3",142,0)
 ;     1 - BIMMR  (ret) Local array of Vaccine IENs.
"RTN","BIOUTPT3",143,0)
 ;     2 - BIRDT  (ret) Date Range for Imms received: BeginDate_":"_EndDate
"RTN","BIOUTPT3",144,0)
 ;     3 - BIMMRF (ret) Local array of Vaccine IENs to be filtered.
"RTN","BIOUTPT3",145,0)
 ;     4 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT3",146,0)
 ;
"RTN","BIOUTPT3",147,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",148,0)
 ;
"RTN","BIOUTPT3",149,0)
 ;---> Select cases for one or more IMMUNIZATIONS RECEIVED (OR ALL).
"RTN","BIOUTPT3",150,0)
 N BICOL S BICOL="    #  Vaccine Received   HL7 Code"
"RTN","BIOUTPT3",151,0)
 D SEL^BISELECT(9999999.14,"BIMMR","Vaccine",,,2,"3;;24",BICOL,.BIPOP)
"RTN","BIOUTPT3",152,0)
 ;
"RTN","BIOUTPT3",153,0)
 D:'$G(BIPOP)
"RTN","BIOUTPT3",154,0)
 .N BIBEGDT,BIENDDT,BIBEGDF,BIENDDF,X
"RTN","BIOUTPT3",155,0)
 .S X=$G(BIRDT) S BIBEGDF=$P(X,":"),BIENDDF=$P(X,":",2)
"RTN","BIOUTPT3",156,0)
 .S:'BIBEGDF BIBEGDF=2000101 S:'BIENDDF BIENDDF=$G(DT)
"RTN","BIOUTPT3",157,0)
 .D TITLE^BIUTL5("SELECT IMMUNIZATION RECEIVED DATE RANGE")
"RTN","BIOUTPT3",158,0)
 .D TEXT4
"RTN","BIOUTPT3",159,0)
 .;
"RTN","BIOUTPT3",160,0)
 .W !!,"   Do you wish to specify a date range for immunizations received?"
"RTN","BIOUTPT3",161,0)
 .N DIR S DIR("?")="     Enter YES to specify a date range; NO to ignore dates."
"RTN","BIOUTPT3",162,0)
 .S DIR(0)="Y",DIR("A")="   Enter Yes or No",DIR("B")="NO"
"RTN","BIOUTPT3",163,0)
 .D ^DIR W !
"RTN","BIOUTPT3",164,0)
 .I ($D(DIRUT)!'$G(Y)) S BIRDT="" Q
"RTN","BIOUTPT3",165,0)
 .;
"RTN","BIOUTPT3",166,0)
 .D TITLE^BIUTL5("SELECT IMMUNIZATION RECEIVED DATE RANGE")
"RTN","BIOUTPT3",167,0)
 .D TEXT5
"RTN","BIOUTPT3",168,0)
 .D ASKDATES^BIUTL3(.BIBEGDT,.BIENDDT,.BIPOP,BIBEGDF,BIENDDF)
"RTN","BIOUTPT3",169,0)
 .Q:$G(BIPOP)
"RTN","BIOUTPT3",170,0)
 .S:'BIBEGDT BIBEGDT=2000101 S:'BIENDDT BIENDDT=$G(DT)
"RTN","BIOUTPT3",171,0)
 .S BIRDT=BIBEGDT_":"_BIENDDT
"RTN","BIOUTPT3",172,0)
 ;
"RTN","BIOUTPT3",173,0)
 D:('$D(BIMMR("ALL")))
"RTN","BIOUTPT3",174,0)
 .D TITLE^BIUTL5("FULL OR LIMITED HISTORY")
"RTN","BIOUTPT3",175,0)
 .D TEXT6
"RTN","BIOUTPT3",176,0)
 .S B=$S($D(BI):"Yes",1:"No")
"RTN","BIOUTPT3",177,0)
 .D DIR^BIFMAN("YAO",.Y,,"     Limit histories to selected vaccines? (Yes/No): ",B)
"RTN","BIOUTPT3",178,0)
 .I 'Y K BIMMRF S BIMMRF("ALL")="" Q
"RTN","BIOUTPT3",179,0)
 .K BIMMRF("ALL")
"RTN","BIOUTPT3",180,0)
 .N N S N=0
"RTN","BIOUTPT3",181,0)
 .F  S N=$O(BIMMR(N)) Q:'N  D
"RTN","BIOUTPT3",182,0)
 ..S BIMMRF(N)=""
"RTN","BIOUTPT3",183,0)
 ;**********
"RTN","BIOUTPT3",184,0)
 ;
"RTN","BIOUTPT3",185,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",186,0)
 Q
"RTN","BIOUTPT3",187,0)
 ;
"RTN","BIOUTPT3",188,0)
 ;
"RTN","BIOUTPT3",189,0)
 ;----------
"RTN","BIOUTPT3",190,0)
TEXT4 ;EP
"RTN","BIOUTPT3",191,0)
 ;;You may limit this list to patients who have received the vaccines
"RTN","BIOUTPT3",192,0)
 ;;you selected within a specific date range.  This date range will
"RTN","BIOUTPT3",193,0)
 ;;apply to your list, whether you have chosen just one vaccine or
"RTN","BIOUTPT3",194,0)
 ;;several vaccines or all vaccines.
"RTN","BIOUTPT3",195,0)
 ;;
"RTN","BIOUTPT3",196,0)
 ;;NOTE: If you selected "ALL" vaccines and do NOT specify a date range,
"RTN","BIOUTPT3",197,0)
 ;;then this filter becomes essentially inactive and will have no effect
"RTN","BIOUTPT3",198,0)
 ;;on your list (patients will not be excluded on the basis of immunizations
"RTN","BIOUTPT3",199,0)
 ;;received, even if they have never received any immunization).
"RTN","BIOUTPT3",200,0)
 ;;
"RTN","BIOUTPT3",201,0)
 ;;However, if you selected "ALL" vaccines and you DO specify a date range,
"RTN","BIOUTPT3",202,0)
 ;;then only patients who have received AT LEAST ONE immunization during
"RTN","BIOUTPT3",203,0)
 ;;your date range will be included. (Patients who did not receive ANY
"RTN","BIOUTPT3",204,0)
 ;;immunizations during your date range will be excluded from the report.)
"RTN","BIOUTPT3",205,0)
 ;;
"RTN","BIOUTPT3",206,0)
 D PRINTX("TEXT4")
"RTN","BIOUTPT3",207,0)
 Q
"RTN","BIOUTPT3",208,0)
 ;
"RTN","BIOUTPT3",209,0)
 ;
"RTN","BIOUTPT3",210,0)
 ;----------
"RTN","BIOUTPT3",211,0)
TEXT5 ;EP
"RTN","BIOUTPT3",212,0)
 ;;By default, the date range is from 1/1/1900 to today (essentially
"RTN","BIOUTPT3",213,0)
 ;;not limited by date).  However, you can specify a different date
"RTN","BIOUTPT3",214,0)
 ;;range below.  Only patients who have received the specified vaccines
"RTN","BIOUTPT3",215,0)
 ;;within the date range you select will be included in the list.
"RTN","BIOUTPT3",216,0)
 ;;
"RTN","BIOUTPT3",217,0)
 D PRINTX("TEXT5")
"RTN","BIOUTPT3",218,0)
 Q
"RTN","BIOUTPT3",219,0)
 ;
"RTN","BIOUTPT3",220,0)
 ;
"RTN","BIOUTPT3",221,0)
 ;----------
"RTN","BIOUTPT3",222,0)
TEXT6 ;EP
"RTN","BIOUTPT3",223,0)
 ;;You have limited your list to patients who have received one or more
"RTN","BIOUTPT3",224,0)
 ;;of the specific vaccines you selected.
"RTN","BIOUTPT3",225,0)
 ;;
"RTN","BIOUTPT3",226,0)
 ;;If you print/export their immunization histories in a list, would you
"RTN","BIOUTPT3",227,0)
 ;;like to include the history of ONLY the vaccines you selected?
"RTN","BIOUTPT3",228,0)
 ;;
"RTN","BIOUTPT3",229,0)
 ;;Or would you like to include the ENTIRE patient histories?
"RTN","BIOUTPT3",230,0)
 ;;
"RTN","BIOUTPT3",231,0)
 ;;NOTE: If you have limited your export to patients who have received
"RTN","BIOUTPT3",232,0)
 ;;one or more vaccines WITHIN A DATE RANGE, but you also elect to include
"RTN","BIOUTPT3",233,0)
 ;;their entire immunization histories, then some immunizations outside the
"RTN","BIOUTPT3",234,0)
 ;;date range will most likely be included in the export.
"RTN","BIOUTPT3",235,0)
 ;;
"RTN","BIOUTPT3",236,0)
 ;;THIS IS NOT AN ERROR.  It is merely a consequence of including the entire
"RTN","BIOUTPT3",237,0)
 ;;histories of patients who have already been filtered for the specific
"RTN","BIOUTPT3",238,0)
 ;;vaccine within the date range.
"RTN","BIOUTPT3",239,0)
 ;;
"RTN","BIOUTPT3",240,0)
 D PRINTX("TEXT6")
"RTN","BIOUTPT3",241,0)
 Q
"RTN","BIOUTPT3",242,0)
 ;
"RTN","BIOUTPT3",243,0)
 ;
"RTN","BIOUTPT3",244,0)
 ;----------
"RTN","BIOUTPT3",245,0)
TEXT7 ;EP
"RTN","BIOUTPT3",246,0)
 ;;You have limited your list to patients who have received one or more
"RTN","BIOUTPT3",247,0)
 ;;specific lot numbers.
"RTN","BIOUTPT3",248,0)
 ;;
"RTN","BIOUTPT3",249,0)
 ;;If you print their immunization histories in a list, would you like
"RTN","BIOUTPT3",250,0)
 ;;to display only the history of the lot numbers you selected?
"RTN","BIOUTPT3",251,0)
 ;;
"RTN","BIOUTPT3",252,0)
 D PRINTX("TEXT7")
"RTN","BIOUTPT3",253,0)
 Q
"RTN","BIOUTPT3",254,0)
 ;
"RTN","BIOUTPT3",255,0)
 ;
"RTN","BIOUTPT3",256,0)
 ;----------
"RTN","BIOUTPT3",257,0)
IMMDUE(BIMMD,BIRTN) ;EP
"RTN","BIOUTPT3",258,0)
 ;---> Select Immunizations Due.
"RTN","BIOUTPT3",259,0)
 ;---> Called by Protocol BI OUTPUT IMMUNIZATION DUE.
"RTN","BIOUTPT3",260,0)
 ;---> Parameters:
"RTN","BIOUTPT3",261,0)
 ;     1 - BIMMD (ret) Local array of Vaccine IENs.
"RTN","BIOUTPT3",262,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT3",263,0)
 ;
"RTN","BIOUTPT3",264,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",265,0)
 ;
"RTN","BIOUTPT3",266,0)
 ;---> Select cases for one or more IMMUNIZATIONS DUE (OR ALL).
"RTN","BIOUTPT3",267,0)
 N BICOL S BICOL="    #  Vaccine Due   HL7 Code"
"RTN","BIOUTPT3",268,0)
 D SEL^BISELECT(9999999.14,"BIMMD","Vaccine",,,2,"3;;19",BICOL,.BIPOP)
"RTN","BIOUTPT3",269,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",270,0)
 Q
"RTN","BIOUTPT3",271,0)
 ;
"RTN","BIOUTPT3",272,0)
 ;
"RTN","BIOUTPT3",273,0)
HISTORC(BIHIST,BIRTN) ;EP
"RTN","BIOUTPT3",274,0)
 ;---> Select whether to include Historical Visits.
"RTN","BIOUTPT3",275,0)
 ;---> Called by Protocol BI OUTPUT HISTORICAL.
"RTN","BIOUTPT3",276,0)
 ;---> Parameters:
"RTN","BIOUTPT3",277,0)
 ;     1 - BIHIST (ret) Include Historical (1=yes,0=no).
"RTN","BIOUTPT3",278,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT3",279,0)
 ;
"RTN","BIOUTPT3",280,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",281,0)
 ;
"RTN","BIOUTPT3",282,0)
 D FULL^VALM1
"RTN","BIOUTPT3",283,0)
 D TITLE^BIUTL5("INCLUDE HISTORICAL VISITS"),TEXT2
"RTN","BIOUTPT3",284,0)
 N A,B,Y S:'$G(BIHIST) BIHIST=1
"RTN","BIOUTPT3",285,0)
 S A="     Include Historical Visits (Yes/No): "
"RTN","BIOUTPT3",286,0)
 S B=$S(BIHIST:"YES",1:"NO")
"RTN","BIOUTPT3",287,0)
 D DIR^BIFMAN("YA",.Y,,A,B)
"RTN","BIOUTPT3",288,0)
 S BIHIST=+Y
"RTN","BIOUTPT3",289,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",290,0)
 Q
"RTN","BIOUTPT3",291,0)
 ;
"RTN","BIOUTPT3",292,0)
 ;
"RTN","BIOUTPT3",293,0)
 ;----------
"RTN","BIOUTPT3",294,0)
TEXT2 ;EP
"RTN","BIOUTPT3",295,0)
 ;;Should Historical Visits be included in this report?
"RTN","BIOUTPT3",296,0)
 ;;
"RTN","BIOUTPT3",297,0)
 ;;"Historical" refers to the Category field of a Visit as displayed and
"RTN","BIOUTPT3",298,0)
 ;;edited on the ADD/EDIT IMMUNIZATION Screen for Immunization Visits.
"RTN","BIOUTPT3",299,0)
 ;;
"RTN","BIOUTPT3",300,0)
 ;;A Visit may be given a Category of "Historical Event" rather than
"RTN","BIOUTPT3",301,0)
 ;;"Ambulatory" or "Inpatient" for a variety of reasons, for example:
"RTN","BIOUTPT3",302,0)
 ;;An immunization that was not administered at the current clinic but
"RTN","BIOUTPT3",303,0)
 ;;merely added to the record for completeness might be "Historical".
"RTN","BIOUTPT3",304,0)
 ;;Immunizations not intended to be picked up by Billing could be
"RTN","BIOUTPT3",305,0)
 ;;given a Category of "Historical".
"RTN","BIOUTPT3",306,0)
 ;;
"RTN","BIOUTPT3",307,0)
 ;;Please select whether to include Historical Visits in this report.
"RTN","BIOUTPT3",308,0)
 ;;
"RTN","BIOUTPT3",309,0)
 D PRINTX("TEXT2")
"RTN","BIOUTPT3",310,0)
 Q
"RTN","BIOUTPT3",311,0)
 ;
"RTN","BIOUTPT3",312,0)
 ;
"RTN","BIOUTPT3",313,0)
U19(BIU19,BIRTN) ;EP
"RTN","BIOUTPT3",314,0)
 ;---> Select whether to limit Elig Report to patients <19 yrs of age.
"RTN","BIOUTPT3",315,0)
 ;---> Called by Protocol BI OUTPUT INCLUDE ADULTS.
"RTN","BIOUTPT3",316,0)
 ;---> Parameters:
"RTN","BIOUTPT3",317,0)
 ;     1 - BIU19 (ret) Include Adults (1=yes,0=no).
"RTN","BIOUTPT3",318,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT3",319,0)
 ;
"RTN","BIOUTPT3",320,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",321,0)
 ;
"RTN","BIOUTPT3",322,0)
 D FULL^VALM1
"RTN","BIOUTPT3",323,0)
 D TITLE^BIUTL5("INCLUDE ADULTS"),TEXT8
"RTN","BIOUTPT3",324,0)
 N A,B,Y S:($G(BIU19)="") BIU19=0
"RTN","BIOUTPT3",325,0)
 S A="     Include Adult visits (Yes/No): "
"RTN","BIOUTPT3",326,0)
 S B=$S(BIU19:"YES",1:"NO")
"RTN","BIOUTPT3",327,0)
 D DIR^BIFMAN("YA",.Y,,A,B)
"RTN","BIOUTPT3",328,0)
 S BIU19=+Y
"RTN","BIOUTPT3",329,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",330,0)
 Q
"RTN","BIOUTPT3",331,0)
 ;
"RTN","BIOUTPT3",332,0)
 ;
"RTN","BIOUTPT3",333,0)
 ;----------
"RTN","BIOUTPT3",334,0)
TEXT8 ;EP
"RTN","BIOUTPT3",335,0)
 ;;Should immunizations be included that were given when the patient
"RTN","BIOUTPT3",336,0)
 ;;was 19 years of age or older?
"RTN","BIOUTPT3",337,0)
 ;;
"RTN","BIOUTPT3",338,0)
 ;;If you are primarily interested in a Vaccine For Children (VFC)
"RTN","BIOUTPT3",339,0)
 ;;Eligibility report, then answer "No."
"RTN","BIOUTPT3",340,0)
 ;;
"RTN","BIOUTPT3",341,0)
 ;;If you are interested in an Eligibility report that covers adults
"RTN","BIOUTPT3",342,0)
 ;;as well as children, then answer "Yes."
"RTN","BIOUTPT3",343,0)
 ;;
"RTN","BIOUTPT3",344,0)
 D PRINTX("TEXT8")
"RTN","BIOUTPT3",345,0)
 Q
"RTN","BIOUTPT3",346,0)
 ;
"RTN","BIOUTPT3",347,0)
 ;
"RTN","BIOUTPT3",348,0)
DELIM(BIDELIM,BIRTN) ;EP
"RTN","BIOUTPT3",349,0)
 ;---> Select which Delimiter to use, "2 spaces" or "^".
"RTN","BIOUTPT3",350,0)
 ;---> Called by Protocol BI OUTPUT DILIMITER.
"RTN","BIOUTPT3",351,0)
 ;---> Parameters:
"RTN","BIOUTPT3",352,0)
 ;     1 - BIDELIM (ret) Delimiter (1="^", 2="2 spaces").
"RTN","BIOUTPT3",353,0)
 ;     2 - BIRTN   (req) Calling routine for reset.
"RTN","BIOUTPT3",354,0)
 ;
"RTN","BIOUTPT3",355,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",356,0)
 ;
"RTN","BIOUTPT3",357,0)
 D FULL^VALM1
"RTN","BIOUTPT3",358,0)
 D TITLE^BIUTL5("SELECT DELIMITER"),TEXT9
"RTN","BIOUTPT3",359,0)
 ;
"RTN","BIOUTPT3",360,0)
 N DIR,Y
"RTN","BIOUTPT3",361,0)
 S DIR("A")="     Select 1 for ""caret ^"" or 2 for ""2 spaces"":  "
"RTN","BIOUTPT3",362,0)
 S DIR("B")=$S($G(BIDELIM)=1:"caret",1:"2 spaces")
"RTN","BIOUTPT3",363,0)
 S DIR(0)="SAM^1:caret;2:2 spaces"
"RTN","BIOUTPT3",364,0)
 D ^DIR K DIR
"RTN","BIOUTPT3",365,0)
 D
"RTN","BIOUTPT3",366,0)
 .I Y=1 S BIDELIM=1 Q
"RTN","BIOUTPT3",367,0)
 .S BIDELIM=2
"RTN","BIOUTPT3",368,0)
 ;
"RTN","BIOUTPT3",369,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",370,0)
 Q
"RTN","BIOUTPT3",371,0)
 ;
"RTN","BIOUTPT3",372,0)
 ;
"RTN","BIOUTPT3",373,0)
 ;----------
"RTN","BIOUTPT3",374,0)
TEXT9 ;EP
"RTN","BIOUTPT3",375,0)
 ;;This report displays six data fields of each immunizatioin in
"RTN","BIOUTPT3",376,0)
 ;;six columns.  They are:
"RTN","BIOUTPT3",377,0)
 ;;
"RTN","BIOUTPT3",378,0)
 ;;(1)Date  2)Last,First Name  (3)DOB  (4)Eligibility  (5)Vaccine  (6)Lot#
"RTN","BIOUTPT3",379,0)
 ;;
"RTN","BIOUTPT3",380,0)
 ;;In the display, these six fields will be separated from each other by
"RTN","BIOUTPT3",381,0)
 ;;a "delimiter."  The delimiter can be either a caret "^" or "2 spaces".
"RTN","BIOUTPT3",382,0)
 ;;
"RTN","BIOUTPT3",383,0)
 ;;The default delimiter is "2 spaces".  However, when the intention is
"RTN","BIOUTPT3",384,0)
 ;;to print or copy the report to a text file for the purpose of importing
"RTN","BIOUTPT3",385,0)
 ;;it into Excel or some other spreadsheet, use of the caret "^" is
"RTN","BIOUTPT3",386,0)
 ;;preferable and recommended. (Spaces in the data itself might sometimes
"RTN","BIOUTPT3",387,0)
 ;;be confused with spaces in the delimiter and/or spaces used to make the
"RTN","BIOUTPT3",388,0)
 ;;columns line up.)
"RTN","BIOUTPT3",389,0)
 ;;
"RTN","BIOUTPT3",390,0)
 D PRINTX("TEXT9")
"RTN","BIOUTPT3",391,0)
 Q
"RTN","BIOUTPT3",392,0)
 ;
"RTN","BIOUTPT3",393,0)
 ;
"RTN","BIOUTPT3",394,0)
DISBLOT(BIDLOT,BIRTN) ;EP
"RTN","BIOUTPT3",395,0)
 ;---> Select whether to display VAC Report by Lot Number.
"RTN","BIOUTPT3",396,0)
 ;---> Called by Protocol BI OUTPUT DISPLAY BY LOT NUMBER.
"RTN","BIOUTPT3",397,0)
 ;---> Parameters:
"RTN","BIOUTPT3",398,0)
 ;     1 - BIDLOT (req) Display by Lot Number (1=yes,0=no).
"RTN","BIOUTPT3",399,0)
 ;     2 - BIRTN  (req) Calling routine for reset.
"RTN","BIOUTPT3",400,0)
 ;
"RTN","BIOUTPT3",401,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT3",402,0)
 ;
"RTN","BIOUTPT3",403,0)
 D FULL^VALM1
"RTN","BIOUTPT3",404,0)
 D TITLE^BIUTL5("DISPLAY REPORT BY LOT NUMBERS"),TEXT3
"RTN","BIOUTPT3",405,0)
 N A,B,Y S:'$G(BIDLOT) BIDLOT=0
"RTN","BIOUTPT3",406,0)
 S A="     Display by Lot Numbers (Yes/No): "
"RTN","BIOUTPT3",407,0)
 S B=$S(BIDLOT:"YES",1:"NO")
"RTN","BIOUTPT3",408,0)
 D DIR^BIFMAN("YA",.Y,,A,B)
"RTN","BIOUTPT3",409,0)
 S BIDLOT=+Y
"RTN","BIOUTPT3",410,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT3",411,0)
 Q
"RTN","BIOUTPT3",412,0)
 ;
"RTN","BIOUTPT3",413,0)
 ;
"RTN","BIOUTPT3",414,0)
 ;----------
"RTN","BIOUTPT3",415,0)
TEXT3 ;EP
"RTN","BIOUTPT3",416,0)
 ;;Should the vaccines in this report to be displayed by lot number?
"RTN","BIOUTPT3",417,0)
 ;;
"RTN","BIOUTPT3",418,0)
 ;;By default, this report lists the statistics by age for each vaccine.
"RTN","BIOUTPT3",419,0)
 ;;However, you may elect to display the statistics for each separate
"RTN","BIOUTPT3",420,0)
 ;;lot number under each vaccine.  The totals for all lot numbers of
"RTN","BIOUTPT3",421,0)
 ;;each vaccine will also be displayed.
"RTN","BIOUTPT3",422,0)
 ;;
"RTN","BIOUTPT3",423,0)
 ;;Please select whether to display the report by Lot Numbers.
"RTN","BIOUTPT3",424,0)
 ;;
"RTN","BIOUTPT3",425,0)
 D PRINTX("TEXT3")
"RTN","BIOUTPT3",426,0)
 Q
"RTN","BIOUTPT3",427,0)
 ;
"RTN","BIOUTPT3",428,0)
 ;
"RTN","BIOUTPT3",429,0)
 ;----------
"RTN","BIOUTPT3",430,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT3",431,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT3",432,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT3",433,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIOUTPT3",434,0)
 Q
"RTN","BIOUTPT3",435,0)
 ;
"RTN","BIOUTPT3",436,0)
 ;
"RTN","BIOUTPT3",437,0)
 ;----------
"RTN","BIOUTPT3",438,0)
HELPTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT3",439,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT3",440,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BIOUTPT3",441,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BIOUTPT3",442,0)
 Q
"RTN","BIOUTPT4")
0^65^B152498081
"RTN","BIOUTPT4",1,0)
BIOUTPT4 ;IHS/CMI/MWR - PROMPTS FOR REPORTS.; MAY 10, 2010
"RTN","BIOUTPT4",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIOUTPT4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIOUTPT4",4,0)
 ;;  PROMPTS FOR REPORT PARAMETERS.
"RTN","BIOUTPT4",5,0)
 ;
"RTN","BIOUTPT4",6,0)
 ;
"RTN","BIOUTPT4",7,0)
 ;----------
"RTN","BIOUTPT4",8,0)
PGROUP1(BIPG,BIRTN) ;EP
"RTN","BIOUTPT4",9,0)
 ;---> Select Patient Group.
"RTN","BIOUTPT4",10,0)
 ;---> Called by Protocol BI OUTPUT PATIENT GROUP.
"RTN","BIOUTPT4",11,0)
 ;---> Parameters:
"RTN","BIOUTPT4",12,0)
 ;     1 - BIPG  (ret) Patient Group numbers 1-8, 1-7 may be combined.
"RTN","BIOUTPT4",13,0)
 ;                     Patient Group (^-pc 1): 1=DUE, 2=PAST DUE, 3=ACTIVE,
"RTN","BIOUTPT4",14,0)
 ;                     4=INACTIVE, 5=AUTOMATICALLY ACTIVATED, 6=REFUSALS
"RTN","BIOUTPT4",15,0)
 ;                     7=FEMALES ONLY, 8=SEARCH TEMPLATE.
"RTN","BIOUTPT4",16,0)
 ;                     If ^-pc1=2, then pc2=Minimum number of months past due.
"RTN","BIOUTPT4",17,0)
 ;                     If ^-pc1=4, then pc4=Date Range for date made Inactive:
"RTN","BIOUTPT4",18,0)
 ;                                             BeginDate_":"_EndDate
"RTN","BIOUTPT4",19,0)
 ;                     If ^-pc1=5, then pc5=Date Range for Auto Activated:
"RTN","BIOUTPT4",20,0)
 ;                                             BeginDate_":"_EndDate
"RTN","BIOUTPT4",21,0)
 ;                     If ^-pc1=6, then pc6=Date Range for Auto Activated:
"RTN","BIOUTPT4",22,0)
 ;                                             BeginDate_":"_EndDate_"|"_
"RTN","BIOUTPT4",23,0)
 ;                                             Vaccine IEN(1)_"|"_Vaccine IEN(2), etc.
"RTN","BIOUTPT4",24,0)
 ;                     If ^-pc1=8, then pc8=IEN of Search Template of patients.
"RTN","BIOUTPT4",25,0)
 ;
"RTN","BIOUTPT4",26,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT4",27,0)
 ;
"RTN","BIOUTPT4",28,0)
 ;
"RTN","BIOUTPT4",29,0)
PGRP11 ;---> Go here if 8 selected with other attributes.
"RTN","BIOUTPT4",30,0)
 ;
"RTN","BIOUTPT4",31,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT4",32,0)
 S:'$G(BIPG) BIPG=3
"RTN","BIOUTPT4",33,0)
 D FULL^VALM1
"RTN","BIOUTPT4",34,0)
 D TITLE^BIUTL5("PATIENT GROUP"),TEXT1 W !
"RTN","BIOUTPT4",35,0)
 N DIR,Y S DIR("A")="   Select Patient Group: "
"RTN","BIOUTPT4",36,0)
 S DIR(0)="LAO^1:8"
"RTN","BIOUTPT4",37,0)
 S DIR("?")="^D HELP1^BIOUTPT4"
"RTN","BIOUTPT4",38,0)
 S DIR("B")=$P(BIPG,U)
"RTN","BIOUTPT4",39,0)
 D ^DIR
"RTN","BIOUTPT4",40,0)
 I (Y=-1)!("@^"[$E(Y)) S:'$G(BIPG) BIPG=3 D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT4",41,0)
 D
"RTN","BIOUTPT4",42,0)
 .;---> If both 1 and 2 (DUE and PAST DUE), remove 2.
"RTN","BIOUTPT4",43,0)
 .I Y[1&(Y[2) S Y=$P(Y,2)_$P(Y,2,2)
"RTN","BIOUTPT4",44,0)
 .;---> Remove extraneous commas.
"RTN","BIOUTPT4",45,0)
 .I Y[",," S Y=$P(Y,",,")_","_$P(Y,",,",2)
"RTN","BIOUTPT4",46,0)
 .I '$E(Y) S Y=$E(Y,2,99)
"RTN","BIOUTPT4",47,0)
 .I '$E(Y,$L(Y)) S Y=$E(Y,1,$L(Y)-1)
"RTN","BIOUTPT4",48,0)
 .S $P(BIPG,U)=Y
"RTN","BIOUTPT4",49,0)
 ;
"RTN","BIOUTPT4",50,0)
 ;---> If Search Template was used in combo with others, start over.
"RTN","BIOUTPT4",51,0)
 I $P(BIPG,U)'=8&($P(BIPG,U)[8) D  G PGRP11
"RTN","BIOUTPT4",52,0)
 .W !!?5,"8 - SEARCH TEMPLATE is a pre-defined group of Patients and"
"RTN","BIOUTPT4",53,0)
 .W !?9,"may not be used in combination with other Patient Groups."
"RTN","BIOUTPT4",54,0)
 .K DIR("B") D DIRZ^BIUTL3(.BIPOP) S BIPG=1
"RTN","BIOUTPT4",55,0)
 ;
"RTN","BIOUTPT4",56,0)
 ;
"RTN","BIOUTPT4",57,0)
 ;---> If 2-PAST DUE, get months Past Due.
"RTN","BIOUTPT4",58,0)
 D:$P(BIPG,U)[2
"RTN","BIOUTPT4",59,0)
 .N X D PASTNU(.X)
"RTN","BIOUTPT4",60,0)
 .I '$G(X) S BIPG=1 Q
"RTN","BIOUTPT4",61,0)
 .S BIPG=BIPG_U_X
"RTN","BIOUTPT4",62,0)
 .S $P(BIPG,U,2)=X
"RTN","BIOUTPT4",63,0)
 .;
"RTN","BIOUTPT4",64,0)
 .;---> If Past Due only, make explicit this will be Active only.
"RTN","BIOUTPT4",65,0)
 .;I $P(BIPG,U)=2 S $P(BIPG,U)="2,3"
"RTN","BIOUTPT4",66,0)
 ;
"RTN","BIOUTPT4",67,0)
 ;
"RTN","BIOUTPT4",68,0)
 ;---> If 4-INACTIVE, get Date Range.
"RTN","BIOUTPT4",69,0)
 N BIPOP
"RTN","BIOUTPT4",70,0)
 D:$P(BIPG,U)[4
"RTN","BIOUTPT4",71,0)
 .N BIBEGDT,BIENDDT,BIBEGDF,BIENDDF,X,Y
"RTN","BIOUTPT4",72,0)
 .S X=$P(BIPG,U,4) S BIBEGDF=$P(X,":"),BIENDDF=$P(X,":",2)
"RTN","BIOUTPT4",73,0)
 .S:'BIBEGDF BIBEGDF=2000101 S:'BIENDDF BIENDDF=$G(DT)
"RTN","BIOUTPT4",74,0)
 .D TITLE^BIUTL5("SELECT INACTIVE DATE RANGE")
"RTN","BIOUTPT4",75,0)
 .D TEXT3 W !
"RTN","BIOUTPT4",76,0)
 .N DIR S DIR(0)="YA",DIR("A")="     Enter Yes or No: ",DIR("B")="YES"
"RTN","BIOUTPT4",77,0)
 .S DIR("?",1)="       Enter YES to limit the group to an Inactive date range."
"RTN","BIOUTPT4",78,0)
 .S DIR("?")="       Enter No to include ALL Inactive Patients."
"RTN","BIOUTPT4",79,0)
 .D ^DIR W !
"RTN","BIOUTPT4",80,0)
 .I 'Y S $P(BIPG,U,4)="2000101:"_$G(DT) Q
"RTN","BIOUTPT4",81,0)
 .;---> Specify a date range.
"RTN","BIOUTPT4",82,0)
 .D ASKDATES^BIUTL3(.BIBEGDT,.BIENDDT,.BIPOP,BIBEGDF,BIENDDF)
"RTN","BIOUTPT4",83,0)
 .Q:$G(BIPOP)
"RTN","BIOUTPT4",84,0)
 .S:'BIBEGDT BIBEGDT=2000101 S:'BIENDDT BIENDDT=$G(DT)
"RTN","BIOUTPT4",85,0)
 .S $P(BIPG,U,4)=BIBEGDT_":"_BIENDDT
"RTN","BIOUTPT4",86,0)
 G:$G(BIPOP) PGRP11
"RTN","BIOUTPT4",87,0)
 ;
"RTN","BIOUTPT4",88,0)
 ;
"RTN","BIOUTPT4",89,0)
 ;---> If 5-Automatically Activated, get Date Range.
"RTN","BIOUTPT4",90,0)
 N BIPOP
"RTN","BIOUTPT4",91,0)
 D:$P(BIPG,U)[5
"RTN","BIOUTPT4",92,0)
 .N BIBEGDT,BIENDDT,BIBEGDF,BIENDDF,X,Y,Z
"RTN","BIOUTPT4",93,0)
 .S X=$P(BIPG,U,5) S BIBEGDF=$P(X,":"),BIENDDF=$P(X,":",2)
"RTN","BIOUTPT4",94,0)
 .S:'BIBEGDF BIBEGDF=2000101 S:'BIENDDF BIENDDF=$G(DT)
"RTN","BIOUTPT4",95,0)
 .D TITLE^BIUTL5("SELECT AUTO-ACTIVATED DATE RANGE")
"RTN","BIOUTPT4",96,0)
 .D TEXT4 W !
"RTN","BIOUTPT4",97,0)
 .N DIR S DIR(0)="YA",DIR("A")="     Enter Yes or No: ",DIR("B")="YES"
"RTN","BIOUTPT4",98,0)
 .S Z="       Enter YES to limit the group to Actvated within date range."
"RTN","BIOUTPT4",99,0)
 .S DIR("?",1)=Z
"RTN","BIOUTPT4",100,0)
 .S DIR("?")="       Enter No to include ALL Automatically Activated Patients."
"RTN","BIOUTPT4",101,0)
 .D ^DIR W !
"RTN","BIOUTPT4",102,0)
 .I 'Y S $P(BIPG,U,5)="2000101:"_$G(DT) Q
"RTN","BIOUTPT4",103,0)
 .;---> Specify a date range.
"RTN","BIOUTPT4",104,0)
 .D ASKDATES^BIUTL3(.BIBEGDT,.BIENDDT,.BIPOP,BIBEGDF,BIENDDF)
"RTN","BIOUTPT4",105,0)
 .Q:$G(BIPOP)
"RTN","BIOUTPT4",106,0)
 .S:'BIBEGDT BIBEGDT=2000101 S:'BIENDDT BIENDDT=$G(DT)
"RTN","BIOUTPT4",107,0)
 .S $P(BIPG,U,5)=BIBEGDT_":"_BIENDDT
"RTN","BIOUTPT4",108,0)
 G:$G(BIPOP) PGRP11
"RTN","BIOUTPT4",109,0)
 ;
"RTN","BIOUTPT4",110,0)
 ;*********************************
"RTN","BIOUTPT4",111,0)
 ;
"RTN","BIOUTPT4",112,0)
 ;                     If ^-pc1=6, then pc6=Date Range for Auto Activated:
"RTN","BIOUTPT4",113,0)
 ;                                             BeginDate_":"_EndDate_"|"_
"RTN","BIOUTPT4",114,0)
 ;                                             Vaccine IEN(1)_"|"_Vaccine IEN(2), etc.
"RTN","BIOUTPT4",115,0)
 ;
"RTN","BIOUTPT4",116,0)
 ;---> If 6-Refusals, get particular Vaccines and Date Range.
"RTN","BIOUTPT4",117,0)
 ;N BIPOP
"RTN","BIOUTPT4",118,0)
 ;D:$P(BIPG,U)[6
"RTN","BIOUTPT4",119,0)
 ;.N BIBEGDT,BIENDDT,BIBEGDF,BIENDDF,X,Y,Z
"RTN","BIOUTPT4",120,0)
 ;.S X=$P(BIPG,U,5) S BIBEGDF=$P(X,":"),BIENDDF=$P(X,":",2)
"RTN","BIOUTPT4",121,0)
 ;.S:'BIBEGDF BIBEGDF=2000101 S:'BIENDDF BIENDDF=$G(DT)
"RTN","BIOUTPT4",122,0)
 ;.D TITLE^BIUTL5("SELECT REFUSALS DATE RANGE")
"RTN","BIOUTPT4",123,0)
 ;.D TEXT5 W !
"RTN","BIOUTPT4",124,0)
 ;.N DIR S DIR(0)="YA",DIR("A")="     Enter Yes or No: ",DIR("B")="YES"
"RTN","BIOUTPT4",125,0)
 ;.S Z="       Enter YES to limit the group to Actvated within date range."
"RTN","BIOUTPT4",126,0)
 ;.S DIR("?",1)=Z
"RTN","BIOUTPT4",127,0)
 ;.S DIR("?")="       Enter No to include ALL Automatically Activated Patients."
"RTN","BIOUTPT4",128,0)
 ;.D ^DIR W !
"RTN","BIOUTPT4",129,0)
 ;.I 'Y S $P(BIPG,U,5)="2000101:"_$G(DT) Q
"RTN","BIOUTPT4",130,0)
 ;.;---> Specify a date range.
"RTN","BIOUTPT4",131,0)
 ;.D ASKDATES^BIUTL3(.BIBEGDT,.BIENDDT,.BIPOP,BIBEGDF,BIENDDF)
"RTN","BIOUTPT4",132,0)
 ;.Q:$G(BIPOP)
"RTN","BIOUTPT4",133,0)
 ;.S:'BIBEGDT BIBEGDT=2000101 S:'BIENDDT BIENDDT=$G(DT)
"RTN","BIOUTPT4",134,0)
 ;.S $P(BIPG,U,5)=BIBEGDT_":"_BIENDDT
"RTN","BIOUTPT4",135,0)
 ;G:$G(BIPOP) PGRP11
"RTN","BIOUTPT4",136,0)
 ;
"RTN","BIOUTPT4",137,0)
 ;*********************************
"RTN","BIOUTPT4",138,0)
 ;
"RTN","BIOUTPT4",139,0)
 ;---> If 8-SEARCH TEMPLATE, select Search Template.
"RTN","BIOUTPT4",140,0)
 N BITMPL
"RTN","BIOUTPT4",141,0)
 D:$P(BIPG,U)=8
"RTN","BIOUTPT4",142,0)
 .D SEARCH(.BITMPL)
"RTN","BIOUTPT4",143,0)
 .;---> Set BIPG=8^^^^^^^IEN of Template.
"RTN","BIOUTPT4",144,0)
 .S $P(BIPG,U,8)=BITMPL
"RTN","BIOUTPT4",145,0)
 ;---> If user failed to choose a Search Template, change Patient Group
"RTN","BIOUTPT4",146,0)
 ;--->back to default (Active).
"RTN","BIOUTPT4",147,0)
 I $P(BIPG,U)=8&($G(BITMPL)<1) S $P(BIPG,U)=3 G PGRP11
"RTN","BIOUTPT4",148,0)
 ;
"RTN","BIOUTPT4",149,0)
 D:($P(BIPG,U)'=8)
"RTN","BIOUTPT4",150,0)
 .D TITLE^BIUTL5("INDIANS/AK NATIVES ONLY or ALL PATIENTS")
"RTN","BIOUTPT4",151,0)
 .D TEXT7
"RTN","BIOUTPT4",152,0)
 .S B=$S($D(BIBEN("ALL")):"Yes",1:"No") K BIBEN
"RTN","BIOUTPT4",153,0)
 .D DIR^BIFMAN("YAO",.Y,,"     Include non-Native Beneficiaries? (Yes/No): ",B)
"RTN","BIOUTPT4",154,0)
 .I 'Y S BIBEN(1)="" Q
"RTN","BIOUTPT4",155,0)
 .S BIBEN("ALL")=""
"RTN","BIOUTPT4",156,0)
 ;
"RTN","BIOUTPT4",157,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT4",158,0)
 Q
"RTN","BIOUTPT4",159,0)
 ;
"RTN","BIOUTPT4",160,0)
 ;
"RTN","BIOUTPT4",161,0)
 ;----------
"RTN","BIOUTPT4",162,0)
HELP1 ;EP
"RTN","BIOUTPT4",163,0)
 ;---> Help for Select Order prompt.
"RTN","BIOUTPT4",164,0)
 N BITEXT D TEXT11^BIOUTPT5(.BITEXT)
"RTN","BIOUTPT4",165,0)
 D START^BIHELP("PATIENT GROUP - HELP",.BITEXT)
"RTN","BIOUTPT4",166,0)
 D FULL^VALM1,TITLE^BIUTL5("PATIENT GROUP"),TEXT1
"RTN","BIOUTPT4",167,0)
 Q
"RTN","BIOUTPT4",168,0)
 ;
"RTN","BIOUTPT4",169,0)
 ;
"RTN","BIOUTPT4",170,0)
 ;----------
"RTN","BIOUTPT4",171,0)
TEXT1 ;EP
"RTN","BIOUTPT4",172,0)
 ;;Please select the Patient Group for this list or letter.
"RTN","BIOUTPT4",173,0)
 ;;You may include any combination of attributes 1-6 by entering the
"RTN","BIOUTPT4",174,0)
 ;;numbers separated by commas.  For example: 1,3,4 would produce a
"RTN","BIOUTPT4",175,0)
 ;;list of both ACTIVE and INACTIVE Patients DUE for immunizations.
"RTN","BIOUTPT4",176,0)
 ;;
"RTN","BIOUTPT4",177,0)
 ;;DUE and PAST DUE, if selected alone, will include only ACTIVE
"RTN","BIOUTPT4",178,0)
 ;;patients, unless INACTIVE is also selected.
"RTN","BIOUTPT4",179,0)
 ;;
"RTN","BIOUTPT4",180,0)
 ;;   1 - DUE......................(Patients Due for immunizations)
"RTN","BIOUTPT4",181,0)
 ;;   2 - PAST DUE.................(Only Patients who are PAST Due)
"RTN","BIOUTPT4",182,0)
 ;;   3 - ACTIVE...................(List of Active Patients)
"RTN","BIOUTPT4",183,0)
 ;;   4 - INACTIVE.................(Inactive Patients, by date if desired)
"RTN","BIOUTPT4",184,0)
 ;;   5 - AUTOMATICALLY ACTIVATED..(By date if desired)
"RTN","BIOUTPT4",185,0)
 ;;   6 - REFUSALS.................(Patients who have refused any vaccines)
"RTN","BIOUTPT4",186,0)
 ;;   7 - FEMALES ONLY.............(Only female patients included)
"RTN","BIOUTPT4",187,0)
 ;;   8 - SEARCH TEMPLATE..........(Pre-selected group of Patients)
"RTN","BIOUTPT4",188,0)
 ;;   Enter "?" for further explanation.
"RTN","BIOUTPT4",189,0)
 D PRINTX("TEXT1")
"RTN","BIOUTPT4",190,0)
 Q
"RTN","BIOUTPT4",191,0)
 ;
"RTN","BIOUTPT4",192,0)
 ;
"RTN","BIOUTPT4",193,0)
 ;----------
"RTN","BIOUTPT4",194,0)
PASTNU(BIPG1) ;EP
"RTN","BIOUTPT4",195,0)
 ;---> Select minimum number of months Past Due.
"RTN","BIOUTPT4",196,0)
 ;---> Parameters:
"RTN","BIOUTPT4",197,0)
 ;     1 - BIPG1 (ret) BIPG1=Number of months PAST DUE or greater.
"RTN","BIOUTPT4",198,0)
 ;
"RTN","BIOUTPT4",199,0)
 ;---> Select Order of sort.
"RTN","BIOUTPT4",200,0)
 S BIPG1=0
"RTN","BIOUTPT4",201,0)
 D FULL^VALM1
"RTN","BIOUTPT4",202,0)
 D TITLE^BIUTL5("NUMBER OF MONTHS PAST DUE")
"RTN","BIOUTPT4",203,0)
 D TEXT2 N DIR
"RTN","BIOUTPT4",204,0)
 N DIR D HELP2
"RTN","BIOUTPT4",205,0)
 S DIR("A")="   Number of Months Past Due: "
"RTN","BIOUTPT4",206,0)
 S DIR(0)="NA^1:999:0"
"RTN","BIOUTPT4",207,0)
 D ^DIR
"RTN","BIOUTPT4",208,0)
 S BIPG1=+Y S:BIPG1<1 BIPG1=0
"RTN","BIOUTPT4",209,0)
 Q
"RTN","BIOUTPT4",210,0)
 ;
"RTN","BIOUTPT4",211,0)
 ;
"RTN","BIOUTPT4",212,0)
 ;----------
"RTN","BIOUTPT4",213,0)
TEXT2 ;EP
"RTN","BIOUTPT4",214,0)
 ;;You have chosen to limit this listing to patients who are
"RTN","BIOUTPT4",215,0)
 ;;PAST DUE for one or more immunizations.  You must now specify
"RTN","BIOUTPT4",216,0)
 ;;the MINIMUM number of months a patient must be PAST DUE to be
"RTN","BIOUTPT4",217,0)
 ;;included in this listing.
"RTN","BIOUTPT4",218,0)
 ;;
"RTN","BIOUTPT4",219,0)
 ;;NOTE: This will be the number of months that the patient was
"RTN","BIOUTPT4",220,0)
 ;;      PAST DUE before the Forecast/Clinic Date you select
"RTN","BIOUTPT4",221,0)
 ;;      (not necessarily the number of months before today!).
"RTN","BIOUTPT4",222,0)
 ;;
"RTN","BIOUTPT4",223,0)
 D PRINTX("TEXT2")
"RTN","BIOUTPT4",224,0)
 Q
"RTN","BIOUTPT4",225,0)
 ;
"RTN","BIOUTPT4",226,0)
 ;
"RTN","BIOUTPT4",227,0)
 ;----------
"RTN","BIOUTPT4",228,0)
TEXT3 ;EP
"RTN","BIOUTPT4",229,0)
 ;;You have chosen to include Patients who are Inactive.
"RTN","BIOUTPT4",230,0)
 ;;
"RTN","BIOUTPT4",231,0)
 ;;You may include ALL Patients who are Inactive, or you may
"RTN","BIOUTPT4",232,0)
 ;;limit the group of Inactive Patients to those who were made
"RTN","BIOUTPT4",233,0)
 ;;Inactive within a specified date range.
"RTN","BIOUTPT4",234,0)
 ;;
"RTN","BIOUTPT4",235,0)
 ;;Would you like to limit the list of Inactive Patients to a specific
"RTN","BIOUTPT4",236,0)
 ;;date range?  In other words, include only patients who were made
"RTN","BIOUTPT4",237,0)
 ;;Inactive after a particular date and before a later date?
"RTN","BIOUTPT4",238,0)
 ;;
"RTN","BIOUTPT4",239,0)
 D PRINTX("TEXT3")
"RTN","BIOUTPT4",240,0)
 Q
"RTN","BIOUTPT4",241,0)
 ;
"RTN","BIOUTPT4",242,0)
 ;
"RTN","BIOUTPT4",243,0)
 ;----------
"RTN","BIOUTPT4",244,0)
TEXT4 ;EP
"RTN","BIOUTPT4",245,0)
 ;;You have chosen to limit this list to Patients who were
"RTN","BIOUTPT4",246,0)
 ;;Automatically Activated.
"RTN","BIOUTPT4",247,0)
 ;;
"RTN","BIOUTPT4",248,0)
 ;;You may include ALL Patients who were Automatically Activated,
"RTN","BIOUTPT4",249,0)
 ;;or you may limit the group to Patients who were Automatically
"RTN","BIOUTPT4",250,0)
 ;;Activated within a specified date range.
"RTN","BIOUTPT4",251,0)
 ;;
"RTN","BIOUTPT4",252,0)
 ;;Would you like to limit the list of Patients who were Automatically
"RTN","BIOUTPT4",253,0)
 ;;Activated within a specific date range?  In other words, include only
"RTN","BIOUTPT4",254,0)
 ;;patients who were Activated after a particular date and before
"RTN","BIOUTPT4",255,0)
 ;;a later date?
"RTN","BIOUTPT4",256,0)
 ;;
"RTN","BIOUTPT4",257,0)
 D PRINTX("TEXT4")
"RTN","BIOUTPT4",258,0)
 Q
"RTN","BIOUTPT4",259,0)
 ;
"RTN","BIOUTPT4",260,0)
 ;
"RTN","BIOUTPT4",261,0)
 ;----------
"RTN","BIOUTPT4",262,0)
TEXT5 ;EP
"RTN","BIOUTPT4",263,0)
 ;;You have chosen to limit this list to patients who have Refusals
"RTN","BIOUTPT4",264,0)
 ;;on record.
"RTN","BIOUTPT4",265,0)
 ;;
"RTN","BIOUTPT4",266,0)
 ;;You may include patients who have Refusals for ANY vaccine, or
"RTN","BIOUTPT4",267,0)
 ;;you may limit the list to refusals for one or more specific vaccines.
"RTN","BIOUTPT4",268,0)
 ;;
"RTN","BIOUTPT4",269,0)
 ;;Would you like to limit the list to Refusals of one or more specific
"RTN","BIOUTPT4",270,0)
 ;;vaccines?
"RTN","BIOUTPT4",271,0)
 ;;
"RTN","BIOUTPT4",272,0)
 D PRINTX("TEXT5")
"RTN","BIOUTPT4",273,0)
 Q
"RTN","BIOUTPT4",274,0)
 ;
"RTN","BIOUTPT4",275,0)
 ;
"RTN","BIOUTPT4",276,0)
 ;----------
"RTN","BIOUTPT4",277,0)
TEXT6 ;EP
"RTN","BIOUTPT4",278,0)
 ;;You have chosen to limit this list to patients who have Refusals
"RTN","BIOUTPT4",279,0)
 ;;on record.
"RTN","BIOUTPT4",280,0)
 ;;
"RTN","BIOUTPT4",281,0)
 ;;Would you like to limit the list to Refusals that were recorded
"RTN","BIOUTPT4",282,0)
 ;;within a specific date range?
"RTN","BIOUTPT4",283,0)
 ;;
"RTN","BIOUTPT4",284,0)
 D PRINTX("TEXT6")
"RTN","BIOUTPT4",285,0)
 Q
"RTN","BIOUTPT4",286,0)
 ;
"RTN","BIOUTPT4",287,0)
 ;
"RTN","BIOUTPT4",288,0)
 ;----------
"RTN","BIOUTPT4",289,0)
TEXT7 ;EP
"RTN","BIOUTPT4",290,0)
 ;;Ordinarilly Lists & Letters looks only at American Indians and Alaska
"RTN","BIOUTPT4",291,0)
 ;;Natives, also known by the Beneficiary Type Code 01.
"RTN","BIOUTPT4",292,0)
 ;;
"RTN","BIOUTPT4",293,0)
 ;;Would you like to expand the list to include patients of all Beneficiary
"RTN","BIOUTPT4",294,0)
 ;;Types (includes Dependents of Comm Officers, Retired Military, etc.)?
"RTN","BIOUTPT4",295,0)
 ;;
"RTN","BIOUTPT4",296,0)
 D PRINTX("TEXT7")
"RTN","BIOUTPT4",297,0)
 Q
"RTN","BIOUTPT4",298,0)
 ;
"RTN","BIOUTPT4",299,0)
 ;
"RTN","BIOUTPT4",300,0)
 ;----------
"RTN","BIOUTPT4",301,0)
HELP2 ;EP
"RTN","BIOUTPT4",302,0)
 ;;Enter a number which will be the minimum number of months
"RTN","BIOUTPT4",303,0)
 ;;PAST DUE for patients to be included in the listing.
"RTN","BIOUTPT4",304,0)
 ;;
"RTN","BIOUTPT4",305,0)
 ;;For example, if you enter "3", then any patient with at least one
"RTN","BIOUTPT4",306,0)
 ;;immunization 3 months or more past due would be included.  A patient
"RTN","BIOUTPT4",307,0)
 ;;with an immunization only 2 months past due would not be included.
"RTN","BIOUTPT4",308,0)
 ;;
"RTN","BIOUTPT4",309,0)
 ;;NOTE: The months PAST DUE will be calculated from the Forecast/
"RTN","BIOUTPT4",310,0)
 ;;      Clinic Date you select (not necessarily from today).
"RTN","BIOUTPT4",311,0)
 D HELPTX("HELP2")
"RTN","BIOUTPT4",312,0)
 Q
"RTN","BIOUTPT4",313,0)
 ;
"RTN","BIOUTPT4",314,0)
 ;
"RTN","BIOUTPT4",315,0)
 ;----------
"RTN","BIOUTPT4",316,0)
SEARCH(BITMPL) ;EP
"RTN","BIOUTPT4",317,0)
 ;---> Select Search Template of patients.
"RTN","BIOUTPT4",318,0)
 ;---> Parameters:
"RTN","BIOUTPT4",319,0)
 ;     1 - BITMPL (ret) IEN of Search Template in File #.401, or
"RTN","BIOUTPT4",320,0)
 ;                      BITMPL=-1 if lookup failed.
"RTN","BIOUTPT4",321,0)
 ;
"RTN","BIOUTPT4",322,0)
SEARCH1 ;
"RTN","BIOUTPT4",323,0)
 D TITLE^BIUTL5("SEARCH TEMPLATE SELECTION")
"RTN","BIOUTPT4",324,0)
 N BIA,BIS S BIPOP=0,BITMPL=""
"RTN","BIOUTPT4",325,0)
 S BIA="     Select Patient SEARCH TEMPLATE name: "
"RTN","BIOUTPT4",326,0)
 S BIS="I $P(^"_"(0),U,4)=2!($P(^(0),U,4)=9000001)"
"RTN","BIOUTPT4",327,0)
 D DIC^BIFMAN(.401,"QEMA",.Y,BIA,,BIS)
"RTN","BIOUTPT4",328,0)
 S BITMPL=+Y
"RTN","BIOUTPT4",329,0)
 Q:BITMPL<1
"RTN","BIOUTPT4",330,0)
 ;
"RTN","BIOUTPT4",331,0)
 ;---> Display Template info for confirmation.
"RTN","BIOUTPT4",332,0)
 D TITLE^BIUTL5("SEARCH TEMPLATE SELECTION")
"RTN","BIOUTPT4",333,0)
 W !!?5,"You have selected the following Patient Search Template: "
"RTN","BIOUTPT4",334,0)
 W !!?9,"Name...: ",$P(^DIBT(BITMPL,0),U)
"RTN","BIOUTPT4",335,0)
 W !?9,"Created: ",$$TXDT1^BIUTL5($P(^DIBT(BITMPL,0),U,2))
"RTN","BIOUTPT4",336,0)
 W " by ",$$PERSON^BIUTL1($P(^DIBT(BITMPL,0),U,5))
"RTN","BIOUTPT4",337,0)
 W !?9,"Total..: "
"RTN","BIOUTPT4",338,0)
 D
"RTN","BIOUTPT4",339,0)
 .N M,N S M=0,N=0
"RTN","BIOUTPT4",340,0)
 .F  S N=$O(^DIBT(BITMPL,1,N)) Q:'N  S M=M+1
"RTN","BIOUTPT4",341,0)
 .W M," Patient",$S(M>1:"s",1:"")
"RTN","BIOUTPT4",342,0)
 W !!?5,"Description: "
"RTN","BIOUTPT4",343,0)
 W !?5,"------------ "
"RTN","BIOUTPT4",344,0)
 D
"RTN","BIOUTPT4",345,0)
 .I '$O(^DIBT(BITMPL,"%D",0)) W !?5,"None." Q
"RTN","BIOUTPT4",346,0)
 .N I,N S N=0
"RTN","BIOUTPT4",347,0)
 .F I=1:1:7 S N=$O(^DIBT(BITMPL,"%D",N)) Q:'N  D
"RTN","BIOUTPT4",348,0)
 ..W !?5,$G(^DIBT(BITMPL,"%D",N,0))
"RTN","BIOUTPT4",349,0)
 .D:$O(^DIBT(BITMPL,"%D",N))
"RTN","BIOUTPT4",350,0)
 ..W !?5,"(More...see template for full description.)"
"RTN","BIOUTPT4",351,0)
 ;
"RTN","BIOUTPT4",352,0)
 W !
"RTN","BIOUTPT4",353,0)
 N B,BIPOP S BIPOP=0
"RTN","BIOUTPT4",354,0)
 S B="     Use this Template for your List? (Yes/No): "
"RTN","BIOUTPT4",355,0)
 S B(1)="     Enter Yes to select this Template."
"RTN","BIOUTPT4",356,0)
 S B(2)="     Enter No to select another Template."
"RTN","BIOUTPT4",357,0)
 D DIR^BIFMAN("YA",.Y,,B,"Yes",B(2),B(1))
"RTN","BIOUTPT4",358,0)
 ;
"RTN","BIOUTPT4",359,0)
 ;---> Failed to confirm.
"RTN","BIOUTPT4",360,0)
 I Y<1 D  G SEARCH1
"RTN","BIOUTPT4",361,0)
 .W !?5,"Okay, let's begin again..." D DIRZ^BIUTL3()
"RTN","BIOUTPT4",362,0)
 ;
"RTN","BIOUTPT4",363,0)
 Q
"RTN","BIOUTPT4",364,0)
 ;
"RTN","BIOUTPT4",365,0)
 ;
"RTN","BIOUTPT4",366,0)
 ;----------
"RTN","BIOUTPT4",367,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIOUTPT4",368,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT4",369,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT4",370,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIOUTPT4",371,0)
 Q
"RTN","BIOUTPT4",372,0)
 ;
"RTN","BIOUTPT4",373,0)
 ;
"RTN","BIOUTPT4",374,0)
 ;----------
"RTN","BIOUTPT4",375,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT4",376,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT4",377,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT4",378,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIOUTPT4",379,0)
 Q
"RTN","BIOUTPT4",380,0)
 ;
"RTN","BIOUTPT4",381,0)
 ;
"RTN","BIOUTPT4",382,0)
 ;----------
"RTN","BIOUTPT4",383,0)
HELPTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT4",384,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT4",385,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BIOUTPT4",386,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BIOUTPT4",387,0)
 Q
"RTN","BIOUTPT5")
0^66^B132245267
"RTN","BIOUTPT5",1,0)
BIOUTPT5 ;IHS/CMI/MWR - WRITE SUBHEADERS.; AUG 10,2010
"RTN","BIOUTPT5",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIOUTPT5",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIOUTPT5",4,0)
 ;;  WRITE SUBHEADER LINES TO ^TMP FOR REPORTS.
"RTN","BIOUTPT5",5,0)
 ;;  v8.4 PATCH 1: Manage subheader Items more than 20.  SUBH+35
"RTN","BIOUTPT5",6,0)
 ;
"RTN","BIOUTPT5",7,0)
 ;
"RTN","BIOUTPT5",8,0)
 ;----------
"RTN","BIOUTPT5",9,0)
SUBH(BIAR,BITEM,BITEMS,BIGBL,BILINE,BIERR,BIPC,BITM,BIAPP) ;EP
"RTN","BIOUTPT5",10,0)
 ;---> If specific Items were selected (not ALL), then list them
"RTN","BIOUTPT5",11,0)
 ;---> in a subheader at the top of the report.
"RTN","BIOUTPT5",12,0)
 ;---> Parameters:
"RTN","BIOUTPT5",13,0)
 ;     1 - BIAR   (req) Array of Item IENs to be displayed.
"RTN","BIOUTPT5",14,0)
 ;     2 - BITEM  (req) Categoric name of Items being displayed.
"RTN","BIOUTPT5",15,0)
 ;     3 - BITEMS (opt) Plural form of Categoric Item name.
"RTN","BIOUTPT5",16,0)
 ;                      Provide this only if it's an exception.
"RTN","BIOUTPT5",17,0)
 ;     4 - BIGBL  (req) Item global OR File#-Field# for Set of Codes.
"RTN","BIOUTPT5",18,0)
 ;     5 - BILINE (ret) Line number in ^TMP Listman array.
"RTN","BIOUTPT5",19,0)
 ;     6 - BIERR  (ret) Error Code returned, if any.
"RTN","BIOUTPT5",20,0)
 ;     7 - BIPC   (opt) Piece of Zero node to display as Item Name;
"RTN","BIOUTPT5",21,0)
 ;                      default=1.
"RTN","BIOUTPT5",22,0)
 ;     8 - BITM   (opt) Top Margin.
"RTN","BIOUTPT5",23,0)
 ;     9 - BIAPP  (opt) Any text to be appended to the list, such as
"RTN","BIOUTPT5",24,0)
 ;                      a date range.
"RTN","BIOUTPT5",25,0)
 ;
"RTN","BIOUTPT5",26,0)
 ;---> EXAMPLE:
"RTN","BIOUTPT5",27,0)
 ;   D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR)
"RTN","BIOUTPT5",28,0)
 ;
"RTN","BIOUTPT5",29,0)
 ;
"RTN","BIOUTPT5",30,0)
 ;---> Check/set required variables.
"RTN","BIOUTPT5",31,0)
 S BIERR=""
"RTN","BIOUTPT5",32,0)
 Q:$$CHECK(.BIERR)
"RTN","BIOUTPT5",33,0)
 S:'$G(BITM) BITM=12
"RTN","BIOUTPT5",34,0)
 ;
"RTN","BIOUTPT5",35,0)
 ;---> Quit and don't write subheader if "ALL" Items were selected
"RTN","BIOUTPT5",36,0)
 ;---> (or if NO Items were selected).
"RTN","BIOUTPT5",37,0)
 Q:$O(@(BIAR_"(0)"))=""
"RTN","BIOUTPT5",38,0)
 Q:$D(@(BIAR_"(""ALL"")"))
"RTN","BIOUTPT5",39,0)
 ;
"RTN","BIOUTPT5",40,0)
 ;---> Check/set plural form of Item Name.
"RTN","BIOUTPT5",41,0)
 I $G(BITEMS)="" D PLURAL^BISELECT(BITEM,.BITEMS)
"RTN","BIOUTPT5",42,0)
 ;
"RTN","BIOUTPT5",43,0)
 ;
"RTN","BIOUTPT5",44,0)
 ;********** PATCH 1, v8.4, AUG 01,2010, IHS/CMI/MWR
"RTN","BIOUTPT5",45,0)
 ;---> If more than 20 subheader items and list is to the screen, simply
"RTN","BIOUTPT5",46,0)
 ;---> state that and quit.
"RTN","BIOUTPT5",47,0)
 N M,N S (M,N)=0
"RTN","BIOUTPT5",48,0)
 F  S N=$O(@(BIAR_"(N)")) Q:'N  S M=M+1
"RTN","BIOUTPT5",49,0)
 I M>20 I $G(IOSL)<25 D  Q
"RTN","BIOUTPT5",50,0)
 .N X S X=" "_BITEMS_": More than 20; Print report or review "_BITEM_" parameter."
"RTN","BIOUTPT5",51,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIOUTPT5",52,0)
 .D WH^BIW(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIOUTPT5",53,0)
 ;**********
"RTN","BIOUTPT5",54,0)
 ;
"RTN","BIOUTPT5",55,0)
 ;
"RTN","BIOUTPT5",56,0)
 ;---> If too much subheader text for screen, return error.
"RTN","BIOUTPT5",57,0)
 I (BILINE>BITM)&($G(IOSL)<25) S BIERR=668 Q
"RTN","BIOUTPT5",58,0)
 ;
"RTN","BIOUTPT5",59,0)
 ;---> Alphabetize list.
"RTN","BIOUTPT5",60,0)
 N BIAR1
"RTN","BIOUTPT5",61,0)
 D
"RTN","BIOUTPT5",62,0)
 .I +BIGBL D  Q
"RTN","BIOUTPT5",63,0)
 ..;---> Set of Codes.
"RTN","BIOUTPT5",64,0)
 ..N BISET S BISET=$P($G(^DD($P(BIGBL,"-"),$P(BIGBL,"-",2),0)),U,3)
"RTN","BIOUTPT5",65,0)
 ..N N S N=0
"RTN","BIOUTPT5",66,0)
 ..F  S N=$O(@(BIAR_"(N)")) Q:N=""  D
"RTN","BIOUTPT5",67,0)
 ...S BIAR1($P($P(BISET,N_":",2),";"))=""
"RTN","BIOUTPT5",68,0)
 .;
"RTN","BIOUTPT5",69,0)
 .;---> Entries from a File.
"RTN","BIOUTPT5",70,0)
 .S:'$G(BIPC) BIPC=1
"RTN","BIOUTPT5",71,0)
 .N N S N=0
"RTN","BIOUTPT5",72,0)
 .F  S N=$O(@(BIAR_"(N)")) Q:'N  D
"RTN","BIOUTPT5",73,0)
 ..S BIAR1($$NAME(N,BIGBL,BIPC))=""
"RTN","BIOUTPT5",74,0)
 ;
"RTN","BIOUTPT5",75,0)
 ;---> Set X=string of Items, pieced by "; " (or Z).
"RTN","BIOUTPT5",76,0)
 N BIHEAD,I,N,Y,Z
"RTN","BIOUTPT5",77,0)
 S N=0,X="",Z="; "
"RTN","BIOUTPT5",78,0)
 F I=1:1 S N=$O(BIAR1(N)) Q:N=""  D
"RTN","BIOUTPT5",79,0)
 .S:I>1 X=X_Z S X=X_N
"RTN","BIOUTPT5",80,0)
 ;---> Append any text such as date range.
"RTN","BIOUTPT5",81,0)
 S:$G(BIAPP)]"" X=X_BIAPP
"RTN","BIOUTPT5",82,0)
 S BIHEAD=" "_$S(I>2:BITEMS,1:BITEM)_": "
"RTN","BIOUTPT5",83,0)
 ;
"RTN","BIOUTPT5",84,0)
 ;---> Now write each line with as many Items as will fit on a line
"RTN","BIOUTPT5",85,0)
 ;---> (hanging indent under the header "Item Name:").
"RTN","BIOUTPT5",86,0)
 S N=1
"RTN","BIOUTPT5",87,0)
 F  D  Q:$P(X,Z,I)=""  Q:$G(BIERR)
"RTN","BIOUTPT5",88,0)
 .F I=N:1 S Y=$P(X,Z,N,I) Q:$L(Y)>63  Q:$P(X,Z,I)=""
"RTN","BIOUTPT5",89,0)
 .I N>1 S BIHEAD=$$SP^BIUTL5($L(BIHEAD))
"RTN","BIOUTPT5",90,0)
 .I (BILINE>BITM)&($G(IOSL)<25) S BIERR=668 Q
"RTN","BIOUTPT5",91,0)
 .D WH^BIW(.BILINE,BIHEAD_$P(X,Z,N,I-1))
"RTN","BIOUTPT5",92,0)
 .S N=I
"RTN","BIOUTPT5",93,0)
 ;
"RTN","BIOUTPT5",94,0)
 D WH^BIW(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIOUTPT5",95,0)
 Q
"RTN","BIOUTPT5",96,0)
 ;
"RTN","BIOUTPT5",97,0)
 ;
"RTN","BIOUTPT5",98,0)
 ;----------
"RTN","BIOUTPT5",99,0)
NAME(BIIEN,BIGBL,BIPC) ;EP
"RTN","BIOUTPT5",100,0)
 ;---> Return the .01 for this IEN in BIGBL.
"RTN","BIOUTPT5",101,0)
 ;---> Parameters:
"RTN","BIOUTPT5",102,0)
 ;     1 - BIIEN  (req) IEN of Item.
"RTN","BIOUTPT5",103,0)
 ;     2 - BIGBL  (req) Item global.
"RTN","BIOUTPT5",104,0)
 ;     3 - BIPC   (opt) Piece of Zero node to display (default=1).
"RTN","BIOUTPT5",105,0)
 ;
"RTN","BIOUTPT5",106,0)
 Q:'$G(BIIEN) 0  Q:$G(BIGBL)="" 0
"RTN","BIOUTPT5",107,0)
 N X S:'$G(BIPC) BIPC=1
"RTN","BIOUTPT5",108,0)
 S X=$P(@(BIGBL_BIIEN_",0)"),U,BIPC)
"RTN","BIOUTPT5",109,0)
 Q:X="" 0
"RTN","BIOUTPT5",110,0)
 Q X
"RTN","BIOUTPT5",111,0)
 ;
"RTN","BIOUTPT5",112,0)
 ;
"RTN","BIOUTPT5",113,0)
 ;---> First, build array sorted by ItemName.
"RTN","BIOUTPT5",114,0)
 N BIIEN S BIIEN=0
"RTN","BIOUTPT5",115,0)
 F  S BIIEN=$O(@(BIARR1_"(BIIEN)")) Q:'BIIEN  D
"RTN","BIOUTPT5",116,0)
 .;
"RTN","BIOUTPT5",117,0)
 .;---> If IEN passed does not really exist in the File,
"RTN","BIOUTPT5",118,0)
 .;---> remove it from the Selection Array.
"RTN","BIOUTPT5",119,0)
 .I '$D(@(BIGBL_"BIIEN,0)")) K @(BIARR1_"(BIIEN)") Q
"RTN","BIOUTPT5",120,0)
 .;
"RTN","BIOUTPT5",121,0)
 .;---> If (previously stored) IEN does not pass the screen,
"RTN","BIOUTPT5",122,0)
 .;---> then remove it from the Selection Array.
"RTN","BIOUTPT5",123,0)
 .I BISCRN]"" N Y S Y=BIIEN X BISCRN I '$T K @(BIARR1_"(BIIEN)") Q
"RTN","BIOUTPT5",124,0)
 .;
"RTN","BIOUTPT5",125,0)
 .N BI0,BINAME,BIIDTX
"RTN","BIOUTPT5",126,0)
 .S BI0=@(BIGBL_"BIIEN,0)")
"RTN","BIOUTPT5",127,0)
 .S BINAME=$P(BI0,U,BIPIECE)
"RTN","BIOUTPT5",128,0)
 .Q:BINAME=""
"RTN","BIOUTPT5",129,0)
 Q
"RTN","BIOUTPT5",130,0)
 ;
"RTN","BIOUTPT5",131,0)
 ;
"RTN","BIOUTPT5",132,0)
 ;----------
"RTN","BIOUTPT5",133,0)
CHECK(BIERR) ;EP
"RTN","BIOUTPT5",134,0)
 ;---> Check required variables.
"RTN","BIOUTPT5",135,0)
 ;---> Parameters:
"RTN","BIOUTPT5",136,0)
 ;     1 - BIERR (ret) Error Code returned, if any.
"RTN","BIOUTPT5",137,0)
 ;
"RTN","BIOUTPT5",138,0)
 ;---> Check that Subheader Array name is present.
"RTN","BIOUTPT5",139,0)
 I $G(BIAR)="" S BIERR=656 Q 1
"RTN","BIOUTPT5",140,0)
 ;
"RTN","BIOUTPT5",141,0)
 ;---> Check that Categoric Item name is present.
"RTN","BIOUTPT5",142,0)
 I $G(BITEM)="" S BIERR=657 Q 1
"RTN","BIOUTPT5",143,0)
 ;
"RTN","BIOUTPT5",144,0)
 ;---> Check Item global.
"RTN","BIOUTPT5",145,0)
 I $G(BIGBL)="" S BIERR=658 Q 1
"RTN","BIOUTPT5",146,0)
 ;
"RTN","BIOUTPT5",147,0)
 ;---> Check that the Global or Set of Codes is legitimate.
"RTN","BIOUTPT5",148,0)
 S BIERR=""
"RTN","BIOUTPT5",149,0)
 D  Q:BIERR 1
"RTN","BIOUTPT5",150,0)
 .I +BIGBL D  Q
"RTN","BIOUTPT5",151,0)
 ..;---> Test for Set of Codes.
"RTN","BIOUTPT5",152,0)
 ..N X,Y S X=$P(BIGBL,"-"),Y=$P(BIGBL,"-",2)
"RTN","BIOUTPT5",153,0)
 ..I 'Y S BIERR=665 Q
"RTN","BIOUTPT5",154,0)
 ..I '$D(^DD(X,Y,0)) S BIERR=665 Q
"RTN","BIOUTPT5",155,0)
 .;
"RTN","BIOUTPT5",156,0)
 .;---> Test for global (entries from a file).
"RTN","BIOUTPT5",157,0)
 .I '$D(@(BIGBL_"0)")) S BIERR=659 Q
"RTN","BIOUTPT5",158,0)
 ;
"RTN","BIOUTPT5",159,0)
 Q 0
"RTN","BIOUTPT5",160,0)
 ;
"RTN","BIOUTPT5",161,0)
 ;
"RTN","BIOUTPT5",162,0)
 ;----------
"RTN","BIOUTPT5",163,0)
RYEAR(BIYEAR,BIRTN) ;EP
"RTN","BIOUTPT5",164,0)
 ;---> Ask the Report Year.
"RTN","BIOUTPT5",165,0)
 ;---> Called by Protocol BI OUTPUT REPORT YEAR.
"RTN","BIOUTPT5",166,0)
 ;---> Parameters:
"RTN","BIOUTPT5",167,0)
 ;     1 - BIYEAR (ret) Report Year in yyyy format.
"RTN","BIOUTPT5",168,0)
 ;                (opt) Default Year.
"RTN","BIOUTPT5",169,0)
 ;     2 - BIRTN (req) Calling routine for reset.
"RTN","BIOUTPT5",170,0)
 ;
"RTN","BIOUTPT5",171,0)
 I $G(BIRTN)="" D ERRCD^BIUTL2(621,,1) Q
"RTN","BIOUTPT5",172,0)
 ;
"RTN","BIOUTPT5",173,0)
 N DIR,DIRA,DIRB,DIRQ,DIRNOW,BIPOP
"RTN","BIOUTPT5",174,0)
 S:$G(BIYEAR) DIRB=+BIYEAR
"RTN","BIOUTPT5",175,0)
 D
"RTN","BIOUTPT5",176,0)
 .I '$G(DT) S DIRNOW=2050 Q
"RTN","BIOUTPT5",177,0)
 .S DIRNOW=1700+$E(DT,1,3)
"RTN","BIOUTPT5",178,0)
 S DIRA="   Please enter a Report Year: "
"RTN","BIOUTPT5",179,0)
 S:$G(BIYEAR) DIRB=+BIYEAR
"RTN","BIOUTPT5",180,0)
 S DIRQ="   Enter a year between 1950 and the present, in the form yyyy"
"RTN","BIOUTPT5",181,0)
 D FULL^VALM1
"RTN","BIOUTPT5",182,0)
 D TITLE^BIUTL5("SELECT REPORT YEAR")
"RTN","BIOUTPT5",183,0)
 D TEXT1 W !
"RTN","BIOUTPT5",184,0)
 D DIR^BIFMAN("NAO^1950:"_DIRNOW,.Y,.BIPOP,DIRA,DIRB,DIRQ)
"RTN","BIOUTPT5",185,0)
 I $G(BIPOP) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT5",186,0)
 S BIYEAR=+Y
"RTN","BIOUTPT5",187,0)
 I Y<1 D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT5",188,0)
 ;
"RTN","BIOUTPT5",189,0)
 N DIR
"RTN","BIOUTPT5",190,0)
 W !!?3,"You may select an End Date of either December 31, ",+BIYEAR
"RTN","BIOUTPT5",191,0)
 W " or March 31, ",(+BIYEAR)+1,".",!
"RTN","BIOUTPT5",192,0)
 S DIR("A")="   Select December or March: "
"RTN","BIOUTPT5",193,0)
 S DIR("B")=$S($P(BIYEAR,U,2)="m":"March",1:"December")
"RTN","BIOUTPT5",194,0)
 S DIR(0)="SAM^d:December;m:March"
"RTN","BIOUTPT5",195,0)
 D ^DIR K DIR
"RTN","BIOUTPT5",196,0)
 I Y=-1!($D(DIRUT)) D @("RESET^"_BIRTN) Q
"RTN","BIOUTPT5",197,0)
 ;---> If Y="m" concate to BIYEAR to signify End Date of March 31.  Otherwise,
"RTN","BIOUTPT5",198,0)
 ;---> default is 2nd "^"-piece of BIYEAR=""--which is End Date of Dec 31.
"RTN","BIOUTPT5",199,0)
 I Y="m" S BIYEAR=BIYEAR_U_"m"
"RTN","BIOUTPT5",200,0)
 ;
"RTN","BIOUTPT5",201,0)
 D @("RESET^"_BIRTN)
"RTN","BIOUTPT5",202,0)
 ;
"RTN","BIOUTPT5",203,0)
 Q
"RTN","BIOUTPT5",204,0)
 ;
"RTN","BIOUTPT5",205,0)
 ;
"RTN","BIOUTPT5",206,0)
 ;----------
"RTN","BIOUTPT5",207,0)
TEXT1 ;EP
"RTN","BIOUTPT5",208,0)
 ;;The "Report Year" represents the start of a particular influenza
"RTN","BIOUTPT5",209,0)
 ;;season.  So, for example, 2011 will cover the influenza season from
"RTN","BIOUTPT5",210,0)
 ;;September 1, 2011 until December 31, 2011 (or until March 31, 2012,
"RTN","BIOUTPT5",211,0)
 ;;if that End Date is chosen).
"RTN","BIOUTPT5",212,0)
 ;;
"RTN","BIOUTPT5",213,0)
 ;;The patient ages in the report will be calculated as of 12/31 of the
"RTN","BIOUTPT5",214,0)
 ;;Report Year you select (12/31/2011 in the above example).
"RTN","BIOUTPT5",215,0)
 ;;
"RTN","BIOUTPT5",216,0)
 D PRINTX("TEXT1")
"RTN","BIOUTPT5",217,0)
 Q
"RTN","BIOUTPT5",218,0)
 ;
"RTN","BIOUTPT5",219,0)
 ;
"RTN","BIOUTPT5",220,0)
 ;----------
"RTN","BIOUTPT5",221,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIOUTPT5",222,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT5",223,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT5",224,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIOUTPT5",225,0)
 Q
"RTN","BIOUTPT5",226,0)
 ;
"RTN","BIOUTPT5",227,0)
 ;
"RTN","BIOUTPT5",228,0)
 ;----------
"RTN","BIOUTPT5",229,0)
TEXT11(BITEXT) ;EP
"RTN","BIOUTPT5",230,0)
 ;;In producing lists and letters, you may select the group of patients
"RTN","BIOUTPT5",231,0)
 ;;you wish to include by specifying attributes of this screen, such as
"RTN","BIOUTPT5",232,0)
 ;;"DUE" or "ACTIVE."  These attributes may also be used in various
"RTN","BIOUTPT5",233,0)
 ;;combinations in order to further specify your patient group.
"RTN","BIOUTPT5",234,0)
 ;;(This group may be further limited by the other criteria you select
"RTN","BIOUTPT5",235,0)
 ;;on the main IMMUNIZATION LISTS & LETTERS Main Screen, such as Age Range,
"RTN","BIOUTPT5",236,0)
 ;;Communities, Lot Numbers, etc.)
"RTN","BIOUTPT5",237,0)
 ;;
"RTN","BIOUTPT5",238,0)
 ;;                               DUE
"RTN","BIOUTPT5",239,0)
 ;;                              -----
"RTN","BIOUTPT5",240,0)
 ;;"DUE" will list all Active patients who are DUE for immunizations,
"RTN","BIOUTPT5",241,0)
 ;;subject to any other limitations on the Lists & Letters Main Screen,
"RTN","BIOUTPT5",242,0)
 ;;such as Age Range, Community, etc..  "DUE" will also necessarily include
"RTN","BIOUTPT5",243,0)
 ;;any patients who are "PAST DUE."  By default, "DUE" will only include
"RTN","BIOUTPT5",244,0)
 ;;patients who are "ACTIVE" unless you specify "INACTIVE" as one of the
"RTN","BIOUTPT5",245,0)
 ;;attributes.
"RTN","BIOUTPT5",246,0)
 ;;
"RTN","BIOUTPT5",247,0)
 ;;                             PAST DUE
"RTN","BIOUTPT5",248,0)
 ;;                            ----------
"RTN","BIOUTPT5",249,0)
 ;;"PAST DUE" will only include patients who are past their due dates
"RTN","BIOUTPT5",250,0)
 ;;for one or more immunizations.  If you select this attribute, you
"RTN","BIOUTPT5",251,0)
 ;;will be given the opportunity to specify how many months past due
"RTN","BIOUTPT5",252,0)
 ;;you wish to check for.  By default, "PAST DUE" will only include
"RTN","BIOUTPT5",253,0)
 ;;patients who are "ACTIVE" unless you specify "INACTIVE" as one of the
"RTN","BIOUTPT5",254,0)
 ;;attributes.
"RTN","BIOUTPT5",255,0)
 ;;
"RTN","BIOUTPT5",256,0)
 ;;                        ACTIVE and INACTIVE
"RTN","BIOUTPT5",257,0)
 ;;                       ---------------------
"RTN","BIOUTPT5",258,0)
 ;;The choices of "ACTIVE" and "INACTIVE" will simply list patients in the
"RTN","BIOUTPT5",259,0)
 ;;Immunization Database who have the Statuses of Active or Inactive.
"RTN","BIOUTPT5",260,0)
 ;;"ACTIVE" and "INACTIVE" may also be used together to produce a list
"RTN","BIOUTPT5",261,0)
 ;;of all patients in the Immunization database.
"RTN","BIOUTPT5",262,0)
 ;;
"RTN","BIOUTPT5",263,0)
 ;;
"RTN","BIOUTPT5",264,0)
 ;;                      AUTOMATICALLY ACTIVATED
"RTN","BIOUTPT5",265,0)
 ;;                     -------------------------
"RTN","BIOUTPT5",266,0)
 ;;"AUTOMATICALLY ACTIVATED" will restrict the list to only those patients
"RTN","BIOUTPT5",267,0)
 ;;who were Automatically Activated in the Immunization database.  You may
"RTN","BIOUTPT5",268,0)
 ;;combine it with other attributes, such as ACTIVE or DUE, to produce a
"RTN","BIOUTPT5",269,0)
 ;;list that is more specific.  For example, you could produce a list of
"RTN","BIOUTPT5",270,0)
 ;;patients who were AUTOMATICALLY ACTIVATED and are now PAST DUE.
"RTN","BIOUTPT5",271,0)
 ;;
"RTN","BIOUTPT5",272,0)
 ;;
"RTN","BIOUTPT5",273,0)
 ;;                            REFUSALS
"RTN","BIOUTPT5",274,0)
 ;;                           ----------
"RTN","BIOUTPT5",275,0)
 ;;"REFUSALS" will restrict the list to only those patients who at some
"RTN","BIOUTPT5",276,0)
 ;;point refused an immunization (either the patient or the parent).
"RTN","BIOUTPT5",277,0)
 ;;You may combine REFUSALS with other attributes in order to produce a
"RTN","BIOUTPT5",278,0)
 ;;list that is more specific.  For example, you could produce a list of
"RTN","BIOUTPT5",279,0)
 ;;patients who were both INACTIVE and had REFUSALS on record.
"RTN","BIOUTPT5",280,0)
 ;;
"RTN","BIOUTPT5",281,0)
 ;;
"RTN","BIOUTPT5",282,0)
 ;;                          FEMALES ONLY
"RTN","BIOUTPT5",283,0)
 ;;                         --------------
"RTN","BIOUTPT5",284,0)
 ;;"FEMALES ONLY" will restrict the list to female patients only.
"RTN","BIOUTPT5",285,0)
 ;;NOTE: The list will include both "ACTIVE" and "INACTIVE" female
"RTN","BIOUTPT5",286,0)
 ;;patients unless you have specifically chosen Active or Inactive.
"RTN","BIOUTPT5",287,0)
 ;;
"RTN","BIOUTPT5",288,0)
 ;;
"RTN","BIOUTPT5",289,0)
 ;;                        SEARCH TEMPLATES
"RTN","BIOUTPT5",290,0)
 ;;                       ------------------
"RTN","BIOUTPT5",291,0)
 ;;SEARCH TEMPLATEs are groups of individual patients that have been
"RTN","BIOUTPT5",292,0)
 ;;produced and stored by other software, usually QMAN, and saved under
"RTN","BIOUTPT5",293,0)
 ;;a Template Name.  If you choose this attribute, you will be asked to
"RTN","BIOUTPT5",294,0)
 ;;select from a file of existing Search Templates.
"RTN","BIOUTPT5",295,0)
 ;;
"RTN","BIOUTPT5",296,0)
 ;;NOTE: A SEARCH TEMPLATE is a pre-defined group of patients and cannot
"RTN","BIOUTPT5",297,0)
 ;;be combined with any of the other attributes.
"RTN","BIOUTPT5",298,0)
 ;;For more information about Search Templates and how to create your
"RTN","BIOUTPT5",299,0)
 ;;own, contact your computer support people for training.
"RTN","BIOUTPT5",300,0)
 ;;
"RTN","BIOUTPT5",301,0)
 ;;
"RTN","BIOUTPT5",302,0)
 ;;Final note: The implications of combining too many restrictive attributes
"RTN","BIOUTPT5",303,0)
 ;;can be difficult to predict and may produce few or no results.
"RTN","BIOUTPT5",304,0)
 ;;It is best to limit a list to two or three combined attributes.
"RTN","BIOUTPT5",305,0)
 ;;
"RTN","BIOUTPT5",306,0)
 D LOADTX("TEXT11",,.BITEXT)
"RTN","BIOUTPT5",307,0)
 Q
"RTN","BIOUTPT5",308,0)
 ;
"RTN","BIOUTPT5",309,0)
 ;
"RTN","BIOUTPT5",310,0)
 ;----------
"RTN","BIOUTPT5",311,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIOUTPT5",312,0)
 Q:$G(BILINL)=""
"RTN","BIOUTPT5",313,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIOUTPT5",314,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIOUTPT5",315,0)
 Q
"RTN","BIPATCO")
0^67^B27934606
"RTN","BIPATCO",1,0)
BIPATCO ;IHS/CMI/MWR - EDIT CONTRAINDICATIONS; MAY 10, 2010
"RTN","BIPATCO",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATCO",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATCO",4,0)
 ;;  EDIT PATIENT'S CONTRAINDICATIONS THROUGH LISTMANAGER.
"RTN","BIPATCO",5,0)
 ;
"RTN","BIPATCO",6,0)
 ;
"RTN","BIPATCO",7,0)
 ;----------
"RTN","BIPATCO",8,0)
START ;EP
"RTN","BIPATCO",9,0)
 ;---> Lookup patients and Add/Edit their Contraindications.
"RTN","BIPATCO",10,0)
 ;---> NOT CALLED BY ANY MENU OPTION AT THIS POINT.
"RTN","BIPATCO",11,0)
 ;
"RTN","BIPATCO",12,0)
 D SETVARS^BIUTL5 N BIDFN
"RTN","BIPATCO",13,0)
 F  D  Q:$G(BIDFN)<1
"RTN","BIPATCO",14,0)
 .D TITLE^BIUTL5("ADD/EDIT CONTRAINDICAIONS")
"RTN","BIPATCO",15,0)
 .D PATLKUP^BIUTL8(.BIDFN)
"RTN","BIPATCO",16,0)
 .Q:$G(BIDFN)<1
"RTN","BIPATCO",17,0)
 .D EN(BIDFN)
"RTN","BIPATCO",18,0)
 D EXIT
"RTN","BIPATCO",19,0)
 Q
"RTN","BIPATCO",20,0)
 ;
"RTN","BIPATCO",21,0)
 ;
"RTN","BIPATCO",22,0)
 ;----------
"RTN","BIPATCO",23,0)
HAVEPAT(BIDFN) ;EP
"RTN","BIPATCO",24,0)
 ;---> Entry point when patient already known.
"RTN","BIPATCO",25,0)
 D SETVARS^BIUTL5
"RTN","BIPATCO",26,0)
 K ^TMP("BILMCO",$J)
"RTN","BIPATCO",27,0)
 D EN(BIDFN)
"RTN","BIPATCO",28,0)
 Q
"RTN","BIPATCO",29,0)
 ;
"RTN","BIPATCO",30,0)
 ;
"RTN","BIPATCO",31,0)
 ;----------
"RTN","BIPATCO",32,0)
EN(BIDFN) ;EP
"RTN","BIPATCO",33,0)
 ;---> Entry point called by Protocol BI CONTRAINDICATIONS.
"RTN","BIPATCO",34,0)
 ;     1 - BIDFN (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATCO",35,0)
 ;
"RTN","BIPATCO",36,0)
 ;---> If <STKOV> errors appear here, increase STACK in SYSGEN,
"RTN","BIPATCO",37,0)
 ;---> System Configuration Parameters.
"RTN","BIPATCO",38,0)
 ;
"RTN","BIPATCO",39,0)
 ;---> Quit if BIDFN not provided.
"RTN","BIPATCO",40,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(206,,1) Q
"RTN","BIPATCO",41,0)
 ;
"RTN","BIPATCO",42,0)
 ;---> Quit if this patient is Locked (being edited by another user).
"RTN","BIPATCO",43,0)
 L +^BIP(BIDFN):0 I '$T D ERRCD^BIUTL2(212,,1) Q
"RTN","BIPATCO",44,0)
 N BIDFNSAV S BIDFNSAV=BIDFN
"RTN","BIPATCO",45,0)
 D
"RTN","BIPATCO",46,0)
 .N BIDFNSAV
"RTN","BIPATCO",47,0)
 .D EN^VALM("BI PATIENT CONTRAINDICATIONS")
"RTN","BIPATCO",48,0)
 ;
"RTN","BIPATCO",49,0)
 ;---> Unlock Patient.
"RTN","BIPATCO",50,0)
 S BIDFN=BIDFNSAV
"RTN","BIPATCO",51,0)
 L -^BIP(BIDFN)
"RTN","BIPATCO",52,0)
 Q
"RTN","BIPATCO",53,0)
 ;
"RTN","BIPATCO",54,0)
 ;
"RTN","BIPATCO",55,0)
 ;----------
"RTN","BIPATCO",56,0)
HDR ;EP
"RTN","BIPATCO",57,0)
 ;---> Header code.
"RTN","BIPATCO",58,0)
 Q:'$D(BIDFN)
"RTN","BIPATCO",59,0)
 N X,Y
"RTN","BIPATCO",60,0)
 S VALMHDR(1)=""
"RTN","BIPATCO",61,0)
 S Y=$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATCO",62,0)
 S X=" Patient: "_Y
"RTN","BIPATCO",63,0)
 S X=X_$$SP^BIUTL5(27-$L(Y))_"DOB: "_$$DOBF^BIUTL1(BIDFN)
"RTN","BIPATCO",64,0)
 S VALMHDR(2)=X
"RTN","BIPATCO",65,0)
 ;
"RTN","BIPATCO",66,0)
 S X="  Chart#: "_$$HRCN^BIUTL1(BIDFN)
"RTN","BIPATCO",67,0)
 S Y=$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)
"RTN","BIPATCO",68,0)
 S X=X_" at "_Y
"RTN","BIPATCO",69,0)
 S X=X_$$SP^BIUTL5(20-$L(Y))_$$ACTIVE^BIUTL1(BIDFN)
"RTN","BIPATCO",70,0)
 S X=X_"     "_$$SEXW^BIUTL1(BIDFN)
"RTN","BIPATCO",71,0)
 S VALMHDR(3)=X
"RTN","BIPATCO",72,0)
 ;
"RTN","BIPATCO",73,0)
 ;---> Set Screen Title.
"RTN","BIPATCO",74,0)
 S VALM("TITLE")="CONTRAIND (IMM v"_$$VER^BILOGO_")"
"RTN","BIPATCO",75,0)
 Q
"RTN","BIPATCO",76,0)
 ;
"RTN","BIPATCO",77,0)
 ;
"RTN","BIPATCO",78,0)
 ;----------
"RTN","BIPATCO",79,0)
INIT ;EP
"RTN","BIPATCO",80,0)
 ;---> Initialize variables and list array.
"RTN","BIPATCO",81,0)
 D INIT^BIPATCO1
"RTN","BIPATCO",82,0)
 Q
"RTN","BIPATCO",83,0)
 ;
"RTN","BIPATCO",84,0)
 ;
"RTN","BIPATCO",85,0)
 ;----------
"RTN","BIPATCO",86,0)
RESET ;EP
"RTN","BIPATCO",87,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIPATCO",88,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATCO",89,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATCO",90,0)
 D INIT,HDR Q
"RTN","BIPATCO",91,0)
 ;
"RTN","BIPATCO",92,0)
 ;
"RTN","BIPATCO",93,0)
 ;----------
"RTN","BIPATCO",94,0)
HELP ;EP
"RTN","BIPATCO",95,0)
 ;---> Help code.
"RTN","BIPATCO",96,0)
 W !!?5,"Enter ""H"" for Help with this feature or ""??"" for more options."
"RTN","BIPATCO",97,0)
 D DIRZ^BIUTL3()
"RTN","BIPATCO",98,0)
 Q
"RTN","BIPATCO",99,0)
 ;
"RTN","BIPATCO",100,0)
 ;
"RTN","BIPATCO",101,0)
 ;----------
"RTN","BIPATCO",102,0)
HELP1 ;EP
"RTN","BIPATCO",103,0)
 ;----> Explanation of this report.
"RTN","BIPATCO",104,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIPATCO",105,0)
 D START^BIHELP("CONTRAINDICATION SCREEN - HELP",.BITEXT)
"RTN","BIPATCO",106,0)
 Q
"RTN","BIPATCO",107,0)
 ;
"RTN","BIPATCO",108,0)
 ;
"RTN","BIPATCO",109,0)
 ;----------
"RTN","BIPATCO",110,0)
TEXT1(BITEXT) ;EP
"RTN","BIPATCO",111,0)
 ;;This is the Patient Contraindication Screen, the point from
"RTN","BIPATCO",112,0)
 ;;which you add or delete the patient's contraindications.
"RTN","BIPATCO",113,0)
 ;;
"RTN","BIPATCO",114,0)
 ;;The TOP of the screen lists the patient's demographic information,
"RTN","BIPATCO",115,0)
 ;;most of which is edited through the Patient Registration.
"RTN","BIPATCO",116,0)
 ;;
"RTN","BIPATCO",117,0)
 ;;The MIDDLE of the screen lists any Contraindications to vaccines
"RTN","BIPATCO",118,0)
 ;;that the patient may have, along with the Reason for the
"RTN","BIPATCO",119,0)
 ;;contraindication and the Date it was Noted.
"RTN","BIPATCO",120,0)
 ;;
"RTN","BIPATCO",121,0)
 ;;The BOTTOM of the screen provides the  Actions to Add or Delete
"RTN","BIPATCO",122,0)
 ;;Contraindications, or to view this Explanation.
"RTN","BIPATCO",123,0)
 ;;
"RTN","BIPATCO",124,0)
 ;;Contraindications added for the patient here will cause the
"RTN","BIPATCO",125,0)
 ;;contraindicated vaccine to be eliminated from the Forecast
"RTN","BIPATCO",126,0)
 ;;(in the right column of the main Patient View screen).
"RTN","BIPATCO",127,0)
 ;;
"RTN","BIPATCO",128,0)
 ;;HOWEVER, if the Reason chosen for a Contraindication is
"RTN","BIPATCO",129,0)
 ;;"Patient Refusal", the vaccine will NOT be eliminated from
"RTN","BIPATCO",130,0)
 ;;the Forecast.
"RTN","BIPATCO",131,0)
 ;;
"RTN","BIPATCO",132,0)
 ;;If you choose "Immune Deficiency," then MMR, Varicella, OPV, and
"RTN","BIPATCO",133,0)
 ;;Flu-Nasal (all live vaccines) are automatically contraindicated.
"RTN","BIPATCO",134,0)
 ;;
"RTN","BIPATCO",135,0)
 ;;NOTE: You may select TST-PPD INTRADERMAL (PPD) as the "vaccine."
"RTN","BIPATCO",136,0)
 ;;In this case, the only reason selectable will be "Positive TB Skin Test."
"RTN","BIPATCO",137,0)
 ;;This allows the system to display a contraindication to future PPD tests.
"RTN","BIPATCO",138,0)
 ;;
"RTN","BIPATCO",139,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIPATCO",140,0)
 Q
"RTN","BIPATCO",141,0)
 ;
"RTN","BIPATCO",142,0)
 ;
"RTN","BIPATCO",143,0)
 ;----------
"RTN","BIPATCO",144,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIPATCO",145,0)
 Q:$G(BILINL)=""
"RTN","BIPATCO",146,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPATCO",147,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIPATCO",148,0)
 Q
"RTN","BIPATCO",149,0)
 ;
"RTN","BIPATCO",150,0)
 ;
"RTN","BIPATCO",151,0)
 ;----------
"RTN","BIPATCO",152,0)
EXIT ;EP
"RTN","BIPATCO",153,0)
 ;---> EOJ cleanup.
"RTN","BIPATCO",154,0)
 K ^TMP("BILMCO",$J) D KILLALL^BIUTL8()
"RTN","BIPATCO",155,0)
 D CLEAR^VALM1
"RTN","BIPATCO",156,0)
 D FULL^VALM1
"RTN","BIPATCO",157,0)
 Q
"RTN","BIPATCO",158,0)
 ;
"RTN","BIPATCO",159,0)
 ;
"RTN","BIPATCO",160,0)
 ;----------
"RTN","BIPATCO",161,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIPATCO",162,0)
 Q:$G(BILINL)=""
"RTN","BIPATCO",163,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPATCO",164,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIPATCO",165,0)
 Q
"RTN","BIPATCO1")
0^68^B4160688
"RTN","BIPATCO1",1,0)
BIPATCO1 ;IHS/CMI/MWR - BUILD LIST ARRAY OF CONTRAS; MAY 10, 2010
"RTN","BIPATCO1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATCO1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATCO1",4,0)
 ;;  BUILD LISTMANAGER ARRAY FOR DISPLAY AND EDIT OF
"RTN","BIPATCO1",5,0)
 ;;  PATIENT'S CONTRAINDICATIONS.
"RTN","BIPATCO1",6,0)
 ;
"RTN","BIPATCO1",7,0)
 ;
"RTN","BIPATCO1",8,0)
 ;----------
"RTN","BIPATCO1",9,0)
INIT ;EP
"RTN","BIPATCO1",10,0)
 ;---> Initialize variables and list array.
"RTN","BIPATCO1",11,0)
 ;
"RTN","BIPATCO1",12,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BIPATCO1",13,0)
 ;
"RTN","BIPATCO1",14,0)
 ;---> If BIDFN not supplied, set Error Code and quit.
"RTN","BIPATCO1",15,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) Q
"RTN","BIPATCO1",16,0)
 ;
"RTN","BIPATCO1",17,0)
 ;---> Initialize RPC variables.
"RTN","BIPATCO1",18,0)
 ;     BI31     - Delimiter between return value and return error.
"RTN","BIPATCO1",19,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BIPATCO1",20,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BIPATCO1",21,0)
 ;
"RTN","BIPATCO1",22,0)
 N BI31,BIRETVAL,BIRETERR
"RTN","BIPATCO1",23,0)
 S BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIPATCO1",24,0)
 ;
"RTN","BIPATCO1",25,0)
 ;---> RPC to gather Contraindications History.
"RTN","BIPATCO1",26,0)
 D CONTRAS^BIRPC5(.BIRETVAL,BIDFN)
"RTN","BIPATCO1",27,0)
 ;
"RTN","BIPATCO1",28,0)
 ;---> If BIRETERR has a value, display it and quit.
"RTN","BIPATCO1",29,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIPATCO1",30,0)
 I BIRETERR]"" D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3() Q
"RTN","BIPATCO1",31,0)
 ;
"RTN","BIPATCO1",32,0)
 ;---> Set BICONT=to a string of Contraindications for this patient.
"RTN","BIPATCO1",33,0)
 ;---> * NOTE! BICONT(BIDFN) is not newed; it is used to edit and delete
"RTN","BIPATCO1",34,0)
 ;       Immunizations for this patient (sub BIDFN for insurance).
"RTN","BIPATCO1",35,0)
 ;
"RTN","BIPATCO1",36,0)
 K BICONT(BIDFN)
"RTN","BIPATCO1",37,0)
 S BICONT(BIDFN)=$P(BIRETVAL,BI31,1)
"RTN","BIPATCO1",38,0)
 ;
"RTN","BIPATCO1",39,0)
 ;---> Build Listmanager array from BICONT(BIDFN) string.
"RTN","BIPATCO1",40,0)
 K ^TMP("BILMCO",$J)
"RTN","BIPATCO1",41,0)
 N BIENT,BILINE,I,V,X,Y,Z
"RTN","BIPATCO1",42,0)
 S BIENT=0,BILINE=0,V="|",Z=""
"RTN","BIPATCO1",43,0)
 ;
"RTN","BIPATCO1",44,0)
 ;---> Insert blank line at the top of the List Region.
"RTN","BIPATCO1",45,0)
 S ^TMP("BILMCO",$J,1,0)=""
"RTN","BIPATCO1",46,0)
 S ^TMP("BILMCO",$J,"IDX",1,1)=""
"RTN","BIPATCO1",47,0)
 ;
"RTN","BIPATCO1",48,0)
 ;---> Build Listmanager array from BICONT string.
"RTN","BIPATCO1",49,0)
 ;
"RTN","BIPATCO1",50,0)
 F I=1:1 S Y=$P(BICONT(BIDFN),U,I) Q:Y=""  D
"RTN","BIPATCO1",51,0)
 .;---> Build display line for this Contraindication.
"RTN","BIPATCO1",52,0)
 .S X="    "_I_"  "
"RTN","BIPATCO1",53,0)
 .S X=X_$P(Y,V,2)_":",X=$$PAD^BIUTL5(X,19)_$P(Y,V,3)
"RTN","BIPATCO1",54,0)
 .S X=$$PAD^BIUTL5(X,47)_$P(Y,V,4)
"RTN","BIPATCO1",55,0)
 .;
"RTN","BIPATCO1",56,0)
 .;---> Set formatted Contraindication line and index in ^TMP.
"RTN","BIPATCO1",57,0)
 .S ^TMP("BILMCO",$J,I+1,0)=X
"RTN","BIPATCO1",58,0)
 .S ^TMP("BILMCO",$J,"IDX",I+1,I)=""
"RTN","BIPATCO1",59,0)
 ;
"RTN","BIPATCO1",60,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIPATCO1",61,0)
 S VALMCNT=I
"RTN","BIPATCO1",62,0)
 I VALMCNT>12 D
"RTN","BIPATCO1",63,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIPATCO1",64,0)
 Q
"RTN","BIPATCO2")
0^69^B21497710
"RTN","BIPATCO2",1,0)
BIPATCO2 ;IHS/CMI/MWR - ADD/DELETE CONTRAINDICATIONS; MAY 10, 2010
"RTN","BIPATCO2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATCO2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATCO2",4,0)
 ;;  ADD AND DELETE CONTRAINDICATIONS VIA LISTMANAGER.
"RTN","BIPATCO2",5,0)
 ;
"RTN","BIPATCO2",6,0)
 ;
"RTN","BIPATCO2",7,0)
 ;----------
"RTN","BIPATCO2",8,0)
ADDCON ;EP
"RTN","BIPATCO2",9,0)
 ;---> Add a Contraindication via List Manager.
"RTN","BIPATCO2",10,0)
 ;---> Steps:
"RTN","BIPATCO2",11,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATCO2",12,0)
 ;               BI CONTRAINDICATION ADD, an action on the
"RTN","BIPATCO2",13,0)
 ;               List Manager menu protocol: BI MENU CONTRAINDICATIONS.
"RTN","BIPATCO2",14,0)
 ;
"RTN","BIPATCO2",15,0)
 ;            2) This code calls ScreenMan form:
"RTN","BIPATCO2",16,0)
 ;               BI FORM-CONTRAIND ADD/EDIT to add a contraindication.
"RTN","BIPATCO2",17,0)
 ;
"RTN","BIPATCO2",18,0)
 ;            3) SAVCONTR^BIUTL7 uses BI local array to build data
"RTN","BIPATCO2",19,0)
 ;               to pass to ADD^BIRPC4 (which is also called by
"RTN","BIPATCO2",20,0)
 ;               the Broker from the GUI).
"RTN","BIPATCO2",21,0)
 ;
"RTN","BIPATCO2",22,0)
 ;            4) BIRPC4 adds the BI CONTRAINDICATION entry.
"RTN","BIPATCO2",23,0)
 ;
"RTN","BIPATCO2",24,0)
 ;---> Check that DFN for this patient is present.
"RTN","BIPATCO2",25,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATCO2",26,0)
 N BI S BI("A")=BIDFN
"RTN","BIPATCO2",27,0)
 ;
"RTN","BIPATCO2",28,0)
 ;
"RTN","BIPATCO2",29,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIPATCO2",30,0)
 N BISAVE
"RTN","BIPATCO2",31,0)
 N DR S DR="[BI FORM-CONTRAIND ADD/EDIT]"
"RTN","BIPATCO2",32,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATCO2",33,0)
 ;
"RTN","BIPATCO2",34,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATCO2",35,0)
 D:$G(BISAVE) SAVCONTR^BIUTL7(.BI)
"RTN","BIPATCO2",36,0)
 ;
"RTN","BIPATCO2",37,0)
 D RESET
"RTN","BIPATCO2",38,0)
 Q
"RTN","BIPATCO2",39,0)
 ;
"RTN","BIPATCO2",40,0)
 ;
"RTN","BIPATCO2",41,0)
 ;----------
"RTN","BIPATCO2",42,0)
EDITCON ;EP
"RTN","BIPATCO2",43,0)
 ;---> Edit a Contraindication via List Manager.
"RTN","BIPATCO2",44,0)
 ;---> Steps:
"RTN","BIPATCO2",45,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATCO2",46,0)
 ;               BI CONTRAINDICATION EDIT, an action on the
"RTN","BIPATCO2",47,0)
 ;               List Manager menu protocol: BI MENU CONTRAINDICATIONS.
"RTN","BIPATCO2",48,0)
 ;
"RTN","BIPATCO2",49,0)
 ;            2) This code gets a Contraindication from List Manager
"RTN","BIPATCO2",50,0)
 ;               and calls the ScreenMan form: BI FORM-CONTRAIND ADD/EDIT
"RTN","BIPATCO2",51,0)
 ;               to edit the contraindication.
"RTN","BIPATCO2",52,0)
 ;
"RTN","BIPATCO2",53,0)
 ;            3) BIRPC4 deletes the BI CONTRAINDICATION entry.
"RTN","BIPATCO2",54,0)
 ;
"RTN","BIPATCO2",55,0)
 ;
"RTN","BIPATCO2",56,0)
 ;---> Check that Contraindication string for this patient is
"RTN","BIPATCO2",57,0)
 ;---> present; if not, set Error Code and quit.
"RTN","BIPATCO2",58,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(415,,1) D RESET Q
"RTN","BIPATCO2",59,0)
 I $G(BICONT(BIDFN))="" D ERRCD^BIUTL2(313,,1) D RESET Q
"RTN","BIPATCO2",60,0)
 ;
"RTN","BIPATCO2",61,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BIPATCO2",62,0)
 N VALMY
"RTN","BIPATCO2",63,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATCO2",64,0)
 ;
"RTN","BIPATCO2",65,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIPATCO2",66,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATCO2",67,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BIPATCO2",68,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATCO2",69,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATCO2",70,0)
 ;
"RTN","BIPATCO2",71,0)
 S Y=$P(BICONT(BIDFN),U,Y)
"RTN","BIPATCO2",72,0)
 I Y']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATCO2",73,0)
 ;
"RTN","BIPATCO2",74,0)
 N BI,BIDIEN
"RTN","BIPATCO2",75,0)
 S BI("A")=BIDFN           ;Patient DFN.
"RTN","BIPATCO2",76,0)
 S BI("I")=$P(Y,"|",1)     ;IEN of this Contraindication.
"RTN","BIPATCO2",77,0)
 S BICONTDA=BI("I")        ;Save IEN of olf Contraindication to delete below.
"RTN","BIPATCO2",78,0)
 ;
"RTN","BIPATCO2",79,0)
 S BI("B")=$P($G(^BIPC(BI("I"),0)),U,2)     ;Vaccine IEN.
"RTN","BIPATCO2",80,0)
 I 'BI("B") D ERRCD^BIUTL2(418,,1) D RESET Q
"RTN","BIPATCO2",81,0)
 ;
"RTN","BIPATCO2",82,0)
 S BI("C")=$P(Y,"|",3)     ;Reason (external text).
"RTN","BIPATCO2",83,0)
 S BI("D")=$P(Y,"|",4)     ;Date (external text).
"RTN","BIPATCO2",84,0)
 ;---> Change Date to internal (in case Screenman doesn't get a chance).
"RTN","BIPATCO2",85,0)
 D
"RTN","BIPATCO2",86,0)
 .N X,Y,%DT S X=BI("D") D ^%DT
"RTN","BIPATCO2",87,0)
 .S BI("D")=Y
"RTN","BIPATCO2",88,0)
 ;
"RTN","BIPATCO2",89,0)
 ;--->Flag: If N=1 this is an EDIT.
"RTN","BIPATCO2",90,0)
 S BI("N")=1
"RTN","BIPATCO2",91,0)
 ;
"RTN","BIPATCO2",92,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIPATCO2",93,0)
 N BIERR,BISAVE
"RTN","BIPATCO2",94,0)
 N DR S DR="[BI FORM-CONTRAIND ADD/EDIT]"
"RTN","BIPATCO2",95,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATCO2",96,0)
 ;
"RTN","BIPATCO2",97,0)
 ;---> If user saved data, file it.
"RTN","BIPATCO2",98,0)
 I $G(BISAVE) D
"RTN","BIPATCO2",99,0)
 .D SAVCONTR^BIUTL7(.BI,.BIERR)
"RTN","BIPATCO2",100,0)
 .Q:($G(BIERR)]"")
"RTN","BIPATCO2",101,0)
 .;---> Now delete old (original) Contraindication.
"RTN","BIPATCO2",102,0)
 .D:$G(BICONTDA) DELCONT^BIRPC4(,BICONTDA)
"RTN","BIPATCO2",103,0)
 ;
"RTN","BIPATCO2",104,0)
 D RESET
"RTN","BIPATCO2",105,0)
 Q
"RTN","BIPATCO2",106,0)
 ;
"RTN","BIPATCO2",107,0)
 ;
"RTN","BIPATCO2",108,0)
 ;----------
"RTN","BIPATCO2",109,0)
DELETCON ;EP
"RTN","BIPATCO2",110,0)
 ;---> Delete a Contraindication via List Manager.
"RTN","BIPATCO2",111,0)
 ;---> Steps:
"RTN","BIPATCO2",112,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATCO2",113,0)
 ;               BI CONTRAINDICATION DELETE, an action on the
"RTN","BIPATCO2",114,0)
 ;               List Manager menu protocol: BI MENU CONTRAINDICATIONS.
"RTN","BIPATCO2",115,0)
 ;
"RTN","BIPATCO2",116,0)
 ;            2) This code gets a Contraindication from List Manager
"RTN","BIPATCO2",117,0)
 ;               and calls DELCONT^BIRPC4 (which is also called by
"RTN","BIPATCO2",118,0)
 ;               the Broker from the GUI).
"RTN","BIPATCO2",119,0)
 ;
"RTN","BIPATCO2",120,0)
 ;            3) BIRPC4 deletes the BI CONTRAINDICATION entry.
"RTN","BIPATCO2",121,0)
 ;
"RTN","BIPATCO2",122,0)
 ;
"RTN","BIPATCO2",123,0)
 ;---> Check that Contraindication string for this patient is
"RTN","BIPATCO2",124,0)
 ;---> present; if not, set Error Code and quit.
"RTN","BIPATCO2",125,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(415,,1) D RESET Q
"RTN","BIPATCO2",126,0)
 I $G(BICONT(BIDFN))="" D ERRCD^BIUTL2(313,,1) D RESET Q
"RTN","BIPATCO2",127,0)
 ;
"RTN","BIPATCO2",128,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BIPATCO2",129,0)
 N VALMY
"RTN","BIPATCO2",130,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATCO2",131,0)
 ;
"RTN","BIPATCO2",132,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIPATCO2",133,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATCO2",134,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BIPATCO2",135,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATCO2",136,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATCO2",137,0)
 ;
"RTN","BIPATCO2",138,0)
 S Y=$P(BICONT(BIDFN),U,Y)
"RTN","BIPATCO2",139,0)
 I Y']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATCO2",140,0)
 ;
"RTN","BIPATCO2",141,0)
 D FULL^VALM1
"RTN","BIPATCO2",142,0)
 ;
"RTN","BIPATCO2",143,0)
 ;---> Display contraindication for confirmation.
"RTN","BIPATCO2",144,0)
 ;---> Set Contraindication confirmation display and IEN.
"RTN","BIPATCO2",145,0)
 N BICONTDA,V S V="|"
"RTN","BIPATCO2",146,0)
 S X=$P(Y,V,2)_":  "_$P(Y,V,3)_"  "_$P(Y,V,4)
"RTN","BIPATCO2",147,0)
 ;---> BICONTDA=DA of Contraindication to be deleted.
"RTN","BIPATCO2",148,0)
 S BICONTDA=$P(Y,V)
"RTN","BIPATCO2",149,0)
 ;
"RTN","BIPATCO2",150,0)
 D TITLE^BIUTL5("DELETE A CONTRAINDICATION")
"RTN","BIPATCO2",151,0)
 N A
"RTN","BIPATCO2",152,0)
 S A(1)="Do you really wish to DELETE this Contraindication?"
"RTN","BIPATCO2",153,0)
 S A(1,"F")="!!?3"
"RTN","BIPATCO2",154,0)
 S A(2)="Patient: "_$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATCO2",155,0)
 S A(2)=A(2)_"       Chart#: "_$$HRCN^BIUTL1(BIDFN)
"RTN","BIPATCO2",156,0)
 S A(2,"F")="!!?10"
"RTN","BIPATCO2",157,0)
 S A(3)=X,A(3,"F")="!!?10"
"RTN","BIPATCO2",158,0)
 S A(4,"F")="!"
"RTN","BIPATCO2",159,0)
 D EN^DDIOL(.A)
"RTN","BIPATCO2",160,0)
 ;
"RTN","BIPATCO2",161,0)
 N B,BIPOP S BIPOP=0
"RTN","BIPATCO2",162,0)
 S B(1)="     Enter YES to DELETE this Contraindication."
"RTN","BIPATCO2",163,0)
 S B(2)="     Enter NO to leave it unchanged."
"RTN","BIPATCO2",164,0)
 D DIR^BIFMAN("Y",.Y,,"   Enter Yes or No","NO",B(2),B(1))
"RTN","BIPATCO2",165,0)
 ;
"RTN","BIPATCO2",166,0)
 ;---> Failed to confirm.
"RTN","BIPATCO2",167,0)
 I Y<1 D  Q
"RTN","BIPATCO2",168,0)
 .D IO^BIO("NO changes made.")
"RTN","BIPATCO2",169,0)
 .D DIRZ^BIUTL3(),RESET
"RTN","BIPATCO2",170,0)
 ;
"RTN","BIPATCO2",171,0)
 ;---> Delete the visit.
"RTN","BIPATCO2",172,0)
 S BIPOP=""
"RTN","BIPATCO2",173,0)
 D DELCONT^BIRPC4(.BIPOP,BICONTDA)
"RTN","BIPATCO2",174,0)
 ;
"RTN","BIPATCO2",175,0)
 ;---> If an error is passed back, display it.
"RTN","BIPATCO2",176,0)
 N BI31 S BI31=$C(31)_$C(31),BIPOP=$P(BIPOP,BI31,2)
"RTN","BIPATCO2",177,0)
 I BIPOP]"" D IO^BIO(BIPOP),DIRZ^BIUTL3()
"RTN","BIPATCO2",178,0)
 D RESET
"RTN","BIPATCO2",179,0)
 Q
"RTN","BIPATCO2",180,0)
 ;
"RTN","BIPATCO2",181,0)
 ;
"RTN","BIPATCO2",182,0)
 ;----------
"RTN","BIPATCO2",183,0)
RESET ;EP
"RTN","BIPATCO2",184,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIPATCO2",185,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATCO2",186,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATCO2",187,0)
 D INIT^BIPATCO,HDR^BIPATCO
"RTN","BIPATCO2",188,0)
 Q
"RTN","BIPATE")
0^70^B22259160
"RTN","BIPATE",1,0)
BIPATE ;IHS/CMI/MWR - PATIENT CASE DATA EDIT; MAY 10, 2010
"RTN","BIPATE",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATE",4,0)
 ;;  EDIT PATIENT CASE DATA.
"RTN","BIPATE",5,0)
 ;
"RTN","BIPATE",6,0)
 ;
"RTN","BIPATE",7,0)
 ;----------
"RTN","BIPATE",8,0)
MAIN ;EP
"RTN","BIPATE",9,0)
 ;---> Not called from Menus.
"RTN","BIPATE",10,0)
 D SETVARS^BIUTL5
"RTN","BIPATE",11,0)
 F  D PATIENT Q:BIPOP
"RTN","BIPATE",12,0)
 ;
"RTN","BIPATE",13,0)
EXIT ;EP
"RTN","BIPATE",14,0)
 D KILLALL^BIUTL8(1)
"RTN","BIPATE",15,0)
 Q
"RTN","BIPATE",16,0)
 ;
"RTN","BIPATE",17,0)
 ;
"RTN","BIPATE",18,0)
 ;----------
"RTN","BIPATE",19,0)
PATIENT ;EP
"RTN","BIPATE",20,0)
 D TITLE^BIUTL5("EDIT PATIENT CASE DATA")
"RTN","BIPATE",21,0)
 ;
"RTN","BIPATE",22,0)
PATIENT1 ;EP
"RTN","BIPATE",23,0)
 ;---> To avoid @IOF and title.
"RTN","BIPATE",24,0)
 ;---> Select Patient.
"RTN","BIPATE",25,0)
 N Y S Y=""
"RTN","BIPATE",26,0)
 W !!,"   Select the patient you wish to add or edit."
"RTN","BIPATE",27,0)
 D PATLKUP^BIUTL8(.BIDFN,"ADD",DUZ(2),.BIPOP)
"RTN","BIPATE",28,0)
 Q:BIPOP
"RTN","BIPATE",29,0)
 I BIDFN<0 S BIPOP=1 Q
"RTN","BIPATE",30,0)
 S BIDFN=+BIDFN
"RTN","BIPATE",31,0)
 ;---> Quit if this patient is Locked (being edited by another user).
"RTN","BIPATE",32,0)
 L +^BIP(BIDFN):1 I '$T D ERRCD^BIUTL2(212,.BIERR) Q
"RTN","BIPATE",33,0)
 ;---> If called from here, do not do HDR & INIT in ^BIPATVW.
"RTN","BIPATE",34,0)
 D SCREEN(BIDFN) S BIPOP=0
"RTN","BIPATE",35,0)
 L -^BIP($G(BIDFN))
"RTN","BIPATE",36,0)
 Q
"RTN","BIPATE",37,0)
 ;
"RTN","BIPATE",38,0)
 ;
"RTN","BIPATE",39,0)
 ;----------
"RTN","BIPATE",40,0)
SCREEN(BIDFN) ;EP
"RTN","BIPATE",41,0)
 ;---> Edit Patient Case Data with Screenman.
"RTN","BIPATE",42,0)
 ;---> Parameters:
"RTN","BIPATE",43,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATE",44,0)
 ;
"RTN","BIPATE",45,0)
 ;---> If <STKOV> errors appear here, increase STACK in SYSGEN,
"RTN","BIPATE",46,0)
 ;---> System Configuration Parameters.
"RTN","BIPATE",47,0)
 ;
"RTN","BIPATE",48,0)
 ;---> Quit if BIDFN not provided.
"RTN","BIPATE",49,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(206,,1)
"RTN","BIPATE",50,0)
 ;
"RTN","BIPATE",51,0)
 ;---> Gather Case Data for this Patient to load for Screenman edit.
"RTN","BIPATE",52,0)
 N Y S Y=""
"RTN","BIPATE",53,0)
 D CASEDAT^BIRPC5(.Y,BIDFN) ;EP
"RTN","BIPATE",54,0)
 ;
"RTN","BIPATE",55,0)
 ;---> If an error is passed back, display it and quit.
"RTN","BIPATE",56,0)
 N BI31,BIRETERR S BI31=$C(31)_$C(31)
"RTN","BIPATE",57,0)
 S BIRETERR=$P(Y,BI31,2)
"RTN","BIPATE",58,0)
 I BIRETERR]"" D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3() Q
"RTN","BIPATE",59,0)
 S Y=$P(Y,BI31)
"RTN","BIPATE",60,0)
 ;
"RTN","BIPATE",61,0)
 ;---> Build BI array for Case Data edit via Screenman.
"RTN","BIPATE",62,0)
 N BI
"RTN","BIPATE",63,0)
 S BI("A")=+BIDFN       ;Patient DFN.
"RTN","BIPATE",64,0)
 S BI("B")=$P(Y,U)      ;Case Manager's name, text.
"RTN","BIPATE",65,0)
 S BI("C")=$P(Y,U,2)    ;Parent or Guardian, text.
"RTN","BIPATE",66,0)
 S BI("D")=$P(Y,U,3)    ;Mother's HBsAG Status (P,N,A,U).
"RTN","BIPATE",67,0)
 S BI("E")=$P(Y,U,4)    ;Date Patient became Inactive (DD-Mmm-YYYY).
"RTN","BIPATE",68,0)
 S BI("F")=$P(Y,U,5)    ;Reason for Inactive.
"RTN","BIPATE",69,0)
 S BI("G")=$P(Y,U,6)    ;Other Info.
"RTN","BIPATE",70,0)
 S BI("H")=$P(Y,U,7)    ;Forecast Influenza/Pneumococcal.
"RTN","BIPATE",71,0)
 S BI("I")=$P(Y,U,8)    ;Location Moved or Tx Elsewhere.
"RTN","BIPATE",72,0)
 S BI("K")=$P(Y,U,9)    ;State Registry Consent, 1=YES, 0/""=NO.
"RTN","BIPATE",73,0)
 ;
"RTN","BIPATE",74,0)
 N DR S DR="[BI FORM-CASE DATA EDIT]"
"RTN","BIPATE",75,0)
 D DDS^BIFMAN(9002084,DR,BIDFN,"","",.BIPOP)
"RTN","BIPATE",76,0)
 Q
"RTN","BIPATE",77,0)
 ;
"RTN","BIPATE",78,0)
 ;
"RTN","BIPATE",79,0)
 ;----------
"RTN","BIPATE",80,0)
AUTOADD(BIDFN,BISITE,BIERR,BINACT) ;PEP - Automatically add a Patient to the Imm DB.
"RTN","BIPATE",81,0)
 ;---> Automatically add a Patient to the Imm Register.
"RTN","BIPATE",82,0)
 ;---> If an Inactive Date is passed, Patient will be added as Inactive today.
"RTN","BIPATE",83,0)
 ;---> If no Inactive Date is passed and the Patient is under 36 months of age
"RTN","BIPATE",84,0)
 ;---> and has a Current Community in the GPRA Set of Communities (defined by
"RTN","BIPATE",85,0)
 ;---> Imm Manager under Edit Site Parameters), or if the Patient has NO Current
"RTN","BIPATE",86,0)
 ;---> Cummunity set yet, then the Patient will be added as Active.
"RTN","BIPATE",87,0)
 ;---> Otherwise the Patient is added as Inactive.
"RTN","BIPATE",88,0)
 ;---> Parameters:
"RTN","BIPATE",89,0)
 ;     1 - BIDFN  (req)   Patient's IEN in VA PATIENT File #2.
"RTN","BIPATE",90,0)
 ;     2 - BISITE (req)   DUZ(2) for default Case Manager.
"RTN","BIPATE",91,0)
 ;     3 - BIERR  (ret)   Error text, if any.
"RTN","BIPATE",92,0)
 ;     4 - BINACT (opt)   Fileman internal date Patient became Inactive.
"RTN","BIPATE",93,0)
 ;
"RTN","BIPATE",94,0)
 ;---> Check for valid Patient.
"RTN","BIPATE",95,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BIPATE",96,0)
 I '$D(^AUPNPAT(BIDFN,0)) D ERRCD^BIUTL2(203,.BIERR) Q
"RTN","BIPATE",97,0)
 ;---> Check for valid Site.
"RTN","BIPATE",98,0)
 S:'$G(BISITE) BISITE=$G(DUZ(2))
"RTN","BIPATE",99,0)
 I '$G(BISITE) D ERRCD^BIUTL2(105,.BIERR) Q
"RTN","BIPATE",100,0)
 ;
"RTN","BIPATE",101,0)
 N BINACTR S BINACTR=""
"RTN","BIPATE",102,0)
 D
"RTN","BIPATE",103,0)
 .;---> Forced Inactive by passing Inactive Date.
"RTN","BIPATE",104,0)
 .I $G(BINACT) S BINACTR="n" Q
"RTN","BIPATE",105,0)
 .;---> Under 36 mths and in GPRA, this patient will be Active.
"RTN","BIPATE",106,0)
 .;I $$AGE^BIUTL1(BIDFN,2)<36,$$ISGPRA^BIUTL11(BIDFN,BISITE) Q
"RTN","BIPATE",107,0)
 .N BIAGE S BIAGE=$$AGE^BIUTL1(BIDFN,2)
"RTN","BIPATE",108,0)
 .;---> Request by Amy Groom:
"RTN","BIPATE",109,0)
 .;---> If under 36 mths and patient has NO Cur Community, add as Active.
"RTN","BIPATE",110,0)
 .I BIAGE<36,'$$CURCOM^BIUTL11(BIDFN) Q
"RTN","BIPATE",111,0)
 .I BIAGE<36,$$ISGPRA^BIUTL11(BIDFN,BISITE) Q
"RTN","BIPATE",112,0)
 .;---> Older than 36 mths or not in GPRA, this patient will be Inactive
"RTN","BIPATE",113,0)
 .;---> as of today with a Reason of "Never Activated."
"RTN","BIPATE",114,0)
 .S BINACT=$G(DT),BINACTR="n"
"RTN","BIPATE",115,0)
 ;
"RTN","BIPATE",116,0)
 D ADDPAT(BIDFN,BISITE,.BIERR,$G(BINACT),BINACTR,1)
"RTN","BIPATE",117,0)
 Q
"RTN","BIPATE",118,0)
 ;
"RTN","BIPATE",119,0)
 ;
"RTN","BIPATE",120,0)
 ;----------
"RTN","BIPATE",121,0)
ADDPAT(BIDFN,BISITE,BIERR,BINACT,BINACTR,BIAUTO) ;PEP  Add a Patient to Imm DB
"RTN","BIPATE",122,0)
 ;---> Add new Patient to Immunization Database (BI PATIENT File).
"RTN","BIPATE",123,0)
 ;---> Sets Case Manger to Site Parameter default.
"RTN","BIPATE",124,0)
 ;---> Also records User and date first entered.
"RTN","BIPATE",125,0)
 ;---> Called by AGZIMM at ANMC to add newborns from RPMS Registration.
"RTN","BIPATE",126,0)
 ;---> Parameters:
"RTN","BIPATE",127,0)
 ;     1 - BIDFN   (req)   Patient's IEN in VA PATIENT File #2.
"RTN","BIPATE",128,0)
 ;     2 - BISITE  (req)   DUZ(2) for default Case Manager.
"RTN","BIPATE",129,0)
 ;     3 - BIERR   (ret)   Error text, if any.
"RTN","BIPATE",130,0)
 ;     4 - BINACT  (opt)   Fileman internal date Patient became Inactive.
"RTN","BIPATE",131,0)
 ;     5 - BINACTR (opt)   Internal code for Inactive Reason:
"RTN","BIPATE",132,0)
 ;                            m:Moved Elsewhere, t:Treatment Elsewhere, d:Deceased
"RTN","BIPATE",133,0)
 ;                            p:Previously Inactivated, n:Never Activated
"RTN","BIPATE",134,0)
 ;     6 - BIAUTO  (opt)   If BIAUTO=1, set Field# .22="Automatically" added.
"RTN","BIPATE",135,0)
 ;
"RTN","BIPATE",136,0)
 ;     Example: D AUTOADD^BIPATE(BIDFN,1665,.X,DT,"n")
"RTN","BIPATE",137,0)
 ;
"RTN","BIPATE",138,0)
 ;---> If BIDFN not provided, return error and quit.
"RTN","BIPATE",139,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BIPATE",140,0)
 ;
"RTN","BIPATE",141,0)
 ;---> If Patient is already in the Imm Database, return error and quit.
"RTN","BIPATE",142,0)
 I $D(^BIP(BIDFN,0)) D ERRCD^BIUTL2(218,.BIERR) Q
"RTN","BIPATE",143,0)
 ;
"RTN","BIPATE",144,0)
 ;---> If no Site IEN was passed, try to get it from local symbol table.
"RTN","BIPATE",145,0)
 S:'$G(BISITE) BISITE=$G(DUZ(2))
"RTN","BIPATE",146,0)
 ;---> If BISITE not provided, return error and quit.
"RTN","BIPATE",147,0)
 I '$G(BISITE) D ERRCD^BIUTL2(105,.BIERR) Q
"RTN","BIPATE",148,0)
 ;
"RTN","BIPATE",149,0)
 ;---> If Default Case Manager is INACTIVE, return error and quit.
"RTN","BIPATE",150,0)
 N BICMGR S BICMGR=$$CMGRDEF^BIUTL2(BISITE)
"RTN","BIPATE",151,0)
 I BICMGR,$$CMGRACT^BIUTL2(BICMGR) D ERRCD^BIUTL2(214,.BIERR) Q
"RTN","BIPATE",152,0)
 ;
"RTN","BIPATE",153,0)
 ;---> Trim time from BINACT (seed if necessary).
"RTN","BIPATE",154,0)
 S BINACT=$P($G(BINACT),".") S:BINACT<2000000 BINACT=""
"RTN","BIPATE",155,0)
 ;
"RTN","BIPATE",156,0)
 ;---> Check/set Inactive reason.
"RTN","BIPATE",157,0)
 S:"mtdpn"'[$E($G(BINACTR)) BINACTR=""
"RTN","BIPATE",158,0)
 S:'BINACT BINACTR=""
"RTN","BIPATE",159,0)
 ;
"RTN","BIPATE",160,0)
 N BIERR,BIFLD,BIIEN
"RTN","BIPATE",161,0)
 S BIIEN(1)=BIDFN
"RTN","BIPATE",162,0)
 S BIFLD(.01)=BIDFN
"RTN","BIPATE",163,0)
 S BIFLD(.08)=BINACT
"RTN","BIPATE",164,0)
 S BIFLD(.1)=BICMGR
"RTN","BIPATE",165,0)
 S BIFLD(.16)=BINACTR
"RTN","BIPATE",166,0)
 S BIFLD(.2)=$G(DUZ)
"RTN","BIPATE",167,0)
 S BIFLD(.21)=$G(DT)
"RTN","BIPATE",168,0)
 S BIFLD(.22)=$S($G(BIAUTO):1,1:"")
"RTN","BIPATE",169,0)
 D UPDATE^BIFMAN(9002084,.BIIEN,.BIFLD,.BIERR)
"RTN","BIPATE",170,0)
 I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BIPATE",171,0)
 Q
"RTN","BIPATER")
0^71^B46255846
"RTN","BIPATER",1,0)
BIPATER ;IHS/CMI/MWR - VIEW/EDIT PATIENT ERRORS ; MAY 10, 2010
"RTN","BIPATER",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATER",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATER",4,0)
 ;;  EDIT/CORRECT PATIENT ERRORS.
"RTN","BIPATER",5,0)
 ;
"RTN","BIPATER",6,0)
 ;
"RTN","BIPATER",7,0)
 ;----------
"RTN","BIPATER",8,0)
START ;EP
"RTN","BIPATER",9,0)
 ;---> Loop through Patient Errors, view/edit/correct.
"RTN","BIPATER",10,0)
 D SETVARS^BIUTL5 K ^TMP("BIPTER",$J) N BITMP
"RTN","BIPATER",11,0)
 ;
"RTN","BIPATER",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIPATER",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIPATER",14,0)
 ;
"RTN","BIPATER",15,0)
 D TITLE^BIUTL5("VIEW/EDIT PATIENT ERRORS"),TEXT1
"RTN","BIPATER",16,0)
 N BIACT,DIR
"RTN","BIPATER",17,0)
 S DIR("A")="     Enter ALL or ONLY ACTIVE: ",DIR("B")="ALL"
"RTN","BIPATER",18,0)
 S DIR(0)="SAM^0:ALL;1:ONLY ACTIVE"
"RTN","BIPATER",19,0)
 D ^DIR K DIR
"RTN","BIPATER",20,0)
 Q:($D(DIRUT)!(Y=-1))
"RTN","BIPATER",21,0)
 S BIACT=+Y
"RTN","BIPATER",22,0)
 W !!?5,"Please hold...",!
"RTN","BIPATER",23,0)
 ;
"RTN","BIPATER",24,0)
 D EN(BIACT)
"RTN","BIPATER",25,0)
 D EXIT
"RTN","BIPATER",26,0)
 Q
"RTN","BIPATER",27,0)
 ;
"RTN","BIPATER",28,0)
 ;
"RTN","BIPATER",29,0)
 ;----------
"RTN","BIPATER",30,0)
EN(BIACT) ;EP
"RTN","BIPATER",31,0)
 ;---> Call Listman to View/Edit Patient Errors.
"RTN","BIPATER",32,0)
 ;---> Parameters:
"RTN","BIPATER",33,0)
 ;     1 - BIACT (opt) 0=ALL PATIENTS, 1=ONLY ACTIVE.
"RTN","BIPATER",34,0)
 ;
"RTN","BIPATER",35,0)
 N BIT
"RTN","BIPATER",36,0)
 D EN^VALM("BI PATIENT ERRORS EDIT")
"RTN","BIPATER",37,0)
 Q
"RTN","BIPATER",38,0)
 ;
"RTN","BIPATER",39,0)
 ;
"RTN","BIPATER",40,0)
 ;----------
"RTN","BIPATER",41,0)
PRINT ;EP
"RTN","BIPATER",42,0)
 ;---> Print Vaccine Table.
"RTN","BIPATER",43,0)
 ;---> Called by Protocol BI VACCINE TABLE PRINT, which is the
"RTN","BIPATER",44,0)
 ;---> Print List Protocol for the List: BI VACCINE TABLE EDIT.
"RTN","BIPATER",45,0)
 ;
"RTN","BIPATER",46,0)
 D DEVICE(.BIPOP)
"RTN","BIPATER",47,0)
 I $G(BIPOP) D RESET Q
"RTN","BIPATER",48,0)
 ;
"RTN","BIPATER",49,0)
 D INIT^BIPATER1(.BIT,$G(BIACT)),HDR(1)
"RTN","BIPATER",50,0)
 D PRTLST^BIUTL8("BIPTER")
"RTN","BIPATER",51,0)
 D RESET
"RTN","BIPATER",52,0)
 Q
"RTN","BIPATER",53,0)
 ;
"RTN","BIPATER",54,0)
 ;
"RTN","BIPATER",55,0)
 ;----------
"RTN","BIPATER",56,0)
HDR(BIPRT) ;EP
"RTN","BIPATER",57,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BIPATER",58,0)
 ;---> Parameters:
"RTN","BIPATER",59,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Change column
"RTN","BIPATER",60,0)
 ;                      header line and add Site Header line.
"RTN","BIPATER",61,0)
 ;
"RTN","BIPATER",62,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BIPATER",63,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIPATER",64,0)
 ;
"RTN","BIPATER",65,0)
 D:'$G(BIPRT) WH^BIW(.BILINE)
"RTN","BIPATER",66,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIPATER",67,0)
 D WH^BIW(.BILINE,X)
"RTN","BIPATER",68,0)
 ;S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIPATER",69,0)
 S X=$$SP^BIUTL5(32,"-") D CENTERT^BIUTL5(.X)
"RTN","BIPATER",70,0)
 D WH^BIW(.BILINE,X)
"RTN","BIPATER",71,0)
 ;
"RTN","BIPATER",72,0)
 S X=$S($G(BIACT):"ACTIVE",1:"ALL")_" PATIENT ERRORS (Total: "
"RTN","BIPATER",73,0)
 S X=X_$G(BIT)_")"
"RTN","BIPATER",74,0)
 D CENTERT^BIUTL5(.X)
"RTN","BIPATER",75,0)
 S:BICRT X=IOINHI_X_IOINORM
"RTN","BIPATER",76,0)
 D WH^BIW(.BILINE,X)
"RTN","BIPATER",77,0)
 ;
"RTN","BIPATER",78,0)
 D:$G(BIPRT)
"RTN","BIPATER",79,0)
 .D WH^BIW(.BILINE)
"RTN","BIPATER",80,0)
 .S X="Printed: "_$$NOW^BIUTL5() D CENTERT^BIUTL5(.X)
"RTN","BIPATER",81,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BIPATER",82,0)
 .S X="   #  Patient               Active   HRCN#     Age   V Grp"
"RTN","BIPATER",83,0)
 .S X=X_"  Error"
"RTN","BIPATER",84,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIPATER",85,0)
 Q
"RTN","BIPATER",86,0)
 ;
"RTN","BIPATER",87,0)
 ;
"RTN","BIPATER",88,0)
 ;----------
"RTN","BIPATER",89,0)
INIT ;EP
"RTN","BIPATER",90,0)
 ;---> Initialize variables and list array.
"RTN","BIPATER",91,0)
 ;---> Variables:
"RTN","BIPATER",92,0)
 ;     1 - BIT   (ret) Total Patient Errors.
"RTN","BIPATER",93,0)
 ;     2 - BIACT (opt) 0=ALL PATIENTS, 1=ONLY ACTIVE.
"RTN","BIPATER",94,0)
 ;
"RTN","BIPATER",95,0)
 D INIT^BIPATER1(.BIT,$G(BIACT))
"RTN","BIPATER",96,0)
 Q
"RTN","BIPATER",97,0)
 ;
"RTN","BIPATER",98,0)
 ;
"RTN","BIPATER",99,0)
 ;----------
"RTN","BIPATER",100,0)
RESET ;EP
"RTN","BIPATER",101,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIPATER",102,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATER",103,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATER",104,0)
 D INIT,HDR() Q
"RTN","BIPATER",105,0)
 ;
"RTN","BIPATER",106,0)
 ;
"RTN","BIPATER",107,0)
 ;----------
"RTN","BIPATER",108,0)
DEVICE(BIPOP) ;EP
"RTN","BIPATER",109,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIPATER",110,0)
 ;---> Parameters:
"RTN","BIPATER",111,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIPATER",112,0)
 ;
"RTN","BIPATER",113,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIPATER",114,0)
 S ZTRTN="DEQUEUE^BIPATER"
"RTN","BIPATER",115,0)
 D ZSAVES^BIUTL3
"RTN","BIPATER",116,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIPATER",117,0)
 Q
"RTN","BIPATER",118,0)
 ;
"RTN","BIPATER",119,0)
 ;
"RTN","BIPATER",120,0)
 ;----------
"RTN","BIPATER",121,0)
DEQUEUE ;EP
"RTN","BIPATER",122,0)
 ;---> Print Patient Data screen.
"RTN","BIPATER",123,0)
 N BIT
"RTN","BIPATER",124,0)
 D INIT^BIPATER1(.BIT,$G(BIACT)),HDR(1)
"RTN","BIPATER",125,0)
 D PRTLST^BIUTL8("BIPTER"),EXIT
"RTN","BIPATER",126,0)
 Q
"RTN","BIPATER",127,0)
 ;
"RTN","BIPATER",128,0)
 ;
"RTN","BIPATER",129,0)
 ;----------
"RTN","BIPATER",130,0)
HELP ;EP
"RTN","BIPATER",131,0)
 ;---> Help code.
"RTN","BIPATER",132,0)
 N BIX S BIX=X
"RTN","BIPATER",133,0)
 D FULL^VALM1 N BIPOP
"RTN","BIPATER",134,0)
 D TITLE^BIUTL5("EDIT PATIENT ERRORS - HELP, page 1 of 2")
"RTN","BIPATER",135,0)
 D TEXT2,DIRZ^BIUTL3(.BIPOP)
"RTN","BIPATER",136,0)
 I $G(BIPOP) D RE^VALM4 Q
"RTN","BIPATER",137,0)
 D TITLE^BIUTL5("EDIT PATIENT ERRORS - HELP, page 2 of 2")
"RTN","BIPATER",138,0)
 D TEXT3,DIRZ^BIUTL3()
"RTN","BIPATER",139,0)
 D:BIX'="??" RE^VALM4
"RTN","BIPATER",140,0)
 Q
"RTN","BIPATER",141,0)
 ;
"RTN","BIPATER",142,0)
 ;
"RTN","BIPATER",143,0)
 ;----------
"RTN","BIPATER",144,0)
TEXT1 ;EP
"RTN","BIPATER",145,0)
 ;;In the View/Edit Patient Errors screen you may display either
"RTN","BIPATER",146,0)
 ;;ALL Patients with errors or only those Patients with errors who
"RTN","BIPATER",147,0)
 ;;have a Status of ACTIVE.
"RTN","BIPATER",148,0)
 ;;
"RTN","BIPATER",149,0)
 ;;Enter ALL to include ALL Patients, or enter ONLY ACTIVE to select
"RTN","BIPATER",150,0)
 ;;only Active Patients.
"RTN","BIPATER",151,0)
 ;;
"RTN","BIPATER",152,0)
 ;
"RTN","BIPATER",153,0)
 D PRINTX("TEXT1")
"RTN","BIPATER",154,0)
 Q
"RTN","BIPATER",155,0)
 ;
"RTN","BIPATER",156,0)
 ;
"RTN","BIPATER",157,0)
 ;----------
"RTN","BIPATER",158,0)
TEXT2 ;EP
"RTN","BIPATER",159,0)
 ;;This screen displays patients who whose Immunization Histories
"RTN","BIPATER",160,0)
 ;;contain errors, according to the Immserve Forecasting Utility, and
"RTN","BIPATER",161,0)
 ;;provides you with the ability to correct or delete those errors.
"RTN","BIPATER",162,0)
 ;;
"RTN","BIPATER",163,0)
 ;;The columns, from left to right, list:
"RTN","BIPATER",164,0)
 ;; 1) Patient Name
"RTN","BIPATER",165,0)
 ;; 2) Active/Inactive Status (A=Active, I=Inactive, N=Not In Register)
"RTN","BIPATER",166,0)
 ;; 3) HRCN# (Health Record Number or Chart#)
"RTN","BIPATER",167,0)
 ;; 4) Age (y=years, m=months, d=days)
"RTN","BIPATER",168,0)
 ;; 5) Vaccine Group in which the error is occurring
"RTN","BIPATER",169,0)
 ;; 6) An abbreviated statement of what the error is
"RTN","BIPATER",170,0)
 ;;
"RTN","BIPATER",171,0)
 ;;The three actions at the bottom of the screen allow you to make
"RTN","BIPATER",172,0)
 ;;corrections to patient errors on the list or to delete them,
"RTN","BIPATER",173,0)
 ;;either individually or all at once.
"RTN","BIPATER",174,0)
 ;
"RTN","BIPATER",175,0)
 D PRINTX("TEXT2")
"RTN","BIPATER",176,0)
 Q
"RTN","BIPATER",177,0)
 ;
"RTN","BIPATER",178,0)
 ;
"RTN","BIPATER",179,0)
 ;----------
"RTN","BIPATER",180,0)
TEXT3 ;EP
"RTN","BIPATER",181,0)
 ;;Please note that EACH TIME a patient's forecast is computed (whether
"RTN","BIPATER",182,0)
 ;;individually or during the processing of a report), any errors found
"RTN","BIPATER",183,0)
 ;;in the patient's history will be stored in the Patient Errors File,
"RTN","BIPATER",184,0)
 ;;which is displayed here.
"RTN","BIPATER",185,0)
 ;;
"RTN","BIPATER",186,0)
 ;;Therefore, if you simply delete a patient error (rather than correct
"RTN","BIPATER",187,0)
 ;;it), the error will be placed in the Patient Errors File again the
"RTN","BIPATER",188,0)
 ;;next time the patient is is viewed or included in a report.
"RTN","BIPATER",189,0)
 ;;
"RTN","BIPATER",190,0)
 ;;There may be some cases in which the error cannot be corrected.
"RTN","BIPATER",191,0)
 ;;In these cases the Patient History reflects a situation that in fact
"RTN","BIPATER",192,0)
 ;;occurred and cannot be "edited".  If these are old cases that are
"RTN","BIPATER",193,0)
 ;;rarely called up, then simply deleting them from the Error File is
"RTN","BIPATER",194,0)
 ;;probably the best action to take.
"RTN","BIPATER",195,0)
 ;;
"RTN","BIPATER",196,0)
 ;
"RTN","BIPATER",197,0)
 D PRINTX("TEXT3")
"RTN","BIPATER",198,0)
 Q
"RTN","BIPATER",199,0)
 ;
"RTN","BIPATER",200,0)
 ;
"RTN","BIPATER",201,0)
 ;----------
"RTN","BIPATER",202,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIPATER",203,0)
 Q:$G(BILINL)=""
"RTN","BIPATER",204,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPATER",205,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIPATER",206,0)
 Q
"RTN","BIPATER",207,0)
 ;
"RTN","BIPATER",208,0)
 ;
"RTN","BIPATER",209,0)
 ;----------
"RTN","BIPATER",210,0)
EXIT ;EP
"RTN","BIPATER",211,0)
 ;---> EOJ cleanup.
"RTN","BIPATER",212,0)
 D KILLALL^BIUTL8()
"RTN","BIPATER",213,0)
 K ^TMP("BIPTER",$J),^TMP("BIPTER1",$J),^TMP("BIPTER2",$J)
"RTN","BIPATER",214,0)
 D CLEAR^VALM1
"RTN","BIPATER",215,0)
 D FULL^VALM1
"RTN","BIPATER",216,0)
 Q
"RTN","BIPATER1")
0^72^B19834029
"RTN","BIPATER1",1,0)
BIPATER1 ;IHS/CMI/MWR - EDIT PATIENT ERRORS.; MAY 10, 2010
"RTN","BIPATER1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATER1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATER1",4,0)
 ;;  EDIT/DELETE PATIENT ERRORS.
"RTN","BIPATER1",5,0)
 ;
"RTN","BIPATER1",6,0)
 ;
"RTN","BIPATER1",7,0)
 ;----------
"RTN","BIPATER1",8,0)
INIT(BIT,BIACT) ;EP
"RTN","BIPATER1",9,0)
 ;---> Initialize variables and list array.
"RTN","BIPATER1",10,0)
 ;---> Parameters:
"RTN","BIPATER1",11,0)
 ;     1 - BIT   (ret) Total Patient Errors.
"RTN","BIPATER1",12,0)
 ;     2 - BIACT (opt) BIACT=1 include ONLY ACTIVE Patients;
"RTN","BIPATER1",13,0)
 ;                     BIACT=""/0 include ALL PATIENTS.
"RTN","BIPATER1",14,0)
 ;
"RTN","BIPATER1",15,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BIPATER1",16,0)
 S VALM("TITLE")=" (Immunization v"_$$VER^BILOGO_")"
"RTN","BIPATER1",17,0)
 ;
"RTN","BIPATER1",18,0)
 ;---> Order Patient Errors and get Total Patients for Header.
"RTN","BIPATER1",19,0)
 K ^TMP("BIPTER",$J),^TMP("BIPTER1",$J),^TMP("BIPTER2",$J)
"RTN","BIPATER1",20,0)
 ;
"RTN","BIPATER1",21,0)
 ;---> First, order the errors by DOB,Patient Name.
"RTN","BIPATER1",22,0)
 N BIIEN S BIIEN=0
"RTN","BIPATER1",23,0)
 F  S BIIEN=$O(^BIPERR(BIIEN)) Q:'BIIEN  D
"RTN","BIPATER1",24,0)
 .N BIDFN,BIDOB,BINAME
"RTN","BIPATER1",25,0)
 .S BIDFN=$P(^BIPERR(BIIEN,0),U)
"RTN","BIPATER1",26,0)
 .;
"RTN","BIPATER1",27,0)
 .;---> Quit if report is ACTIVE ONLY and this patient is not Active.
"RTN","BIPATER1",28,0)
 .I $G(BIACT) Q:$$ACTIVE^BIUTL1(BIDFN)'="Active"
"RTN","BIPATER1",29,0)
 .;
"RTN","BIPATER1",30,0)
 .S BIDOB=9999999-$$DOB^BIUTL1(BIDFN),BINAME=$$NAME^BIUTL1(BIDFN)
"RTN","BIPATER1",31,0)
 .;---> If there's a bogus patient error, delete the error and quit.
"RTN","BIPATER1",32,0)
 .I ('BIDFN)!(BINAME="") D  Q
"RTN","BIPATER1",33,0)
 ..N DA,DIK S DA=BIIEN,DIK="^BIPERR(" D ^DIK
"RTN","BIPATER1",34,0)
 .;---> Store in order.
"RTN","BIPATER1",35,0)
 .S ^TMP("BIPTER1",$J,BIDOB,BINAME,BIIEN)=^BIPERR(BIIEN,0)
"RTN","BIPATER1",36,0)
 .S BIT=$G(BIT)+1
"RTN","BIPATER1",37,0)
 ;
"RTN","BIPATER1",38,0)
 ;---> Now place Patient Error lines in Listmanager array.
"RTN","BIPATER1",39,0)
 N BIENT,BILINE,BIN
"RTN","BIPATER1",40,0)
 S (BIENT,BILINE,BIN,BIT)=0
"RTN","BIPATER1",41,0)
 F  S BIN=$O(^TMP("BIPTER1",$J,BIN)) Q:'BIN  D
"RTN","BIPATER1",42,0)
 .N BIM S BIM=0
"RTN","BIPATER1",43,0)
 .F  S BIM=$O(^TMP("BIPTER1",$J,BIN,BIM)) Q:BIM=""  D
"RTN","BIPATER1",44,0)
 ..N BIIEN S BIIEN=0
"RTN","BIPATER1",45,0)
 ..F  S BIIEN=$O(^TMP("BIPTER1",$J,BIN,BIM,BIIEN)) Q:'BIIEN  D
"RTN","BIPATER1",46,0)
 ...N BI0 S BI0=^TMP("BIPTER1",$J,BIN,BIM,BIIEN)
"RTN","BIPATER1",47,0)
 ...N BIDFN S BIDFN=$P(BI0,U)
"RTN","BIPATER1",48,0)
 ...;
"RTN","BIPATER1",49,0)
 ...;---> Set Item# and build Item# array=IEN of Vaccine.
"RTN","BIPATER1",50,0)
 ...S BIENT=BIENT+1,^TMP("BIPTER2",$J,BIENT)=BIIEN
"RTN","BIPATER1",51,0)
 ...;
"RTN","BIPATER1",52,0)
 ...;---> Item#.
"RTN","BIPATER1",53,0)
 ...S X=" "_$S(BIENT<10:"  "_BIENT,BIENT<100:" "_BIENT,1:BIENT)
"RTN","BIPATER1",54,0)
 ...;
"RTN","BIPATER1",55,0)
 ...;---> Patient Name.
"RTN","BIPATER1",56,0)
 ...S X=X_"  "_$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATER1",57,0)
 ...S X=$$PAD^BIUTL5(X,33,".")
"RTN","BIPATER1",58,0)
 ...;
"RTN","BIPATER1",59,0)
 ...;---> Active Status.
"RTN","BIPATER1",60,0)
 ...S X=X_$E($$ACTIVE^BIUTL1(BIDFN))_"  "
"RTN","BIPATER1",61,0)
 ...;
"RTN","BIPATER1",62,0)
 ...;---> Chart#.
"RTN","BIPATER1",63,0)
 ...S X=X_$J($$HRCN^BIUTL1(BIDFN,$G(DUZ(2))),6)
"RTN","BIPATER1",64,0)
 ...S X=$$PAD^BIUTL5(X,47," ")
"RTN","BIPATER1",65,0)
 ...;
"RTN","BIPATER1",66,0)
 ...;---> Age.
"RTN","BIPATER1",67,0)
 ...N Y S Y=$$AGEF^BIUTL1(BIDFN)
"RTN","BIPATER1",68,0)
 ...S Y=$P(Y," ")_$E($P(Y," ",2)) S:+Y<10 Y=" "_Y
"RTN","BIPATER1",69,0)
 ...S X=X_Y
"RTN","BIPATER1",70,0)
 ...;
"RTN","BIPATER1",71,0)
 ...;---> Vaccine Group.
"RTN","BIPATER1",72,0)
 ...S X=$$PAD^BIUTL5(X,53," ")
"RTN","BIPATER1",73,0)
 ...S X=X_$P(BI0,U,3)
"RTN","BIPATER1",74,0)
 ...;
"RTN","BIPATER1",75,0)
 ...;---> Error Text.
"RTN","BIPATER1",76,0)
 ...S X=$$PAD^BIUTL5(X,60," ")
"RTN","BIPATER1",77,0)
 ...D ERRCD^BIUTL2($P(BI0,U,2),.Y,,1)
"RTN","BIPATER1",78,0)
 ...S X=X_Y
"RTN","BIPATER1",79,0)
 ...;
"RTN","BIPATER1",80,0)
 ...;---> Set this Patient Error display row and index in ^TMP.
"RTN","BIPATER1",81,0)
 ...D WRITE(.BILINE,X,,BIENT)
"RTN","BIPATER1",82,0)
 ...S BIT=$G(BIT)+1
"RTN","BIPATER1",83,0)
 ;
"RTN","BIPATER1",84,0)
 I BILINE=0 D
"RTN","BIPATER1",85,0)
 .N X S X="   Currently there are no Patient Errors stored"
"RTN","BIPATER1",86,0)
 .S:$G(BIACT) X=X_" for ACTIVE Patients"  S X=X_"."
"RTN","BIPATER1",87,0)
 .D WRITE(.BILINE),WRITE(.BILINE,X)
"RTN","BIPATER1",88,0)
 ;
"RTN","BIPATER1",89,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIPATER1",90,0)
 S VALMCNT=BILINE
"RTN","BIPATER1",91,0)
 I VALMCNT>13 D
"RTN","BIPATER1",92,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIPATER1",93,0)
 Q
"RTN","BIPATER1",94,0)
 ;
"RTN","BIPATER1",95,0)
 ;
"RTN","BIPATER1",96,0)
 ;----------
"RTN","BIPATER1",97,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIPATER1",98,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIPATER1",99,0)
 ;---> Parameters:
"RTN","BIPATER1",100,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIPATER1",101,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIPATER1",102,0)
 ;
"RTN","BIPATER1",103,0)
 Q:'$D(BILINE)
"RTN","BIPATER1",104,0)
 D WL^BIW(.BILINE,"BIPTER",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BIPATER1",105,0)
 Q
"RTN","BIPATER1",106,0)
 ;
"RTN","BIPATER1",107,0)
 ;
"RTN","BIPATER1",108,0)
 ;----------
"RTN","BIPATER1",109,0)
EDITDEL(BIX) ;EP
"RTN","BIPATER1",110,0)
 ;---> Edit/Delete a Patient Error.
"RTN","BIPATER1",111,0)
 ;---> Parameters:
"RTN","BIPATER1",112,0)
 ;     1 - BIX  (opt) If BIX="" call Edit, if BIX=1 call Delete.
"RTN","BIPATER1",113,0)
 ;
"RTN","BIPATER1",114,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BIPATER1",115,0)
 N VALMY
"RTN","BIPATER1",116,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATER1",117,0)
 ;
"RTN","BIPATER1",118,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIPATER1",119,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET^BIPATER Q
"RTN","BIPATER1",120,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BIPATER1",121,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATER1",122,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET^BIPATER Q
"RTN","BIPATER1",123,0)
 ;
"RTN","BIPATER1",124,0)
 N BIIEN S BIIEN=$G(^TMP("BIPTER2",$J,Y))
"RTN","BIPATER1",125,0)
 I 'BIIEN D ERRCD^BIUTL2(661,,1) D RESET^BIPATER Q
"RTN","BIPATER1",126,0)
 ;
"RTN","BIPATER1",127,0)
 ;---> If this is a call to DELETE an error, delete it and quit.
"RTN","BIPATER1",128,0)
 I $G(BIX) D  Q
"RTN","BIPATER1",129,0)
 .N DA,DIK S DA=BIIEN,DIK="^BIPERR("
"RTN","BIPATER1",130,0)
 .D ^DIK,RESET^BIPATER
"RTN","BIPATER1",131,0)
 ;
"RTN","BIPATER1",132,0)
 ;---> This must be a call to EDIT and error.
"RTN","BIPATER1",133,0)
 N BIDFN S BIDFN=$P($G(^BIPERR(BIIEN,0)),U)
"RTN","BIPATER1",134,0)
 I 'BIDFN D ERRCD^BIUTL2(216,,1) D RESET^BIPATER Q
"RTN","BIPATER1",135,0)
 ;
"RTN","BIPATER1",136,0)
 D
"RTN","BIPATER1",137,0)
 .N BIACT
"RTN","BIPATER1",138,0)
 .D HAVEPAT^BIPATVW(BIDFN,DT)
"RTN","BIPATER1",139,0)
 D RESET^BIPATER
"RTN","BIPATER1",140,0)
 Q
"RTN","BIPATER1",141,0)
 ;
"RTN","BIPATER1",142,0)
 ;
"RTN","BIPATER1",143,0)
 ;----------
"RTN","BIPATER1",144,0)
DELALL ;EP
"RTN","BIPATER1",145,0)
 ;---> Clear/Delete ALL Patient Errors.
"RTN","BIPATER1",146,0)
 ;
"RTN","BIPATER1",147,0)
 W !!?3,"Do you REALLY wish to delete ALL Patient Errors?"
"RTN","BIPATER1",148,0)
 S DIR("?")="     Enter YES to DELETE ALL Patient Errors."
"RTN","BIPATER1",149,0)
 S DIR(0)="Y",DIR("A")="   Enter Yes or No",DIR("B")="NO"
"RTN","BIPATER1",150,0)
 D ^DIR W !
"RTN","BIPATER1",151,0)
 I $D(DIRUT)!('Y) D  Q
"RTN","BIPATER1",152,0)
 .W !!?3,"No changes made." D DIRZ^BIUTL3()
"RTN","BIPATER1",153,0)
 ;
"RTN","BIPATER1",154,0)
 D ZGBL^BIUTL8("^BIPERR(")
"RTN","BIPATER1",155,0)
 D RESET^BIPATER
"RTN","BIPATER1",156,0)
 Q
"RTN","BIPATPF")
0^73^B14288700
"RTN","BIPATPF",1,0)
BIPATPF ;IHS/CMI/MWR - VIEW PATIENT PROFILE; MAY 10, 2010
"RTN","BIPATPF",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATPF",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATPF",4,0)
 ;;  DISPLAY PATIENT'S IMMUNIZATION IMM/SERVE PROFILE.
"RTN","BIPATPF",5,0)
 ;
"RTN","BIPATPF",6,0)
 ;
"RTN","BIPATPF",7,0)
 ;----------
"RTN","BIPATPF",8,0)
START ;EP
"RTN","BIPATPF",9,0)
 ;---> Lookup patients and display their Immunization Profiles.
"RTN","BIPATPF",10,0)
 ;---> NOT CALLED BY ANY MENU OPTION AT THIS TIME.
"RTN","BIPATPF",11,0)
 D SETVARS^BIUTL5 N BIDFN
"RTN","BIPATPF",12,0)
 F  D  Q:$G(BIDFN)<1
"RTN","BIPATPF",13,0)
 .D TITLE^BIUTL5("PATIENT IMMUNIZATION PROFILE")
"RTN","BIPATPF",14,0)
 .D PATLKUP^BIUTL8(.BIDFN)
"RTN","BIPATPF",15,0)
 .Q:$G(BIDFN)<1
"RTN","BIPATPF",16,0)
 .D EN(BIDFN)
"RTN","BIPATPF",17,0)
 D EXIT
"RTN","BIPATPF",18,0)
 Q
"RTN","BIPATPF",19,0)
 ;
"RTN","BIPATPF",20,0)
 ;
"RTN","BIPATPF",21,0)
 ;----------
"RTN","BIPATPF",22,0)
HAVEPAT(BIDFN,BIFDT,BIDUZ2) ;EP
"RTN","BIPATPF",23,0)
 ;---> Entry point when patient already known.
"RTN","BIPATPF",24,0)
 ;---> Parameters:
"RTN","BIPATPF",25,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATPF",26,0)
 ;     2 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIPATPF",27,0)
 ;     3 - BIDUZ2 (opt) User's DUZ(2) to indicate Immserve Forecasting
"RTN","BIPATPF",28,0)
 ;                      Rules in Patient History data string.
"RTN","BIPATPF",29,0)
 ;
"RTN","BIPATPF",30,0)
 ;---> Check for BIDFN.
"RTN","BIPATPF",31,0)
 Q:$$DFNCHECK^BIUTL2()
"RTN","BIPATPF",32,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIPATPF",33,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIPATPF",34,0)
 ;---> If no Site passed, set equal to user's site.
"RTN","BIPATPF",35,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATPF",36,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATPF",37,0)
 ;
"RTN","BIPATPF",38,0)
 D SETVARS^BIUTL5
"RTN","BIPATPF",39,0)
 K ^BITMP($J),^TMP("BILMPF",$J)
"RTN","BIPATPF",40,0)
 S ^BITMP($J,1,BIDFN)=""
"RTN","BIPATPF",41,0)
 D EN(BIDFN,BIFDT,BIDUZ2)
"RTN","BIPATPF",42,0)
 D EXIT
"RTN","BIPATPF",43,0)
 Q
"RTN","BIPATPF",44,0)
 ;
"RTN","BIPATPF",45,0)
 ;
"RTN","BIPATPF",46,0)
 ;----------
"RTN","BIPATPF",47,0)
EN(BIDFN,BIFDT,BIDUZ2) ;EP
"RTN","BIPATPF",48,0)
 ;---> Main entry point for BI PATIENT PROFILE VIEW.
"RTN","BIPATPF",49,0)
 I '$G(BIDFN) D EN^DDIOL("No Patient selected.") Q
"RTN","BIPATPF",50,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIPATPF",51,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATPF",52,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATPF",53,0)
 N DFN S DFN=BIDFN  ;For now with Linda's view reg templates.
"RTN","BIPATPF",54,0)
 D EN^VALM("BI PATIENT PROFILE VIEW")
"RTN","BIPATPF",55,0)
 Q
"RTN","BIPATPF",56,0)
 ;
"RTN","BIPATPF",57,0)
 ;
"RTN","BIPATPF",58,0)
 ;----------
"RTN","BIPATPF",59,0)
HDR ;EP
"RTN","BIPATPF",60,0)
 ; ZEXCEPT: BIDFN
"RTN","BIPATPF",61,0)
 ; ZEXCEPT: IOST,VALMHDR
"RTN","BIPATPF",62,0)
 ;---> Header code.
"RTN","BIPATPF",63,0)
 Q:'$D(BIDFN)
"RTN","BIPATPF",64,0)
 N BICRT,X,Y
"RTN","BIPATPF",65,0)
 S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIPATPF",66,0)
 S VALMHDR(1)=""
"RTN","BIPATPF",67,0)
 S Y=$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATPF",68,0)
 S X=" Patient: "
"RTN","BIPATPF",69,0)
 ; S:BICRT X=X_IORVON
"RTN","BIPATPF",70,0)
 S X=X_Y
"RTN","BIPATPF",71,0)
 ; S:BICRT X=X_IOINORM
"RTN","BIPATPF",72,0)
 S X=X_$$SP^BIUTL5(27-$L(Y))_"DOB: "
"RTN","BIPATPF",73,0)
 ; S:BICRT X=X_IORVON
"RTN","BIPATPF",74,0)
 S X=X_$$DOBF^BIUTL1(BIDFN)
"RTN","BIPATPF",75,0)
 ; S:BICRT X=X_IOINORM
"RTN","BIPATPF",76,0)
 S VALMHDR(2)=X
"RTN","BIPATPF",77,0)
 S X="  Chart#: "
"RTN","BIPATPF",78,0)
 ; S:BICRT X=X_IORVON
"RTN","BIPATPF",79,0)
 S X=X_$$HRCN^BIUTL1(BIDFN)
"RTN","BIPATPF",80,0)
 S Y=$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)
"RTN","BIPATPF",81,0)
 S X=X_" at "_Y
"RTN","BIPATPF",82,0)
 ; S:BICRT X=X_IOINORM
"RTN","BIPATPF",83,0)
 S X=X_$$SP^BIUTL5(20-$L(Y))_$$ACTIVE^BIUTL1(BIDFN)
"RTN","BIPATPF",84,0)
 S X=X_"     "_$$SEXW^BIUTL1(BIDFN)
"RTN","BIPATPF",85,0)
 S VALMHDR(3)=X
"RTN","BIPATPF",86,0)
 ;
"RTN","BIPATPF",87,0)
 Q
"RTN","BIPATPF",88,0)
 ;
"RTN","BIPATPF",89,0)
 ;
"RTN","BIPATPF",90,0)
 ;----------
"RTN","BIPATPF",91,0)
INIT ;EP
"RTN","BIPATPF",92,0)
 ; ZEXCEPT: BIDFN
"RTN","BIPATPF",93,0)
 ; ZEXCEPT: VALMCNT,VALMQUIT
"RTN","BIPATPF",94,0)
 ;---> Initialize variables and list array.
"RTN","BIPATPF",95,0)
 ;
"RTN","BIPATPF",96,0)
 ;---> If BIDFN not supplied, set Error Code and quit.
"RTN","BIPATPF",97,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) Q
"RTN","BIPATPF",98,0)
 ;
"RTN","BIPATPF",99,0)
 ;---> Initialize RPC variables.
"RTN","BIPATPF",100,0)
 ;     BI31     - Delimiter between return value and return error.
"RTN","BIPATPF",101,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BIPATPF",102,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BIPATPF",103,0)
 N BI30,BI31,BIRETVAL,BIRETERR
"RTN","BIPATPF",104,0)
 S BI30=$C(30),BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIPATPF",105,0)
 ;
"RTN","BIPATPF",106,0)
 ;---> RPC to gather Immunization History.
"RTN","BIPATPF",107,0)
 D IMMPROF^BIRPC(.BIRETVAL,BIDFN,$G(BIFDT),$G(BIDUZ2))
"RTN","BIPATPF",108,0)
 ;
"RTN","BIPATPF",109,0)
 ;---> Set BIGBL=to global where Immserve Profile is stored
"RTN","BIPATPF",110,0)
 ;---> (returned from RPC).
"RTN","BIPATPF",111,0)
 N BIGBL S BIGBL=$P($P(BIRETVAL,BI31,1),")")_","
"RTN","BIPATPF",112,0)
 ;---> BIGBL is ^BITEMP($J,"PROF",
"RTN","BIPATPF",113,0)
 ;
"RTN","BIPATPF",114,0)
 ;---> If error was returned in ^BITEMP($J,"PROF",1),
"RTN","BIPATPF",115,0)
 ;---> set BIRETERR=error text, display it and quit.
"RTN","BIPATPF",116,0)
 S BIRETERR=$P(@(BIGBL_1_")"),BI31,2)
"RTN","BIPATPF",117,0)
 I BIRETERR]"" D  Q
"RTN","BIPATPF",118,0)
 .D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3()
"RTN","BIPATPF",119,0)
 .S VALMQUIT=""
"RTN","BIPATPF",120,0)
 ;
"RTN","BIPATPF",121,0)
 ;---> Build Listmanager array from BIGBL global array.
"RTN","BIPATPF",122,0)
 K ^TMP("BILMPF",$J)
"RTN","BIPATPF",123,0)
 N BILINE,N S N=0
"RTN","BIPATPF",124,0)
 F  S N=$O(@(BIGBL_N_")")) Q:'N  D
"RTN","BIPATPF",125,0)
 .S ^TMP("BILMPF",$J,N,0)="   "_$P(@(BIGBL_N_")"),BI30)
"RTN","BIPATPF",126,0)
 .S BILINE=N
"RTN","BIPATPF",127,0)
 ;
"RTN","BIPATPF",128,0)
 ;---> Overwrite BI31 node and set final VALM line count.
"RTN","BIPATPF",129,0)
 S ^TMP("BILMPF",$J,BILINE,0)=" "
"RTN","BIPATPF",130,0)
 S VALMCNT=BILINE
"RTN","BIPATPF",131,0)
 Q
"RTN","BIPATPF",132,0)
 ;
"RTN","BIPATPF",133,0)
 ;
"RTN","BIPATPF",134,0)
 ;----------
"RTN","BIPATPF",135,0)
RESET ;EP
"RTN","BIPATPF",136,0)
 ; ZEXCEPT: VALMBCK,VALMQUIT
"RTN","BIPATPF",137,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIPATPF",138,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATPF",139,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATPF",140,0)
 D INIT,HDR Q
"RTN","BIPATPF",141,0)
 ;
"RTN","BIPATPF",142,0)
 ;
"RTN","BIPATPF",143,0)
 ;----------
"RTN","BIPATPF",144,0)
HELP ;EP
"RTN","BIPATPF",145,0)
 ; ZEXCEPT: X
"RTN","BIPATPF",146,0)
 ;---> Help code.
"RTN","BIPATPF",147,0)
 N BIX S BIX=X
"RTN","BIPATPF",148,0)
 D FULL^VALM1
"RTN","BIPATPF",149,0)
 W !!?5,"Use arrow keys to scroll up and down through the report, or"
"RTN","BIPATPF",150,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIPATPF",151,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIPATPF",152,0)
 D:BIX'="??" RE^VALM4
"RTN","BIPATPF",153,0)
 Q
"RTN","BIPATPF",154,0)
 ;
"RTN","BIPATPF",155,0)
 ;
"RTN","BIPATPF",156,0)
 ;----------
"RTN","BIPATPF",157,0)
EXIT ;EP
"RTN","BIPATPF",158,0)
 ;---> EOJ Cleanup.
"RTN","BIPATPF",159,0)
 K ^TMP("BILMPF",$J)
"RTN","BIPATPF",160,0)
 D CLEAR^VALM1
"RTN","BIPATPF",161,0)
 D FULL^VALM1
"RTN","BIPATPF",162,0)
 Q
"RTN","BIPATUP")
0^74^B24996927
"RTN","BIPATUP",1,0)
BIPATUP ;IHS/CMI/MWR - UPDATE PATIENT FORECAST;2015-07-17  12:06 PM
"RTN","BIPATUP",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIPATUP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATUP",4,0)
 ;;  UPDATE PATIENT FORECAST DATA, IMM PROFILE IN ^BIP(DFN,
"RTN","BIPATUP",5,0)
 ;;  AND IMM FORECAST IN ^BIPDUE(.
"RTN","BIPATUP",6,0)
 ;;  PATCH 8: Changes to accommodate new TCH Forecaster  UPDATE+81,+99, LDPROF+18, BIDE+6
"RTN","BIPATUP",7,0)
 ;;  PATCH 9: Insert patient name and DOB at top of Report Text (for EHR).  LDPROF+28
"RTN","BIPATUP",8,0)
 ;;           Add DUZ2 so that BIXTCH can retrieve IP address for TCH.
"RTN","BIPATUP",9,0)
 ;
"RTN","BIPATUP",10,0)
 ;
"RTN","BIPATUP",11,0)
 ;----------
"RTN","BIPATUP",12,0)
UPDATE(BIDFN,BIFDT,BIERR,BINOP,BIDUZ2,BIPDSS) ;EP
"RTN","BIPATUP",13,0)
 ;---> Update Patient Imms Due (in ^BIPDUE) using Immserve Utility.
"RTN","BIPATUP",14,0)
 ;---> Parameters:
"RTN","BIPATUP",15,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIPATUP",16,0)
 ;     2 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIPATUP",17,0)
 ;     3 - BIERR  (ret) String returning text of error code.
"RTN","BIPATUP",18,0)
 ;     4 - BINOP  (opt) If BINOP=1 do not retrieve Imm Profile.
"RTN","BIPATUP",19,0)
 ;     5 - BIDUZ2 (opt) User's DUZ(2) to indicate Immserve Forecasting
"RTN","BIPATUP",20,0)
 ;                      Rules in Patient History data string.
"RTN","BIPATUP",21,0)
 ;     6 - BIPDSS (ret) Returned string of Visit IEN's that are
"RTN","BIPATUP",22,0)
 ;                      Problem Doses, according to TCH.
"RTN","BIPATUP",23,0)
 ;
"RTN","BIPATUP",24,0)
 S BIERR=""
"RTN","BIPATUP",25,0)
 ;
"RTN","BIPATUP",26,0)
 ;---> If Vaccine global (^AUTTIMM) is not standard, set Error Text
"RTN","BIPATUP",27,0)
 ;---> in patient's Profile global, return Error Text and quit.
"RTN","BIPATUP",28,0)
 I $D(^BISITE(-1)) D  Q
"RTN","BIPATUP",29,0)
 .K ^BIP(BIDFN,1)
"RTN","BIPATUP",30,0)
 .D ERRCD^BIUTL2(503,.BIERR)
"RTN","BIPATUP",31,0)
 .S ^BIP(BIDFN,1,1,0)=BIERR
"RTN","BIPATUP",32,0)
 .S ^BIP(BIDFN,1,0)=U_U_1_U_1_U_DT
"RTN","BIPATUP",33,0)
 ;
"RTN","BIPATUP",34,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BIPATUP",35,0)
 ;
"RTN","BIPATUP",36,0)
 ;---> Return 1 if Forecasting is enabled.
"RTN","BIPATUP",37,0)
 ; I '$$FORECAS^BIUTL2(DUZ(2)) D ERRCD^BIUTL2(314,.BIERR) Q
"RTN","BIPATUP",38,0)
 ; ven/smh - not an error condition
"RTN","BIPATUP",39,0)
 I '$$FORECAS^BIUTL2(DUZ(2)) QUIT
"RTN","BIPATUP",40,0)
 ;
"RTN","BIPATUP",41,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIPATUP",42,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIPATUP",43,0)
 ;
"RTN","BIPATUP",44,0)
 ;---> If no BIDUZ2, try DUZ(2); otherwise, defaults will be used.
"RTN","BIPATUP",45,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATUP",46,0)
 ;
"RTN","BIPATUP",47,0)
 ;---> If BINOP not specified, retrieve and store Imm Profile.
"RTN","BIPATUP",48,0)
 S:'$G(BINOP) BINOP=0
"RTN","BIPATUP",49,0)
 ;
"RTN","BIPATUP",50,0)
 ;---> Quit if this patient is Locked (being edited by another user).
"RTN","BIPATUP",51,0)
 L +^BIP(BIDFN):0 I '$T D ERRCD^BIUTL2(212,.BIERR) Q
"RTN","BIPATUP",52,0)
 ;
"RTN","BIPATUP",53,0)
 ;---> Set required variables, kill ^BITMP($J).
"RTN","BIPATUP",54,0)
 D SETVARS^BIUTL5 K ^BITMP($J)
"RTN","BIPATUP",55,0)
 ;
"RTN","BIPATUP",56,0)
 ;---> Set the patient temp global.
"RTN","BIPATUP",57,0)
 S ^BITMP($J,1,BIDFN)=""
"RTN","BIPATUP",58,0)
 ;
"RTN","BIPATUP",59,0)
 ;---> Gather Immunization History for this patient (into ^BITMP) .
"RTN","BIPATUP",60,0)
 ;---> Parameters:
"RTN","BIPATUP",61,0)
 ;     1 - BIFMT  (req) Format: 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIPATUP",62,0)
 ;     2 - BIDE   (req) Data Elements array (null if HL7)
"RTN","BIPATUP",63,0)
 ;     3 - BIMM   (req) Array of Imms to be passed to forecasting.
"RTN","BIPATUP",64,0)
 ;     4 - BIFDT  (opt) Forecast Date (date used to calc Imms due).
"RTN","BIPATUP",65,0)
 ;     5 - BISKIN (opt) ""=Do not retrieve Skin Tests.
"RTN","BIPATUP",66,0)
 ;     6 - BIDUZ2 (opt) User's DUZ(2) to indicate Immserve Forecasting
"RTN","BIPATUP",67,0)
 ;                      Rules in Patient History data string.
"RTN","BIPATUP",68,0)
 ;     7 - BINF   (opt) Array of Vaccines that should not be forecast.
"RTN","BIPATUP",69,0)
 ;
"RTN","BIPATUP",70,0)
 ;
"RTN","BIPATUP",71,0)
 ;---> Build local array of Vaccines (by HL7 Code) that should not
"RTN","BIPATUP",72,0)
 ;---> be forecast, according to this machine's Immunization File.
"RTN","BIPATUP",73,0)
 N BINF D NOFORC(.BINF)
"RTN","BIPATUP",74,0)
 ;
"RTN","BIPATUP",75,0)
 N BIDE S BIDE="" D BIDE(.BIDE)
"RTN","BIPATUP",76,0)
 N BIMM S BIMM("ALL")=""
"RTN","BIPATUP",77,0)
 ;
"RTN","BIPATUP",78,0)
 ;---> Gather Patient Imm History in ^BITMP.
"RTN","BIPATUP",79,0)
 D HISTORY^BIEXPRT3(3,.BIDE,.BIMM,BIFDT,,BIDUZ2,.BINF)
"RTN","BIPATUP",80,0)
 ;
"RTN","BIPATUP",81,0)
 ;---> Retrieve data for this patient from ^BITMP, return in BIHX.
"RTN","BIPATUP",82,0)
 ;---> Parameters:
"RTN","BIPATUP",83,0)
 ;     1 - BIEXP    (req) Export: 0=screen, 1=host file, 2=string
"RTN","BIPATUP",84,0)
 ;     2 - BIFMT    (req) Format: 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIPATUP",85,0)
 ;     3 - BIFLNM   (opt) File name
"RTN","BIPATUP",86,0)
 ;     4 - BIPATH   (opt) BI Path name for host files
"RTN","BIPATUP",87,0)
 ;     5 - BIHX     (ret) Immunization History in "^"-delimited string
"RTN","BIPATUP",88,0)
 ;
"RTN","BIPATUP",89,0)
 N BIHX S BIHX=""
"RTN","BIPATUP",90,0)
 D WRITE^BIEXPRT4(2,3,,,.BIHX)
"RTN","BIPATUP",91,0)
 ;
"RTN","BIPATUP",92,0)
 ;---> Check for precise Date of Birth.
"RTN","BIPATUP",93,0)
 N X S X=$P(BIHX,U,8)
"RTN","BIPATUP",94,0)
 ;
"RTN","BIPATUP",95,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP",96,0)
 ;---> Change error check to accommodate new TCH date format.
"RTN","BIPATUP",97,0)
 ;I ('$E(X,1,2))!('$E(X,3,4))!('$E(X,5,8)) D ERRCD^BIUTL2(215,.BIERR) Q
"RTN","BIPATUP",98,0)
 I ('$E(X,1,4))!('$E(X,5,6))!('$E(X,7,8)) D ERRCD^BIUTL2(215,.BIERR) Q
"RTN","BIPATUP",99,0)
 ;**********
"RTN","BIPATUP",100,0)
 ;
"RTN","BIPATUP",101,0)
 ;
"RTN","BIPATUP",102,0)
 ;---> Use Immunization History (in BIHX) to obtain Immserve Forecast.
"RTN","BIPATUP",103,0)
 ;---> Parameters:
"RTN","BIPATUP",104,0)
 ;     1 - BIHX   (req) String contain Patient's Immunization History.
"RTN","BIPATUP",105,0)
 ;     2 - BIPROF (ret) String returning text version of profile.
"RTN","BIPATUP",106,0)
 ;     3 - BIFORC (ret) String returning data version of forecast.
"RTN","BIPATUP",107,0)
 ;     4 - BIERR  (ret) String returning text of error code.
"RTN","BIPATUP",108,0)
 ;
"RTN","BIPATUP",109,0)
 N BIPROF,BIFORC S (BIPROF,BIFORC)=""
"RTN","BIPATUP",110,0)
 ;
"RTN","BIPATUP",111,0)
 ;---> Call ImmServe and get Forecast and Profile.
"RTN","BIPATUP",112,0)
 ;
"RTN","BIPATUP",113,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP",114,0)
 ;---> Call new TCH Forecaster.
"RTN","BIPATUP",115,0)
 ;D RUN^BIXCALL(BIHX,.BIPROF,.BIFORC,.BIERR)
"RTN","BIPATUP",116,0)
 ;
"RTN","BIPATUP",117,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP",118,0)
 ;---> Add DUZ2 so that BIXTCH can retrieve IP address for TCH.
"RTN","BIPATUP",119,0)
 ;D RUN^BIXTCH(BIHX,.BIPROF,.BIFORC,.BIERR)
"RTN","BIPATUP",120,0)
 D RUN^BIXTCH(BIHX,BIDUZ2,.BIPROF,.BIFORC,.BIERR)
"RTN","BIPATUP",121,0)
 ;**********
"RTN","BIPATUP",122,0)
 ;
"RTN","BIPATUP",123,0)
 ;---> For diagnostic purposes.
"RTN","BIPATUP",124,0)
 ;D DISPLAY
"RTN","BIPATUP",125,0)
 ;
"RTN","BIPATUP",126,0)
 I BIERR]"" D UNLOCK(BIDFN) Q
"RTN","BIPATUP",127,0)
 ;
"RTN","BIPATUP",128,0)
 ;---> Load Forecast into BI PATIENT IMMUNIZATIONS DUE File (^BIPDUE).
"RTN","BIPATUP",129,0)
 ;---> Pass BIHX (history) and BIFDT to check for >65yrs need for Pneumo.
"RTN","BIPATUP",130,0)
 ;---> need for Influenza and Pneumo.
"RTN","BIPATUP",131,0)
 D LDFORC^BIPATUP1(BIDFN,BIFORC,BIHX,BIFDT,BIDUZ2,.BINF,.BIPDSS)
"RTN","BIPATUP",132,0)
 ;
"RTN","BIPATUP",133,0)
 ;---> Load Report Text into patient WP global (^BIP(DFN,1,).
"RTN","BIPATUP",134,0)
 D:'BINOP LDPROF(BIDFN,BIPROF,BIFDT)
"RTN","BIPATUP",135,0)
 ;
"RTN","BIPATUP",136,0)
 ;---> Unlock patient.
"RTN","BIPATUP",137,0)
 D UNLOCK(BIDFN)
"RTN","BIPATUP",138,0)
 Q
"RTN","BIPATUP",139,0)
 ;
"RTN","BIPATUP",140,0)
 ;
"RTN","BIPATUP",141,0)
 ;----------
"RTN","BIPATUP",142,0)
LDPROF(BIDFN,BIPROF,BIFDT,BIERR) ;EP
"RTN","BIPATUP",143,0)
 ;---> Entry point to load Immserve Profile into Patient's global.
"RTN","BIPATUP",144,0)
 ;---> Parameters:
"RTN","BIPATUP",145,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIPATUP",146,0)
 ;     2 - BIPROF (req) String containing text of Patient's Imm Profile.
"RTN","BIPATUP",147,0)
 ;     3 - BIFDT  (opt) Forecast Date
"RTN","BIPATUP",148,0)
 ;     3 - BIERR  (ret opt) String returning text of error code.
"RTN","BIPATUP",149,0)
 ;
"RTN","BIPATUP",150,0)
 S BIERR=""
"RTN","BIPATUP",151,0)
 ;
"RTN","BIPATUP",152,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BIPATUP",153,0)
 ;
"RTN","BIPATUP",154,0)
 ;---> Quit if Patient does not exist in Immunization Register.
"RTN","BIPATUP",155,0)
 I '$D(^BIP(BIDFN,0)) D ERRCD^BIUTL2(204,.BIERR) Q
"RTN","BIPATUP",156,0)
 ;
"RTN","BIPATUP",157,0)
 ;---> Load Report Text into Patient's WP Node.
"RTN","BIPATUP",158,0)
 D SETVARS^BIUTL5
"RTN","BIPATUP",159,0)
 K ^BIP(BIDFN,1)
"RTN","BIPATUP",160,0)
 ;
"RTN","BIPATUP",161,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP",162,0)
 ;---> Switch to $C(13,10)) to accommodate new TCH Report.
"RTN","BIPATUP",163,0)
 ;S X=$L(BIPROF,$C(13))
"RTN","BIPATUP",164,0)
 ;F I=1:1:X S ^BIP(BIDFN,1,I,0)=$P(BIPROF,$C(13),I)
"RTN","BIPATUP",165,0)
 ;N X S X=$L(BIPROF,$C(13,10))
"RTN","BIPATUP",166,0)
 ;F I=1:1:X S ^BIP(BIDFN,1,I,0)=$P(BIPROF,$C(13,10),I)
"RTN","BIPATUP",167,0)
 N X S X=$L(BIPROF,"|||")
"RTN","BIPATUP",168,0)
 ;
"RTN","BIPATUP",169,0)
 ;
"RTN","BIPATUP",170,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP",171,0)
 ;---> Insert patient name and DOB at top of Report Text (for EHR).
"RTN","BIPATUP",172,0)
 ;F I=1:1:X S ^BIP(BIDFN,1,I,0)=$P(BIPROF,"|||",I)
"RTN","BIPATUP",173,0)
 S ^BIP(BIDFN,1,1,0)=" "
"RTN","BIPATUP",174,0)
 S ^BIP(BIDFN,1,2,0)="Patient: "_$$NAME^BIUTL1(BIDFN)_"    DOB: "_$$DOBF^BIUTL1(BIDFN,$G(BIFDT))
"RTN","BIPATUP",175,0)
 S ^BIP(BIDFN,1,3,0)=" "
"RTN","BIPATUP",176,0)
 N I F I=1:1:X S ^BIP(BIDFN,1,(I+3),0)=$P(BIPROF,"|||",I)
"RTN","BIPATUP",177,0)
 ;**********
"RTN","BIPATUP",178,0)
 ;
"RTN","BIPATUP",179,0)
 S ^BIP(BIDFN,1,0)=U_U_X_U_X_U_DT
"RTN","BIPATUP",180,0)
 Q
"RTN","BIPATUP",181,0)
 ;
"RTN","BIPATUP",182,0)
 ;
"RTN","BIPATUP",183,0)
 ;----------
"RTN","BIPATUP",184,0)
BIDE(BIDE) ;EP
"RTN","BIPATUP",185,0)
 ;---> Set Data Elements for TCH Format.
"RTN","BIPATUP",186,0)
 ;---> (Old v7.x: 6=Dose#, 23=Date of Visit, 25=HL7 Code.)
"RTN","BIPATUP",187,0)
 ;---> 25=CVX Code, 65=Dose Override, 88=TCH Date of Visit.
"RTN","BIPATUP",188,0)
 K BIDE
"RTN","BIPATUP",189,0)
 ;
"RTN","BIPATUP",190,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP",191,0)
 ;---> Pull TCH date format instead of Immserve.
"RTN","BIPATUP",192,0)
 ;N I F I=23,25,65 S BIDE(I)=""
"RTN","BIPATUP",193,0)
 N I F I=25,65,88 S BIDE(I)=""
"RTN","BIPATUP",194,0)
 ;**********
"RTN","BIPATUP",195,0)
 Q
"RTN","BIPATUP",196,0)
 ;
"RTN","BIPATUP",197,0)
 ;
"RTN","BIPATUP",198,0)
 ;----------
"RTN","BIPATUP",199,0)
UNLOCK(BIDFN) ;EP
"RTN","BIPATUP",200,0)
 ;---> Unlock BI PATIENT global for this patient.
"RTN","BIPATUP",201,0)
 ;---> Parameters:
"RTN","BIPATUP",202,0)
 ;     1 - BIDFN (req) Patient DFN to unlock.
"RTN","BIPATUP",203,0)
 ;
"RTN","BIPATUP",204,0)
 Q:'$G(BIDFN)
"RTN","BIPATUP",205,0)
 L -^BIP(BIDFN)
"RTN","BIPATUP",206,0)
 Q
"RTN","BIPATUP",207,0)
 ;
"RTN","BIPATUP",208,0)
 ;
"RTN","BIPATUP",209,0)
 ;----------
"RTN","BIPATUP",210,0)
NOFORC(BINF) ;EP
"RTN","BIPATUP",211,0)
 ;---> Build local array of Vaccines Group IEN's that Site has
"RTN","BIPATUP",212,0)
 ;---> specified should not be forecast.
"RTN","BIPATUP",213,0)
 ;---> Parameters:
"RTN","BIPATUP",214,0)
 ;     1 - BINF (ret) Array of Vaccine Group IEN's that should not be forecast.
"RTN","BIPATUP",215,0)
 ;
"RTN","BIPATUP",216,0)
 N N S N=0
"RTN","BIPATUP",217,0)
 F  S N=$O(^BISERT(N)) Q:'N  D
"RTN","BIPATUP",218,0)
 .I '$P(^BISERT(N,0),U,5) S BINF(N)=""
"RTN","BIPATUP",219,0)
 Q
"RTN","BIPATUP",220,0)
 ;
"RTN","BIPATUP",221,0)
 ;
"RTN","BIPATUP",222,0)
DISPLAY ;EP
"RTN","BIPATUP",223,0)
 ;---> Display Input and Output Data Strings.
"RTN","BIPATUP",224,0)
 ;---> Uncomment any of the next lines to see History or ImmServe data:
"RTN","BIPATUP",225,0)
 ;W !!,"BIHX Out: ",BIHX R ZZZ
"RTN","BIPATUP",226,0)
 ;W !!,"BIFORC Full: ",BIFORC R ZZZ
"RTN","BIPATUP",227,0)
 ; ZEXCEPT: BIHX,BIFORC
"RTN","BIPATUP",228,0)
 N ZZZ
"RTN","BIPATUP",229,0)
 D  R ZZZ:600
"RTN","BIPATUP",230,0)
 .W #!," RPMS INPUT String, Patient Data: "
"RTN","BIPATUP",231,0)
 .W !,"   ",$P(BIHX,"~~~",1)
"RTN","BIPATUP",232,0)
 .;
"RTN","BIPATUP",233,0)
 .W !!," RPMS INPUT String, Dose History Input doses: "
"RTN","BIPATUP",234,0)
 .N BIDOSE,BIDOSES,I S BIDOSES=$P(BIHX,"~~~",2)
"RTN","BIPATUP",235,0)
 .F I=1:1 S BIDOSE=$P(BIDOSES,"|||",I) Q:(BIDOSE="")  W !,"   ",BIDOSE
"RTN","BIPATUP",236,0)
 ;
"RTN","BIPATUP",237,0)
 D  R ZZZ:600
"RTN","BIPATUP",238,0)
 .W !!!," TCH OUTPUT String, Input doses: "
"RTN","BIPATUP",239,0)
 .N BIDOSE,BIDOSES,I S BIDOSES=$P(BIFORC,"~~~",2)
"RTN","BIPATUP",240,0)
 .F I=1:1 S BIDOSE=$P(BIDOSES,"|||",I) Q:(BIDOSE="")  W !,"   ",BIDOSE
"RTN","BIPATUP",241,0)
 ;
"RTN","BIPATUP",242,0)
 D  R ZZZ:600
"RTN","BIPATUP",243,0)
 .W !!!," TCH OUTPUT String, Doses Due: "
"RTN","BIPATUP",244,0)
 .N BIDOSE,BIDOSES,I S BIDOSES=$P(BIFORC,"~~~",3)
"RTN","BIPATUP",245,0)
 .F I=1:1 S BIDOSE=$P(BIDOSES,"|||",I) Q:(BIDOSE="")  W !,"   ",BIDOSE
"RTN","BIPATUP",246,0)
 ;
"RTN","BIPATUP",247,0)
 Q
"RTN","BIPATUP1")
0^75^B51318324
"RTN","BIPATUP1",1,0)
BIPATUP1 ;IHS/CMI/MWR - UPDATE PATIENT DATA; DEC 15, 2011
"RTN","BIPATUP1",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIPATUP1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATUP1",4,0)
 ;;  UPDATE PATIENT DATA, IMM FORECAST IN ^BIPDUE(.
"RTN","BIPATUP1",5,0)
 ;;  NOTE!: An earlier version of this routine is saved in BIZPATUP1.
"RTN","BIPATUP1",6,0)
 ;;  PATCH 8: Extensive changes to accommodate new TCH Forecaster   LDFORC+0
"RTN","BIPATUP1",7,0)
 ;;  PATCH 9: Numerous changes to accomodate new Heb B High Risk  IHSPOST+0
"RTN","BIPATUP1",8,0)
 ;
"RTN","BIPATUP1",9,0)
 ;----------
"RTN","BIPATUP1",10,0)
LDFORC(BIDFN,BIFORC,BIHX,BIFDT,BIDUZ2,BINF,BIPDSS) ;EP
"RTN","BIPATUP1",11,0)
 ;---> Load Immserve Data (Immunizations Due) into ^BIPDUE(.
"RTN","BIPATUP1",12,0)
 ;---> Parameters:
"RTN","BIPATUP1",13,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIPATUP1",14,0)
 ;     2 - BIFORC (req) String containing Patient's Imms Due.
"RTN","BIPATUP1",15,0)
 ;     3 - BIHX   (req) String containing Patient's Imm History.
"RTN","BIPATUP1",16,0)
 ;     4 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIPATUP1",17,0)
 ;     5 - BIDUZ2 (opt) User's DUZ(2) indicating site parameters.
"RTN","BIPATUP1",18,0)
 ;     6 - BINF   (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",19,0)
 ;     7 - BIPDSS (ret) Returned string of V IMM IEN's that are
"RTN","BIPATUP1",20,0)
 ;                      Problem Doses, according to ImmServe.
"RTN","BIPATUP1",21,0)
 ;
"RTN","BIPATUP1",22,0)
 Q:'$G(BIDFN)  Q:$G(BIFORC)=""  Q:$G(BIHX)=""
"RTN","BIPATUP1",23,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIPATUP1",24,0)
 S:'$G(BIFDT) BIFDT=DT S:'$D(BINF) BINF=""
"RTN","BIPATUP1",25,0)
 ;
"RTN","BIPATUP1",26,0)
 ;---> Set Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",27,0)
 N BIAGE S BIAGE=$$AGE^BIUTL1(BIDFN,2,BIFDT)
"RTN","BIPATUP1",28,0)
 ;
"RTN","BIPATUP1",29,0)
 ;---> First clear out any previously set Immunizations Due and
"RTN","BIPATUP1",30,0)
 ;---> any Forecasting Errors for this patient.
"RTN","BIPATUP1",31,0)
 D KILLDUE^BIPATUP2(BIDFN)
"RTN","BIPATUP1",32,0)
 ;
"RTN","BIPATUP1",33,0)
 ;---> If no BIDUZ2, try DUZ(2); otherwise, defaults will be used.
"RTN","BIPATUP1",34,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATUP1",35,0)
 ;
"RTN","BIPATUP1",36,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",37,0)
 ;---> Check for any input doses that TCH identified as problems.
"RTN","BIPATUP1",38,0)
 ;---> Build and return a string of "V IMM IEN_%_CVX" problem doses,
"RTN","BIPATUP1",39,0)
 ;---> as identified in the TCH Input Doses segment.
"RTN","BIPATUP1",40,0)
 ;D DPROBS^BIPATUP2(BIFORC,.BIPDSS,.BIID)
"RTN","BIPATUP1",41,0)
 D DPROBS^BIPATUP2(BIFORC,.BIPDSS)
"RTN","BIPATUP1",42,0)
 ;**********
"RTN","BIPATUP1",43,0)
 ;
"RTN","BIPATUP1",44,0)
 ;---> * * * * * NEXT PATCH REMOVE ALL FLU CODE. * * * * *
"RTN","BIPATUP1",45,0)
 ;---> Parse Doses Due from Forecaster string (BIFORC), perform any
"RTN","BIPATUP1",46,0)
 ;---> necessary translations, and set as due in patient global ^BIPDUE(.
"RTN","BIPATUP1",47,0)
 ;---> If Immserve set Flu due, set BIIMMFL=1.
"RTN","BIPATUP1",48,0)
 N BIIMMFL S BIIMMFL=0
"RTN","BIPATUP1",49,0)
 ;
"RTN","BIPATUP1",50,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",51,0)
 ;---> Check if TCH has already forecast Pneumo, pass in BITCHPN.
"RTN","BIPATUP1",52,0)
 ;---> If TCH set Pneumo due, set BITCHPN=1.
"RTN","BIPATUP1",53,0)
 N BITCHPN S BITCHPN=0
"RTN","BIPATUP1",54,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",55,0)
 ;---> Check if TCH has already forecast Hep B, pass in BITCHHB.
"RTN","BIPATUP1",56,0)
 N BITCHHB S BITCHHB=0
"RTN","BIPATUP1",57,0)
 ;
"RTN","BIPATUP1",58,0)
 ;D DDUE(BIFORC,BIAGE,BIHX,.BINF,.BIIMMFL,.BIIMMH1,BIDUZ2,.BITCHPN,BIFDT)
"RTN","BIPATUP1",59,0)
 D DDUE(BIFORC,BIAGE,BIHX,.BINF,.BIIMMFL,BIDUZ2,.BITCHPN,BIFDT,.BITCHHB)
"RTN","BIPATUP1",60,0)
 ;
"RTN","BIPATUP1",61,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",62,0)
 ;---> New parameter BIRISKH to pass High Risk Hep B.
"RTN","BIPATUP1",63,0)
 N BIFLU,BIFFLU,BILIVE,BIRISKI,BIRISKP,BIRISKH
"RTN","BIPATUP1",64,0)
 S BIFLU="",(BIFFLU,BILIVE,BIRISKI,BIRISKP,BIRISKH)=0
"RTN","BIPATUP1",65,0)
 ;
"RTN","BIPATUP1",66,0)
 ;---> After loading (SETDUE) TCH forecast, perform any follow-up forecasting
"RTN","BIPATUP1",67,0)
 ;---> needed for High Risk, "Post-forecast".
"RTN","BIPATUP1",68,0)
 D IHSPOST(BIDFN,BIHX,BIFDT,.BIFLU,.BIFFLU,.BIRISKI,.BIRISKP,.BILIVE,BIDUZ2,.BIRISKH)
"RTN","BIPATUP1",69,0)
 ;
"RTN","BIPATUP1",70,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",71,0)
 ;---> No longer called, since TCH forecasts Flu for all ages.
"RTN","BIPATUP1",72,0)
 ;---> Forecast Influenza.
"RTN","BIPATUP1",73,0)
 ;D IHSFLU^BIPATUP2(BIDFN,.BIFLU,BIFFLU,BIRISKI,.BINF,BIFDT,BIAGE,BIIMMFL,BIDUZ2)
"RTN","BIPATUP1",74,0)
 ;
"RTN","BIPATUP1",75,0)
 ;---> Forecast Pneumo.
"RTN","BIPATUP1",76,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",77,0)
 ;---> Only check to forecast Pneumo if TCH has not already done so.
"RTN","BIPATUP1",78,0)
 ;D IHSPNEU(BIDFN,.BIFLU,BIFFLU,BIRISKP,.BINF,BIFDT,BIAGE,BIDUZ2)
"RTN","BIPATUP1",79,0)
 I '$G(BITCHPN) D IHSPNEU(BIDFN,.BIFLU,BIFFLU,BIRISKP,.BINF,BIFDT,BIAGE,BIDUZ2)
"RTN","BIPATUP1",80,0)
 ;
"RTN","BIPATUP1",81,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",82,0)
 ;---> Only check to forecast HepB if TCH has not already done so.
"RTN","BIPATUP1",83,0)
 ;---> Forecast HepB.
"RTN","BIPATUP1",84,0)
 I '$G(BITCHHB) D IHSHEPB(BIDFN,.BIFLU,.BINF,BIFDT,BIAGE,BIDUZ2,BIRISKH)
"RTN","BIPATUP1",85,0)
 ;
"RTN","BIPATUP1",86,0)
 Q
"RTN","BIPATUP1",87,0)
 ;
"RTN","BIPATUP1",88,0)
 ;
"RTN","BIPATUP1",89,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",90,0)
 ;---> Add BITCHPN parameter to pass TCH already forecast Pneumo.
"RTN","BIPATUP1",91,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",92,0)
 ;---> Add BITCHHB parameter to pass TCH already forecast Hep B.
"RTN","BIPATUP1",93,0)
 ;----------
"RTN","BIPATUP1",94,0)
DDUE(BIFORC,BIAGE,BIHX,BINF,BIIMMFL,BIDUZ2,BITCHPN,BIFDT,BITCHHB) ;EP
"RTN","BIPATUP1",95,0)
 ;---> Parse Doses Due from Immserve string (BIFORC), perform any
"RTN","BIPATUP1",96,0)
 ;---> necessary translations, and set as due in patient global ^BIPDUE.
"RTN","BIPATUP1",97,0)
 ;---> Parameters:
"RTN","BIPATUP1",98,0)
 ;     1 - BIFORC  (req) Forecast string coming back from TCH.
"RTN","BIPATUP1",99,0)
 ;     2 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",100,0)
 ;     3 - BIHX    (req) String containing Patient's Imm History.
"RTN","BIPATUP1",101,0)
 ;     4 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",102,0)
 ;     5 - BIIMMFL (opt) BIIMMFL=1 means Immserve already forecast Flu.
"RTN","BIPATUP1",103,0)
 ;     6 - BIDUZ2  (opt) User's DUZ(2) indicating site parameters.
"RTN","BIPATUP1",104,0)
 ;     7 - BITCHPN (opt) BITCHPN=1 means TCH already forecast Pneumo.
"RTN","BIPATUP1",105,0)
 ;     8 - BIFDT   (opt) Forecast Date (date used for forecast).
"RTN","BIPATUP1",106,0)
 ;     9 - BITCHHB (opt) BITCHHB=1 means TCH already forecast Hep B.
"RTN","BIPATUP1",107,0)
 ;
"RTN","BIPATUP1",108,0)
 ;
"RTN","BIPATUP1",109,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",110,0)
 ;---> Changes to accommodate new TCH Forecaster parsing.
"RTN","BIPATUP1",111,0)
 N BIFORC1,BIDOSE,N
"RTN","BIPATUP1",112,0)
 S BIFORC1=$P(BIFORC,"~~~",3)
"RTN","BIPATUP1",113,0)
 ;
"RTN","BIPATUP1",114,0)
 F N=1:1 S BIDOSE=$P(BIFORC1,"|||",N) Q:(BIDOSE="")  D
"RTN","BIPATUP1",115,0)
 .D DDUE2(BIDOSE,BIAGE,BIHX,.BINF,.BIPC,.BIIMMFL,BIDUZ2,.BITCHPN,BIFDT,.BITCHHB)
"RTN","BIPATUP1",116,0)
 Q
"RTN","BIPATUP1",117,0)
 ;
"RTN","BIPATUP1",118,0)
 ;
"RTN","BIPATUP1",119,0)
 ;----------
"RTN","BIPATUP1",120,0)
DDUE2(BIDOSE,BIAGE,BIHX,BINF,BIPC,BIIMMFL,BIDUZ2,BITCHPN,BIFDT,BITCHHB) ;EP
"RTN","BIPATUP1",121,0)
 ;---> Parse Doses Due (see linelabel DDUE above).
"RTN","BIPATUP1",122,0)
 ;---> Parameters: See DDUE immediately above!
"RTN","BIPATUP1",123,0)
 ;
"RTN","BIPATUP1",124,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",125,0)
 ;---> Many changes below to accommodate new TCH Forecaster.
"RTN","BIPATUP1",126,0)
 ;
"RTN","BIPATUP1",127,0)
 ;---> Uncomment next line to see raw ImmServe Doses Due:
"RTN","BIPATUP1",128,0)
 ;W !!!,BIDOSE R ZZZ
"RTN","BIPATUP1",129,0)
 ;
"RTN","BIPATUP1",130,0)
 N A,BI,D,X S X=BIDOSE
"RTN","BIPATUP1",131,0)
 ;---> A=CVX Code
"RTN","BIPATUP1",132,0)
 S A=$P(X,U,1)
"RTN","BIPATUP1",133,0)
 ;
"RTN","BIPATUP1",134,0)
 ;---> "PAST"=Past Due Indicator
"RTN","BIPATUP1",135,0)
 S BI("PAST")=$P(X,U,3)
"RTN","BIPATUP1",136,0)
 ;
"RTN","BIPATUP1",137,0)
 ;---> Get Fileman formats of due dates.
"RTN","BIPATUP1",138,0)
 ;---> "MIN"=Minimum Date Due
"RTN","BIPATUP1",139,0)
 S BI("MIN")=$$TCHFMDT^BIUTL5($P(X,U,4)) S:('BI("MIN")) BI("MIN")=""
"RTN","BIPATUP1",140,0)
 ;
"RTN","BIPATUP1",141,0)
 ;---> "REC"=Recommended Date Due
"RTN","BIPATUP1",142,0)
 S BI("REC")=$$TCHFMDT^BIUTL5($P(X,U,5)) S:('BI("REC")) BI("REC")=""
"RTN","BIPATUP1",143,0)
 ;
"RTN","BIPATUP1",144,0)
 ;---> "EXC"=Exceeds Date Due
"RTN","BIPATUP1",145,0)
 S BI("EXC")=$$TCHFMDT^BIUTL5($P(X,U,6)) S:('BI("EXC")) BI("EXC")=""
"RTN","BIPATUP1",146,0)
 ;
"RTN","BIPATUP1",147,0)
 ;---> Determine whether to set Recommended Age or Minimum Accepted Age
"RTN","BIPATUP1",148,0)
 ;---> based on Site Parameter.
"RTN","BIPATUP1",149,0)
 S BI("DUE")=BI("REC")
"RTN","BIPATUP1",150,0)
 I $$MINAGE^BIUTL2($G(BIDUZ2))="A" S BI("DUE")=BI("MIN")
"RTN","BIPATUP1",151,0)
 ;
"RTN","BIPATUP1",152,0)
 ;---> If this dose is past due (B=1), D(2) will stuff DATE PAST DUE;
"RTN","BIPATUP1",153,0)
 ;---> Otherwise, D(1) will stuff RECOMMENDED DATE DUE.
"RTN","BIPATUP1",154,0)
 ;S (D(1),D(2))="" D
"RTN","BIPATUP1",155,0)
 ;.I B S D(2)=D Q
"RTN","BIPATUP1",156,0)
 ;.S D(1)=D
"RTN","BIPATUP1",157,0)
 S (D(1),D(2))="" D
"RTN","BIPATUP1",158,0)
 .I BI("PAST") S D(2)=BI("EXC") Q
"RTN","BIPATUP1",159,0)
 .S D(1)=BI("DUE")
"RTN","BIPATUP1",160,0)
 ;
"RTN","BIPATUP1",161,0)
 ;---> *** TRANSLATIONS OF INCOMING IMMSERVE VACCINES:
"RTN","BIPATUP1",162,0)
 ;--->     -------------------------------------------
"RTN","BIPATUP1",163,0)
 ;
"RTN","BIPATUP1",164,0)
 Q:A=""
"RTN","BIPATUP1",165,0)
 ;
"RTN","BIPATUP1",166,0)
 ;---> Check to see if Site specified do not forecast this Vaccine Group.
"RTN","BIPATUP1",167,0)
 Q:$D(BINF($$HL7TX^BIUTL2(A,1)))
"RTN","BIPATUP1",168,0)
 ;
"RTN","BIPATUP1",169,0)
 ;---> Add this Immunization Due.
"RTN","BIPATUP1",170,0)
 D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(A)_U_U_D(1)_U_D(2))
"RTN","BIPATUP1",171,0)
 ;
"RTN","BIPATUP1",172,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",173,0)
 ;---> If TCH set Pneumo due, set BITCHPN=1.
"RTN","BIPATUP1",174,0)
 S:(A=33) BITCHPN=1
"RTN","BIPATUP1",175,0)
 ;**********
"RTN","BIPATUP1",176,0)
 ;
"RTN","BIPATUP1",177,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",178,0)
 ;---> If TCH set Hep B due, set BITCHHB=1.
"RTN","BIPATUP1",179,0)
 S:(A=45) BITCHHB=1
"RTN","BIPATUP1",180,0)
 ;**********
"RTN","BIPATUP1",181,0)
 ;
"RTN","BIPATUP1",182,0)
 Q
"RTN","BIPATUP1",183,0)
 ;
"RTN","BIPATUP1",184,0)
 ;
"RTN","BIPATUP1",185,0)
 ;----------
"RTN","BIPATUP1",186,0)
IHSPOST(BIDFN,BIHX,BIFDT,BIFLU,BIFFLU,BIRISKI,BIRISKP,BILIVE,BIDUZ2,BIRISKH) ;EP
"RTN","BIPATUP1",187,0)
 ;---> Post forecast; after loading  TCH forecast, perform any follow-up forecasting
"RTN","BIPATUP1",188,0)
 ;---> needed for High Risk.
"RTN","BIPATUP1",189,0)
 ;---> Parameters:
"RTN","BIPATUP1",190,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP1",191,0)
 ;     2 - BIHX    (req) String containing Patient's Imm History.
"RTN","BIPATUP1",192,0)
 ;     3 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP1",193,0)
 ;     4 - BIFLU   (ret) Pneumo & Hep B history array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP1",194,0)
 ;     5 - BIFFLU  (ret) Value (0-4) for force Flu/Pneumo regardless of age.
"RTN","BIPATUP1",195,0)
 ;     6 - BIRISKI (ret) 1=Patient has Risk of Influenza; otherwise 0.
"RTN","BIPATUP1",196,0)
 ;     7 - BIRISKP (ret) 1=Patient has Risk of Pneumo; otherwise 0.
"RTN","BIPATUP1",197,0)
 ;     8 - BILIVE  (ret) 1-Patient received a LIVE vaccine <28 days before
"RTN","BIPATUP1",198,0)
 ;                       the forecast date.
"RTN","BIPATUP1",199,0)
 ;     9 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP1",200,0)
 ;    10 - BIRISKH (ret) 1=Patient has Risk of Hep B; otherwise 0.
"RTN","BIPATUP1",201,0)
 ;
"RTN","BIPATUP1",202,0)
 ;---> Loop through History string, gathering previous Influenzas and Pneumos.
"RTN","BIPATUP1",203,0)
 ;
"RTN","BIPATUP1",204,0)
 N BIDOSE,BIHX1,I,X,Y
"RTN","BIPATUP1",205,0)
 S BIHX1=$P(BIHX,"~~~",2)
"RTN","BIPATUP1",206,0)
 ;
"RTN","BIPATUP1",207,0)
 ;---> Loop through RPMS Input String History, collecting for prior Pneumo.
"RTN","BIPATUP1",208,0)
 ;---> Store in BIFLU by HL7 Code, inverse date.
"RTN","BIPATUP1",209,0)
 ;F I=1:1:Y D
"RTN","BIPATUP1",210,0)
 F I=1:1  S BIDOSE=$P(BIHX1,"|||",I) Q:BIDOSE=""  D
"RTN","BIPATUP1",211,0)
 .;
"RTN","BIPATUP1",212,0)
 .;---> For this Immunization, set A=CVX Code, D=Date.
"RTN","BIPATUP1",213,0)
 .N A,D S A=$P(BIDOSE,U,2),D=$P(BIDOSE,U,3)
"RTN","BIPATUP1",214,0)
 .;---> Quit if Dose Override (ImmServe Input Field 51)=Invalid Dose=2.
"RTN","BIPATUP1",215,0)
 .;I $P(BIDOSE,U,5),$P(BIDOSE,U,5)<9 Q
"RTN","BIPATUP1",216,0)
 .;
"RTN","BIPATUP1",217,0)
 .;
"RTN","BIPATUP1",218,0)
 .;---> If this is a Pneumo (33,100,109) or Hep B (8,42,43,44,45,etc.))
"RTN","BIPATUP1",219,0)
 .;---> translate and store it in local array BIFLU(CVX,Inverse Fm date).
"RTN","BIPATUP1",220,0)
 .;
"RTN","BIPATUP1",221,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",222,0)
 .;---> Update Pneumo CVX's.
"RTN","BIPATUP1",223,0)
 .;S:((A=100)!(A=109)) A=33
"RTN","BIPATUP1",224,0)
 .S:((A=100)!(A=109)!(A=133)!(A=152)) A=33
"RTN","BIPATUP1",225,0)
 .;
"RTN","BIPATUP1",226,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",227,0)
 .;---> Collect Hep B CVX's.
"RTN","BIPATUP1",228,0)
 .S:((A=8)!(A=42)!(A=44)!(A=43)!(A=43)!(A=51)!(A=102)) A=45
"RTN","BIPATUP1",229,0)
 .S:((A=104)!(A=110)!(A=132)!(A=146)) A=45
"RTN","BIPATUP1",230,0)
 .;
"RTN","BIPATUP1",231,0)
 .;
"RTN","BIPATUP1",232,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",233,0)
 .;---> Only concerned with Pneumos.
"RTN","BIPATUP1",234,0)
 .;
"RTN","BIPATUP1",235,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",236,0)
 .;---> Now concerned with Hep B's too.
"RTN","BIPATUP1",237,0)
 .;S:(A=33) BIFLU(A,9999999-$$TCHFMDT^BIUTL5(D))=""
"RTN","BIPATUP1",238,0)
 .S:(A=33)!(A=45) BIFLU(A,9999999-$$TCHFMDT^BIUTL5(D))=""
"RTN","BIPATUP1",239,0)
 .;**********
"RTN","BIPATUP1",240,0)
 .;S X=X+7 OLD IMMSERVE COUNTER.
"RTN","BIPATUP1",241,0)
 ;
"RTN","BIPATUP1",242,0)
 ;
"RTN","BIPATUP1",243,0)
 ;---> Get value for forced Influenza regardless of age.
"RTN","BIPATUP1",244,0)
 ;---> 0=Normal, 1=Influenza, 2=Pneumococcal, 3=Both, 4=Disregard Risk Factors.
"RTN","BIPATUP1",245,0)
 S BIFFLU=$$INFL^BIUTL11(BIDFN)
"RTN","BIPATUP1",246,0)
 ;---> Quit (don't check Risk Factors) if BIFFLU=4, Disregard Risk Factors.
"RTN","BIPATUP1",247,0)
 Q:BIFFLU=4
"RTN","BIPATUP1",248,0)
 ;
"RTN","BIPATUP1",249,0)
 ;
"RTN","BIPATUP1",250,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",251,0)
 ;---> Accommodate new parameter options.
"RTN","BIPATUP1",252,0)
 ;---> Quit if Site Param says NOT to include Risk Factors.
"RTN","BIPATUP1",253,0)
 N BIRSK S BIRSK=$$RISKP^BIUTL2(BIDUZ2)
"RTN","BIPATUP1",254,0)
 Q:'BIRSK
"RTN","BIPATUP1",255,0)
 ;
"RTN","BIPATUP1",256,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",257,0)
 ;---> Only Pneumo will be checked (Flu now forecast for everyone), by
"RTN","BIPATUP1",258,0)
 ;---> passing 2 in the third parameter.
"RTN","BIPATUP1",259,0)
 ;
"RTN","BIPATUP1",260,0)
 ;---> Check for Influenza and Pneumo Risk Factors.
"RTN","BIPATUP1",261,0)
 ;---> If BIRISKI, BIRISKP =0, then either site param is turned off
"RTN","BIPATUP1",262,0)
 ;---> or patient is NOT High Risk.  Both cases exclude it from forecast.
"RTN","BIPATUP1",263,0)
 ;D RISK^BIDX(BIDFN,BIFDT,0,.BIRISKI,.BIRISKP)
"RTN","BIPATUP1",264,0)
 ;
"RTN","BIPATUP1",265,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",266,0)
 ;---> New parameter to return Hep B risk. (No longer include Flu.)
"RTN","BIPATUP1",267,0)
 ;D RISK^BIDX(BIDFN,BIFDT,2,.BIRISKI,.BIRISKP)
"RTN","BIPATUP1",268,0)
 D RISK^BIDX(BIDFN,BIFDT,BIRSK,,.BIRISKP,.BIRISKH)
"RTN","BIPATUP1",269,0)
 ;**********
"RTN","BIPATUP1",270,0)
 Q
"RTN","BIPATUP1",271,0)
 ;
"RTN","BIPATUP1",272,0)
 ;
"RTN","BIPATUP1",273,0)
 ;----------
"RTN","BIPATUP1",274,0)
IHSPNEU(BIDFN,BIFLU,BIFFLU,BIRISKP,BINF,BIFDT,BIAGE,BIDUZ2) ;EP
"RTN","BIPATUP1",275,0)
 ;---> IHS Pneumo Forecast.
"RTN","BIPATUP1",276,0)
 ;---> Parameters:
"RTN","BIPATUP1",277,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP1",278,0)
 ;     2 - BIFLU   (req) Influ and Pneumo History array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP1",279,0)
 ;     3 - BIFFLU  (req) Value (0-4) for force Flu/Pneumo regardless of age.
"RTN","BIPATUP1",280,0)
 ;     4 - BIRISKP (req) 1=Patient has Risk of Pneumo; otherwise 0.
"RTN","BIPATUP1",281,0)
 ;     5 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",282,0)
 ;     6 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP1",283,0)
 ;     7 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",284,0)
 ;     8 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP1",285,0)
 ;
"RTN","BIPATUP1",286,0)
 ;---> Quit if Forecasting turned off for Pneumo.
"RTN","BIPATUP1",287,0)
 Q:$D(BINF(11))
"RTN","BIPATUP1",288,0)
 ;
"RTN","BIPATUP1",289,0)
 ;---> Quit if this patient has a contraindication to Pneumo.
"RTN","BIPATUP1",290,0)
 ;********** PATCH 4, v8.5, DEC 01,2012, IHS/CMI/MWR
"RTN","BIPATUP1",291,0)
 ;---> Use newer Related Contraindications call to determine contraindicaton.
"RTN","BIPATUP1",292,0)
 ;Q:$$CONTR^BIUTL11(BIDFN,119)
"RTN","BIPATUP1",293,0)
 N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIPATUP1",294,0)
 Q:$D(BICT(33))
"RTN","BIPATUP1",295,0)
 ;**********
"RTN","BIPATUP1",296,0)
 ;
"RTN","BIPATUP1",297,0)
 ;---> Quit if this Pt Age <60 months (5yrs), regardless of risk.
"RTN","BIPATUP1",298,0)
 Q:BIAGE<60
"RTN","BIPATUP1",299,0)
 ;
"RTN","BIPATUP1",300,0)
 N BIPNAGE,BIMRECNT,BIALLAGE
"RTN","BIPATUP1",301,0)
 ;---> BIPNAGE=Site Parameter Age to forecast Pneumo ("Pneumo Age") in months.
"RTN","BIPATUP1",302,0)
 S BIPNAGE=($P($$PNMAGE^BIPATUP2(BIDUZ2),U)*12)
"RTN","BIPATUP1",303,0)
 ;---> BIMRECNT=Fileman Date of most recent Pneumo.
"RTN","BIPATUP1",304,0)
 S BIMRECNT=(9999999-$O(BIFLU(33,0))) S:BIMRECNT=9999999 BIMRECNT=0
"RTN","BIPATUP1",305,0)
 S BIALLAGE=0
"RTN","BIPATUP1",306,0)
 ;
"RTN","BIPATUP1",307,0)
 ;---> Quit if patient is less than Age Appropriate for Pneumo in years
"RTN","BIPATUP1",308,0)
 ;---> and has already had one Pneumo.
"RTN","BIPATUP1",309,0)
 Q:((BIAGE<BIPNAGE)&(BIMRECNT))
"RTN","BIPATUP1",310,0)
 ;
"RTN","BIPATUP1",311,0)
 ;---> If High Risk Pneumo or Forecast Regardless of Age, set BIALLAGE=1.
"RTN","BIPATUP1",312,0)
 I BIRISKP!(23[BIFFLU) S BIALLAGE=1
"RTN","BIPATUP1",313,0)
 ;
"RTN","BIPATUP1",314,0)
 ;---> Quit if Pt Age < Pneumo Age (on Forecast date) and not forecast for
"RTN","BIPATUP1",315,0)
 ;---> all ages.
"RTN","BIPATUP1",316,0)
 Q:((BIAGE<BIPNAGE)&('BIALLAGE))
"RTN","BIPATUP1",317,0)
 ;
"RTN","BIPATUP1",318,0)
 ;---> If patient has reached site Pneumo Age or has Forced Pneumo AND
"RTN","BIPATUP1",319,0)
 ;---> has NO previous pneumo, then forecast Pneumo and quit.
"RTN","BIPATUP1",320,0)
 I ((BIAGE'<BIPNAGE)!BIALLAGE),'BIMRECNT D  Q
"RTN","BIPATUP1",321,0)
 .D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(33)_U_U_BIFDT)
"RTN","BIPATUP1",322,0)
 ;
"RTN","BIPATUP1",323,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",324,0)
 ;---> TCH will forecast routine Pneumo after age 65.
"RTN","BIPATUP1",325,0)
 Q
"RTN","BIPATUP1",326,0)
 ;
"RTN","BIPATUP1",327,0)
 ;
"RTN","BIPATUP1",328,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",329,0)
 ;---> Add parameter for Hep B (BIRISKH). Change BIFFLU to BIRSK.
"RTN","BIPATUP1",330,0)
 ;----------
"RTN","BIPATUP1",331,0)
IHSHEPB(BIDFN,BIFLU,BINF,BIFDT,BIAGE,BIDUZ2,BIRISKH) ;EP
"RTN","BIPATUP1",332,0)
 ;---> IHS Hep B Forecast.
"RTN","BIPATUP1",333,0)
 ;---> Parameters:
"RTN","BIPATUP1",334,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP1",335,0)
 ;     2 - BIFLU   (req) Influ and Pneumo History array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP1",336,0)
 ;     3 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",337,0)
 ;     4 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP1",338,0)
 ;     5 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",339,0)
 ;     6 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP1",340,0)
 ;     7 - BIRISKH (req) 1=Patient has Risk of HEP B; otherwise 0.
"RTN","BIPATUP1",341,0)
 ;
"RTN","BIPATUP1",342,0)
 ;---> Quit if Forecasting turned off for Hep B.
"RTN","BIPATUP1",343,0)
 Q:$D(BINF(4))
"RTN","BIPATUP1",344,0)
 ;
"RTN","BIPATUP1",345,0)
 ;---> Quit if this patient has a contraindication to Hep B.
"RTN","BIPATUP1",346,0)
 N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIPATUP1",347,0)
 Q:$D(BICT(45))
"RTN","BIPATUP1",348,0)
 ;**********
"RTN","BIPATUP1",349,0)
 ;
"RTN","BIPATUP1",350,0)
 ;---> Quit if this Pt Age < 19 yrs or older than 60 yrs, regardless of risk.
"RTN","BIPATUP1",351,0)
 Q:(BIAGE<228)  Q:(BIAGE>719)
"RTN","BIPATUP1",352,0)
 ;
"RTN","BIPATUP1",353,0)
 ;---> Quit if this patient ever received a Hep B.
"RTN","BIPATUP1",354,0)
 Q:$D(BIFLU(45))
"RTN","BIPATUP1",355,0)
 ;
"RTN","BIPATUP1",356,0)
 ;---> Quit iF patient is NOT High Risk for Hep B.
"RTN","BIPATUP1",357,0)
 Q:('BIRISKH)
"RTN","BIPATUP1",358,0)
 ;
"RTN","BIPATUP1",359,0)
 D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(45)_U_U_BIFDT)
"RTN","BIPATUP1",360,0)
 Q
"RTN","BIPATUP2")
0^76^B13957327
"RTN","BIPATUP2",1,0)
BIPATUP2 ;IHS/CMI/MWR - UPDATE PATIENT DATA 2; OCT 15, 2010
"RTN","BIPATUP2",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIPATUP2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATUP2",4,0)
 ;;  IHS FORECAST. UPDATE PATIENT DATA, IMM FORECAST IN ^BIPDUE(.
"RTN","BIPATUP2",5,0)
 ;;  NOTE!: An earlier version of this routine is saved in BIZPATUP2.
"RTN","BIPATUP2",6,0)
 ;;  PATCH 8: Changes for Problem Doses retrieval from TCH Forecaster.  DPROBS+10
"RTN","BIPATUP2",7,0)
 ;;  PATCH 9: Mods to flag only problem components of combo vaccines.  DPROBS+23
"RTN","BIPATUP2",8,0)
 ;
"RTN","BIPATUP2",9,0)
 ;
"RTN","BIPATUP2",10,0)
 ;----------
"RTN","BIPATUP2",11,0)
DPROBS(BIFORC,BIPDSS,BIID) ;EP
"RTN","BIPATUP2",12,0)
 ;---> Check for any Input Doses that have Dose Problems.
"RTN","BIPATUP2",13,0)
 ;---> If any exist, build the string BIPDSS, concatenating the
"RTN","BIPATUP2",14,0)
 ;---> Visit IEN's with U.
"RTN","BIPATUP2",15,0)
 ;---> Parameters:
"RTN","BIPATUP2",16,0)
 ;     1 - BIFORC (req) Forecast string coming back from TCH.
"RTN","BIPATUP2",17,0)
 ;     2 - BIPDSS (ret) Returned string of V IMM IEN's that are Problem Doses.
"RTN","BIPATUP2",18,0)
 ;                      according to ImmServe.
"RTN","BIPATUP2",19,0)
 ;     3 - BIID   (ret) NO LONGER USED. Immserve "Number of Input Doses" (Field 109 in 2010).
"RTN","BIPATUP2",20,0)
 ;
"RTN","BIPATUP2",21,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP2",22,0)
 ;---> Changes to accommodate new TCH Forecaster.
"RTN","BIPATUP2",23,0)
 ;
"RTN","BIPATUP2",24,0)
 S BIPDSS=""
"RTN","BIPATUP2",25,0)
 ;
"RTN","BIPATUP2",26,0)
 ;---> NOTE: Pulling History from the TCH Output String (NOT RPMS Input string).
"RTN","BIPATUP2",27,0)
 N BIFORC1,BIDOSE,N
"RTN","BIPATUP2",28,0)
 S BIFORC1=$P(BIFORC,"~~~",2)
"RTN","BIPATUP2",29,0)
 ;
"RTN","BIPATUP2",30,0)
 F N=1:1 S BIDOSE=$P(BIFORC1,"|||",N) Q:(BIDOSE="")  D
"RTN","BIPATUP2",31,0)
 .;---> If this Input Dose was TCH-invalid (pc6), set V Imm IEN_%_CVX in
"RTN","BIPATUP2",32,0)
 .;---> Problem Doses string (BIPDSS).
"RTN","BIPATUP2",33,0)
 .;
"RTN","BIPATUP2",34,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP2",35,0)
 .;---> Mods to flag only problem components of combo vaccines.
"RTN","BIPATUP2",36,0)
 .;
"RTN","BIPATUP2",37,0)
 .;---> Quit if this is not a problem dose.
"RTN","BIPATUP2",38,0)
 .Q:('$P(BIDOSE,U,6))
"RTN","BIPATUP2",39,0)
 .;
"RTN","BIPATUP2",40,0)
 .N BICVXS S BICVXS=$P(BIDOSE,U,7)
"RTN","BIPATUP2",41,0)
 .;---> If piece 7 is null then not a combo, set BIPDSS and quit.
"RTN","BIPATUP2",42,0)
 .I 'BICVXS S BIPDSS=BIPDSS_$P(BIDOSE,U)_"%"_$P(BIDOSE,U,2)_U Q
"RTN","BIPATUP2",43,0)
 .;
"RTN","BIPATUP2",44,0)
 .;--> Piece 7 equals one or more problem CVX's in this combo, delimited by comma.
"RTN","BIPATUP2",45,0)
 .N J F J=1:1 S BICVX=$P(BICVXS,",",J) Q:'BICVX  D
"RTN","BIPATUP2",46,0)
 ..S BIPDSS=BIPDSS_$P(BIDOSE,U)_"%"_BICVX_U
"RTN","BIPATUP2",47,0)
 .;**********
"RTN","BIPATUP2",48,0)
 ;
"RTN","BIPATUP2",49,0)
 ;W !,BIPDSS R ZZZ
"RTN","BIPATUP2",50,0)
 Q
"RTN","BIPATUP2",51,0)
 ;
"RTN","BIPATUP2",52,0)
 ;
"RTN","BIPATUP2",53,0)
 ;----------
"RTN","BIPATUP2",54,0)
KILLDUE(BIDFN) ;EP
"RTN","BIPATUP2",55,0)
 ;---> Clear out any previously set Immunizations Due and
"RTN","BIPATUP2",56,0)
 ;---> any Forecasting Errors for this patient.
"RTN","BIPATUP2",57,0)
 ;---> Hardcoded to improve performance during massive reports.
"RTN","BIPATUP2",58,0)
 ;---> Parameters:
"RTN","BIPATUP2",59,0)
 ;     1 - BIDFN (req) Patient IEN.
"RTN","BIPATUP2",60,0)
 ;
"RTN","BIPATUP2",61,0)
 Q:'BIDFN
"RTN","BIPATUP2",62,0)
 ;
"RTN","BIPATUP2",63,0)
 ;---> Clear previous Immunizations Due.
"RTN","BIPATUP2",64,0)
 D:$D(^BIPDUE("B",BIDFN))
"RTN","BIPATUP2",65,0)
 .N N S N=0
"RTN","BIPATUP2",66,0)
 .F  S N=$O(^BIPDUE("B",BIDFN,N)) Q:'N  D
"RTN","BIPATUP2",67,0)
 ..N Y,Z S Y=$G(^BIPDUE(N,0))
"RTN","BIPATUP2",68,0)
 ..K ^BIPDUE(N),^BIPDUE("B",BIDFN,N)
"RTN","BIPATUP2",69,0)
 ..Q:Y=""
"RTN","BIPATUP2",70,0)
 ..S Z=$P(Y,U,4) K:Z ^BIPDUE("D",Z,N)
"RTN","BIPATUP2",71,0)
 ..S Z=$P(Y,U,5) K:Z ^BIPDUE("D",Z,N)
"RTN","BIPATUP2",72,0)
 ..S $P(^BIPDUE(0),U,4)=$P(^BIPDUE(0),U,4)-1
"RTN","BIPATUP2",73,0)
 .K ^BIPDUE("B",BIDFN),^BIPDUE("E",BIDFN)
"RTN","BIPATUP2",74,0)
 ;
"RTN","BIPATUP2",75,0)
 ;---> Clear previous Forecasting Errors.
"RTN","BIPATUP2",76,0)
 D:$D(^BIPERR("B",BIDFN))
"RTN","BIPATUP2",77,0)
 .N N S N=0
"RTN","BIPATUP2",78,0)
 .F  S N=$O(^BIPERR("B",BIDFN,N)) Q:'N  D
"RTN","BIPATUP2",79,0)
 ..K ^BIPERR("B",BIDFN,N),^BIPERR(N)
"RTN","BIPATUP2",80,0)
 ..S $P(^BIPERR(0),U,4)=$P(^BIPERR(0),U,4)-1
"RTN","BIPATUP2",81,0)
 .K ^BIPERR("B",BIDFN)
"RTN","BIPATUP2",82,0)
 Q
"RTN","BIPATUP2",83,0)
 ;
"RTN","BIPATUP2",84,0)
 ;
"RTN","BIPATUP2",85,0)
 ;----------
"RTN","BIPATUP2",86,0)
IMMSDT(DATE) ;EP
"RTN","BIPATUP2",87,0)
 ;---> Convert Immserve Date (format MMDDYYYY) TO FILEMAN
"RTN","BIPATUP2",88,0)
 ;---> Internal format.
"RTN","BIPATUP2",89,0)
 ;---> NOTE: This code is copied from routine ^BIUTL5 for speed.
"RTN","BIPATUP2",90,0)
 ;---> Any changes here should also be made to ^BIUTL5 too.
"RTN","BIPATUP2",91,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIPATUP2",92,0)
 Q ($E(DATE,5,9)-1700)_$E(DATE,1,2)_$E(DATE,3,4)
"RTN","BIPATUP2",93,0)
 ;
"RTN","BIPATUP2",94,0)
 ;
"RTN","BIPATUP2",95,0)
 ;----------
"RTN","BIPATUP2",96,0)
PNMAGE(BISITE) ;EP - Return Age Appropriate in years for Pneumo at this site.
"RTN","BIPATUP2",97,0)
 ;---> Parameters:
"RTN","BIPATUP2",98,0)
 ;     1 - BISITE (req) User's DUZ(2)
"RTN","BIPATUP2",99,0)
 ;
"RTN","BIPATUP2",100,0)
 Q:'$G(BISITE) "65"
"RTN","BIPATUP2",101,0)
 N Y
"RTN","BIPATUP2",102,0)
 S Y=$P($G(^BISITE(BISITE,0)),U,10) S:'Y Y=65
"RTN","BIPATUP2",103,0)
 Q Y
"RTN","BIPATUP2",104,0)
 ;---> q6-years no longer used.
"RTN","BIPATUP2",105,0)
 ;Q:'$G(BISITE) "65^0"
"RTN","BIPATUP2",106,0)
 ;N Y,Z
"RTN","BIPATUP2",107,0)
 ;S Y=$P($G(^BISITE(BISITE,0)),U,10) S:'Y Y=65
"RTN","BIPATUP2",108,0)
 ;S Z=$P($G(^BISITE(BISITE,0)),U,22) S:'Z Z=0
"RTN","BIPATUP2",109,0)
 ;Q Y_U_Z
"RTN","BIPATUP2",110,0)
 Q
"RTN","BIPATUP2",111,0)
 ;
"RTN","BIPATUP2",112,0)
 ;
"RTN","BIPATUP2",113,0)
 ;----------
"RTN","BIPATUP2",114,0)
FLUALL(BISITE) ;EP - Return 1 to forecast Flu for ALL ages.
"RTN","BIPATUP2",115,0)
 ;---> Parameters:
"RTN","BIPATUP2",116,0)
 ;     1 - BISITE (req) User's DUZ(2)
"RTN","BIPATUP2",117,0)
 ;
"RTN","BIPATUP2",118,0)
 Q:'$G(BISITE) 1
"RTN","BIPATUP2",119,0)
 N Y S Y=$P($G(^BISITE(BISITE,0)),U,27)
"RTN","BIPATUP2",120,0)
 Q:(Y=0) 0
"RTN","BIPATUP2",121,0)
 Q 1
"RTN","BIPATUP2",122,0)
 ;
"RTN","BIPATUP2",123,0)
 ;
"RTN","BIPATUP2",124,0)
 ;----------
"RTN","BIPATUP2",125,0)
ZOSTER(BISITE) ;EP - Return 1 if Zostervax should be forecast.
"RTN","BIPATUP2",126,0)
 ;---> Parameters:
"RTN","BIPATUP2",127,0)
 ;     1 - BISITE (req) User's DUZ(2)
"RTN","BIPATUP2",128,0)
 ;
"RTN","BIPATUP2",129,0)
 Q:'$G(BISITE) 1
"RTN","BIPATUP2",130,0)
 N Y S Y=$P($G(^BISITE(BISITE,0)),U,29)
"RTN","BIPATUP2",131,0)
 Q:(Y=0) 0
"RTN","BIPATUP2",132,0)
 Q 1
"RTN","BIPATUP2",133,0)
 ;
"RTN","BIPATUP2",134,0)
 ;
"RTN","BIPATUP2",135,0)
 ;----------
"RTN","BIPATUP2",136,0)
SETDUE(BIDATA) ;EP
"RTN","BIPATUP2",137,0)
 ;---> Code to add this Immunization Due to BI PATIENT IMM DUE File #9002084.1.
"RTN","BIPATUP2",138,0)
 ;---> Hardcoded to improve performance during massive reports.
"RTN","BIPATUP2",139,0)
 ;---> Parameters:
"RTN","BIPATUP2",140,0)
 ;     1 - BIDATA (req) Data string (5 fields) for 0-node.
"RTN","BIPATUP2",141,0)
 ;                      BIDFN^Vaccine IEN^Dose#^Recommended Date^Date Past Due
"RTN","BIPATUP2",142,0)
 ;
"RTN","BIPATUP2",143,0)
 Q:$G(BIDATA)=""
"RTN","BIPATUP2",144,0)
 N A,B,BIDFN,M,N
"RTN","BIPATUP2",145,0)
 S M=^BIPDUE(0),N=$P(M,U,3),M=$P(M,U,4) S:'N N=1
"RTN","BIPATUP2",146,0)
 F  Q:'$D(^BIPDUE(N))  S N=N+1
"RTN","BIPATUP2",147,0)
 S BIDFN=$P(BIDATA,U) Q:'BIDFN
"RTN","BIPATUP2",148,0)
 S ^BIPDUE(N,0)=BIDATA
"RTN","BIPATUP2",149,0)
 ;
"RTN","BIPATUP2",150,0)
 ;********** PATCH 1, v8.3.1, Dec 30,2008, IHS/CMI/MWR
"RTN","BIPATUP2",151,0)
 ;---> Add 6th pc, Date Forecast Calculated.
"RTN","BIPATUP2",152,0)
 S:$G(DT) $P(^BIPDUE(N,0),U,6)=DT
"RTN","BIPATUP2",153,0)
 ;**********
"RTN","BIPATUP2",154,0)
 ;
"RTN","BIPATUP2",155,0)
 S ^BIPDUE("B",BIDFN,N)=""
"RTN","BIPATUP2",156,0)
 S A=$P(BIDATA,U,4),B=$P(BIDATA,U,5)
"RTN","BIPATUP2",157,0)
 I A S ^BIPDUE("D",A,N)=""
"RTN","BIPATUP2",158,0)
 I B S ^BIPDUE("D",B,N)="",^BIPDUE("E",BIDFN,B,N)=""
"RTN","BIPATUP2",159,0)
 S $P(^BIPDUE(0),U,3,4)=N_U_(M+1)
"RTN","BIPATUP2",160,0)
 Q
"RTN","BIPATUP3")
0^77^B7260631
"RTN","BIPATUP3",1,0)
BIPATUP3 ;IHS/CMI/MWR - UPDATE PATIENT DATA 2; DEC 15, 2011
"RTN","BIPATUP3",2,0)
 ;;8.5;IMMUNIZATION;**4**;DEC 01,2012;Build 2
"RTN","BIPATUP3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATUP3",4,0)
 ;;  IHS FORECAST. UPDATE PATIENT DATA, IMM FORECAST IN ^BIPDUE(.
"RTN","BIPATUP3",5,0)
 ;;  HOLDING RTN IN CASE H1N1 (OR SIMILAR) FORECASTING IS NEEDED IN THE FUTURE.
"RTN","BIPATUP3",6,0)
 ;;  PATCH 1: Clarify Report explanation.  IHSZOS+19
"RTN","BIPATUP3",7,0)
 ;;  PATCH 4, v8.5: Use newer Related Contraindications call to determine
"RTN","BIPATUP3",8,0)
 ;;                 contraindicaton.  IHSZOS+29
"RTN","BIPATUP3",9,0)
 ;
"RTN","BIPATUP3",10,0)
 ;----------
"RTN","BIPATUP3",11,0)
IHSZOS(BIDFN,BIFLU,BIFFLU,BIRISKP,BINF,BIFDT,BIAGE,BIDUZ2) ;EP
"RTN","BIPATUP3",12,0)
 ;---> IHS Zoster Forecast.
"RTN","BIPATUP3",13,0)
 ;---> Parameters:
"RTN","BIPATUP3",14,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP3",15,0)
 ;     2 - BIFLU   (req) Influ and Pneumo History array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP3",16,0)
 ;     3 - BIFFLU  (req) Value (0-4) for force Flu/Pneumo regardless of age.
"RTN","BIPATUP3",17,0)
 ;     4 - BIRISKP (req) 1=Patient has Risk of Pneumo; otherwise 0.
"RTN","BIPATUP3",18,0)
 ;     5 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP3",19,0)
 ;     6 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP3",20,0)
 ;     7 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP3",21,0)
 ;     8 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP3",22,0)
 ;
"RTN","BIPATUP3",23,0)
 ;
"RTN","BIPATUP3",24,0)
 ;---> Quit if this Pt Age <60 months (5yrs), regardless of risk.
"RTN","BIPATUP3",25,0)
 Q:BIAGE<720
"RTN","BIPATUP3",26,0)
 ;
"RTN","BIPATUP3",27,0)
 ;---> Quit if Site Parameter 11 says NO to Zoster forecast.
"RTN","BIPATUP3",28,0)
 ;---> (According to Amy, shutting down Varicella Group should not disable Zoster.)
"RTN","BIPATUP3",29,0)
 ;
"RTN","BIPATUP3",30,0)
 ;********** PATCH 1, v8.5, JAN 03,2012, IHS/CMI/MWR
"RTN","BIPATUP3",31,0)
 ;---> Use passed parameter BIDUZ2 to avoid <UNDEF> of BISITE.
"RTN","BIPATUP3",32,0)
 ;Q:('$$ZOSTER^BIPATUP2(BISITE))
"RTN","BIPATUP3",33,0)
 Q:('$$ZOSTER^BIPATUP2(BIDUZ2))
"RTN","BIPATUP3",34,0)
 ;**********
"RTN","BIPATUP3",35,0)
 ;
"RTN","BIPATUP3",36,0)
 ;---> Quit if patient has a previous Zoster.
"RTN","BIPATUP3",37,0)
 Q:$D(BIFLU(121))
"RTN","BIPATUP3",38,0)
 ;
"RTN","BIPATUP3",39,0)
 ;---> Quit if this patient has a contraindication to Zoster.
"RTN","BIPATUP3",40,0)
 ;********** PATCH 4, v8.5, DEC 01,2012, IHS/CMI/MWR
"RTN","BIPATUP3",41,0)
 ;---> Use newer Related Contraindications call to determine contraindication.
"RTN","BIPATUP3",42,0)
 ;Q:$$CONTR^BIUTL11(BIDFN,227)
"RTN","BIPATUP3",43,0)
 N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIPATUP3",44,0)
 Q:$D(BICT(121))
"RTN","BIPATUP3",45,0)
 ;**********
"RTN","BIPATUP3",46,0)
 ;
"RTN","BIPATUP3",47,0)
 ;---> Forecast Zoster.
"RTN","BIPATUP3",48,0)
 D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(121)_U_U_BIFDT)
"RTN","BIPATUP3",49,0)
 ;
"RTN","BIPATUP3",50,0)
 Q
"RTN","BIPATUP3",51,0)
 ;
"RTN","BIPATUP3",52,0)
 ;
"RTN","BIPATUP3",53,0)
 ;----------
"RTN","BIPATUP3",54,0)
IHSH1N1(BIDFN,BIFLU,BIFFLU,BIRISKI,BINF,BIFDT,BIAGE,BIIMMH1,BILIVE) ;EP
"RTN","BIPATUP3",55,0)
 ;---> IHS H1N1 Forecast.
"RTN","BIPATUP3",56,0)
 ;---> Parameters:
"RTN","BIPATUP3",57,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP3",58,0)
 ;     2 - BIFLU   (req) Influ, Pneumo, and H1N1 History array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP3",59,0)
 ;     3 - BIFFLU  (req) * NOT USED FOR NOW! *
"RTN","BIPATUP3",60,0)
 ;                       Value (0-4) for force Flu/Pneumo regardless of age.
"RTN","BIPATUP3",61,0)
 ;     4 - BIRISKI (req) 1=Patient has Risk of Influenza; otherwise 0.
"RTN","BIPATUP3",62,0)
 ;     5 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP3",63,0)
 ;     6 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP3",64,0)
 ;     7 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP3",65,0)
 ;     8 - BIIMMH1 (opt) BIIMMFL=1 means Immserve already forecast H1N1.
"RTN","BIPATUP3",66,0)
 ;     9 - BILIVE  (opt) 1-Patient received a LIVE vaccine <28 days before
"RTN","BIPATUP3",67,0)
 ;                       the forecast date.
"RTN","BIPATUP3",68,0)
 ;
"RTN","BIPATUP3",69,0)
 ;---> Quit if Forecasting turned off for H1N1.
"RTN","BIPATUP3",70,0)
 Q:$D(BINF(18))
"RTN","BIPATUP3",71,0)
 ;
"RTN","BIPATUP3",72,0)
 ;---> Quit if Immserve already forecast H1N1.
"RTN","BIPATUP3",73,0)
 Q:$G(BIIMMH1)
"RTN","BIPATUP3",74,0)
 ;
"RTN","BIPATUP3",75,0)
 ;***********************************************************
"RTN","BIPATUP3",76,0)
 ;********** PATCH 4, v8.3, DEC 30,2009, IHS/CMI/MWR
"RTN","BIPATUP3",77,0)
 ;---> PATCH: No longer consider live vaccine factor in H1N1 forecasting.
"RTN","BIPATUP3",78,0)
 ;---> Quit if patient received a LIVE vaccine <28 days before forecast date.
"RTN","BIPATUP3",79,0)
 ;---> Also quit if patient received Flu-nasal CVX 111 on the Forecast Date.
"RTN","BIPATUP3",80,0)
 ;Q:$G(BILIVE)
"RTN","BIPATUP3",81,0)
 ;***********************************************************
"RTN","BIPATUP3",82,0)
 ;
"RTN","BIPATUP3",83,0)
 ;---> Set numeric Year, Month, and MonthDay.
"RTN","BIPATUP3",84,0)
 N BIYEAR,BIMTH,BIMDAY
"RTN","BIPATUP3",85,0)
 S BIYEAR=$E(BIFDT,1,3),BIMTH=$E(BIFDT,4,5),BIMDAY=+$E(BIFDT,4,7)
"RTN","BIPATUP3",86,0)
 ;
"RTN","BIPATUP3",87,0)
 ;---> Quit if the Forecast Date is not between Oct 1 and April 30.
"RTN","BIPATUP3",88,0)
 Q:((BIMDAY<1001)&(BIMDAY>430))
"RTN","BIPATUP3",89,0)
 ;
"RTN","BIPATUP3",90,0)
 ;---> Quit if this patient has a contraindication to H1N1.
"RTN","BIPATUP3",91,0)
 N BICONTR D CONTRA^BIUTL11(BIDFN,.BICONTR)
"RTN","BIPATUP3",92,0)
 Q:$D(BICONTR(125))
"RTN","BIPATUP3",93,0)
 ;
"RTN","BIPATUP3",94,0)
 ;---> Change: Quit if patient is <6 months.
"RTN","BIPATUP3",95,0)
 Q:BIAGE<6
"RTN","BIPATUP3",96,0)
 ;
"RTN","BIPATUP3",97,0)
 ;---> Get value for forced Influenza regardless of age.
"RTN","BIPATUP3",98,0)
 ;S:(31'[BIFFLU) BIFFLU=0
"RTN","BIPATUP3",99,0)
 ;
"RTN","BIPATUP3",100,0)
 ;---> Quit if over 65 yrs old and no previous H1N1 dose (regardless of risk).
"RTN","BIPATUP3",101,0)
 Q:((BIAGE>779)&('$D(BIFLU(125))))
"RTN","BIPATUP3",102,0)
 ;
"RTN","BIPATUP3",103,0)
 ;---> Forecast H1N1 up to 25 yrs old, and over 50 yrs.
"RTN","BIPATUP3",104,0)
 ;---> Quit if not age appropriate and no risk and not forced and no previous H1N1 dose.
"RTN","BIPATUP3",105,0)
 Q:((BIAGE>299)&('BIRISKI)&('BIFFLU)&('$D(BIFLU(125))))
"RTN","BIPATUP3",106,0)
 ;
"RTN","BIPATUP3",107,0)
 ;***********************************************************
"RTN","BIPATUP3",108,0)
 ;********** PATCH 4, v8.3, DEC 30,2009, IHS/CMI/MWR
"RTN","BIPATUP3",109,0)
 ;
"RTN","BIPATUP3",110,0)
 ;---> Quit if patient is 10yrs or older and has a one H1N1 already.
"RTN","BIPATUP3",111,0)
 ;Q:((BIAGE>120)&($D(BIFLU(125))))
"RTN","BIPATUP3",112,0)
 Q:((BIAGE'<120)&($D(BIFLU(125))))
"RTN","BIPATUP3",113,0)
 ;
"RTN","BIPATUP3",114,0)
 ;---> PATCH: Quit if the patient has had 2 doses.
"RTN","BIPATUP3",115,0)
 N M,N S M=0,N=0
"RTN","BIPATUP3",116,0)
 F  S M=$O(BIFLU(125,M)) Q:'M  S N=N+1
"RTN","BIPATUP3",117,0)
 Q:(N>1)
"RTN","BIPATUP3",118,0)
 ;***********************************************************
"RTN","BIPATUP3",119,0)
 ;
"RTN","BIPATUP3",120,0)
 N X,X1,X2
"RTN","BIPATUP3",121,0)
 S X1=BIFDT,X2=9999999-$O(BIFLU(125,0)) S:X2=9999999 X2=0
"RTN","BIPATUP3",122,0)
 D ^%DTC
"RTN","BIPATUP3",123,0)
 ;---> Quit if patient received a H1N1 shot today.
"RTN","BIPATUP3",124,0)
 Q:X=0
"RTN","BIPATUP3",125,0)
 ;---> Quit if patient had a H1N1 vac <28 days prior to Forecast date.
"RTN","BIPATUP3",126,0)
 Q:((X>0)&(X<28))
"RTN","BIPATUP3",127,0)
 ;
"RTN","BIPATUP3",128,0)
 ;---> X must be either null (never had flu shot) or negative (had
"RTN","BIPATUP3",129,0)
 ;---> a shot recently, but AFTER the Forecast Date).
"RTN","BIPATUP3",130,0)
 ;
"RTN","BIPATUP3",131,0)
 ;---> If not Jan, Feb, or March, then due date=Apr 30 of the new year.
"RTN","BIPATUP3",132,0)
 S:BIMDAY>430 BIYEAR=BIYEAR+1
"RTN","BIPATUP3",133,0)
 ;---> Due by April 30.
"RTN","BIPATUP3",134,0)
 N BIDUEDT S BIDUEDT=BIYEAR_0430
"RTN","BIPATUP3",135,0)
 ;---> Set CVX 127 due by April 30.
"RTN","BIPATUP3",136,0)
 D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(127)_U_U_BIYEAR_"0430")
"RTN","BIPATUP3",137,0)
 Q
"RTN","BIPATVW")
0^78^B50308275
"RTN","BIPATVW",1,0)
BIPATVW ;IHS/CMI/MWR - VIEW PATIENT IMM DATA; MAY 10, 2010
"RTN","BIPATVW",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPATVW",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATVW",4,0)
 ;;  VIEW PATIENT'S IMMUNIZATION DATA AND ALLOW EDITS
"RTN","BIPATVW",5,0)
 ;;  THROUGH LISTMANAGER.
"RTN","BIPATVW",6,0)
 ;
"RTN","BIPATVW",7,0)
 ;
"RTN","BIPATVW",8,0)
 ;----------
"RTN","BIPATVW",9,0)
START ;EP
"RTN","BIPATVW",10,0)
 ;---> Lookup patients, view and edit their Immunization data.
"RTN","BIPATVW",11,0)
 ;
"RTN","BIPATVW",12,0)
 D SETVARS^BIUTL5 N BIDFN,BIFDT,BIPOP,BIRTN
"RTN","BIPATVW",13,0)
 F  D  Q:$G(BIDFN)<1
"RTN","BIPATVW",14,0)
 .D TITLE^BIUTL5("VIEW PATIENT IMMUNIZATION DATA")
"RTN","BIPATVW",15,0)
 .D PATLKUP^BIUTL8(.BIDFN,$S($$MAYEDIT^BIUTL11:"ADD",1:""),DUZ(2),.BIPOP)
"RTN","BIPATVW",16,0)
 .Q:$G(BIPOP)  Q:$G(BIDFN)<1
"RTN","BIPATVW",17,0)
 .D DATE(.BIFDT,.BIPOP)
"RTN","BIPATVW",18,0)
 .Q:BIPOP
"RTN","BIPATVW",19,0)
 .D EN(BIDFN,$$MAYEDIT^BIUTL11,BIFDT,DUZ(2))
"RTN","BIPATVW",20,0)
 .D UNLOCK($G(BIDFN))
"RTN","BIPATVW",21,0)
 D EXIT
"RTN","BIPATVW",22,0)
 Q
"RTN","BIPATVW",23,0)
 ;
"RTN","BIPATVW",24,0)
 ;
"RTN","BIPATVW",25,0)
 ;----------
"RTN","BIPATVW",26,0)
ONEPAT ;EP
"RTN","BIPATVW",27,0)
 ;---> Lookup patients, view and edit their Immunization data.
"RTN","BIPATVW",28,0)
 ;
"RTN","BIPATVW",29,0)
 D SETVARS^BIUTL5 N BIDFN,BIFDT,BIPOP,BIRTN
"RTN","BIPATVW",30,0)
 D
"RTN","BIPATVW",31,0)
 .D PATLKUP^BIUTL8(.BIDFN,$S($$MAYEDIT^BIUTL11:"ADD",1:""),DUZ(2),.BIPOP)
"RTN","BIPATVW",32,0)
 .Q:$G(BIPOP)  Q:$G(BIDFN)<1
"RTN","BIPATVW",33,0)
 .D DATE(.BIFDT,.BIPOP)
"RTN","BIPATVW",34,0)
 .Q:BIPOP
"RTN","BIPATVW",35,0)
 .D EN(BIDFN,$$MAYEDIT^BIUTL11,BIFDT,DUZ(2))
"RTN","BIPATVW",36,0)
 .D UNLOCK($G(BIDFN))
"RTN","BIPATVW",37,0)
 D EXIT
"RTN","BIPATVW",38,0)
 Q
"RTN","BIPATVW",39,0)
 ;
"RTN","BIPATVW",40,0)
 ;
"RTN","BIPATVW",41,0)
 ;----------
"RTN","BIPATVW",42,0)
HAVEPAT(BIDFN,BIFDT,BIPRT,BIPOP) ;EP
"RTN","BIPATVW",43,0)
 ;---> Entry point when patient is already known.
"RTN","BIPATVW",44,0)
 ;---> Parameters:
"RTN","BIPATVW",45,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIPATVW",46,0)
 ;     2 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIPATVW",47,0)
 ;     3 - BIPRT  (opt) If BIPRT=1 this call is to print.
"RTN","BIPATVW",48,0)
 ;     4 - BIPOP  (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BIPATVW",49,0)
 ;
"RTN","BIPATVW",50,0)
 D SETVARS^BIUTL5 S BIPOP=0 N BIN ;(Preserve BIN from calls above.)
"RTN","BIPATVW",51,0)
 I '$G(BIDFN)  D ERRCD^BIUTL2(201,,1) S BIPOP=1 Q
"RTN","BIPATVW",52,0)
 I '$D(^AUPNPAT(BIDFN)) D ERRCD^BIUTL2(203,,1) S BIPOP=1 Q
"RTN","BIPATVW",53,0)
 K ^BITMP($J),^TMP("BILMVW",$J)
"RTN","BIPATVW",54,0)
 S ^BITMP($J,1,BIDFN)=""
"RTN","BIPATVW",55,0)
 D:'$G(BIFDT) DATE(.BIFDT,.BIPOP)
"RTN","BIPATVW",56,0)
 Q:BIPOP
"RTN","BIPATVW",57,0)
 D EN(BIDFN,$S($G(BIPRT):2,1:$$MAYEDIT^BIUTL11),$G(BIFDT),DUZ(2))
"RTN","BIPATVW",58,0)
 Q
"RTN","BIPATVW",59,0)
 ;
"RTN","BIPATVW",60,0)
 ;
"RTN","BIPATVW",61,0)
 ;----------
"RTN","BIPATVW",62,0)
EN(BIDFN,BIEDIT,BIFDT,BIDUZ2) ;EP
"RTN","BIPATVW",63,0)
 ;---> Main entry point to call Lists: BI PATIENT DATA VIEW/EDIT
"RTN","BIPATVW",64,0)
 ;---> and BI PATIENT VIEW ONLY.
"RTN","BIPATVW",65,0)
 ;---> Parameters:
"RTN","BIPATVW",66,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIPATVW",67,0)
 ;     2 - BIEDIT (opt) Null or 0=View only; 1=View/Edit, 2=Print.
"RTN","BIPATVW",68,0)
 ;     3 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIPATVW",69,0)
 ;     4 - BIDUZ2 (req) User's DUZ(2) for BISITE parameters,
"RTN","BIPATVW",70,0)
 ;                      which affect forecasting rules.
"RTN","BIPATVW",71,0)
 ;
"RTN","BIPATVW",72,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) Q
"RTN","BIPATVW",73,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW",74,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW",75,0)
 ;
"RTN","BIPATVW",76,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIPATVW",77,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIPATVW",78,0)
 ;
"RTN","BIPATVW",79,0)
 ;---> BIHX contains the patient's Immunization History and is
"RTN","BIPATVW",80,0)
 ;---> used by various protocols and actions in Listmanager.
"RTN","BIPATVW",81,0)
 N BIHX,DFN S DFN=BIDFN  ;For now with Linda's view reg templates.
"RTN","BIPATVW",82,0)
 ;
"RTN","BIPATVW",83,0)
 ;---> Print Patient Data and quit.
"RTN","BIPATVW",84,0)
 ;---> (Called by Protocol BI PATIENT VIEW PRINT.)
"RTN","BIPATVW",85,0)
 I $G(BIEDIT)=2 D PRINT Q
"RTN","BIPATVW",86,0)
 ;
"RTN","BIPATVW",87,0)
 ;---> Select List Template to View/Edit or View Only.
"RTN","BIPATVW",88,0)
 S BILIST="BI PATIENT DATA VIEW"_$S($G(BIEDIT)=1:"/EDIT",1:" ONLY")
"RTN","BIPATVW",89,0)
 I '$D(^SD(409.61,"B",BILIST)) D ERRCD^BIUTL2(628,,1) Q
"RTN","BIPATVW",90,0)
 D EN^VALM(BILIST)
"RTN","BIPATVW",91,0)
 Q
"RTN","BIPATVW",92,0)
 ;
"RTN","BIPATVW",93,0)
 ;
"RTN","BIPATVW",94,0)
 ;----------
"RTN","BIPATVW",95,0)
PRINT ;EP
"RTN","BIPATVW",96,0)
 ;---> Print Patient Data screen.
"RTN","BIPATVW",97,0)
 ;---> Called by Protocol BI PATIENT VIEW PRINT, which is the
"RTN","BIPATVW",98,0)
 ;---> Print List Protocol for Lists: BI PATIENT DATA VIEW/EDIT and
"RTN","BIPATVW",99,0)
 ;---> BI PATIENT DATA VIEW ONLY.
"RTN","BIPATVW",100,0)
 ;
"RTN","BIPATVW",101,0)
 D DEVICE(.BIPOP)
"RTN","BIPATVW",102,0)
 I $G(BIPOP) D RESET Q
"RTN","BIPATVW",103,0)
 ;
"RTN","BIPATVW",104,0)
 D HDR(1),MAIN^BIPATVW1(1)
"RTN","BIPATVW",105,0)
 D PRTLST^BIUTL8("BILMVW")
"RTN","BIPATVW",106,0)
 D RESET
"RTN","BIPATVW",107,0)
 Q
"RTN","BIPATVW",108,0)
 ;
"RTN","BIPATVW",109,0)
 ;
"RTN","BIPATVW",110,0)
 ;----------
"RTN","BIPATVW",111,0)
HDR(BIPRT) ;EP
"RTN","BIPATVW",112,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BIPATVW",113,0)
 ;---> Parameters:
"RTN","BIPATVW",114,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Add Privacy Act
"RTN","BIPATVW",115,0)
 ;                      line and Site Header line.
"RTN","BIPATVW",116,0)
 ;
"RTN","BIPATVW",117,0)
 ; ven/smh: rm all IOV* variables. New LM doesn't support presence of ctrl chars
"RTN","BIPATVW",118,0)
 ;
"RTN","BIPATVW",119,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BIPATVW",120,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIPATVW",121,0)
 ;
"RTN","BIPATVW",122,0)
 D WH^BIW(.BILINE)
"RTN","BIPATVW",123,0)
 ;
"RTN","BIPATVW",124,0)
 D:$G(BIPRT)
"RTN","BIPATVW",125,0)
 .S X="WARNING: Confidential Patient Information, Privacy Act applies."
"RTN","BIPATVW",126,0)
 .D WH^BIW(.BILINE,"   "_X,1)
"RTN","BIPATVW",127,0)
 .;
"RTN","BIPATVW",128,0)
 .S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIPATVW",129,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIPATVW",130,0)
 .S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIPATVW",131,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BIPATVW",132,0)
 ;
"RTN","BIPATVW",133,0)
 S Y=$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATVW",134,0)
 S X=" Patient: "
"RTN","BIPATVW",135,0)
 S X=X_Y
"RTN","BIPATVW",136,0)
 S X=X_$$SP^BIUTL5(27-$L(Y))_"DOB: "
"RTN","BIPATVW",137,0)
 S X=X_$$DOBF^BIUTL1(BIDFN,$G(BIFDT))
"RTN","BIPATVW",138,0)
 D WH^BIW(.BILINE,X)
"RTN","BIPATVW",139,0)
 S X="  Chart#: "
"RTN","BIPATVW",140,0)
 S X=X_$$HRCN^BIUTL1(BIDFN)
"RTN","BIPATVW",141,0)
 S Y=$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)
"RTN","BIPATVW",142,0)
 S X=X_" at "_Y
"RTN","BIPATVW",143,0)
 S X=X_$$SP^BIUTL5(49-$L(X))_$$ACTIVE^BIUTL1(BIDFN)
"RTN","BIPATVW",144,0)
 S X=X_"   "_$$SEXW^BIUTL1(BIDFN)
"RTN","BIPATVW",145,0)
 D:$D(^BIP(BIDFN,0))
"RTN","BIPATVW",146,0)
 .S X=X_"    "_"M HBsAg: "_$E($$MOTHER^BIUTL11(BIDFN,1),1,3)
"RTN","BIPATVW",147,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIPATVW",148,0)
 D:$G(BIPRT)
"RTN","BIPATVW",149,0)
 .S X="  #  Immunization History                  |   Immunizations DUE"
"RTN","BIPATVW",150,0)
 .S:$G(BIFDT) X=X_" on "_$$SLDT2^BIUTL5(BIFDT)
"RTN","BIPATVW",151,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIPATVW",152,0)
 ;
"RTN","BIPATVW",153,0)
 ;---> Set Screen Title.
"RTN","BIPATVW",154,0)
 S VALM("TITLE")="PATIENT VIEW (IMM v"_$$VER^BILOGO_")"
"RTN","BIPATVW",155,0)
 Q
"RTN","BIPATVW",156,0)
 ;
"RTN","BIPATVW",157,0)
 ;
"RTN","BIPATVW",158,0)
 ;----------
"RTN","BIPATVW",159,0)
INIT ;EP
"RTN","BIPATVW",160,0)
 ;---> Initialize variables and list array.
"RTN","BIPATVW",161,0)
 D MAIN^BIPATVW1()
"RTN","BIPATVW",162,0)
 S BIRTN="BIPATVW"
"RTN","BIPATVW",163,0)
 Q
"RTN","BIPATVW",164,0)
 ;
"RTN","BIPATVW",165,0)
 ;
"RTN","BIPATVW",166,0)
 ;----------
"RTN","BIPATVW",167,0)
DATE(BIFDT,BIPOP) ;EP
"RTN","BIPATVW",168,0)
 ;---> Ask Forecast Date.
"RTN","BIPATVW",169,0)
 ;---> Parameters:
"RTN","BIPATVW",170,0)
 ;     1 - BIFDT (ret) Forecast Date, Fileman format.
"RTN","BIPATVW",171,0)
 ;               (opt) Default Date.
"RTN","BIPATVW",172,0)
 ;     2 - BIPOP (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BIPATVW",173,0)
 ;
"RTN","BIPATVW",174,0)
 N BIDFLT,DIR
"RTN","BIPATVW",175,0)
DATE1 ;EP
"RTN","BIPATVW",176,0)
 S BIPOP=0
"RTN","BIPATVW",177,0)
 S:$G(BIFDT)="" BIFDT=DT
"RTN","BIPATVW",178,0)
 S BIDFLT=$$TXDT^BIUTL5(BIFDT)
"RTN","BIPATVW",179,0)
 D HELP1
"RTN","BIPATVW",180,0)
 S DIR(0)="DA^::EX"
"RTN","BIPATVW",181,0)
 S DIR("A")="  Select Forecast Date: ",DIR("B")=BIDFLT
"RTN","BIPATVW",182,0)
 D ^DIR W !
"RTN","BIPATVW",183,0)
 I $D(DIRUT) S BIPOP=1 Q
"RTN","BIPATVW",184,0)
 S BIFDT=$P(Y,".")
"RTN","BIPATVW",185,0)
 I BIFDT<$$DOB^BIUTL1(BIDFN) D  G DATE1
"RTN","BIPATVW",186,0)
 .W !?5,"Date must be after patient's date of birth."
"RTN","BIPATVW",187,0)
 .K BIFDT D DIRZ^BIUTL3()
"RTN","BIPATVW",188,0)
 Q
"RTN","BIPATVW",189,0)
 ;
"RTN","BIPATVW",190,0)
 ;
"RTN","BIPATVW",191,0)
 ;----------
"RTN","BIPATVW",192,0)
HELP1 ;EP
"RTN","BIPATVW",193,0)
 ;;The "Forecast" is a list of immunizations that a patient is due
"RTN","BIPATVW",194,0)
 ;;to receive.
"RTN","BIPATVW",195,0)
 ;;
"RTN","BIPATVW",196,0)
 ;;You may view the immunizations that this patient WOULD BE due for
"RTN","BIPATVW",197,0)
 ;;on a date other than today (past or future).
"RTN","BIPATVW",198,0)
 D HELPTX("HELP1")
"RTN","BIPATVW",199,0)
 Q
"RTN","BIPATVW",200,0)
 ;
"RTN","BIPATVW",201,0)
 ;
"RTN","BIPATVW",202,0)
 ;----------
"RTN","BIPATVW",203,0)
HELPTX(BILINL,BITAB) ;EP
"RTN","BIPATVW",204,0)
 N I,T,X S T=""  S:'$D(BITAB) BITAB=5  F I=1:1:BITAB S T=T_" "
"RTN","BIPATVW",205,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","BIPATVW",206,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","BIPATVW",207,0)
 Q
"RTN","BIPATVW",208,0)
 ;
"RTN","BIPATVW",209,0)
 ;
"RTN","BIPATVW",210,0)
 ;----------
"RTN","BIPATVW",211,0)
RESET ;EP
"RTN","BIPATVW",212,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIPATVW",213,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATVW",214,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATVW",215,0)
 D INIT,HDR() Q
"RTN","BIPATVW",216,0)
 ;
"RTN","BIPATVW",217,0)
 ;
"RTN","BIPATVW",218,0)
 ;----------
"RTN","BIPATVW",219,0)
HELP ;EP
"RTN","BIPATVW",220,0)
 ;---> Help code.
"RTN","BIPATVW",221,0)
 N BIX S BIX=X
"RTN","BIPATVW",222,0)
 ;---> RPMS
"RTN","BIPATVW",223,0)
 I $T(EN^XBNEW)]"" D EN^XBNEW("HELP^BIPATVW3","VALM*;IO*") D:BIX'="??" RE^VALM4 QUIT
"RTN","BIPATVW",224,0)
 ;
"RTN","BIPATVW",225,0)
 ;---> VISTA (new version of LM... different behavior!!!)
"RTN","BIPATVW",226,0)
 N NVALM,NIO,NOR
"RTN","BIPATVW",227,0)
 N X,Y
"RTN","BIPATVW",228,0)
 S X="NVALM(",Y="VALM*" D ORDER^%ZOSV
"RTN","BIPATVW",229,0)
 S X="NXQOR(",Y="XQOR*" D ORDER^%ZOSV
"RTN","BIPATVW",230,0)
 S X="NOR(",Y="OR*"     D ORDER^%ZOSV
"RTN","BIPATVW",231,0)
 N IOLMVARS S IOLMVARS=$$IO^VALM0_";IOBON;IOBOFF;IOSGR0"
"RTN","BIPATVW",232,0)
 D
"RTN","BIPATVW",233,0)
 . N I S I="" F  S I=$O(NVALM(I)) Q:I=""  NEW @I
"RTN","BIPATVW",234,0)
 . N I S I="" F  S I=$O(NXQOR(I)) Q:I=""  NEW @I
"RTN","BIPATVW",235,0)
 . N I S I="" F  S I=$O(NOR(I)) Q:I=""  NEW @I
"RTN","BIPATVW",236,0)
 . N I,J F I=1:1:$L(IOLMVARS,";") S J=$P(IOLMVARS,";",I) N @J
"RTN","BIPATVW",237,0)
 . K ^TMP("BIXQORS-SAVE",$J)
"RTN","BIPATVW",238,0)
 . M ^TMP("BIXQORS-SAVE",$J)=^TMP("XQORS",$J)
"RTN","BIPATVW",239,0)
 . D HELP^BIPATVW3
"RTN","BIPATVW",240,0)
 . M ^TMP("XQORS",$J)=^TMP("BIXQORS-SAVE",$J)
"RTN","BIPATVW",241,0)
 . K ^TMP("BIXQORS-SAVE",$J)
"RTN","BIPATVW",242,0)
 D:BIX'="??" RE^VALM4
"RTN","BIPATVW",243,0)
 QUIT
"RTN","BIPATVW",244,0)
 ;
"RTN","BIPATVW",245,0)
 ;
"RTN","BIPATVW",246,0)
 ;----------
"RTN","BIPATVW",247,0)
EXIT ;EP
"RTN","BIPATVW",248,0)
 ;---> EOJ Cleanup.
"RTN","BIPATVW",249,0)
 D KILLALL^BIUTL8(1)
"RTN","BIPATVW",250,0)
 K ^TMP("BILMVW",$J)
"RTN","BIPATVW",251,0)
 D CLEAR^VALM1
"RTN","BIPATVW",252,0)
 D FULL^VALM1
"RTN","BIPATVW",253,0)
 Q
"RTN","BIPATVW",254,0)
 ;
"RTN","BIPATVW",255,0)
 ;
"RTN","BIPATVW",256,0)
 ;----------
"RTN","BIPATVW",257,0)
DEVICE(BIPOP) ;EP
"RTN","BIPATVW",258,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIPATVW",259,0)
 ;---> Parameters:
"RTN","BIPATVW",260,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIPATVW",261,0)
 ;
"RTN","BIPATVW",262,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIPATVW",263,0)
 S ZTRTN="DEQUEUE^BIPATVW"
"RTN","BIPATVW",264,0)
 D ZSAVES^BIUTL3
"RTN","BIPATVW",265,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIPATVW",266,0)
 Q
"RTN","BIPATVW",267,0)
 ;
"RTN","BIPATVW",268,0)
 ;
"RTN","BIPATVW",269,0)
 ;----------
"RTN","BIPATVW",270,0)
DEQUEUE ;EP
"RTN","BIPATVW",271,0)
 ;---> Print Patient Data screen.
"RTN","BIPATVW",272,0)
 D HDR(1),MAIN^BIPATVW1(1)
"RTN","BIPATVW",273,0)
 D PRTLST^BIUTL8("BILMVW"),EXIT
"RTN","BIPATVW",274,0)
 Q
"RTN","BIPATVW",275,0)
 ;
"RTN","BIPATVW",276,0)
 ;
"RTN","BIPATVW",277,0)
 ;----------
"RTN","BIPATVW",278,0)
UNLOCK(BIDFN) ;EP
"RTN","BIPATVW",279,0)
 ;---> Unlock BI PATIENT global for this patient.
"RTN","BIPATVW",280,0)
 ;---> Parameters:
"RTN","BIPATVW",281,0)
 ;     1 - BIDFN (req) Patient DFN to unlock.
"RTN","BIPATVW",282,0)
 ;
"RTN","BIPATVW",283,0)
 Q:'$G(BIDFN)
"RTN","BIPATVW",284,0)
 N I F I=1:1:5  L -^BIP(BIDFN)
"RTN","BIPATVW",285,0)
 Q
"RTN","BIPATVW",286,0)
 ;
"RTN","BIPATVW",287,0)
 ;
"RTN","BIPATVW",288,0)
 ;----------
"RTN","BIPATVW",289,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIPATVW",290,0)
 Q:$G(BILINL)=""
"RTN","BIPATVW",291,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPATVW",292,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIPATVW",293,0)
 Q
"RTN","BIPATVW1")
0^79^B83032319
"RTN","BIPATVW1",1,0)
BIPATVW1 ;IHS/CMI/MWR - BUILD LIST ARRAY OF IMM DATA; MAY 10, 2010
"RTN","BIPATVW1",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIPATVW1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATVW1",4,0)
 ;;  BUILD LISTMANAGER ARRAY FOR DISPLAY AND EDIT OF
"RTN","BIPATVW1",5,0)
 ;;  PATIENT'S IMMUNIZATION DATA.
"RTN","BIPATVW1",6,0)
 ;;  PATCH 8: Changes for Invalid Doese from TCH Forecaster  HISTORY+55,+81
"RTN","BIPATVW1",7,0)
 ;
"RTN","BIPATVW1",8,0)
 ;
"RTN","BIPATVW1",9,0)
 ;----------
"RTN","BIPATVW1",10,0)
MAIN(BIPRT) ;EP
"RTN","BIPATVW1",11,0)
 ;---> Build LM array for Patient Data Screen.
"RTN","BIPATVW1",12,0)
 ;---> Parameters:
"RTN","BIPATVW1",13,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: skip INIT.
"RTN","BIPATVW1",14,0)
 ;
"RTN","BIPATVW1",15,0)
 ;---> Check for BIDFN.
"RTN","BIPATVW1",16,0)
 Q:$$DFNCHECK^BIUTL2()
"RTN","BIPATVW1",17,0)
 Q:$$DUZCHECK^BIUTL2()
"RTN","BIPATVW1",18,0)
 ;
"RTN","BIPATVW1",19,0)
 N BI31,BIENT,BIFORCST,BILINE,BIPDSS,BIRETVAL,BIRETERR,BILMAX,BIRMAX
"RTN","BIPATVW1",20,0)
 S BIENT=0,BILMAX=0,BIRMAX=0,BI31=$C(31)_$C(31)
"RTN","BIPATVW1",21,0)
 S:'$G(BIFDT) BIFDT=$G(DT)
"RTN","BIPATVW1",22,0)
 ;
"RTN","BIPATVW1",23,0)
 D:'$G(BIPRT) INIT
"RTN","BIPATVW1",24,0)
 ;---> Get forecast string (BIFORCST) and problem dose string (BIPDSS).
"RTN","BIPATVW1",25,0)
 ;---> Pass BIPDSS to HISTORY to mark problem doses with asterisks.
"RTN","BIPATVW1",26,0)
 ;---> Pass BIFORCST to FORECAST for display.
"RTN","BIPATVW1",27,0)
 D IMMFORC^BIRPC(.BIFORCST,BIDFN,BIFDT,,$G(BIDUZ2),.BIPDSS)
"RTN","BIPATVW1",28,0)
 D HISTORY(BIDFN,$G(BIPDSS),.BILMAX,.BIENT)
"RTN","BIPATVW1",29,0)
 D FORECAST(BIFORCST,.BIRMAX)
"RTN","BIPATVW1",30,0)
 D LASTLET^BIPATVW3(BIDFN,.BIRMAX,.BIENT)
"RTN","BIPATVW1",31,0)
 D CONTRAS^BIPATVW3(BIDFN,.BILMAX,.BIRMAX,.BIENT)
"RTN","BIPATVW1",32,0)
 ;
"RTN","BIPATVW1",33,0)
 N BILINE S BILINE=$S(BIRMAX>BILMAX:BIRMAX,1:BILMAX)
"RTN","BIPATVW1",34,0)
 D ADDINFO^BIPATVW3(BIDFN,.BILINE,.BIENT,$G(BIDUZ2),BIFDT)
"RTN","BIPATVW1",35,0)
 ;
"RTN","BIPATVW1",36,0)
 D:$G(BIPRT)
"RTN","BIPATVW1",37,0)
 .N X S X="Printed: "_$$NOW^BIUTL5() D CENTERT^BIUTL5(.X)
"RTN","BIPATVW1",38,0)
 .D WRITE(.BILINE,X)
"RTN","BIPATVW1",39,0)
 ;
"RTN","BIPATVW1",40,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIPATVW1",41,0)
 S VALMCNT=BILINE
"RTN","BIPATVW1",42,0)
 I VALMCNT>12 D
"RTN","BIPATVW1",43,0)
 .S VALMSG="Scroll down to view more. Type ?? or Q to QUIT."
"RTN","BIPATVW1",44,0)
 Q
"RTN","BIPATVW1",45,0)
 ;
"RTN","BIPATVW1",46,0)
 ;
"RTN","BIPATVW1",47,0)
 ;----------
"RTN","BIPATVW1",48,0)
INIT ;EP
"RTN","BIPATVW1",49,0)
 ;---> Initialize variables and list array.
"RTN","BIPATVW1",50,0)
 ;
"RTN","BIPATVW1",51,0)
 S VALMSG="Type ?? for more actions or Q to Quit."
"RTN","BIPATVW1",52,0)
 ;
"RTN","BIPATVW1",53,0)
 ;---> Set default date for Screenman (if not already set, today).
"RTN","BIPATVW1",54,0)
 S:'$D(BIDEFDT) BIDEFDT=$G(DT)
"RTN","BIPATVW1",55,0)
 ;
"RTN","BIPATVW1",56,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIPATVW1",57,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIPATVW1",58,0)
 ;
"RTN","BIPATVW1",59,0)
 ;---> Show Forecast Date on Imms Due column header.
"RTN","BIPATVW1",60,0)
 D:$G(BIFDT)
"RTN","BIPATVW1",61,0)
 .N X S X="Immunizations DUE on "_$$SLDT2^BIUTL5(BIFDT)
"RTN","BIPATVW1",62,0)
 .D CHGCAP^VALM("IMMUNIZATIONS DUE",X)
"RTN","BIPATVW1",63,0)
 Q
"RTN","BIPATVW1",64,0)
 ;
"RTN","BIPATVW1",65,0)
 ;
"RTN","BIPATVW1",66,0)
 ;----------
"RTN","BIPATVW1",67,0)
HISTORY(BIDFN,BIPDSS,BILMAX,BIENT) ;EP
"RTN","BIPATVW1",68,0)
 ;---> Gather Immunization History and set in Listman display array.
"RTN","BIPATVW1",69,0)
 ;---> Parameters:
"RTN","BIPATVW1",70,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATVW1",71,0)
 ;     2 - BIPDSS (opt) Returned string of Visit IEN's that are
"RTN","BIPATVW1",72,0)
 ;                        Problem Doses, according to ImmServe.
"RTN","BIPATVW1",73,0)
 ;     3 - BILMAX (ret) Maximum Left column line number.
"RTN","BIPATVW1",74,0)
 ;     4 - BIENT  (ret) Entry Number for LM selection in VALMY
"RTN","BIPATVW1",75,0)
 ;
"RTN","BIPATVW1",76,0)
 ;---> Check for BIDFN.
"RTN","BIPATVW1",77,0)
 Q:$$DFNCHECK^BIUTL2()
"RTN","BIPATVW1",78,0)
 ;
"RTN","BIPATVW1",79,0)
 ;---> Call RPC to gather Immunization History.
"RTN","BIPATVW1",80,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BIPATVW1",81,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BIPATVW1",82,0)
 ;
"RTN","BIPATVW1",83,0)
 N BIRETVAL,BIRETERR S BIRETVAL=""
"RTN","BIPATVW1",84,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,,1,0)
"RTN","BIPATVW1",85,0)
 ;
"RTN","BIPATVW1",86,0)
 ;---> If BIRETERR has a value, display it and quit.
"RTN","BIPATVW1",87,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIPATVW1",88,0)
 I BIRETERR]"" D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3() Q
"RTN","BIPATVW1",89,0)
 ;
"RTN","BIPATVW1",90,0)
 ;---> Set BIHX(BIDFN)=to a valid Immunization History for this patient.
"RTN","BIPATVW1",91,0)
 ;---> * NOTE! BIHX(BIDFN) is not newed; it is used to edit and delete
"RTN","BIPATVW1",92,0)
 ;       Immunizations for this patient (sub BIDFN for insurance).
"RTN","BIPATVW1",93,0)
 ;
"RTN","BIPATVW1",94,0)
 S BIHX(BIDFN)=$P(BIRETVAL,BI31,1)
"RTN","BIPATVW1",95,0)
 ;X ^O
"RTN","BIPATVW1",96,0)
 ;
"RTN","BIPATVW1",97,0)
 ;---> Build Listmanager array from BIHX(BIDFN) string.
"RTN","BIPATVW1",98,0)
 K ^TMP("BILMVW",$J)
"RTN","BIPATVW1",99,0)
 N BILINE,BISK,I,V,X,Y,Z
"RTN","BIPATVW1",100,0)
 S BILINE=0,V="|",Z=""
"RTN","BIPATVW1",101,0)
 ;
"RTN","BIPATVW1",102,0)
 ;---> Loop through "^"-pieces of Imm History, displaying.
"RTN","BIPATVW1",103,0)
 F I=1:1 S Y=$P(BIHX(BIDFN),U,I) Q:Y=""  D
"RTN","BIPATVW1",104,0)
 .;
"RTN","BIPATVW1",105,0)
 .;---> IMMUNIZATIONS
"RTN","BIPATVW1",106,0)
 .;---> If this is an Immunization, display as follows and quit.
"RTN","BIPATVW1",107,0)
 .I $P(Y,V)="I" D  Q
"RTN","BIPATVW1",108,0)
 ..;
"RTN","BIPATVW1",109,0)
 ..;---> If not the same Vaccine Group, insert a blank line.
"RTN","BIPATVW1",110,0)
 ..I $P(Y,V,6)'=Z D:I>1 RTCOL(.BILINE,,BIENT) S Z=$P(Y,V,6)
"RTN","BIPATVW1",111,0)
 ..;
"RTN","BIPATVW1",112,0)
 ..S BIENT=BIENT+1
"RTN","BIPATVW1",113,0)
 ..;---> Set display line for this immunization.
"RTN","BIPATVW1",114,0)
 ..S X=$S(BIENT>9:" ",1:"  ")_BIENT_"  "_$P(Y,V,17)
"RTN","BIPATVW1",115,0)
 ..;
"RTN","BIPATVW1",116,0)
 ..;---> Next line: Prepend asterisk if this Dose has a User Override
"RTN","BIPATVW1",117,0)
 ..;---> or is an ImmServe Problem Dose (flag stored in BIPDSSA).
"RTN","BIPATVW1",118,0)
 ..;---> (Override=pc 16, ImmServe string of prob doses=pc 4.)
"RTN","BIPATVW1",119,0)
 ..N A,BIPDSSA S A="  ",BIPDSSA=0
"RTN","BIPATVW1",120,0)
 ..D
"RTN","BIPATVW1",121,0)
 ...I $P(Y,V,16) S A=" *" Q
"RTN","BIPATVW1",122,0)
 ...;
"RTN","BIPATVW1",123,0)
 ...;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATVW1",124,0)
 ...;---> For now just flag invalid by V Imm IEN (not by component CVX).
"RTN","BIPATVW1",125,0)
 ...;W !!,Y,!!,$P(Y,V,18),!,BIPDSS,! R ZZZ
"RTN","BIPATVW1",126,0)
 ...I $$PDSS^BIUTL8($P(Y,V,4),$P(Y,V,18),BIPDSS) S A=" *",BIPDSSA=1
"RTN","BIPATVW1",127,0)
 ..S X=X_A_$P(Y,V,2)
"RTN","BIPATVW1",128,0)
 ..;
"RTN","BIPATVW1",129,0)
 ..;---> Pad with spaces to line up in columns.
"RTN","BIPATVW1",130,0)
 ..S X=$$PAD^BIUTL5(X,37)
"RTN","BIPATVW1",131,0)
 ..;---> Pre-pend "+" if this immunization was imported from an outside registry.
"RTN","BIPATVW1",132,0)
 ..S X=X_$S($P(Y,V,20):"+",1:" ")
"RTN","BIPATVW1",133,0)
 ..;---> Display first 4 characters of Location of Visit.
"RTN","BIPATVW1",134,0)
 ..S X=X_$E($P(Y,V,5),1,4)
"RTN","BIPATVW1",135,0)
 ..S X=$$PAD^BIUTL5(X,43)_"|"
"RTN","BIPATVW1",136,0)
 ..;
"RTN","BIPATVW1",137,0)
 ..;---> Set formatted line and index in ^TMP.
"RTN","BIPATVW1",138,0)
 ..D WRITE(.BILINE,X,,BIENT)
"RTN","BIPATVW1",139,0)
 ..;
"RTN","BIPATVW1",140,0)
 ..;---> If this is a Dose Override by user, set another line to display it.
"RTN","BIPATVW1",141,0)
 ..D:$P(Y,V,16)
"RTN","BIPATVW1",142,0)
 ...S X="               -"_$$DOVER^BIUTL8($P(Y,V,16))_"-"
"RTN","BIPATVW1",143,0)
 ...;---> Pad Result with trailing spaces to justify columns.
"RTN","BIPATVW1",144,0)
 ...D WRITE(.BILINE,$$PAD^BIUTL5(X,43)_"|",,BIENT)
"RTN","BIPATVW1",145,0)
 ..;
"RTN","BIPATVW1",146,0)
 ..;---> If this is a Problem Dose by ImmServe, set another line to display it.
"RTN","BIPATVW1",147,0)
 ..D:$G(BIPDSSA)
"RTN","BIPATVW1",148,0)
 ...;
"RTN","BIPATVW1",149,0)
 ...;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATVW1",150,0)
 ...;---> Change text.
"RTN","BIPATVW1",151,0)
 ...;S X="               -INVALID--SEE IMMSERVE-"
"RTN","BIPATVW1",152,0)
 ...S X="               -INVALID--SEE REPORT-"
"RTN","BIPATVW1",153,0)
 ...;**********
"RTN","BIPATVW1",154,0)
 ...;---> Pad Result with trailing spaces to justify columns.
"RTN","BIPATVW1",155,0)
 ...D WRITE(.BILINE,$$PAD^BIUTL5(X,43)_"|",,BIENT)
"RTN","BIPATVW1",156,0)
 ..;
"RTN","BIPATVW1",157,0)
 ..;
"RTN","BIPATVW1",158,0)
 ..;---> If there was a Reaction, set another line to display it.
"RTN","BIPATVW1",159,0)
 ..D:$P(Y,V,13)]""
"RTN","BIPATVW1",160,0)
 ...S X="               ("_$P(Y,V,13)_")"
"RTN","BIPATVW1",161,0)
 ...;---> Pad Result with trailing spaces to justify columns.
"RTN","BIPATVW1",162,0)
 ...D WRITE(.BILINE,$$PAD^BIUTL5(X,43)_"|",,BIENT)
"RTN","BIPATVW1",163,0)
 ..;
"RTN","BIPATVW1",164,0)
 ..;
"RTN","BIPATVW1",165,0)
 ..;---> If this was created by a CPT Coded Visit, set a line to display it.
"RTN","BIPATVW1",166,0)
 ..D:$P(Y,V,19)
"RTN","BIPATVW1",167,0)
 ...S X="               (CPT-Coded visit)"
"RTN","BIPATVW1",168,0)
 ...;---> Pad Result with trailing spaces to justify columns.
"RTN","BIPATVW1",169,0)
 ...D WRITE(.BILINE,$$PAD^BIUTL5(X,43)_"|",,BIENT)
"RTN","BIPATVW1",170,0)
 ..;
"RTN","BIPATVW1",171,0)
 .;
"RTN","BIPATVW1",172,0)
 .;
"RTN","BIPATVW1",173,0)
 .;---> SKIN TESTS
"RTN","BIPATVW1",174,0)
 .;---> If this is a Skin Test, display as follows and quit.
"RTN","BIPATVW1",175,0)
 .I $P(Y,V)="S" D  Q
"RTN","BIPATVW1",176,0)
 ..;
"RTN","BIPATVW1",177,0)
 ..;---> Insert a blank line to set apart Skin Tests.
"RTN","BIPATVW1",178,0)
 ..I I>1 I '$D(BISK) S BISK="" D RTCOL(.BILINE,,BIENT)
"RTN","BIPATVW1",179,0)
 ..;
"RTN","BIPATVW1",180,0)
 ..S BIENT=BIENT+1
"RTN","BIPATVW1",181,0)
 ..;---> Set display line for this Skin Test.
"RTN","BIPATVW1",182,0)
 ..;S X=$S(BIENT>9:" ",1:"  ")_BIENT_"  "_$P($P(Y,V,7)," @")  v8.0
"RTN","BIPATVW1",183,0)
 ..S X=$S(BIENT>9:" ",1:"  ")_BIENT_"  "_$P(Y,V,17)
"RTN","BIPATVW1",184,0)
 ..S X=X_"  "_$P(Y,V,11)
"RTN","BIPATVW1",185,0)
 ..D
"RTN","BIPATVW1",186,0)
 ...;---> Pad with spaces to line up columns.
"RTN","BIPATVW1",187,0)
 ...S X=$$PAD^BIUTL5(X,38)_$E($P(Y,V,5),1,4)
"RTN","BIPATVW1",188,0)
 ...S X=$$PAD^BIUTL5(X,43)_"|"
"RTN","BIPATVW1",189,0)
 ..;
"RTN","BIPATVW1",190,0)
 ..;---> Set formatted line and index in ^TMP.
"RTN","BIPATVW1",191,0)
 ..D WRITE(.BILINE,X,,BIENT)
"RTN","BIPATVW1",192,0)
 ..;
"RTN","BIPATVW1",193,0)
 ..;---> Now set second line (results) of Skin Test.
"RTN","BIPATVW1",194,0)
 ..S X="               ("_$P(Y,V,8)
"RTN","BIPATVW1",195,0)
 ..D
"RTN","BIPATVW1",196,0)
 ...I $P(Y,V,8)="" I $P(Y,V,9)="" D  Q
"RTN","BIPATVW1",197,0)
 ....S X=X_"No result",X=$$PAD^BIUTL5(X,25)
"RTN","BIPATVW1",198,0)
 ...;---> Pad out to reading column.
"RTN","BIPATVW1",199,0)
 ...S X=$$PAD^BIUTL5(X,24)
"RTN","BIPATVW1",200,0)
 ..D
"RTN","BIPATVW1",201,0)
 ...;---> Justify Reading column.
"RTN","BIPATVW1",202,0)
 ...N Z S Z=$P(Y,V,9)
"RTN","BIPATVW1",203,0)
 ...Q:Z=""
"RTN","BIPATVW1",204,0)
 ...S:Z<10 Z=" "_Z
"RTN","BIPATVW1",205,0)
 ...S X=X_" "_Z_"mm"
"RTN","BIPATVW1",206,0)
 ..D
"RTN","BIPATVW1",207,0)
 ...;---> Justify Read Date column.
"RTN","BIPATVW1",208,0)
 ...N Z S Z=$P(Y,V,10)
"RTN","BIPATVW1",209,0)
 ...Q:'Z
"RTN","BIPATVW1",210,0)
 ...S X=X_" on "_Z
"RTN","BIPATVW1",211,0)
 ..S X=X_")",X=$$PAD^BIUTL5(X,43)_"|"
"RTN","BIPATVW1",212,0)
 ..;
"RTN","BIPATVW1",213,0)
 ..D WRITE(.BILINE,X,,BIENT)
"RTN","BIPATVW1",214,0)
 ;
"RTN","BIPATVW1",215,0)
 ;---> Save maximum left column line number.
"RTN","BIPATVW1",216,0)
 S BILMAX=BILINE
"RTN","BIPATVW1",217,0)
 Q
"RTN","BIPATVW1",218,0)
 ;
"RTN","BIPATVW1",219,0)
 ;
"RTN","BIPATVW1",220,0)
 ;----------
"RTN","BIPATVW1",221,0)
FORECAST(BIFORCST,BIRMAX) ;EP
"RTN","BIPATVW1",222,0)
 ;---> Now retrieve ImmServe Forecast and append to right half
"RTN","BIPATVW1",223,0)
 ;---> of screen.
"RTN","BIPATVW1",224,0)
 ;---> Parameters:
"RTN","BIPATVW1",225,0)
 ;     1 - BIFORCST (req) Raw forecast string back from call to IMMFORC^BIRPC.
"RTN","BIPATVW1",226,0)
 ;     2 - BIRMAX   (ret) Maximum Right column line number.
"RTN","BIPATVW1",227,0)
 ;
"RTN","BIPATVW1",228,0)
 N BII,BILINE,BIRETERR
"RTN","BIPATVW1",229,0)
 ;
"RTN","BIPATVW1",230,0)
 ;---> If BIRETERR has a value, this is a FATAL ERROR in Forecasting;
"RTN","BIPATVW1",231,0)
 ;---> Display the error, and set its text in the forecast box.
"RTN","BIPATVW1",232,0)
 S BILINE=0,BIRETERR=$P(BIFORCST,BI31,2)
"RTN","BIPATVW1",233,0)
 I BIRETERR]"" D  S BIRMAX=BILINE Q
"RTN","BIPATVW1",234,0)
 .;---> Display error, require <return> to go on.
"RTN","BIPATVW1",235,0)
 .D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3()
"RTN","BIPATVW1",236,0)
 .D PARSE(.BILINE,BIRETERR," ERROR:",BIENT)
"RTN","BIPATVW1",237,0)
 ;
"RTN","BIPATVW1",238,0)
 ;---> If there is NO fatal error, then process forecast string.
"RTN","BIPATVW1",239,0)
 ;---> Set BIFORC=to an Immunization Forecast for this patient.
"RTN","BIPATVW1",240,0)
 N BIFORC,BIPC S BIFORC=$P(BIFORCST,BI31,1)
"RTN","BIPATVW1",241,0)
 ;
"RTN","BIPATVW1",242,0)
 ;---> Sample code to insert forecaster version in to Patient View screen.
"RTN","BIPATVW1",243,0)
 ;S BIFORC=BIFORC_"|       TCH v3.7.1^"
"RTN","BIPATVW1",244,0)
 ;
"RTN","BIPATVW1",245,0)
 ;---> Build Listmanager array from BIFORC string.
"RTN","BIPATVW1",246,0)
 ;---> For each piece of the Forecast, format and set in Listman.
"RTN","BIPATVW1",247,0)
 F BII=1:1 S BIPC=$P(BIFORC,U,BII) Q:BIPC=""  D
"RTN","BIPATVW1",248,0)
 .;
"RTN","BIPATVW1",249,0)
 .;---> If forecast contains a minor error, write it and quit.
"RTN","BIPATVW1",250,0)
 .I BIPC["ERROR:" D PARSE(.BILINE,BIPC,,BIENT) Q
"RTN","BIPATVW1",251,0)
 .;
"RTN","BIPATVW1",252,0)
 .;---> Set display line for this forecast immunization.
"RTN","BIPATVW1",253,0)
 .;---> Pad Date with trailing spaces to line up in a columns.
"RTN","BIPATVW1",254,0)
 .N V S V="|"
"RTN","BIPATVW1",255,0)
 .D
"RTN","BIPATVW1",256,0)
 ..N Z S Z=$P(BIPC,V)
"RTN","BIPATVW1",257,0)
 ..;---> If "No Immunizations Due", write this instead of other data.
"RTN","BIPATVW1",258,0)
 ..;---> ("No immunizations due." text is set in ^BIRPC.)
"RTN","BIPATVW1",259,0)
 ..I Z="No immunizations due." S X="   "_Z Q
"RTN","BIPATVW1",260,0)
 ..S X="   "_Z,X=$$PAD^BIUTL5(X,16)_$P(BIPC,V,2)_$P(BIPC,V,3)
"RTN","BIPATVW1",261,0)
 .;
"RTN","BIPATVW1",262,0)
 .;---> Set formatted Imm Due line and index in ^TMP.
"RTN","BIPATVW1",263,0)
 .D RTCOL(.BILINE,X,BIENT)
"RTN","BIPATVW1",264,0)
 ;
"RTN","BIPATVW1",265,0)
 ;---> Save maximum right column line number.
"RTN","BIPATVW1",266,0)
 S BIRMAX=BILINE
"RTN","BIPATVW1",267,0)
 Q
"RTN","BIPATVW1",268,0)
 ;
"RTN","BIPATVW1",269,0)
 ;
"RTN","BIPATVW1",270,0)
 ;----------
"RTN","BIPATVW1",271,0)
RTCOL(BILINE,BIVAL,BIENT) ;EP
"RTN","BIPATVW1",272,0)
 ;---> Set right column entries in ^TMP.
"RTN","BIPATVW1",273,0)
 ;---> Parameters:
"RTN","BIPATVW1",274,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIPATVW1",275,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIPATVW1",276,0)
 ;                      (Null=blank line.)
"RTN","BIPATVW1",277,0)
 ;     3 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BIPATVW1",278,0)
 ;
"RTN","BIPATVW1",279,0)
 ;---> If an Imm  History line already exists, append to it.
"RTN","BIPATVW1",280,0)
 N Z S Z=$G(^TMP("BILMVW",$J,BILINE+1,0))
"RTN","BIPATVW1",281,0)
 I Z]"" S BIVAL=Z_$G(BIVAL) D WRITE(.BILINE,BIVAL) Q
"RTN","BIPATVW1",282,0)
 ;
"RTN","BIPATVW1",283,0)
 ;---> If this is a new line, set line count and index.
"RTN","BIPATVW1",284,0)
 D WRITE(.BILINE,$$SP^BIUTL5(43)_"|"_$G(BIVAL),,$G(BIENT))
"RTN","BIPATVW1",285,0)
 Q
"RTN","BIPATVW1",286,0)
 ;
"RTN","BIPATVW1",287,0)
 ;
"RTN","BIPATVW1",288,0)
 ;----------
"RTN","BIPATVW1",289,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIPATVW1",290,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIPATVW1",291,0)
 ;---> Parameters:
"RTN","BIPATVW1",292,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIPATVW1",293,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIPATVW1",294,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIPATVW1",295,0)
 ;     4 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BIPATVW1",296,0)
 ;
"RTN","BIPATVW1",297,0)
 Q:'$D(BILINE)
"RTN","BIPATVW1",298,0)
 D WL^BIW(.BILINE,"BILMVW",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BIPATVW1",299,0)
 Q
"RTN","BIPATVW1",300,0)
 ;
"RTN","BIPATVW1",301,0)
 ;
"RTN","BIPATVW1",302,0)
 ;----------
"RTN","BIPATVW1",303,0)
PARSE(BILINE,BISTR,BIFLN,BIENT) ;EP
"RTN","BIPATVW1",304,0)
 ;---> Parse Right Column lines to fit in proper length.
"RTN","BIPATVW1",305,0)
 ;---> Parameters:
"RTN","BIPATVW1",306,0)
 ;     1 - BILINE (req) Line Number, Right Column.
"RTN","BIPATVW1",307,0)
 ;     2 - BISTR  (req) String of text to be parsed out.
"RTN","BIPATVW1",308,0)
 ;     3 - BIFLN  (opt) First line (if null, blank line inserted).
"RTN","BIPATVW1",309,0)
 ;     4 - BIENT  (ret) Entry Number for LM selection in VALMY
"RTN","BIPATVW1",310,0)
 ;
"RTN","BIPATVW1",311,0)
 Q:'$D(BILINE)  Q:$G(BISTR)=""
"RTN","BIPATVW1",312,0)
 N A,Y,Z
"RTN","BIPATVW1",313,0)
 D RTCOL(.BILINE,$G(BIFLN),$G(BIENT))
"RTN","BIPATVW1",314,0)
 S A=1
"RTN","BIPATVW1",315,0)
 F  D  Q:Y=""
"RTN","BIPATVW1",316,0)
 .S Z=A+31,Y=$E(BISTR,A,Z)
"RTN","BIPATVW1",317,0)
 .D:$L(Y)=32
"RTN","BIPATVW1",318,0)
 ..F  Q:$E(BISTR,Z)=" "  S Z=Z-1  Q:Z<10
"RTN","BIPATVW1",319,0)
 ..S Y=$E(BISTR,A,Z)
"RTN","BIPATVW1",320,0)
 .;---> Set formatted Error line and index in ^TMP.
"RTN","BIPATVW1",321,0)
 .D:Y]"" RTCOL(.BILINE,"   "_Y,$G(BIENT))
"RTN","BIPATVW1",322,0)
 .S A=Z+1
"RTN","BIPATVW1",323,0)
 Q
"RTN","BIPATVW2")
0^80^B78493065
"RTN","BIPATVW2",1,0)
BIPATVW2 ;IHS/CMI/MWR - ADD/EDIT/DELETE VISITS; MAY 10, 2010
"RTN","BIPATVW2",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIPATVW2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATVW2",4,0)
 ;;  ADD, EDIT, DELETE VISITS VIA LIST MANAGER.
"RTN","BIPATVW2",5,0)
 ;;  PATCH 1: Do not stuff default VFC if patient < 19 yrs.  ADDIMM+33
"RTN","BIPATVW2",6,0)
 ;;  PATCH 9: Add Admin Date and VIS Presented Date to array. EDITIMM+87
"RTN","BIPATVW2",7,0)
 ;;           If patient is adult, set Eligibility default="V01".  ADDIMM+40
"RTN","BIPATVW2",8,0)
 ;
"RTN","BIPATVW2",9,0)
 ;
"RTN","BIPATVW2",10,0)
 ;----------
"RTN","BIPATVW2",11,0)
ADDIMM ;EP
"RTN","BIPATVW2",12,0)
 ;---> Add an Immunization via List Manager.
"RTN","BIPATVW2",13,0)
 ;---> Steps:
"RTN","BIPATVW2",14,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATVW2",15,0)
 ;               BI IMMUNIZATION VISIT ADD, an action on the
"RTN","BIPATVW2",16,0)
 ;               List Manager menu protocol: BI MENU PATIENT VIEW
"RTN","BIPATVW2",17,0)
 ;
"RTN","BIPATVW2",18,0)
 ;            2) This code calls ScreenMan form:
"RTN","BIPATVW2",19,0)
 ;               BI FORM-IMM VISIT ADD/EDIT to build BI local array
"RTN","BIPATVW2",20,0)
 ;               of data for add/edit of Immunization visit.
"RTN","BIPATVW2",21,0)
 ;               Data already stored in the BI local array is loaded
"RTN","BIPATVW2",22,0)
 ;               into the form by LOADVIS^BIUTL7, which is called
"RTN","BIPATVW2",23,0)
 ;               by the Pre-Action of Blocks for Imm/Skin Edits.
"RTN","BIPATVW2",24,0)
 ;
"RTN","BIPATVW2",25,0)
 ;            3) SAVISIT^BIUTL7 uses BI local array to build data
"RTN","BIPATVW2",26,0)
 ;               to pass to ADDEDIT^BIRPC3 (which is also called by
"RTN","BIPATVW2",27,0)
 ;               the Broker from the GUI).
"RTN","BIPATVW2",28,0)
 ;
"RTN","BIPATVW2",29,0)
 ;            4) BIRPC3 calls ADDV^BIVISIT, which adds the
"RTN","BIPATVW2",30,0)
 ;               Visit to the V Files.
"RTN","BIPATVW2",31,0)
 ;
"RTN","BIPATVW2",32,0)
 ;---> Variables:
"RTN","BIPATVW2",33,0)
 ;     1 - BIDFN   (req) Patient DFN.
"RTN","BIPATVW2",34,0)
 ;     2 - BIDUZ2  (req) DUZ(2) of User (for Site Parameters).
"RTN","BIPATVW2",35,0)
 ;     3 - BIDEFDT (opt) Default date of new Visit.
"RTN","BIPATVW2",36,0)
 ;
"RTN","BIPATVW2",37,0)
 ;---> Check that DFN for this patient is present.
"RTN","BIPATVW2",38,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",39,0)
 N BI S BI("A")=BIDFN
"RTN","BIPATVW2",40,0)
 ;
"RTN","BIPATVW2",41,0)
 ;---> Set default VFC Eligibility.
"RTN","BIPATVW2",42,0)
 ;---> If Patient Ben Type is 01 (Am Indian/AK Native), set VFC default=4.
"RTN","BIPATVW2",43,0)
 ;
"RTN","BIPATVW2",44,0)
 ;********** PATCH 1, v8.3.1, Dec 30,2008, IHS/CMI/MWR
"RTN","BIPATVW2",45,0)
 ;---> Do NOT stuff VFC default if patient is not < 19 years old.
"RTN","BIPATVW2",46,0)
 ;I $$BENTYP^BIUTL11(BIDFN,2)="01" S BI("P")=4
"RTN","BIPATVW2",47,0)
 ;--> If patient was less than 19yrs set default=V01 and quit.
"RTN","BIPATVW2",48,0)
 ;Q:($$AGE^BIUTL1(BIDFN,1,BIDATE)>18)
"RTN","BIPATVW2",49,0)
 ;
"RTN","BIPATVW2",50,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATVW2",51,0)
 ;---> If patient is adult, set Eligibility default="V01".
"RTN","BIPATVW2",52,0)
 D
"RTN","BIPATVW2",53,0)
 .I $$AGE^BIUTL1(BIDFN,1)<19,$$BENTYP^BIUTL11(BIDFN,2)="01" S BI("P")=4 Q
"RTN","BIPATVW2",54,0)
 .;---> Otherwise patient is adult, set default="V01" and quit.
"RTN","BIPATVW2",55,0)
 .S BI("P")=1
"RTN","BIPATVW2",56,0)
 ;**********
"RTN","BIPATVW2",57,0)
 ;
"RTN","BIPATVW2",58,0)
 ;---> Set default date.
"RTN","BIPATVW2",59,0)
 S BI("E")=$G(BIDEFDT)
"RTN","BIPATVW2",60,0)
 ;
"RTN","BIPATVW2",61,0)
 ;---> Get Site IEN for parameters.
"RTN","BIPATVW2",62,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW2",63,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW2",64,0)
 S BI("Z")=BIDUZ2
"RTN","BIPATVW2",65,0)
 ;
"RTN","BIPATVW2",66,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIPATVW2",67,0)
 ;---> NOTE: The absence of BI("K") (IEN of Old V File entry) signals
"RTN","BIPATVW2",68,0)
 ;--->       a NEW V Immunizaton.
"RTN","BIPATVW2",69,0)
 ;---> BISAVE=Flag to call BIUTL7 to save data (below).  vvv83
"RTN","BIPATVW2",70,0)
 ;---> BITOLONG=Flag used in Screenman to display pop-up: Other Loc too long.
"RTN","BIPATVW2",71,0)
 N BISAVE,BITOLONG
"RTN","BIPATVW2",72,0)
 N DR S DR="[BI FORM-IMM VISIT ADD/EDIT]"
"RTN","BIPATVW2",73,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATVW2",74,0)
 ;
"RTN","BIPATVW2",75,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATVW2",76,0)
 D:$G(BISAVE) SAVISIT^BIUTL7("I",.BI)
"RTN","BIPATVW2",77,0)
 ;
"RTN","BIPATVW2",78,0)
 D RESET
"RTN","BIPATVW2",79,0)
 Q
"RTN","BIPATVW2",80,0)
 ;
"RTN","BIPATVW2",81,0)
 ;
"RTN","BIPATVW2",82,0)
 ;----------
"RTN","BIPATVW2",83,0)
ADDSK ;EP
"RTN","BIPATVW2",84,0)
 ;---> Add a Skin Test via List Manager.
"RTN","BIPATVW2",85,0)
 ;---> Steps are the same as ADDIMM above.
"RTN","BIPATVW2",86,0)
 ;
"RTN","BIPATVW2",87,0)
 ;---> Check that DFN for this patient is present.
"RTN","BIPATVW2",88,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",89,0)
 N BI S BI("A")=BIDFN
"RTN","BIPATVW2",90,0)
 ;
"RTN","BIPATVW2",91,0)
 ;---> Set default date and volume.
"RTN","BIPATVW2",92,0)
 S BI("E")=$G(BIDEFDT),BI("W")=.1
"RTN","BIPATVW2",93,0)
 ;
"RTN","BIPATVW2",94,0)
 ;---> Get Site IEN for parameters.
"RTN","BIPATVW2",95,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW2",96,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW2",97,0)
 S BI("Z")=BIDUZ2
"RTN","BIPATVW2",98,0)
 ;
"RTN","BIPATVW2",99,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIPATVW2",100,0)
 ;---> NOTE: The absence of BI("K") (IEN of Old V File entry) signals
"RTN","BIPATVW2",101,0)
 ;--->       a NEW V Skin Test.
"RTN","BIPATVW2",102,0)
 ;---> BISAVE=Flag to call BIUTL7 to save data (below).  vvv83
"RTN","BIPATVW2",103,0)
 ;---> BITOLONG=Flag used in Screenman to display pop-up: Other Loc too long.
"RTN","BIPATVW2",104,0)
 N BISAVE,BITOLONG
"RTN","BIPATVW2",105,0)
 N DR S DR="[BI FORM-SKIN VISIT ADD/EDIT]"
"RTN","BIPATVW2",106,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATVW2",107,0)
 ;
"RTN","BIPATVW2",108,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATVW2",109,0)
 D:$G(BISAVE) SAVISIT^BIUTL7("S",.BI)
"RTN","BIPATVW2",110,0)
 ;
"RTN","BIPATVW2",111,0)
 D RESET
"RTN","BIPATVW2",112,0)
 Q
"RTN","BIPATVW2",113,0)
 ;
"RTN","BIPATVW2",114,0)
 ;
"RTN","BIPATVW2",115,0)
 ;----------
"RTN","BIPATVW2",116,0)
EDITIMM ;EP
"RTN","BIPATVW2",117,0)
 ;---> Edit an Immunization via List Manager.
"RTN","BIPATVW2",118,0)
 ;---> Steps:
"RTN","BIPATVW2",119,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATVW2",120,0)
 ;               BI V FILE VISIT EDIT, an action on the
"RTN","BIPATVW2",121,0)
 ;               List Manager menu protocol: BI MENU PATIENT VIEW
"RTN","BIPATVW2",122,0)
 ;
"RTN","BIPATVW2",123,0)
 ;            2) This code gets an Imm Visit from List Manager
"RTN","BIPATVW2",124,0)
 ;               and loads the data into the Screenman form:
"RTN","BIPATVW2",125,0)
 ;               BI FORM-IMM VISIT ADD/EDIT to build BI local array
"RTN","BIPATVW2",126,0)
 ;               of data for add/edit of Immunization visit.
"RTN","BIPATVW2",127,0)
 ;               Data already stored in the BI local array is loaded
"RTN","BIPATVW2",128,0)
 ;               into the form by LOADVIS^BIUTL7, which is called
"RTN","BIPATVW2",129,0)
 ;               by the Pre-Action of Blocks for Imm/Skin Edits.
"RTN","BIPATVW2",130,0)
 ;
"RTN","BIPATVW2",131,0)
 ;            3) SAVISIT^BIUTL7 uses BI local array to build data
"RTN","BIPATVW2",132,0)
 ;               to pass to ADDEDIT^BIRPC3 (which is also called by
"RTN","BIPATVW2",133,0)
 ;               the Broker from the GUI).
"RTN","BIPATVW2",134,0)
 ;
"RTN","BIPATVW2",135,0)
 ;            4) BIRPC3 calls DELETE^BIVISIT and ADDV^BIVISIT,
"RTN","BIPATVW2",136,0)
 ;               which broker Visits to the V Files.
"RTN","BIPATVW2",137,0)
 ;
"RTN","BIPATVW2",138,0)
 ;
"RTN","BIPATVW2",139,0)
 ;---> Call the List Manager Generic Selector of items displayed.
"RTN","BIPATVW2",140,0)
 N VALMY
"RTN","BIPATVW2",141,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATVW2",142,0)
 ;
"RTN","BIPATVW2",143,0)
 ;---> Check that Imm History string for this patient is present.
"RTN","BIPATVW2",144,0)
 ;---> If Imm History not supplied, set Error Code and quit.
"RTN","BIPATVW2",145,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",146,0)
 I $G(BIHX(BIDFN))']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATVW2",147,0)
 ;
"RTN","BIPATVW2",148,0)
 ;---> Check that a Listman Item was passed; if so, set Y=which
"RTN","BIPATVW2",149,0)
 ;---> item (Imm Visit) was passed/selected.
"RTN","BIPATVW2",150,0)
 ;I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",151,0)
 I '$D(VALMY) D RESET Q
"RTN","BIPATVW2",152,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATVW2",153,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",154,0)
 ;
"RTN","BIPATVW2",155,0)
 ;---> Get V Type: Imm or Skin.
"RTN","BIPATVW2",156,0)
 N BIVTYPE S BIVTYPE=$P($P(BIHX(BIDFN),U,Y),"|")
"RTN","BIPATVW2",157,0)
 ;
"RTN","BIPATVW2",158,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIPATVW2",159,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIPATVW2",160,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIPATVW2",161,0)
 .D ERRCD^BIUTL2(410,,1) D RESET
"RTN","BIPATVW2",162,0)
 ;
"RTN","BIPATVW2",163,0)
 ;---> Set BIVFIEN=V File IEN.
"RTN","BIPATVW2",164,0)
 N BIVFIEN S BIVFIEN=$P($P(BIHX(BIDFN),U,Y),"|",4)
"RTN","BIPATVW2",165,0)
 ;
"RTN","BIPATVW2",166,0)
 ;---> Gather data for this Visit to load for Screenman edit.
"RTN","BIPATVW2",167,0)
 D GET^BIRPC1(.Y,BIVFIEN,BIVTYPE)
"RTN","BIPATVW2",168,0)
 ;
"RTN","BIPATVW2",169,0)
 ;---> If an error is passed back, display it and quit.
"RTN","BIPATVW2",170,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIPATVW2",171,0)
 S BIERR=$P(Y,BI31,2)
"RTN","BIPATVW2",172,0)
 I BIERR]"" D IO^BIO(BIERR),DIRZ^BIUTL3() D RESET Q
"RTN","BIPATVW2",173,0)
 ;
"RTN","BIPATVW2",174,0)
 ;---> If no error, then set Y=data (1st BI31 piece).
"RTN","BIPATVW2",175,0)
 S Y=$P(Y,BI31)
"RTN","BIPATVW2",176,0)
 ;
"RTN","BIPATVW2",177,0)
 ;---> Build BI array of Visit data for ScreenMan Edit form.
"RTN","BIPATVW2",178,0)
 N BI,DR,V S V="|"
"RTN","BIPATVW2",179,0)
 ;
"RTN","BIPATVW2",180,0)
 ;---> Build array for Immunization Visit.
"RTN","BIPATVW2",181,0)
 D:BIVTYPE="I"
"RTN","BIPATVW2",182,0)
 .S BI("A")=+BIDFN          ;Patient DFN.
"RTN","BIPATVW2",183,0)
 .S BI("B")=+$P(Y,V,7)      ;Vaccine Name IEN.
"RTN","BIPATVW2",184,0)
 .S BI("C")=$P(Y,V,3)       ;Dose# of Immunization.
"RTN","BIPATVW2",185,0)
 .S BI("D")=$P(Y,V,9)       ;Lot Number IEN.
"RTN","BIPATVW2",186,0)
 .S BI("E")=$P(Y,V,6)       ;Date/Time of Imm Visit (ext form).
"RTN","BIPATVW2",187,0)
 .S BI("F")=+$P(Y,V,11)     ;Location of Encounter IEN.
"RTN","BIPATVW2",188,0)
 .S BI("G")=$P(Y,V,13)      ;Other Location of Encounter Text.
"RTN","BIPATVW2",189,0)
 .S BI("I")=$P(Y,V,12)      ;Catgegory of Visit (A,E,I).
"RTN","BIPATVW2",190,0)
 .S BI("J")=$P(Y,V,22)      ;Visit IEN.
"RTN","BIPATVW2",191,0)
 .S BI("K")=BIVFIEN         ;Old V File IEN - indicates EDIT of previous Imm.
"RTN","BIPATVW2",192,0)
 .S BI("O")=+$P(Y,V,15)     ;Reaction to Immunization on this Visit.
"RTN","BIPATVW2",193,0)
 .S BI("P")=$P(Y,V,23)      ;VFC Eligibility.  vvv83
"RTN","BIPATVW2",194,0)
 .S BI("Q")=$P(Y,V,17)      ;Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIPATVW2",195,0)
 .S BI("R")=$P(Y,V,18)      ;Immunization Provider.
"RTN","BIPATVW2",196,0)
 .S BI("S")=$P(Y,V,19)      ;Dose Override.
"RTN","BIPATVW2",197,0)
 .S BI("T")=$P(Y,V,20)      ;Injection Site.
"RTN","BIPATVW2",198,0)
 .S BI("W")=$P(Y,V,21)      ;Volume.
"RTN","BIPATVW2",199,0)
 .S BI("Y")=$P(Y,V,24)      ;Imported From Outside Source (=1).
"RTN","BIPATVW2",200,0)
 .S BI("H")=$P(Y,V,25)      ;NDC Code pointer IEN.
"RTN","BIPATVW2",201,0)
 .;
"RTN","BIPATVW2",202,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATVW2",203,0)
 .;---> Add VIS Presented Dateand Admin Date to array for Screenman.
"RTN","BIPATVW2",204,0)
 .S BI("QQ")=$P(Y,V,30)     ;Date VIS Presented to Patient.
"RTN","BIPATVW2",205,0)
 .S BI("EE")=$P(Y,V,31)     ;Admin/shot Date ONLY (not Visit); can be null.
"RTN","BIPATVW2",206,0)
 .;**********
"RTN","BIPATVW2",207,0)
 .;X ^O
"RTN","BIPATVW2",208,0)
 .;
"RTN","BIPATVW2",209,0)
 .S DR="[BI FORM-IMM VISIT ADD/EDIT]"
"RTN","BIPATVW2",210,0)
 ;
"RTN","BIPATVW2",211,0)
 ;---> Build array for Skin Test Visit.
"RTN","BIPATVW2",212,0)
 D:BIVTYPE="S"
"RTN","BIPATVW2",213,0)
 .S BI("A")=+BIDFN          ;Patient DFN.
"RTN","BIPATVW2",214,0)
 .S BI("B")=+$P(Y,V,13)     ;Skin Test IEN.
"RTN","BIPATVW2",215,0)
 .S BI("E")=$P(Y,V,4)       ;Date/Time of Skin Test Visit (ext form).
"RTN","BIPATVW2",216,0)
 .S BI("F")=+$P(Y,V,5)      ;Location of Encounter IEN.
"RTN","BIPATVW2",217,0)
 .S BI("G")=$P(Y,V,7)       ;Other Location of Encounter Text.
"RTN","BIPATVW2",218,0)
 .S BI("I")=$P(Y,V,6)       ;Catgegory of Visit (A,E,I).
"RTN","BIPATVW2",219,0)
 .S BI("J")=$P(Y,V,18)      ;Visit IEN.
"RTN","BIPATVW2",220,0)
 .S BI("K")=BIVFIEN         ;Old V File IEN (for edits).
"RTN","BIPATVW2",221,0)
 .S BI("L")=$P(Y,V,9)       ;Skin Test Result.
"RTN","BIPATVW2",222,0)
 .S BI("M")=$P(Y,V,10)      ;Skin Test Reading.
"RTN","BIPATVW2",223,0)
 .S BI("N")=$P(Y,V,11)      ;Skin Test Date Read.
"RTN","BIPATVW2",224,0)
 .S BI("R")=$P(Y,V,14)      ;Skin Test Provider.
"RTN","BIPATVW2",225,0)
 .S BI("T")=$P(Y,V,15)      ;Injection Site.
"RTN","BIPATVW2",226,0)
 .S BI("W")=$P(Y,V,16)      ;Volume.
"RTN","BIPATVW2",227,0)
 .S BI("X")=$P(Y,V,17)      ;Skin Test Reader.
"RTN","BIPATVW2",228,0)
 .;
"RTN","BIPATVW2",229,0)
 .S DR="[BI FORM-SKIN VISIT ADD/EDIT]"
"RTN","BIPATVW2",230,0)
 ;
"RTN","BIPATVW2",231,0)
 ;
"RTN","BIPATVW2",232,0)
 ;---> Get Site IEN for parameters.
"RTN","BIPATVW2",233,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW2",234,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW2",235,0)
 S BI("Z")=BIDUZ2
"RTN","BIPATVW2",236,0)
 ;
"RTN","BIPATVW2",237,0)
 ;---> Call Screenman to build BI local array of data edited by user.
"RTN","BIPATVW2",238,0)
 ;---> BISAVE=Flag to call BIUTL7 to save data (below).  vvv83
"RTN","BIPATVW2",239,0)
 ;---> BITOLONG=Flag used in Screenman to display pop-up: Other Loc too long.
"RTN","BIPATVW2",240,0)
 N BISAVE,BITOLONG
"RTN","BIPATVW2",241,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATVW2",242,0)
 ;
"RTN","BIPATVW2",243,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATVW2",244,0)
 D:$G(BISAVE) SAVISIT^BIUTL7(BIVTYPE,.BI)
"RTN","BIPATVW2",245,0)
 ;
"RTN","BIPATVW2",246,0)
 D RESET
"RTN","BIPATVW2",247,0)
 Q
"RTN","BIPATVW2",248,0)
 ;
"RTN","BIPATVW2",249,0)
 ;
"RTN","BIPATVW2",250,0)
 ;----------
"RTN","BIPATVW2",251,0)
DELETIMM ;EP
"RTN","BIPATVW2",252,0)
 ;---> Delete an Immunization or Skin Test via List Manager.
"RTN","BIPATVW2",253,0)
 ;---> Steps:
"RTN","BIPATVW2",254,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATVW2",255,0)
 ;               BI V FILE VISIT DELETE, an action on the
"RTN","BIPATVW2",256,0)
 ;               List Manager menu protocol: BI MENU PATIENT VIEW
"RTN","BIPATVW2",257,0)
 ;
"RTN","BIPATVW2",258,0)
 ;            2) This code gets an Imm or Skin Visit from List Manager
"RTN","BIPATVW2",259,0)
 ;               and calls DELETE^BIRPC3 (which is also called by
"RTN","BIPATVW2",260,0)
 ;               the Broker from the GUI).
"RTN","BIPATVW2",261,0)
 ;
"RTN","BIPATVW2",262,0)
 ;            5) BIRPC3 calls DELETE^BIVISIT, which will
"RTN","BIPATVW2",263,0)
 ;               delete the V File entry.
"RTN","BIPATVW2",264,0)
 ;
"RTN","BIPATVW2",265,0)
 ;---> Call the List Manager Generic Selector of items displayed.
"RTN","BIPATVW2",266,0)
 N VALMY
"RTN","BIPATVW2",267,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATVW2",268,0)
 ;
"RTN","BIPATVW2",269,0)
 ;---> Check that Imm History string for this patient is present.
"RTN","BIPATVW2",270,0)
 ;---> If Imm History not provided, set Error Code and quit.
"RTN","BIPATVW2",271,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",272,0)
 I $G(BIHX(BIDFN))']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATVW2",273,0)
 ;
"RTN","BIPATVW2",274,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIPATVW2",275,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",276,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATVW2",277,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",278,0)
 ;
"RTN","BIPATVW2",279,0)
 S Y=$P(BIHX(BIDFN),U,Y)
"RTN","BIPATVW2",280,0)
 I Y']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATVW2",281,0)
 ;
"RTN","BIPATVW2",282,0)
 D FULL^VALM1
"RTN","BIPATVW2",283,0)
 ;
"RTN","BIPATVW2",284,0)
 ;---> Display visit for confirmation.
"RTN","BIPATVW2",285,0)
 N BIVFIEN,BIVTYPE,V S V="|"
"RTN","BIPATVW2",286,0)
 ;
"RTN","BIPATVW2",287,0)
 S BIVTYPE=$P(Y,V)
"RTN","BIPATVW2",288,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIPATVW2",289,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIPATVW2",290,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIPATVW2",291,0)
 .D ERRCD^BIUTL2(410,,1) D RESET Q
"RTN","BIPATVW2",292,0)
 ;
"RTN","BIPATVW2",293,0)
 ;---> Set Immunization confirmation display fields and Visit IEN.
"RTN","BIPATVW2",294,0)
 I BIVTYPE="I" D
"RTN","BIPATVW2",295,0)
 .S X=$P(Y,V,7)_"  "_$P(Y,V,2)_"   "_$P(Y,V,5)
"RTN","BIPATVW2",296,0)
 .S BIVFIEN=$P(Y,V,4)
"RTN","BIPATVW2",297,0)
 ;
"RTN","BIPATVW2",298,0)
 ;---> Set Skin Test confirmation display fields and Visit IEN.
"RTN","BIPATVW2",299,0)
 I BIVTYPE="S" D
"RTN","BIPATVW2",300,0)
 .S X=$P(Y,V,7)_"  "_$P(Y,V,11)_"   "_$P(Y,V,8)_"  "_$P(Y,V,9)
"RTN","BIPATVW2",301,0)
 .S:$P(Y,V,9) X=X_" mm"
"RTN","BIPATVW2",302,0)
 .S X=X_"  "_$P(Y,V,5)
"RTN","BIPATVW2",303,0)
 .S BIVFIEN=$P(Y,V,4)
"RTN","BIPATVW2",304,0)
 ;
"RTN","BIPATVW2",305,0)
 ;
"RTN","BIPATVW2",306,0)
 D TITLE^BIUTL5("DELETE AN IMMUNIZATION VISIT")
"RTN","BIPATVW2",307,0)
 N A
"RTN","BIPATVW2",308,0)
 S A(1)="Do you really wish to DELETE this Visit?"
"RTN","BIPATVW2",309,0)
 S A(1,"F")="!!?3"
"RTN","BIPATVW2",310,0)
 S A(2)="Patient: "_$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATVW2",311,0)
 S A(2)=A(2)_"       Chart#: "_$$HRCN^BIUTL1(BIDFN)
"RTN","BIPATVW2",312,0)
 S A(2,"F")="!!?10"
"RTN","BIPATVW2",313,0)
 S A(3)=X,A(3,"F")="!!?10"
"RTN","BIPATVW2",314,0)
 S A(4,"F")="!"
"RTN","BIPATVW2",315,0)
 D EN^DDIOL(.A)
"RTN","BIPATVW2",316,0)
 ;
"RTN","BIPATVW2",317,0)
 N B,BIERR S BIERR=0
"RTN","BIPATVW2",318,0)
 S B(1)="     Enter YES to DELETE this Visit."
"RTN","BIPATVW2",319,0)
 S B(2)="     Enter NO to leave it unchanged."
"RTN","BIPATVW2",320,0)
 D DIR^BIFMAN("Y",.Y,,"   Enter Yes or No","NO",B(2),B(1))
"RTN","BIPATVW2",321,0)
 ;
"RTN","BIPATVW2",322,0)
 ;---> Failed to confirm.
"RTN","BIPATVW2",323,0)
 I Y<1 D  Q
"RTN","BIPATVW2",324,0)
 .D IO^BIO("NO changes made.")
"RTN","BIPATVW2",325,0)
 .D DIRZ^BIUTL3(),RESET
"RTN","BIPATVW2",326,0)
 ;
"RTN","BIPATVW2",327,0)
 ;---> Delete the visit.
"RTN","BIPATVW2",328,0)
 S BIERR=""
"RTN","BIPATVW2",329,0)
 D DELETE^BIRPC3(.BIERR,BIVFIEN,BIVTYPE)
"RTN","BIPATVW2",330,0)
 ;
"RTN","BIPATVW2",331,0)
 ;---> If an error is passed back, display it.
"RTN","BIPATVW2",332,0)
 N BI31 S BI31=$C(31)_$C(31),BIERR=$P(BIERR,BI31,2)
"RTN","BIPATVW2",333,0)
 I BIERR]"" D IO^BIO(BIERR),DIRZ^BIUTL3()
"RTN","BIPATVW2",334,0)
 D RESET
"RTN","BIPATVW2",335,0)
 Q
"RTN","BIPATVW2",336,0)
 ;
"RTN","BIPATVW2",337,0)
 ;
"RTN","BIPATVW2",338,0)
 ;----------
"RTN","BIPATVW2",339,0)
RESET ;EP
"RTN","BIPATVW2",340,0)
 ;---> Update partition for return to Listman.
"RTN","BIPATVW2",341,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATVW2",342,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATVW2",343,0)
 D HDR^BIPATVW(),INIT^BIPATVW
"RTN","BIPATVW2",344,0)
 Q
"RTN","BIPATVW3")
0^81^B110644272
"RTN","BIPATVW3",1,0)
BIPATVW3 ;IHS/CMI/MWR - ADD OTHER ITEMS, DISPLAY HELP; MAY 10, 2010
"RTN","BIPATVW3",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIPATVW3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATVW3",4,0)
 ;;  BUILD LISTMANAGER ARRAY FOR DISPLAY AND EDIT OF
"RTN","BIPATVW3",5,0)
 ;;  PATIENT'S IMMUNIZATION DATA, DISPLAY HELP.
"RTN","BIPATVW3",6,0)
 ;;  PATCH 8: Changes to discontinue High Risk forecast for Flu  HADINFO+51,+56
"RTN","BIPATVW3",7,0)
 ;;  PATCH 9: Accommodate new parameter options for HepB (Diabetes).  ADDINFO+51
"RTN","BIPATVW3",8,0)
 ;
"RTN","BIPATVW3",9,0)
 ;
"RTN","BIPATVW3",10,0)
 ;----------
"RTN","BIPATVW3",11,0)
LASTLET(BIDFN,BIRMAX,BIENT) ;EP
"RTN","BIPATVW3",12,0)
 ; ZEXCEPT: BI31
"RTN","BIPATVW3",13,0)
 ;---> Retrieve date of last letter sent to this patient and
"RTN","BIPATVW3",14,0)
 ;---> display it just below forecast.
"RTN","BIPATVW3",15,0)
 ;---> Parameters:
"RTN","BIPATVW3",16,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATVW3",17,0)
 ;     2 - BIRMAX (ret) Maximum Right column line number.
"RTN","BIPATVW3",18,0)
 ;     3 - BIENT  (ret) Entry Number for LM selection in VALMY
"RTN","BIPATVW3",19,0)
 ;
"RTN","BIPATVW3",20,0)
 ;---> Check for BIDFN.
"RTN","BIPATVW3",21,0)
 Q:$$DFNCHECK^BIUTL2()
"RTN","BIPATVW3",22,0)
 ;
"RTN","BIPATVW3",23,0)
 ;---> Call RPC to retrieve date of last letter sent.
"RTN","BIPATVW3",24,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BIPATVW3",25,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BIPATVW3",26,0)
 ;
"RTN","BIPATVW3",27,0)
 N BIRETVAL,BIRETERR S BIRETVAL=""
"RTN","BIPATVW3",28,0)
 ;
"RTN","BIPATVW3",29,0)
 ;---> RPC to retrieve date of last letter sent.
"RTN","BIPATVW3",30,0)
 D LASTLET^BIRPC5(.BIRETVAL,BIDFN)
"RTN","BIPATVW3",31,0)
 ;
"RTN","BIPATVW3",32,0)
 ;---> If BIRETERR has a value, display it and quit.
"RTN","BIPATVW3",33,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIPATVW3",34,0)
 I BIRETERR]"" D
"RTN","BIPATVW3",35,0)
 .D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3()
"RTN","BIPATVW3",36,0)
 .S BIRETVAL="ERROR!"
"RTN","BIPATVW3",37,0)
 ;
"RTN","BIPATVW3",38,0)
 ;---> Set BIDATE=to date of last letter sent to this patient.
"RTN","BIPATVW3",39,0)
 N BIDATE S BIDATE=$P(BIRETVAL,BI31,1)
"RTN","BIPATVW3",40,0)
 ;
"RTN","BIPATVW3",41,0)
 ;---> Set formatted Last Letter Date line and index in ^TMP.
"RTN","BIPATVW3",42,0)
 D RTCOL^BIPATVW1(.BIRMAX,,BIENT)
"RTN","BIPATVW3",43,0)
 D RTCOL^BIPATVW1(.BIRMAX,"   Last Letter: "_BIDATE,BIENT)
"RTN","BIPATVW3",44,0)
 ;
"RTN","BIPATVW3",45,0)
 Q
"RTN","BIPATVW3",46,0)
 ;
"RTN","BIPATVW3",47,0)
 ;
"RTN","BIPATVW3",48,0)
 ;----------
"RTN","BIPATVW3",49,0)
CONTRAS(BIDFN,BILMAX,BIRMAX,BIENT) ;EP
"RTN","BIPATVW3",50,0)
 ; ZEXCEPT: BI31
"RTN","BIPATVW3",51,0)
 ;---> Now retrieve Patient's Contraindications and append to
"RTN","BIPATVW3",52,0)
 ;---> right half of screen, below Forecast.
"RTN","BIPATVW3",53,0)
 ;---> Parameters:
"RTN","BIPATVW3",54,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATVW3",55,0)
 ;     2 - BILMAX (ret) Maximum Left column line number.
"RTN","BIPATVW3",56,0)
 ;     3 - BIRMAX (ret) Maximum Right column line number.
"RTN","BIPATVW3",57,0)
 ;     4 - BIENT  (ret) Entry Number for LM selection in VALMY
"RTN","BIPATVW3",58,0)
 ;
"RTN","BIPATVW3",59,0)
 ;---> Check for BIDFN.
"RTN","BIPATVW3",60,0)
 Q:$$DFNCHECK^BIUTL2()
"RTN","BIPATVW3",61,0)
 ;
"RTN","BIPATVW3",62,0)
 ;---> Call RPC to retrieve Contraindications.
"RTN","BIPATVW3",63,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BIPATVW3",64,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BIPATVW3",65,0)
 ;
"RTN","BIPATVW3",66,0)
 N BIRETVAL,BIRETERR S BIRETVAL=""
"RTN","BIPATVW3",67,0)
 ;
"RTN","BIPATVW3",68,0)
 ;---> RPC to retrieve Contraindications.
"RTN","BIPATVW3",69,0)
 D CONTRAS^BIRPC5(.BIRETVAL,BIDFN)
"RTN","BIPATVW3",70,0)
 ;
"RTN","BIPATVW3",71,0)
 ;---> If BIRETERR has a value, display it and quit.
"RTN","BIPATVW3",72,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIPATVW3",73,0)
 I BIRETERR]"" D EN^DDIOL("* "_BIRETERR,"","!!?5"),DIRZ^BIUTL3() Q
"RTN","BIPATVW3",74,0)
 ;
"RTN","BIPATVW3",75,0)
 ;---> Set BICONT=to a string of Contraindications for this patient.
"RTN","BIPATVW3",76,0)
 N BICONT,BILINE S BICONT=$P(BIRETVAL,BI31,1)
"RTN","BIPATVW3",77,0)
 S BILINE=BIRMAX S:BILINE<1 BILINE=1
"RTN","BIPATVW3",78,0)
 ;
"RTN","BIPATVW3",79,0)
 ;---> Write Contraindications Header.
"RTN","BIPATVW3",80,0)
 D:BICONT]""
"RTN","BIPATVW3",81,0)
 .D RTCOL^BIPATVW1(.BILINE,,BIENT)
"RTN","BIPATVW3",82,0)
 .N X S X="-----------------------------------"
"RTN","BIPATVW3",83,0)
 .D RTCOL^BIPATVW1(.BILINE,X,BIENT)
"RTN","BIPATVW3",84,0)
 .D RTCOL^BIPATVW1(.BILINE,"   * CONTRAINDICATIONS/REFUSALS *",BIENT)
"RTN","BIPATVW3",85,0)
 .D RTCOL^BIPATVW1(.BILINE,,BIENT)
"RTN","BIPATVW3",86,0)
 ;
"RTN","BIPATVW3",87,0)
 ;---> Build Listmanager array from BICONT string.
"RTN","BIPATVW3",88,0)
 ;
"RTN","BIPATVW3",89,0)
 N I,Y
"RTN","BIPATVW3",90,0)
 F I=1:1 S Y=$P(BICONT,U,I) Q:Y=""  D
"RTN","BIPATVW3",91,0)
 .;---> Build display line for this Contraindication.
"RTN","BIPATVW3",92,0)
 .N V S V="|"
"RTN","BIPATVW3",93,0)
 .;S X="  "_$P(Y,V,2)_":",X=$$PAD^BIUTL5(X,14)_$P(Y,V,3),X=$E(X,1,40)
"RTN","BIPATVW3",94,0)
 .S X="  "_$P(Y,V,2)_": "_$P(Y,V,3),X=$E(X,1,36)
"RTN","BIPATVW3",95,0)
 .;---> Set formatted Contraindication line and index in ^TMP.
"RTN","BIPATVW3",96,0)
 .D RTCOL^BIPATVW1(.BILINE,X,BIENT)
"RTN","BIPATVW3",97,0)
 ;
"RTN","BIPATVW3",98,0)
 ;---> Save maximum right column line number.
"RTN","BIPATVW3",99,0)
 S BIRMAX=BILINE
"RTN","BIPATVW3",100,0)
 Q
"RTN","BIPATVW3",101,0)
 ;
"RTN","BIPATVW3",102,0)
 ;
"RTN","BIPATVW3",103,0)
 ;----------
"RTN","BIPATVW3",104,0)
ADDINFO(BIDFN,BILINE,BIENT,BIDUZ2,BIFDT) ;EP
"RTN","BIPATVW3",105,0)
 ;---> Display Additional Information from Patient Edit screen.
"RTN","BIPATVW3",106,0)
 ;---> Parameters:
"RTN","BIPATVW3",107,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIPATVW3",108,0)
 ;     2 - BIRMAX (req) Last Line# (last node in ^TMP array).
"RTN","BIPATVW3",109,0)
 ;     3 - BIENT  (ret) Entry Number for LM selection in VALMY
"RTN","BIPATVW3",110,0)
 ;     5 - BIDUZ2 (req) DUZ(2) (for forecasting parameter display).
"RTN","BIPATVW3",111,0)
 ;     4 - BIFDT  (req) Forecast date (for High Risk display).
"RTN","BIPATVW3",112,0)
 ;
"RTN","BIPATVW3",113,0)
 ;---> Check for BIDFN.
"RTN","BIPATVW3",114,0)
 Q:$$DFNCHECK^BIUTL2()
"RTN","BIPATVW3",115,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW3",116,0)
 S:'$G(BIFDT) BIFDT=$G(DT)
"RTN","BIPATVW3",117,0)
 ;
"RTN","BIPATVW3",118,0)
 N X,Z S Z=BIENT
"RTN","BIPATVW3",119,0)
 D WRITE^BIPATVW1(.BILINE,,1,Z)
"RTN","BIPATVW3",120,0)
 D WRITE^BIPATVW1(.BILINE,"   ADDITIONAL PATIENT INFORMATION",,Z)
"RTN","BIPATVW3",121,0)
 D WRITE^BIPATVW1(.BILINE,"   ------------------------------",,Z)
"RTN","BIPATVW3",122,0)
 S X=$$DECEASED^BIUTL1(BIDFN,1)
"RTN","BIPATVW3",123,0)
 D:X
"RTN","BIPATVW3",124,0)
 .S X="   DECEASED on..........: "_$$TXDT1^BIUTL5(X)
"RTN","BIPATVW3",125,0)
 .D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",126,0)
 I '$D(^BIP(BIDFN,0)) D  Q
"RTN","BIPATVW3",127,0)
 .S X="   This Patient is not in the Register."
"RTN","BIPATVW3",128,0)
 .D WRITE^BIPATVW1(.BILINE,X,1,Z)
"RTN","BIPATVW3",129,0)
 ;
"RTN","BIPATVW3",130,0)
 S X="   Case Manager.........: "_$$CMGR^BIUTL1(BIDFN,1)
"RTN","BIPATVW3",131,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",132,0)
 ;
"RTN","BIPATVW3",133,0)
 ; ---
"RTN","BIPATVW3",134,0)
 ; TODO (VEN/SMH):
"RTN","BIPATVW3",135,0)
 ; VISTA has the PCMM package for me grab a provider from.
"RTN","BIPATVW3",136,0)
 ; Alas, not that important, so I am skipping this for VISTA.
"RTN","BIPATVW3",137,0)
 I $$RPMS^BIUTL9() D
"RTN","BIPATVW3",138,0)
 . S X="   Designated Provider..: "_$$DPRV^BIUTL1(BIDFN,1)
"RTN","BIPATVW3",139,0)
 . D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",140,0)
 S X="   Parent/Guardian......: "_$$PARENT^BIUTL1(BIDFN)
"RTN","BIPATVW3",141,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",142,0)
 S X="   Current Community....: "_$$CURCOM^BIUTL11(BIDFN,1)
"RTN","BIPATVW3",143,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",144,0)
 S X="   Date First Entered...: "_$$ENTERED^BIUTL1(BIDFN,,1)
"RTN","BIPATVW3",145,0)
 S X=X_" ("_$$ENTERED^BIUTL1(BIDFN,1,1)_")"
"RTN","BIPATVW3",146,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",147,0)
 D
"RTN","BIPATVW3",148,0)
 .N Y S Y=$$INACT^BIUTL1(BIDFN,1)
"RTN","BIPATVW3",149,0)
 .Q:'Y
"RTN","BIPATVW3",150,0)
 .S X="   Inactive Date........: "_Y
"RTN","BIPATVW3",151,0)
 .I Z]"" S X=X_" (Reason: "_$$INACTRE^BIUTL1(BIDFN)_")"
"RTN","BIPATVW3",152,0)
 .D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",153,0)
 .S X="   Made Inactive by.....: "_$$INACTUSR^BIUTL1(BIDFN)
"RTN","BIPATVW3",154,0)
 .D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",155,0)
 ;
"RTN","BIPATVW3",156,0)
 S X=$$MOVEDLOC^BIUTL1(BIDFN)
"RTN","BIPATVW3",157,0)
 I X]"" S X="   Moved to/Tx Elsewhere: "_X D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",158,0)
 S X="" D
"RTN","BIPATVW3",159,0)
 .Q:'$G(DT)  N BIRISKI,BIRISKP
"RTN","BIPATVW3",160,0)
 .;
"RTN","BIPATVW3",161,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATVW3",162,0)
 .;---> Accommodate new parameter options for HepB (Diabetes).
"RTN","BIPATVW3",163,0)
 .;---> Set risk parameter equal to 12 = Hep B & Pneumo (this is NOT forecasting,
"RTN","BIPATVW3",164,0)
 .;---> merely displaying Additional Patient Info).
"RTN","BIPATVW3",165,0)
 .N BIRSK,BIRISKH S BIRSK=12
"RTN","BIPATVW3",166,0)
 .;
"RTN","BIPATVW3",167,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATVW3",168,0)
 .;---> Collect only Pneumo High Risk.
"RTN","BIPATVW3",169,0)
 .;D RISK^BIDX(BIDFN,BIFDT,0,.BIRISKI,.BIRISKP)
"RTN","BIPATVW3",170,0)
 .;
"RTN","BIPATVW3",171,0)
 .;---> New parameter to return Hep B risk. (No longer include Flu.)
"RTN","BIPATVW3",172,0)
 .;D RISK^BIDX(BIDFN,BIFDT,2,.BIRISKI,.BIRISKP)
"RTN","BIPATVW3",173,0)
 .D RISK^BIDX(BIDFN,BIFDT,BIRSK,,.BIRISKP,.BIRISKH)
"RTN","BIPATVW3",174,0)
 .;**********
"RTN","BIPATVW3",175,0)
 .;
"RTN","BIPATVW3",176,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATVW3",177,0)
 .;---> No longer report on Flu forecast.
"RTN","BIPATVW3",178,0)
 .;I BIRISKI S X="Influenza" I BIRISKP S X=X_" and "
"RTN","BIPATVW3",179,0)
 .I BIRISKH S X="HepB(DM)" I BIRISKP S X=X_" and "
"RTN","BIPATVW3",180,0)
 .I BIRISKP S X=X_"Pneumo"
"RTN","BIPATVW3",181,0)
 I X="" S X="None on record"
"RTN","BIPATVW3",182,0)
 ;S X="   High Risk Flu/Pneumo.: "_X
"RTN","BIPATVW3",183,0)
 ;S X="   High Risk for Pneumo.: "_X
"RTN","BIPATVW3",184,0)
 S X="   High Risk HepB/Pneumo: "_X
"RTN","BIPATVW3",185,0)
 ;**********
"RTN","BIPATVW3",186,0)
 ;
"RTN","BIPATVW3",187,0)
 S X=X_" (as of "_$$SLDT2^BIUTL5(BIFDT,1)_")"
"RTN","BIPATVW3",188,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",189,0)
 S X="   Forecast Flu/Pneumo..: "_$$INFL^BIUTL11(BIDFN,1)
"RTN","BIPATVW3",190,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",191,0)
 ;D:$G(BIDUZ2)  ;Uncomment to display Pneumo Site Parameter.
"RTN","BIPATVW3",192,0)
 ;.N X,Y,Z S X=$$PNMAGE^BIPATUP2(BIDUZ2)
"RTN","BIPATVW3",193,0)
 ;.S Y=$P(X,U),Z=$P(X,U,2)
"RTN","BIPATVW3",194,0)
 ;. X=Y_" years old, "_$S(Z:"every 6 years.",1:"one time only.")
"RTN","BIPATVW3",195,0)
 ;.S X="   Pneumo Site Parameter: Set at "_X
"RTN","BIPATVW3",196,0)
 ;.D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",197,0)
 S X="   Mother's HBsAG Status: "_$$T^BITRS($$MOTHER^BIUTL11(BIDFN,1))
"RTN","BIPATVW3",198,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",199,0)
 S X=$$NEXTAPPT^BIUTL11(BIDFN)
"RTN","BIPATVW3",200,0)
 I ((X]"")&(X'="None")) S X="   Next Appointment.....: "_$E(X,1,54) D
"RTN","BIPATVW3",201,0)
 .D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",202,0)
 D
"RTN","BIPATVW3",203,0)
 .N Y S Y=$$CONSENT^BIUTL1(BIDFN)
"RTN","BIPATVW3",204,0)
 .I Y=1 S X="Consented" Q
"RTN","BIPATVW3",205,0)
 .I Y=0 S X="Declined" Q
"RTN","BIPATVW3",206,0)
 .S X="Unknown"
"RTN","BIPATVW3",207,0)
 S X="   State Registry.......: "_X
"RTN","BIPATVW3",208,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",209,0)
 S X="   Other Information....: "_$$OTHERIN^BIUTL11(BIDFN)
"RTN","BIPATVW3",210,0)
 D WRITE^BIPATVW1(.BILINE,X,,Z)
"RTN","BIPATVW3",211,0)
 D WRITE^BIPATVW1(.BILINE,,,Z)
"RTN","BIPATVW3",212,0)
 Q
"RTN","BIPATVW3",213,0)
 ;
"RTN","BIPATVW3",214,0)
 ;
"RTN","BIPATVW3",215,0)
 ;----------
"RTN","BIPATVW3",216,0)
HELP ;EP
"RTN","BIPATVW3",217,0)
 ;----> Explanation of this report.
"RTN","BIPATVW3",218,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIPATVW3",219,0)
 D START^BIHELP("PATIENT VIEW SCREEN - HELP",.BITEXT)
"RTN","BIPATVW3",220,0)
 Q
"RTN","BIPATVW3",221,0)
 ;
"RTN","BIPATVW3",222,0)
 ;
"RTN","BIPATVW3",223,0)
 ;----------
"RTN","BIPATVW3",224,0)
TEXT1(BITEXT) ;EP
"RTN","BIPATVW3",225,0)
 ;;
"RTN","BIPATVW3",226,0)
 ;;This is the main Patient View Screen, the single point from
"RTN","BIPATVW3",227,0)
 ;;which you manage all of an individual patient's immunization data.
"RTN","BIPATVW3",228,0)
 ;;
"RTN","BIPATVW3",229,0)
 ;;The screen is divided horizontally into THREE SECTIONS:
"RTN","BIPATVW3",230,0)
 ;;
"RTN","BIPATVW3",231,0)
 ;;The TOP third of the screen lists the patient's demographic information,
"RTN","BIPATVW3",232,0)
 ;;most of which is edited through the RPMS Patient Registration.
"RTN","BIPATVW3",233,0)
 ;;
"RTN","BIPATVW3",234,0)
 ;;The MIDDLE third of the screen is subdivided into LEFT and RIGHT Columns:
"RTN","BIPATVW3",235,0)
 ;;
"RTN","BIPATVW3",236,0)
 ;;   The LEFT column lists the Patient's Immunization and Skin Test
"RTN","BIPATVW3",237,0)
 ;;   history, including adverse reactions.
"RTN","BIPATVW3",238,0)
 ;;
"RTN","BIPATVW3",239,0)
 ;;   The RIGHT column lists the patient's Immunizations Due, date of last
"RTN","BIPATVW3",240,0)
 ;;   letter sent to the patient, and any contraindications.
"RTN","BIPATVW3",241,0)
 ;;
"RTN","BIPATVW3",242,0)
 ;;The BOTTOM third of the screen lists Actions you can take to add or edit
"RTN","BIPATVW3",243,0)
 ;;the patient's immunization data, or to display other relevant patient
"RTN","BIPATVW3",244,0)
 ;;information.
"RTN","BIPATVW3",245,0)
 ;;
"RTN","BIPATVW3",246,0)
 ;;For many patients, there is more information than can be displayed
"RTN","BIPATVW3",247,0)
 ;;in the middle section of the screen.  To view all of the information
"RTN","BIPATVW3",248,0)
 ;;on a Patient's Immunization History it may be necessary to use the
"RTN","BIPATVW3",249,0)
 ;;"arrow keys" to scroll up and down.
"RTN","BIPATVW3",250,0)
 ;;
"RTN","BIPATVW3",251,0)
 ;;The Actions at the bottom of the screen are:
"RTN","BIPATVW3",252,0)
 ;;
"RTN","BIPATVW3",253,0)
 ;;  A  Add Immunization  - to add a new immunization
"RTN","BIPATVW3",254,0)
 ;;  D  Delete Visit      - to delete an immunization
"RTN","BIPATVW3",255,0)
 ;;  P  Patient Edit      - to edit patient guardian, inactive date, etc.
"RTN","BIPATVW3",256,0)
 ;;  S  Skin Test Add     - to add a skin test
"RTN","BIPATVW3",257,0)
 ;;  I  ImmServe Profile  - to view details of the forecast
"RTN","BIPATVW3",258,0)
 ;;  C  Contraindications - to add/edit/delete contraindications
"RTN","BIPATVW3",259,0)
 ;;  E  Edit Visit        - to change data of an immunization
"RTN","BIPATVW3",260,0)
 ;;  H  Health Summary    - to view the patient's Health Summary
"RTN","BIPATVW3",261,0)
 ;;  L  Letter Print      - to select and print a patient letter
"RTN","BIPATVW3",262,0)
 ;;
"RTN","BIPATVW3",263,0)
 ;;
"RTN","BIPATVW3",264,0)
 ;;There are also Hidden Actions, which you can review by typing ??
"RTN","BIPATVW3",265,0)
 ;;at the "Select Action:" prompt.  If you entered ??, the Hidden
"RTN","BIPATVW3",266,0)
 ;;Actions will be displayed in a list after this text.  Any of the
"RTN","BIPATVW3",267,0)
 ;;Hidden Actions can be executed by typing their names or synonyms
"RTN","BIPATVW3",268,0)
 ;;at the "Select Action:" prompt, just as with the primary Actions.
"RTN","BIPATVW3",269,0)
 ;;
"RTN","BIPATVW3",270,0)
 ;;NOTE! There are two ways to print a patient's Immunization History:
"RTN","BIPATVW3",271,0)
 ;;
"RTN","BIPATVW3",272,0)
 ;;      1) At the Select Action prompt enter "PL" or "Print List".
"RTN","BIPATVW3",273,0)
 ;;         This action will print or queue the entire Patient View Screen
"RTN","BIPATVW3",274,0)
 ;;         as it appears on your screen.
"RTN","BIPATVW3",275,0)
 ;;
"RTN","BIPATVW3",276,0)
 ;;  or  2) Enter "L" or "Letter Print" and select the "Official
"RTN","BIPATVW3",277,0)
 ;;         Immunization Record" for the form letter to print.
"RTN","BIPATVW3",278,0)
 ;;
"RTN","BIPATVW3",279,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIPATVW3",280,0)
 Q
"RTN","BIPATVW3",281,0)
 ;
"RTN","BIPATVW3",282,0)
 ;
"RTN","BIPATVW3",283,0)
 ;----------
"RTN","BIPATVW3",284,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIPATVW3",285,0)
 Q:$G(BILINL)=""
"RTN","BIPATVW3",286,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPATVW3",287,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIPATVW3",288,0)
 Q
"RTN","BIPCC")
0^82^B2520097
"RTN","BIPCC",1,0)
BIPCC ;IHS/CMI/MWR - DISPLAY PCC LINK INFO; MAY 10, 2010
"RTN","BIPCC",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIPCC",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPCC",4,0)
 ;;  DISPLAY PCC LINK DIAGNOSTIC INFO.
"RTN","BIPCC",5,0)
 ;
"RTN","BIPCC",6,0)
 ;---> *** THIS IS ONLY CALLED IF SET BITEST=1 AT VISIT+64^BIVISIT
"RTN","BIPCC",7,0)
 ;---> *** AND VFILE+40.
"RTN","BIPCC",8,0)
 ;---> *** PROGRAMMER USE ONLY.
"RTN","BIPCC",9,0)
 ;
"RTN","BIPCC",10,0)
 ;
"RTN","BIPCC",11,0)
 ;----------
"RTN","BIPCC",12,0)
DISPLAY1 ;EP
"RTN","BIPCC",13,0)
 ;---> DISPLAY VISIT IEN.
"RTN","BIPCC",14,0)
 I $D(APCDALVR("APCDVSIT")) D
"RTN","BIPCC",15,0)
 .W !,"APCDVSIT DEFINED: ",APCDALVR("APCDVSIT")
"RTN","BIPCC",16,0)
 I $D(APCDALVR("APCDVSIT","NEW")) D
"RTN","BIPCC",17,0)
 .W !,"NEW VISIT: ",APCDALVR("APCDVSIT","NEW")
"RTN","BIPCC",18,0)
 ;---> SHOW FLAG IF VISIT WAS NOT CREATED.
"RTN","BIPCC",19,0)
 I $D(APCDALVR("APCDAFLG")) D
"RTN","BIPCC",20,0)
 .W !,"APCDAFLG DEFINED, FAILED: ",APCDALVR("APCDAFLG")
"RTN","BIPCC",21,0)
 D DIRZ^BIUTL3()
"RTN","BIPCC",22,0)
 Q
"RTN","BIPCC",23,0)
 ;
"RTN","BIPCC",24,0)
 ;
"RTN","BIPCC",25,0)
 ;----------
"RTN","BIPCC",26,0)
DISPLAY2 ;EP
"RTN","BIPCC",27,0)
 ;---> DISPLAY V FILE IEN.
"RTN","BIPCC",28,0)
 I $D(APCDALVR("APCDADFN")) D
"RTN","BIPCC",29,0)
 .W !,"APCDADFN DEFINED: ",APCDALVR("APCDADFN")
"RTN","BIPCC",30,0)
 ;---> SHOW FLAG IF VISIT WAS NOT CREATED.
"RTN","BIPCC",31,0)
 I $D(APCDALVR("APCDAFLG")) D
"RTN","BIPCC",32,0)
 .W !,"APCDAFLG DEFINED, FAILED: ",APCDALVR("APCDAFLG")
"RTN","BIPCC",33,0)
 D DIRZ^BIUTL3()
"RTN","BIPCC",34,0)
 Q
"RTN","BIPCC",35,0)
 ;
"RTN","BIPCC",36,0)
 ;
"RTN","BIPCC",37,0)
 ;----------
"RTN","BIPCC",38,0)
DISPLAY3 ;EP
"RTN","BIPCC",39,0)
 ;---> DISPLAY VISIT AND V FILE GLOBAL NODES AND FILE#70 IENS.
"RTN","BIPCC",40,0)
 W !!,"VISIT FILE: "
"RTN","BIPCC",41,0)
 S N=APCDALVR("APCDVSIT")-3 S:N<0 N=0
"RTN","BIPCC",42,0)
 F  S N=$O(^AUPNVSIT(N)) Q:'N  D
"RTN","BIPCC",43,0)
 .W !,N,": ",^AUPNVSIT(N,0)
"RTN","BIPCC",44,0)
 ;
"RTN","BIPCC",45,0)
 W !!,"V FILE: "
"RTN","BIPCC",46,0)
 S BIVGBL=^DIC(BIVFIL,0,"GL")
"RTN","BIPCC",47,0)
 S N=APCDALVR("APCDADFN")-3,M=N+10 S:N<0 N=0
"RTN","BIPCC",48,0)
 F  S N=$O(@(BIVGBL_"N)")) Q:'N  Q:N>M  D
"RTN","BIPCC",49,0)
 .W !,N,": ",@(BIVGBL_"N,0)")
"RTN","BIPCC",50,0)
 D DIRZ^BIUTL3()
"RTN","BIPCC",51,0)
 Q
"RTN","BIPOST")
0^83^B33788184
"RTN","BIPOST",1,0)
BIPOST ;IHS/CMI/MWR - POST-INIT ROUTINE; OCT 15, 2010
"RTN","BIPOST",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIPOST",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPOST",4,0)
 ;;  PATCH 3: Set MenCY-Hib (148) and Flu-nasal4 (149) and all Skin Tests
"RTN","BIPOST",5,0)
 ;;           in the Vaccine Table to Inactive.   START+30
"RTN","BIPOST",6,0)
 ;;  PATCH 3: Set all Skin Tests in the Skin Test table to Inactive, except
"RTN","BIPOST",7,0)
 ;;           PPD and Tetanus. START+38
"RTN","BIPOST",8,0)
 ;;  PATCH 4, v8.5: Update Source options in Imm Lot File.  START+9
"RTN","BIPOST",9,0)
 ;;  PATCH 5, v8.5: Remove dash from Eligibility Codes.
"RTN","BIPOST",10,0)
 ;;  PATCH 5, v8.5: Add SNOMED Codes to all Contraindications.
"RTN","BIPOST",11,0)
 ;;  PATCH 5, v8.5: Restandardize Vaccine Table, with updates from BITN.
"RTN","BIPOST",12,0)
 ;;  PATCH 6, v8.5: Restandardize Vaccine Table, with updates from BITN.
"RTN","BIPOST",13,0)
 ;;  PATCH 8: Changes to Set Mening C CVX 103 vaccine to Inactive.  START+55
"RTN","BIPOST",14,0)
 ;;  PATCH 9:   Restandardize Vaccine Table, with updates from BITN. START+49
"RTN","BIPOST",15,0)
 ;;             Changes to force specified vaccines active.  START+52
"RTN","BIPOST",16,0)
 ;;             Update Taxonomies.  START+142
"RTN","BIPOST",17,0)
 ;
"RTN","BIPOST",18,0)
 ;
"RTN","BIPOST",19,0)
 ;----------
"RTN","BIPOST",20,0)
START ;EP
"RTN","BIPOST",21,0)
 ;---> Update software after KIDS installation.
"RTN","BIPOST",22,0)
 ;
"RTN","BIPOST",23,0)
 D SETVARS^BIUTL5 S BIPOP=0
"RTN","BIPOST",24,0)
 ;S IOP=$I D ^%ZIS
"RTN","BIPOST",25,0)
 ;
"RTN","BIPOST",26,0)
 ;W !!!?3,"Please hold..."
"RTN","BIPOST",27,0)
 ;
"RTN","BIPOST",28,0)
 ;
"RTN","BIPOST",29,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIPOST",30,0)
 ;---> Remove dash from Eligibility Codes.
"RTN","BIPOST",31,0)
 ;N N S N=0 F  S N=$O(^BIELIG(N)) Q:'N  D
"RTN","BIPOST",32,0)
 ;.N X S X=$P($G(^BIELIG(N,0)),U)
"RTN","BIPOST",33,0)
 ;.Q:(X="")  Q:(X'["-")
"RTN","BIPOST",34,0)
 ;.N Y S Y=$P(X,"-")_$P(X,"-",2)
"RTN","BIPOST",35,0)
 ;.;W !,X,"   ",Y Q
"RTN","BIPOST",36,0)
 ;.S $P(^BIELIG(N,0),U)=Y
"RTN","BIPOST",37,0)
 ;N I F I="AC","B","C","D","E","F","U" K ^BIELIG(I)
"RTN","BIPOST",38,0)
 ;S DIK="^BIELIG("
"RTN","BIPOST",39,0)
 ;D IXALL^DIK
"RTN","BIPOST",40,0)
 ;
"RTN","BIPOST",41,0)
 ;
"RTN","BIPOST",42,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIPOST",43,0)
 ;---> Back-populate SNOMED Codes to all Contraindications.
"RTN","BIPOST",44,0)
 ;D
"RTN","BIPOST",45,0)
 ;.;---> If BCQM IHS CODE MAPPING Version 1.0 is not loaded, abort back-pop.
"RTN","BIPOST",46,0)
 ;.I '($L($T(MM^BCQMAPI))) D  Q
"RTN","BIPOST",47,0)
 ;..D TEXT2,DIRZ^BIUTL3()
"RTN","BIPOST",48,0)
 ;.D SNOMED^BIUTLFIX
"RTN","BIPOST",49,0)
 ;
"RTN","BIPOST",50,0)
 ;
"RTN","BIPOST",51,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPOST",52,0)
 ;---> Update Manufacturer Table.
"RTN","BIPOST",53,0)
 ;S ^BIMAN(167,0)="CRUCELL^CRU^1^Crucell"
"RTN","BIPOST",54,0)
 ;S ^BIMAN(168,0)="KEDRIAN BIOPHARMA^KED^1^Kedrian Biopharma"
"RTN","BIPOST",55,0)
 ;
"RTN","BIPOST",56,0)
 ;**********
"RTN","BIPOST",57,0)
 ;
"RTN","BIPOST",58,0)
 ;********** PATCH 4, v8.5, DEC 01,2012, IHS/CMI/MWR
"RTN","BIPOST",59,0)
 ;---> Update Source options in Imm Lot File.
"RTN","BIPOST",60,0)
 ;N BIX S BIX="^DD(9999999.41,.13,0)"
"RTN","BIPOST",61,0)
 ;S @BIX="VACCINE SOURCE^S^v:VFC;n:NON-VFC;o:Other State;i:IHS/Tribal;^0;13^Q"
"RTN","BIPOST",62,0)
 ;**********
"RTN","BIPOST",63,0)
 ;
"RTN","BIPOST",64,0)
 ;---> Reindex any Listman Hidden Menus.
"RTN","BIPOST",65,0)
 ;D LISTMENU^BIUTLFIX
"RTN","BIPOST",66,0)
 ;
"RTN","BIPOST",67,0)
 ;
"RTN","BIPOST",68,0)
 ;---> Re-Standardize the Vaccine Table.
"RTN","BIPOST",69,0)
 D RESTAND^BIRESTD()
"RTN","BIPOST",70,0)
 ;
"RTN","BIPOST",71,0)
 ;
"RTN","BIPOST",72,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPOST",73,0)
 ;---> Force vaccines Active or Inactive by CVX Code.
"RTN","BIPOST",74,0)
 ;---> Insert CVX Codes into For loop below.
"RTN","BIPOST",75,0)
 ;
"RTN","BIPOST",76,0)
 ;---> Make these CVX's ACTIVE:
"RTN","BIPOST",77,0)
 N BICVX F BICVX=36,86,161 D
"RTN","BIPOST",78,0)
 .N N S N=$$HL7TX^BIUTL2(BICVX)
"RTN","BIPOST",79,0)
 .;---> Quit if CVX is Unknown.
"RTN","BIPOST",80,0)
 .Q:(N=137)
"RTN","BIPOST",81,0)
 .;---> 0=ACTIVE.
"RTN","BIPOST",82,0)
 .S $P(^AUTTIMM(N,0),U,7)=0
"RTN","BIPOST",83,0)
 .S $P(^BITN(N,0),U,7)=0
"RTN","BIPOST",84,0)
 .;
"RTN","BIPOST",85,0)
 ;---> Make these CVX's INACTIVE:
"RTN","BIPOST",86,0)
 N BICVX F BICVX=41,53,79,101,117 D
"RTN","BIPOST",87,0)
 .N N S N=$$HL7TX^BIUTL2(BICVX)
"RTN","BIPOST",88,0)
 .;---> Quit if CVX is Unknown.
"RTN","BIPOST",89,0)
 .Q:(N=137)
"RTN","BIPOST",90,0)
 .;---> 1=INACTIVE.
"RTN","BIPOST",91,0)
 .S $P(^AUTTIMM(N,0),U,7)=1
"RTN","BIPOST",92,0)
 .S $P(^BITN(N,0),U,7)=1
"RTN","BIPOST",93,0)
 ;
"RTN","BIPOST",94,0)
 ;
"RTN","BIPOST",95,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPOST",96,0)
 ;---> Set Mening C CVX 103 vaccine to Inactive.
"RTN","BIPOST",97,0)
 ;F N=143 D
"RTN","BIPOST",98,0)
 ;.S $P(^AUTTIMM(N,0),U,7)=1
"RTN","BIPOST",99,0)
 ;.S $P(^BITN(N,0),U,7)=1
"RTN","BIPOST",100,0)
 ;
"RTN","BIPOST",101,0)
 ;---> Set newer Mening vaccines to Active.
"RTN","BIPOST",102,0)
 ;F N=220,237,251 D
"RTN","BIPOST",103,0)
 ;.S $P(^AUTTIMM(N,0),U,7)=0
"RTN","BIPOST",104,0)
 ;.S $P(^BITN(N,0),U,7)=0
"RTN","BIPOST",105,0)
 ;
"RTN","BIPOST",106,0)
 ;
"RTN","BIPOST",107,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIPOST",108,0)
 ;---> Set all Skin Tests in Vaccine Table to Inactive (so that they will be
"RTN","BIPOST",109,0)
 ;---> unavailable to select as vaccines in EHR).
"RTN","BIPOST",110,0)
 ;---> Set MenCY-Hib (148) and Flu-nasal4 (149) to Inactive.
"RTN","BIPOST",111,0)
 ;N N F N=202,203,204,205,252,253 D
"RTN","BIPOST",112,0)
 ;.S $P(^AUTTIMM(N,0),U,7)=1
"RTN","BIPOST",113,0)
 ;.S $P(^BITN(N,0),U,7)=1
"RTN","BIPOST",114,0)
 ;
"RTN","BIPOST",115,0)
 ;---> Also set all Skin Tests in the Skin Test file Inactive,
"RTN","BIPOST",116,0)
 ;---> except PPD and Tetanus.
"RTN","BIPOST",117,0)
 ;N N S N=0 F  S N=$O(^AUTTSK(N)) Q:'N  D
"RTN","BIPOST",118,0)
 ;.Q:'$D(^AUTTSK(N,0))
"RTN","BIPOST",119,0)
 ;.S $P(^AUTTSK(N,0),U,3)=1
"RTN","BIPOST",120,0)
 ;---> Now set PPD and Tetanus to Active.
"RTN","BIPOST",121,0)
 ;D
"RTN","BIPOST",122,0)
 ;.K N S N=$O(^AUTTSK("B","PPD",0))
"RTN","BIPOST",123,0)
 ;.Q:'N
"RTN","BIPOST",124,0)
 ;.S $P(^AUTTSK(N,0),U,3)=""
"RTN","BIPOST",125,0)
 ;.S N=$O(^AUTTSK("B","TETANUS",0))
"RTN","BIPOST",126,0)
 ;.Q:'N
"RTN","BIPOST",127,0)
 ;.S $P(^AUTTSK(N,0),U,3)=""
"RTN","BIPOST",128,0)
 ;**********
"RTN","BIPOST",129,0)
 ;
"RTN","BIPOST",130,0)
 ;---> Reset Display Order of Vaccine Groups in BI TABLE VACCINE GROUP File #9002084.93.
"RTN","BIPOST",131,0)
 ;S $P(^BISERT(1,0),"^",2)=1
"RTN","BIPOST",132,0)
 ;S $P(^BISERT(2,0),"^",2)=3
"RTN","BIPOST",133,0)
 ;S $P(^BISERT(3,0),"^",2)=4
"RTN","BIPOST",134,0)
 ;S $P(^BISERT(4,0),"^",2)=6
"RTN","BIPOST",135,0)
 ;S $P(^BISERT(5,0),"^",2)=5
"RTN","BIPOST",136,0)
 ;S $P(^BISERT(6,0),"^",2)=7
"RTN","BIPOST",137,0)
 ;S $P(^BISERT(7,0),"^",2)=8
"RTN","BIPOST",138,0)
 ;S $P(^BISERT(8,0),"^",2)=2
"RTN","BIPOST",139,0)
 ;S $P(^BISERT(9,0),"^",2)=9
"RTN","BIPOST",140,0)
 ;S $P(^BISERT(10,0),"^",2)=10
"RTN","BIPOST",141,0)
 ;S $P(^BISERT(11,0),"^",2)=12
"RTN","BIPOST",142,0)
 ;S $P(^BISERT(12,0),"^",2)=90
"RTN","BIPOST",143,0)
 ;S $P(^BISERT(13,0),"^",2)=99
"RTN","BIPOST",144,0)
 ;S $P(^BISERT(14,0),"^",2)=95
"RTN","BIPOST",145,0)
 ;S $P(^BISERT(15,0),"^",2)=85
"RTN","BIPOST",146,0)
 ;S $P(^BISERT(16,0),"^",2)=15
"RTN","BIPOST",147,0)
 ;S $P(^BISERT(17,0),"^",2)=18
"RTN","BIPOST",148,0)
 ;S $P(^BISERT(18,0),"^",2)=11
"RTN","BIPOST",149,0)
 ;
"RTN","BIPOST",150,0)
 ;---> Turn off H1N1forecasting.
"RTN","BIPOST",151,0)
 ;S $P(^BISERT(18,0),"^",5)=0
"RTN","BIPOST",152,0)
 ;
"RTN","BIPOST",153,0)
 ;---> Standardize the VT-100 Codes in the Terminal Type File.
"RTN","BIPOST",154,0)
 ;D ^BIVT100
"RTN","BIPOST",155,0)
 ;---> Set new Immserve Path.
"RTN","BIPOST",156,0)
 ;D IMMPATH
"RTN","BIPOST",157,0)
 ;---> Check and fix any Lot Numbers with a Status of null.
"RTN","BIPOST",158,0)
 ;D NULLACT^BILOT1
"RTN","BIPOST",159,0)
 ;---> Reindex killed globals.
"RTN","BIPOST",160,0)
 ;D REINDEX
"RTN","BIPOST",161,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPOST",162,0)
 ;---> Update Taxonomies.
"RTN","BIPOST",163,0)
 D ^BITX
"RTN","BIPOST",164,0)
 ;---> Reindex BI Letter Sample and BI Table Manufactures Files.
"RTN","BIPOST",165,0)
 ;D REINDLS
"RTN","BIPOST",166,0)
 ;
"RTN","BIPOST",167,0)
 ;---> Kill dangling xref to old file.
"RTN","BIPOST",168,0)
 ;K ^DIC("B","BI IMMUNIZATION TABLE OLD LOCAL",9002084.95)
"RTN","BIPOST",169,0)
 ;
"RTN","BIPOST",170,0)
 ;---> Scan for any V Imms with a .14 Eligibility=0, change to 8, which is
"RTN","BIPOST",171,0)
 ;---> the IEN of "Unknown" in the new BI TABLE ELIG File.
"RTN","BIPOST",172,0)
 ;D ^BIELIG3
"RTN","BIPOST",173,0)
 ;
"RTN","BIPOST",174,0)
 ;---> Update BI TABLE DATA ELEMENTS File.
"RTN","BIPOST",175,0)
 D ^BIDE
"RTN","BIPOST",176,0)
 ;
"RTN","BIPOST",177,0)
 ;---> Update "Last Version Fully Installed" Field in BI SITE PARAMETER File.
"RTN","BIPOST",178,0)
 N N S N=0 F  S N=$O(^BISITE(N)) Q:'N  S $P(^BISITE(N,0),"^",15)=$$VER^BILOGO
"RTN","BIPOST",179,0)
 ;
"RTN","BIPOST",180,0)
 ;D TEXT2,DIRZ^BIUTL3()
"RTN","BIPOST",181,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIPOST",182,0)
 ;
"RTN","BIPOST",183,0)
 D EXIT
"RTN","BIPOST",184,0)
 Q
"RTN","BIPOST",185,0)
 ;
"RTN","BIPOST",186,0)
 ;
"RTN","BIPOST",187,0)
 ;----------
"RTN","BIPOST",188,0)
EXIT ;EP
"RTN","BIPOST",189,0)
 D KILLALL^BIUTL8(1)
"RTN","BIPOST",190,0)
 Q
"RTN","BIPOST",191,0)
 ;
"RTN","BIPOST",192,0)
 ;
"RTN","BIPOST",193,0)
 ;
"RTN","BIPOST",194,0)
 ;----------
"RTN","BIPOST",195,0)
TEXT1 ;EP
"RTN","BIPOST",196,0)
 ;;
"RTN","BIPOST",197,0)
 ;;
"RTN","BIPOST",198,0)
 ;;
"RTN","BIPOST",199,0)
 ;;
"RTN","BIPOST",200,0)
 ;;
"RTN","BIPOST",201,0)
 ;;
"RTN","BIPOST",202,0)
 ;;         - This concludes the Post-Initialization program. -
"RTN","BIPOST",203,0)
 ;;
"RTN","BIPOST",204,0)
 ;;                       * CONGRATULATIONS! *
"RTN","BIPOST",205,0)
 ;;
"RTN","BIPOST",206,0)
 ;;          You have successfully installed Immunization v8.59.
"RTN","BIPOST",207,0)
 ;;
"RTN","BIPOST",208,0)
 ;;
"RTN","BIPOST",209,0)
 ;;
"RTN","BIPOST",210,0)
 ;;
"RTN","BIPOST",211,0)
 ;;
"RTN","BIPOST",212,0)
 ;;
"RTN","BIPOST",213,0)
 ;;
"RTN","BIPOST",214,0)
 ;;
"RTN","BIPOST",215,0)
 W @IOF
"RTN","BIPOST",216,0)
 D PRINTX("TEXT1")
"RTN","BIPOST",217,0)
 Q
"RTN","BIPOST",218,0)
 ;**********
"RTN","BIPOST",219,0)
 ;
"RTN","BIPOST",220,0)
 ;
"RTN","BIPOST",221,0)
 ;----------
"RTN","BIPOST",222,0)
TEXT2 ;EP
"RTN","BIPOST",223,0)
 ;;
"RTN","BIPOST",224,0)
 ;;
"RTN","BIPOST",225,0)
 ;;
"RTN","BIPOST",226,0)
 ;;
"RTN","BIPOST",227,0)
 ;;                            * NOTE!!! *
"RTN","BIPOST",228,0)
 ;;
"RTN","BIPOST",229,0)
 ;; NOTE: Be sure that you have installed the new TCH FORECASTER,
"RTN","BIPOST",230,0)
 ;;       as outlined in the TCH Forecaster Installation Instructions
"RTN","BIPOST",231,0)
 ;;       (separate document in this distribution).
"RTN","BIPOST",232,0)
 ;;
"RTN","BIPOST",233,0)
 ;;       Immunization forecasting will not work if you have not
"RTN","BIPOST",234,0)
 ;;       performed this crucial step in addition to the KIDS file
"RTN","BIPOST",235,0)
 ;;       installation.
"RTN","BIPOST",236,0)
 ;;
"RTN","BIPOST",237,0)
 ;;                            * NOTE!!! *
"RTN","BIPOST",238,0)
 ;;
"RTN","BIPOST",239,0)
 ;;
"RTN","BIPOST",240,0)
 ;;
"RTN","BIPOST",241,0)
 ;;
"RTN","BIPOST",242,0)
 ;;
"RTN","BIPOST",243,0)
 W @IOF
"RTN","BIPOST",244,0)
 D PRINTX("TEXT2")
"RTN","BIPOST",245,0)
 Q
"RTN","BIPOST",246,0)
 ;
"RTN","BIPOST",247,0)
 ;
"RTN","BIPOST",248,0)
 ;----------
"RTN","BIPOST",249,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIPOST",250,0)
 ;---> Print text at specified line label.
"RTN","BIPOST",251,0)
 ;
"RTN","BIPOST",252,0)
 Q:$G(BILINL)=""
"RTN","BIPOST",253,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPOST",254,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIPOST",255,0)
 Q
"RTN","BIPOST",256,0)
 ;
"RTN","BIPOST",257,0)
 ;
"RTN","BIPOST",258,0)
 ;----------
"RTN","BIPOST",259,0)
IMMPATH ;EP
"RTN","BIPOST",260,0)
 ;---> Update path for new Immserve files.
"RTN","BIPOST",261,0)
 N N,X,Y S Y=$$VERSION^%ZOSV(1) D
"RTN","BIPOST",262,0)
 .I Y["Windows" S X="C:\Program Files\Immserve852\" Q
"RTN","BIPOST",263,0)
 .I Y["UNIX" S X="/usr/local/immserve852/"
"RTN","BIPOST",264,0)
 ;
"RTN","BIPOST",265,0)
 S N=0
"RTN","BIPOST",266,0)
 F  S N=$O(^BISITE(N)) Q:'N  D
"RTN","BIPOST",267,0)
 .S $P(^BISITE(N,0),"^",18)=X
"RTN","BIPOST",268,0)
 Q
"RTN","BIPOST",269,0)
 ;
"RTN","BIPOST",270,0)
 ;
"RTN","BIPOST",271,0)
 ;----------
"RTN","BIPOST",272,0)
REINDEX ;EP
"RTN","BIPOST",273,0)
 ;---> Not called.  Programmer to use if KIDS fails to index these files.
"RTN","BIPOST",274,0)
 ;
"RTN","BIPOST",275,0)
 N DIK
"RTN","BIPOST",276,0)
 F DIK="^BINFO(","^BILETS(","^BIVT100(","^BIERR(","^BINFO(","^BIEXPDD(","^BISERT(","^BICONT(" D
"RTN","BIPOST",277,0)
 .D IXALL^DIK
"RTN","BIPOST",278,0)
 .S DIK="^BISERT(" D IXALL^DIK
"RTN","BIPOST",279,0)
 Q
"RTN","BIPOST",280,0)
 ;
"RTN","BIPOST",281,0)
 ;
"RTN","BIPOST",282,0)
KEYS ;EP
"RTN","BIPOST",283,0)
 ;---> Clean up subordinate keys (there should be none).
"RTN","BIPOST",284,0)
 N X,Y
"RTN","BIPOST",285,0)
 F X="BIZ EDIT PATIENTS","BIZ MANAGER","BIZMENU" D
"RTN","BIPOST",286,0)
 .S Y=$O(^DIC(19.1,"B",X,0)) K @("^DIC(19.1,"""_Y_""",3)")
"RTN","BIPOST",287,0)
 Q
"RTN","BIPOST",288,0)
 ;
"RTN","BIPOST",289,0)
 ;
"RTN","BIPOST",290,0)
REINDLS ;EP
"RTN","BIPOST",291,0)
 ;---> Reindex BI LETTER SAMPLE File.
"RTN","BIPOST",292,0)
 N X,Y
"RTN","BIPOST",293,0)
 S DIK="^BILETS("
"RTN","BIPOST",294,0)
 D IXALL^DIK
"RTN","BIPOST",295,0)
 S DIK="^BIMAN("
"RTN","BIPOST",296,0)
 D IXALL^DIK
"RTN","BIPOST",297,0)
 Q
"RTN","BIPRE")
0^84^B33992941
"RTN","BIPRE",1,0)
BIPRE ;IHS/CMI/MWR - PRE-INIT ROUTINE; OCT 15, 2010
"RTN","BIPRE",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIPRE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPRE",4,0)
 ;;  PRE-INIT TO REMOVE PREVIOUS ^DD's, RPC's, Forms, List Templates,
"RTN","BIPRE",5,0)
 ;;  and Protocols in the 9002084-9002084.9999 and BI* Spaces.
"RTN","BIPRE",6,0)
 ;;  PATCH 1: Change DIU(0)="T" to DIU(0)="S" to preserve local templates: DD+7
"RTN","BIPRE",7,0)
 ;;  PATCH 3: Clear BIMAN global for updates.
"RTN","BIPRE",8,0)
 ;;  PATCH 9: Delete all previous BI TABLE DATA ELEMENTS.
"RTN","BIPRE",9,0)
 ;
"RTN","BIPRE",10,0)
 ;----------
"RTN","BIPRE",11,0)
MAIN ;EP
"RTN","BIPRE",12,0)
 ;---> Pre-init program.
"RTN","BIPRE",13,0)
 ;
"RTN","BIPRE",14,0)
 D SETVARS^BIUTL5 S BIPOP=0
"RTN","BIPRE",15,0)
 S BIPTITL="v"_$$VER^BILOGO_" PRE-INIT PROGRAM"
"RTN","BIPRE",16,0)
 ;D PERMISS(.BIPOP) I BIPOP D EXIT Q
"RTN","BIPRE",17,0)
 ;S DUZ(0)="@"
"RTN","BIPRE",18,0)
 ;
"RTN","BIPRE",19,0)
 ;---> Delete all old Error Codes.  Added. vvv83
"RTN","BIPRE",20,0)
 ;D ZGBL^BIUTL8("^BIERR")
"RTN","BIPRE",21,0)
 ;---> Delete all previous BI Manufacturers.
"RTN","BIPRE",22,0)
 ;D ZGBL^BIUTL8("^BIMAN")
"RTN","BIPRE",23,0)
 ;---> Delete all previous BI Eligibility Codes (for preloaded Beta Sites).
"RTN","BIPRE",24,0)
 ;D ZGBL^BIUTL8("^BIELIG")
"RTN","BIPRE",25,0)
 ;
"RTN","BIPRE",26,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPRE",27,0)
 ;---> Delete all previous BI TABLE DATA ELEMENTS.
"RTN","BIPRE",28,0)
 D ZGBL^BIUTL8("^BIEXPDD")
"RTN","BIPRE",29,0)
 ;
"RTN","BIPRE",30,0)
 ;W !!,"DO SOMETHING HERE?" R ZZZ
"RTN","BIPRE",31,0)
 Q
"RTN","BIPRE",32,0)
 ;
"RTN","BIPRE",33,0)
 ;
"RTN","BIPRE",34,0)
 D DD
"RTN","BIPRE",35,0)
 D RPCS
"RTN","BIPRE",36,0)
 D FORMS
"RTN","BIPRE",37,0)
 D LISTS
"RTN","BIPRE",38,0)
 D PROTOCOL
"RTN","BIPRE",39,0)
 D CLRGLBS
"RTN","BIPRE",40,0)
 D EXIT
"RTN","BIPRE",41,0)
 Q
"RTN","BIPRE",42,0)
 ;
"RTN","BIPRE",43,0)
 ;
"RTN","BIPRE",44,0)
 ;----------
"RTN","BIPRE",45,0)
PERMISS(BIPOP) ;EP
"RTN","BIPRE",46,0)
 ;---> Set up proper permission to delete Data Dictionaries.
"RTN","BIPRE",47,0)
 S BIPOP=0
"RTN","BIPRE",48,0)
 Q:DUZ(0)["@"
"RTN","BIPRE",49,0)
 W !!!! D TITLE^BIUTL5(BIPTITL)
"RTN","BIPRE",50,0)
 D TEXT1,DIRZ^BIUTL3 S BIPOP=1
"RTN","BIPRE",51,0)
 Q
"RTN","BIPRE",52,0)
 ;
"RTN","BIPRE",53,0)
 ;
"RTN","BIPRE",54,0)
 ;----------
"RTN","BIPRE",55,0)
DD ;EP
"RTN","BIPRE",56,0)
 ;---> Delete all BI Package Data Dictionaries.
"RTN","BIPRE",57,0)
 N N
"RTN","BIPRE",58,0)
 D TITLE^BIUTL5(BIPTITL)
"RTN","BIPRE",59,0)
 D TEXT2
"RTN","BIPRE",60,0)
 ;---> BY DD#.
"RTN","BIPRE",61,0)
 ;
"RTN","BIPRE",62,0)
 ;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIPRE",63,0)
 ;---> PATCH 1: Change DIU(0)="T" to DIU(0)="S" to preserve local templates.
"RTN","BIPRE",64,0)
 ;S N=9002083.99999,DIU(0)="T"
"RTN","BIPRE",65,0)
 S N=9002083.99999,DIU(0)="S"
"RTN","BIPRE",66,0)
 ;**********
"RTN","BIPRE",67,0)
 ;
"RTN","BIPRE",68,0)
 F  S N=$O(^DD(N)) Q:'+N  Q:N'<9002085  D
"RTN","BIPRE",69,0)
 .W !?6,N
"RTN","BIPRE",70,0)
 .S DIU=N
"RTN","BIPRE",71,0)
 .D EN^DIU2
"RTN","BIPRE",72,0)
 ;S N=9999999.14,DIU=N W !?6,N D EN^DIU2  ;IMMUNIZATION (VACCINE TABLE)
"RTN","BIPRE",73,0)
 ;S N=9999999.04,DIU=N W !?6,N D EN^DIU2  ;IMM MANUFACTURER
"RTN","BIPRE",74,0)
 S N=9999999.41,DIU=N W !?6,N D EN^DIU2  ;IMMUNIZATION LOT
"RTN","BIPRE",75,0)
 K DIU
"RTN","BIPRE",76,0)
 W !?5,"Data Dictionary deletion complete." H 1
"RTN","BIPRE",77,0)
 ;
"RTN","BIPRE",78,0)
 F N="ERR","EXPDD","SERT" D
"RTN","BIPRE",79,0)
 .D ZGBL^BIUTL8("^BI"_N)
"RTN","BIPRE",80,0)
 W !?5,"Old BI standard tables deletion complete." H 1
"RTN","BIPRE",81,0)
 ;
"RTN","BIPRE",82,0)
 Q
"RTN","BIPRE",83,0)
 ;
"RTN","BIPRE",84,0)
 ;
"RTN","BIPRE",85,0)
 ;----------
"RTN","BIPRE",86,0)
RPCS ;EP
"RTN","BIPRE",87,0)
 ;---> Delete all RPCs in BI Namespace.
"RTN","BIPRE",88,0)
 W !!!?6,"The Pre-Initialization Program is removing all old Remote"
"RTN","BIPRE",89,0)
 W !?6,"Procedure Calls.  Please stand by...",!
"RTN","BIPRE",90,0)
 S N="BI",DIK="^XWB(8994,"
"RTN","BIPRE",91,0)
 F  S N=$O(^XWB(8994,"B",N)) Q:N=""!(N]"BIZZZ")  D
"RTN","BIPRE",92,0)
 .S DA=$O(^XWB(8994,"B",N,0))
"RTN","BIPRE",93,0)
 .D ^DIK
"RTN","BIPRE",94,0)
 Q
"RTN","BIPRE",95,0)
 ;
"RTN","BIPRE",96,0)
 ;
"RTN","BIPRE",97,0)
 ;----------
"RTN","BIPRE",98,0)
FORMS ;EP
"RTN","BIPRE",99,0)
 ;---> Delete all BI Forms and Blocks.
"RTN","BIPRE",100,0)
 W !!!?6,"The Pre-Initialization Program is removing all old Screenman"
"RTN","BIPRE",101,0)
 W !?6,"forms and blocks.  Please stand by...",!
"RTN","BIPRE",102,0)
 S N="BI",DIK="^DIST(.403,"
"RTN","BIPRE",103,0)
 F  S N=$O(^DIST(.403,"B",N)) Q:N=""!(N]"BIZZZ")  D
"RTN","BIPRE",104,0)
 .S DA=$O(^DIST(.403,"B",N,0))
"RTN","BIPRE",105,0)
 .D ^DIK
"RTN","BIPRE",106,0)
 ;
"RTN","BIPRE",107,0)
 S N="BI",DIK="^DIST(.404,"
"RTN","BIPRE",108,0)
 F  S N=$O(^DIST(.404,"B",N)) Q:N=""!(N]"BIZZZ")  D
"RTN","BIPRE",109,0)
 .S DA=$O(^DIST(.404,"B",N,0))
"RTN","BIPRE",110,0)
 .D ^DIK
"RTN","BIPRE",111,0)
 W !?6,"Screen deletions complete." H 1
"RTN","BIPRE",112,0)
 Q
"RTN","BIPRE",113,0)
 ;
"RTN","BIPRE",114,0)
 ;
"RTN","BIPRE",115,0)
 ;----------
"RTN","BIPRE",116,0)
LISTS ;EP
"RTN","BIPRE",117,0)
 ;---> Delete all LIST Templates in BI Namespace.
"RTN","BIPRE",118,0)
 W !!!?6,"The Pre-Initialization Program is removing all old"
"RTN","BIPRE",119,0)
 W !?6,"List Templates.  Please stand by...",!
"RTN","BIPRE",120,0)
 S N="BI",DIK="^SD(409.61,"
"RTN","BIPRE",121,0)
 F  S N=$O(^SD(409.61,"B",N)) Q:N=""!(N]"BIZZZ")  D
"RTN","BIPRE",122,0)
 .S DA=$O(^SD(409.61,"B",N,0))
"RTN","BIPRE",123,0)
 .D ^DIK
"RTN","BIPRE",124,0)
 Q
"RTN","BIPRE",125,0)
 ;
"RTN","BIPRE",126,0)
 ;
"RTN","BIPRE",127,0)
 ;----------
"RTN","BIPRE",128,0)
PROTOCOL ;EP
"RTN","BIPRE",129,0)
 ;---> Delete all Protocols in BI Namespace.
"RTN","BIPRE",130,0)
 W !!!?6,"The Pre-Initialization Program is removing all old Protocols"
"RTN","BIPRE",131,0)
 W !?6,"Please stand by...",!
"RTN","BIPRE",132,0)
 S N="BI",DIK="^ORD(101,"
"RTN","BIPRE",133,0)
 F  S N=$O(^ORD(101,"B",N)) Q:N=""!(N]"BIZZZ")  D
"RTN","BIPRE",134,0)
 .S DA=$O(^ORD(101,"B",N,0))
"RTN","BIPRE",135,0)
 .D ^DIK
"RTN","BIPRE",136,0)
 Q
"RTN","BIPRE",137,0)
 ;
"RTN","BIPRE",138,0)
 ;
"RTN","BIPRE",139,0)
 ;----------
"RTN","BIPRE",140,0)
CLRGLBS ;EP
"RTN","BIPRE",141,0)
 ;---> Delete globals of standard data that will have data placed
"RTN","BIPRE",142,0)
 ;---> in them by KIDS.
"RTN","BIPRE",143,0)
 ;---> Delete all old text in BI PACKAGE INFORMATION.
"RTN","BIPRE",144,0)
 D ZGBL^BIUTL8("^BINFO")
"RTN","BIPRE",145,0)
 ;---> Delete all old Sample Letters.
"RTN","BIPRE",146,0)
 D ZGBL^BIUTL8("^BILETS")
"RTN","BIPRE",147,0)
 ;---> Delete all old Error Codes.  Added. vvv83
"RTN","BIPRE",148,0)
 D ZGBL^BIUTL8("^BIERR")
"RTN","BIPRE",149,0)
 ;---> Delete VT-100 Codes.
"RTN","BIPRE",150,0)
 D KGBL^BIUTL8("^BIVT100")
"RTN","BIPRE",151,0)
 Q
"RTN","BIPRE",152,0)
 ;
"RTN","BIPRE",153,0)
 ;
"RTN","BIPRE",154,0)
 ;----------
"RTN","BIPRE",155,0)
TEXT1 ;
"RTN","BIPRE",156,0)
 ;;This preinit clears all data dictionaries out of the Immunization
"RTN","BIPRE",157,0)
 ;;number space (9002084-9002084.99) before loading the new data
"RTN","BIPRE",158,0)
 ;;dictionaries.  In order for this to occur, your DUZ(0) must contain
"RTN","BIPRE",159,0)
 ;;the "@".  Your DUZ(0), however, does NOT contain the "@", and the
"RTN","BIPRE",160,0)
 ;;SAC standards prevent this program from setting it for you.
"RTN","BIPRE",161,0)
 ;;
"RTN","BIPRE",162,0)
 ;;You can set your DUZ(0)=@ by entering S DUZ(0)="@" at the programmer
"RTN","BIPRE",163,0)
 ;;prompt, or by entering Fileman in programmer mode: enter D P^DI at
"RTN","BIPRE",164,0)
 ;;the programmer prompt and then simply press RETURN to back out of it.
"RTN","BIPRE",165,0)
 ;;
"RTN","BIPRE",166,0)
 ;;After resetting your DUZ(0), you may begin the init process again
"RTN","BIPRE",167,0)
 ;;by entering D ^BIINIT at the programmer prompt.
"RTN","BIPRE",168,0)
 ;;
"RTN","BIPRE",169,0)
 ;;This init will now terminate without having made any changes to the
"RTN","BIPRE",170,0)
 ;;current software.
"RTN","BIPRE",171,0)
 D PRINTX("TEXT1")
"RTN","BIPRE",172,0)
 Q
"RTN","BIPRE",173,0)
 ;
"RTN","BIPRE",174,0)
 ;
"RTN","BIPRE",175,0)
 ;----------
"RTN","BIPRE",176,0)
TEXT2 ;
"RTN","BIPRE",177,0)
 ;;The Pre-Initialization Program is removing all old Data Dictionaries
"RTN","BIPRE",178,0)
 ;;in the 9002084-9002084.9999 number space and old BI standard tables.
"RTN","BIPRE",179,0)
 ;;Please stand by...
"RTN","BIPRE",180,0)
 ;;
"RTN","BIPRE",181,0)
 D PRINTX("TEXT2")
"RTN","BIPRE",182,0)
 Q
"RTN","BIPRE",183,0)
 ;
"RTN","BIPRE",184,0)
 ;
"RTN","BIPRE",185,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIPRE",186,0)
 Q:$G(BILINL)=""
"RTN","BIPRE",187,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPRE",188,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIPRE",189,0)
 Q
"RTN","BIPRE",190,0)
 ;
"RTN","BIPRE",191,0)
 ;
"RTN","BIPRE",192,0)
 ;----------
"RTN","BIPRE",193,0)
EXIT ;EP
"RTN","BIPRE",194,0)
 ;---> End of job cleanup.
"RTN","BIPRE",195,0)
 D KILLALL^BIUTL8(1)
"RTN","BIPRE",196,0)
 Q
"RTN","BIREP")
0^85^B30342488
"RTN","BIREP",1,0)
BIREP ;IHS/CMI/MWR - REPORT, GENERIC DISPLAYS; MAY 10, 2010
"RTN","BIREP",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREP",4,0)
 ;;  GENERIC DISPLAY TEXT FOR REPORTS.
"RTN","BIREP",5,0)
 ;
"RTN","BIREP",6,0)
 ;
"RTN","BIREP",7,0)
 ;----------
"RTN","BIREP",8,0)
DISP(BILINE,BINOD,BIAR,BIITEM,BIMENU,BINDX,BIAL,BINDNT,BITAB2,BIITEM2,BIAPP) ;EP
"RTN","BIREP",9,0)
 ;---> Display Report Parameter Setting on report menu.
"RTN","BIREP",10,0)
 ;---> Parameters:
"RTN","BIREP",11,0)
 ;     1 - BILINE  (ret) Last line# written.
"RTN","BIREP",12,0)
 ;     2 - BINOD   (req) Node in ^TMP to store lines under.
"RTN","BIREP",13,0)
 ;     3 - BIAR    (opt) Local array of IEN's for this parameter
"RTN","BIREP",14,0)
 ;                       (BICC, BIHCF, etc.)
"RTN","BIREP",15,0)
 ;     4 - BIITEM  (req) Generic name of item.
"RTN","BIREP",16,0)
 ;     5 - BIMENU  (req) The Menu Number of this parameter.
"RTN","BIREP",17,0)
 ;     6 - BINDX   (req) The index of call (below) for text of a single entry.
"RTN","BIREP",18,0)
 ;     7 - BIAL    (opt) Add additional linefeeds after paramter
"RTN","BIREP",19,0)
 ;                       display. (Default is 1.)
"RTN","BIREP",20,0)
 ;     8 - BINDNT  (opt) Left indent (default=4).
"RTN","BIREP",21,0)
 ;     9 - BITAB2  (opt) Second tab postion where ":" occurs (default=36).
"RTN","BIREP",22,0)
 ;    10 - BIITEM2 (opt) Generic item name in "# Items Selected" prompt.
"RTN","BIREP",23,0)
 ;    11 - BIAPP   (opt) Text to append to display line (such as date range)
"RTN","BIREP",24,0)
 ;                       or on new line below at same ":" tab.
"RTN","BIREP",25,0)
 ;
"RTN","BIREP",26,0)
 I '$D(BILINE)!('$D(BINOD))!('$D(BIITEM))!('$D(BIMENU)) D  Q
"RTN","BIREP",27,0)
 .D ERRCD^BIUTL2(669,,1)
"RTN","BIREP",28,0)
 ;
"RTN","BIREP",29,0)
 N BIAR1,BIITEMS,I,X S BIAR1=""
"RTN","BIREP",30,0)
 S:'$G(BINDX) BINDX=0
"RTN","BIREP",31,0)
 S:'$G(BINDNT) BINDNT=4
"RTN","BIREP",32,0)
 S:'$G(BITAB2) BITAB2=36
"RTN","BIREP",33,0)
 ;---> Get plural form of item name.
"RTN","BIREP",34,0)
 D PLURAL^BISELECT(BIITEM,.BIITEMS)
"RTN","BIREP",35,0)
 D
"RTN","BIREP",36,0)
 .S:'$D(BIAR) BIAR("ALL")=""
"RTN","BIREP",37,0)
 .I $D(BIAR("ALL")) S BIAR1="ALL" Q
"RTN","BIREP",38,0)
 .N I,M,N,P S (N,P)=0
"RTN","BIREP",39,0)
 .F I=0:1 S N=$O(BIAR(N)) Q:'N  S M=N,P=P+1
"RTN","BIREP",40,0)
 .;---> If only one item, get the text of its name.
"RTN","BIREP",41,0)
 .I I=1&(BINDX=1) S BIAR1=$$CCTX^BIUTL6(M) Q
"RTN","BIREP",42,0)
 .I I=1&(BINDX=2) S BIAR1=$$INSTTX^BIUTL6(M) Q
"RTN","BIREP",43,0)
 .I I=1&(BINDX=3) S BIAR1=$$PERSON^BIUTL1(M) Q
"RTN","BIREP",44,0)
 .I I=1&(BINDX=4) S BIAR1=$$BENTX^BIUTL6(M) Q
"RTN","BIREP",45,0)
 .I I=1&(BINDX=5) S BIAR1=$$CCTX^BIUTL6(M) Q
"RTN","BIREP",46,0)
 .I I=1&(BINDX=6) S BIAR1=$$VNAME^BIUTL2(M) Q
"RTN","BIREP",47,0)
 .I I=1&(BINDX=7) S BIAR1=$$LOTTX^BIUTL6(M) Q
"RTN","BIREP",48,0)
 .;---> Prototype line for new calls:
"RTN","BIREP",49,0)
 .;I I=1&(BINDX=6) S BIAR1=$$CALL^ROUTINE(M) Q
"RTN","BIREP",50,0)
 .S BIAR1=P_" "_$S(I=1:BIITEM,$D(BIITEM2):BIITEM2,1:BIITEMS)_" selected."
"RTN","BIREP",51,0)
 ;
"RTN","BIREP",52,0)
 S X="" F I=1:1:BINDNT S X=X_" "
"RTN","BIREP",53,0)
 S X=X_$S(BIMENU>9:"",1:" ")_BIMENU_" - "_BIITEM
"RTN","BIREP",54,0)
 S X=$$PAD^BIUTL5(X,BITAB2,".")_": "_BIAR1
"RTN","BIREP",55,0)
 ;
"RTN","BIREP",56,0)
 ;---> If there's something to append and it fits, append it; if the resulting
"RTN","BIREP",57,0)
 ;---> line would be too long, then write the append on a second line after.
"RTN","BIREP",58,0)
 ;---> Killing BIAPP signals that it was appended and does not need another line.
"RTN","BIREP",59,0)
 I $G(BIAPP)]"",$L(X_BIAPP)<78 S X=X_BIAPP K BIAPP
"RTN","BIREP",60,0)
 ;
"RTN","BIREP",61,0)
 ;---> If additional blank lines were to be added, add them to the append.
"RTN","BIREP",62,0)
 I $G(BIAPP)]"",$G(BIAL) N BIAL1 S BIAL1=BIAL,BIAL=0
"RTN","BIREP",63,0)
 ;
"RTN","BIREP",64,0)
 D WL^BIW(.BILINE,BINOD,X,$S($D(BIAL):+BIAL,1:1))
"RTN","BIREP",65,0)
 ;---> If there's something to append and it did not fit, write a second line.
"RTN","BIREP",66,0)
 I $G(BIAPP)]"" S X=BIAPP,X=$$SP^BIUTL5(BITAB2+1)_X D WL^BIW(.BILINE,BINOD,X,$G(BIAL1))
"RTN","BIREP",67,0)
 Q
"RTN","BIREP",68,0)
 ;
"RTN","BIREP",69,0)
 ;
"RTN","BIREP",70,0)
 ;----------
"RTN","BIREP",71,0)
DATE(BILINE,BINOD,BIMENU,BIDT,BIDTTX,BIAL,BINDNT,BITAB2,BISL) ;EP
"RTN","BIREP",72,0)
 ;---> Display Report Parameter Date Range.
"RTN","BIREP",73,0)
 ;---> Parameters:
"RTN","BIREP",74,0)
 ;     1 - BILINE  (ret) Last line# written.
"RTN","BIREP",75,0)
 ;     2 - BINOD   (req) Node in ^TMP to store lines under.
"RTN","BIREP",76,0)
 ;     3 - BIMENU  (req) The Menu Number of this parameter.
"RTN","BIREP",77,0)
 ;     4 - BIDT    (opt) Date.
"RTN","BIREP",78,0)
 ;     5 - BIDTTX  (opt) Text describing date.
"RTN","BIREP",79,0)
 ;     6 - BIAL    (opt) Add additional linefeeds after paramter
"RTN","BIREP",80,0)
 ;                       display. (Default is 1.)
"RTN","BIREP",81,0)
 ;     7 - BINDNT  (opt) Left indent (default=4).
"RTN","BIREP",82,0)
 ;     8 - BITAB2  (opt) Second tab postion where ":" occurs (default=36).
"RTN","BIREP",83,0)
 ;     9 - BISL    (opt) If BISL=1 return slash dates.
"RTN","BIREP",84,0)
 ;
"RTN","BIREP",85,0)
 I '$D(BILINE)!('$D(BINOD))!('$D(BIMENU)) D  Q
"RTN","BIREP",86,0)
 .D ERRCD^BIUTL2(669,,1)
"RTN","BIREP",87,0)
 ;
"RTN","BIREP",88,0)
 S:'$G(BINDNT) BINDNT=4 S:'$G(BITAB2) BITAB2=36
"RTN","BIREP",89,0)
 N X D WL^BIW(.BILINE,BINOD)
"RTN","BIREP",90,0)
 S X="" F I=1:1:BINDNT S X=X_" "
"RTN","BIREP",91,0)
 S X=X_$S(BIMENU>9:"",1:" ")_BIMENU_" - "_$G(BIDTTX)
"RTN","BIREP",92,0)
 S X=$$PAD^BIUTL5(X,BITAB2,".")_": "
"RTN","BIREP",93,0)
 S:$G(BIDT) X=X_$S($G(BISL):$$SLDT1^BIUTL5(BIDT),1:$$TXDT1^BIUTL5(BIDT))
"RTN","BIREP",94,0)
 D WL^BIW(.BILINE,BINOD,X,$S($D(BIAL):+BIAL,1:1))
"RTN","BIREP",95,0)
 Q
"RTN","BIREP",96,0)
 ;
"RTN","BIREP",97,0)
 ;
"RTN","BIREP",98,0)
 ;----------
"RTN","BIREP",99,0)
DATERNG(BILINE,BINOD,BIMENU,BIBEGDT,BIENDDT,BIAL,BIONELN,BISL) ;EP
"RTN","BIREP",100,0)
 ;---> Display Report Parameter Date Range.
"RTN","BIREP",101,0)
 ;---> Parameters:
"RTN","BIREP",102,0)
 ;     1 - BILINE  (ret) Last line# written.
"RTN","BIREP",103,0)
 ;     2 - BINOD   (req) Node in ^TMP to store lines under.
"RTN","BIREP",104,0)
 ;     3 - BIMENU  (req) The Menu Number of this parameter.
"RTN","BIREP",105,0)
 ;     4 - BIBEGDT (opt) Begin date of report.
"RTN","BIREP",106,0)
 ;     5 - BIENDDT (opt) End date of report.
"RTN","BIREP",107,0)
 ;     6 - BIAL    (opt) Add additional linefeeds after paramter
"RTN","BIREP",108,0)
 ;                       display. (Default is 1.)
"RTN","BIREP",109,0)
 ;     7 - BIONELN (opt) Write beginning and end date on one line.
"RTN","BIREP",110,0)
 ;     8 - BISL    (opt) If BISL=1 return slash dates.
"RTN","BIREP",111,0)
 ;
"RTN","BIREP",112,0)
 I '$D(BILINE)!('$D(BINOD))!('$D(BIMENU)) D  Q
"RTN","BIREP",113,0)
 .D ERRCD^BIUTL2(669,,1)
"RTN","BIREP",114,0)
 ;
"RTN","BIREP",115,0)
 D WL^BIW(.BILINE,BINOD,,1)
"RTN","BIREP",116,0)
 S:'$G(BIBEGDT) BIBEGDT="" S:'$G(BIENDDT) BIENDDT=""
"RTN","BIREP",117,0)
 N X S X="    "_$S(BIMENU>9:"",1:" ")_BIMENU_" - Date Range............."
"RTN","BIREP",118,0)
 ;
"RTN","BIREP",119,0)
 ;---> If not "one line" display, split Date Range into two lines.
"RTN","BIREP",120,0)
 D
"RTN","BIREP",121,0)
 .I '$G(BIONELN) D  Q
"RTN","BIREP",122,0)
 ..S X=X_"from: "_$S($G(BISL):$$SLDT1^BIUTL5(BIBEGDT),1:$$TXDT1^BIUTL5(BIBEGDT))
"RTN","BIREP",123,0)
 ..D WL^BIW(.BILINE,BINOD,X)
"RTN","BIREP",124,0)
 ..S X="                                  to: "
"RTN","BIREP",125,0)
 .S X=X_"....: "_$S($G(BISL):$$SLDT1^BIUTL5(BIBEGDT),1:$$TXDT1^BIUTL5(BIBEGDT))
"RTN","BIREP",126,0)
 .S X=X_" - "
"RTN","BIREP",127,0)
 S X=X_$S($G(BISL):$$SLDT1^BIUTL5(BIENDDT),1:$$TXDT1^BIUTL5(BIENDDT))
"RTN","BIREP",128,0)
 D WL^BIW(.BILINE,BINOD,X,$S($D(BIAL):+BIAL,1:1))
"RTN","BIREP",129,0)
 Q
"RTN","BIREP",130,0)
 ;
"RTN","BIREP",131,0)
 ;
"RTN","BIREP",132,0)
 ;----------
"RTN","BIREP",133,0)
VTYPE(BILINE,BINOD,BIAR,BIMENU,BIAL) ;EP
"RTN","BIREP",134,0)
 ;---> Display Report Parameter Visit Type.
"RTN","BIREP",135,0)
 ;---> Parameters:
"RTN","BIREP",136,0)
 ;     1 - BILINE  (ret) Last line# written.
"RTN","BIREP",137,0)
 ;     2 - BINOD   (req) Node in ^TMP to store lines under.
"RTN","BIREP",138,0)
 ;     3 - BIAR    (opt) Local array of pieces of Visit Type (set of codes).
"RTN","BIREP",139,0)
 ;     4 - BIMENU  (req) The Menu Number of this parameter.
"RTN","BIREP",140,0)
 ;     5 - BIAL    (opt) Add additional linefeeds after paramter
"RTN","BIREP",141,0)
 ;                       display. (Default is 1.)
"RTN","BIREP",142,0)
 ;
"RTN","BIREP",143,0)
 I '$D(BILINE)!('$D(BINOD)!('$D(BIMENU))) D  Q
"RTN","BIREP",144,0)
 .D ERRCD^BIUTL2(669,,1)
"RTN","BIREP",145,0)
 ;
"RTN","BIREP",146,0)
 N BIAR1,BIITEM,BIITEMS,X S BIAR1="",BIITEM="Visit Type"
"RTN","BIREP",147,0)
 ;---> Get plural form of item name.
"RTN","BIREP",148,0)
 D PLURAL^BISELECT(BIITEM,.BIITEMS)
"RTN","BIREP",149,0)
 D
"RTN","BIREP",150,0)
 .S:'$D(BIAR) BIAR("ALL")=""
"RTN","BIREP",151,0)
 .I $D(BIAR("ALL")) S BIAR1="ALL" Q
"RTN","BIREP",152,0)
 .N I,M,N,P
"RTN","BIREP",153,0)
 .S (N,P)=0
"RTN","BIREP",154,0)
 .F I=0:1 S N=$O(BIAR(N)) Q:N=""  S M=N,P=P+1
"RTN","BIREP",155,0)
 .I I=1 D  Q
"RTN","BIREP",156,0)
 ..N BISET S BISET=$P(^DD(9000010,.03,0),U,3)
"RTN","BIREP",157,0)
 ..S BIAR1=$P($P(BISET,M_":",2),";") Q
"RTN","BIREP",158,0)
 .S BIAR1=P_" "_$S(I=1:BIITEM,1:BIITEMS)_" selected."
"RTN","BIREP",159,0)
 ;
"RTN","BIREP",160,0)
 S X="    "_$S(BIMENU>9:"",1:" ")_BIMENU_" - "_BIITEM
"RTN","BIREP",161,0)
 S X=$$PAD^BIUTL5(X,36,".")_": "_BIAR1
"RTN","BIREP",162,0)
 D WL^BIW(.BILINE,BINOD,X,$S($D(BIAL):+BIAL,1:1))
"RTN","BIREP",163,0)
 Q
"RTN","BIREP",164,0)
 ;
"RTN","BIREP",165,0)
 ;
"RTN","BIREP",166,0)
EXAMPLES ;EP
"RTN","BIREP",167,0)
 ;---> Include Historical.
"RTN","BIREP",168,0)
 N BIHIST1 S BIHIST1=""
"RTN","BIREP",169,0)
 S:'$D(BIHIST) BIHIST=1
"RTN","BIREP",170,0)
 S BIHIST1=$S(BIHIST:"YES",1:"NO")
"RTN","BIREP",171,0)
 S X="     7 - Include Historical..: "_BIHIST1
"RTN","BIREP",172,0)
 D WRITE(.BILINE,X)
"RTN","BIREP",173,0)
 K X
"RTN","BIREP",174,0)
 ;
"RTN","BIREP",175,0)
 ;
"RTN","BIREP",176,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREP",177,0)
 S VALMCNT=BILINE
"RTN","BIREP",178,0)
 S BIRTN="BIREPA"
"RTN","BIREP",179,0)
 Q
"RTN","BIREP",180,0)
 ;
"RTN","BIREP",181,0)
 ;
"RTN","BIREP",182,0)
 ;----------
"RTN","BIREP",183,0)
PPFILTR(BIDFN,BIHCF,BIQDT,BIUP) ;EP
"RTN","BIREP",184,0)
 ;---> Patient Population Filter.
"RTN","BIREP",185,0)
 ;---> Return 1 if Patient should be included; otherwise return 0.
"RTN","BIREP",186,0)
 ;---> Parameters:
"RTN","BIREP",187,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIREP",188,0)
 ;     2 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREP",189,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREP",190,0)
 ;     4 - BIUP   (req) User Population/Group (All, Imm, User, Active).
"RTN","BIREP",191,0)
 ;
"RTN","BIREP",192,0)
 ;---> Example:
"RTN","BIREP",193,0)
 ;---> Filter for standard Patient Population parameter.
"RTN","BIREP",194,0)
 ;Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIQDT,BIUP)
"RTN","BIREP",195,0)
 ;
"RTN","BIREP",196,0)
 ;
"RTN","BIREP",197,0)
 Q:'$G(BIDFN) 0
"RTN","BIREP",198,0)
 Q:'$G(BIQDT) 0
"RTN","BIREP",199,0)
 Q:'$D(BIHCF) 0
"RTN","BIREP",200,0)
 Q:'$D(BIUP) 0
"RTN","BIREP",201,0)
 ;
"RTN","BIREP",202,0)
 ;I BIDFN=4 X ^O
"RTN","BIREP",203,0)
 ;---> If patient died before the Quarter Ending Date, return 0.
"RTN","BIREP",204,0)
 N X S X=$$DECEASED^BIUTL1(BIDFN,1) I X Q:X<BIQDT 0
"RTN","BIREP",205,0)
 ;
"RTN","BIREP",206,0)
 ;---> If patient does not have an Active HRCN at one or more
"RTN","BIREP",207,0)
 ;---> of the Health Care Facilities selected (BIUP="r"), return 0.
"RTN","BIREP",208,0)
 Q:$$HRCN^BIEXPRT2(BIDFN,.BIHCF) 0
"RTN","BIREP",209,0)
 ;
"RTN","BIREP",210,0)
 ;---> If Patient Pop filter is for patients Active in the Imm Register,
"RTN","BIREP",211,0)
 ;---> and patient became Inactive before the Quarter Ending Date, return 0.
"RTN","BIREP",212,0)
 ;---> (Return 0 for patients whose "Inactive Date"="Not in Register.")
"RTN","BIREP",213,0)
 I BIUP="i" N X S X=$$INACT^BIUTL1(BIDFN) I X]"" Q:X<BIQDT 0
"RTN","BIREP",214,0)
 ;
"RTN","BIREP",215,0)
 ;---> Quit if patient is not in selected User Population Group.
"RTN","BIREP",216,0)
 ;---> Comment out next 2 lines for TESTING PURPOSES - MWRZZZ.
"RTN","BIREP",217,0)
 I BIUP="u" Q $$USERPOP^BIUTL6(BIDFN,BIQDT)
"RTN","BIREP",218,0)
 I BIUP="a" Q $$ACTCLIN^BIUTL6(BIDFN,BIQDT)
"RTN","BIREP",219,0)
 ;
"RTN","BIREP",220,0)
 ;---> No reason to exclude patient.
"RTN","BIREP",221,0)
 Q 1
"RTN","BIREP",222,0)
 ;
"RTN","BIREP",223,0)
 ;
"RTN","BIREP",224,0)
 ;----------
"RTN","BIREP",225,0)
WRITE(BILINE,BINOD,BIVAL,BIBLNK) ;EP
"RTN","BIREP",226,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREP",227,0)
 ;---> Parameters:
"RTN","BIREP",228,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREP",229,0)
 ;     2 - BINOD  (req) Node in ^TMP to store lines under.
"RTN","BIREP",230,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREP",231,0)
 ;
"RTN","BIREP",232,0)
 Q:'$D(BILINE)  Q:'$D(BINOD)
"RTN","BIREP",233,0)
 D WL^BIW(.BILINE,BINOD,$G(BIVAL),$G(BIBLNK))
"RTN","BIREP",234,0)
 Q
"RTN","BIREPA")
0^86^B58558255
"RTN","BIREPA",1,0)
BIREPA ;IHS/CMI/MWR - REPORT, VAC ACCOUNTABILITY; MAY 10, 2010
"RTN","BIREPA",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPA",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPA",4,0)
 ;;  VIEW VACCINE ACCOUNTABILITY REPORT.
"RTN","BIREPA",5,0)
 ;
"RTN","BIREPA",6,0)
 ;
"RTN","BIREPA",7,0)
 ;----------
"RTN","BIREPA",8,0)
START ;EP
"RTN","BIREPA",9,0)
 ;---> Listman Screen for viewing Vaccine Accountability Report.
"RTN","BIREPA",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPA",11,0)
 ;
"RTN","BIREPA",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPA",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPA",14,0)
 ;
"RTN","BIREPA",15,0)
 D EN
"RTN","BIREPA",16,0)
 D EXIT
"RTN","BIREPA",17,0)
 Q
"RTN","BIREPA",18,0)
 ;
"RTN","BIREPA",19,0)
 ;
"RTN","BIREPA",20,0)
 ;----------
"RTN","BIREPA",21,0)
EN ;EP
"RTN","BIREPA",22,0)
 ;---> Main entry point for BI REPORT VAC ACCOUNTABILITY.
"RTN","BIREPA",23,0)
 D EN^VALM("BI REPORT ACCOUNTABILITY")
"RTN","BIREPA",24,0)
 Q
"RTN","BIREPA",25,0)
 ;
"RTN","BIREPA",26,0)
 ;
"RTN","BIREPA",27,0)
 ;----------
"RTN","BIREPA",28,0)
INIT ;EP
"RTN","BIREPA",29,0)
 ;---> Initialize variables and list array.
"RTN","BIREPA",30,0)
 K ^TMP("BIREPA",$J)
"RTN","BIREPA",31,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPA",32,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPA",33,0)
 N BILINE,X S BILINE=0
"RTN","BIREPA",34,0)
 D WRITE(.BILINE)
"RTN","BIREPA",35,0)
 S X=IOUON_"VACCINE ACCOUNTABILITY REPORT"
"RTN","BIREPA",36,0)
 D CENTERT^BIUTL5(.X,42)
"RTN","BIREPA",37,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPA",38,0)
 K X
"RTN","BIREPA",39,0)
 ;
"RTN","BIREPA",40,0)
 ;---> Date Range.
"RTN","BIREPA",41,0)
 S:'$G(BIBEGDT) BIBEGDT=(DT-10000)
"RTN","BIREPA",42,0)
 S:'$G(BIENDDT) BIENDDT=DT
"RTN","BIREPA",43,0)
 ;D DATERNG^BIREP(.BILINE,"BIREPA",1,BIBEGDT,BIENDDT)
"RTN","BIREPA",44,0)
 D DATERNG^BIREP(.BILINE,"BIREPA",1,BIBEGDT,BIENDDT,1,1,1)
"RTN","BIREPA",45,0)
 ;
"RTN","BIREPA",46,0)
 ;---> Current Community.
"RTN","BIREPA",47,0)
 D DISP^BIREP(.BILINE,"BIREPA",.BICC,"Community",2,1,0)
"RTN","BIREPA",48,0)
 ;
"RTN","BIREPA",49,0)
 ;---> Health Care Facility.
"RTN","BIREPA",50,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPA",51,0)
 D DISP^BIREP(.BILINE,"BIREPA",.BIHCF,A,3,2,0,,,B)
"RTN","BIREPA",52,0)
 ;
"RTN","BIREPA",53,0)
 ;---> Case Manager.
"RTN","BIREPA",54,0)
 D DISP^BIREP(.BILINE,"BIREPA",.BICM,"Case Manager",4,3)
"RTN","BIREPA",55,0)
 ;
"RTN","BIREPA",56,0)
 ;---> Beneficiary Type.
"RTN","BIREPA",57,0)
 D DISP^BIREP(.BILINE,"BIREPA",.BIBEN,"Beneficiary Type",5,4,0)
"RTN","BIREPA",58,0)
 ;
"RTN","BIREPA",59,0)
 ;---> Visit Type.
"RTN","BIREPA",60,0)
 D VTYPE^BIREP(.BILINE,"BIREPA",.BIVT,6)
"RTN","BIREPA",61,0)
 ;
"RTN","BIREPA",62,0)
 ;---> Include Historical.
"RTN","BIREPA",63,0)
 N BIHIST1 S BIHIST1=""
"RTN","BIREPA",64,0)
 S:'$D(BIHIST) BIHIST=1
"RTN","BIREPA",65,0)
 S BIHIST1=$S(BIHIST:"YES",1:"NO")
"RTN","BIREPA",66,0)
 S X="     7 - Include Historical.........: "_BIHIST1
"RTN","BIREPA",67,0)
 D WRITE(.BILINE,X)
"RTN","BIREPA",68,0)
 K X
"RTN","BIREPA",69,0)
 ;
"RTN","BIREPA",70,0)
 ;---> Display by Lot Number.
"RTN","BIREPA",71,0)
 N BIDLOT1 S BIDLOT1=""
"RTN","BIREPA",72,0)
 S:'$D(BIDLOT) BIDLOT=0
"RTN","BIREPA",73,0)
 S BIDLOT1=$S(BIDLOT:"YES",1:"NO")
"RTN","BIREPA",74,0)
 S X="     8 - Display by Lot Number......: "_BIDLOT1
"RTN","BIREPA",75,0)
 D WRITE(.BILINE,X)
"RTN","BIREPA",76,0)
 K X
"RTN","BIREPA",77,0)
 ;
"RTN","BIREPA",78,0)
 ;
"RTN","BIREPA",79,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPA",80,0)
 S VALMCNT=BILINE
"RTN","BIREPA",81,0)
 S BIRTN="BIREPA"
"RTN","BIREPA",82,0)
 Q
"RTN","BIREPA",83,0)
 ;
"RTN","BIREPA",84,0)
 ;
"RTN","BIREPA",85,0)
 ;----------
"RTN","BIREPA",86,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPA",87,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPA",88,0)
 ;---> Parameters:
"RTN","BIREPA",89,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPA",90,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPA",91,0)
 ;
"RTN","BIREPA",92,0)
 Q:'$D(BILINE)
"RTN","BIREPA",93,0)
 D WL^BIW(.BILINE,"BIREPA",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPA",94,0)
 Q
"RTN","BIREPA",95,0)
 ;
"RTN","BIREPA",96,0)
 ;
"RTN","BIREPA",97,0)
 ;----------
"RTN","BIREPA",98,0)
RESET ;EP
"RTN","BIREPA",99,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPA",100,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPA",101,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPA",102,0)
 ;
"RTN","BIREPA",103,0)
 ;---> NOT USED.  Could be used to correct margins.
"RTN","BIREPA",104,0)
 ;K VALMHDR S VALM("BM")=15,VALM("LINES")=14,VALM("TM")=2
"RTN","BIREPA",105,0)
 D INIT
"RTN","BIREPA",106,0)
 Q
"RTN","BIREPA",107,0)
 ;
"RTN","BIREPA",108,0)
 ;
"RTN","BIREPA",109,0)
 ;----------
"RTN","BIREPA",110,0)
HELP ;EP
"RTN","BIREPA",111,0)
 ;---> Help code.
"RTN","BIREPA",112,0)
 N BIX S BIX=X
"RTN","BIREPA",113,0)
 D FULL^VALM1
"RTN","BIREPA",114,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPA",115,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPA",116,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPA",117,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPA",118,0)
 Q
"RTN","BIREPA",119,0)
 ;
"RTN","BIREPA",120,0)
 ;
"RTN","BIREPA",121,0)
 ;----------
"RTN","BIREPA",122,0)
HELP1 ;EP
"RTN","BIREPA",123,0)
 ;----> Explanation of this report.
"RTN","BIREPA",124,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPA",125,0)
 D START^BIHELP("VACCINE ACCOUNTABILITY REPORT - HELP",.BITEXT)
"RTN","BIREPA",126,0)
 Q
"RTN","BIREPA",127,0)
 ;
"RTN","BIREPA",128,0)
 ;
"RTN","BIREPA",129,0)
 ;----------
"RTN","BIREPA",130,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPA",131,0)
 ;;The Vaccine Accountability Report provides "doses administered"
"RTN","BIREPA",132,0)
 ;;by vaccine series (e.g.DTaP) and by age group.  This report can be
"RTN","BIREPA",133,0)
 ;;printed for any time period, for a given facility, visit type, or
"RTN","BIREPA",134,0)
 ;;community(s).
"RTN","BIREPA",135,0)
 ;;
"RTN","BIREPA",136,0)
 ;;There are 8 items or "parameters" on the screen that you may
"RTN","BIREPA",137,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPA",138,0)
 ;;To change an item, enter its left column number (1-8) at the
"RTN","BIREPA",139,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPA",140,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPA",141,0)
 ;;changing.
"RTN","BIREPA",142,0)
 ;;
"RTN","BIREPA",143,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPA",144,0)
 ;;you want, select V to View the Vaccine Acct Report or P to print it.
"RTN","BIREPA",145,0)
 ;;
"RTN","BIREPA",146,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPA",147,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPA",148,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPA",149,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPA",150,0)
 ;;
"RTN","BIREPA",151,0)
 ;;DATE RANGE: Only immunizations given within the Date Range you
"RTN","BIREPA",152,0)
 ;;select will be included in the report.
"RTN","BIREPA",153,0)
 ;;
"RTN","BIREPA",154,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPA",155,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPA",156,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPA",157,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPA",158,0)
 ;;
"RTN","BIREPA",159,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIREPA",160,0)
 ;;Facilities, only immunizations given at the selected Health Care
"RTN","BIREPA",161,0)
 ;;Facilities will be included in the report.
"RTN","BIREPA",162,0)
 ;;
"RTN","BIREPA",163,0)
 ;;CASE MANAGERS: If you select for specific Case Managers, only
"RTN","BIREPA",164,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPA",165,0)
 ;;in the report.
"RTN","BIREPA",166,0)
 ;;
"RTN","BIREPA",167,0)
 ;;BENEFICIARY TYPES: If you select for specific Beneficiary Types,
"RTN","BIREPA",168,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPA",169,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPA",170,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPA",171,0)
 ;;
"RTN","BIREPA",172,0)
 ;;VISIT TYPES: If you select for specific Visit Types, only visits
"RTN","BIREPA",173,0)
 ;;that are classifed with one of the Visit Types you select will
"RTN","BIREPA",174,0)
 ;;included in the report.
"RTN","BIREPA",175,0)
 ;;
"RTN","BIREPA",176,0)
 ;;INCLUDE HISTORICAL: If this parameter is set to "YES", then Visits
"RTN","BIREPA",177,0)
 ;;with a Category of "Historical" will be counted in the Vaccine
"RTN","BIREPA",178,0)
 ;;Accountability Report.  (Category is displayed and edited on the
"RTN","BIREPA",179,0)
 ;;ADD/EDIT IMMUNIZATION VISIT Screen.)  If set to "NO", they will
"RTN","BIREPA",180,0)
 ;;not be counted in the report.
"RTN","BIREPA",181,0)
 ;;
"RTN","BIREPA",182,0)
 ;;DISPLAY BY LOT NUMBERS: The report lists the statistics by age for
"RTN","BIREPA",183,0)
 ;;each vaccine.  However, you may elect to display the statistics for
"RTN","BIREPA",184,0)
 ;;each separate lot number under each vaccine.  The totals for all
"RTN","BIREPA",185,0)
 ;;lot numbers of each vaccine will also be displayed.
"RTN","BIREPA",186,0)
 ;;
"RTN","BIREPA",187,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPA",188,0)
 Q
"RTN","BIREPA",189,0)
 ;
"RTN","BIREPA",190,0)
 ;
"RTN","BIREPA",191,0)
 ;----------
"RTN","BIREPA",192,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPA",193,0)
 Q:$G(BILINL)=""
"RTN","BIREPA",194,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPA",195,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPA",196,0)
 Q
"RTN","BIREPA",197,0)
 ;
"RTN","BIREPA",198,0)
 ;
"RTN","BIREPA",199,0)
 ;----------
"RTN","BIREPA",200,0)
EXIT ;EP
"RTN","BIREPA",201,0)
 ;---> End of job cleanup.
"RTN","BIREPA",202,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPA",203,0)
 K ^TMP("BIREPA",$J)
"RTN","BIREPA",204,0)
 D CLEAR^VALM1
"RTN","BIREPA",205,0)
 Q
"RTN","BIREPA1")
0^87^B11908055
"RTN","BIREPA1",1,0)
BIREPA1 ;IHS/CMI/MWR - REPORT, VAC ACCOUNTABILITY; MAY 10, 2010
"RTN","BIREPA1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPA1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPA1",4,0)
 ;;  VIEW OR PRINT VACCINE ACCOUNTABILITY REPORT.
"RTN","BIREPA1",5,0)
 ;
"RTN","BIREPA1",6,0)
 ;
"RTN","BIREPA1",7,0)
 ;----------
"RTN","BIREPA1",8,0)
START(BIX) ;EP
"RTN","BIREPA1",9,0)
 ;---> Prepare and display or print Vaccine Accountability Report.
"RTN","BIREPA1",10,0)
 ;---> Parameters:
"RTN","BIREPA1",11,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Report.
"RTN","BIREPA1",12,0)
 ;                      If BIX="VIEW", then view Report (default).
"RTN","BIREPA1",13,0)
 ;                      If BIX="LOTS", then view Report by individual lot numbers.
"RTN","BIREPA1",14,0)
 ;---> Variables:
"RTN","BIREPA1",15,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPA1",16,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPA1",17,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPA1",18,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPA1",19,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPA1",20,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPA1",21,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPA1",22,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPA1",23,0)
 ;     9 - BIPOP   (ret) BIPOP=1 if error.
"RTN","BIREPA1",24,0)
 ;
"RTN","BIREPA1",25,0)
 ;---> Check for required Variables.
"RTN","BIREPA1",26,0)
 I '$G(BIBEGDT) D ERROR(626) D RESET^BIREPA Q
"RTN","BIREPA1",27,0)
 I '$G(BIENDDT) D ERROR(627) D RESET^BIREPA Q
"RTN","BIREPA1",28,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPA Q
"RTN","BIREPA1",29,0)
 I '$D(BIHCF) D ERROR(625) D RESET^BIREPA Q
"RTN","BIREPA1",30,0)
 I '$D(BICM) D ERROR(615) D RESET^BIREPA Q
"RTN","BIREPA1",31,0)
 I '$D(BIBEN) D ERROR(662) D RESET^BIREPA Q
"RTN","BIREPA1",32,0)
 I '$D(BIHIST) D ERROR(663) D RESET^BIREPA Q
"RTN","BIREPA1",33,0)
 I '$D(BIVT) D ERROR(664) D RESET^BIREPA Q
"RTN","BIREPA1",34,0)
 I '$D(BIDLOT) S BIDLOT=0
"RTN","BIREPA1",35,0)
 ;
"RTN","BIREPA1",36,0)
 D SETVARS^BIUTL5
"RTN","BIREPA1",37,0)
 N VALMCNT
"RTN","BIREPA1",38,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPA Q
"RTN","BIREPA1",39,0)
 D EN
"RTN","BIREPA1",40,0)
 Q
"RTN","BIREPA1",41,0)
 ;
"RTN","BIREPA1",42,0)
 ;
"RTN","BIREPA1",43,0)
 ;----------
"RTN","BIREPA1",44,0)
PRINT ;EP
"RTN","BIREPA1",45,0)
 ;---> Main entry point for printing the Quarterly Immunization Report.
"RTN","BIREPA1",46,0)
 D DEVICE(.BIPOP)
"RTN","BIREPA1",47,0)
 Q:$G(BIPOP)
"RTN","BIREPA1",48,0)
 ;
"RTN","BIREPA1",49,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPA1",50,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPA1",51,0)
 ;
"RTN","BIREPA1",52,0)
 ;---> Prepare report.
"RTN","BIREPA1",53,0)
 K VALMHDR,^TMP("BIREPA1",$J)
"RTN","BIREPA1",54,0)
 N VALM,VALMHDR
"RTN","BIREPA1",55,0)
 D HDR
"RTN","BIREPA1",56,0)
 D GET^BIREPA2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIDLOT)
"RTN","BIREPA1",57,0)
 ;
"RTN","BIREPA1",58,0)
 D PRTLST^BIUTL8("BIREPA1")
"RTN","BIREPA1",59,0)
 D EXIT,RESET^BIREPA
"RTN","BIREPA1",60,0)
 Q
"RTN","BIREPA1",61,0)
 ;
"RTN","BIREPA1",62,0)
 ;
"RTN","BIREPA1",63,0)
 ;----------
"RTN","BIREPA1",64,0)
EN ;EP
"RTN","BIREPA1",65,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIREPA1",66,0)
 D EN^VALM("BI REPORT ACCOUNTABILITY1")
"RTN","BIREPA1",67,0)
 Q
"RTN","BIREPA1",68,0)
 ;
"RTN","BIREPA1",69,0)
 ;
"RTN","BIREPA1",70,0)
 ;----------
"RTN","BIREPA1",71,0)
HDR ;EP
"RTN","BIREPA1",72,0)
 ;---> Header code
"RTN","BIREPA1",73,0)
 D HEAD^BIREPA2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPA1",74,0)
 Q
"RTN","BIREPA1",75,0)
 ;
"RTN","BIREPA1",76,0)
 ;
"RTN","BIREPA1",77,0)
 ;----------
"RTN","BIREPA1",78,0)
INIT ;EP
"RTN","BIREPA1",79,0)
 ;---> Initialize variables and list array.
"RTN","BIREPA1",80,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPA1",81,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPA1",82,0)
 D GET^BIREPA2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIDLOT)
"RTN","BIREPA1",83,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPA1",84,0)
 D ZSAVES^BIUTL3
"RTN","BIREPA1",85,0)
 Q
"RTN","BIREPA1",86,0)
 ;
"RTN","BIREPA1",87,0)
 ;
"RTN","BIREPA1",88,0)
 ;----------
"RTN","BIREPA1",89,0)
RESET ;EP
"RTN","BIREPA1",90,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPA1",91,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPA1",92,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPA1",93,0)
 D INIT,HDR Q
"RTN","BIREPA1",94,0)
 ;
"RTN","BIREPA1",95,0)
 ;
"RTN","BIREPA1",96,0)
 ;----------
"RTN","BIREPA1",97,0)
HELP ;EP
"RTN","BIREPA1",98,0)
 ;---> Help code.
"RTN","BIREPA1",99,0)
 N BIX S BIX=X
"RTN","BIREPA1",100,0)
 D FULL^VALM1
"RTN","BIREPA1",101,0)
 W !!?5,"Use arrow keys to scroll up and down through the report, or"
"RTN","BIREPA1",102,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIREPA1",103,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPA1",104,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPA1",105,0)
 Q
"RTN","BIREPA1",106,0)
 ;
"RTN","BIREPA1",107,0)
 ;
"RTN","BIREPA1",108,0)
 ;----------
"RTN","BIREPA1",109,0)
EXIT ;EP
"RTN","BIREPA1",110,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPA1",111,0)
 K ^TMP("BIREPA1",$J)
"RTN","BIREPA1",112,0)
 D CLEAR^VALM1
"RTN","BIREPA1",113,0)
 D FULL^VALM1
"RTN","BIREPA1",114,0)
 Q
"RTN","BIREPA1",115,0)
 ;
"RTN","BIREPA1",116,0)
 ;
"RTN","BIREPA1",117,0)
 ;----------
"RTN","BIREPA1",118,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPA1",119,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPA1",120,0)
 ;---> Parameters:
"RTN","BIREPA1",121,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPA1",122,0)
 ;
"RTN","BIREPA1",123,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPA1",124,0)
 S ZTRTN="DEQUEUE^BIREPA1"
"RTN","BIREPA1",125,0)
 D ZSAVES^BIUTL3
"RTN","BIREPA1",126,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPA1",127,0)
 Q
"RTN","BIREPA1",128,0)
 ;
"RTN","BIREPA1",129,0)
 ;
"RTN","BIREPA1",130,0)
 ;----------
"RTN","BIREPA1",131,0)
DEQUEUE ;EP
"RTN","BIREPA1",132,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIREPA1",133,0)
 K VALMHDR,^TMP("BIREPA1",$J)
"RTN","BIREPA1",134,0)
 D HDR
"RTN","BIREPA1",135,0)
 D GET^BIREPA2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIDLOT)
"RTN","BIREPA1",136,0)
 D PRTLST^BIUTL8("BIREPA1"),EXIT
"RTN","BIREPA1",137,0)
 Q
"RTN","BIREPA1",138,0)
 ;
"RTN","BIREPA1",139,0)
 ;
"RTN","BIREPA1",140,0)
 ;----------
"RTN","BIREPA1",141,0)
ERROR(BIERR) ;EP
"RTN","BIREPA1",142,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPA1",143,0)
 ;---> Parameters:
"RTN","BIREPA1",144,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPA1",145,0)
 ;
"RTN","BIREPA1",146,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPA1",147,0)
 Q
"RTN","BIREPA2")
0^88^B44086803
"RTN","BIREPA2",1,0)
BIREPA2 ;IHS/CMI/MWR - REPORT, VAC ACCOUNTABILITY; MAY 10, 2010
"RTN","BIREPA2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPA2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPA2",4,0)
 ;;  VIEW OR PRINT VACCINE ACCOUNTABILITY REPORT.
"RTN","BIREPA2",5,0)
 ;
"RTN","BIREPA2",6,0)
 ;----------
"RTN","BIREPA2",7,0)
HEAD(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT) ;EP
"RTN","BIREPA2",8,0)
 ;---> Produce Header array for Vaccine Accountability Report.
"RTN","BIREPA2",9,0)
 ;---> Parameters:
"RTN","BIREPA2",10,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPA2",11,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPA2",12,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPA2",13,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPA2",14,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPA2",15,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPA2",16,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPA2",17,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPA2",18,0)
 ;
"RTN","BIREPA2",19,0)
 ;---> Check for required Variables.
"RTN","BIREPA2",20,0)
 Q:'$G(BIBEGDT)
"RTN","BIREPA2",21,0)
 Q:'$G(BIENDDT)
"RTN","BIREPA2",22,0)
 Q:'$D(BICC)
"RTN","BIREPA2",23,0)
 Q:'$D(BIHCF)
"RTN","BIREPA2",24,0)
 Q:'$D(BICM)
"RTN","BIREPA2",25,0)
 Q:'$D(BIBEN)
"RTN","BIREPA2",26,0)
 Q:'$D(BIHIST)
"RTN","BIREPA2",27,0)
 Q:'$D(BIVT)
"RTN","BIREPA2",28,0)
 ;
"RTN","BIREPA2",29,0)
 K VALMHDR
"RTN","BIREPA2",30,0)
 N BILINE,X S BILINE=0
"RTN","BIREPA2",31,0)
 ;
"RTN","BIREPA2",32,0)
 N X S X=""
"RTN","BIREPA2",33,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPA2",34,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPA2",35,0)
 ;
"RTN","BIREPA2",36,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPA2",37,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPA2",38,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPA2",39,0)
 ;
"RTN","BIREPA2",40,0)
 S X="*  Vaccine Accountability Report  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPA2",41,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPA2",42,0)
 ;
"RTN","BIREPA2",43,0)
 ;S X=$$TXDT1^BIUTL5(DT) D CENTERT^BIUTL5(.X)
"RTN","BIREPA2",44,0)
 ;D WH^BIW(.BILINE,X,1)
"RTN","BIREPA2",45,0)
 ;
"RTN","BIREPA2",46,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPA2",47,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPA2",48,0)
 ;
"RTN","BIREPA2",49,0)
 S X=$$SP^BIUTL5(28)_"Date Range: "_$$SLDT1^BIUTL5(BIBEGDT)_" - "_$$SLDT1^BIUTL5(BIENDDT)
"RTN","BIREPA2",50,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPA2",51,0)
 ;
"RTN","BIREPA2",52,0)
 ;
"RTN","BIREPA2",53,0)
 S X=" (Historical "_$S(BIHIST:"In",1:"Ex")_"cluded)"
"RTN","BIREPA2",54,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPA2",55,0)
 S X=$$SP^BIUTL5(79,"-")
"RTN","BIREPA2",56,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPA2",57,0)
 ;
"RTN","BIREPA2",58,0)
 D
"RTN","BIREPA2",59,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPA2",60,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPA2",61,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPA2",62,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPA2",63,0)
 .;
"RTN","BIREPA2",64,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPA2",65,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPA2",66,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPA2",67,0)
 .;
"RTN","BIREPA2",68,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPA2",69,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPA2",70,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPA2",71,0)
 .;
"RTN","BIREPA2",72,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPA2",73,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPA2",74,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPA2",75,0)
 .;
"RTN","BIREPA2",76,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPA2",77,0)
 .D SUBH^BIOUTPT5("BIVT","Visit Type",,"9000010-.03",.BILINE,.BIERR,,12)
"RTN","BIREPA2",78,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPA2",79,0)
 .;
"RTN","BIREPA2",80,0)
 .S X="   <1    -1-   -2-   3-5   -6-  7-10 11-12 13-18 19-24 25-44 45-64   "
"RTN","BIREPA2",81,0)
 .S X=X_"65+  TOTAL"
"RTN","BIREPA2",82,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPA2",83,0)
 .;
"RTN","BIREPA2",84,0)
 .S X=$$SUML()
"RTN","BIREPA2",85,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPA2",86,0)
 ;
"RTN","BIREPA2",87,0)
 ;
"RTN","BIREPA2",88,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPA2",89,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPA2",90,0)
 D:$D(VALM("BM"))
"RTN","BIREPA2",91,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPA2",92,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPA2",93,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPA2",94,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPA2",95,0)
 Q
"RTN","BIREPA2",96,0)
 ;
"RTN","BIREPA2",97,0)
 ;
"RTN","BIREPA2",98,0)
 ;----------
"RTN","BIREPA2",99,0)
GET(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT,BIDLOT) ;EP
"RTN","BIREPA2",100,0)
 ;----------
"RTN","BIREPA2",101,0)
 ;---> Produce array for Vaccine Accountability Report.
"RTN","BIREPA2",102,0)
 ;---> Parameters:
"RTN","BIREPA2",103,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPA2",104,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPA2",105,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPA2",106,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPA2",107,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPA2",108,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPA2",109,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPA2",110,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPA2",111,0)
 ;     9 - BIDLOT  (req) If BIDLOT=1, display by Lot Numbers.
"RTN","BIREPA2",112,0)
 ;
"RTN","BIREPA2",113,0)
 K ^TMP("BIREPA1",$J)
"RTN","BIREPA2",114,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPA2",115,0)
 ;
"RTN","BIREPA2",116,0)
 ;---> Check for required Variables.
"RTN","BIREPA2",117,0)
 I '$G(BIBEGDT) D ERRCD^BIUTL2(626,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",118,0)
 I '$G(BIENDDT) D ERRCD^BIUTL2(627,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",119,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",120,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",121,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",122,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",123,0)
 I '$D(BIHIST) D ERRCD^BIUTL2(663,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",124,0)
 I '$D(BIVT) D ERRCD^BIUTL2(664,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",125,0)
 I '$D(BIDLOT) D ERRCD^BIUTL2(681,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPA2",126,0)
 ;
"RTN","BIREPA2",127,0)
 ;---> Gather data.
"RTN","BIREPA2",128,0)
 D GETIMMS^BIREPA3(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPA2",129,0)
 ;
"RTN","BIREPA2",130,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPA2",131,0)
 ;---> BIG=Vaccine Group, BIV=Vaccine Name, BIA=Age.
"RTN","BIREPA2",132,0)
 N BILINE S BILINE=0
"RTN","BIREPA2",133,0)
 N BIG S BIG=0
"RTN","BIREPA2",134,0)
 F  S BIG=$O(BITMP("STATS",BIG)) Q:'BIG  D
"RTN","BIREPA2",135,0)
 .N BIV S BIV=0
"RTN","BIREPA2",136,0)
 .F  S BIV=$O(BITMP("STATS",BIG,BIV)) Q:BIV=""  D
"RTN","BIREPA2",137,0)
 ..;
"RTN","BIREPA2",138,0)
 ..N BILSAV,X
"RTN","BIREPA2",139,0)
 ..;
"RTN","BIREPA2",140,0)
 ..;---> Write Vaccine Name line.
"RTN","BIREPA2",141,0)
 ..S X=BIV
"RTN","BIREPA2",142,0)
 ..I $G(BIDLOT) S X=X_" - All Lots"
"RTN","BIREPA2",143,0)
 ..D CENTERT^BIUTL5(.X)
"RTN","BIREPA2",144,0)
 ..;---> Save this line# for marking as a single record to print.
"RTN","BIREPA2",145,0)
 ..D WRITE(.BILINE,X) S BILSAV=BILINE
"RTN","BIREPA2",146,0)
 ..;
"RTN","BIREPA2",147,0)
 ..;---> Build Age Totals line for this vaccine.
"RTN","BIREPA2",148,0)
 ..S X=$$SUML() D WRITE(.BILINE,X)
"RTN","BIREPA2",149,0)
 ..S X="" N BIA
"RTN","BIREPA2",150,0)
 ..F BIA=1:1:12 S X=X_$J($G(BITMP("STATS",BIG,BIV,"ALL",BIA)),6)
"RTN","BIREPA2",151,0)
 ..;---> Now concat Total column (for this vaccine row).
"RTN","BIREPA2",152,0)
 ..S X=X_$J($G(BITMP("STATS",BIG,BIV,"ALL","TOTAL")),7)
"RTN","BIREPA2",153,0)
 ..D WRITE(.BILINE,X)
"RTN","BIREPA2",154,0)
 ..D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPA2",155,0)
 ..;---> Now mark the top line of this vaccine to print as one record.
"RTN","BIREPA2",156,0)
 ..D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPA1")
"RTN","BIREPA2",157,0)
 ..;
"RTN","BIREPA2",158,0)
 ..Q:'$G(BIDLOT)
"RTN","BIREPA2",159,0)
 ..;---> Display rows by individual Lot Number.
"RTN","BIREPA2",160,0)
 ..N BIL S BIL=0
"RTN","BIREPA2",161,0)
 ..F  S BIL=$O(BITMP("STATS",BIG,BIV,BIL)) Q:BIL=""  D
"RTN","BIREPA2",162,0)
 ...Q:(BIL="ALL")
"RTN","BIREPA2",163,0)
 ...;---> Write Vaccine Name with Lot Number concatenated.
"RTN","BIREPA2",164,0)
 ...S X=BIV_" - "_BIL D CENTERT^BIUTL5(.X)
"RTN","BIREPA2",165,0)
 ...D WRITE(.BILINE,X) S BILSAV=BILINE
"RTN","BIREPA2",166,0)
 ...S X=$$SUML() D WRITE(.BILINE,X)
"RTN","BIREPA2",167,0)
 ...S X="" N BIA
"RTN","BIREPA2",168,0)
 ...F BIA=1:1:12 S X=X_$J($G(BITMP("STATS",BIG,BIV,BIL,BIA)),6)
"RTN","BIREPA2",169,0)
 ...S X=X_$J($G(BITMP("STATS",BIG,BIV,BIL,"TOTAL")),7)
"RTN","BIREPA2",170,0)
 ...D WRITE(.BILINE,X)
"RTN","BIREPA2",171,0)
 ...D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPA2",172,0)
 ...D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPA1")
"RTN","BIREPA2",173,0)
 ...;
"RTN","BIREPA2",174,0)
 ...;---> Now mark the top line of this vaccine to print as one record.
"RTN","BIREPA2",175,0)
 ...D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPA1")
"RTN","BIREPA2",176,0)
 ;
"RTN","BIREPA2",177,0)
 ;---> Now write total in .
"RTN","BIREPA2",178,0)
 S X=" TOTAL IMMUNIZATIONS (for all vaccines in this report)"
"RTN","BIREPA2",179,0)
 S X=X_$$SP^BIUTL5(16)_$J(+$G(BITMP("STATS","ALL","TOTAL")),9)
"RTN","BIREPA2",180,0)
 D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPA2",181,0)
 ;
"RTN","BIREPA2",182,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPA2",183,0)
 ;---> Not desired on this report, per Ros 10-12-05
"RTN","BIREPA2",184,0)
 ;N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPA2",185,0)
 ;S X=" Total Patients included who had Refusals on record"_$J(N,28)
"RTN","BIREPA2",186,0)
 ;D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPA2",187,0)
 ;
"RTN","BIREPA2",188,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPA2",189,0)
 S VALMCNT=BILINE
"RTN","BIREPA2",190,0)
 Q
"RTN","BIREPA2",191,0)
 ;
"RTN","BIREPA2",192,0)
 ;
"RTN","BIREPA2",193,0)
 ;----------
"RTN","BIREPA2",194,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPA2",195,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPA2",196,0)
 ;---> Parameters:
"RTN","BIREPA2",197,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPA2",198,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPA2",199,0)
 ;
"RTN","BIREPA2",200,0)
 Q:'$D(BILINE)
"RTN","BIREPA2",201,0)
 D WL^BIW(.BILINE,"BIREPA1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPA2",202,0)
 ;
"RTN","BIREPA2",203,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPA2",204,0)
 S VALMCNT=BILINE
"RTN","BIREPA2",205,0)
 Q
"RTN","BIREPA2",206,0)
 ;
"RTN","BIREPA2",207,0)
 ;
"RTN","BIREPA2",208,0)
 ;----------
"RTN","BIREPA2",209,0)
SUML() ;EP
"RTN","BIREPA2",210,0)
 ;---> Produce Header array for Vaccine Accountability Report.
"RTN","BIREPA2",211,0)
 ;---> Parameters:
"RTN","BIREPA2",212,0)
 ;     1 - Y (opt) If Y=1 write line for subtotals instead of header.
"RTN","BIREPA2",213,0)
 N X
"RTN","BIREPA2",214,0)
 ;S X=$S($G(Y):" ----",1:" ----")_"| ----  ---  ---  ---  ---  ----"
"RTN","BIREPA2",215,0)
 ;Q X_" ----- ----- ----- ----- ----- ----- -----"
"RTN","BIREPA2",216,0)
 S X="  ----  ----  ----  ----  ----  ---- ----- ----- ----- ----- "
"RTN","BIREPA2",217,0)
 Q X_"----- -----  -----"
"RTN","BIREPA3")
0^89^B17152680
"RTN","BIREPA3",1,0)
BIREPA3 ;IHS/CMI/MWR - REPORT, VAC ACCOUNTABILITY; MAY 10, 2010
"RTN","BIREPA3",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPA3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPA3",4,0)
 ;;  VIEW OR PRINT VACCINE ACCOUNTABILITY REPORT.
"RTN","BIREPA3",5,0)
 ;;  PATCH 3: Add Source (MVX) to display of Lot Numbers.  CHKSET+29
"RTN","BIREPA3",6,0)
 ;
"RTN","BIREPA3",7,0)
 ;
"RTN","BIREPA3",8,0)
 ;----------
"RTN","BIREPA3",9,0)
GETIMMS(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT) ;EP
"RTN","BIREPA3",10,0)
 ;---> Get Immunizations from V Files.
"RTN","BIREPA3",11,0)
 ;---> Parameters:
"RTN","BIREPA3",12,0)
 ;     1 - BIBEGDT (req) Begin Visit Date.
"RTN","BIREPA3",13,0)
 ;     2 - BIENDDT (req) End Visit Date.
"RTN","BIREPA3",14,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPA3",15,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPA3",16,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPA3",17,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPA3",18,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPA3",19,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPA3",20,0)
 ;
"RTN","BIREPA3",21,0)
 ;---> Set begin and end dates for search through V Immunization File.
"RTN","BIREPA3",22,0)
 ;
"RTN","BIREPA3",23,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)
"RTN","BIREPA3",24,0)
 N N S N=BIBEGDT-.9999
"RTN","BIREPA3",25,0)
 F  S N=$O(^AUPNVIMM("ADT",N)) Q:(N>(BIENDDT+.9999)!('N))  D
"RTN","BIREPA3",26,0)
 .N M S M=0
"RTN","BIREPA3",27,0)
 .F  S M=$O(^AUPNVIMM("ADT",N,M)) Q:'M  D
"RTN","BIREPA3",28,0)
 ..N P S P=0
"RTN","BIREPA3",29,0)
 ..F  S P=$O(^AUPNVIMM("ADT",N,M,P)) Q:'P  D
"RTN","BIREPA3",30,0)
 ...D CHKSET(N,M,P,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPA3",31,0)
 Q
"RTN","BIREPA3",32,0)
 ;
"RTN","BIREPA3",33,0)
 ;
"RTN","BIREPA3",34,0)
 ;----------
"RTN","BIREPA3",35,0)
CHKSET(BIDATE,BIVIEN,BIIIEN,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT) ;EP
"RTN","BIREPA3",36,0)
 ;---> Check if this visit fits criteria; if so, set it
"RTN","BIREPA3",37,0)
 ;---> in ^TMP("BIREPA1".
"RTN","BIREPA3",38,0)
 ;---> Parameters:
"RTN","BIREPA3",39,0)
 ;     1 - BIDATE (req) Date of Visit.
"RTN","BIREPA3",40,0)
 ;     2 - BIVIEN (req) VISIT IEN.
"RTN","BIREPA3",41,0)
 ;     3 - BIIIEN (req) V IMMUNIZAITON IEN.
"RTN","BIREPA3",42,0)
 ;     4 - BICC   (req) Current Community array.
"RTN","BIREPA3",43,0)
 ;     5 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPA3",44,0)
 ;     6 - BICM   (req) Case Manager array.
"RTN","BIREPA3",45,0)
 ;     7 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPA3",46,0)
 ;     8 - BIHIST (req) Include Historical (1=yes,0=no).
"RTN","BIREPA3",47,0)
 ;     9 - BIVT   (req) Visit Type array.
"RTN","BIREPA3",48,0)
 ;
"RTN","BIREPA3",49,0)
 Q:'$G(BIDATE)
"RTN","BIREPA3",50,0)
 Q:'$G(BIVIEN)
"RTN","BIREPA3",51,0)
 Q:'$G(BIIIEN)
"RTN","BIREPA3",52,0)
 Q:'$D(^AUPNVSIT(BIVIEN,0))
"RTN","BIREPA3",53,0)
 Q:'$D(^AUPNVIMM(BIIIEN,0))
"RTN","BIREPA3",54,0)
 Q:'$D(BICC)
"RTN","BIREPA3",55,0)
 Q:'$D(BIHCF)
"RTN","BIREPA3",56,0)
 Q:'$D(BICM)
"RTN","BIREPA3",57,0)
 Q:'$D(BIBEN)
"RTN","BIREPA3",58,0)
 Q:'$D(BIVT)
"RTN","BIREPA3",59,0)
 ;
"RTN","BIREPA3",60,0)
 N BIAGRP,BIDFN,BIIMM,BILOT,BIVGRP,BIVNAM,BIDOSE,Y
"RTN","BIREPA3",61,0)
 S Y=^AUPNVIMM(BIIIEN,0)
"RTN","BIREPA3",62,0)
 S BIDFN=$P(Y,U,2),BIIMM=$P(Y,U),BILOT=$P(Y,U,5)
"RTN","BIREPA3",63,0)
 ;
"RTN","BIREPA3",64,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPA3",65,0)
 ;---> Add Source (.13 field) to display of Lot Numbers.
"RTN","BIREPA3",66,0)
 ;I BILOT S BILOT=$P($G(^AUTTIML(BILOT,0)),U)
"RTN","BIREPA3",67,0)
 I BILOT D
"RTN","BIREPA3",68,0)
 .N BISRC D
"RTN","BIREPA3",69,0)
 ..N Y S Y=$P($G(^AUTTIML(BILOT,0)),U,13)
"RTN","BIREPA3",70,0)
 ..I Y="" S BISRC="No Source" Q
"RTN","BIREPA3",71,0)
 ..I '$D(^DD(9999999.41,.13,0)) S BISRC="^DD missing" Q
"RTN","BIREPA3",72,0)
 ..S BISRC=$P($P(^DD(9999999.41,.13,0),Y_":",2),";")
"RTN","BIREPA3",73,0)
 .;
"RTN","BIREPA3",74,0)
 .S BILOT=$P($G(^AUTTIML(BILOT,0)),U)
"RTN","BIREPA3",75,0)
 .I BILOT="" S BILOT="Bad pointer" Q
"RTN","BIREPA3",76,0)
 .;---> Append Source.
"RTN","BIREPA3",77,0)
 .S BILOT=BILOT_" ("_BISRC_")"
"RTN","BIREPA3",78,0)
 ;**********
"RTN","BIREPA3",79,0)
 ;
"RTN","BIREPA3",80,0)
 S:BILOT="" BILOT="No Lot Number"
"RTN","BIREPA3",81,0)
 ;
"RTN","BIREPA3",82,0)
 ;---> Quit if this Vaccine should not be included in this report.
"RTN","BIREPA3",83,0)
 ;---> As of v8.4, include all vaccines given during the selected time.
"RTN","BIREPA3",84,0)
 ;Q:'$P($G(^AUTTIMM(BIIMM,0)),U,17)   ;vvv8.4
"RTN","BIREPA3",85,0)
 ;
"RTN","BIREPA3",86,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPA3",87,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPA3",88,0)
 ;
"RTN","BIREPA3",89,0)
 ;---> Quit if Health Care Facility doesn't match.
"RTN","BIREPA3",90,0)
 N BIVDATA S BIVDATA=^AUPNVSIT(BIVIEN,0)
"RTN","BIREPA3",91,0)
 Q:$$HCF(BIVDATA,.BIHCF)
"RTN","BIREPA3",92,0)
 ;---> Quit if Visit Type doesn't match.
"RTN","BIREPA3",93,0)
 Q:$$VT(BIVDATA,.BIVT)
"RTN","BIREPA3",94,0)
 ;
"RTN","BIREPA3",95,0)
 ;---> Quit if not including Historical Visits and this Visit has
"RTN","BIREPA3",96,0)
 ;---> a Category of "Historical".
"RTN","BIREPA3",97,0)
 I '$G(BIHIST) Q:$$HIST(BIVDATA)
"RTN","BIREPA3",98,0)
 ;
"RTN","BIREPA3",99,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPA3",100,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPA3",101,0)
 ;
"RTN","BIREPA3",102,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPA3",103,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPA3",104,0)
 ;
"RTN","BIREPA3",105,0)
 S BIVNAM=$$VNAME^BIUTL2(BIIMM)
"RTN","BIREPA3",106,0)
 ;S:BIDOSE<1 BIDOSE=1 S:BIDOSE>4 BIDOSE=4
"RTN","BIREPA3",107,0)
 S BIAGRP=$$AGEGRP(BIDFN,BIDATE)
"RTN","BIREPA3",108,0)
 S BIVGRP=$$IMMVG^BIUTL2(BIIMM,4)
"RTN","BIREPA3",109,0)
 ;
"RTN","BIREPA3",110,0)
 N Z
"RTN","BIREPA3",111,0)
 ;---> Now store in stats arrays.
"RTN","BIREPA3",112,0)
 ;
"RTN","BIREPA3",113,0)
 ;---> Add for this Vaccine, Lot, Age.
"RTN","BIREPA3",114,0)
 S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,BILOT,BIAGRP))
"RTN","BIREPA3",115,0)
 S BITMP("STATS",BIVGRP,BIVNAM,BILOT,BIAGRP)=Z+1
"RTN","BIREPA3",116,0)
 ;
"RTN","BIREPA3",117,0)
 ;---> Add for this Vaccine, Lot, Total.
"RTN","BIREPA3",118,0)
 S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,BILOT,"TOTAL"))
"RTN","BIREPA3",119,0)
 S BITMP("STATS",BIVGRP,BIVNAM,BILOT,"TOTAL")=Z+1
"RTN","BIREPA3",120,0)
 ;
"RTN","BIREPA3",121,0)
 ;---> Add for this Vaccine, ALL Lots, Age.
"RTN","BIREPA3",122,0)
 S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,"ALL",BIAGRP))
"RTN","BIREPA3",123,0)
 S BITMP("STATS",BIVGRP,BIVNAM,"ALL",BIAGRP)=Z+1
"RTN","BIREPA3",124,0)
 ;
"RTN","BIREPA3",125,0)
 ;---> Add for this Vaccine, Total.
"RTN","BIREPA3",126,0)
 S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,"ALL","TOTAL"))
"RTN","BIREPA3",127,0)
 S BITMP("STATS",BIVGRP,BIVNAM,"ALL","TOTAL")=Z+1
"RTN","BIREPA3",128,0)
 ;
"RTN","BIREPA3",129,0)
 ;---> Add for ALL Vaccines, Total.
"RTN","BIREPA3",130,0)
 S Z=$G(BITMP("STATS","ALL","TOTAL"))
"RTN","BIREPA3",131,0)
 S BITMP("STATS","ALL","TOTAL")=Z+1 K Z
"RTN","BIREPA3",132,0)
 ;
"RTN","BIREPA3",133,0)
 ;---> Add refusals, if any.
"RTN","BIREPA3",134,0)
 ;---> Not desired on this report, per Ros 10-12-05
"RTN","BIREPA3",135,0)
 ;D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) S BITMP("REFUSALS",BIDFN)=""
"RTN","BIREPA3",136,0)
 ;
"RTN","BIREPA3",137,0)
 Q
"RTN","BIREPA3",138,0)
 ;
"RTN","BIREPA3",139,0)
 ;
"RTN","BIREPA3",140,0)
 ;
"RTN","BIREPA3",141,0)
 ;----------
"RTN","BIREPA3",142,0)
AGEGRP(BIDFN,BIDATE) ;EP
"RTN","BIREPA3",143,0)
 ;---> Return Patient's Age Group.
"RTN","BIREPA3",144,0)
 ;---> Parameters:
"RTN","BIREPA3",145,0)
 ;     1 - BIDFN  (req) IEN in PATIENT File.
"RTN","BIREPA3",146,0)
 ;     2 - BIDATE (req) Date of Visit.
"RTN","BIREPA3",147,0)
 ;
"RTN","BIREPA3",148,0)
 N X S X=$$AGE^BIUTL1(BIDFN,1,BIDATE)
"RTN","BIREPA3",149,0)
 Q:X<1 1
"RTN","BIREPA3",150,0)
 Q:X=1 2
"RTN","BIREPA3",151,0)
 Q:X=2 3
"RTN","BIREPA3",152,0)
 Q:X<6 4
"RTN","BIREPA3",153,0)
 Q:X=6 5
"RTN","BIREPA3",154,0)
 Q:X<11 6
"RTN","BIREPA3",155,0)
 Q:X<13 7
"RTN","BIREPA3",156,0)
 Q:X<19 8
"RTN","BIREPA3",157,0)
 Q:X<25 9
"RTN","BIREPA3",158,0)
 Q:X<45 10
"RTN","BIREPA3",159,0)
 Q:X<65 11
"RTN","BIREPA3",160,0)
 Q 12
"RTN","BIREPA3",161,0)
 ;
"RTN","BIREPA3",162,0)
 ;
"RTN","BIREPA3",163,0)
 ;----------
"RTN","BIREPA3",164,0)
HCF(BIVDATA,BIHCF) ;EP
"RTN","BIREPA3",165,0)
 ;---> Return Health Care Facility indicator.
"RTN","BIREPA3",166,0)
 ;---> Return 1 if not selecting all Health Care Facilities (Locations)
"RTN","BIREPA3",167,0)
 ;---> and if the Health Care Facility of this visit is not one of the
"RTN","BIREPA3",168,0)
 ;---> ones selected.
"RTN","BIREPA3",169,0)
 ;---> Parameters:
"RTN","BIREPA3",170,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPA3",171,0)
 ;     2 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPA3",172,0)
 ;
"RTN","BIREPA3",173,0)
 Q:$D(BIHCF("ALL")) 0
"RTN","BIREPA3",174,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPA3",175,0)
 N BILOC S BILOC=$P(BIVDATA,U,6)
"RTN","BIREPA3",176,0)
 Q:'BILOC 1
"RTN","BIREPA3",177,0)
 Q:'$D(BIHCF(BILOC)) 1
"RTN","BIREPA3",178,0)
 Q 0
"RTN","BIREPA3",179,0)
 ;
"RTN","BIREPA3",180,0)
 ;
"RTN","BIREPA3",181,0)
 ;----------
"RTN","BIREPA3",182,0)
VT(BIVDATA,BIVT) ;EP
"RTN","BIREPA3",183,0)
 ;---> Return Visit Type indicator.
"RTN","BIREPA3",184,0)
 ;---> Return 1 if not selecting all Visit Types and if this Visit Type
"RTN","BIREPA3",185,0)
 ;---> is not one of the ones selected.
"RTN","BIREPA3",186,0)
 ;---> Parameters:
"RTN","BIREPA3",187,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPA3",188,0)
 ;     2 - BIVT    (req) Health Care Facility array.
"RTN","BIREPA3",189,0)
 ;
"RTN","BIREPA3",190,0)
 Q:$D(BIVT("ALL")) 0
"RTN","BIREPA3",191,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPA3",192,0)
 N BIVTYPE S BIVTYPE=$P(BIVDATA,U,3)
"RTN","BIREPA3",193,0)
 Q:BIVTYPE="" 1
"RTN","BIREPA3",194,0)
 Q:'$D(BIVT(BIVTYPE)) 1
"RTN","BIREPA3",195,0)
 Q 0
"RTN","BIREPA3",196,0)
 ;
"RTN","BIREPA3",197,0)
 ;
"RTN","BIREPA3",198,0)
 ;----------
"RTN","BIREPA3",199,0)
HIST(BIVDATA) ;EP
"RTN","BIREPA3",200,0)
 ;---> Return Historical Visit indicator.
"RTN","BIREPA3",201,0)
 ;---> Return 1 if this Visit has a Category of "Historical".
"RTN","BIREPA3",202,0)
 ;---> Parameters:
"RTN","BIREPA3",203,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPA3",204,0)
 ;
"RTN","BIREPA3",205,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPA3",206,0)
 Q:$P(BIVDATA,U,7)="E" 1
"RTN","BIREPA3",207,0)
 Q 0
"RTN","BIREPD")
0^90^B71142514
"RTN","BIREPD",1,0)
BIREPD ;IHS/CMI/MWR - REPORT, ADOLESCENT RATES; MAY 10, 2010
"RTN","BIREPD",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPD",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPD",4,0)
 ;;  VIEW ADOLESCENT IMMUNIZATION RATES REPORT.
"RTN","BIREPD",5,0)
 ;
"RTN","BIREPD",6,0)
 ;
"RTN","BIREPD",7,0)
 ;----------
"RTN","BIREPD",8,0)
START ;EP
"RTN","BIREPD",9,0)
 ;---> Listman Screen for Adolescent Immunization Rates.
"RTN","BIREPD",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPD",11,0)
 ;
"RTN","BIREPD",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPD",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPD",14,0)
 ;
"RTN","BIREPD",15,0)
 D EN
"RTN","BIREPD",16,0)
 D EXIT
"RTN","BIREPD",17,0)
 Q
"RTN","BIREPD",18,0)
 ;
"RTN","BIREPD",19,0)
 ;
"RTN","BIREPD",20,0)
 ;----------
"RTN","BIREPD",21,0)
EN ;EP
"RTN","BIREPD",22,0)
 ;---> Main entry point for BI REPORT ADOLESCENT RATES.
"RTN","BIREPD",23,0)
 D EN^VALM("BI REPORT ADOLESCENT RATES")
"RTN","BIREPD",24,0)
 Q
"RTN","BIREPD",25,0)
 ;
"RTN","BIREPD",26,0)
 ;
"RTN","BIREPD",27,0)
 ;----------
"RTN","BIREPD",28,0)
INIT ;EP
"RTN","BIREPD",29,0)
 ;---> Initialize variables and list array.
"RTN","BIREPD",30,0)
 K ^TMP("BIREPD",$J)
"RTN","BIREPD",31,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPD",32,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPD",33,0)
 N BILINE,X S BILINE=0
"RTN","BIREPD",34,0)
 D WRITE(.BILINE)
"RTN","BIREPD",35,0)
 S X=IOUON_"ADOLESCENT IMMUNIZATION RATES REPORT"
"RTN","BIREPD",36,0)
 D CENTERT^BIUTL5(.X,42)
"RTN","BIREPD",37,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPD",38,0)
 K X
"RTN","BIREPD",39,0)
 ;
"RTN","BIREPD",40,0)
 ;---> Date.
"RTN","BIREPD",41,0)
 D WRITE(.BILINE)
"RTN","BIREPD",42,0)
 S:'$G(BIQDT) BIQDT=$G(DT)
"RTN","BIREPD",43,0)
 D DATE^BIREP(.BILINE,"BIREPD",1,$G(BIQDT),"Quarter Ending Date",,,,1)
"RTN","BIREPD",44,0)
 ;
"RTN","BIREPD",45,0)
 ;---> Current Community.
"RTN","BIREPD",46,0)
 D DISP^BIREP(.BILINE,"BIREPD",.BICC,"Community",2,1)
"RTN","BIREPD",47,0)
 ;
"RTN","BIREPD",48,0)
 ;---> Health Care Facility.
"RTN","BIREPD",49,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPD",50,0)
 D DISP^BIREP(.BILINE,"BIREPD",.BIHCF,A,3,2,,,,B) K A,B
"RTN","BIREPD",51,0)
 ;
"RTN","BIREPD",52,0)
 ;---> Case Manager.
"RTN","BIREPD",53,0)
 D DISP^BIREP(.BILINE,"BIREPD",.BICM,"Case Manager",4,3)
"RTN","BIREPD",54,0)
 ;
"RTN","BIREPD",55,0)
 ;---> Beneficiary Type.
"RTN","BIREPD",56,0)
 S:$O(BIBEN(0))="" BIBEN(1)=""
"RTN","BIREPD",57,0)
 D DISP^BIREP(.BILINE,"BIREPD",.BIBEN,"Beneficiary Type",5,4)
"RTN","BIREPD",58,0)
 ;
"RTN","BIREPD",59,0)
 ;---> User Population.
"RTN","BIREPD",60,0)
 D:($G(BIUP)="")
"RTN","BIREPD",61,0)
 .I $$GPRAIEN^BIUTL6 S BIUP="a" Q
"RTN","BIREPD",62,0)
 .S BIUP="u"
"RTN","BIREPD",63,0)
 ;
"RTN","BIREPD",64,0)
 S X="     6 - Patient Population Group...: "
"RTN","BIREPD",65,0)
 D
"RTN","BIREPD",66,0)
 .I BIUP="r" S X=X_"Registered Patients (All)" Q
"RTN","BIREPD",67,0)
 .I BIUP="i" S X=X_"Immunization Register Patients (Active)" Q
"RTN","BIREPD",68,0)
 .I BIUP="u" S X=X_"User Population (1 visit, 3 yrs)" Q
"RTN","BIREPD",69,0)
 .I BIUP="a" S X=X_"Active Users (2+ visits, 3 yrs)" Q
"RTN","BIREPD",70,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPD",71,0)
 K X
"RTN","BIREPD",72,0)
 ;
"RTN","BIREPD",73,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPD",74,0)
 S VALMCNT=BILINE
"RTN","BIREPD",75,0)
 S BIRTN="BIREPD"
"RTN","BIREPD",76,0)
 Q
"RTN","BIREPD",77,0)
 ;
"RTN","BIREPD",78,0)
 ;
"RTN","BIREPD",79,0)
 ;----------
"RTN","BIREPD",80,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPD",81,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPD",82,0)
 ;---> Parameters:
"RTN","BIREPD",83,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPD",84,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPD",85,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPD",86,0)
 ;
"RTN","BIREPD",87,0)
 Q:'$D(BILINE)
"RTN","BIREPD",88,0)
 D WL^BIW(.BILINE,"BIREPD",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPD",89,0)
 Q
"RTN","BIREPD",90,0)
 ;
"RTN","BIREPD",91,0)
 ;
"RTN","BIREPD",92,0)
 ;----------
"RTN","BIREPD",93,0)
RESET ;EP
"RTN","BIREPD",94,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPD",95,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPD",96,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPD",97,0)
 D INIT Q
"RTN","BIREPD",98,0)
 ;
"RTN","BIREPD",99,0)
 ;
"RTN","BIREPD",100,0)
 ;----------
"RTN","BIREPD",101,0)
HELP ;EP
"RTN","BIREPD",102,0)
 ;---> Help code.
"RTN","BIREPD",103,0)
 N BIX S BIX=X
"RTN","BIREPD",104,0)
 D FULL^VALM1
"RTN","BIREPD",105,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPD",106,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPD",107,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPD",108,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPD",109,0)
 Q
"RTN","BIREPD",110,0)
 ;
"RTN","BIREPD",111,0)
 ;
"RTN","BIREPD",112,0)
 ;----------
"RTN","BIREPD",113,0)
HELP1 ;EP
"RTN","BIREPD",114,0)
 ;----> Explanation of this report.
"RTN","BIREPD",115,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPD",116,0)
 D START^BIHELP("ADOLESCENT IMM RATES - HELP",.BITEXT)
"RTN","BIREPD",117,0)
 Q
"RTN","BIREPD",118,0)
 ;
"RTN","BIREPD",119,0)
 ;
"RTN","BIREPD",120,0)
 ;----------
"RTN","BIREPD",121,0)
TEXT1(BITEXT) ;EP  vvv83
"RTN","BIREPD",122,0)
 ;;
"RTN","BIREPD",123,0)
 ;;Adolescent Report
"RTN","BIREPD",124,0)
 ;;
"RTN","BIREPD",125,0)
 ;;The Adolescent report follows the logic of the National
"RTN","BIREPD",126,0)
 ;;Immunization Survey to provide immunization coverage rates for
"RTN","BIREPD",127,0)
 ;;single vaccines and groups of vaccines in children  11-12 years,
"RTN","BIREPD",128,0)
 ;;13 years and 13-17 years of age by certain key ages  (i.e.
"RTN","BIREPD",129,0)
 ;;3 Hep B and 2 MMR and 1-Td/Tdap, 3-HepB, 2-MMR,1-Var) by the
"RTN","BIREPD",130,0)
 ;;the date of the report.  Current status is defined as 1-Tdap_Td
"RTN","BIREPD",131,0)
 ;;and 1-Mening.
"RTN","BIREPD",132,0)
 ;;
"RTN","BIREPD",133,0)
 ;;This report displays Active clinical users who are between 11
"RTN","BIREPD",134,0)
 ;;years 0 months and 17 years 11 months of age on the selected date
"RTN","BIREPD",135,0)
 ;;of the report.  (An Active clinical user is defined as a person
"RTN","BIREPD",136,0)
 ;;who has had at least two clinical visits in the past three years.)
"RTN","BIREPD",137,0)
 ;;
"RTN","BIREPD",138,0)
 ;;The key ages by which vaccines were received are listed across
"RTN","BIREPD",139,0)
 ;;the top of the report.  Total patients who received each dose
"RTN","BIREPD",140,0)
 ;;of the vaccines  for each age-group are listed in rows beside
"RTN","BIREPD",141,0)
 ;;each dose (e.g., the total patients (%) receiving 3-HepB by
"RTN","BIREPD",142,0)
 ;;11-12 years.  The date header on far left header signifies
"RTN","BIREPD",143,0)
 ;;"doses received by the report date" and includes all doses a
"RTN","BIREPD",144,0)
 ;;child received up to the "Quarter Ending Date" chosen.
"RTN","BIREPD",145,0)
 ;;All percentages represent a fraction of the total patients as
"RTN","BIREPD",146,0)
 ;;noted at the top and bottom of the report.
"RTN","BIREPD",147,0)
 ;;
"RTN","BIREPD",148,0)
 ;;The ADOLESCENT IMMUNIZATIONS RATES screen allows you to adjust
"RTN","BIREPD",149,0)
 ;;the report to your needs.
"RTN","BIREPD",150,0)
 ;;
"RTN","BIREPD",151,0)
 ;;There are 6 items or "parameters" on the screen that you may
"RTN","BIREPD",152,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPD",153,0)
 ;;To change an item, enter its left column number (1-6) at the
"RTN","BIREPD",154,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPD",155,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPD",156,0)
 ;;changing.
"RTN","BIREPD",157,0)
 ;;
"RTN","BIREPD",158,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPD",159,0)
 ;;you want, select V to View the Adolescent Report or P to print it.
"RTN","BIREPD",160,0)
 ;;
"RTN","BIREPD",161,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPD",162,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPD",163,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPD",164,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPD",165,0)
 ;;
"RTN","BIREPD",166,0)
 ;;QUARTER ENDING DATE: The report will compile immunization rates
"RTN","BIREPD",167,0)
 ;;as of the date entered.  Typically, this date would be the end
"RTN","BIREPD",168,0)
 ;;of a Quarter.
"RTN","BIREPD",169,0)
 ;;
"RTN","BIREPD",170,0)
 ;;COMMUNITY: If you select for specific Communities, only patients
"RTN","BIREPD",171,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPD",172,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPD",173,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPD",174,0)
 ;;
"RTN","BIREPD",175,0)
 ;;HEALTH CARE FACILITY: If you select for specific Health Care
"RTN","BIREPD",176,0)
 ;;Facilities, only Patients who have active Chart#'s at one or more
"RTN","BIREPD",177,0)
 ;;of the selected Facilities will be included in the report.
"RTN","BIREPD",178,0)
 ;;
"RTN","BIREPD",179,0)
 ;;CASE MANAGER: If you select for specific Case Managers, only
"RTN","BIREPD",180,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPD",181,0)
 ;;in the report.
"RTN","BIREPD",182,0)
 ;;
"RTN","BIREPD",183,0)
 ;;BENEFICIARY TYPE: If you select for specific Beneficiary Types,
"RTN","BIREPD",184,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPD",185,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPD",186,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPD",187,0)
 ;;
"RTN","BIREPD",188,0)
 ;;PATIENT POPULATION GROUP: You may select one of four patient groups
"RTN","BIREPD",189,0)
 ;;to be considered in the report: Registered Patients (All),
"RTN","BIREPD",190,0)
 ;;Immunization Register Patients (Active), User Population (1+ visits
"RTN","BIREPD",191,0)
 ;;in 3 yrs), or Active Clinical Users (2+ visits in 3 yrs).
"RTN","BIREPD",192,0)
 ;;Active Clinical Users is the default.
"RTN","BIREPD",193,0)
 ;;
"RTN","BIREPD",194,0)
 ;;
"RTN","BIREPD",195,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPD",196,0)
 Q
"RTN","BIREPD",197,0)
 ;
"RTN","BIREPD",198,0)
 ;
"RTN","BIREPD",199,0)
 ;----------
"RTN","BIREPD",200,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPD",201,0)
 Q:$G(BILINL)=""
"RTN","BIREPD",202,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPD",203,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPD",204,0)
 Q
"RTN","BIREPD",205,0)
 ;
"RTN","BIREPD",206,0)
 ;
"RTN","BIREPD",207,0)
 ;----------
"RTN","BIREPD",208,0)
EXIT ;EP
"RTN","BIREPD",209,0)
 ;---> EOJ cleanup.
"RTN","BIREPD",210,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPD",211,0)
 K ^TMP("BIREPD",$J)
"RTN","BIREPD",212,0)
 D CLEAR^VALM1
"RTN","BIREPD",213,0)
 D FULL^VALM1
"RTN","BIREPD",214,0)
 Q
"RTN","BIREPD1")
0^91^B25499917
"RTN","BIREPD1",1,0)
BIREPD1 ;IHS/CMI/MWR - REPORT, ADOLESCENT RATES; MAY 10, 2010
"RTN","BIREPD1",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIREPD1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPD1",4,0)
 ;;  VIEW OR PRINT ADOLESCENT IMMUNIZATION RATES REPORT.
"RTN","BIREPD1",5,0)
 ;;  PATCH 5: Return Patient Totals for queued reports.  PRINT+12, INIT+6, DEQUEUE+5
"RTN","BIREPD1",6,0)
 ;
"RTN","BIREPD1",7,0)
 ;
"RTN","BIREPD1",8,0)
 ;----------
"RTN","BIREPD1",9,0)
START(BIX) ;EP
"RTN","BIREPD1",10,0)
 ;---> Prepare and display or print Adolescent Rates Report.
"RTN","BIREPD1",11,0)
 ;---> Parameters:
"RTN","BIREPD1",12,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Report.
"RTN","BIREPD1",13,0)
 ;                      If BIX="VIEW", then view Report (default).
"RTN","BIREPD1",14,0)
 ;---> Variables:
"RTN","BIREPD1",15,0)
 ;     1 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPD1",16,0)
 ;     2 - BIDAR   (opt) Adolescent Report Age Range: 11-17.
"RTN","BIREPD1",17,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPD1",18,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPD1",19,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPD1",20,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPD1",21,0)
 ;     7 - BIUP    (req) User Population/Group
"RTN","BIREPD1",22,0)
 ;                       (Registered, Imm Reg Active, User 1+, Active 2+).
"RTN","BIREPD1",23,0)
 ;     8 - BIPOP   (ret) BIPOP=1 if error.
"RTN","BIREPD1",24,0)
 ;
"RTN","BIREPD1",25,0)
 ;---> Check for required Variables.
"RTN","BIREPD1",26,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(622,,1) D RESET^BIREPD Q
"RTN","BIREPD1",27,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,,1) D RESET^BIREPD Q
"RTN","BIREPD1",28,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,,1) D RESET^BIREPD Q
"RTN","BIREPD1",29,0)
 I '$D(BICM)  D ERRCD^BIUTL2(615,,1) D RESET^BIREPD Q
"RTN","BIREPD1",30,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,,1) D RESET^BIREPD Q
"RTN","BIREPD1",31,0)
 I '$G(BISITE) S BISITE=$G(DUZ(2))
"RTN","BIREPD1",32,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,,1) D RESET^BIREPD Q
"RTN","BIREPD1",33,0)
 ;
"RTN","BIREPD1",34,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPD1",35,0)
 S:'$G(BIDAR) BIDAR="11-17^1"
"RTN","BIREPD1",36,0)
 S BIAGRPS="1112,1313,1317"
"RTN","BIREPD1",37,0)
 ;
"RTN","BIREPD1",38,0)
 ;---> BITOTPTS=Total Patients, used by HDR code after EN.
"RTN","BIREPD1",39,0)
 N BITOTPTS,BITOTFPT,BITOTMPT
"RTN","BIREPD1",40,0)
 ;
"RTN","BIREPD1",41,0)
 D SETVARS^BIUTL5 N VALMCNT
"RTN","BIREPD1",42,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPD Q
"RTN","BIREPD1",43,0)
 ;
"RTN","BIREPD1",44,0)
 ;
"RTN","BIREPD1",45,0)
 ;---> Set BIAG for Age Range in header of report.
"RTN","BIREPD1",46,0)
 ;---> Set BIRPDT for Report Date ("Quarterly, etc.).
"RTN","BIREPD1",47,0)
 ;---> Set BIRTN in case user runs Patient List then needs to return
"RTN","BIREPD1",48,0)
 ;---> to INIT here.
"RTN","BIREPD1",49,0)
 ;---> Set BITITL for Report Name in Patient List, if called.
"RTN","BIREPD1",50,0)
 N BIRPDT,BIRTN,BITITL
"RTN","BIREPD1",51,0)
 S BIRPDT=BIQDT,BIRTN="BIREPD1",BITITL="ADOLESCENT"
"RTN","BIREPD1",52,0)
 D EN
"RTN","BIREPD1",53,0)
 Q
"RTN","BIREPD1",54,0)
 ;
"RTN","BIREPD1",55,0)
 ;
"RTN","BIREPD1",56,0)
 ;----------
"RTN","BIREPD1",57,0)
PRINT ;EP
"RTN","BIREPD1",58,0)
 ;---> Main entry point for printing the Adolescent Rates Report.
"RTN","BIREPD1",59,0)
 D DEVICE(.BIPOP)
"RTN","BIREPD1",60,0)
 Q:$G(BIPOP)
"RTN","BIREPD1",61,0)
 ;
"RTN","BIREPD1",62,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPD1",63,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPD1",64,0)
 ;
"RTN","BIREPD1",65,0)
 ;---> Prepare report.
"RTN","BIREPD1",66,0)
 K ^TMP("BIREPD1",$J),^TMP("BIDUL",$J)
"RTN","BIREPD1",67,0)
 N VALM,VALMHDR
"RTN","BIREPD1",68,0)
 ;
"RTN","BIREPD1",69,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPD1",70,0)
 ;---> Return Patient Totals for queued reports.
"RTN","BIREPD1",71,0)
 ;D START^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP),HDR
"RTN","BIREPD1",72,0)
 D START^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP,.BITOTPTS,.BITOTFPT,.BITOTMPT)
"RTN","BIREPD1",73,0)
 D HDR
"RTN","BIREPD1",74,0)
 ;**********
"RTN","BIREPD1",75,0)
 ;
"RTN","BIREPD1",76,0)
 D PRTLST^BIUTL8("BIREPD1")
"RTN","BIREPD1",77,0)
 D EXIT,RESET^BIREPD
"RTN","BIREPD1",78,0)
 Q
"RTN","BIREPD1",79,0)
 ;
"RTN","BIREPD1",80,0)
 ;
"RTN","BIREPD1",81,0)
 ;----------
"RTN","BIREPD1",82,0)
EN ;EP
"RTN","BIREPD1",83,0)
 ;---> Main entry point for List Template BI REPORT ADOLESCENT RATES1.
"RTN","BIREPD1",84,0)
 D EN^VALM("BI REPORT ADOLESCENT RATES1")
"RTN","BIREPD1",85,0)
 Q
"RTN","BIREPD1",86,0)
 ;
"RTN","BIREPD1",87,0)
 ;
"RTN","BIREPD1",88,0)
 ;----------
"RTN","BIREPD1",89,0)
HDR ;EP
"RTN","BIREPD1",90,0)
 ;---> Header code
"RTN","BIREPD1",91,0)
 D HEAD^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BIUP)
"RTN","BIREPD1",92,0)
 Q
"RTN","BIREPD1",93,0)
 ;
"RTN","BIREPD1",94,0)
 ;
"RTN","BIREPD1",95,0)
 ;----------
"RTN","BIREPD1",96,0)
INIT ;EP
"RTN","BIREPD1",97,0)
 ;---> Initialize variables and list array.
"RTN","BIREPD1",98,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPD1",99,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPD1",100,0)
 K ^TMP("BIREPD1",$J),^TMP("BIDUL",$J)
"RTN","BIREPD1",101,0)
 ;
"RTN","BIREPD1",102,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPD1",103,0)
 ;---> Return Patient Totals for queued reports.
"RTN","BIREPD1",104,0)
 ;D START^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP)
"RTN","BIREPD1",105,0)
 D START^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP,.BITOTPTS,.BITOTFPT,.BITOTMPT)
"RTN","BIREPD1",106,0)
 ;**********
"RTN","BIREPD1",107,0)
 ;
"RTN","BIREPD1",108,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPD1",109,0)
 D ZSAVES^BIUTL3
"RTN","BIREPD1",110,0)
 Q
"RTN","BIREPD1",111,0)
 ;
"RTN","BIREPD1",112,0)
 ;
"RTN","BIREPD1",113,0)
 ;----------
"RTN","BIREPD1",114,0)
RESET ;EP
"RTN","BIREPD1",115,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPD1",116,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPD1",117,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPD1",118,0)
 D INIT,HDR Q
"RTN","BIREPD1",119,0)
 ;
"RTN","BIREPD1",120,0)
 ;
"RTN","BIREPD1",121,0)
 ;----------
"RTN","BIREPD1",122,0)
HELP ;EP
"RTN","BIREPD1",123,0)
 N BIX S BIX=X
"RTN","BIREPD1",124,0)
 D FULL^VALM1 N BIPOP
"RTN","BIREPD1",125,0)
 D TITLE^BIUTL5("VIEW ADOLESCENT REPORT - HELP")
"RTN","BIREPD1",126,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIREPD1",127,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPD1",128,0)
 Q
"RTN","BIREPD1",129,0)
 ;
"RTN","BIREPD1",130,0)
 ;
"RTN","BIREPD1",131,0)
 ;----------
"RTN","BIREPD1",132,0)
TEXT1 ;EP
"RTN","BIREPD1",133,0)
 ;;You have chosen to View the Adolescent Report rather than Print it.
"RTN","BIREPD1",134,0)
 ;;(You may print the report from here as well by entering "PL".)
"RTN","BIREPD1",135,0)
 ;;
"RTN","BIREPD1",136,0)
 ;;Also, you may:
"RTN","BIREPD1",137,0)
 ;;
"RTN","BIREPD1",138,0)
 ;;Enter "N" to view the list of Patients who were NOT Current
"RTN","BIREPD1",139,0)
 ;;          or "NOT up-to-date" with their immunizations, according
"RTN","BIREPD1",140,0)
 ;;          to recommendeded guidelines for their age.
"RTN","BIREPD1",141,0)
 ;;
"RTN","BIREPD1",142,0)
 ;;Enter "C" to view the list of Patients who were CURRENT or
"RTN","BIREPD1",143,0)
 ;;          "up-to-date" with their immunizations, according to
"RTN","BIREPD1",144,0)
 ;;          recommendeded guidelines for their age.
"RTN","BIREPD1",145,0)
 ;;
"RTN","BIREPD1",146,0)
 ;;Enter "B" to view a list of both groups of patients combined.
"RTN","BIREPD1",147,0)
 ;;
"RTN","BIREPD1",148,0)
 ;;
"RTN","BIREPD1",149,0)
 D PRINTX("TEXT1")
"RTN","BIREPD1",150,0)
 Q
"RTN","BIREPD1",151,0)
 ;
"RTN","BIREPD1",152,0)
 ;
"RTN","BIREPD1",153,0)
 ;----------
"RTN","BIREPD1",154,0)
EXIT ;EP
"RTN","BIREPD1",155,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPD1",156,0)
 K ^TMP("BIREPD1",$J)
"RTN","BIREPD1",157,0)
 D CLEAR^VALM1
"RTN","BIREPD1",158,0)
 D FULL^VALM1
"RTN","BIREPD1",159,0)
 Q
"RTN","BIREPD1",160,0)
 ;
"RTN","BIREPD1",161,0)
 ;
"RTN","BIREPD1",162,0)
 ;----------
"RTN","BIREPD1",163,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPD1",164,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPD1",165,0)
 ;---> Parameters:
"RTN","BIREPD1",166,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPD1",167,0)
 ;
"RTN","BIREPD1",168,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPD1",169,0)
 S ZTRTN="DEQUEUE^BIREPD1"
"RTN","BIREPD1",170,0)
 D ZSAVES^BIUTL3
"RTN","BIREPD1",171,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPD1",172,0)
 Q
"RTN","BIREPD1",173,0)
 ;
"RTN","BIREPD1",174,0)
 ;
"RTN","BIREPD1",175,0)
 ;----------
"RTN","BIREPD1",176,0)
DEQUEUE ;EP
"RTN","BIREPD1",177,0)
 ;
"RTN","BIREPD1",178,0)
 ;---> Prepare and print Two-Year-Old Report.
"RTN","BIREPD1",179,0)
 K VALMHDR,^TMP("BIREPD1",$J)
"RTN","BIREPD1",180,0)
 ;
"RTN","BIREPD1",181,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPD1",182,0)
 ;---> Return Patient Totals for queued reports and headings.
"RTN","BIREPD1",183,0)
 ;D HDR^BIREPD1
"RTN","BIREPD1",184,0)
 ;D START^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP)
"RTN","BIREPD1",185,0)
 D START^BIREPD2(BIQDT,BIDAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP,.BITOTPTS,.BITOTFPT,.BITOTMPT)
"RTN","BIREPD1",186,0)
 D HDR^BIREPD1
"RTN","BIREPD1",187,0)
 ;**********
"RTN","BIREPD1",188,0)
 ;
"RTN","BIREPD1",189,0)
 D PRTLST^BIUTL8("BIREPD1"),EXIT
"RTN","BIREPD1",190,0)
 Q
"RTN","BIREPD1",191,0)
 ;
"RTN","BIREPD1",192,0)
 ;
"RTN","BIREPD1",193,0)
 ;----------
"RTN","BIREPD1",194,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPD1",195,0)
 Q:$G(BILINL)=""
"RTN","BIREPD1",196,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPD1",197,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPD1",198,0)
 Q
"RTN","BIREPD2")
0^92^B70038827
"RTN","BIREPD2",1,0)
BIREPD2 ;IHS/CMI/MWR - REPORT, ADOLESCENT RATES; DEC 15, 2011
"RTN","BIREPD2",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIREPD2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPD2",4,0)
 ;;  VIEW ADOLESCENT IMMUNIZATION RATES REPORT, GATHER DATA.
"RTN","BIREPD2",5,0)
 ;   PATCH 1: Clarify Report explanation.  START+121
"RTN","BIREPD2",6,0)
 ;;  PATCH 3: Include new "1-Td 1-Men 3-HPV" lines. START+69
"RTN","BIREPD2",7,0)
 ;;  PATCH 5: Return Patient Totals for queued reports.  START+0
"RTN","BIREPD2",8,0)
 ;
"RTN","BIREPD2",9,0)
 ;
"RTN","BIREPD2",10,0)
 ;----------
"RTN","BIREPD2",11,0)
HEAD(BIQDT,BIDAR,BIAGRPS,BICC,BIHCF,BICM,BIBEN,BIUP) ;EP - Header for Adolescent Report.
"RTN","BIREPD2",12,0)
 ;---> Produce Header array for Adolescent Report.
"RTN","BIREPD2",13,0)
 ;---> Parameters:
"RTN","BIREPD2",14,0)
 ;     1 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPD2",15,0)
 ;     2 - BIDAR   (req) Adolescent Report Age Range: "11-18^1" (years).
"RTN","BIREPD2",16,0)
 ;     3 - BIAGRPS (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD2",17,0)
 ;     4 - BICC    (req) Current Community array.
"RTN","BIREPD2",18,0)
 ;     5 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPD2",19,0)
 ;     6 - BICM    (req) Case Manager array.
"RTN","BIREPD2",20,0)
 ;     7 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPD2",21,0)
 ;     8 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPD2",22,0)
 ;
"RTN","BIREPD2",23,0)
 ;---> Check for required Variables.
"RTN","BIREPD2",24,0)
 Q:'$G(BIQDT)
"RTN","BIREPD2",25,0)
 Q:'$D(BICC)
"RTN","BIREPD2",26,0)
 Q:'$D(BIHCF)
"RTN","BIREPD2",27,0)
 Q:'$D(BICM)
"RTN","BIREPD2",28,0)
 Q:'$D(BIBEN)
"RTN","BIREPD2",29,0)
 Q:'$D(BIDAR)
"RTN","BIREPD2",30,0)
 Q:'$G(BIAGRPS)
"RTN","BIREPD2",31,0)
 Q:'$D(BIUP)
"RTN","BIREPD2",32,0)
 ;
"RTN","BIREPD2",33,0)
 K VALMHDR
"RTN","BIREPD2",34,0)
 N BILINE,X,Y S BILINE=0
"RTN","BIREPD2",35,0)
 ;
"RTN","BIREPD2",36,0)
 S X=""
"RTN","BIREPD2",37,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPD2",38,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPD2",39,0)
 ;
"RTN","BIREPD2",40,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPD2",41,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPD2",42,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPD2",43,0)
 ;
"RTN","BIREPD2",44,0)
 S X="*  Adolescent Immunization Report (11-17 yrs)  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPD2",45,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPD2",46,0)
 ;
"RTN","BIREPD2",47,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPD2",48,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPD2",49,0)
 ;
"RTN","BIREPD2",50,0)
 S X=$$SP^BIUTL5(30)_"End Date: "_$$SLDT1^BIUTL5(BIQDT)
"RTN","BIREPD2",51,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPD2",52,0)
 ;
"RTN","BIREPD2",53,0)
 S X=" "_$$BIUPTX^BIUTL6(BIUP)
"RTN","BIREPD2",54,0)
 I BIUP="i" S X=" "_$$BIUPTX^BIUTL6(BIUP,1)_" (Active)"
"RTN","BIREPD2",55,0)
 S X=$$PAD^BIUTL5(X,34)
"RTN","BIREPD2",56,0)
 ;
"RTN","BIREPD2",57,0)
 S Y="Total Patients: "_$G(BITOTPTS)_"  (F:"_$G(BITOTFPT)_"  M:"_$G(BITOTMPT)_")"
"RTN","BIREPD2",58,0)
 S X=X_$J(Y,45)
"RTN","BIREPD2",59,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPD2",60,0)
 S X=$$SP^BIUTL5(79,"-")
"RTN","BIREPD2",61,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPD2",62,0)
 ;
"RTN","BIREPD2",63,0)
 D
"RTN","BIREPD2",64,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPD2",65,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPD2",66,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPD2",67,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPD2",68,0)
 .;
"RTN","BIREPD2",69,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPD2",70,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPD2",71,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPD2",72,0)
 .;
"RTN","BIREPD2",73,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPD2",74,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPD2",75,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPD2",76,0)
 .;
"RTN","BIREPD2",77,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPD2",78,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPD2",79,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPD2",80,0)
 .;
"RTN","BIREPD2",81,0)
 .;---> Now write Age Group Denominators subheader.
"RTN","BIREPD2",82,0)
 .S X="  Age Group      |       11-12yrs      13yrs       13-17yrs"
"RTN","BIREPD2",83,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPD2",84,0)
 .S X="  Denominators   |     "_$J($G(BITOTPTS(1112)),7)_"      "
"RTN","BIREPD2",85,0)
 .S X=X_$J($G(BITOTPTS(1313)),7)_"      "_$J($G(BITOTPTS(1317)),7)
"RTN","BIREPD2",86,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPD2",87,0)
 ;
"RTN","BIREPD2",88,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPD2",89,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPD2",90,0)
 D:$D(VALM("BM"))
"RTN","BIREPD2",91,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPD2",92,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPD2",93,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPD2",94,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPD2",95,0)
 Q
"RTN","BIREPD2",96,0)
 ;
"RTN","BIREPD2",97,0)
 ;
"RTN","BIREPD2",98,0)
 ;----------
"RTN","BIREPD2",99,0)
START(BIQDT,BIDAR,BIAGRPS,BICC,BIHCF,BICM,BIBEN,BISITE,BIUP,BITOTPTS,BITOTFPT,BITOTMPT) ;EP
"RTN","BIREPD2",100,0)
 ;---> Produce array for Report.
"RTN","BIREPD2",101,0)
 ;---> Parameters:
"RTN","BIREPD2",102,0)
 ;     1 - BIQDT    (req) Quarter Ending Date.
"RTN","BIREPD2",103,0)
 ;     2 - BIDAR    (opt) Adolescent Report Age Range: "11-18^1" (years).
"RTN","BIREPD2",104,0)
 ;     3 - BIAGRPS  (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD2",105,0)
 ;     4 - BICC     (req) Current Community array.
"RTN","BIREPD2",106,0)
 ;     5 - BIHCF    (req) Health Care Facility array.
"RTN","BIREPD2",107,0)
 ;     6 - BICM     (req) Case Manager array.
"RTN","BIREPD2",108,0)
 ;     7 - BIBEN    (req) Beneficiary Type array.
"RTN","BIREPD2",109,0)
 ;     8 - BISITE   (req) Site IEN.
"RTN","BIREPD2",110,0)
 ;     9 - BIUP     (req) User Population/Group (All, Imm, User, Active).
"RTN","BIREPD2",111,0)
 ;    10 - BITOTPTS (ret) Total Patients.
"RTN","BIREPD2",112,0)
 ;    11 - BITOTFPT (ret) Total Female Patients.
"RTN","BIREPD2",113,0)
 ;    12 - BITOTmPT (ret) Total Male Patients.
"RTN","BIREPD2",114,0)
 ;
"RTN","BIREPD2",115,0)
 K ^TMP("BIREPD1",$J)
"RTN","BIREPD2",116,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPD2",117,0)
 ;
"RTN","BIREPD2",118,0)
 ;---> Check for required Variables.
"RTN","BIREPD2",119,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(623,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",120,0)
 I '$D(BIDAR)  D ERRCD^BIUTL2(613,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",121,0)
 I '$G(BIAGRPS) D ERRCD^BIUTL2(677,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",122,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",123,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",124,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",125,0)
 I '$D(BIBEN)  D ERRCD^BIUTL2(662,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",126,0)
 I '$G(BISITE) S BISITE=$G(DUZ(2))
"RTN","BIREPD2",127,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,.X) D WRITE^BIREPD3(.BILINE,X) Q
"RTN","BIREPD2",128,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPD2",129,0)
 ;
"RTN","BIREPD2",130,0)
 ;---> Gather data.
"RTN","BIREPD2",131,0)
 D GETDATA^BIREPD3(.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BIDAR,BIAGRPS,BISITE,BIUP,.BITMP,.BIERR)
"RTN","BIREPD2",132,0)
 I $G(BIERR)]"" D WRITE^BIREPD3(.BILINE,BIERR) Q
"RTN","BIREPD2",133,0)
 ;
"RTN","BIREPD2",134,0)
 ;
"RTN","BIREPD2",135,0)
 ;---> BITOTPTS variables (total patients) not newed here because they are
"RTN","BIREPD2",136,0)
 ;---> also used in the Report Header.
"RTN","BIREPD2",137,0)
 ;---> Total.
"RTN","BIREPD2",138,0)
 S BITOTPTS=+$G(BITMP("STATS","TOTLPTS"))
"RTN","BIREPD2",139,0)
 S BITOTPTS(1112)=+$G(BITMP("STATS","TOTLPTS",1112))
"RTN","BIREPD2",140,0)
 S BITOTPTS(1313)=+$G(BITMP("STATS","TOTLPTS",1313))
"RTN","BIREPD2",141,0)
 S BITOTPTS(1317)=+$G(BITMP("STATS","TOTLPTS",1317))
"RTN","BIREPD2",142,0)
 ;---> Females.
"RTN","BIREPD2",143,0)
 S BITOTFPT=+$G(BITMP("STATS","TOTLFPTS"))
"RTN","BIREPD2",144,0)
 S BITOTFPT(1112)=+$G(BITMP("STATS","TOTLFPTS",1112))
"RTN","BIREPD2",145,0)
 S BITOTFPT(1313)=+$G(BITMP("STATS","TOTLFPTS",1313))
"RTN","BIREPD2",146,0)
 S BITOTFPT(1317)=+$G(BITMP("STATS","TOTLFPTS",1317))
"RTN","BIREPD2",147,0)
 ;---> Males.
"RTN","BIREPD2",148,0)
 S BITOTMPT=+$G(BITMP("STATS","TOTLMPTS"))
"RTN","BIREPD2",149,0)
 S BITOTMPT(1112)=+$G(BITMP("STATS","TOTLMPTS",1112))
"RTN","BIREPD2",150,0)
 S BITOTMPT(1313)=+$G(BITMP("STATS","TOTLMPTS",1313))
"RTN","BIREPD2",151,0)
 S BITOTMPT(1317)=+$G(BITMP("STATS","TOTLMPTS",1317))
"RTN","BIREPD2",152,0)
 ;
"RTN","BIREPD2",153,0)
 ;
"RTN","BIREPD2",154,0)
 ;---> VACCINE GROUPS
"RTN","BIREPD2",155,0)
 ;---> Write Statistics lines for each Vaccine Group (BIVGRP).
"RTN","BIREPD2",156,0)
 ;---> NOTE: 132 is specific for Var-Hx of Chickenpox.
"RTN","BIREPD2",157,0)
 ;--->       221 is for the specific vaccine Tdap.
"RTN","BIREPD2",158,0)
 F BIVGRP=4,6,7,132,221,8,9,16,10 D VGRP^BIREPD3(.BILINE,BIVGRP,BIAGRPS,.BITMP,,.BIERR)
"RTN","BIREPD2",159,0)
 I $G(BIERR)]"" D WRITE^BIREPD3(.BILINE,BIERR) Q
"RTN","BIREPD2",160,0)
 ;
"RTN","BIREPD2",161,0)
 ;
"RTN","BIREPD2",162,0)
 ;---> VACCINE COMBINATIONS
"RTN","BIREPD2",163,0)
 ;---> Write Statistics lines for each Vaccine Combinations.
"RTN","BIREPD2",164,0)
 ;---> NOTE: These Combo strings are also used to set BITMP("STATS"
"RTN","BIREPD2",165,0)
 ;---> nodes beginning at +130^BIREPD4.
"RTN","BIREPD2",166,0)
 ;
"RTN","BIREPD2",167,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^4|3^6|2^7|1",BIAGRPS,.BITMP,,.BIERR)
"RTN","BIREPD2",168,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^4|3^6|2^16|1^7|2",BIAGRPS,.BITMP,,.BIERR)
"RTN","BIREPD2",169,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^16|1",BIAGRPS,.BITMP,,.BIERR)
"RTN","BIREPD2",170,0)
 ;
"RTN","BIREPD2",171,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD2",172,0)
 ;---> Include new "1-Td 1-Men 3-HPV" line for both sexes.
"RTN","BIREPD2",173,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^16|1^17|3",BIAGRPS,.BITMP,"B",.BIERR)
"RTN","BIREPD2",174,0)
 ;**********
"RTN","BIREPD2",175,0)
 ;
"RTN","BIREPD2",176,0)
 ;*******
"RTN","BIREPD2",177,0)
 ;---> Break to write FEMALE Denominators subheader.
"RTN","BIREPD2",178,0)
 D DENOMS(.BILINE,.BITOTFPT,1)
"RTN","BIREPD2",179,0)
 ;
"RTN","BIREPD2",180,0)
 ;---> Write Female Statistics lines for HPV Vaccine Group (BIVGRP=17-HPV).
"RTN","BIREPD2",181,0)
 F BIVGRP=17 D VGRP^BIREPD3(.BILINE,BIVGRP,BIAGRPS,.BITMP,"F",.BIERR)
"RTN","BIREPD2",182,0)
 I $G(BIERR)]"" D WRITE^BIREPD3(.BILINE,BIERR) Q
"RTN","BIREPD2",183,0)
 ;
"RTN","BIREPD2",184,0)
 ;---> Now write FEMALE combos.
"RTN","BIREPD2",185,0)
 ;
"RTN","BIREPD2",186,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD2",187,0)
 ;---> Add "1-Td 1-Men 3-HPV" combo line for females.
"RTN","BIREPD2",188,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^16|1^17|3",BIAGRPS,.BITMP,"F",.BIERR)
"RTN","BIREPD2",189,0)
 ;**********
"RTN","BIREPD2",190,0)
 ;
"RTN","BIREPD2",191,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^4|3^6|2^16|1^7|2^17|3",BIAGRPS,.BITMP,"F",.BIERR)
"RTN","BIREPD2",192,0)
 ;*******
"RTN","BIREPD2",193,0)
 ;
"RTN","BIREPD2",194,0)
 ;---> Break to write MALE Denominators subheader.
"RTN","BIREPD2",195,0)
 D DENOMS(.BILINE,.BITOTMPT,0)
"RTN","BIREPD2",196,0)
 ;
"RTN","BIREPD2",197,0)
 ;---> Write Male Statistics lines for HPV Vaccine Group (BIVGRP=17-HPV).
"RTN","BIREPD2",198,0)
 F BIVGRP=17 D VGRP^BIREPD3(.BILINE,BIVGRP,BIAGRPS,.BITMP,"M",.BIERR)
"RTN","BIREPD2",199,0)
 I $G(BIERR)]"" D WRITE^BIREPD3(.BILINE,BIERR) Q
"RTN","BIREPD2",200,0)
 ;
"RTN","BIREPD2",201,0)
 ;---> Now write MALE combos.
"RTN","BIREPD2",202,0)
 ;
"RTN","BIREPD2",203,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD2",204,0)
 ;---> Add "1-Td 1-Men 3-HPV" combo line for males.
"RTN","BIREPD2",205,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^16|1^17|3",BIAGRPS,.BITMP,"M",.BIERR)
"RTN","BIREPD2",206,0)
 ;**********
"RTN","BIREPD2",207,0)
 ;
"RTN","BIREPD2",208,0)
 D VCOMB^BIREPD3(.BILINE,"8|1^4|3^6|2^16|1^7|2^17|3",BIAGRPS,.BITMP,"M",.BIERR)
"RTN","BIREPD2",209,0)
 ;*******
"RTN","BIREPD2",210,0)
 ;
"RTN","BIREPD2",211,0)
 I $G(BIERR)]"" D WRITE^BIREPD3(.BILINE,BIERR) Q
"RTN","BIREPD2",212,0)
 ;
"RTN","BIREPD2",213,0)
 ;---> Finish off report with totals lines at the bottom.
"RTN","BIREPD2",214,0)
 S X=" Total Patients reviewed: "_BITOTPTS
"RTN","BIREPD2",215,0)
 S X=X_"   Females: "_BITOTFPT_"   Males: "_BITOTMPT
"RTN","BIREPD2",216,0)
 D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",217,0)
 ;D WRITE^BIREPD3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPD2",218,0)
 ;
"RTN","BIREPD2",219,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPD2",220,0)
 N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPD2",221,0)
 S X=" Total Patients reviewed who had Refusals on record: "_N
"RTN","BIREPD2",222,0)
 D WRITE^BIREPD3(.BILINE,X),WRITE^BIREPD3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPD2",223,0)
 ;
"RTN","BIREPD2",224,0)
 D
"RTN","BIREPD2",225,0)
 .I BIUP="r" S X="all Registered Patients who have an active health record." Q
"RTN","BIREPD2",226,0)
 .I BIUP="i" S X="Immunization Register Patients with a status of Active." Q
"RTN","BIREPD2",227,0)
 .I BIUP="u" S X="the User Population patients: 1 visit in the past 3 years." Q
"RTN","BIREPD2",228,0)
 .I BIUP="a" S X="Active Clinical Users: 2 clinical visits in the past 3 years." Q
"RTN","BIREPD2",229,0)
 ;
"RTN","BIREPD2",230,0)
 S X=" *Denominators are "_X
"RTN","BIREPD2",231,0)
 D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",232,0)
 ;
"RTN","BIREPD2",233,0)
 ;********** PATCH 1, v8.5, JAN 03,2012, IHS/CMI/MWR
"RTN","BIREPD2",234,0)
 ;---> Change text of explanation.
"RTN","BIREPD2",235,0)
 ;S X=" *All patients (11-17yrs) with 1-Tdap_TD and 1-Mening are considered ""Current."""
"RTN","BIREPD2",236,0)
 ;D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",237,0)
 ;S X=" *Patients 11-12yrs without 1-Tdap_TD and 1-Mening are listed as ""Not Current"""
"RTN","BIREPD2",238,0)
 ;S X="  in order to support patient recall."
"RTN","BIREPD2",239,0)
 ;
"RTN","BIREPD2",240,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD2",241,0)
 ;---> Update "Current" explanation to include 3-HPV.
"RTN","BIREPD2",242,0)
 ;S X=" *All patients (11-17yrs) with 1-Tdap_TD and 1-Mening are considered ""Current"";"
"RTN","BIREPD2",243,0)
 S X=" *All patients (11-17yrs) with 1-TD_B, 1-MEN, 3-HPV are considered ""Current"";"
"RTN","BIREPD2",244,0)
 ;**********
"RTN","BIREPD2",245,0)
 ;
"RTN","BIREPD2",246,0)
 D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",247,0)
 S X="  otherwise they are listed as ""Not Current"" in order to support patient recall."
"RTN","BIREPD2",248,0)
 ;
"RTN","BIREPD2",249,0)
 D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",250,0)
 D WRITE^BIREPD3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPD2",251,0)
 ;
"RTN","BIREPD2",252,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPD2",253,0)
 S VALMCNT=BILINE
"RTN","BIREPD2",254,0)
 Q
"RTN","BIREPD2",255,0)
 ;
"RTN","BIREPD2",256,0)
 ;
"RTN","BIREPD2",257,0)
 ;----------
"RTN","BIREPD2",258,0)
DENOMS(BILINE,BITOTSPT,Z) ;EP
"RTN","BIREPD2",259,0)
 ;---> Produce Female and Male Denominators subheader.
"RTN","BIREPD2",260,0)
 ;---> Parameters:
"RTN","BIREPD2",261,0)
 ;     1 - BILINE   (req) Line number in ^TMP Listman array.
"RTN","BIREPD2",262,0)
 ;     2 - BITOTSPT (req) By Sex Total Patients-Age Group-Stats array.
"RTN","BIREPD2",263,0)
 ;     3 - Z        (req) If Z=1, then female; Z=0, then male.
"RTN","BIREPD2",264,0)
 ;
"RTN","BIREPD2",265,0)
 ;---> Break to write Female or Male Denominators subheader.
"RTN","BIREPD2",266,0)
 S X=$S(Z:"  Female",1:"    Male")
"RTN","BIREPD2",267,0)
 S X=X_"         |       11-12yrs      13yrs       13-17yrs"
"RTN","BIREPD2",268,0)
 D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",269,0)
 S X="  Denominators   |     "_$J($G(BITOTSPT(1112)),7)_"      "
"RTN","BIREPD2",270,0)
 S X=X_$J($G(BITOTSPT(1313)),7)_"      "_$J($G(BITOTSPT(1317)),7)
"RTN","BIREPD2",271,0)
 D WRITE^BIREPD3(.BILINE,X)
"RTN","BIREPD2",272,0)
 D WRITE^BIREPD3(.BILINE,"                "_$$SP^BIUTL5(63,"-"))
"RTN","BIREPD2",273,0)
 Q
"RTN","BIREPD3")
0^93^B49293986
"RTN","BIREPD3",1,0)
BIREPD3 ;IHS/CMI/MWR - REPORT, ADOLESCENT RATES; MAY 10, 2010
"RTN","BIREPD3",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIREPD3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPD3",4,0)
 ;;  VIEW ADOLESCENT IMMUNIZATION RATES REPORT.
"RTN","BIREPD3",5,0)
 ;;  PATCH 3: Include new "1-Td 1-Men 3-HPV" lines. VCOMB+14
"RTN","BIREPD3",6,0)
 ;;  PATCH 5: Correct Male HPV percentage denominator.  VGRP+60
"RTN","BIREPD3",7,0)
 ;
"RTN","BIREPD3",8,0)
 ;
"RTN","BIREPD3",9,0)
 ;----------
"RTN","BIREPD3",10,0)
GETDATA(BICC,BIHCF,BICM,BIBEN,BIQDT,BIDAR,BIAGRPS,BISITE,BIUP,BITMP,BIERR) ;EP
"RTN","BIREPD3",11,0)
 ;---> Gather Immunization History data on selected patients.
"RTN","BIREPD3",12,0)
 ;---> Parameters:
"RTN","BIREPD3",13,0)
 ;     1 - BICC    (req) Current Community array.
"RTN","BIREPD3",14,0)
 ;     2 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPD3",15,0)
 ;     3 - BICM    (req) Case Manager array.
"RTN","BIREPD3",16,0)
 ;     4 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPD3",17,0)
 ;     5 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPD3",18,0)
 ;     6 - BIDAR   (opt) Adolescent Age Range: "11-18^1" (years).
"RTN","BIREPD3",19,0)
 ;     7 - BIAGRPS (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD3",20,0)
 ;     8 - BISITE  (req) Site IEN.
"RTN","BIREPD3",21,0)
 ;     9 - BIUP    (req) User Population/Group (All, Imm, User, Active).
"RTN","BIREPD3",22,0)
 ;    10 - BITMP   (ret) Stores Patient Totals by Age Group and Sex.
"RTN","BIREPD3",23,0)
 ;    11 - BIERR   (ret) Error.
"RTN","BIREPD3",24,0)
 ;
"RTN","BIREPD3",25,0)
 S:'$G(BISITE) BISITE=$G(DUZ(2)) I '$G(BISITE) S BIERR=109 Q
"RTN","BIREPD3",26,0)
 S:'$G(BIQDT) BIQDT=DT
"RTN","BIREPD3",27,0)
 S:'$D(BIDAR) BIDAR="11-18^1"
"RTN","BIREPD3",28,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPD3",29,0)
 ;
"RTN","BIREPD3",30,0)
 ;---> Get Begin and End Dates (DOB's).
"RTN","BIREPD3",31,0)
 D AGEDATE^BIAGE(BIDAR,BIQDT,.BIBEGDT,.BIENDDT,.BIERR)
"RTN","BIREPD3",32,0)
 Q:$G(BIERR)]""
"RTN","BIREPD3",33,0)
 ;
"RTN","BIREPD3",34,0)
 ;---> Gather and sort patients.
"RTN","BIREPD3",35,0)
 D GETPATS^BIREPD4(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BIAGRPS,BISITE,BIUP,.BITMP)
"RTN","BIREPD3",36,0)
 Q
"RTN","BIREPD3",37,0)
 ;
"RTN","BIREPD3",38,0)
 ; Call from BIREPD2: F BIVGRP=4,6,7,8,9,16,10,17 D VGRP^BIREPD3(.BILINE,BIVGRP,BIAGRPS,BISEX,.BIERR)
"RTN","BIREPD3",39,0)
 ;
"RTN","BIREPD3",40,0)
 ;----------
"RTN","BIREPD3",41,0)
VGRP(BILINE,BIVGRP,BIAGRPS,BITMP,BISEX,BIERR) ;EP
"RTN","BIREPD3",42,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPD3",43,0)
 ;---> Parameters:
"RTN","BIREPD3",44,0)
 ;     1 - BILINE  (req) Line number in ^TMP Listman array.
"RTN","BIREPD3",45,0)
 ;     2 - BIVGRP  (req) IEN of Vaccine Group.
"RTN","BIREPD3",46,0)
 ;     3 - BIAGRPS (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD3",47,0)
 ;     4 - BITMP   (req) Stores Patient Totals by Age Group and Sex.
"RTN","BIREPD3",48,0)
 ;     5 - BISEX   (opt) F or M for HPV.
"RTN","BIREPD3",49,0)
 ;     6 - BIERR   (ret) Error.
"RTN","BIREPD3",50,0)
 ;
"RTN","BIREPD3",51,0)
 I '$G(BIVGRP) D ERRCD^BIUTL2(510,.BIERR) Q
"RTN","BIREPD3",52,0)
 I '$G(BIAGRPS) D ERRCD^BIUTL2(677,.BIERR) Q
"RTN","BIREPD3",53,0)
 ;
"RTN","BIREPD3",54,0)
 ;---> Write two lines for each Dose of this Vaccine Group.
"RTN","BIREPD3",55,0)
 N BIDOSE,BIMAXD S BIMAXD=$$VGROUP^BIUTL2(BIVGRP,7)
"RTN","BIREPD3",56,0)
 ;
"RTN","BIREPD3",57,0)
 ;---> Include exception here for Tdap.
"RTN","BIREPD3",58,0)
 I ((BIVGRP=132)!(BIVGRP=221)) S BIMAXD=1
"RTN","BIREPD3",59,0)
 ;
"RTN","BIREPD3",60,0)
 F BIDOSE=1:1:BIMAXD D
"RTN","BIREPD3",61,0)
 .;---> BIX=text of the line to write.
"RTN","BIREPD3",62,0)
 .;
"RTN","BIREPD3",63,0)
 .;---> First, write the Dose#-Vaccine Group in left margin.
"RTN","BIREPD3",64,0)
 .N BIX D
"RTN","BIREPD3",65,0)
 ..;---> Include exception here for Tdap.
"RTN","BIREPD3",66,0)
 ..I BIVGRP=132 S BIX=" Hx of Chickenpox" Q
"RTN","BIREPD3",67,0)
 ..I BIVGRP=221 S BIX="    1-Tdap" Q
"RTN","BIREPD3",68,0)
 ..I BIVGRP=8 S BIX="    1-Tdap/Td" Q
"RTN","BIREPD3",69,0)
 ..S BIX="    "_BIDOSE_"-"_$$VGROUP^BIUTL2(BIVGRP,5)
"RTN","BIREPD3",70,0)
 .;
"RTN","BIREPD3",71,0)
 .S BIX=$$PAD^BIUTL5(BIX,17)_"|"
"RTN","BIREPD3",72,0)
 .;
"RTN","BIREPD3",73,0)
 .;---> Write actual totals line for this dose for each Age Group
"RTN","BIREPD3",74,0)
 .;---> (loop through the age groups, concating the totals horizontally).
"RTN","BIREPD3",75,0)
 .N BIAGRP,K
"RTN","BIREPD3",76,0)
 .F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPD3",77,0)
 ..N Y D
"RTN","BIREPD3",78,0)
 ...;---> If HPV (17), append sex to age group to retrieve HPV stats.
"RTN","BIREPD3",79,0)
 ...I BIVGRP=17 S Y=+$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP_BISEX)) Q
"RTN","BIREPD3",80,0)
 ...S Y=+$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPD3",81,0)
 ..;
"RTN","BIREPD3",82,0)
 ..S BIX=BIX_$J(Y,12)_" "
"RTN","BIREPD3",83,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPD3",84,0)
 .D MARK^BIW(BILINE,3,"BIREPD1")
"RTN","BIREPD3",85,0)
 .;
"RTN","BIREPD3",86,0)
 .;
"RTN","BIREPD3",87,0)
 .;---> Now write Percentages line for each Age Group (under the actual totals).
"RTN","BIREPD3",88,0)
 .S BIX="" S:BIVGRP=132 BIX="    (Immune)"
"RTN","BIREPD3",89,0)
 .S BIX=$$PAD^BIUTL5(BIX,17)_"|"
"RTN","BIREPD3",90,0)
 .F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPD3",91,0)
 ..;N Y S Y=$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPD3",92,0)
 ..N Y D
"RTN","BIREPD3",93,0)
 ...;---> If HPV (17), append sex to age group to retrieve HPV stats.
"RTN","BIREPD3",94,0)
 ...I BIVGRP=17 S Y=+$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP_BISEX)) Q
"RTN","BIREPD3",95,0)
 ...S Y=+$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPD3",96,0)
 ..;
"RTN","BIREPD3",97,0)
 ..I 'Y S BIX=BIX_$J("",12)_" " Q
"RTN","BIREPD3",98,0)
 ..;
"RTN","BIREPD3",99,0)
 ..;---> If Vaccine Group is HPV-17, use female denominators.
"RTN","BIREPD3",100,0)
 ..;
"RTN","BIREPD3",101,0)
 ..;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPD3",102,0)
 ..;---> Correct Male HPV percentage denominator.
"RTN","BIREPD3",103,0)
 ..;N Z S Z=$G(BITMP("STATS",$S(BIVGRP=17:"TOTLFPTS",1:"TOTLPTS"),BIAGRP))
"RTN","BIREPD3",104,0)
 ..;
"RTN","BIREPD3",105,0)
 ..N BIDENOM D
"RTN","BIREPD3",106,0)
 ...I (BIVGRP=17)&($G(BISEX)="F") S BIDENOM="TOTLFPTS" Q
"RTN","BIREPD3",107,0)
 ...I (BIVGRP=17)&($G(BISEX)="M") S BIDENOM="TOTLMPTS" Q
"RTN","BIREPD3",108,0)
 ...S BIDENOM="TOTLPTS" Q
"RTN","BIREPD3",109,0)
 ..N Z S Z=$G(BITMP("STATS",BIDENOM,BIAGRP))
"RTN","BIREPD3",110,0)
 ..;**********
"RTN","BIREPD3",111,0)
 ..;
"RTN","BIREPD3",112,0)
 ..;---> To avoid bomb if Z=0/null.
"RTN","BIREPD3",113,0)
 ..S:'Z Y=0,Z=1 S Y=(Y*100)/Z
"RTN","BIREPD3",114,0)
 ..S BIX=BIX_$J(Y,12,0)_"%"
"RTN","BIREPD3",115,0)
 ..;S BIX=BIX_$J(Y,$S(K=1:9,1:12),0)_"%"
"RTN","BIREPD3",116,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPD3",117,0)
 .Q:BIDOSE=BIMAXD
"RTN","BIREPD3",118,0)
 .;
"RTN","BIREPD3",119,0)
 .;---> Write a dashed line to close off this Dose.
"RTN","BIREPD3",120,0)
 .S BIX=$$SP^BIUTL5(17)_"|"_$$SP^BIUTL5(62,"-")
"RTN","BIREPD3",121,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPD3",122,0)
 ;
"RTN","BIREPD3",123,0)
 ;---> Write a final dashed line to close off this Vaccine Group (unless Tdap).
"RTN","BIREPD3",124,0)
 D
"RTN","BIREPD3",125,0)
 .I BIVGRP=221 S BIX=$$SP^BIUTL5(17)_"|"_$$SP^BIUTL5(62,"-") Q
"RTN","BIREPD3",126,0)
 .S BIX=$$SP^BIUTL5(79,"-")
"RTN","BIREPD3",127,0)
 D WRITE(.BILINE,BIX)
"RTN","BIREPD3",128,0)
 Q
"RTN","BIREPD3",129,0)
 ;
"RTN","BIREPD3",130,0)
 ;
"RTN","BIREPD3",131,0)
 ;----------
"RTN","BIREPD3",132,0)
VCOMB(BILINE,BICOMB,BIAGRPS,BITMP,BISEX,BIERR) ;EP
"RTN","BIREPD3",133,0)
 ;---> Write Stats lines for each Vaccine Combination.
"RTN","BIREPD3",134,0)
 ;---> Parameters:
"RTN","BIREPD3",135,0)
 ;     1 - BILINE  (req) Line number in ^TMP Listman array.
"RTN","BIREPD3",136,0)
 ;     2 - BICOMB  (req) Numeric code of Vaccine Combination.
"RTN","BIREPD3",137,0)
 ;     3 - BIAGRPS (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD3",138,0)
 ;     4 - BITMP   (ret) Stores Patient Totals by Age Group and Sex.
"RTN","BIREPD3",139,0)
 ;     5 - BISEX   (opt) F or M for HPV, or B (for "both").
"RTN","BIREPD3",140,0)
 ;     6 - BIERR   (ret) Error.
"RTN","BIREPD3",141,0)
 ;
"RTN","BIREPD3",142,0)
 I '$G(BIAGRPS) D ERRCD^BIUTL2(677,.BIERR) Q
"RTN","BIREPD3",143,0)
 ;
"RTN","BIREPD3",144,0)
 ;---> Build the left-most cell that lists the vaccines for this combo.
"RTN","BIREPD3",145,0)
 ;
"RTN","BIREPD3",146,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD3",147,0)
 ;---> Include new "1-Td 1-Men 3-HPV" lines for both sexes combined.
"RTN","BIREPD3",148,0)
 N BIX,I,Q,X S Q=0 S:$G(BISEX)="" BISEX=""
"RTN","BIREPD3",149,0)
 F I=1:1:4 S BIX(I)=""
"RTN","BIREPD3",150,0)
 F I=1:1 S X=$P(BICOMB,U,I) Q:Q  D
"RTN","BIREPD3",151,0)
 .;I ((X="")&(BICOMB'[17)) S Q=1 Q
"RTN","BIREPD3",152,0)
 .I ((X="")&((BICOMB'[17)!(BISEX="B"))) S Q=1 Q
"RTN","BIREPD3",153,0)
 .;**********
"RTN","BIREPD3",154,0)
 .S:(X="") X=$S(BISEX="F":"(females)",BISEX="M":"(males)",1:"???"),Q=1
"RTN","BIREPD3",155,0)
 .S:'Q X=$P(X,"|",2)_"-"_$$VGROUP^BIUTL2($P(X,"|"),5)
"RTN","BIREPD3",156,0)
 .I I<3 S BIX(1)=BIX(1)_" "_X Q
"RTN","BIREPD3",157,0)
 .I I<5 S BIX(2)=BIX(2)_" "_X Q
"RTN","BIREPD3",158,0)
 .I I<7 S BIX(3)=BIX(3)_" "_X Q
"RTN","BIREPD3",159,0)
 .S BIX(4)=BIX(4)_" "_X
"RTN","BIREPD3",160,0)
 ;
"RTN","BIREPD3",161,0)
 ;---> Write actual totals line for this Combo for each Age Group
"RTN","BIREPD3",162,0)
 ;---> (loop through the Age Groups.
"RTN","BIREPD3",163,0)
 S BIX=BIX(1),BIX=$$PAD^BIUTL5(BIX,17)_"|"
"RTN","BIREPD3",164,0)
 N BIAGRP,K
"RTN","BIREPD3",165,0)
 F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPD3",166,0)
 .N Y D
"RTN","BIREPD3",167,0)
 ..;---> If HPV (17), append sex to age group to retrieve HPV stats.
"RTN","BIREPD3",168,0)
 ..I $G(BISEX)="F" S Y=+$G(BITMP("STATS",BICOMB,BIAGRP_"F")) Q
"RTN","BIREPD3",169,0)
 ..I $G(BISEX)="M" S Y=+$G(BITMP("STATS",BICOMB,BIAGRP_"M")) Q
"RTN","BIREPD3",170,0)
 ..S Y=+$G(BITMP("STATS",BICOMB,BIAGRP))
"RTN","BIREPD3",171,0)
 .;
"RTN","BIREPD3",172,0)
 .S BIX=BIX_$J(Y,12)_" "
"RTN","BIREPD3",173,0)
 D WRITE(.BILINE,BIX)
"RTN","BIREPD3",174,0)
 S I=3 S:BIX(3)]"" I=4 S:BIX(4)]"" I=5
"RTN","BIREPD3",175,0)
 D MARK^BIW(BILINE,I,"BIREPD1")
"RTN","BIREPD3",176,0)
 ;
"RTN","BIREPD3",177,0)
 ;---> Now write percentages line.
"RTN","BIREPD3",178,0)
 S BIX=BIX(2),BIX=$$PAD^BIUTL5(BIX,17)_"|"
"RTN","BIREPD3",179,0)
 F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPD3",180,0)
 .N Y D
"RTN","BIREPD3",181,0)
 ..;---> If HPV (17), append sex to age group to retrieve HPV stats.
"RTN","BIREPD3",182,0)
 ..I $G(BISEX)="F" S Y=$G(BITMP("STATS",BICOMB,BIAGRP_"F")) Q
"RTN","BIREPD3",183,0)
 ..I $G(BISEX)="M" S Y=$G(BITMP("STATS",BICOMB,BIAGRP_"M")) Q
"RTN","BIREPD3",184,0)
 ..S Y=$G(BITMP("STATS",BICOMB,BIAGRP))
"RTN","BIREPD3",185,0)
 .;
"RTN","BIREPD3",186,0)
 .I 'Y S BIX=BIX_$J("",12)_" " Q
"RTN","BIREPD3",187,0)
 .I '$G(BITMP("STATS","TOTLPTS")) S BIX=BIX_$J(Y,7)_"  " Q
"RTN","BIREPD3",188,0)
 .;
"RTN","BIREPD3",189,0)
 .;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD3",190,0)
 .;---> Use denominators for Both, Female, and Male.
"RTN","BIREPD3",191,0)
 .;N Z S Z=$G(BITMP("STATS",$S(BICOMB[17:"TOTLFPTS",1:"TOTLPTS"),BIAGRP))
"RTN","BIREPD3",192,0)
 .N Z D
"RTN","BIREPD3",193,0)
 ..;---> If HPV (17), append sex to age group to retrieve denominator.
"RTN","BIREPD3",194,0)
 ..I $G(BISEX)="F" S Z=$G(BITMP("STATS","TOTLFPTS",BIAGRP)) Q
"RTN","BIREPD3",195,0)
 ..I $G(BISEX)="M" S Z=$G(BITMP("STATS","TOTLMPTS",BIAGRP)) Q
"RTN","BIREPD3",196,0)
 ..S Z=$G(BITMP("STATS","TOTLPTS",BIAGRP))
"RTN","BIREPD3",197,0)
 .;**********
"RTN","BIREPD3",198,0)
 .;
"RTN","BIREPD3",199,0)
 .;---> To avoid bomb if Z=0/null.
"RTN","BIREPD3",200,0)
 .S:'Z Y=0,Z=1 S Y=(Y*100)/Z
"RTN","BIREPD3",201,0)
 .S BIX=BIX_$J(Y,12,0)_"%"
"RTN","BIREPD3",202,0)
 .;S BIX=BIX_$J(Y,$S(K=1:9,1:12),0)_"%"
"RTN","BIREPD3",203,0)
 D WRITE(.BILINE,BIX)
"RTN","BIREPD3",204,0)
 ;
"RTN","BIREPD3",205,0)
 F I=3,4 D:BIX(I)]""
"RTN","BIREPD3",206,0)
 .S BIX=BIX(I),BIX=$$PAD^BIUTL5(BIX,17)_"|"
"RTN","BIREPD3",207,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPD3",208,0)
 ;
"RTN","BIREPD3",209,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPD3",210,0)
 Q
"RTN","BIREPD3",211,0)
 ;
"RTN","BIREPD3",212,0)
 ;
"RTN","BIREPD3",213,0)
 ;----------
"RTN","BIREPD3",214,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPD3",215,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPD3",216,0)
 ;---> Parameters:
"RTN","BIREPD3",217,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPD3",218,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPD3",219,0)
 ;
"RTN","BIREPD3",220,0)
 Q:'$D(BILINE)
"RTN","BIREPD3",221,0)
 D WL^BIW(.BILINE,"BIREPD1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPD3",222,0)
 ;
"RTN","BIREPD3",223,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPD3",224,0)
 S VALMCNT=BILINE
"RTN","BIREPD3",225,0)
 Q
"RTN","BIREPD4")
0^94^B87489235
"RTN","BIREPD4",1,0)
BIREPD4 ;IHS/CMI/MWR - REPORT, ADOLESCENT RATES; AUG 10,2010
"RTN","BIREPD4",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPD4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPD4",4,0)
 ;;  VIEW ADOLESCENT IMMUNIZATION RATES REPORT, WRITE HEADERS, ETC.
"RTN","BIREPD4",5,0)
 ;;  PATCH 1: Fix to count only one Flu dose per season; do not affect
"RTN","BIREPD4",6,0)
 ;;           other Vaccine Groups.  CHECKSET+158
"RTN","BIREPD4",7,0)
 ;;  PATCH 3: Include new "1-Td 1-Men 3-HPV" lines. CHKSET+215
"RTN","BIREPD4",8,0)
 ;
"RTN","BIREPD4",9,0)
 ;
"RTN","BIREPD4",10,0)
 ;----------
"RTN","BIREPD4",11,0)
GETPATS(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIQDT,BIAGRPS,BISITE,BIUP,BITMP) ;EP
"RTN","BIREPD4",12,0)
 ;---> Get patients from VA PATIENT File, ^DPT(.
"RTN","BIREPD4",13,0)
 ;---> Parameters:
"RTN","BIREPD4",14,0)
 ;     1 - BIBEGDT (req) Begin DOB for this group.
"RTN","BIREPD4",15,0)
 ;     2 - BIENDDT (req) End DOB for this group.
"RTN","BIREPD4",16,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPD4",17,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPD4",18,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPD4",19,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPD4",20,0)
 ;     7 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPD4",21,0)
 ;     8 - BIAGRPS (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD4",22,0)
 ;     9 - BISITE  (req) Site IEN.
"RTN","BIREPD4",23,0)
 ;    10 - BIUP    (req) User Population/Group (All, Imm, User, Active).
"RTN","BIREPD4",24,0)
 ;    11 - BITMP   (ret) Stores Patient Totals by Age Group and Sex.
"RTN","BIREPD4",25,0)
 ;
"RTN","BIREPD4",26,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIREPD4",27,0)
 ;
"RTN","BIREPD4",28,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)  Q:'$G(BIQDT)  Q:'$G(BIAGRPS)
"RTN","BIREPD4",29,0)
 ;
"RTN","BIREPD4",30,0)
 ;---> Start 1 day prior to Begin Date and $O into the desired DOB's.
"RTN","BIREPD4",31,0)
 N BIDOB S BIDOB=BIBEGDT-1
"RTN","BIREPD4",32,0)
 F  S BIDOB=$O(^DPT("ADOB",BIDOB)) Q:(BIDOB>BIENDDT!('BIDOB))  D
"RTN","BIREPD4",33,0)
 .S BIDFN=0
"RTN","BIREPD4",34,0)
 .F  S BIDFN=$O(^DPT("ADOB",BIDOB,BIDFN)) Q:'BIDFN  D
"RTN","BIREPD4",35,0)
 ..D CHKSET(BIDFN,.BICC,.BIHCF,.BICM,.BIBEN,BIDOB,BIQDT,.BIVAL,BIAGRPS,BIUP,.BITMP)
"RTN","BIREPD4",36,0)
 ..;---> Set ^TMP("BIDUL",$J,CURCOM,1,HRCN,BIDFN)=$G(BIVAL) for Patient Roster.
"RTN","BIREPD4",37,0)
 ..D:$G(BIVAL) STORE^BIDUR1(BIDFN,DT,9,,BIVAL,BISITE)
"RTN","BIREPD4",38,0)
 Q
"RTN","BIREPD4",39,0)
 ;
"RTN","BIREPD4",40,0)
 ;
"RTN","BIREPD4",41,0)
 ;----------
"RTN","BIREPD4",42,0)
CHKSET(BIDFN,BICC,BIHCF,BICM,BIBEN,BIDOB,BIQDT,BIVAL,BIAGRPS,BIUP,BITMP) ;EP
"RTN","BIREPD4",43,0)
 ;---> Check if this patient fits criteria; if so, set DFN
"RTN","BIREPD4",44,0)
 ;---> in ^TMP("BIREPD1".
"RTN","BIREPD4",45,0)
 ;---> Parameters:
"RTN","BIREPD4",46,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIREPD4",47,0)
 ;     2 - BICC    (req) Current Community array.
"RTN","BIREPD4",48,0)
 ;     3 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPD4",49,0)
 ;     4 - BICM    (req) Case Manager array.
"RTN","BIREPD4",50,0)
 ;     5 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPD4",51,0)
 ;     6 - BIDOB   (req) Patient's Date of Birth.
"RTN","BIREPD4",52,0)
 ;     7 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPD4",53,0)
 ;     8 - BIVAL   (ret) 1=Not appropriate/complete, 2=1321 complete.
"RTN","BIREPD4",54,0)
 ;     9 - BIAGRPS (req) String of Age Groups ("1112,1313,1317").
"RTN","BIREPD4",55,0)
 ;    10 - BIUP    (req) User Population/Group (All, Imm, User, Active).
"RTN","BIREPD4",56,0)
 ;    11 - BITMP   (ret) Stores Patient Totals by Age Group and Sex.
"RTN","BIREPD4",57,0)
 ;
"RTN","BIREPD4",58,0)
 Q:'$G(BIDFN)
"RTN","BIREPD4",59,0)
 Q:'$D(BICC)
"RTN","BIREPD4",60,0)
 Q:'$D(BIHCF)
"RTN","BIREPD4",61,0)
 Q:'$D(BICM)
"RTN","BIREPD4",62,0)
 Q:'$D(BIBEN)
"RTN","BIREPD4",63,0)
 I '$G(BIDOB) S BIDOB=$$DOB^BIUTL1(BIDFN)
"RTN","BIREPD4",64,0)
 Q:'$G(BIQDT)
"RTN","BIREPD4",65,0)
 Q:'$G(BIAGRPS)
"RTN","BIREPD4",66,0)
 Q:$G(BIUP)=""
"RTN","BIREPD4",67,0)
 ;
"RTN","BIREPD4",68,0)
 ;---> Don't include this patient in Roster unless set below.
"RTN","BIREPD4",69,0)
 S BIVAL=0
"RTN","BIREPD4",70,0)
 ;
"RTN","BIREPD4",71,0)
 ;---> Filter for standard Patient Population parameter.
"RTN","BIREPD4",72,0)
 Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIQDT,BIUP)
"RTN","BIREPD4",73,0)
 ;
"RTN","BIREPD4",74,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPD4",75,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPD4",76,0)
 ;
"RTN","BIREPD4",77,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPD4",78,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPD4",79,0)
 ;
"RTN","BIREPD4",80,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPD4",81,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPD4",82,0)
 ;
"RTN","BIREPD4",83,0)
 ;---> Get patient gender.
"RTN","BIREPD4",84,0)
 N BISEX S BISEX=$$SEX^BIUTL1(BIDFN)
"RTN","BIREPD4",85,0)
 Q:((BISEX'="F")&(BISEX'="M"))
"RTN","BIREPD4",86,0)
 ;
"RTN","BIREPD4",87,0)
 ;---> Get patient age in years on report date.
"RTN","BIREPD4",88,0)
 N BIAGE S BIAGE=$$AGE^BIUTL1(BIDFN,1,BIQDT)
"RTN","BIREPD4",89,0)
 Q:'BIAGE  Q:(BIAGE<11)  Q:(BIAGE>18)
"RTN","BIREPD4",90,0)
 ;
"RTN","BIREPD4",91,0)
 ;---> Set patient's Age Group for this report; either 1112 or 1317.
"RTN","BIREPD4",92,0)
 N BIAGRP S BIAGRP=$S(BIAGE<13:1112,1:1317)
"RTN","BIREPD4",93,0)
 ;
"RTN","BIREPD4",94,0)
 ;---> Store Patient in appropriate totals.
"RTN","BIREPD4",95,0)
 ;---> Total patients.
"RTN","BIREPD4",96,0)
 N Z S Z=$G(BITMP("STATS","TOTLPTS")) S BITMP("STATS","TOTLPTS")=Z+1
"RTN","BIREPD4",97,0)
 ;---> Total patients in Age Group.
"RTN","BIREPD4",98,0)
 S Z=$G(BITMP("STATS","TOTLPTS",BIAGRP)) S BITMP("STATS","TOTLPTS",BIAGRP)=Z+1
"RTN","BIREPD4",99,0)
 ;----> * NOTE! Here's an example where I build column for 13-yr-olds!
"RTN","BIREPD4",100,0)
 ;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",101,0)
 D:BIAGE=13
"RTN","BIREPD4",102,0)
 .S Z=$G(BITMP("STATS","TOTLPTS",1313)) S BITMP("STATS","TOTLPTS",1313)=Z+1
"RTN","BIREPD4",103,0)
 ;
"RTN","BIREPD4",104,0)
 ;
"RTN","BIREPD4",105,0)
 ;---> Set node for female or male denominators.
"RTN","BIREPD4",106,0)
 N BISXNOD S BISXNOD=$S(BISEX="F":"TOTLFPTS",1:"TOTLMPTS")
"RTN","BIREPD4",107,0)
 ;---> Total Female patients.
"RTN","BIREPD4",108,0)
 S Z=$G(BITMP("STATS",BISXNOD)) S BITMP("STATS",BISXNOD)=Z+1
"RTN","BIREPD4",109,0)
 ;---> Total female patients in Age Group.
"RTN","BIREPD4",110,0)
 S Z=$G(BITMP("STATS",BISXNOD,BIAGRP)) S BITMP("STATS",BISXNOD,BIAGRP)=Z+1
"RTN","BIREPD4",111,0)
 ;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",112,0)
 D:BIAGE=13
"RTN","BIREPD4",113,0)
 .S Z=$G(BITMP("STATS",BISXNOD,1313)) S BITMP("STATS",BISXNOD,1313)=Z+1
"RTN","BIREPD4",114,0)
 ;
"RTN","BIREPD4",115,0)
 ;
"RTN","BIREPD4",116,0)
 ;---> Store for Patient Report Roster (not yet determined if complete 1321).
"RTN","BIREPD4",117,0)
 S BIVAL=1
"RTN","BIREPD4",118,0)
 ;
"RTN","BIREPD4",119,0)
 ;---> RPC to gather Immunization History.
"RTN","BIREPD4",120,0)
 N BI31,BIDE,BIRETVAL,BIRETERR,I S BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIREPD4",121,0)
 ;---> 30=Vaccine IEN, 55=Vaccine Group IEN, 56=Date of Visit(Fileman).
"RTN","BIREPD4",122,0)
 F I=30,55,56 S BIDE(I)=""
"RTN","BIREPD4",123,0)
 ;
"RTN","BIREPD4",124,0)
 ;---> Fourth parameter=0: Do not return Skin Tests.
"RTN","BIREPD4",125,0)
 ;---> Fifth parameter=0: Means the components of a combination vaccine will
"RTN","BIREPD4",126,0)
 ;---> be split out.
"RTN","BIREPD4",127,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,0,0)
"RTN","BIREPD4",128,0)
 ;
"RTN","BIREPD4",129,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BIREPD4",130,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIREPD4",131,0)
 Q:BIRETERR]""
"RTN","BIREPD4",132,0)
 ;
"RTN","BIREPD4",133,0)
 ;---> Add refusals, if any.
"RTN","BIREPD4",134,0)
 N Z D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) S BITMP("REFUSALS",BIDFN)="" K Z
"RTN","BIREPD4",135,0)
 ;
"RTN","BIREPD4",136,0)
 ;
"RTN","BIREPD4",137,0)
 ;---> Check for Hx of Chicken Pox (as a reason for contra to Var & MMRV.
"RTN","BIREPD4",138,0)
 ;---> If HX of Chicken Pox to add to Varicella Stats Line and to 1:3:2:1 line.
"RTN","BIREPD4",139,0)
 N BIHXX,Z
"RTN","BIREPD4",140,0)
 D CONTRA^BIUTL11(BIDFN,.Z,2) I ($G(Z(21))=12)!($G(Z(94))=12) D
"RTN","BIREPD4",141,0)
 .S Z=$G(BITMP("STATS",132,1,BIAGRP)) S BITMP("STATS",132,1,BIAGRP)=Z+1
"RTN","BIREPD4",142,0)
 .;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",143,0)
 .I BIAGE=13 S Z=$G(BITMP("STATS",132,1,1313)) S BITMP("STATS",132,1,1313)=Z+1
"RTN","BIREPD4",144,0)
 .;---> Also set for 1:3:2:1 line.
"RTN","BIREPD4",145,0)
 .S BIHXX(132,1,BIAGRP)=""
"RTN","BIREPD4",146,0)
 ;
"RTN","BIREPD4",147,0)
 ;---> Set BIHX=to a valid Immunization History.
"RTN","BIREPD4",148,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BIREPD4",149,0)
 ;
"RTN","BIREPD4",150,0)
 ;---> Add this Patient's History to stats.
"RTN","BIREPD4",151,0)
 N I,Y
"RTN","BIREPD4",152,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BIREPD4",153,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BIREPD4",154,0)
 .;---> Age (A), Dose# (D), Visit Date (J), sratch variable (Q),
"RTN","BIREPD4",155,0)
 .;---> Vaccine Group IEN (V), Vaccine IEN (W).
"RTN","BIREPD4",156,0)
 .N A,D,J,Q,V,W
"RTN","BIREPD4",157,0)
 .S W=$P(Y,"|",2),V=$P(Y,"|",3),J=$P(Y,"|",4)
"RTN","BIREPD4",158,0)
 .;
"RTN","BIREPD4",159,0)
 .;---> Select for Vaccine Group IEN's:
"RTN","BIREPD4",160,0)
 .;---> 4-HEPB, 6-MMR, 7-VAR, 8-Td_B, 9-HEPA, 10-FLU, 16-MEN, 17-HPV
"RTN","BIREPD4",161,0)
 .Q:'$G(V)
"RTN","BIREPD4",162,0)
 .N Q F Q=1,2,3,5,11:1:15 Q:V=Q
"RTN","BIREPD4",163,0)
 .Q:V=Q
"RTN","BIREPD4",164,0)
 .;
"RTN","BIREPD4",165,0)
 .;---> Exclude immunization visits after the Quarter Ending Date, BIQDT.
"RTN","BIREPD4",166,0)
 .Q:(J>BIQDT)
"RTN","BIREPD4",167,0)
 .;
"RTN","BIREPD4",168,0)
 .;********** v8.5, MAY 15,2011, IHS/CMI/MWR
"RTN","BIREPD4",169,0)
 .;---> This code moved up from below.  BIHX(10,D) was getting set for a prior
"RTN","BIREPD4",170,0)
 .;---> year's dose, then quitting (because >1year), but also blocking this
"RTN","BIREPD4",171,0)
 .;---> year's dose--since BIHX(10 already existed.
"RTN","BIREPD4",172,0)
 .;---> Quit if V=FLU and Date of Visit is more than 1 year before Report Date.
"RTN","BIREPD4",173,0)
 .Q:((V=10)&($$FMDIFF^XLFDT(BIQDT,J,1)>365))
"RTN","BIREPD4",174,0)
 .;**********
"RTN","BIREPD4",175,0)
 .;
"RTN","BIREPD4",176,0)
 .;---> Quit if one Flu dose has already been recorded (only want one Flu
"RTN","BIREPD4",177,0)
 .;---> dose per patient per season).
"RTN","BIREPD4",178,0)
 .Q:((V=10)&($D(BIHX(10))))
"RTN","BIREPD4",179,0)
 .;
"RTN","BIREPD4",180,0)
 .;---> Build local array for setting combinations stats below.
"RTN","BIREPD4",181,0)
 .;
"RTN","BIREPD4",182,0)
 .;---> Set Dose# (increment by 1's to assign highest/latest dose#)
"RTN","BIREPD4",183,0)
 .S D=1,Q=0
"RTN","BIREPD4",184,0)
 .F  Q:Q  D
"RTN","BIREPD4",185,0)
 ..I $D(BIHX(V,D)) S D=D+1 Q
"RTN","BIREPD4",186,0)
 ..S BIHX(V,D)="",Q=1
"RTN","BIREPD4",187,0)
 .;
"RTN","BIREPD4",188,0)
 .;---> For Flu count every dose as a "dose #1". Might want to go to dose #2. MWRZZZ
"RTN","BIREPD4",189,0)
 .I V=10 S D=1
"RTN","BIREPD4",190,0)
 .;
"RTN","BIREPD4",191,0)
 .;---> Set each immunization in the STATS array by Vaccine Group (V),
"RTN","BIREPD4",192,0)
 .;---> Dose (D), and Age Group (BIAGRP).
"RTN","BIREPD4",193,0)
 .;
"RTN","BIREPD4",194,0)
 .;---> If this is HPV, separate female and male by appending sex to age group.
"RTN","BIREPD4",195,0)
 .I V=17 D  Q
"RTN","BIREPD4",196,0)
 ..N Z S Z=$G(BITMP("STATS",V,D,BIAGRP_BISEX)) S BITMP("STATS",V,D,BIAGRP_BISEX)=Z+1
"RTN","BIREPD4",197,0)
 ..S BIHX(V,D,BIAGRP)=""
"RTN","BIREPD4",198,0)
 ..;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",199,0)
 ..D:BIAGE=13
"RTN","BIREPD4",200,0)
 ...S Z=$G(BITMP("STATS",V,D,1313_BISEX)) S BITMP("STATS",V,D,1313_BISEX)=Z+1
"RTN","BIREPD4",201,0)
 .;
"RTN","BIREPD4",202,0)
 .;---> Okay, not HPV (don't append sex).
"RTN","BIREPD4",203,0)
 .N Z S Z=$G(BITMP("STATS",V,D,BIAGRP)) S BITMP("STATS",V,D,BIAGRP)=Z+1
"RTN","BIREPD4",204,0)
 .S BIHX(V,D,BIAGRP)=""
"RTN","BIREPD4",205,0)
 .;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",206,0)
 .D:BIAGE=13
"RTN","BIREPD4",207,0)
 ..S Z=$G(BITMP("STATS",V,D,1313)) S BITMP("STATS",V,D,1313)=Z+1
"RTN","BIREPD4",208,0)
 .;
"RTN","BIREPD4",209,0)
 .;
"RTN","BIREPD4",210,0)
 .;---> If this is Td and the vaccine was Tdap, add a Tdap line.
"RTN","BIREPD4",211,0)
 .;---> Substitute Vaccine IEN 221 for Vaccine Group.
"RTN","BIREPD4",212,0)
 .Q:(W'=221)  Q:$D(BIHX(221))
"RTN","BIREPD4",213,0)
 .S Z=$G(BITMP("STATS",221,1,BIAGRP)) S BITMP("STATS",221,1,BIAGRP)=Z+1
"RTN","BIREPD4",214,0)
 .;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",215,0)
 .D:BIAGE=13
"RTN","BIREPD4",216,0)
 ..S Z=$G(BITMP("STATS",221,1,1313)) S BITMP("STATS",221,1,1313)=Z+1
"RTN","BIREPD4",217,0)
 .;---> Flag to ensure only 1 dose is counted per patient.
"RTN","BIREPD4",218,0)
 .S BIHX(221)=""
"RTN","BIREPD4",219,0)
 ;
"RTN","BIREPD4",220,0)
 ;---> Now calculate vaccine combination stats.
"RTN","BIREPD4",221,0)
 ;---> NOTE: DO NOT GENERALIZE CODE BELOW (highly iterative).
"RTN","BIREPD4",222,0)
 ;---> Relies on the following Vaccine Group IEN's in ^BISERT:
"RTN","BIREPD4",223,0)
 ;---> 4-HEPB, 6-MMR, 7-VAR, 8-Td_B, 9-HEPA, 16-MEN, 17-HPV
"RTN","BIREPD4",224,0)
 ;
"RTN","BIREPD4",225,0)
 N K
"RTN","BIREPD4",226,0)
 ;
"RTN","BIREPD4",227,0)
 ;---> 1-Td_B, 3-HEPB, 2-MMR, 1-VAR
"RTN","BIREPD4",228,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPD4",229,0)
 .Q:'$D(BIHX(8,1,A))
"RTN","BIREPD4",230,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPD4",231,0)
 .Q:'$D(BIHX(6,2,A))
"RTN","BIREPD4",232,0)
 .;---> Either 1-VAR or Hx of Chicken Pox will count as "1:3:2:1 Current."
"RTN","BIREPD4",233,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPD4",234,0)
 .D COMBO("8|1^4|3^6|2^7|1",A,.BITMP,BIAGE)
"RTN","BIREPD4",235,0)
 .;---> Store for Patient Report Roster (complete 1321).
"RTN","BIREPD4",236,0)
 .;S BIVAL=2
"RTN","BIREPD4",237,0)
 ;
"RTN","BIREPD4",238,0)
 ;---> 1-Td_B, 3-HEPB, 2-MMR, 1-MEN, 2-VAR
"RTN","BIREPD4",239,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPD4",240,0)
 .Q:'$D(BIHX(8,1,A))
"RTN","BIREPD4",241,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPD4",242,0)
 .Q:'$D(BIHX(6,2,A))
"RTN","BIREPD4",243,0)
 .Q:'$D(BIHX(16,1,A))
"RTN","BIREPD4",244,0)
 .Q:'$D(BIHX(7,2,A))
"RTN","BIREPD4",245,0)
 .D COMBO("8|1^4|3^6|2^16|1^7|2",A,.BITMP,BIAGE)
"RTN","BIREPD4",246,0)
 .;---> Store for Patient Report Roster (complete 13212).
"RTN","BIREPD4",247,0)
 .;S BIVAL=2
"RTN","BIREPD4",248,0)
 ;
"RTN","BIREPD4",249,0)
 ;---> 1-Td_B, 1-MEN
"RTN","BIREPD4",250,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPD4",251,0)
 .Q:'$D(BIHX(8,1,A))
"RTN","BIREPD4",252,0)
 .Q:'$D(BIHX(16,1,A))
"RTN","BIREPD4",253,0)
 .D COMBO("8|1^16|1",A,.BITMP,BIAGE)
"RTN","BIREPD4",254,0)
 .;---> Store for Patient Report Roster (complete 11).
"RTN","BIREPD4",255,0)
 .;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD4",256,0)
 .;---> 11 no longer complete.  Now 113, see immediately below.
"RTN","BIREPD4",257,0)
 .;S BIVAL=2
"RTN","BIREPD4",258,0)
 ;
"RTN","BIREPD4",259,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPD4",260,0)
 ;---> Include new "1-Td 1-Men 3-HPV" lines, combined as well as sex specific.
"RTN","BIREPD4",261,0)
 ;---> 1-Td_B, 1-MEN, 3-HPV (because HPV include BISEX).
"RTN","BIREPD4",262,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPD4",263,0)
 .Q:'$D(BIHX(8,1,A))
"RTN","BIREPD4",264,0)
 .Q:'$D(BIHX(16,1,A))
"RTN","BIREPD4",265,0)
 .Q:'$D(BIHX(17,3,A))
"RTN","BIREPD4",266,0)
 .;---> Store both combined and sex specific lines.
"RTN","BIREPD4",267,0)
 .D COMBO("8|1^16|1^17|3",A,.BITMP,BIAGE)
"RTN","BIREPD4",268,0)
 .D COMBO("8|1^16|1^17|3",A_BISEX,.BITMP,BIAGE,BISEX)
"RTN","BIREPD4",269,0)
 .;---> Store for Patient Report Roster (complete 113).
"RTN","BIREPD4",270,0)
 .S BIVAL=2
"RTN","BIREPD4",271,0)
 ;**********
"RTN","BIREPD4",272,0)
 ;
"RTN","BIREPD4",273,0)
 ;
"RTN","BIREPD4",274,0)
 ;---> 1-Td_B, 3-HEPB, 2-MMR, 1-MEN, 2-VAR, 3-HPV (because HPV include BISEX).
"RTN","BIREPD4",275,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPD4",276,0)
 .Q:'$D(BIHX(8,1,A))
"RTN","BIREPD4",277,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPD4",278,0)
 .Q:'$D(BIHX(6,2,A))
"RTN","BIREPD4",279,0)
 .Q:'$D(BIHX(16,1,A))
"RTN","BIREPD4",280,0)
 .Q:'$D(BIHX(7,2,A))
"RTN","BIREPD4",281,0)
 .Q:'$D(BIHX(17,3,A))
"RTN","BIREPD4",282,0)
 .D COMBO("8|1^4|3^6|2^16|1^7|2^17|3",A_BISEX,.BITMP,BIAGE,BISEX)
"RTN","BIREPD4",283,0)
 ;
"RTN","BIREPD4",284,0)
 Q
"RTN","BIREPD4",285,0)
 ;
"RTN","BIREPD4",286,0)
 ;
"RTN","BIREPD4",287,0)
 ;----------
"RTN","BIREPD4",288,0)
COMBO(BICOMB,BIAGRP,BITMP,BIAGE,BISEX) ;EP
"RTN","BIREPD4",289,0)
 ;---> Store Patient vaccine combination for Age Group.
"RTN","BIREPD4",290,0)
 ;---> Parameters:
"RTN","BIREPD4",291,0)
 ;     1 - BICOMB (req) Combination number.
"RTN","BIREPD4",292,0)
 ;     2 - BIAGRP (req) Node/number for this Age Group.
"RTN","BIREPD4",293,0)
 ;     3 - BITMP  (ret) Stores Patient Totals by Age Group and Sex.
"RTN","BIREPD4",294,0)
 ;     4 - BIAGE  (opt) Age of patient (if 13, duplicate stats).
"RTN","BIREPD4",295,0)
 ;     5 - BISEX  (opt) F or M for HPV.
"RTN","BIREPD4",296,0)
 ;
"RTN","BIREPD4",297,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPD4",298,0)
 N Z S Z=$G(BITMP("STATS",BICOMB,BIAGRP))
"RTN","BIREPD4",299,0)
 S BITMP("STATS",BICOMB,BIAGRP)=Z+1
"RTN","BIREPD4",300,0)
 ;---> Duplicate tracking of 13-yr-olds.
"RTN","BIREPD4",301,0)
 D:BIAGE=13
"RTN","BIREPD4",302,0)
 .;---> If this is the HPV combo, include BISEX.
"RTN","BIREPD4",303,0)
 .I ((BIAGRP["F")!(BIAGRP["M")) D  Q
"RTN","BIREPD4",304,0)
 ..S Z=$G(BITMP("STATS",BICOMB,1313_BISEX)) S BITMP("STATS",BICOMB,1313_BISEX)=Z+1
"RTN","BIREPD4",305,0)
 .;
"RTN","BIREPD4",306,0)
 .S Z=$G(BITMP("STATS",BICOMB,1313)) S BITMP("STATS",BICOMB,1313)=Z+1
"RTN","BIREPD4",307,0)
 ;
"RTN","BIREPD4",308,0)
 Q
"RTN","BIREPE")
0^95^B83343944
"RTN","BIREPE",1,0)
BIREPE ;IHS/CMI/MWR - REPORT, VAC ELIGIBILITY; MAY 10, 2010
"RTN","BIREPE",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BIREPE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPE",4,0)
 ;;  VIEW VACCINE ELIGIBILITY REPORT.
"RTN","BIREPE",5,0)
 ;
"RTN","BIREPE",6,0)
 ;
"RTN","BIREPE",7,0)
 ;----------
"RTN","BIREPE",8,0)
START ;EP
"RTN","BIREPE",9,0)
 ;---> Listman Screen for viewing Vaccine Accountability Report.
"RTN","BIREPE",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPE",11,0)
 ;
"RTN","BIREPE",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPE",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPE",14,0)
 ;
"RTN","BIREPE",15,0)
 D EN
"RTN","BIREPE",16,0)
 D EXIT
"RTN","BIREPE",17,0)
 Q
"RTN","BIREPE",18,0)
 ;
"RTN","BIREPE",19,0)
 ;
"RTN","BIREPE",20,0)
 ;----------
"RTN","BIREPE",21,0)
EN ;EP
"RTN","BIREPE",22,0)
 ;---> Main entry point for BI REPORT VAC ELIGIBILITY.
"RTN","BIREPE",23,0)
 D EN^VALM("BI REPORT ELIGIBILITY")
"RTN","BIREPE",24,0)
 Q
"RTN","BIREPE",25,0)
 ;
"RTN","BIREPE",26,0)
 ;
"RTN","BIREPE",27,0)
 ;----------
"RTN","BIREPE",28,0)
INIT ;EP
"RTN","BIREPE",29,0)
 ;---> Initialize variables and list array.
"RTN","BIREPE",30,0)
 K ^TMP("BIREPE",$J)
"RTN","BIREPE",31,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPE",32,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPE",33,0)
 N BILINE,X S BILINE=0
"RTN","BIREPE",34,0)
 D WRITE(.BILINE)
"RTN","BIREPE",35,0)
 S X=IOUON_"VACCINE ELIGIBILITY REPORT"
"RTN","BIREPE",36,0)
 D CENTERT^BIUTL5(.X,42)
"RTN","BIREPE",37,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPE",38,0)
 K X
"RTN","BIREPE",39,0)
 ;
"RTN","BIREPE",40,0)
 ;---> Date Range.
"RTN","BIREPE",41,0)
 S:'$G(BIBEGDT) BIBEGDT=(DT-10000)
"RTN","BIREPE",42,0)
 S:'$G(BIENDDT) BIENDDT=DT
"RTN","BIREPE",43,0)
 ;D DATERNG^BIREP(.BILINE,"BIREPE",1,BIBEGDT,BIENDDT)
"RTN","BIREPE",44,0)
 D DATERNG^BIREP(.BILINE,"BIREPE",1,BIBEGDT,BIENDDT,1,1,1)
"RTN","BIREPE",45,0)
 ;
"RTN","BIREPE",46,0)
 ;---> Current Community.
"RTN","BIREPE",47,0)
 D DISP^BIREP(.BILINE,"BIREPE",.BICC,"Community",2,1,0)
"RTN","BIREPE",48,0)
 ;
"RTN","BIREPE",49,0)
 ;---> Health Care Facility.
"RTN","BIREPE",50,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPE",51,0)
 D DISP^BIREP(.BILINE,"BIREPE",.BIHCF,A,3,2,0,,,B)
"RTN","BIREPE",52,0)
 ;
"RTN","BIREPE",53,0)
 ;---> Case Manager.
"RTN","BIREPE",54,0)
 D DISP^BIREP(.BILINE,"BIREPE",.BICM,"Case Manager",4,3)
"RTN","BIREPE",55,0)
 ;
"RTN","BIREPE",56,0)
 ;---> Beneficiary Type.
"RTN","BIREPE",57,0)
 D DISP^BIREP(.BILINE,"BIREPE",.BIBEN,"Beneficiary Type",5,4,0)
"RTN","BIREPE",58,0)
 ;
"RTN","BIREPE",59,0)
 ;---> Visit Type.
"RTN","BIREPE",60,0)
 D VTYPE^BIREP(.BILINE,"BIREPE",.BIVT,6)
"RTN","BIREPE",61,0)
 ;
"RTN","BIREPE",62,0)
 ;---> Include Historical.
"RTN","BIREPE",63,0)
 N BIHIST1 S BIHIST1=""
"RTN","BIREPE",64,0)
 S:'$D(BIHIST) BIHIST=1
"RTN","BIREPE",65,0)
 S BIHIST1=$S(BIHIST:"YES",1:"NO")
"RTN","BIREPE",66,0)
 S X="     7 - Include Historical.........: "_BIHIST1
"RTN","BIREPE",67,0)
 D WRITE(.BILINE,X)
"RTN","BIREPE",68,0)
 K X
"RTN","BIREPE",69,0)
 ;
"RTN","BIREPE",70,0)
 ;---> Include Adults.
"RTN","BIREPE",71,0)
 N BIU191 S BIU191=""
"RTN","BIREPE",72,0)
 S:'$D(BIU19) BIU19=0
"RTN","BIREPE",73,0)
 S BIU191=$S(BIU19:"YES",1:"NO")
"RTN","BIREPE",74,0)
 S X="     8 - Include Adults (>19 yrs)...: "_BIU191
"RTN","BIREPE",75,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPE",76,0)
 K X
"RTN","BIREPE",77,0)
 ;
"RTN","BIREPE",78,0)
 ;---> Delimiter.
"RTN","BIREPE",79,0)
 N BIDELIM1 S BIDELIM1=""
"RTN","BIREPE",80,0)
 S:'$D(BIDELIM) BIDELIM=2
"RTN","BIREPE",81,0)
 S BIDELIM1=$S(BIDELIM=2:"2 spaces",1:"caret ^")
"RTN","BIREPE",82,0)
 S X="     9 - Delimiter..................: "_BIDELIM1
"RTN","BIREPE",83,0)
 W ! D WRITE(.BILINE,X)
"RTN","BIREPE",84,0)
 K X
"RTN","BIREPE",85,0)
 ;
"RTN","BIREPE",86,0)
 ;---> Display by Lot Number.
"RTN","BIREPE",87,0)
 ;N BIDLOT1 S BIDLOT1=""
"RTN","BIREPE",88,0)
 ;S:'$D(BIDLOT) BIDLOT=0
"RTN","BIREPE",89,0)
 ;S BIDLOT1=$S(BIDLOT:"YES",1:"NO")
"RTN","BIREPE",90,0)
 ;S X="     8 - Display by Lot Number......: "_BIDLOT1
"RTN","BIREPE",91,0)
 ;D WRITE(.BILINE,X)
"RTN","BIREPE",92,0)
 ;K X
"RTN","BIREPE",93,0)
 ;
"RTN","BIREPE",94,0)
 ;
"RTN","BIREPE",95,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPE",96,0)
 S VALMCNT=BILINE
"RTN","BIREPE",97,0)
 S BIRTN="BIREPE"
"RTN","BIREPE",98,0)
 Q
"RTN","BIREPE",99,0)
 ;
"RTN","BIREPE",100,0)
 ;
"RTN","BIREPE",101,0)
 ;----------
"RTN","BIREPE",102,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPE",103,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPE",104,0)
 ;---> Parameters:
"RTN","BIREPE",105,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPE",106,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPE",107,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPE",108,0)
 ;
"RTN","BIREPE",109,0)
 Q:'$D(BILINE)
"RTN","BIREPE",110,0)
 D WL^BIW(.BILINE,"BIREPE",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPE",111,0)
 Q
"RTN","BIREPE",112,0)
 ;
"RTN","BIREPE",113,0)
 ;
"RTN","BIREPE",114,0)
 ;----------
"RTN","BIREPE",115,0)
RESET ;EP
"RTN","BIREPE",116,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPE",117,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPE",118,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPE",119,0)
 ;
"RTN","BIREPE",120,0)
 ;---> NOT USED.  Could be used to correct margins.
"RTN","BIREPE",121,0)
 ;K VALMHDR S VALM("BM")=15,VALM("LINES")=14,VALM("TM")=2
"RTN","BIREPE",122,0)
 D INIT
"RTN","BIREPE",123,0)
 Q
"RTN","BIREPE",124,0)
 ;
"RTN","BIREPE",125,0)
 ;
"RTN","BIREPE",126,0)
 ;----------
"RTN","BIREPE",127,0)
HELP ;EP
"RTN","BIREPE",128,0)
 ;---> Help code.
"RTN","BIREPE",129,0)
 N BIX S BIX=X
"RTN","BIREPE",130,0)
 D FULL^VALM1
"RTN","BIREPE",131,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPE",132,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPE",133,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPE",134,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPE",135,0)
 Q
"RTN","BIREPE",136,0)
 ;
"RTN","BIREPE",137,0)
 ;
"RTN","BIREPE",138,0)
 ;----------
"RTN","BIREPE",139,0)
HELP1 ;EP
"RTN","BIREPE",140,0)
 ;----> Explanation of this report.
"RTN","BIREPE",141,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPE",142,0)
 D START^BIHELP("VACCINE ELIGIBILITY REPORT - HELP",.BITEXT)
"RTN","BIREPE",143,0)
 Q
"RTN","BIREPE",144,0)
 ;
"RTN","BIREPE",145,0)
 ;
"RTN","BIREPE",146,0)
 ;----------
"RTN","BIREPE",147,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPE",148,0)
 ;;The Vaccine Eligibility Report provides a listing of doses
"RTN","BIREPE",149,0)
 ;;administered by date and patient information, along with the
"RTN","BIREPE",150,0)
 ;;patient eligibility recorded for that visit.  Lot Number is also
"RTN","BIREPE",151,0)
 ;;displayed.  This report can be printed for any time period, for
"RTN","BIREPE",152,0)
 ;;a given facility, visit type, or community(s).
"RTN","BIREPE",153,0)
 ;;
"RTN","BIREPE",154,0)
 ;;There are 9 items or "parameters" on the screen that you may
"RTN","BIREPE",155,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPE",156,0)
 ;;To change an item, enter its left column number (1-8) at the
"RTN","BIREPE",157,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPE",158,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPE",159,0)
 ;;changing.
"RTN","BIREPE",160,0)
 ;;
"RTN","BIREPE",161,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPE",162,0)
 ;;you want, select V to View the Vaccine Elig Report or P to print it.
"RTN","BIREPE",163,0)
 ;;
"RTN","BIREPE",164,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPE",165,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPE",166,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPE",167,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPE",168,0)
 ;;
"RTN","BIREPE",169,0)
 ;;DATE RANGE: Only immunizations given within the Date Range you
"RTN","BIREPE",170,0)
 ;;select will be included in the report.
"RTN","BIREPE",171,0)
 ;;
"RTN","BIREPE",172,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPE",173,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPE",174,0)
 ;;be included in the report.  "Current Community" refers to Item 6
"RTN","BIREPE",175,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPE",176,0)
 ;;
"RTN","BIREPE",177,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIREPE",178,0)
 ;;Facilities, only immunizations given at the selected Health Care
"RTN","BIREPE",179,0)
 ;;Facilities will be included in the report.
"RTN","BIREPE",180,0)
 ;;
"RTN","BIREPE",181,0)
 ;;CASE MANAGERS: If you select for specific Case Managers, only
"RTN","BIREPE",182,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPE",183,0)
 ;;in the report.
"RTN","BIREPE",184,0)
 ;;
"RTN","BIREPE",185,0)
 ;;BENEFICIARY TYPES: If you select for specific Beneficiary Types,
"RTN","BIREPE",186,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPE",187,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPE",188,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPE",189,0)
 ;;
"RTN","BIREPE",190,0)
 ;;VISIT TYPES: If you select for specific Visit Types, only visits
"RTN","BIREPE",191,0)
 ;;that are classifed with one of the Visit Types you select will
"RTN","BIREPE",192,0)
 ;;included in the report.
"RTN","BIREPE",193,0)
 ;;
"RTN","BIREPE",194,0)
 ;;INCLUDE HISTORICAL: If this parameter is set to "YES", then Visits
"RTN","BIREPE",195,0)
 ;;with a Category of "Historical" will be counted in the Vaccine
"RTN","BIREPE",196,0)
 ;;Eligibility Report.  (Category is displayed and edited on the
"RTN","BIREPE",197,0)
 ;;ADD/EDIT IMMUNIZATION VISIT Screen.)  If set to "NO", they will
"RTN","BIREPE",198,0)
 ;;not be counted in the report.
"RTN","BIREPE",199,0)
 ;;
"RTN","BIREPE",200,0)
 ;;INCLUDE ADULTS: If this parameter is set to "YES", then immunizations
"RTN","BIREPE",201,0)
 ;;given when the patietn was age 19 years or older will be included.
"RTN","BIREPE",202,0)
 ;;Otherwise, only immunizations given when the patient was younger
"RTN","BIREPE",203,0)
 ;;than 19 years of age will be included.
"RTN","BIREPE",204,0)
 ;;
"RTN","BIREPE",205,0)
 ;;DELIMITER: This parameter allows you to select the character that
"RTN","BIREPE",206,0)
 ;;will separate the 6 fields in each record displayed by the report.
"RTN","BIREPE",207,0)
 ;;The default delimiter is "2 spaces".  However, when the intention is
"RTN","BIREPE",208,0)
 ;;to print or copy the report to a text file for the purpose of importing
"RTN","BIREPE",209,0)
 ;;it into Excel or some other spreadsheet, use of the caret "^" is
"RTN","BIREPE",210,0)
 ;;preferable and recommended. (Spaces in the data itself might sometimes
"RTN","BIREPE",211,0)
 ;;be confused with spaces in the delimiter and/or spaces used to make the
"RTN","BIREPE",212,0)
 ;;columns line up.)
"RTN","BIREPE",213,0)
 ;;
"RTN","BIREPE",214,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPE",215,0)
 Q
"RTN","BIREPE",216,0)
 ;
"RTN","BIREPE",217,0)
 ;;DISPLAY BY LOT NUMBERS: The report lists the statistics by age for
"RTN","BIREPE",218,0)
 ;;each vaccine.  However, you may elect to display the statistics for
"RTN","BIREPE",219,0)
 ;;each separate lot number under each vaccine.  The totals for all
"RTN","BIREPE",220,0)
 ;;lot numbers of each vaccine will also be displayed.
"RTN","BIREPE",221,0)
 ;;
"RTN","BIREPE",222,0)
 ;
"RTN","BIREPE",223,0)
 ;
"RTN","BIREPE",224,0)
 ;----------
"RTN","BIREPE",225,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPE",226,0)
 Q:$G(BILINL)=""
"RTN","BIREPE",227,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPE",228,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPE",229,0)
 Q
"RTN","BIREPE",230,0)
 ;
"RTN","BIREPE",231,0)
 ;
"RTN","BIREPE",232,0)
 ;----------
"RTN","BIREPE",233,0)
EXIT ;EP
"RTN","BIREPE",234,0)
 ;---> End of job cleanup.
"RTN","BIREPE",235,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPE",236,0)
 K ^TMP("BIREPE",$J)
"RTN","BIREPE",237,0)
 D CLEAR^VALM1
"RTN","BIREPE",238,0)
 Q
"RTN","BIREPE1")
0^96^B12952198
"RTN","BIREPE1",1,0)
BIREPE1 ;IHS/CMI/MWR - REPORT, VAC ELIGIBILITY; MAY 10, 2010
"RTN","BIREPE1",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BIREPE1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPE1",4,0)
 ;;  VIEW OR PRINT VACCINE ELIGIBILITY REPORT.
"RTN","BIREPE1",5,0)
 ;
"RTN","BIREPE1",6,0)
 ;
"RTN","BIREPE1",7,0)
 ;----------
"RTN","BIREPE1",8,0)
START(BIX) ;EP
"RTN","BIREPE1",9,0)
 ;---> Prepare and display or print Vaccine Accountability Report.
"RTN","BIREPE1",10,0)
 ;---> Parameters:
"RTN","BIREPE1",11,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Report.
"RTN","BIREPE1",12,0)
 ;                      If BIX="VIEW", then view Report (default).
"RTN","BIREPE1",13,0)
 ;                      If BIX="LOTS", then view Report by individual lot numbers.
"RTN","BIREPE1",14,0)
 ;---> Variables:
"RTN","BIREPE1",15,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPE1",16,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPE1",17,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPE1",18,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPE1",19,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPE1",20,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPE1",21,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPE1",22,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPE1",23,0)
 ;     9 - BIU19   (req) Include Adults parameter (1=yes,0=no).
"RTN","BIREPE1",24,0)
 ;    10 - BIDELIM (req) Deliniter (1="caret ^", 2="2 spaces").
"RTN","BIREPE1",25,0)
 ;
"RTN","BIREPE1",26,0)
 ;---> Check for required Variables.
"RTN","BIREPE1",27,0)
 I '$G(BIBEGDT) D ERROR(626) D RESET^BIREPE Q
"RTN","BIREPE1",28,0)
 I '$G(BIENDDT) D ERROR(627) D RESET^BIREPE Q
"RTN","BIREPE1",29,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPE Q
"RTN","BIREPE1",30,0)
 I '$D(BIHCF) D ERROR(625) D RESET^BIREPE Q
"RTN","BIREPE1",31,0)
 I '$D(BICM) D ERROR(615) D RESET^BIREPE Q
"RTN","BIREPE1",32,0)
 I '$D(BIBEN) D ERROR(662) D RESET^BIREPE Q
"RTN","BIREPE1",33,0)
 I '$D(BIHIST) D ERROR(663) D RESET^BIREPE Q
"RTN","BIREPE1",34,0)
 I '$D(BIVT) D ERROR(664) D RESET^BIREPE Q
"RTN","BIREPE1",35,0)
 I '$D(BIU19) D ERROR(682) D RESET^BIREPE Q
"RTN","BIREPE1",36,0)
 I '$D(BIDELIM) D ERROR(683) D RESET^BIREPE Q
"RTN","BIREPE1",37,0)
 ;I '$D(BIDLOT) S BIDLOT=0
"RTN","BIREPE1",38,0)
 ;
"RTN","BIREPE1",39,0)
 D SETVARS^BIUTL5 K ^TMP("BIDUL",$J)
"RTN","BIREPE1",40,0)
 N VALMCNT
"RTN","BIREPE1",41,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPE Q
"RTN","BIREPE1",42,0)
 D EN
"RTN","BIREPE1",43,0)
 Q
"RTN","BIREPE1",44,0)
 ;
"RTN","BIREPE1",45,0)
 ;
"RTN","BIREPE1",46,0)
 ;----------
"RTN","BIREPE1",47,0)
PRINT ;EP
"RTN","BIREPE1",48,0)
 ;---> Main entry point for printing the Quarterly Immunization Report.
"RTN","BIREPE1",49,0)
 D DEVICE(.BIPOP)
"RTN","BIREPE1",50,0)
 Q:$G(BIPOP)
"RTN","BIREPE1",51,0)
 ;
"RTN","BIREPE1",52,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPE1",53,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPE1",54,0)
 ;
"RTN","BIREPE1",55,0)
 ;---> Prepare report.
"RTN","BIREPE1",56,0)
 K VALMHDR,^TMP("BIREPE1",$J)
"RTN","BIREPE1",57,0)
 N VALM,VALMHDR
"RTN","BIREPE1",58,0)
 D GET^BIREPE2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIU19,BIDELIM)
"RTN","BIREPE1",59,0)
 D HDR
"RTN","BIREPE1",60,0)
 ;
"RTN","BIREPE1",61,0)
 D PRTLST^BIUTL8("BIREPE1")
"RTN","BIREPE1",62,0)
 D EXIT,RESET^BIREPE
"RTN","BIREPE1",63,0)
 Q
"RTN","BIREPE1",64,0)
 ;
"RTN","BIREPE1",65,0)
 ;
"RTN","BIREPE1",66,0)
 ;----------
"RTN","BIREPE1",67,0)
EN ;EP
"RTN","BIREPE1",68,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIREPE1",69,0)
 D EN^VALM("BI REPORT ELIGIBILITY1")
"RTN","BIREPE1",70,0)
 Q
"RTN","BIREPE1",71,0)
 ;
"RTN","BIREPE1",72,0)
 ;
"RTN","BIREPE1",73,0)
 ;----------
"RTN","BIREPE1",74,0)
HDR ;EP
"RTN","BIREPE1",75,0)
 ;---> Header code
"RTN","BIREPE1",76,0)
 D HEAD^BIREPE2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIU19)
"RTN","BIREPE1",77,0)
 Q
"RTN","BIREPE1",78,0)
 ;
"RTN","BIREPE1",79,0)
 ;
"RTN","BIREPE1",80,0)
 ;----------
"RTN","BIREPE1",81,0)
INIT ;EP
"RTN","BIREPE1",82,0)
 ;---> Initialize variables and list array.
"RTN","BIREPE1",83,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPE1",84,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPE1",85,0)
 D GET^BIREPE2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIU19,BIDELIM)
"RTN","BIREPE1",86,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPE1",87,0)
 D ZSAVES^BIUTL3
"RTN","BIREPE1",88,0)
 Q
"RTN","BIREPE1",89,0)
 ;
"RTN","BIREPE1",90,0)
 ;
"RTN","BIREPE1",91,0)
 ;----------
"RTN","BIREPE1",92,0)
RESET ;EP
"RTN","BIREPE1",93,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPE1",94,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPE1",95,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPE1",96,0)
 D INIT,HDR Q
"RTN","BIREPE1",97,0)
 ;
"RTN","BIREPE1",98,0)
 ;
"RTN","BIREPE1",99,0)
 ;----------
"RTN","BIREPE1",100,0)
HELP ;EP
"RTN","BIREPE1",101,0)
 ;---> Help code.
"RTN","BIREPE1",102,0)
 N BIX S BIX=X
"RTN","BIREPE1",103,0)
 D FULL^VALM1
"RTN","BIREPE1",104,0)
 W !!?5,"Use arrow keys to scroll up and down through the report, or"
"RTN","BIREPE1",105,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIREPE1",106,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPE1",107,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPE1",108,0)
 Q
"RTN","BIREPE1",109,0)
 ;
"RTN","BIREPE1",110,0)
 ;
"RTN","BIREPE1",111,0)
 ;----------
"RTN","BIREPE1",112,0)
EXIT ;EP
"RTN","BIREPE1",113,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPE1",114,0)
 K ^TMP("BIREPE1",$J)  K ^TMP("BIDUL",$J)
"RTN","BIREPE1",115,0)
 D CLEAR^VALM1
"RTN","BIREPE1",116,0)
 D FULL^VALM1
"RTN","BIREPE1",117,0)
 Q
"RTN","BIREPE1",118,0)
 ;
"RTN","BIREPE1",119,0)
 ;
"RTN","BIREPE1",120,0)
 ;----------
"RTN","BIREPE1",121,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPE1",122,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPE1",123,0)
 ;---> Parameters:
"RTN","BIREPE1",124,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPE1",125,0)
 ;
"RTN","BIREPE1",126,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPE1",127,0)
 S ZTRTN="DEQUEUE^BIREPE1"
"RTN","BIREPE1",128,0)
 D ZSAVES^BIUTL3
"RTN","BIREPE1",129,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPE1",130,0)
 Q
"RTN","BIREPE1",131,0)
 ;
"RTN","BIREPE1",132,0)
 ;
"RTN","BIREPE1",133,0)
 ;----------
"RTN","BIREPE1",134,0)
DEQUEUE ;EP
"RTN","BIREPE1",135,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIREPE1",136,0)
 K VALMHDR,^TMP("BIREPE1",$J)
"RTN","BIREPE1",137,0)
 D HDR
"RTN","BIREPE1",138,0)
 D GET^BIREPE2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIU19,BIDELIM)
"RTN","BIREPE1",139,0)
 D PRTLST^BIUTL8("BIREPE1"),EXIT
"RTN","BIREPE1",140,0)
 Q
"RTN","BIREPE1",141,0)
 ;
"RTN","BIREPE1",142,0)
 ;
"RTN","BIREPE1",143,0)
 ;----------
"RTN","BIREPE1",144,0)
ERROR(BIERR) ;EP
"RTN","BIREPE1",145,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPE1",146,0)
 ;---> Parameters:
"RTN","BIREPE1",147,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPE1",148,0)
 ;
"RTN","BIREPE1",149,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPE1",150,0)
 Q
"RTN","BIREPE2")
0^97^B59055814
"RTN","BIREPE2",1,0)
BIREPE2 ;IHS/CMI/MWR - REPORT, VAC ELIGIBILITY; MAY 10, 2010
"RTN","BIREPE2",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BIREPE2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPE2",4,0)
 ;;  VIEW OR PRINT VACCINE ELIGIBILITY REPORT.
"RTN","BIREPE2",5,0)
 ;
"RTN","BIREPE2",6,0)
 ;----------
"RTN","BIREPE2",7,0)
HEAD(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT,BIU19) ;EP
"RTN","BIREPE2",8,0)
 ;---> Produce Header array for Vaccine Accountability Report.
"RTN","BIREPE2",9,0)
 ;---> Parameters:
"RTN","BIREPE2",10,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPE2",11,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPE2",12,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPE2",13,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPE2",14,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPE2",15,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPE2",16,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPE2",17,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPE2",18,0)
 ;     9 - BIU19   (req) Include Adults parameter (1=yes,0=no).
"RTN","BIREPE2",19,0)
 ;
"RTN","BIREPE2",20,0)
 ;---> Check for required Variables.
"RTN","BIREPE2",21,0)
 Q:'$G(BIBEGDT)
"RTN","BIREPE2",22,0)
 Q:'$G(BIENDDT)
"RTN","BIREPE2",23,0)
 Q:'$D(BICC)
"RTN","BIREPE2",24,0)
 Q:'$D(BIHCF)
"RTN","BIREPE2",25,0)
 Q:'$D(BICM)
"RTN","BIREPE2",26,0)
 Q:'$D(BIBEN)
"RTN","BIREPE2",27,0)
 Q:'$D(BIHIST)
"RTN","BIREPE2",28,0)
 Q:'$D(BIVT)
"RTN","BIREPE2",29,0)
 Q:'$D(BIU19)
"RTN","BIREPE2",30,0)
 ;
"RTN","BIREPE2",31,0)
 K VALMHDR
"RTN","BIREPE2",32,0)
 N BILINE,X S BILINE=0
"RTN","BIREPE2",33,0)
 ;
"RTN","BIREPE2",34,0)
 N X S X=""
"RTN","BIREPE2",35,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPE2",36,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPE2",37,0)
 ;
"RTN","BIREPE2",38,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPE2",39,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPE2",40,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPE2",41,0)
 ;
"RTN","BIREPE2",42,0)
 S X="*  Vaccine Eligibility Report  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPE2",43,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPE2",44,0)
 ;
"RTN","BIREPE2",45,0)
 ;S X=$$TXDT1^BIUTL5(DT) D CENTERT^BIUTL5(.X)
"RTN","BIREPE2",46,0)
 ;D WH^BIW(.BILINE,X,1)
"RTN","BIREPE2",47,0)
 ;
"RTN","BIREPE2",48,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPE2",49,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPE2",50,0)
 ;
"RTN","BIREPE2",51,0)
 S X=$$SP^BIUTL5(28)_"Date Range: "_$$SLDT1^BIUTL5(BIBEGDT)_" - "_$$SLDT1^BIUTL5(BIENDDT)
"RTN","BIREPE2",52,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPE2",53,0)
 ;
"RTN","BIREPE2",54,0)
 S X=" (Historical "_$S(BIHIST:"In",1:"Ex")_"cluded"
"RTN","BIREPE2",55,0)
 S X=X_", Adults "_$S(BIU19:"In",1:"Ex")_"cluded)"
"RTN","BIREPE2",56,0)
 ;
"RTN","BIREPE2",57,0)
 S X=X_$J("Total Immunizations: "_+$G(^TMP("BIDUL",$J,"TOTAL")),40)
"RTN","BIREPE2",58,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPE2",59,0)
 S X=$$SP^BIUTL5(79,"-")
"RTN","BIREPE2",60,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPE2",61,0)
 ;
"RTN","BIREPE2",62,0)
 D
"RTN","BIREPE2",63,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPE2",64,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPE2",65,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPE2",66,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPE2",67,0)
 .;
"RTN","BIREPE2",68,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPE2",69,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPE2",70,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPE2",71,0)
 .;
"RTN","BIREPE2",72,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPE2",73,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPE2",74,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPE2",75,0)
 .;
"RTN","BIREPE2",76,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPE2",77,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPE2",78,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPE2",79,0)
 .;
"RTN","BIREPE2",80,0)
 .;---> If specific Visit Types, print Visit  Type subheader.
"RTN","BIREPE2",81,0)
 .D SUBH^BIOUTPT5("BIVT","Visit Type",,"9000010-.03",.BILINE,.BIERR,,12)
"RTN","BIREPE2",82,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPE2",83,0)
 .;
"RTN","BIREPE2",84,0)
 .S X="   Date    Last,First Name   DOB    Eligibility  Vaccine      Lot#"
"RTN","BIREPE2",85,0)
 .;S X=X_"65+  TOTAL"
"RTN","BIREPE2",86,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPE2",87,0)
 ;
"RTN","BIREPE2",88,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPE2",89,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPE2",90,0)
 D:$D(VALM("BM"))
"RTN","BIREPE2",91,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPE2",92,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPE2",93,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPE2",94,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPE2",95,0)
 Q
"RTN","BIREPE2",96,0)
 ;
"RTN","BIREPE2",97,0)
 ;
"RTN","BIREPE2",98,0)
 ;----------
"RTN","BIREPE2",99,0)
GET(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT,BIU19,BIDELIM) ;EP
"RTN","BIREPE2",100,0)
 ;----------
"RTN","BIREPE2",101,0)
 ;---> Produce array for Vaccine Accountability Report.
"RTN","BIREPE2",102,0)
 ;---> Parameters:
"RTN","BIREPE2",103,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPE2",104,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPE2",105,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPE2",106,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPE2",107,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPE2",108,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPE2",109,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPE2",110,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPE2",111,0)
 ;     9 - BIU19   (req) Include Adults parameter (1=yes,0=no).
"RTN","BIREPE2",112,0)
 ;    10 - BIDELIM (req) Deliniter (1="caret ^", 2="2 spaces").
"RTN","BIREPE2",113,0)
 ;
"RTN","BIREPE2",114,0)
 ;   * NOT USED FOR NOW
"RTN","BIREPE2",115,0)
 ;     X - BIDLOT  (req) If BIDLOT=1, display by Lot Numbers.
"RTN","BIREPE2",116,0)
 ;
"RTN","BIREPE2",117,0)
 K ^TMP("BIREPE1",$J)
"RTN","BIREPE2",118,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPE2",119,0)
 ;
"RTN","BIREPE2",120,0)
 ;---> Check for required Variables.
"RTN","BIREPE2",121,0)
 I '$G(BIBEGDT) D ERRCD^BIUTL2(626,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",122,0)
 I '$G(BIENDDT) D ERRCD^BIUTL2(627,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",123,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",124,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",125,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",126,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",127,0)
 I '$D(BIHIST) D ERRCD^BIUTL2(663,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",128,0)
 I '$D(BIVT) D ERRCD^BIUTL2(664,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",129,0)
 I '$D(BIU19) D ERRCD^BIUTL2(682,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",130,0)
 I '$D(BIDELIM) D ERRCD^BIUTL2(683,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",131,0)
 ;I '$D(BIDLOT) D ERRCD^BIUTL2(681,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPE2",132,0)
 ;
"RTN","BIREPE2",133,0)
 ;---> Gather data.
"RTN","BIREPE2",134,0)
 D GETIMMS^BIREPE3(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIU19)
"RTN","BIREPE2",135,0)
 ;
"RTN","BIREPE2",136,0)
 S BIDELIM=$S(BIDELIM=1:"^",1:"  ")
"RTN","BIREPE2",137,0)
 N BILINE S BILINE=0
"RTN","BIREPE2",138,0)
 ;S ^TMP("BIDUL",$J,BIDATE,BINAME,BIIIEN)=BIVAL
"RTN","BIREPE2",139,0)
 N BIDATE S BIDATE=0
"RTN","BIREPE2",140,0)
 F  S BIDATE=$O(^TMP("BIDUL",$J,BIDATE)) Q:'BIDATE  D
"RTN","BIREPE2",141,0)
 .N BINAME S BINAME=""
"RTN","BIREPE2",142,0)
 .F  S BINAME=$O(^TMP("BIDUL",$J,BIDATE,BINAME)) Q:(BINAME="")  D
"RTN","BIREPE2",143,0)
 ..N BIIIEN S BIIIEN=0
"RTN","BIREPE2",144,0)
 ..F  S BIIIEN=$O(^TMP("BIDUL",$J,BIDATE,BINAME,BIIIEN)) Q:'BIIIEN  D
"RTN","BIREPE2",145,0)
 ...N W,X,Y,Z S Y=^TMP("BIDUL",$J,BIDATE,BINAME,BIIIEN)
"RTN","BIREPE2",146,0)
 ...S Z=BIDELIM S X=$S(Z="  ":" ",1:"")
"RTN","BIREPE2",147,0)
 ...;S X=X_$P(Y,U)_Z_$$PAD^BIUTL5($E($P(Y,U,2),1,14),14)_Z_$P(Y,U,3)
"RTN","BIREPE2",148,0)
 ...;S X=X_Z_$$PAD^BIUTL5($P(Y,U,4),9)_Z_$$PAD^BIUTL5($P(Y,U,5),10)_Z_$P(Y,U,6)
"RTN","BIREPE2",149,0)
 ...;
"RTN","BIREPE2",150,0)
 ...S X=X_$P(Y,U)_Z
"RTN","BIREPE2",151,0)
 ...S W=$E($P(Y,U,2),1,14) I Z'="^" S W=$$PAD^BIUTL5(W,14)
"RTN","BIREPE2",152,0)
 ...S X=X_W_Z_$P(Y,U,3)_Z
"RTN","BIREPE2",153,0)
 ...S W=$P(Y,U,4) I Z'="^" S W=$$PAD^BIUTL5(W,9)
"RTN","BIREPE2",154,0)
 ...S X=X_W_Z
"RTN","BIREPE2",155,0)
 ...S W=$P(Y,U,5) I Z'="^" S W=$$PAD^BIUTL5(W,10)
"RTN","BIREPE2",156,0)
 ...S X=X_W_Z_$P(Y,U,6)
"RTN","BIREPE2",157,0)
 ...;;
"RTN","BIREPE2",158,0)
 ...;S X=X_Z_$$PAD^BIUTL5($P(Y,U,4),9)_Z_$$PAD^BIUTL5($P(Y,U,5),10)_Z_$P(Y,U,6)
"RTN","BIREPE2",159,0)
 ...D WRITE(.BILINE,X)
"RTN","BIREPE2",160,0)
 ;
"RTN","BIREPE2",161,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPE2",162,0)
 S VALMCNT=BILINE
"RTN","BIREPE2",163,0)
 Q
"RTN","BIREPE2",164,0)
 ;
"RTN","BIREPE2",165,0)
 ;*** NOT USED ***
"RTN","BIREPE2",166,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPE2",167,0)
 ;---> BIG=Vaccine Group, BIV=Vaccine Name, BIA=Age.
"RTN","BIREPE2",168,0)
 N BILINE S BILINE=0
"RTN","BIREPE2",169,0)
 N BIG S BIG=0
"RTN","BIREPE2",170,0)
 F  S BIG=$O(BITMP("STATS",BIG)) Q:'BIG  D
"RTN","BIREPE2",171,0)
 .N BIV S BIV=0
"RTN","BIREPE2",172,0)
 .F  S BIV=$O(BITMP("STATS",BIG,BIV)) Q:BIV=""  D
"RTN","BIREPE2",173,0)
 ..;
"RTN","BIREPE2",174,0)
 ..N BILSAV,X
"RTN","BIREPE2",175,0)
 ..;
"RTN","BIREPE2",176,0)
 ..;---> Write Vaccine Name line.
"RTN","BIREPE2",177,0)
 ..S X=BIV
"RTN","BIREPE2",178,0)
 ..I $G(BIDLOT) S X=X_" - All Lots"
"RTN","BIREPE2",179,0)
 ..D CENTERT^BIUTL5(.X)
"RTN","BIREPE2",180,0)
 ..;---> Save this line# for marking as a single record to print.
"RTN","BIREPE2",181,0)
 ..D WRITE(.BILINE,X) S BILSAV=BILINE
"RTN","BIREPE2",182,0)
 ..;
"RTN","BIREPE2",183,0)
 ..;---> Build Age Totals line for this vaccine.
"RTN","BIREPE2",184,0)
 ..;S X=$$SUML() D WRITE(.BILINE,X)
"RTN","BIREPE2",185,0)
 ..S X="" N BIA
"RTN","BIREPE2",186,0)
 ..F BIA=1:1:12 S X=X_$J($G(BITMP("STATS",BIG,BIV,"ALL",BIA)),6)
"RTN","BIREPE2",187,0)
 ..;---> Now concat Total column (for this vaccine row).
"RTN","BIREPE2",188,0)
 ..S X=X_$J($G(BITMP("STATS",BIG,BIV,"ALL","TOTAL")),7)
"RTN","BIREPE2",189,0)
 ..D WRITE(.BILINE,X)
"RTN","BIREPE2",190,0)
 ..D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPE2",191,0)
 ..;---> Now mark the top line of this vaccine to print as one record.
"RTN","BIREPE2",192,0)
 ..D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPE1")
"RTN","BIREPE2",193,0)
 ..;
"RTN","BIREPE2",194,0)
 ..Q:'$G(BIDLOT)
"RTN","BIREPE2",195,0)
 ..;---> Display rows by individual Lot Number.
"RTN","BIREPE2",196,0)
 ..N BIL S BIL=0
"RTN","BIREPE2",197,0)
 ..F  S BIL=$O(BITMP("STATS",BIG,BIV,BIL)) Q:BIL=""  D
"RTN","BIREPE2",198,0)
 ...Q:(BIL="ALL")
"RTN","BIREPE2",199,0)
 ...;---> Write Vaccine Name with Lot Number concatenated.
"RTN","BIREPE2",200,0)
 ...S X=BIV_" - "_BIL D CENTERT^BIUTL5(.X)
"RTN","BIREPE2",201,0)
 ...D WRITE(.BILINE,X) S BILSAV=BILINE
"RTN","BIREPE2",202,0)
 ...;S X=$$SUML() D WRITE(.BILINE,X)
"RTN","BIREPE2",203,0)
 ...S X="" N BIA
"RTN","BIREPE2",204,0)
 ...F BIA=1:1:12 S X=X_$J($G(BITMP("STATS",BIG,BIV,BIL,BIA)),6)
"RTN","BIREPE2",205,0)
 ...S X=X_$J($G(BITMP("STATS",BIG,BIV,BIL,"TOTAL")),7)
"RTN","BIREPE2",206,0)
 ...D WRITE(.BILINE,X)
"RTN","BIREPE2",207,0)
 ...D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPE2",208,0)
 ...D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPE1")
"RTN","BIREPE2",209,0)
 ...;
"RTN","BIREPE2",210,0)
 ...;---> Now mark the top line of this vaccine to print as one record.
"RTN","BIREPE2",211,0)
 ...D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPE1")
"RTN","BIREPE2",212,0)
 ;
"RTN","BIREPE2",213,0)
 ;---> Now write total in .
"RTN","BIREPE2",214,0)
 S X=" TOTAL IMMUNIZATIONS (for all vaccines in this report)"
"RTN","BIREPE2",215,0)
 S X=X_$$SP^BIUTL5(16)_$J(+$G(BITMP("STATS","ALL","TOTAL")),9)
"RTN","BIREPE2",216,0)
 D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPE2",217,0)
 ;
"RTN","BIREPE2",218,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPE2",219,0)
 ;---> Not desired on this report, per Ros 10-12-05
"RTN","BIREPE2",220,0)
 ;N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPE2",221,0)
 ;S X=" Total Patients included who had Refusals on record"_$J(N,28)
"RTN","BIREPE2",222,0)
 ;D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPE2",223,0)
 ;
"RTN","BIREPE2",224,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPE2",225,0)
 S VALMCNT=BILINE
"RTN","BIREPE2",226,0)
 Q
"RTN","BIREPE2",227,0)
 ;
"RTN","BIREPE2",228,0)
 ;
"RTN","BIREPE2",229,0)
 ;----------
"RTN","BIREPE2",230,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPE2",231,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPE2",232,0)
 ;---> Parameters:
"RTN","BIREPE2",233,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPE2",234,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPE2",235,0)
 ;
"RTN","BIREPE2",236,0)
 Q:'$D(BILINE)
"RTN","BIREPE2",237,0)
 D WL^BIW(.BILINE,"BIREPE1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPE2",238,0)
 ;
"RTN","BIREPE2",239,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPE2",240,0)
 S VALMCNT=BILINE
"RTN","BIREPE2",241,0)
 Q
"RTN","BIREPE3")
0^98^B19789610
"RTN","BIREPE3",1,0)
BIREPE3 ;IHS/CMI/MWR - REPORT, VAC ELIGIBILITY; MAY 10, 2010
"RTN","BIREPE3",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPE3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPE3",4,0)
 ;;  VIEW OR PRINT VACCINE ELIGIBILITY REPORT.
"RTN","BIREPE3",5,0)
 ;;  PATCH 3: Return Eligibility values from BI TABLE ELIGIBILITY File. ELIGC+5
"RTN","BIREPE3",6,0)
 ;
"RTN","BIREPE3",7,0)
 ;
"RTN","BIREPE3",8,0)
 ;----------
"RTN","BIREPE3",9,0)
GETIMMS(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT,BIU19) ;EP
"RTN","BIREPE3",10,0)
 ;---> Get Immunizations from V Files.
"RTN","BIREPE3",11,0)
 ;---> Parameters:
"RTN","BIREPE3",12,0)
 ;     1 - BIBEGDT (req) Begin Visit Date.
"RTN","BIREPE3",13,0)
 ;     2 - BIENDDT (req) End Visit Date.
"RTN","BIREPE3",14,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPE3",15,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPE3",16,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPE3",17,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPE3",18,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPE3",19,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPE3",20,0)
 ;     9 - BIU19   (req) Include Adults parameter (1=yes,0=no).
"RTN","BIREPE3",21,0)
 ;
"RTN","BIREPE3",22,0)
 ;---> Set begin and end dates for search through V Immunization File.
"RTN","BIREPE3",23,0)
 ;
"RTN","BIREPE3",24,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)
"RTN","BIREPE3",25,0)
 S ^TMP("BIDUL",$J,"TOTAL")=0
"RTN","BIREPE3",26,0)
 N N S N=BIBEGDT-.9999
"RTN","BIREPE3",27,0)
 F  S N=$O(^AUPNVIMM("ADT",N)) Q:(N>(BIENDDT+.9999)!('N))  D
"RTN","BIREPE3",28,0)
 .N M S M=0
"RTN","BIREPE3",29,0)
 .F  S M=$O(^AUPNVIMM("ADT",N,M)) Q:'M  D
"RTN","BIREPE3",30,0)
 ..N P S P=0
"RTN","BIREPE3",31,0)
 ..F  S P=$O(^AUPNVIMM("ADT",N,M,P)) Q:'P  D
"RTN","BIREPE3",32,0)
 ...D CHKSET(N,M,P,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIU19)
"RTN","BIREPE3",33,0)
 Q
"RTN","BIREPE3",34,0)
 ;
"RTN","BIREPE3",35,0)
 ;
"RTN","BIREPE3",36,0)
 ;----------
"RTN","BIREPE3",37,0)
CHKSET(BIDATE,BIVIEN,BIIIEN,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT,BIU19) ;EP
"RTN","BIREPE3",38,0)
 ;---> Check if this visit fits criteria; if so, set it
"RTN","BIREPE3",39,0)
 ;---> in ^TMP("BIREPE1".
"RTN","BIREPE3",40,0)
 ;---> Parameters:
"RTN","BIREPE3",41,0)
 ;     1 - BIDATE (req) Date of Visit.
"RTN","BIREPE3",42,0)
 ;     2 - BIVIEN (req) VISIT IEN.
"RTN","BIREPE3",43,0)
 ;     3 - BIIIEN (req) V IMMUNIZAITON IEN.
"RTN","BIREPE3",44,0)
 ;     4 - BICC   (req) Current Community array.
"RTN","BIREPE3",45,0)
 ;     5 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPE3",46,0)
 ;     6 - BICM   (req) Case Manager array.
"RTN","BIREPE3",47,0)
 ;     7 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPE3",48,0)
 ;     8 - BIHIST (req) Include Historical (1=yes,0=no).
"RTN","BIREPE3",49,0)
 ;     9 - BIVT   (req) Visit Type array.
"RTN","BIREPE3",50,0)
 ;    10 - BIU19  (req) Include Adults parameter (1=yes,0=no).
"RTN","BIREPE3",51,0)
 ;
"RTN","BIREPE3",52,0)
 Q:'$G(BIDATE)
"RTN","BIREPE3",53,0)
 Q:'$G(BIVIEN)
"RTN","BIREPE3",54,0)
 Q:'$G(BIIIEN)
"RTN","BIREPE3",55,0)
 Q:'$D(^AUPNVSIT(BIVIEN,0))
"RTN","BIREPE3",56,0)
 Q:'$D(^AUPNVIMM(BIIIEN,0))
"RTN","BIREPE3",57,0)
 Q:'$D(BICC)
"RTN","BIREPE3",58,0)
 Q:'$D(BIHCF)
"RTN","BIREPE3",59,0)
 Q:'$D(BICM)
"RTN","BIREPE3",60,0)
 Q:'$D(BIBEN)
"RTN","BIREPE3",61,0)
 Q:'$D(BIVT)
"RTN","BIREPE3",62,0)
 Q:'$D(BIU19)
"RTN","BIREPE3",63,0)
 ;
"RTN","BIREPE3",64,0)
 N BIVIMM,BIIMM,BIVNAME,BIDFN,BILOT,BIELIG
"RTN","BIREPE3",65,0)
 S BIVIMM=^AUPNVIMM(BIIIEN,0)
"RTN","BIREPE3",66,0)
 S BIIMM=$P(BIVIMM,U),BIVNAME=$$VNAME^BIUTL2(BIIMM)
"RTN","BIREPE3",67,0)
 S BIDFN=$P(BIVIMM,U,2)
"RTN","BIREPE3",68,0)
 S BILOT=$P(BIVIMM,U,5)
"RTN","BIREPE3",69,0)
 S BIELIG=$P(BIVIMM,U,14)
"RTN","BIREPE3",70,0)
 ;
"RTN","BIREPE3",71,0)
 I BILOT S BILOT=$P($G(^AUTTIML(BILOT,0)),U)
"RTN","BIREPE3",72,0)
 S:BILOT="" BILOT="Not Entered"
"RTN","BIREPE3",73,0)
 ;
"RTN","BIREPE3",74,0)
 ;---> Quit if this Vaccine should not be included in this report.
"RTN","BIREPE3",75,0)
 ;---> As of v8.4, include all vaccines given during the selected time.
"RTN","BIREPE3",76,0)
 ;Q:'$P($G(^AUTTIMM(BIIMM,0)),U,17)   ;vvv8.4
"RTN","BIREPE3",77,0)
 ;
"RTN","BIREPE3",78,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPE3",79,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPE3",80,0)
 ;
"RTN","BIREPE3",81,0)
 ;---> Quit if Health Care Facility doesn't match.
"RTN","BIREPE3",82,0)
 N BIVDATA S BIVDATA=^AUPNVSIT(BIVIEN,0)
"RTN","BIREPE3",83,0)
 Q:$$HCF(BIVDATA,.BIHCF)
"RTN","BIREPE3",84,0)
 ;
"RTN","BIREPE3",85,0)
 ;---> Quit if Visit Type doesn't match.
"RTN","BIREPE3",86,0)
 Q:$$VT(BIVDATA,.BIVT)
"RTN","BIREPE3",87,0)
 ;
"RTN","BIREPE3",88,0)
 ;---> Quit if not including Historical Visits and this Visit has
"RTN","BIREPE3",89,0)
 ;---> a Category of "Historical".
"RTN","BIREPE3",90,0)
 I '$G(BIHIST) Q:$$HIST(BIVDATA)
"RTN","BIREPE3",91,0)
 ;
"RTN","BIREPE3",92,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPE3",93,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPE3",94,0)
 ;
"RTN","BIREPE3",95,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPE3",96,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPE3",97,0)
 ;
"RTN","BIREPE3",98,0)
 ;---> Quit if EXcluding adults and this patient was >19 on date of Visit.
"RTN","BIREPE3",99,0)
 I 'BIU19 Q:($$AGE^BIUTL1(BIDFN,1,BIDATE)>18)
"RTN","BIREPE3",100,0)
 ;
"RTN","BIREPE3",101,0)
 ;S BIVNAM=$$VNAME^BIUTL2(BIIMM)
"RTN","BIREPE3",102,0)
 ;S BIAGRP=$$AGEGRP(BIDFN,BIDATE)
"RTN","BIREPE3",103,0)
 ;S BIVGRP=$$IMMVG^BIUTL2(BIIMM,4)
"RTN","BIREPE3",104,0)
 ;
"RTN","BIREPE3",105,0)
 ;N Z
"RTN","BIREPE3",106,0)
 ;---> Now store in stats arrays.
"RTN","BIREPE3",107,0)
 ;
"RTN","BIREPE3",108,0)
 ;---> Add for this Vaccine, Lot, Age.
"RTN","BIREPE3",109,0)
 ;S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,BILOT,BIAGRP))
"RTN","BIREPE3",110,0)
 ;S BITMP("STATS",BIVGRP,BIVNAM,BILOT,BIAGRP)=Z+1
"RTN","BIREPE3",111,0)
 ;
"RTN","BIREPE3",112,0)
 ;---> Add for this Vaccine, Lot, Total.
"RTN","BIREPE3",113,0)
 ;S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,BILOT,"TOTAL"))
"RTN","BIREPE3",114,0)
 ;S BITMP("STATS",BIVGRP,BIVNAM,BILOT,"TOTAL")=Z+1
"RTN","BIREPE3",115,0)
 ;
"RTN","BIREPE3",116,0)
 N BINAME S BINAME=$$NAME^BIUTL1(BIDFN)
"RTN","BIREPE3",117,0)
 N BIDOB S BIDOB=$$DOBF^BIUTL1(BIDFN,,1,1,,1)
"RTN","BIREPE3",118,0)
 N BIELIGC S BIELIGC=$$ELIGC^BIELIG(BIELIG,6)
"RTN","BIREPE3",119,0)
 N BIVAL S BIVAL=$$SLDT2^BIUTL5(BIDATE,1)_U_$E(BINAME,1,20)_U_BIDOB_U_BIELIGC_U_BIVNAME_U_BILOT
"RTN","BIREPE3",120,0)
 S ^TMP("BIDUL",$J,BIDATE,BINAME,BIIIEN)=BIVAL
"RTN","BIREPE3",121,0)
 S ^TMP("BIDUL",$J,"TOTAL")=^TMP("BIDUL",$J,"TOTAL")+1
"RTN","BIREPE3",122,0)
 ;
"RTN","BIREPE3",123,0)
 Q
"RTN","BIREPE3",124,0)
 ;
"RTN","BIREPE3",125,0)
 ;
"RTN","BIREPE3",126,0)
 ;
"RTN","BIREPE3",127,0)
 ;----------
"RTN","BIREPE3",128,0)
AGEGRP(BIDFN,BIDATE) ;EP
"RTN","BIREPE3",129,0)
 ;---> Return Patient's Age Group.
"RTN","BIREPE3",130,0)
 ;---> Parameters:
"RTN","BIREPE3",131,0)
 ;     1 - BIDFN  (req) IEN in PATIENT File.
"RTN","BIREPE3",132,0)
 ;     2 - BIDATE (req) Date of Visit.
"RTN","BIREPE3",133,0)
 ;
"RTN","BIREPE3",134,0)
 N X S X=$$AGE^BIUTL1(BIDFN,1,BIDATE)
"RTN","BIREPE3",135,0)
 Q:X<1 1
"RTN","BIREPE3",136,0)
 Q:X=1 2
"RTN","BIREPE3",137,0)
 Q:X=2 3
"RTN","BIREPE3",138,0)
 Q:X<6 4
"RTN","BIREPE3",139,0)
 Q:X=6 5
"RTN","BIREPE3",140,0)
 Q:X<11 6
"RTN","BIREPE3",141,0)
 Q:X<13 7
"RTN","BIREPE3",142,0)
 Q:X<19 8
"RTN","BIREPE3",143,0)
 Q:X<25 9
"RTN","BIREPE3",144,0)
 Q:X<45 10
"RTN","BIREPE3",145,0)
 Q:X<65 11
"RTN","BIREPE3",146,0)
 Q 12
"RTN","BIREPE3",147,0)
 ;
"RTN","BIREPE3",148,0)
 ;
"RTN","BIREPE3",149,0)
 ;----------
"RTN","BIREPE3",150,0)
HCF(BIVDATA,BIHCF) ;EP
"RTN","BIREPE3",151,0)
 ;---> Return Health Care Facility indicator.
"RTN","BIREPE3",152,0)
 ;---> Return 1 if not selecting all Health Care Facilities (Locations)
"RTN","BIREPE3",153,0)
 ;---> and if the Health Care Facility of this visit is not one of the
"RTN","BIREPE3",154,0)
 ;---> ones selected.
"RTN","BIREPE3",155,0)
 ;---> Parameters:
"RTN","BIREPE3",156,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPE3",157,0)
 ;     2 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPE3",158,0)
 ;
"RTN","BIREPE3",159,0)
 Q:$D(BIHCF("ALL")) 0
"RTN","BIREPE3",160,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPE3",161,0)
 N BILOC S BILOC=$P(BIVDATA,U,6)
"RTN","BIREPE3",162,0)
 Q:'BILOC 1
"RTN","BIREPE3",163,0)
 Q:'$D(BIHCF(BILOC)) 1
"RTN","BIREPE3",164,0)
 Q 0
"RTN","BIREPE3",165,0)
 ;
"RTN","BIREPE3",166,0)
 ;
"RTN","BIREPE3",167,0)
 ;----------
"RTN","BIREPE3",168,0)
VT(BIVDATA,BIVT) ;EP
"RTN","BIREPE3",169,0)
 ;---> Return Visit Type indicator.
"RTN","BIREPE3",170,0)
 ;---> Return 1 if not selecting all Visit Types and if this Visit Type
"RTN","BIREPE3",171,0)
 ;---> is not one of the ones selected.
"RTN","BIREPE3",172,0)
 ;---> Parameters:
"RTN","BIREPE3",173,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPE3",174,0)
 ;     2 - BIVT    (req) Health Care Facility array.
"RTN","BIREPE3",175,0)
 ;
"RTN","BIREPE3",176,0)
 Q:$D(BIVT("ALL")) 0
"RTN","BIREPE3",177,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPE3",178,0)
 N BIVTYPE S BIVTYPE=$P(BIVDATA,U,3)
"RTN","BIREPE3",179,0)
 Q:BIVTYPE="" 1
"RTN","BIREPE3",180,0)
 Q:'$D(BIVT(BIVTYPE)) 1
"RTN","BIREPE3",181,0)
 Q 0
"RTN","BIREPE3",182,0)
 ;
"RTN","BIREPE3",183,0)
 ;
"RTN","BIREPE3",184,0)
 ;----------
"RTN","BIREPE3",185,0)
HIST(BIVDATA) ;EP
"RTN","BIREPE3",186,0)
 ;---> Return Historical Visit indicator.
"RTN","BIREPE3",187,0)
 ;---> Return 1 if this Visit has a Category of "Historical".
"RTN","BIREPE3",188,0)
 ;---> Parameters:
"RTN","BIREPE3",189,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPE3",190,0)
 ;
"RTN","BIREPE3",191,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPE3",192,0)
 Q:$P(BIVDATA,U,7)="E" 1
"RTN","BIREPE3",193,0)
 Q 0
"RTN","BIREPE3",194,0)
 ;
"RTN","BIREPE3",195,0)
 ;
"RTN","BIREPE3",196,0)
 ;----------
"RTN","BIREPE3",197,0)
ELIGC(IEN,FORM) ;EP
"RTN","BIREPE3",198,0)
 ;---> Return Eligibility Code or text.
"RTN","BIREPE3",199,0)
 ;
"RTN","BIREPE3",200,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPE3",201,0)
 ;---> Return Eligibility values from BI TABLE ELIGIBILITY File.
"RTN","BIREPE3",202,0)
 ;---> Parameters:
"RTN","BIREPE3",203,0)
 ;     1 - IEN  (req) IEN of Elig Code.
"RTN","BIREPE3",204,0)
 ;     2 - FORM (opt) FORM of Code to return:
"RTN","BIREPE3",205,0)
 ;                        1=Actual Code (also default)
"RTN","BIREPE3",206,0)
 ;                        2=Label Text of Code
"RTN","BIREPE3",207,0)
 ;                        3=Active/Inactive Status (1
"RTN","BIREPE3",208,0)
 ;                        4=Local Text
"RTN","BIREPE3",209,0)
 ;                        5=Local Report Abbreviation
"RTN","BIREPE3",210,0)
 ;
"RTN","BIREPE3",211,0)
 Q:'$G(IEN) ""
"RTN","BIREPE3",212,0)
 Q:'$D(^BIELIG(IEN,0)) "NO GLOBAL"
"RTN","BIREPE3",213,0)
 N Y S Y=^BIELIG(IEN,0)
"RTN","BIREPE3",214,0)
 ;
"RTN","BIREPE3",215,0)
 Q:$G(FORM)=2 $P(Y,U,2)
"RTN","BIREPE3",216,0)
 Q:$G(FORM)=3 $P(Y,U,3)
"RTN","BIREPE3",217,0)
 Q:$G(FORM)=4 $P(Y,U,4)
"RTN","BIREPE3",218,0)
 Q:$G(FORM)=5 $P(Y,U,5)
"RTN","BIREPE3",219,0)
 Q:$G(FORM)=6 $S($P(Y,U,5)]"":$P(Y,U,5),1:$P(Y,U))
"RTN","BIREPE3",220,0)
 Q $P(Y,U)
"RTN","BIREPE3",221,0)
 ;**********
"RTN","BIREPE3",222,0)
 ;
"RTN","BIREPE3",223,0)
 Q:(X=0) "Unknown"
"RTN","BIREPE3",224,0)
 Q:(X=1) "NotElig"
"RTN","BIREPE3",225,0)
 Q:(X=2) "Medicaid"
"RTN","BIREPE3",226,0)
 Q:(X=3) "Uninsured"
"RTN","BIREPE3",227,0)
 Q:(X=4) "AmIn/AKNa"
"RTN","BIREPE3",228,0)
 Q:(X=5) "Under/Fed"
"RTN","BIREPE3",229,0)
 Q:(X=6) "State"
"RTN","BIREPE3",230,0)
 Q:(X=7) "Local"
"RTN","BIREPE3",231,0)
 Q "Unknown"
"RTN","BIREPF")
0^99^B112816417
"RTN","BIREPF",1,0)
BIREPF ;IHS/CMI/MWR - REPORT, FLU IMM; MAY 10, 2010
"RTN","BIREPF",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIREPF",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPF",4,0)
 ;;  VIEW INFLUENZA IMMUNIZATION REPORT.
"RTN","BIREPF",5,0)
 ;;  PATCH 5: Display new beginning date as July 1.  INIT+20, TEXT1.
"RTN","BIREPF",6,0)
 ;
"RTN","BIREPF",7,0)
 ;
"RTN","BIREPF",8,0)
 ;----------
"RTN","BIREPF",9,0)
START ;EP
"RTN","BIREPF",10,0)
 ;---> Listman Screen for printing Immunization Due Letters.
"RTN","BIREPF",11,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPF",12,0)
 ;
"RTN","BIREPF",13,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPF",14,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPF",15,0)
 ;
"RTN","BIREPF",16,0)
 D EN
"RTN","BIREPF",17,0)
 D EXIT
"RTN","BIREPF",18,0)
 Q
"RTN","BIREPF",19,0)
 ;
"RTN","BIREPF",20,0)
 ;
"RTN","BIREPF",21,0)
 ;----------
"RTN","BIREPF",22,0)
EN ;EP
"RTN","BIREPF",23,0)
 ;---> Main entry point for BI LETTER PRINT DU
"RTN","BIREPF",24,0)
 D EN^VALM("BI REPORT FLU IMM")
"RTN","BIREPF",25,0)
 Q
"RTN","BIREPF",26,0)
 ;
"RTN","BIREPF",27,0)
 ;
"RTN","BIREPF",28,0)
 ;----------
"RTN","BIREPF",29,0)
INIT ;EP
"RTN","BIREPF",30,0)
 ;---> Initialize variables and list array.  vvv83
"RTN","BIREPF",31,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPF",32,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPF",33,0)
 N BILINE,X S BILINE=0
"RTN","BIREPF",34,0)
 D WRITE(.BILINE)
"RTN","BIREPF",35,0)
 S X=IOUON_"INFLUENZA IMMUNIZATION REPORT" D CENTERT^BIUTL5(.X,42)
"RTN","BIREPF",36,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPF",37,0)
 K X
"RTN","BIREPF",38,0)
 ;
"RTN","BIREPF",39,0)
 D WRITE(.BILINE,,1)
"RTN","BIREPF",40,0)
 ;---> Year.
"RTN","BIREPF",41,0)
 I '$G(BIYEAR),$G(DT) D
"RTN","BIREPF",42,0)
 .;---> If today is Jan=Aug, set default year=last year.
"RTN","BIREPF",43,0)
 .I +$E(DT,4,5)<9 S BIYEAR=1700+$E(DT,1,3)-1 Q
"RTN","BIREPF",44,0)
 .;---> If today is Sept=Dec, set default year=this year.
"RTN","BIREPF",45,0)
 .S BIYEAR=1700+$E(DT,1,3)
"RTN","BIREPF",46,0)
 ;
"RTN","BIREPF",47,0)
 S X="     1 - Report Year (Flu Season).......: "_+BIYEAR_"/"_(BIYEAR+1)
"RTN","BIREPF",48,0)
 ;
"RTN","BIREPF",49,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPF",50,0)
 ;---> Display new beginning date as July 1.
"RTN","BIREPF",51,0)
 ;S X=X_"  (09/01/"_$E(BIYEAR,3,4)
"RTN","BIREPF",52,0)
 S X=X_"  (07/01/"_$E(BIYEAR,3,4)
"RTN","BIREPF",53,0)
 ;**********
"RTN","BIREPF",54,0)
 D
"RTN","BIREPF",55,0)
  .I $P(BIYEAR,U,2)="m" S X=X_" - 03/31/"_$E((BIYEAR+1),3,4)_")" Q
"RTN","BIREPF",56,0)
  .S X=X_" - 12/31/"_$E(BIYEAR,3,4)_")"
"RTN","BIREPF",57,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPF",58,0)
 K X
"RTN","BIREPF",59,0)
 ;
"RTN","BIREPF",60,0)
 ;---> Current Community.
"RTN","BIREPF",61,0)
 D DISP^BIREP(.BILINE,"BIREPF",.BICC,"Community",2,1,,,40)
"RTN","BIREPF",62,0)
 ;
"RTN","BIREPF",63,0)
 ;---> Health Care Facility.
"RTN","BIREPF",64,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPF",65,0)
 D DISP^BIREP(.BILINE,"BIREPF",.BIHCF,A,3,2,,,40,B) K A,B
"RTN","BIREPF",66,0)
 ;
"RTN","BIREPF",67,0)
 ;---> Case Manager.
"RTN","BIREPF",68,0)
 D DISP^BIREP(.BILINE,"BIREPF",.BICM,"Case Manager",4,3,,,40)
"RTN","BIREPF",69,0)
 ;
"RTN","BIREPF",70,0)
 ;---> Beneficiary Type.
"RTN","BIREPF",71,0)
 S:$O(BIBEN(0))="" BIBEN(1)=""
"RTN","BIREPF",72,0)
 D DISP^BIREP(.BILINE,"BIREPF",.BIBEN,"Beneficiary Type",5,4,,,40)
"RTN","BIREPF",73,0)
 ;
"RTN","BIREPF",74,0)
 ;---> User Population.
"RTN","BIREPF",75,0)
 D:($G(BIUP)="")
"RTN","BIREPF",76,0)
 .I $$GPRAIEN^BIUTL6 S BIUP="a" Q
"RTN","BIREPF",77,0)
 .S BIUP="u"
"RTN","BIREPF",78,0)
 ;
"RTN","BIREPF",79,0)
 S X="     6 - Patient Population Group.......: "
"RTN","BIREPF",80,0)
 D
"RTN","BIREPF",81,0)
 .I BIUP="r" S X=X_"Registered Patients (All)" Q
"RTN","BIREPF",82,0)
 .I BIUP="i" S X=X_"Immunization Register Patients (Active)" Q
"RTN","BIREPF",83,0)
 .I BIUP="u" S X=X_"User Population (1 visit, 3 yrs)" Q
"RTN","BIREPF",84,0)
 .I BIUP="a" S X=X_"Active Users (2+ visits, 3 yrs)" Q
"RTN","BIREPF",85,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPF",86,0)
 K X
"RTN","BIREPF",87,0)
 ;
"RTN","BIREPF",88,0)
 ;---> Report Type.
"RTN","BIREPF",89,0)
 S:($G(BIFH)="") BIFH="F"
"RTN","BIREPF",90,0)
 S X="     7 - Report Type (Standard or H1N1).: "_$S(BIFH="H":"H1N1",1:"Standard Flu")
"RTN","BIREPF",91,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPF",92,0)
 K X
"RTN","BIREPF",93,0)
 ;
"RTN","BIREPF",94,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPF",95,0)
 S VALMCNT=BILINE
"RTN","BIREPF",96,0)
 S BIRTN="BIREPF"
"RTN","BIREPF",97,0)
 Q
"RTN","BIREPF",98,0)
 ;
"RTN","BIREPF",99,0)
 ;
"RTN","BIREPF",100,0)
 ;----------
"RTN","BIREPF",101,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPF",102,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPF",103,0)
 ;---> Parameters:
"RTN","BIREPF",104,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPF",105,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPF",106,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPF",107,0)
 ;
"RTN","BIREPF",108,0)
 Q:'$D(BILINE)
"RTN","BIREPF",109,0)
 D WL^BIW(.BILINE,"BIREPF",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPF",110,0)
 Q
"RTN","BIREPF",111,0)
 ;
"RTN","BIREPF",112,0)
 ;
"RTN","BIREPF",113,0)
 ;----------
"RTN","BIREPF",114,0)
RESET ;EP
"RTN","BIREPF",115,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPF",116,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPF",117,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPF",118,0)
 D INIT Q
"RTN","BIREPF",119,0)
 ;
"RTN","BIREPF",120,0)
 ;
"RTN","BIREPF",121,0)
 ;----------
"RTN","BIREPF",122,0)
HELP ;EP
"RTN","BIREPF",123,0)
 ;---> Help code.
"RTN","BIREPF",124,0)
 N BIX S BIX=X
"RTN","BIREPF",125,0)
 D FULL^VALM1
"RTN","BIREPF",126,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPF",127,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPF",128,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPF",129,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPF",130,0)
 Q
"RTN","BIREPF",131,0)
 ;
"RTN","BIREPF",132,0)
 ;
"RTN","BIREPF",133,0)
 ;----------
"RTN","BIREPF",134,0)
HELP1 ;EP
"RTN","BIREPF",135,0)
 ;----> Explanation of this report.  vvv83
"RTN","BIREPF",136,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPF",137,0)
 D START^BIHELP("INFLUENZA IMMUNIZATION REPORT - HELP",.BITEXT)
"RTN","BIREPF",138,0)
 Q
"RTN","BIREPF",139,0)
 ;
"RTN","BIREPF",140,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPF",141,0)
 ;---> Correct items in Help Text below to reflect new begin date as July 1.
"RTN","BIREPF",142,0)
 ;
"RTN","BIREPF",143,0)
 ;----------
"RTN","BIREPF",144,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPF",145,0)
 ;;
"RTN","BIREPF",146,0)
 ;;INFLUENZA IMMUNIZATION REPORT
"RTN","BIREPF",147,0)
 ;;
"RTN","BIREPF",148,0)
 ;;This Influenza Report is designed to comply with influenza vaccination
"RTN","BIREPF",149,0)
 ;;recommendations for patients of all ages.  The report examines the
"RTN","BIREPF",150,0)
 ;;influenza season (7/1 - 12/31) for the year selected. (An end date of
"RTN","BIREPF",151,0)
 ;;3/31 may also be selected.)
"RTN","BIREPF",152,0)
 ;;
"RTN","BIREPF",153,0)
 ;;
"RTN","BIREPF",154,0)
 ;;Report Columns
"RTN","BIREPF",155,0)
 ;;--------------_
"RTN","BIREPF",156,0)
 ;;The "Age in Months" is calculated on 12/31 of the year selected,
"RTN","BIREPF",157,0)
 ;;in order to include children who were at least 6 months of age during
"RTN","BIREPF",158,0)
 ;;entire influenza season (7/1 - 12/31).
"RTN","BIREPF",159,0)
 ;;
"RTN","BIREPF",160,0)
 ;;The first column, 10-23 months, includes children who were 6-23 months
"RTN","BIREPF",161,0)
 ;;old during the influenza season of the selected year.
"RTN","BIREPF",162,0)
 ;;
"RTN","BIREPF",163,0)
 ;;The second column, 24-59 months, includes children who were 24-59
"RTN","BIREPF",164,0)
 ;;months during the entire influenza season of the selected year, and
"RTN","BIREPF",165,0)
 ;;so on for the remaining age groups.
"RTN","BIREPF",166,0)
 ;;
"RTN","BIREPF",167,0)
 ;;NOTE: The column headed "18-49hr" represents patients whose history
"RTN","BIREPF",168,0)
 ;;puts them in the High Risk category.  Patient statistics in this
"RTN","BIREPF",169,0)
 ;;column are NOT include in the "18-49y" column.
"RTN","BIREPF",170,0)
 ;;
"RTN","BIREPF",171,0)
 ;;
"RTN","BIREPF",172,0)
 ;;Report Rows
"RTN","BIREPF",173,0)
 ;;------------
"RTN","BIREPF",174,0)
 ;;The "Denominator" row of the report is the number of patients within
"RTN","BIREPF",175,0)
 ;;that age group who are included in the report.
"RTN","BIREPF",176,0)
 ;;    NOTE: Any patient who was Inactivated prior to 12/31 of the year
"RTN","BIREPF",177,0)
 ;;          selected will not be included in the report.
"RTN","BIREPF",178,0)
 ;;
"RTN","BIREPF",179,0)
 ;;The "1-Influenza year season" row of the report includes all patients
"RTN","BIREPF",180,0)
 ;;who received at least one dose during the influenza season of the year
"RTN","BIREPF",181,0)
 ;;selected (Sept-Dec).
"RTN","BIREPF",182,0)
 ;;
"RTN","BIREPF",183,0)
 ;;The "Fully immunized" row of the report includes children ages who are:
"RTN","BIREPF",184,0)
 ;;
"RTN","BIREPF",185,0)
 ;;  10-23 Months Old:
"RTN","BIREPF",186,0)
 ;;    1) Received 2 doses during the influenza season of the year selected.
"RTN","BIREPF",187,0)
 ;;       (Sept 1 - Dec 31 or Mar 31, whichever is selected),
"RTN","BIREPF",188,0)
 ;;   or
"RTN","BIREPF",189,0)
 ;;    2) Received 1+ dose before Sept 1 and 1+ dose during Sept-Dec/March.
"RTN","BIREPF",190,0)
 ;;
"RTN","BIREPF",191,0)
 ;;  24-59 Months Old:
"RTN","BIREPF",192,0)
 ;;    1) Received 2 doses during the influenza season of the year selected.
"RTN","BIREPF",193,0)
 ;;       (July 1 - Dec 31 or Mar 31, whichever is selected),
"RTN","BIREPF",194,0)
 ;;   or
"RTN","BIREPF",195,0)
 ;;    2) Received 2+ dose before Sept 1 and 1+ dose during Sept-Dec/March.
"RTN","BIREPF",196,0)
 ;;
"RTN","BIREPF",197,0)
 ;;All other age columns reflect patients who were fully immunized by
"RTN","BIREPF",198,0)
 ;;receiving a signal dose in the current season.
"RTN","BIREPF",199,0)
 ;;
"RTN","BIREPF",200,0)
 ;;The INFLUENZA IMMUNIZATION REPORT screen allows you to adjust the
"RTN","BIREPF",201,0)
 ;;report to your needs.
"RTN","BIREPF",202,0)
 ;;
"RTN","BIREPF",203,0)
 ;;There are 7 items or "parameters" on the screen that you may
"RTN","BIREPF",204,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPF",205,0)
 ;;To change an item, enter its left column number (1-7) at the
"RTN","BIREPF",206,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPF",207,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPF",208,0)
 ;;changing.
"RTN","BIREPF",209,0)
 ;;
"RTN","BIREPF",210,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPF",211,0)
 ;;you want, select V to View the Influenza Report or P to print it.
"RTN","BIREPF",212,0)
 ;;
"RTN","BIREPF",213,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPF",214,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPF",215,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPF",216,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPF",217,0)
 ;;
"RTN","BIREPF",218,0)
 ;;REPORT YEAR: The report will compile influenza immunization rates
"RTN","BIREPF",219,0)
 ;;for the year entered, in the date range of 7/1 to 12/31.  An optional
"RTN","BIREPF",220,0)
 ;;End Date of 3/31 following the selected report year is also available.
"RTN","BIREPF",221,0)
 ;;
"RTN","BIREPF",222,0)
 ;;COMMUNITY: If you select for specific Communities, only patients
"RTN","BIREPF",223,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPF",224,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPF",225,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPF",226,0)
 ;;
"RTN","BIREPF",227,0)
 ;;HEALTH CARE FACILITY: If you select for specific Health Care
"RTN","BIREPF",228,0)
 ;;Facilities, only Patients who have active Chart#'s at one or more
"RTN","BIREPF",229,0)
 ;;of the selected Facilities will be included in the report.
"RTN","BIREPF",230,0)
 ;;
"RTN","BIREPF",231,0)
 ;;CASE MANAGER: If you select for specific Case Managers, only
"RTN","BIREPF",232,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPF",233,0)
 ;;in the report.
"RTN","BIREPF",234,0)
 ;;
"RTN","BIREPF",235,0)
 ;;BENEFICIARY TYPE: If you select for specific Beneficiary Types,
"RTN","BIREPF",236,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPF",237,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPF",238,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPF",239,0)
 ;;
"RTN","BIREPF",240,0)
 ;;PATIENT POPULATION GROUP: You may select one of four patient groups
"RTN","BIREPF",241,0)
 ;;to be considered in the report: Registered Patients (All),
"RTN","BIREPF",242,0)
 ;;Immunization Register Patients (Active), User Population (1+ visits
"RTN","BIREPF",243,0)
 ;;in 3 yrs), or Active Clinical Users (2+ visits in 3 yrs).
"RTN","BIREPF",244,0)
 ;;Active Clinical Users is the default.
"RTN","BIREPF",245,0)
 ;;
"RTN","BIREPF",246,0)
 ;;REPORT TYPE: If you select Standard Report, the report will display
"RTN","BIREPF",247,0)
 ;;statistics for standard influenza immunizations (excluding H1N1).
"RTN","BIREPF",248,0)
 ;;If you select H1N1, then only statistics for H1N1 immunizations
"RTN","BIREPF",249,0)
 ;;will be displayed.
"RTN","BIREPF",250,0)
 ;;
"RTN","BIREPF",251,0)
 ;;
"RTN","BIREPF",252,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPF",253,0)
 Q
"RTN","BIREPF",254,0)
 ;
"RTN","BIREPF",255,0)
 ;
"RTN","BIREPF",256,0)
 ;----------
"RTN","BIREPF",257,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPF",258,0)
 Q:$G(BILINL)=""
"RTN","BIREPF",259,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPF",260,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPF",261,0)
 Q
"RTN","BIREPF",262,0)
 ;
"RTN","BIREPF",263,0)
 ;
"RTN","BIREPF",264,0)
 ;----------
"RTN","BIREPF",265,0)
EXIT ;EP
"RTN","BIREPF",266,0)
 ;---> End of job cleanup.
"RTN","BIREPF",267,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPF",268,0)
 K ^TMP("BIREPF",$J)
"RTN","BIREPF",269,0)
 D CLEAR^VALM1
"RTN","BIREPF",270,0)
 D FULL^VALM1
"RTN","BIREPF",271,0)
 Q
"RTN","BIREPF1")
0^100^B24668650
"RTN","BIREPF1",1,0)
BIREPF1 ;IHS/CMI/MWR - REPORT, FLU IMM; AUG 10,2010
"RTN","BIREPF1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPF1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPF1",4,0)
 ;;  VIEW OR PRINT INFLUENZA IMMUNIZATION REPORT.
"RTN","BIREPF1",5,0)
 ;;  PATCH 1: Include Flu/H1N1 parameter for body of report when queued.
"RTN","BIREPF1",6,0)
 ;;           DEQUEUE+6
"RTN","BIREPF1",7,0)
 ;
"RTN","BIREPF1",8,0)
 ;----------
"RTN","BIREPF1",9,0)
START(BIX) ;EP
"RTN","BIREPF1",10,0)
 ;---> VIEW Influenza Report.
"RTN","BIREPF1",11,0)
 ;---> Prepare and display Influenza Report.
"RTN","BIREPF1",12,0)
 ;---> Parameters:
"RTN","BIREPF1",13,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Qtr Report.
"RTN","BIREPF1",14,0)
 ;                      If BIX="VIEW", then view Qtr Report (default).
"RTN","BIREPF1",15,0)
 ;---> Variables:
"RTN","BIREPF1",16,0)
 ;     1 - BIYEAR (req) Report Year^m (if 2nd pc="m", then End Date=March 31 of
"RTN","BIREPF1",17,0)
 ;                      the report year; otherwise End Date=Dec 31 of BIYEAR)
"RTN","BIREPF1",18,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPF1",19,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPF1",20,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPF1",21,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPF1",22,0)
 ;     6 - BIFH   (opt) F=report on Flu Vaccine Group (default), H=H1N1 group.
"RTN","BIREPF1",23,0)
 ;     7 - BIPOP  (ret) BIPOP=1 if error.
"RTN","BIREPF1",24,0)
 ;
"RTN","BIREPF1",25,0)
 ;---> Check for required Variables.
"RTN","BIREPF1",26,0)
 I '$G(BIYEAR) D ERROR(679) D RESET^BIREPF Q
"RTN","BIREPF1",27,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPF Q
"RTN","BIREPF1",28,0)
 I '$D(BIHCF) D ERROR(625) D RESET^BIREPF Q
"RTN","BIREPF1",29,0)
 I '$D(BICM)  D ERROR(615) D RESET^BIREPF Q
"RTN","BIREPF1",30,0)
 I '$D(BIBEN) D ERROR(662) D RESET^BIREPF Q
"RTN","BIREPF1",31,0)
 S:($G(BIFH)="") BIFH="F"
"RTN","BIREPF1",32,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPF1",33,0)
 ;
"RTN","BIREPF1",34,0)
 D SETVARS^BIUTL5 N VALMCNT
"RTN","BIREPF1",35,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPF Q
"RTN","BIREPF1",36,0)
 ;
"RTN","BIREPF1",37,0)
 ;---> Set BIAG for Age Range in header of report.
"RTN","BIREPF1",38,0)
 ;---> Set BIRPDT for Report Date ("Quarterly, etc.).
"RTN","BIREPF1",39,0)
 ;---> Set BIRTN in case user runs Patient List then needs to return
"RTN","BIREPF1",40,0)
 ;---> to INIT here.
"RTN","BIREPF1",41,0)
 ;---> Set BITITL for Report Name in Patient List, if called.  vvv83
"RTN","BIREPF1",42,0)
 N BIAG,BIRPDT,BIRTN,BITITL
"RTN","BIREPF1",43,0)
 S BIAG="ALL",BIRPDT=$G(DT),BIRTN="BIREPF1",BITITL="INFLUENZA"
"RTN","BIREPF1",44,0)
 D EN
"RTN","BIREPF1",45,0)
 D RESET^BIREPF
"RTN","BIREPF1",46,0)
 Q
"RTN","BIREPF1",47,0)
 ;
"RTN","BIREPF1",48,0)
 ;
"RTN","BIREPF1",49,0)
 ;----------
"RTN","BIREPF1",50,0)
PRINT ;EP
"RTN","BIREPF1",51,0)
 ;---> Main entry point for printing the Quarterly Immunization Report.
"RTN","BIREPF1",52,0)
 D DEVICE(.BIPOP)
"RTN","BIREPF1",53,0)
 Q:$G(BIPOP)
"RTN","BIREPF1",54,0)
 ;
"RTN","BIREPF1",55,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPF1",56,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPF1",57,0)
 ;
"RTN","BIREPF1",58,0)
 ;---> Prepare report.
"RTN","BIREPF1",59,0)
 K ^TMP("BIREPF1",$J),^TMP("BIDUL",$J)
"RTN","BIREPF1",60,0)
 N VALM,VALMHDR
"RTN","BIREPF1",61,0)
 D HDR,START^BIREPF2(BIYEAR,.BICC,.BIHCF,.BICM,.BIBEN,BIFH,BIUP)
"RTN","BIREPF1",62,0)
 ;
"RTN","BIREPF1",63,0)
 D PRTLST^BIUTL8("BIREPF1")
"RTN","BIREPF1",64,0)
 D EXIT,RESET^BIREPF
"RTN","BIREPF1",65,0)
 Q
"RTN","BIREPF1",66,0)
 ;
"RTN","BIREPF1",67,0)
 ;
"RTN","BIREPF1",68,0)
 ;----------
"RTN","BIREPF1",69,0)
EN ;EP
"RTN","BIREPF1",70,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIREPF1",71,0)
 D EN^VALM("BI REPORT FLU IMM1")
"RTN","BIREPF1",72,0)
 Q
"RTN","BIREPF1",73,0)
 ;
"RTN","BIREPF1",74,0)
 ;
"RTN","BIREPF1",75,0)
 ;----------
"RTN","BIREPF1",76,0)
HDR ;EP
"RTN","BIREPF1",77,0)
 ;---> Header code
"RTN","BIREPF1",78,0)
 D HEAD^BIREPF2(BIYEAR,.BICC,.BIHCF,.BICM,.BIBEN,BIFH,BIUP)
"RTN","BIREPF1",79,0)
 Q
"RTN","BIREPF1",80,0)
 ;
"RTN","BIREPF1",81,0)
 ;
"RTN","BIREPF1",82,0)
 ;----------
"RTN","BIREPF1",83,0)
INIT ;EP
"RTN","BIREPF1",84,0)
 ;---> Initialize variables and list array.
"RTN","BIREPF1",85,0)
 K ^TMP("BIREPF1",$J),^TMP("BIDUL",$J)
"RTN","BIREPF1",86,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPF1",87,0)
 S VALMSG="To view patient rosters, select a group below:"
"RTN","BIREPF1",88,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPF1",89,0)
 D START^BIREPF2(BIYEAR,.BICC,.BIHCF,.BICM,.BIBEN,BIFH,BIUP)
"RTN","BIREPF1",90,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPF1",91,0)
 D ZSAVES^BIUTL3
"RTN","BIREPF1",92,0)
 Q
"RTN","BIREPF1",93,0)
 ;
"RTN","BIREPF1",94,0)
 ;
"RTN","BIREPF1",95,0)
 ;----------
"RTN","BIREPF1",96,0)
RESET ;EP
"RTN","BIREPF1",97,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPF1",98,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPF1",99,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPF1",100,0)
 D INIT,HDR
"RTN","BIREPF1",101,0)
 Q
"RTN","BIREPF1",102,0)
 ;
"RTN","BIREPF1",103,0)
 ;
"RTN","BIREPF1",104,0)
 ;----------
"RTN","BIREPF1",105,0)
RESET1 ;EP
"RTN","BIREPF1",106,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPF1",107,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPF1",108,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPF1",109,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPF1",110,0)
 S VALMSG="To view patient lists, select a group below:"
"RTN","BIREPF1",111,0)
 D HDR
"RTN","BIREPF1",112,0)
 Q
"RTN","BIREPF1",113,0)
 ;
"RTN","BIREPF1",114,0)
 ;
"RTN","BIREPF1",115,0)
 ;----------
"RTN","BIREPF1",116,0)
HELP ;EP
"RTN","BIREPF1",117,0)
 N BIX S BIX=X
"RTN","BIREPF1",118,0)
 D FULL^VALM1 N BIPOP
"RTN","BIREPF1",119,0)
 D TITLE^BIUTL5("INFLUENZA REPORT - HELP, page 1 of 1")
"RTN","BIREPF1",120,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIREPF1",121,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPF1",122,0)
 Q
"RTN","BIREPF1",123,0)
 ;
"RTN","BIREPF1",124,0)
 ;
"RTN","BIREPF1",125,0)
 ;----------
"RTN","BIREPF1",126,0)
TEXT1 ;EP
"RTN","BIREPF1",127,0)
 ;;You have chosen to View the Influenza Report rather than Print it.
"RTN","BIREPF1",128,0)
 ;;(You may print the report from here as well by entering "PL".)
"RTN","BIREPF1",129,0)
 ;;
"RTN","BIREPF1",130,0)
 ;;Also, you may:
"RTN","BIREPF1",131,0)
 ;;
"RTN","BIREPF1",132,0)
 ;;Enter "N" to view the list of Patients who were NOT Current
"RTN","BIREPF1",133,0)
 ;;          or "NOT up-to-date" with their immunizations, according
"RTN","BIREPF1",134,0)
 ;;          to recommendeded guidelines for their age.
"RTN","BIREPF1",135,0)
 ;;
"RTN","BIREPF1",136,0)
 ;;Enter "C" to view the list of Patients who were CURRENT or
"RTN","BIREPF1",137,0)
 ;;          "up-to-date" with their immunizations, according to
"RTN","BIREPF1",138,0)
 ;;          recommendeded guidelines for their age.
"RTN","BIREPF1",139,0)
 ;;
"RTN","BIREPF1",140,0)
 ;;Enter "B" to view a list of both groups of patients combined.
"RTN","BIREPF1",141,0)
 ;;
"RTN","BIREPF1",142,0)
 ;;
"RTN","BIREPF1",143,0)
 D PRINTX("TEXT1")
"RTN","BIREPF1",144,0)
 Q
"RTN","BIREPF1",145,0)
 ;
"RTN","BIREPF1",146,0)
 ;
"RTN","BIREPF1",147,0)
 ;----------
"RTN","BIREPF1",148,0)
EXIT ;EP
"RTN","BIREPF1",149,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPF1",150,0)
 K ^TMP("BIREPF1",$J),^TMP("BIDUL",$J)
"RTN","BIREPF1",151,0)
 D CLEAR^VALM1
"RTN","BIREPF1",152,0)
 D FULL^VALM1
"RTN","BIREPF1",153,0)
 Q
"RTN","BIREPF1",154,0)
 ;
"RTN","BIREPF1",155,0)
 ;
"RTN","BIREPF1",156,0)
 ;----------
"RTN","BIREPF1",157,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPF1",158,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPF1",159,0)
 ;---> Parameters:
"RTN","BIREPF1",160,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPF1",161,0)
 ;
"RTN","BIREPF1",162,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPF1",163,0)
 S ZTRTN="DEQUEUE^BIREPF1"
"RTN","BIREPF1",164,0)
 D ZSAVES^BIUTL3
"RTN","BIREPF1",165,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPF1",166,0)
 Q
"RTN","BIREPF1",167,0)
 ;
"RTN","BIREPF1",168,0)
 ;
"RTN","BIREPF1",169,0)
 ;----------
"RTN","BIREPF1",170,0)
DEQUEUE ;EP
"RTN","BIREPF1",171,0)
 ;
"RTN","BIREPF1",172,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIREPF1",173,0)
 K VALMHDR,^TMP("BIREPF1",$J)
"RTN","BIREPF1",174,0)
 ;
"RTN","BIREPF1",175,0)
 ;********** PATCH 1, v8.4, AUG 01,2010, IHS/CMI/MWR
"RTN","BIREPF1",176,0)
 ;---> Include Flu/H1N1 parameter for body of report when queued.
"RTN","BIREPF1",177,0)
 ;D HDR^BIREPF1,START^BIREPF2(BIYEAR,.BICC,.BIHCF,.BICM,.BIBEN)
"RTN","BIREPF1",178,0)
 D HDR^BIREPF1,START^BIREPF2(BIYEAR,.BICC,.BIHCF,.BICM,.BIBEN,BIFH,BIUP)
"RTN","BIREPF1",179,0)
 ;**********
"RTN","BIREPF1",180,0)
 ;
"RTN","BIREPF1",181,0)
 D PRTLST^BIUTL8("BIREPF1"),EXIT
"RTN","BIREPF1",182,0)
 Q
"RTN","BIREPF1",183,0)
 ;
"RTN","BIREPF1",184,0)
 ;
"RTN","BIREPF1",185,0)
 ;----------
"RTN","BIREPF1",186,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPF1",187,0)
 Q:$G(BILINL)=""
"RTN","BIREPF1",188,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPF1",189,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPF1",190,0)
 Q
"RTN","BIREPF1",191,0)
 ;
"RTN","BIREPF1",192,0)
 ;
"RTN","BIREPF1",193,0)
 ;----------
"RTN","BIREPF1",194,0)
ERROR(BIERR) ;EP
"RTN","BIREPF1",195,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPF1",196,0)
 ;---> Parameters:
"RTN","BIREPF1",197,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPF1",198,0)
 ;
"RTN","BIREPF1",199,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPF1",200,0)
 Q
"RTN","BIREPF2")
0^101^B30028410
"RTN","BIREPF2",1,0)
BIREPF2 ;IHS/CMI/MWR - REPORT, FLU IMM; AUG 10,2010
"RTN","BIREPF2",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIREPF2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPF2",4,0)
 ;;  VIEW INFLUENZA IMMUNIZATION REPORT, GATHER DATA.
"RTN","BIREPF2",5,0)
 ;;  PATCH 1: Add "Dose#" header to Doses column.  HEAD+86
"RTN","BIREPF2",6,0)
 ;;  PATCH 5: Display new beginning date as July 1.  HEAD+38
"RTN","BIREPF2",7,0)
 ;
"RTN","BIREPF2",8,0)
 ;
"RTN","BIREPF2",9,0)
 ;----------
"RTN","BIREPF2",10,0)
HEAD(BIYEAR,BICC,BIHCF,BICM,BIBEN,BIFH,BIUP) ;EP
"RTN","BIREPF2",11,0)
 ;---> Produce Header array for Quarterly Immunization Report.
"RTN","BIREPF2",12,0)
 ;---> Parameters:
"RTN","BIREPF2",13,0)
 ;     1 - BIYEAR (req) Report Year.
"RTN","BIREPF2",14,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPF2",15,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPF2",16,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPF2",17,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPF2",18,0)
 ;     6 - BIFH   (opt) F=report on Flu Vaccine Group (default), H=H1N1 group.
"RTN","BIREPF2",19,0)
 ;     7 - BIUP   (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPF2",20,0)
 ;
"RTN","BIREPF2",21,0)
 ;---> Check for required Variables.
"RTN","BIREPF2",22,0)
 Q:'$G(BIYEAR)
"RTN","BIREPF2",23,0)
 Q:'$D(BICC)
"RTN","BIREPF2",24,0)
 Q:'$D(BIHCF)
"RTN","BIREPF2",25,0)
 Q:'$D(BICM)
"RTN","BIREPF2",26,0)
 Q:'$D(BIBEN)
"RTN","BIREPF2",27,0)
 S:($G(BIFH)="") BIFH="F"
"RTN","BIREPF2",28,0)
 Q:'$D(BIUP)
"RTN","BIREPF2",29,0)
 ;
"RTN","BIREPF2",30,0)
 K VALMHDR
"RTN","BIREPF2",31,0)
 N BILINE,X S BILINE=0
"RTN","BIREPF2",32,0)
 ;
"RTN","BIREPF2",33,0)
 N X S X=""
"RTN","BIREPF2",34,0)
 ;---> If Header array is NOT being for Listmananger include version.  vvv83
"RTN","BIREPF2",35,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPF2",36,0)
 ;
"RTN","BIREPF2",37,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPF2",38,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPF2",39,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPF2",40,0)
 ;
"RTN","BIREPF2",41,0)
 S X="*  "_$S($G(BIFH)="H":"H1N1",1:"Standard Flu")_" Immunization Report  *"
"RTN","BIREPF2",42,0)
 D CENTERT^BIUTL5(.X)
"RTN","BIREPF2",43,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPF2",44,0)
 ;
"RTN","BIREPF2",45,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPF2",46,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPF2",47,0)
 ;
"RTN","BIREPF2",48,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPF2",49,0)
 ;---> Display new beginning date as July 1.
"RTN","BIREPF2",50,0)
 ;N BIBEG,BIEND S BIBEG="09/15/"_$P(BIYEAR,U)
"RTN","BIREPF2",51,0)
 N BIBEG,BIEND S BIBEG="07/01/"_$P(BIYEAR,U)
"RTN","BIREPF2",52,0)
 ;**********
"RTN","BIREPF2",53,0)
 D
"RTN","BIREPF2",54,0)
 .I $P(BIYEAR,U,2)="m" S BIEND="03/31/"_($P(BIYEAR,U)+1) Q
"RTN","BIREPF2",55,0)
 .S BIEND="12/31/"_$P(BIYEAR,U)
"RTN","BIREPF2",56,0)
 S X=$$SP^BIUTL5(28)_"Date Range: "_BIBEG_" - "_BIEND
"RTN","BIREPF2",57,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPF2",58,0)
 ;
"RTN","BIREPF2",59,0)
 S X=" "_$$BIUPTX^BIUTL6(BIUP),X=$$PAD^BIUTL5(X,48)
"RTN","BIREPF2",60,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPF2",61,0)
 ;
"RTN","BIREPF2",62,0)
 D WH^BIW(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF2",63,0)
 ;
"RTN","BIREPF2",64,0)
 D
"RTN","BIREPF2",65,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPF2",66,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPF2",67,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPF2",68,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPF2",69,0)
 .;
"RTN","BIREPF2",70,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPF2",71,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPF2",72,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPF2",73,0)
 .;
"RTN","BIREPF2",74,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPF2",75,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPF2",76,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPF2",77,0)
 .;
"RTN","BIREPF2",78,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPF2",79,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPF2",80,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPF2",81,0)
 .;
"RTN","BIREPF2",82,0)
 .S X=$$SP^BIUTL5(13)_"|"_$$SP^BIUTL5(4)_"      Age in months/years on "
"RTN","BIREPF2",83,0)
 .S X=X_$$SLDT2^BIUTL5((BIYEAR-1700)_1231)_$$SP^BIUTL5(12)_"|"
"RTN","BIREPF2",84,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPF2",85,0)
 .;
"RTN","BIREPF2",86,0)
 .;********** PATCH 1, v8.4, AUG 01,2010, IHS/CMI/MWR
"RTN","BIREPF2",87,0)
 .;---> Add "Dose#" header to Doses column.
"RTN","BIREPF2",88,0)
 .;S X=$$SP^BIUTL5(13)_"|"_$$SP^BIUTL5(55,"-")_"| Totals"
"RTN","BIREPF2",89,0)
 .S X="    Dose#    |"_$$SP^BIUTL5(55,"-")_"| Totals"
"RTN","BIREPF2",90,0)
 .;**********
"RTN","BIREPF2",91,0)
 .;
"RTN","BIREPF2",92,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPF2",93,0)
 .S X="             | 10-23m    2-4y   5-17y  18-49y *18-49hr 50-64y  65+yrs"
"RTN","BIREPF2",94,0)
 .S X=$$PAD^BIUTL5(X,69)_"|"
"RTN","BIREPF2",95,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPF2",96,0)
 ;
"RTN","BIREPF2",97,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPF2",98,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPF2",99,0)
 D:$D(VALM("BM"))
"RTN","BIREPF2",100,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPF2",101,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPF2",102,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPF2",103,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPF2",104,0)
 Q
"RTN","BIREPF2",105,0)
 ;
"RTN","BIREPF2",106,0)
 ;
"RTN","BIREPF2",107,0)
 ;----------
"RTN","BIREPF2",108,0)
START(BIYEAR,BICC,BIHCF,BICM,BIBEN,BIFH,BIUP) ;EP
"RTN","BIREPF2",109,0)
 ;---> Produce array for Quarterly Immunization Report.
"RTN","BIREPF2",110,0)
 ;---> Parameters:
"RTN","BIREPF2",111,0)
 ;     1 - BIYEAR (req) Report Year^m (if 2nd pc="m", then End Date=March 31 of
"RTN","BIREPF2",112,0)
 ;                      the report year; otherwise End Date=Dec 31 of BIYEAR)
"RTN","BIREPF2",113,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPF2",114,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPF2",115,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPF2",116,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPF2",117,0)
 ;     6 - BIFH   (opt) F=report on Flu Vaccine Group (default), H=H1N1 group.
"RTN","BIREPF2",118,0)
 ;     7 - BIUP   (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPF2",119,0)
 ;
"RTN","BIREPF2",120,0)
 K ^TMP("BIREPF1",$J)
"RTN","BIREPF2",121,0)
 N BILINE,BITMP,X S BILINE=0,BIPOP=0
"RTN","BIREPF2",122,0)
 ;
"RTN","BIREPF2",123,0)
 ;---> Check for required Variables.
"RTN","BIREPF2",124,0)
 ;
"RTN","BIREPF2",125,0)
 I '$G(BIYEAR) D ERRCD^BIUTL2(679,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPF2",126,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPF2",127,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPF2",128,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPF2",129,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPF2",130,0)
 S:($G(BIFH)="") BIFH="F"
"RTN","BIREPF2",131,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPF2",132,0)
 ;
"RTN","BIREPF2",133,0)
 ;---> Write Age Totals line.
"RTN","BIREPF2",134,0)
 D AGETOT^BIREPF3(.BILINE,.BICC,.BIHCF,.BICM,.BIBEN,BIYEAR,.BIPOP,BIFH,BIUP)
"RTN","BIREPF2",135,0)
 Q:BIPOP
"RTN","BIREPF2",136,0)
 ;
"RTN","BIREPF2",137,0)
 ;---> Write Approp for Age and Vaccine Group lines.
"RTN","BIREPF2",138,0)
 ;D APPROP^BIREPF3(.BILINE)
"RTN","BIREPF2",139,0)
 ;
"RTN","BIREPF2",140,0)
 ;---> Write Statistics lines for each Vaccine Group (BIVGRP).
"RTN","BIREPF2",141,0)
 ;F BIVGRP=1,2,6,3,4,7,9,11,15 D VGRP^BIREPF3(.BILINE,BIVGRP)
"RTN","BIREPF2",142,0)
 ;---> If report is for H1N1, then display vaccine group 18; otherwise Flu (10).
"RTN","BIREPF2",143,0)
 S BIVGRP=$S(BIFH="H":18,1:10)
"RTN","BIREPF2",144,0)
 D VGRP^BIREPF3(.BILINE,BIVGRP,BIYEAR)
"RTN","BIREPF2",145,0)
 ;
"RTN","BIREPF2",146,0)
 ;---> For Flu Report (not H1N1) write Approp for Age and Vaccine Group lines.
"RTN","BIREPF2",147,0)
 D:BIVGRP=10 APPROP^BIREPF3(.BILINE)
"RTN","BIREPF2",148,0)
 ;
"RTN","BIREPF2",149,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPF2",150,0)
 N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPF2",151,0)
 S X="  Total Patients included who had Influenza Refusals on record"_$J(N,15)
"RTN","BIREPF2",152,0)
 D WRITE^BIREPF3(.BILINE,X),WRITE^BIREPF3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF2",153,0)
 ;
"RTN","BIREPF2",154,0)
 S X="  *NOTE: The 18-49hr column tallies patients who are High Risk in that"
"RTN","BIREPF2",155,0)
 D WRITE^BIREPF3(.BILINE,X)
"RTN","BIREPF2",156,0)
 S X="         Age Group.  They are not included in the normal 18-49y column."
"RTN","BIREPF2",157,0)
 D WRITE^BIREPF3(.BILINE,X),WRITE^BIREPF3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF2",158,0)
 ;
"RTN","BIREPF2",159,0)
 S VALMCNT=BILINE
"RTN","BIREPF2",160,0)
 Q
"RTN","BIREPF2",161,0)
 ;
"RTN","BIREPF2",162,0)
 ;
"RTN","BIREPF2",163,0)
 ;----------
"RTN","BIREPF2",164,0)
WRITERR(BILINE,X) ;EP
"RTN","BIREPF2",165,0)
 ;---> Write error line to report.
"RTN","BIREPF2",166,0)
 ;---> Parameters:
"RTN","BIREPF2",167,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPF2",168,0)
 ;     2 - BIVAL  (req) Error text.
"RTN","BIREPF2",169,0)
 ;
"RTN","BIREPF2",170,0)
 S:'$D(X) X="No error text."
"RTN","BIREPF2",171,0)
 S:'$D(BILINE) BILINE=1
"RTN","BIREPF2",172,0)
 D WRITE^BIREPF3(.BILINE,X) S VALMCNT=BILINE
"RTN","BIREPF2",173,0)
 Q
"RTN","BIREPF3")
0^102^B29304058
"RTN","BIREPF3",1,0)
BIREPF3 ;IHS/CMI/MWR - REPORT, FLU IMM; MAY 10, 2010
"RTN","BIREPF3",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPF3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPF3",4,0)
 ;;  VIEW INFLUENZA IMMUNIZATION REPORT.
"RTN","BIREPF3",5,0)
 ;
"RTN","BIREPF3",6,0)
 ;
"RTN","BIREPF3",7,0)
 ;----------
"RTN","BIREPF3",8,0)
AGETOT(BILINE,BICC,BIHCF,BICM,BIBEN,BIYEAR,BIPOP,BIFH,BIUP) ;EP
"RTN","BIREPF3",9,0)
 ;---> Write Age Total line.
"RTN","BIREPF3",10,0)
 ;---> Parameters:
"RTN","BIREPF3",11,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPF3",12,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPF3",13,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPF3",14,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPF3",15,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPF3",16,0)
 ;     6 - BIYEAR (req) Report Year^m (if 2nd pc="m", then End Date=March 31 of
"RTN","BIREPF3",17,0)
 ;                      the report year; otherwise End Date=Dec 31 of BIYEAR)
"RTN","BIREPF3",18,0)
 ;     7 - BIPOP  (ret) BIPOP=1 if error.
"RTN","BIREPF3",19,0)
 ;     8 - BIFH   (opt) F=report on Flu Vaccine Group (default), H=H1N1 group.
"RTN","BIREPF3",20,0)
 ;     9 - BIUP   (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPF3",21,0)
 ;
"RTN","BIREPF3",22,0)
 S BIPOP=0
"RTN","BIREPF3",23,0)
 S:($G(BIFH)="") BIFH="F"
"RTN","BIREPF3",24,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPF3",25,0)
 ;---> Check for required Variables.
"RTN","BIREPF3",26,0)
 I '$G(BIYEAR) D ERRCD^BIUTL2(679,.X) D WRITERR^BIREPF2(BILINE,X) S BIPOP=1 Q
"RTN","BIREPF3",27,0)
 N BIQDT S BIQDT=(BIYEAR-1700)_1231
"RTN","BIREPF3",28,0)
 ;
"RTN","BIREPF3",29,0)
 ;---> Gather and sort patients.
"RTN","BIREPF3",30,0)
 N N S N=0
"RTN","BIREPF3",31,0)
 F I="10-23","24-59","60-215","216-599","600-779","780-1500" D
"RTN","BIREPF3",32,0)
 .;---> For each age range, get Begin and End Dates (DOB's).
"RTN","BIREPF3",33,0)
 .D AGEDATE^BIAGE(I,BIQDT,.BIBEGDT,.BIENDDT)
"RTN","BIREPF3",34,0)
 .;---> Leave an Age Group=5 for High Risk (subset of Group 4
"RTN","BIREPF3",35,0)
 .S N=N+1 S:(N=5) N=6
"RTN","BIREPF3",36,0)
 .D GETPATS^BIREPF4(BIBEGDT,BIENDDT,N,.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BIFH,BIYEAR,BIUP)
"RTN","BIREPF3",37,0)
 ;
"RTN","BIREPF3",38,0)
 ;---> Count patients.
"RTN","BIREPF3",39,0)
 N BIAGRP,BITOT S BITOT=0
"RTN","BIREPF3",40,0)
 F I=1:1:7 D
"RTN","BIREPF3",41,0)
 .N M,N S M=0,N=0,BIAGRP(I)=0
"RTN","BIREPF3",42,0)
 .F  S N=$O(^TMP("BIREPF1",$J,"PATS",I,N)) Q:'N  D
"RTN","BIREPF3",43,0)
 ..;---> Yes, now include Age Group 5 (18-49 High Risk) in Totals.
"RTN","BIREPF3",44,0)
 ..;S BIAGRP(I)=BIAGRP(I)+1 S:(I'=5) BITOT=BITOT+1
"RTN","BIREPF3",45,0)
 ..S BIAGRP(I)=BIAGRP(I)+1 S BITOT=BITOT+1
"RTN","BIREPF3",46,0)
 .S BITMP("STATS","TOTAL",I)=BIAGRP(I)
"RTN","BIREPF3",47,0)
 S BITMP("STATS","TOTAL","ALL")=BITOT
"RTN","BIREPF3",48,0)
 ;
"RTN","BIREPF3",49,0)
 ;---> Write Age Totals line.
"RTN","BIREPF3",50,0)
 ;N X S X=" # in Age |"
"RTN","BIREPF3",51,0)
 N X S X=" Denominator |"
"RTN","BIREPF3",52,0)
 ;X ^O
"RTN","BIREPF3",53,0)
 F I=1:1:7 S X=X_$J($G(BIAGRP(I)),6)_"  "
"RTN","BIREPF3",54,0)
 S X=$E(X,1,$L(X)-2)_" |"_$J(BITOT,7)
"RTN","BIREPF3",55,0)
 D WRITE(.BILINE,X)
"RTN","BIREPF3",56,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF3",57,0)
 Q
"RTN","BIREPF3",58,0)
 ;
"RTN","BIREPF3",59,0)
 ;
"RTN","BIREPF3",60,0)
 ;----------
"RTN","BIREPF3",61,0)
VGRP(BILINE,BIVGRP,BIYEAR) ;EP
"RTN","BIREPF3",62,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPF3",63,0)
 ;---> Parameters:
"RTN","BIREPF3",64,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPF3",65,0)
 ;     2 - BIVGRP (req) IEN of Vaccine Group.
"RTN","BIREPF3",66,0)
 ;     3 - BIYEAR (req) Report Year.
"RTN","BIREPF3",67,0)
 ;
"RTN","BIREPF3",68,0)
 ;---> Write a line for each Dose of this Vaccine Group.
"RTN","BIREPF3",69,0)
 ;N BIDOSE,BIMAXD S BIMAXD=$$VGROUP^BIUTL2(BIVGRP,6)
"RTN","BIREPF3",70,0)
 N BIDOSE,BIMAXD S BIMAXD=1
"RTN","BIREPF3",71,0)
 ;---> For H1N1 Report display 2 doses.
"RTN","BIREPF3",72,0)
 S:BIVGRP=18 BIMAXD=2
"RTN","BIREPF3",73,0)
 F BIDOSE=1:1:BIMAXD D
"RTN","BIREPF3",74,0)
 .;
"RTN","BIREPF3",75,0)
 .;---> *** WRITE DOSE 1 LINE:
"RTN","BIREPF3",76,0)
 .;---> BIX=text of the line to write.
"RTN","BIREPF3",77,0)
 .;---> Write the Dose#-Vaccine Group in left margin.
"RTN","BIREPF3",78,0)
 .N BIX S BIX="   "_BIDOSE_"-"_$$VGROUP^BIUTL2(BIVGRP,5)
"RTN","BIREPF3",79,0)
 .S BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPF3",80,0)
 .;
"RTN","BIREPF3",81,0)
 .;---> Now loop through the Age Groups, concating subtotals.
"RTN","BIREPF3",82,0)
 .N BIAGRP,BISUBT S BISUBT=0
"RTN","BIREPF3",83,0)
 .F BIAGRP=1:1:7 D
"RTN","BIREPF3",84,0)
 ..;---> BITMP(Vaccine Grp, CURRENT Season, Dose, Age Grp)
"RTN","BIREPF3",85,0)
 ..N Y S Y=+$G(BITMP("STATS",BIVGRP,1,BIDOSE,BIAGRP))
"RTN","BIREPF3",86,0)
 ..;---> Write stats for each Age Group, but don't include 5 in total.
"RTN","BIREPF3",87,0)
 ..;S BIX=BIX_$J(Y,6)_"  " S:(BIAGRP'=5) BISUBT=BISUBT+Y
"RTN","BIREPF3",88,0)
 ..;---> Yes, now include Age Group 5 (18-49 High Risk) in Totals.
"RTN","BIREPF3",89,0)
 ..S BIX=BIX_$J(Y,6)_"  " S BISUBT=BISUBT+Y
"RTN","BIREPF3",90,0)
 .;
"RTN","BIREPF3",91,0)
 .S BIX=$E(BIX,1,$L(BIX)-2)_" |"_$J(BISUBT,7)
"RTN","BIREPF3",92,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPF3",93,0)
 .I BIDOSE=1 D MARK^BIW(BILINE,BIMAXD+2,"BIREPF1")
"RTN","BIREPF3",94,0)
 .;
"RTN","BIREPF3",95,0)
 .;---> *** NOW WRITE PERCENTAGES LINE:
"RTN","BIREPF3",96,0)
 .;---> BIX=text of the line to write.
"RTN","BIREPF3",97,0)
 .;---> Write "YYYY Season" in left margin.
"RTN","BIREPF3",98,0)
 .S:'$G(BIYEAR) BIYEAR="YYYY"
"RTN","BIREPF3",99,0)
 .K BIX N BIX S BIX=" "_+BIYEAR_" Season "
"RTN","BIREPF3",100,0)
 .S BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPF3",101,0)
 .;
"RTN","BIREPF3",102,0)
 .;---> Now loop through the Age Groups, writing percentages.
"RTN","BIREPF3",103,0)
 .F BIAGRP=1:1:7 D
"RTN","BIREPF3",104,0)
 ..;---> BITMP(Vaccine Grp, CURRENT Season, Dose, Age Grp)
"RTN","BIREPF3",105,0)
 ..N Y S Y=$G(BITMP("STATS",BIVGRP,1,BIDOSE,BIAGRP)) S:Y="" Y=0
"RTN","BIREPF3",106,0)
 ..N Z S Z=$G(BITMP("STATS","TOTAL",BIAGRP)) S:'Z Y=0,Z=1
"RTN","BIREPF3",107,0)
 ..S BIX=BIX_"   "_$J((100*Y/Z),3,0)_"% "
"RTN","BIREPF3",108,0)
 .;
"RTN","BIREPF3",109,0)
 .;---> Now write total percentage.
"RTN","BIREPF3",110,0)
 .N Y S Y=BISUBT S:Y="" Y=0
"RTN","BIREPF3",111,0)
 .N Z S Z=$G(BITMP("STATS","TOTAL","ALL")) S:'Z Y=0,Z=1
"RTN","BIREPF3",112,0)
 .S BIX=$$PAD^BIUTL5(BIX,69)_"|    "_$J((100*Y/Z),3,0)_"%"
"RTN","BIREPF3",113,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPF3",114,0)
 .;---> If H1N1, write final line (since we won't write a "Fully Immunized" row).
"RTN","BIREPF3",115,0)
 .D:BIVGRP=18 WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF3",116,0)
 ;
"RTN","BIREPF3",117,0)
 ;---> Do not write for H1N1 (since we won't write a "Fully Immunized" row).
"RTN","BIREPF3",118,0)
 D:BIVGRP'=18 WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF3",119,0)
 Q
"RTN","BIREPF3",120,0)
 ;
"RTN","BIREPF3",121,0)
 ;
"RTN","BIREPF3",122,0)
 ;----------
"RTN","BIREPF3",123,0)
APPROP(BILINE) ;EP
"RTN","BIREPF3",124,0)
 ;---> Write Appropriate for Age lines.
"RTN","BIREPF3",125,0)
 ;---> Parameters:
"RTN","BIREPF3",126,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPF3",127,0)
 ;
"RTN","BIREPF3",128,0)
 ;---> Numbers of appropriate line.
"RTN","BIREPF3",129,0)
 ;N BITOT,X S BITOT=0,X=" Appropriate |"
"RTN","BIREPF3",130,0)
 N BITOT,X S BITOT=0,X="    Fully    |"
"RTN","BIREPF3",131,0)
 F BIAGRP=1:1:7 D
"RTN","BIREPF3",132,0)
 .N Y S Y=$G(BITMP("STATS","APPRO",BIAGRP)) S:Y="" Y=0
"RTN","BIREPF3",133,0)
 .;---> Yes, now include Age Group 5 (18-49 High Risk) in Totals.
"RTN","BIREPF3",134,0)
 .;S X=X_$J(Y,6)_"  " S:(BIAGRP'=5) BITOT=BITOT+Y
"RTN","BIREPF3",135,0)
 .S X=X_$J(Y,6)_"  " S BITOT=BITOT+Y
"RTN","BIREPF3",136,0)
 ;
"RTN","BIREPF3",137,0)
 S X=$E(X,1,$L(X)-2) S X=$$PAD^BIUTL5(X,69)_"|"_$J(BITOT,7)
"RTN","BIREPF3",138,0)
 D WRITE(.BILINE,X)
"RTN","BIREPF3",139,0)
 D MARK^BIW(BILINE,3,"BIREPF1")
"RTN","BIREPF3",140,0)
 ;
"RTN","BIREPF3",141,0)
 ;---> Percentage of appropriate line.
"RTN","BIREPF3",142,0)
 ;S X="   for Age   |",BITOT=0
"RTN","BIREPF3",143,0)
 S X="  Immunized  |",BITOT=0
"RTN","BIREPF3",144,0)
 F BIAGRP=1:1:7 D
"RTN","BIREPF3",145,0)
 .N Y S Y=$G(BITMP("STATS","APPRO",BIAGRP)) S:Y="" Y=0
"RTN","BIREPF3",146,0)
 .N Z S Z=$G(BITMP("STATS","TOTAL",BIAGRP)) S:'Z Y=0,Z=1
"RTN","BIREPF3",147,0)
 .N BIPERC S BIPERC="   "_$J((100*Y/Z),3,0)_"%"
"RTN","BIREPF3",148,0)
 .S X=X_BIPERC_" " S:(BIAGRP'=5) BITOT=BITOT+Y
"RTN","BIREPF3",149,0)
 ;
"RTN","BIREPF3",150,0)
 N Y S Y=BITOT S:Y="" Y=0
"RTN","BIREPF3",151,0)
 N Z S Z=$G(BITMP("STATS","TOTAL","ALL")) S:'Z Y=0,Z=1
"RTN","BIREPF3",152,0)
 ;S X=$E(X,1,$L(X)-2)_"|    "_$J((100*Y/Z),3,0)_"%"
"RTN","BIREPF3",153,0)
 S X=$E(X,1,$L(X)-1) S X=$$PAD^BIUTL5(X,69)_"|    "_$J((100*Y/Z),3,0)_"%"
"RTN","BIREPF3",154,0)
 D WRITE(.BILINE,X)
"RTN","BIREPF3",155,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPF3",156,0)
 Q
"RTN","BIREPF3",157,0)
 ;
"RTN","BIREPF3",158,0)
 ;
"RTN","BIREPF3",159,0)
 ;----------
"RTN","BIREPF3",160,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPF3",161,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPF3",162,0)
 ;---> Parameters:
"RTN","BIREPF3",163,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPF3",164,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPF3",165,0)
 ;
"RTN","BIREPF3",166,0)
 Q:'$D(BILINE)
"RTN","BIREPF3",167,0)
 D WL^BIW(.BILINE,"BIREPF1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPF3",168,0)
 Q
"RTN","BIREPF4")
0^103^B45795532
"RTN","BIREPF4",1,0)
BIREPF4 ;IHS/CMI/MWR - REPORT, FLU IMM; OCT 15, 2010
"RTN","BIREPF4",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIREPF4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPF4",4,0)
 ;;  INFLUENZA IMM REPORT, GATHER/STORE PATIENTS.
"RTN","BIREPF4",5,0)
 ;;  PATCH 1: Exclude patients whose Inactive Date=Not in Register.  CHKSET+31
"RTN","BIREPF4",6,0)
 ;;  PATCH 2: Filter for Active Clinical, all ages, using $$ACTCLIN^BIUTL6 call.
"RTN","BIREPF4",7,0)
 ;;           CHKSET+39
"RTN","BIREPF4",8,0)
 ;;  PATCH 5: Begin Flu Report on July 1.  CHKSET+107
"RTN","BIREPF4",9,0)
 ;
"RTN","BIREPF4",10,0)
 ;
"RTN","BIREPF4",11,0)
 ;----------
"RTN","BIREPF4",12,0)
GETPATS(BIBEGDT,BIENDDT,BIAGRP,BICC,BIHCF,BICM,BIBEN,BIQDT,BIFH,BIYEAR,BIUP) ;EP
"RTN","BIREPF4",13,0)
 ;---> Get patients from VA PATIENT File, ^DPT(.
"RTN","BIREPF4",14,0)
 ;---> Parameters:
"RTN","BIREPF4",15,0)
 ;     1 - BIBEGDT (req) Begin DOB for this group.
"RTN","BIREPF4",16,0)
 ;     2 - BIENDDT (req) End DOB for this group.
"RTN","BIREPF4",17,0)
 ;     3 - BIAGRP  (req) Node/number for this Age Group.
"RTN","BIREPF4",18,0)
 ;     4 - BICC    (req) Current Community array.
"RTN","BIREPF4",19,0)
 ;     5 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPF4",20,0)
 ;     6 - BICM    (req) Case Manager array.
"RTN","BIREPF4",21,0)
 ;     7 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPF4",22,0)
 ;     8 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPF4",23,0)
 ;     9 - BIFH    (req) F=report on Flu Vaccine Group (default), H=H1N1 group.
"RTN","BIREPF4",24,0)
 ;    10 - BIYEAR  (req) Report Year^m (if 2nd pc="m", then End Date=March 31 of
"RTN","BIREPF4",25,0)
 ;                       the report year; otherwise End Date=Dec 31 of BIYEAR)
"RTN","BIREPF4",26,0)
 ;    11 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPF4",27,0)
 ;
"RTN","BIREPF4",28,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIREPF4",29,0)
 ;
"RTN","BIREPF4",30,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)  Q:'$G(BIAGRP)  Q:'$G(BIYEAR)
"RTN","BIREPF4",31,0)
 ;---> Start 1 day prior to Begin Date and $O into the desired DOB's.
"RTN","BIREPF4",32,0)
 N N S N=BIBEGDT-1
"RTN","BIREPF4",33,0)
 F  S N=$O(^DPT("ADOB",N)) Q:(N>BIENDDT!('N))  D
"RTN","BIREPF4",34,0)
 .S BIDFN=0
"RTN","BIREPF4",35,0)
 .F  S BIDFN=$O(^DPT("ADOB",N,BIDFN)) Q:'BIDFN  D
"RTN","BIREPF4",36,0)
 ..D CHKSET(BIDFN,.BICC,.BIHCF,.BICM,.BIBEN,BIAGRP,BIQDT,BIFH,BIYEAR,BIUP)
"RTN","BIREPF4",37,0)
 Q
"RTN","BIREPF4",38,0)
 ;
"RTN","BIREPF4",39,0)
 ;
"RTN","BIREPF4",40,0)
 ;----------
"RTN","BIREPF4",41,0)
CHKSET(BIDFN,BICC,BIHCF,BICM,BIBEN,BIAGRP,BIQDT,BIFH,BIYEAR,BIUP) ;EP
"RTN","BIREPF4",42,0)
 ;---> Check if this patient fits criteria; if so, set DFN
"RTN","BIREPF4",43,0)
 ;---> in ^TMP("BIREPF1".
"RTN","BIREPF4",44,0)
 ;---> Parameters:
"RTN","BIREPF4",45,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIREPF4",46,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPF4",47,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPF4",48,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPF4",49,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPF4",50,0)
 ;     6 - BIAGRP (req) Node/number for this Age Group.
"RTN","BIREPF4",51,0)
 ;     7 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPF4",52,0)
 ;     8 - BIFH   (req) F=report on Flu Vaccine Group, H=H1N1 group.
"RTN","BIREPF4",53,0)
 ;     9 - BIYEAR (req) Report Year^m (if 2nd pc="m", then End Date=March 31 of
"RTN","BIREPF4",54,0)
 ;                       the report year; otherwise End Date=Dec 31 of BIYEAR)
"RTN","BIREPF4",55,0)
 ;    10 - BIUP   (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPF4",56,0)
 ;
"RTN","BIREPF4",57,0)
 Q:'$G(BIDFN)
"RTN","BIREPF4",58,0)
 Q:'$D(BICC)
"RTN","BIREPF4",59,0)
 Q:'$D(BIHCF)
"RTN","BIREPF4",60,0)
 Q:'$D(BICM)
"RTN","BIREPF4",61,0)
 Q:'$D(BIBEN)
"RTN","BIREPF4",62,0)
 Q:'$G(BIAGRP)
"RTN","BIREPF4",63,0)
 Q:'$G(BIQDT)
"RTN","BIREPF4",64,0)
 S:($G(BIFH)="") BIFH="F"
"RTN","BIREPF4",65,0)
 Q:'$G(BIYEAR)
"RTN","BIREPF4",66,0)
 Q:$G(BIUP)=""
"RTN","BIREPF4",67,0)
 ;
"RTN","BIREPF4",68,0)
 ;---> Quit if patient is not in the Register.
"RTN","BIREPF4",69,0)
 Q:'$D(^BIP(BIDFN,0))
"RTN","BIREPF4",70,0)
 ;
"RTN","BIREPF4",71,0)
 ;---> Filter for standard Patient Population parameter.
"RTN","BIREPF4",72,0)
 Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIQDT,BIUP)
"RTN","BIREPF4",73,0)
 ;
"RTN","BIREPF4",74,0)
 ;---> For first Age Group, 10-23m, filter by Active in Imm Register.
"RTN","BIREPF4",75,0)
 ;---> Quit if patient became Inactive before the Quarter Ending Date.
"RTN","BIREPF4",76,0)
 ;I BIAGRP=1 N X S X=$$INACT^BIUTL1(BIDFN) I X]"" Q:X<BIQDT
"RTN","BIREPF4",77,0)
 ;
"RTN","BIREPF4",78,0)
 ;---> For 18-49y Age Group, if this patient is High Risk for Flu set BIRISKI=1.
"RTN","BIREPF4",79,0)
 N BIRISKI S BIRISKI=0
"RTN","BIREPF4",80,0)
 ;---> Note: Third parameter=1 (retrieve Flu risk only).
"RTN","BIREPF4",81,0)
 D:BIAGRP=4 RISK^BIDX(BIDFN,$E(BIQDT,1,3)_"0901",1,.BIRISKI)
"RTN","BIREPF4",82,0)
 ;---> Uncomment next line to test High Risk.
"RTN","BIREPF4",83,0)
 ;S:(BIDFN=30) BIRISKI=1  ;MWRZZZ
"RTN","BIREPF4",84,0)
 ;---> If this patient is (18-49y) High Risk, change Age Group to 5.
"RTN","BIREPF4",85,0)
 I BIRISKI S BIAGRP=5
"RTN","BIREPF4",86,0)
 ;
"RTN","BIREPF4",87,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPF4",88,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPF4",89,0)
 ;
"RTN","BIREPF4",90,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPF4",91,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPF4",92,0)
 ;
"RTN","BIREPF4",93,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPF4",94,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPF4",95,0)
 ;
"RTN","BIREPF4",96,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPF4",97,0)
 S ^TMP("BIREPF1",$J,"PATS",BIAGRP,BIDFN)=""
"RTN","BIREPF4",98,0)
 ;
"RTN","BIREPF4",99,0)
 ;---> RPC to gather Immunization History.
"RTN","BIREPF4",100,0)
 N BI31,BIDE,BIRETVAL,BIRETERR,I S BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIREPF4",101,0)
 ;---> 55=Vaccine Group IEN, 56=Date of Visit (Fileman), 65=Dose Override.
"RTN","BIREPF4",102,0)
 F I=55,56,65 S BIDE(I)=""
"RTN","BIREPF4",103,0)
 ;---> Fourth parameter=0: Do not return Skin Tests.
"RTN","BIREPF4",104,0)
 ;---> Fifth parameter=0: Split out combinations as if given individually.
"RTN","BIREPF4",105,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,0,0)
"RTN","BIREPF4",106,0)
 ;
"RTN","BIREPF4",107,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BIREPF4",108,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIREPF4",109,0)
 Q:BIRETERR]""
"RTN","BIREPF4",110,0)
 ;
"RTN","BIREPF4",111,0)
 ;---> Add refusals, if any.
"RTN","BIREPF4",112,0)
 N Z D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) D
"RTN","BIREPF4",113,0)
 .;---> If this refusal is for an Influenza vaccine, count it.
"RTN","BIREPF4",114,0)
 .N I F I=15,16,88,111,123,135 I $D(Z(I)) S BITMP("REFUSALS",BIDFN)=""
"RTN","BIREPF4",115,0)
 ;
"RTN","BIREPF4",116,0)
 ;---> Set BIHX=to a valid Immunization History.
"RTN","BIREPF4",117,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BIREPF4",118,0)
 ;
"RTN","BIREPF4",119,0)
 ;---> Add this Patient's History to stats.
"RTN","BIREPF4",120,0)
 N I,Y
"RTN","BIREPF4",121,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BIREPF4",122,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BIREPF4",123,0)
 .;
"RTN","BIREPF4",124,0)
 .;---> Set this immunization in the STATS array by:
"RTN","BIREPF4",125,0)
 .;---> Vaccine Group (V), Dose# (D), and Age (A), and Current Season (C).
"RTN","BIREPF4",126,0)
 .N A,C,D,Q,V
"RTN","BIREPF4",127,0)
 .S A=BIAGRP,V=$P(Y,"|",2)
"RTN","BIREPF4",128,0)
 .;
"RTN","BIREPF4",129,0)
 .;---> Quit if this is not a Flu vaccine or H1N1.
"RTN","BIREPF4",130,0)
 .I BIFH="H" Q:(V'=18)
"RTN","BIREPF4",131,0)
 .;---> Default="F" (Flu).
"RTN","BIREPF4",132,0)
 .I BIFH'="H" Q:(V'=10)
"RTN","BIREPF4",133,0)
 .;I $G(BIFH)'="H" Q:(V'=18)
"RTN","BIREPF4",134,0)
 .;
"RTN","BIREPF4",135,0)
 .;---> Quit if this dose is marked INVALID.
"RTN","BIREPF4",136,0)
 .I $P(Y,"|",4),$P(Y,"|",4)<9 Q
"RTN","BIREPF4",137,0)
 .;
"RTN","BIREPF4",138,0)
 .;---> Quit (don't count) if Visit was AFTER the Report Year End Date.
"RTN","BIREPF4",139,0)
 .N BIDT S BIDT=$P(Y,"|",3)
"RTN","BIREPF4",140,0)
 .;---> If the Report End Date is not March 31, then quit if visit is after
"RTN","BIREPF4",141,0)
 .;---> the Quarter Ending Date (12/31 of the Report Year).
"RTN","BIREPF4",142,0)
 .I $P(BIYEAR,U,2)'="m" Q:(BIDT>BIQDT)
"RTN","BIREPF4",143,0)
 .;---> Quit if visit is after March Report End Date (following the Report Year).
"RTN","BIREPF4",144,0)
 .Q:(BIDT>(($E(BIQDT,1,3)+1)_"0331"))
"RTN","BIREPF4",145,0)
 .;
"RTN","BIREPF4",146,0)
 .;---> If this was in the current season, C=1; otherwise C=0 (before this season).
"RTN","BIREPF4",147,0)
 .D
"RTN","BIREPF4",148,0)
 ..;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIREPF4",149,0)
 ..;---> Begin Flu Report on July 1.
"RTN","BIREPF4",150,0)
 ..;I BIDT<($E(BIQDT,1,3)_"0901") S C=0 Q
"RTN","BIREPF4",151,0)
 ..I BIDT<($E(BIQDT,1,3)_"0701") S C=0 Q
"RTN","BIREPF4",152,0)
 ..;**********
"RTN","BIREPF4",153,0)
 ..S C=1
"RTN","BIREPF4",154,0)
 .;
"RTN","BIREPF4",155,0)
 .;---> Set Dose# (increment by 1's to assign highest/latest dose#).
"RTN","BIREPF4",156,0)
 .S D=1,Q=0
"RTN","BIREPF4",157,0)
 .F  Q:Q  D
"RTN","BIREPF4",158,0)
 ..;---> Set: BIHX(Vaccine Grp, Current Season, Dose)
"RTN","BIREPF4",159,0)
 ..I $D(BIHX(V,C,D)) S D=D+1 Q
"RTN","BIREPF4",160,0)
 ..S BIHX(V,C,D)="",Q=1
"RTN","BIREPF4",161,0)
 .;
"RTN","BIREPF4",162,0)
 .;---> Set: BITMP(Vaccine Grp, Season, Dose, Age Grp)
"RTN","BIREPF4",163,0)
 .N Z S Z=$G(BITMP("STATS",V,C,D,A)) S BITMP("STATS",V,C,D,A)=Z+1
"RTN","BIREPF4",164,0)
 .;---> If Age Group 18-19y and pt is High Risk, set stat for Age Group 5.
"RTN","BIREPF4",165,0)
 .;Q:((A'=4)!('BIRISKI))
"RTN","BIREPF4",166,0)
 .;S Z=$G(BITMP("STATS",V,C,D,5)) S BITMP("STATS",V,C,D,5)=Z+1
"RTN","BIREPF4",167,0)
 ;
"RTN","BIREPF4",168,0)
 ;
"RTN","BIREPF4",169,0)
 ;---> Next Section:
"RTN","BIREPF4",170,0)
 ;---> If this patient has the minimum required immunizations for
"RTN","BIREPF4",171,0)
 ;---> his/her Age Group, then increment by 1 the "Appro for Age"
"RTN","BIREPF4",172,0)
 ;---> tally for that Age Group.
"RTN","BIREPF4",173,0)
 ;---> The code examines Imm Hx array BIHX(VacGrp, Current Season, Dose#) for
"RTN","BIREPF4",174,0)
 ;---> each patient.
"RTN","BIREPF4",175,0)
 ;---> Each Quit represents a condition that a child in that age group
"RTN","BIREPF4",176,0)
 ;---> must meet in order to be "appropriate for age."
"RTN","BIREPF4",177,0)
 ;
"RTN","BIREPF4",178,0)
 ;---> Following lines matrix: Vaccine Group, Dose#.
"RTN","BIREPF4",179,0)
 ;
"RTN","BIREPF4",180,0)
 ;---> X=1 is NOT Current/appropriate for age; X=2 IS Current/appropriate for age.
"RTN","BIREPF4",181,0)
 N X
"RTN","BIREPF4",182,0)
 ;---> For 6-23m old patients (BIAGRP=1).
"RTN","BIREPF4",183,0)
 S X=1
"RTN","BIREPF4",184,0)
 I BIAGRP=1 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPF4",185,0)
 .Q:'$D(BIHX(10))
"RTN","BIREPF4",186,0)
 .;---> If patient has Flu, Current season, 2 doses; then he's appropriate.
"RTN","BIREPF4",187,0)
 .I $D(BIHX(10,1,2)) D APPRO(BIAGRP) S X=2 Q
"RTN","BIREPF4",188,0)
 .;---> If pt has Current season, 1 dose; Past season, 1 dose; then appropriate.
"RTN","BIREPF4",189,0)
 .I $D(BIHX(10,1,1)),$D(BIHX(10,0,1)) D APPRO(BIAGRP) S X=2 Q
"RTN","BIREPF4",190,0)
 ;
"RTN","BIREPF4",191,0)
 ;---> For 2-4y old patients (BIAGRP=2).
"RTN","BIREPF4",192,0)
 S X=1
"RTN","BIREPF4",193,0)
 I BIAGRP=2 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPF4",194,0)
 .Q:'$D(BIHX(10))
"RTN","BIREPF4",195,0)
 .;---> If patient has Flu, Current season, 2 doses; then he's appropriate.
"RTN","BIREPF4",196,0)
 .I $D(BIHX(10,1,2)) D APPRO(BIAGRP) S X=2 Q
"RTN","BIREPF4",197,0)
 .;---> If pt has Current season, 1 dose; Past season, 2 doses; then appropriate.
"RTN","BIREPF4",198,0)
 .I $D(BIHX(10,1,1)),$D(BIHX(10,0,2)) D APPRO(BIAGRP) S X=2 Q
"RTN","BIREPF4",199,0)
 ;
"RTN","BIREPF4",200,0)
 S X=1
"RTN","BIREPF4",201,0)
 ;---> For all other Age Groups.
"RTN","BIREPF4",202,0)
 D  D STOR(BIDFN,BIQDT,X)
"RTN","BIREPF4",203,0)
 .Q:'$D(BIHX(10))
"RTN","BIREPF4",204,0)
 .;---> If patient has Flu, Current season 1 dose; then he's appropriate.
"RTN","BIREPF4",205,0)
 .;---> Also, if this is 18-49 and the patient is High Risk set in Group 5.
"RTN","BIREPF4",206,0)
 .I $D(BIHX(10,1,1)) D APPRO(BIAGRP) D:((BIAGRP=4)&BIRISKI) APPRO(5) S X=2 Q
"RTN","BIREPF4",207,0)
 Q
"RTN","BIREPF4",208,0)
 ;
"RTN","BIREPF4",209,0)
 ;
"RTN","BIREPF4",210,0)
 ;----------
"RTN","BIREPF4",211,0)
APPRO(BIAGRP) ;EP
"RTN","BIREPF4",212,0)
 ;---> Store Patient in Appropriate for Age Group.
"RTN","BIREPF4",213,0)
 ;---> Parameters:
"RTN","BIREPF4",214,0)
 ;     1 - BIAGRP (req) Node/number for this Age Group.
"RTN","BIREPF4",215,0)
 ;
"RTN","BIREPF4",216,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPF4",217,0)
 N Z S Z=$G(BITMP("STATS","APPRO",BIAGRP))
"RTN","BIREPF4",218,0)
 S BITMP("STATS","APPRO",BIAGRP)=Z+1
"RTN","BIREPF4",219,0)
 Q
"RTN","BIREPF4",220,0)
 ;
"RTN","BIREPF4",221,0)
 ;
"RTN","BIREPF4",222,0)
 ;----------
"RTN","BIREPF4",223,0)
STOR(BIDFN,BIQDT,BIVAL) ;EP
"RTN","BIREPF4",224,0)
 ;---> Store in ^TMP for displaying List of Patients.
"RTN","BIREPF4",225,0)
 ;---> Parameters:
"RTN","BIREPF4",226,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIREPF4",227,0)
 ;     2 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPF4",228,0)
 ;     3 - BIVAL  (opt) Value to set ^TMP(Pat...) node equal to.
"RTN","BIREPF4",229,0)
 ;
"RTN","BIREPF4",230,0)
 Q:'$G(BIDFN)  S:'$G(BIQDT) BIQDT=DT
"RTN","BIREPF4",231,0)
 ;D UPDATE^BIPATUP(BIDFN,DT,,1)
"RTN","BIREPF4",232,0)
 D STORE^BIDUR1(BIDFN,BIQDT,1,,$G(BIVAL))
"RTN","BIREPF4",233,0)
 Q
"RTN","BIREPH")
0^104^B56034336
"RTN","BIREPH",1,0)
BIREPH ;IHS/CMI/MWR - REPORT, H1N1 ACCOUNTABILITY; AUG 10,2010
"RTN","BIREPH",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPH",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPH",4,0)
 ;;  VIEW H1N1 ACCOUNTABILITY REPORT.
"RTN","BIREPH",5,0)
 ;;  v8.3 PATCH 3: BIREPH* routines are completely new for H1N1 Report.
"RTN","BIREPH",6,0)
 ;;  v8.4 PATCH 1: EXPLAIN time frame of report: 8/1/09 to 8/31/10.  TEXT1+21
"RTN","BIREPH",7,0)
 ;
"RTN","BIREPH",8,0)
 ;
"RTN","BIREPH",9,0)
 ;----------
"RTN","BIREPH",10,0)
START ;EP
"RTN","BIREPH",11,0)
 ;---> Listman Screen for viewing Vaccine Accountability Report.
"RTN","BIREPH",12,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPH",13,0)
 ;
"RTN","BIREPH",14,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPH",15,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPH",16,0)
 ;
"RTN","BIREPH",17,0)
 D EN
"RTN","BIREPH",18,0)
 D EXIT
"RTN","BIREPH",19,0)
 Q
"RTN","BIREPH",20,0)
 ;
"RTN","BIREPH",21,0)
 ;
"RTN","BIREPH",22,0)
 ;----------
"RTN","BIREPH",23,0)
EN ;EP
"RTN","BIREPH",24,0)
 ;---> Main entry point for BI REPORT VAC ACCOUNTABILITY.
"RTN","BIREPH",25,0)
 D EN^VALM("BI REPORT H1N1")
"RTN","BIREPH",26,0)
 Q
"RTN","BIREPH",27,0)
 ;
"RTN","BIREPH",28,0)
 ;
"RTN","BIREPH",29,0)
 ;----------
"RTN","BIREPH",30,0)
INIT ;EP
"RTN","BIREPH",31,0)
 ;---> Initialize variables and list array.
"RTN","BIREPH",32,0)
 K ^TMP("BIREPH",$J)
"RTN","BIREPH",33,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPH",34,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPH",35,0)
 N BILINE,X S BILINE=0
"RTN","BIREPH",36,0)
 D WRITE(.BILINE)
"RTN","BIREPH",37,0)
 S X=IOUON_"H1N1 ACCOUNTABILITY REPORT"
"RTN","BIREPH",38,0)
 D CENTERT^BIUTL5(.X,42)
"RTN","BIREPH",39,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPH",40,0)
 K X
"RTN","BIREPH",41,0)
 ;
"RTN","BIREPH",42,0)
 ;---> Date Range.
"RTN","BIREPH",43,0)
 D
"RTN","BIREPH",44,0)
 .;---> Quit if dates have already been selected.
"RTN","BIREPH",45,0)
 .Q:$G(BIBEGDT)
"RTN","BIREPH",46,0)
 .;---> Default: A week before the previous Sunday to the next Saturday.
"RTN","BIREPH",47,0)
 .N X,X1,X2 S X=DT D H^%DTC
"RTN","BIREPH",48,0)
 .S X1=DT,X2=-(%Y+7) D C^%DTC S BIBEGDT=X
"RTN","BIREPH",49,0)
 .S X1=X,X2=6 D C^%DTC S BIENDDT=X
"RTN","BIREPH",50,0)
 ;
"RTN","BIREPH",51,0)
 ;D DATERNG^BIREP(.BILINE,"BIREPH",1,BIBEGDT,BIENDDT)
"RTN","BIREPH",52,0)
 ;
"RTN","BIREPH",53,0)
 D DATERNG^BIREP(.BILINE,"BIREPH",1,BIBEGDT,BIENDDT,1,1,1)
"RTN","BIREPH",54,0)
 ;
"RTN","BIREPH",55,0)
 ;---> Current Community.
"RTN","BIREPH",56,0)
 D DISP^BIREP(.BILINE,"BIREPH",.BICC,"Community",2,1)
"RTN","BIREPH",57,0)
 ;
"RTN","BIREPH",58,0)
 ;---> Health Care Facility.
"RTN","BIREPH",59,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPH",60,0)
 D DISP^BIREP(.BILINE,"BIREPH",.BIHCF,A,3,2,,,,B)
"RTN","BIREPH",61,0)
 ;
"RTN","BIREPH",62,0)
 ;---> Case Manager.
"RTN","BIREPH",63,0)
 D DISP^BIREP(.BILINE,"BIREPH",.BICM,"Case Manager",4,3)
"RTN","BIREPH",64,0)
 ;
"RTN","BIREPH",65,0)
 ;---> Beneficiary Type.
"RTN","BIREPH",66,0)
 D DISP^BIREP(.BILINE,"BIREPH",.BIBEN,"Beneficiary Type",5,4)
"RTN","BIREPH",67,0)
 ;
"RTN","BIREPH",68,0)
 ;---> Visit Type.
"RTN","BIREPH",69,0)
 D VTYPE^BIREP(.BILINE,"BIREPH",.BIVT,6)
"RTN","BIREPH",70,0)
 ;
"RTN","BIREPH",71,0)
 ;---> Include Historical.
"RTN","BIREPH",72,0)
 N BIHIST1 S BIHIST1=""
"RTN","BIREPH",73,0)
 S:'$D(BIHIST) BIHIST=1
"RTN","BIREPH",74,0)
 S BIHIST1=$S(BIHIST:"YES",1:"NO")
"RTN","BIREPH",75,0)
 S X="     7 - Include Historical.........: "_BIHIST1
"RTN","BIREPH",76,0)
 D WRITE(.BILINE,X)
"RTN","BIREPH",77,0)
 K X
"RTN","BIREPH",78,0)
 ;
"RTN","BIREPH",79,0)
 ;
"RTN","BIREPH",80,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPH",81,0)
 S VALMCNT=BILINE
"RTN","BIREPH",82,0)
 S BIRTN="BIREPH"
"RTN","BIREPH",83,0)
 Q
"RTN","BIREPH",84,0)
 ;
"RTN","BIREPH",85,0)
 ;
"RTN","BIREPH",86,0)
 ;----------
"RTN","BIREPH",87,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPH",88,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPH",89,0)
 ;---> Parameters:
"RTN","BIREPH",90,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPH",91,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPH",92,0)
 ;
"RTN","BIREPH",93,0)
 Q:'$D(BILINE)
"RTN","BIREPH",94,0)
 D WL^BIW(.BILINE,"BIREPH",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPH",95,0)
 Q
"RTN","BIREPH",96,0)
 ;
"RTN","BIREPH",97,0)
 ;
"RTN","BIREPH",98,0)
 ;----------
"RTN","BIREPH",99,0)
RESET ;EP
"RTN","BIREPH",100,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPH",101,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPH",102,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPH",103,0)
 ;
"RTN","BIREPH",104,0)
 ;---> NOT USED.  Could be used to correct margins.
"RTN","BIREPH",105,0)
 ;K VALMHDR S VALM("BM")=15,VALM("LINES")=14,VALM("TM")=2
"RTN","BIREPH",106,0)
 D INIT
"RTN","BIREPH",107,0)
 Q
"RTN","BIREPH",108,0)
 ;
"RTN","BIREPH",109,0)
 ;
"RTN","BIREPH",110,0)
 ;----------
"RTN","BIREPH",111,0)
HELP ;EP
"RTN","BIREPH",112,0)
 ;---> Help code.
"RTN","BIREPH",113,0)
 N BIX S BIX=X
"RTN","BIREPH",114,0)
 D FULL^VALM1
"RTN","BIREPH",115,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPH",116,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPH",117,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPH",118,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPH",119,0)
 Q
"RTN","BIREPH",120,0)
 ;
"RTN","BIREPH",121,0)
 ;
"RTN","BIREPH",122,0)
 ;----------
"RTN","BIREPH",123,0)
HELP1 ;EP
"RTN","BIREPH",124,0)
 ;----> Explanation of this report.
"RTN","BIREPH",125,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPH",126,0)
 D START^BIHELP("VACCINE ACCOUNTABILITY REPORT - HELP",.BITEXT)
"RTN","BIREPH",127,0)
 Q
"RTN","BIREPH",128,0)
 ;
"RTN","BIREPH",129,0)
 ;
"RTN","BIREPH",130,0)
 ;
"RTN","BIREPH",131,0)
 ;********** PATCH 1, v8.4, AUG 01,2010, IHS/CMI/MWR
"RTN","BIREPH",132,0)
 ;---> Explain time frame of report from 8/1/09 to 8/31/10. TEXT1+21
"RTN","BIREPH",133,0)
 ;
"RTN","BIREPH",134,0)
 ;----------
"RTN","BIREPH",135,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPH",136,0)
 ;;The H1n1 Accountability Report provides "doses administered"
"RTN","BIREPH",137,0)
 ;;by age group.  This report can be printed for any time period,
"RTN","BIREPH",138,0)
 ;;for a given facility, visit type, or community(s).
"RTN","BIREPH",139,0)
 ;;
"RTN","BIREPH",140,0)
 ;;There are 7 items or "parameters" on the screen that you may
"RTN","BIREPH",141,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPH",142,0)
 ;;To change an item, enter its left column number (1-7) at the
"RTN","BIREPH",143,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPH",144,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPH",145,0)
 ;;changing.
"RTN","BIREPH",146,0)
 ;;
"RTN","BIREPH",147,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPH",148,0)
 ;;you want, select V to View the Vaccine Acct Report or P to print it.
"RTN","BIREPH",149,0)
 ;;
"RTN","BIREPH",150,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPH",151,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPH",152,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPH",153,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPH",154,0)
 ;;
"RTN","BIREPH",155,0)
 ;;DATE RANGE: Only immunizations given within the Date Range you
"RTN","BIREPH",156,0)
 ;;select will be included in the report. The maximum date range that
"RTN","BIREPH",157,0)
 ;;will be examined is 8/1/09 to 8/31/10.
"RTN","BIREPH",158,0)
 ;;
"RTN","BIREPH",159,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPH",160,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPH",161,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPH",162,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPH",163,0)
 ;;
"RTN","BIREPH",164,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIREPH",165,0)
 ;;Facilities, only immunizations given at the selected Health Care
"RTN","BIREPH",166,0)
 ;;Facilities will be included in the report.
"RTN","BIREPH",167,0)
 ;;
"RTN","BIREPH",168,0)
 ;;CASE MANAGERS: If you select for specific Case Managers, only
"RTN","BIREPH",169,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPH",170,0)
 ;;in the report.
"RTN","BIREPH",171,0)
 ;;
"RTN","BIREPH",172,0)
 ;;BENEFICIARY TYPES: If you select for specific Beneficiary Types,
"RTN","BIREPH",173,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPH",174,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPH",175,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPH",176,0)
 ;;
"RTN","BIREPH",177,0)
 ;;VISIT TYPES: If you select for specific Visit Types, only visits
"RTN","BIREPH",178,0)
 ;;that are classifed with one of the Visit Types you select will
"RTN","BIREPH",179,0)
 ;;included in the report.
"RTN","BIREPH",180,0)
 ;;
"RTN","BIREPH",181,0)
 ;;INCLUDE HISTORICAL: If this parameter is set to "YES", then Visits
"RTN","BIREPH",182,0)
 ;;with a Category of "Historical" will be counted in the H1N1
"RTN","BIREPH",183,0)
 ;;Accountability Report.  (Category is displayed and edited on the
"RTN","BIREPH",184,0)
 ;;ADD/EDIT IMMUNIZATION VISIT Screen.)  If set to "NO", they will
"RTN","BIREPH",185,0)
 ;;not be counted in the report.
"RTN","BIREPH",186,0)
 ;;
"RTN","BIREPH",187,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPH",188,0)
 Q
"RTN","BIREPH",189,0)
 ;
"RTN","BIREPH",190,0)
 ;
"RTN","BIREPH",191,0)
 ;----------
"RTN","BIREPH",192,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPH",193,0)
 Q:$G(BILINL)=""
"RTN","BIREPH",194,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPH",195,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPH",196,0)
 Q
"RTN","BIREPH",197,0)
 ;
"RTN","BIREPH",198,0)
 ;
"RTN","BIREPH",199,0)
 ;----------
"RTN","BIREPH",200,0)
EXIT ;EP
"RTN","BIREPH",201,0)
 ;---> End of job cleanup.
"RTN","BIREPH",202,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPH",203,0)
 K ^TMP("BIREPH",$J),^TMP("BIDFN",$J)
"RTN","BIREPH",204,0)
 D CLEAR^VALM1
"RTN","BIREPH",205,0)
 Q
"RTN","BIREPH1")
0^105^B11788116
"RTN","BIREPH1",1,0)
BIREPH1 ;IHS/CMI/MWR - REPORT, H1N1 ACCOUNTABILITY; MAY 10, 2010
"RTN","BIREPH1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPH1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPH1",4,0)
 ;;  VIEW OR PRINT H1N1 ACCOUNTABILITY REPORT.
"RTN","BIREPH1",5,0)
 ;;  PATCH 3: BIREPH* routines are completely new for H1N1 Report.
"RTN","BIREPH1",6,0)
 ;
"RTN","BIREPH1",7,0)
 ;
"RTN","BIREPH1",8,0)
 ;----------
"RTN","BIREPH1",9,0)
START(BIX) ;EP
"RTN","BIREPH1",10,0)
 ;---> Prepare and display or print Vaccine Accountability Report.
"RTN","BIREPH1",11,0)
 ;---> Parameters:
"RTN","BIREPH1",12,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Report.
"RTN","BIREPH1",13,0)
 ;                      If BIX="VIEW", then view Report (default).
"RTN","BIREPH1",14,0)
 ;---> Variables:
"RTN","BIREPH1",15,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPH1",16,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPH1",17,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPH1",18,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPH1",19,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPH1",20,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPH1",21,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPH1",22,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPH1",23,0)
 ;     9 - BIPOP   (ret) BIPOP=1 if error.
"RTN","BIREPH1",24,0)
 ;
"RTN","BIREPH1",25,0)
 ;---> Check for required Variables.
"RTN","BIREPH1",26,0)
 I '$G(BIBEGDT) D ERROR(626) D RESET^BIREPH Q
"RTN","BIREPH1",27,0)
 I '$G(BIENDDT) D ERROR(627) D RESET^BIREPH Q
"RTN","BIREPH1",28,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPH Q
"RTN","BIREPH1",29,0)
 I '$D(BIHCF) D ERROR(625) D RESET^BIREPH Q
"RTN","BIREPH1",30,0)
 I '$D(BICM) D ERROR(615) D RESET^BIREPH Q
"RTN","BIREPH1",31,0)
 I '$D(BIBEN) D ERROR(662) D RESET^BIREPH Q
"RTN","BIREPH1",32,0)
 I '$D(BIHIST) D ERROR(663) D RESET^BIREPH Q
"RTN","BIREPH1",33,0)
 I '$D(BIVT) D ERROR(664) D RESET^BIREPH Q
"RTN","BIREPH1",34,0)
 ;
"RTN","BIREPH1",35,0)
 D SETVARS^BIUTL5
"RTN","BIREPH1",36,0)
 N VALMCNT
"RTN","BIREPH1",37,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPH Q
"RTN","BIREPH1",38,0)
 D EN
"RTN","BIREPH1",39,0)
 Q
"RTN","BIREPH1",40,0)
 ;
"RTN","BIREPH1",41,0)
 ;
"RTN","BIREPH1",42,0)
 ;----------
"RTN","BIREPH1",43,0)
PRINT ;EP
"RTN","BIREPH1",44,0)
 ;---> Main entry point for printing the Quarterly Immunization Report.
"RTN","BIREPH1",45,0)
 D DEVICE(.BIPOP)
"RTN","BIREPH1",46,0)
 Q:$G(BIPOP)
"RTN","BIREPH1",47,0)
 ;
"RTN","BIREPH1",48,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPH1",49,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPH1",50,0)
 ;
"RTN","BIREPH1",51,0)
 ;---> Prepare report.
"RTN","BIREPH1",52,0)
 K VALMHDR,^TMP("BIREPH1",$J)
"RTN","BIREPH1",53,0)
 N VALM,VALMHDR
"RTN","BIREPH1",54,0)
 D HDR
"RTN","BIREPH1",55,0)
 D GET^BIREPH2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPH1",56,0)
 ;
"RTN","BIREPH1",57,0)
 D PRTLST^BIUTL8("BIREPH1")
"RTN","BIREPH1",58,0)
 D EXIT,RESET^BIREPH
"RTN","BIREPH1",59,0)
 Q
"RTN","BIREPH1",60,0)
 ;
"RTN","BIREPH1",61,0)
 ;
"RTN","BIREPH1",62,0)
 ;----------
"RTN","BIREPH1",63,0)
EN ;EP
"RTN","BIREPH1",64,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIREPH1",65,0)
 D EN^VALM("BI REPORT H1N11")
"RTN","BIREPH1",66,0)
 Q
"RTN","BIREPH1",67,0)
 ;
"RTN","BIREPH1",68,0)
 ;
"RTN","BIREPH1",69,0)
 ;----------
"RTN","BIREPH1",70,0)
HDR ;EP
"RTN","BIREPH1",71,0)
 ;---> Header code
"RTN","BIREPH1",72,0)
 D HEAD^BIREPH2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPH1",73,0)
 Q
"RTN","BIREPH1",74,0)
 ;
"RTN","BIREPH1",75,0)
 ;
"RTN","BIREPH1",76,0)
 ;----------
"RTN","BIREPH1",77,0)
INIT ;EP
"RTN","BIREPH1",78,0)
 ;---> Initialize variables and list array.
"RTN","BIREPH1",79,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPH1",80,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPH1",81,0)
 D GET^BIREPH2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPH1",82,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPH1",83,0)
 D ZSAVES^BIUTL3
"RTN","BIREPH1",84,0)
 Q
"RTN","BIREPH1",85,0)
 ;
"RTN","BIREPH1",86,0)
 ;
"RTN","BIREPH1",87,0)
 ;----------
"RTN","BIREPH1",88,0)
RESET ;EP
"RTN","BIREPH1",89,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPH1",90,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPH1",91,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPH1",92,0)
 D INIT,HDR Q
"RTN","BIREPH1",93,0)
 ;
"RTN","BIREPH1",94,0)
 ;
"RTN","BIREPH1",95,0)
 ;----------
"RTN","BIREPH1",96,0)
HELP ;EP
"RTN","BIREPH1",97,0)
 ;---> Help code.
"RTN","BIREPH1",98,0)
 N BIX S BIX=X
"RTN","BIREPH1",99,0)
 D FULL^VALM1
"RTN","BIREPH1",100,0)
 W !!?5,"Use arrow keys to scroll up and down through the report, or"
"RTN","BIREPH1",101,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIREPH1",102,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPH1",103,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPH1",104,0)
 Q
"RTN","BIREPH1",105,0)
 ;
"RTN","BIREPH1",106,0)
 ;
"RTN","BIREPH1",107,0)
 ;----------
"RTN","BIREPH1",108,0)
EXIT ;EP
"RTN","BIREPH1",109,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPH1",110,0)
 K ^TMP("BIREPH1",$J),^TMP("BIDFN",$J)
"RTN","BIREPH1",111,0)
 D CLEAR^VALM1
"RTN","BIREPH1",112,0)
 D FULL^VALM1
"RTN","BIREPH1",113,0)
 Q
"RTN","BIREPH1",114,0)
 ;
"RTN","BIREPH1",115,0)
 ;
"RTN","BIREPH1",116,0)
 ;----------
"RTN","BIREPH1",117,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPH1",118,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPH1",119,0)
 ;---> Parameters:
"RTN","BIREPH1",120,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPH1",121,0)
 ;
"RTN","BIREPH1",122,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPH1",123,0)
 S ZTRTN="DEQUEUE^BIREPH1"
"RTN","BIREPH1",124,0)
 D ZSAVES^BIUTL3
"RTN","BIREPH1",125,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPH1",126,0)
 Q
"RTN","BIREPH1",127,0)
 ;
"RTN","BIREPH1",128,0)
 ;
"RTN","BIREPH1",129,0)
 ;----------
"RTN","BIREPH1",130,0)
DEQUEUE ;EP
"RTN","BIREPH1",131,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIREPH1",132,0)
 K VALMHDR,^TMP("BIREPH1",$J)
"RTN","BIREPH1",133,0)
 D HDR
"RTN","BIREPH1",134,0)
 D GET^BIREPH2(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPH1",135,0)
 D PRTLST^BIUTL8("BIREPH1"),EXIT
"RTN","BIREPH1",136,0)
 Q
"RTN","BIREPH1",137,0)
 ;
"RTN","BIREPH1",138,0)
 ;
"RTN","BIREPH1",139,0)
 ;----------
"RTN","BIREPH1",140,0)
ERROR(BIERR) ;EP
"RTN","BIREPH1",141,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPH1",142,0)
 ;---> Parameters:
"RTN","BIREPH1",143,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPH1",144,0)
 ;
"RTN","BIREPH1",145,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPH1",146,0)
 Q
"RTN","BIREPH2")
0^106^B40998713
"RTN","BIREPH2",1,0)
BIREPH2 ;IHS/CMI/MWR - REPORT, H1N1 ACCOUNTABILITY; MAY 10, 2010
"RTN","BIREPH2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPH2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPH2",4,0)
 ;;  VIEW OR PRINT H1N1 ACCOUNTABILITY REPORT.
"RTN","BIREPH2",5,0)
 ;;  PATCH 3: BIREPH* routines are completely new for H1N1 Report.
"RTN","BIREPH2",6,0)
 ;
"RTN","BIREPH2",7,0)
 ;----------
"RTN","BIREPH2",8,0)
HEAD(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT) ;EP
"RTN","BIREPH2",9,0)
 ;---> Produce Header array for Vaccine Accountability Report.
"RTN","BIREPH2",10,0)
 ;---> Parameters:
"RTN","BIREPH2",11,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPH2",12,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPH2",13,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPH2",14,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPH2",15,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPH2",16,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPH2",17,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPH2",18,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPH2",19,0)
 ;
"RTN","BIREPH2",20,0)
 ;---> Check for required Variables.
"RTN","BIREPH2",21,0)
 Q:'$G(BIBEGDT)
"RTN","BIREPH2",22,0)
 Q:'$G(BIENDDT)
"RTN","BIREPH2",23,0)
 Q:'$D(BICC)
"RTN","BIREPH2",24,0)
 Q:'$D(BIHCF)
"RTN","BIREPH2",25,0)
 Q:'$D(BICM)
"RTN","BIREPH2",26,0)
 Q:'$D(BIBEN)
"RTN","BIREPH2",27,0)
 Q:'$D(BIHIST)
"RTN","BIREPH2",28,0)
 Q:'$D(BIVT)
"RTN","BIREPH2",29,0)
 ;
"RTN","BIREPH2",30,0)
 K VALMHDR
"RTN","BIREPH2",31,0)
 N BILINE,X S BILINE=0
"RTN","BIREPH2",32,0)
 ;
"RTN","BIREPH2",33,0)
 N X S X=""
"RTN","BIREPH2",34,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPH2",35,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPH2",36,0)
 ;
"RTN","BIREPH2",37,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPH2",38,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPH2",39,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPH2",40,0)
 ;
"RTN","BIREPH2",41,0)
 S X="*  H1N1 Accountability Report  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPH2",42,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPH2",43,0)
 ;
"RTN","BIREPH2",44,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPH2",45,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPH2",46,0)
 ;
"RTN","BIREPH2",47,0)
 S X=$$SP^BIUTL5(28)_"Date Range: "_$$SLDT1^BIUTL5(BIBEGDT)_" - "_$$SLDT1^BIUTL5(BIENDDT)
"RTN","BIREPH2",48,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPH2",49,0)
 ;
"RTN","BIREPH2",50,0)
 S X=" (Historical "_$S(BIHIST:"In",1:"Ex")_"cluded)"
"RTN","BIREPH2",51,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPH2",52,0)
 S X=$$SP^BIUTL5(79,"-")
"RTN","BIREPH2",53,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPH2",54,0)
 ;
"RTN","BIREPH2",55,0)
 D
"RTN","BIREPH2",56,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPH2",57,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPH2",58,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPH2",59,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPH2",60,0)
 .;
"RTN","BIREPH2",61,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPH2",62,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPH2",63,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPH2",64,0)
 .;
"RTN","BIREPH2",65,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPH2",66,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPH2",67,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPH2",68,0)
 .;
"RTN","BIREPH2",69,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPH2",70,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPH2",71,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPH2",72,0)
 .;
"RTN","BIREPH2",73,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPH2",74,0)
 .D SUBH^BIOUTPT5("BIVT","Visit Type",,"9000010-.03",.BILINE,.BIERR,,12)
"RTN","BIREPH2",75,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPH2",76,0)
 .;
"RTN","BIREPH2",77,0)
 .S X="  Dose  |  6-23m   24-59m    5-18y   19-24y   25-49y   50-64y   "
"RTN","BIREPH2",78,0)
 .S X=X_" 65+y  |  TOTAL"
"RTN","BIREPH2",79,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPH2",80,0)
 .;S X=$$SUML("  Dose")
"RTN","BIREPH2",81,0)
 .;D WH^BIW(.BILINE,X)
"RTN","BIREPH2",82,0)
 ;
"RTN","BIREPH2",83,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPH2",84,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPH2",85,0)
 D:$D(VALM("BM"))
"RTN","BIREPH2",86,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPH2",87,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPH2",88,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPH2",89,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPH2",90,0)
 Q
"RTN","BIREPH2",91,0)
 ;
"RTN","BIREPH2",92,0)
 ;
"RTN","BIREPH2",93,0)
 ;----------
"RTN","BIREPH2",94,0)
GET(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT) ;EP
"RTN","BIREPH2",95,0)
 ;----------
"RTN","BIREPH2",96,0)
 ;---> Produce array for Vaccine Accountability Report.
"RTN","BIREPH2",97,0)
 ;---> Parameters:
"RTN","BIREPH2",98,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPH2",99,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPH2",100,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPH2",101,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPH2",102,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPH2",103,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPH2",104,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPH2",105,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPH2",106,0)
 ;
"RTN","BIREPH2",107,0)
 K ^TMP("BIREPH1",$J),^TMP("BIDFN",$J)
"RTN","BIREPH2",108,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPH2",109,0)
 ;
"RTN","BIREPH2",110,0)
 ;---> Check for required Variables.
"RTN","BIREPH2",111,0)
 I '$G(BIBEGDT) D ERRCD^BIUTL2(626,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",112,0)
 I '$G(BIENDDT) D ERRCD^BIUTL2(627,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",113,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",114,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",115,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",116,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",117,0)
 I '$D(BIHIST) D ERRCD^BIUTL2(663,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",118,0)
 I '$D(BIVT) D ERRCD^BIUTL2(664,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPH2",119,0)
 ;
"RTN","BIREPH2",120,0)
 ;---> Gather data.
"RTN","BIREPH2",121,0)
 D GETIMMS^BIREPH3(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPH2",122,0)
 ;
"RTN","BIREPH2",123,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPH2",124,0)
 ;---> BIG=Vaccine Group, BIV=Vaccine Name, BIA=Age.
"RTN","BIREPH2",125,0)
 ;
"RTN","BIREPH2",126,0)
 N BILINE S BILINE=0
"RTN","BIREPH2",127,0)
 N BIDATE S BIDATE=0
"RTN","BIREPH2",128,0)
 F  S BIDATE=$O(BITMP("STATS",BIDATE)) Q:'BIDATE  D
"RTN","BIREPH2",129,0)
 .;---> S BIDATEX=External Date format of BIDATE
"RTN","BIREPH2",130,0)
 .N BIDATEX,BILSAV D
"RTN","BIREPH2",131,0)
 ..N Y S Y=BIDATE D DD^%DT S BIDATEX=" "_$P(Y,",")
"RTN","BIREPH2",132,0)
 .;---> Write Date line.
"RTN","BIREPH2",133,0)
 .S X=$$SUML(BIDATEX) D WRITE(.BILINE,X) S BILSAV=BILINE
"RTN","BIREPH2",134,0)
 .;
"RTN","BIREPH2",135,0)
 .N BIDOSE
"RTN","BIREPH2",136,0)
 .F BIDOSE=1:1:2 D
"RTN","BIREPH2",137,0)
 ..;---> Write Dose line.
"RTN","BIREPH2",138,0)
 ..;S X=BIDOSE D CENTERT^BIUTL5(.X)
"RTN","BIREPH2",139,0)
 ..;---> Save this line# for marking as a single record to print.
"RTN","BIREPH2",140,0)
 ..;D WRITE(.BILINE,X) S BILSAV=BILINE
"RTN","BIREPH2",141,0)
 ..;
"RTN","BIREPH2",142,0)
 ..;---> Build Age Totals line for this date & dose.
"RTN","BIREPH2",143,0)
 ..;I BIDOSE>1 S X=$$SUML(BIDATEX) D WRITE(.BILINE,X) ;S BILSAV=BILINE
"RTN","BIREPH2",144,0)
 ..N X S X="     #"_BIDOSE_" |" N BIA
"RTN","BIREPH2",145,0)
 ..F BIA=1:1:6 S X=X_$J($G(BITMP("STATS",BIDATE,BIDOSE,"AGE",BIA)),7,0)_"  "
"RTN","BIREPH2",146,0)
 ..;---> Last line special just to concat "|".
"RTN","BIREPH2",147,0)
 ..S X=X_$J($G(BITMP("STATS",BIDATE,BIDOSE,"AGE",7)),7,0)_" |"
"RTN","BIREPH2",148,0)
 ..;
"RTN","BIREPH2",149,0)
 ..;---> Now concat Total column (for this dose).
"RTN","BIREPH2",150,0)
 ..S X=X_$J($G(BITMP("STATS",BIDATE,BIDOSE,"TOTAL")),7,0)
"RTN","BIREPH2",151,0)
 ..D WRITE(.BILINE,X) I BIDOSE=1 S BILSAV=BILINE
"RTN","BIREPH2",152,0)
 .;
"RTN","BIREPH2",153,0)
 .D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPH2",154,0)
 .;
"RTN","BIREPH2",155,0)
 .;---> Now mark the top line of this vaccine to print as one record.
"RTN","BIREPH2",156,0)
 .D:$G(BILSAV) MARK^BIW(BILSAV,BILINE-BILSAV,"BIREPH1")
"RTN","BIREPH2",157,0)
 ;
"RTN","BIREPH2",158,0)
 ;---> Now write totals.
"RTN","BIREPH2",159,0)
 S X=" Total H1N1 First Doses"
"RTN","BIREPH2",160,0)
 S X=X_$$SP^BIUTL5(48)_"|"_$J(+$G(BITMP("STATS","DOSES",1,"TOTAL")),7,0)
"RTN","BIREPH2",161,0)
 D WRITE(.BILINE,X)
"RTN","BIREPH2",162,0)
 ;
"RTN","BIREPH2",163,0)
 S X=" Total H1N1 Second Doses"
"RTN","BIREPH2",164,0)
 S X=X_$$SP^BIUTL5(47)_"|"_$J(+$G(BITMP("STATS","DOSES",2,"TOTAL")),7,0)
"RTN","BIREPH2",165,0)
 D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPH2",166,0)
 ;
"RTN","BIREPH2",167,0)
 S X=" Total H1N1 Immunizations"
"RTN","BIREPH2",168,0)
 S X=X_$$SP^BIUTL5(46)_"|"_$J(+$G(BITMP("STATS","ALL","TOTAL")),7,0)
"RTN","BIREPH2",169,0)
 D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPH2",170,0)
 ;
"RTN","BIREPH2",171,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPH2",172,0)
 ;---> Not desired on this report, per Ros 10-12-05
"RTN","BIREPH2",173,0)
 ;N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPH2",174,0)
 ;S X=" Total Patients included who had Refusals on record"_$J(N,28)
"RTN","BIREPH2",175,0)
 ;D WRITE(.BILINE,X),WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPH2",176,0)
 ;
"RTN","BIREPH2",177,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPH2",178,0)
 S VALMCNT=BILINE
"RTN","BIREPH2",179,0)
 Q
"RTN","BIREPH2",180,0)
 ;
"RTN","BIREPH2",181,0)
 ;
"RTN","BIREPH2",182,0)
 ;----------
"RTN","BIREPH2",183,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPH2",184,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPH2",185,0)
 ;---> Parameters:
"RTN","BIREPH2",186,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPH2",187,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPH2",188,0)
 ;
"RTN","BIREPH2",189,0)
 Q:'$D(BILINE)
"RTN","BIREPH2",190,0)
 D WL^BIW(.BILINE,"BIREPH1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPH2",191,0)
 ;
"RTN","BIREPH2",192,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPH2",193,0)
 S VALMCNT=BILINE
"RTN","BIREPH2",194,0)
 Q
"RTN","BIREPH2",195,0)
 ;
"RTN","BIREPH2",196,0)
 ;
"RTN","BIREPH2",197,0)
 ;----------
"RTN","BIREPH2",198,0)
SUML(Y) ;EP
"RTN","BIREPH2",199,0)
 ;---> Produce Header array for Vaccine Accountability Report.
"RTN","BIREPH2",200,0)
 ;---> Parameters:
"RTN","BIREPH2",201,0)
 ;     1 - Y (opt) Y=text, such as Date (Aug 23) or "Dose" or other text.
"RTN","BIREPH2",202,0)
 I $L($G(Y))=0 S Y="       "
"RTN","BIREPH2",203,0)
 S Y=$E(Y,1,7) S Y=$$PAD^BIUTL5(Y,7)
"RTN","BIREPH2",204,0)
 N X
"RTN","BIREPH2",205,0)
 S X=Y_" |                                                              |"
"RTN","BIREPH2",206,0)
 ;   " Date   |  6-23m   24-59m    5-18y   19-25y   25-49y   50-64y     "
"RTN","BIREPH2",207,0)
 ;S X=Y_" | ------   ------   ------   ------   ------   ------   --"
"RTN","BIREPH2",208,0)
 ;   "65+y    TOTAL"
"RTN","BIREPH2",209,0)
 ;Q X_"---- | ------"
"RTN","BIREPH2",210,0)
 Q X
"RTN","BIREPH3")
0^107^B18678958
"RTN","BIREPH3",1,0)
BIREPH3 ;IHS/CMI/MWR - REPORT, H1N1 ACCOUNTABILITY; AUG 10,2010
"RTN","BIREPH3",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPH3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPH3",4,0)
 ;;  VIEW OR PRINT H1N1 ACCOUNTABILITY REPORT.
"RTN","BIREPH3",5,0)
 ;;  v8.3 PATCH 3: BIREPH* routines are completely new for H1N1 Report.
"RTN","BIREPH3",6,0)
 ;;  v8.3 PATCH 4: Modify H1N1 Report to count 2nd doses regardless of Date Range.
"RTN","BIREPH3",7,0)
 ;;  v8.4 PATCH 1: Extend time frame of report: 8/1/09 to 8/31/10.  GETIMMS+32
"RTN","BIREPH3",8,0)
 ;
"RTN","BIREPH3",9,0)
 ;
"RTN","BIREPH3",10,0)
 ;----------
"RTN","BIREPH3",11,0)
GETIMMS(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT) ;EP
"RTN","BIREPH3",12,0)
 ;---> Get Immunizations from V Files.
"RTN","BIREPH3",13,0)
 ;---> Parameters:
"RTN","BIREPH3",14,0)
 ;     1 - BIBEGDT (req) Begin Visit Date.
"RTN","BIREPH3",15,0)
 ;     2 - BIENDDT (req) End Visit Date.
"RTN","BIREPH3",16,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPH3",17,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPH3",18,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPH3",19,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPH3",20,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPH3",21,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPH3",22,0)
 ;
"RTN","BIREPH3",23,0)
 ;---> Set begin and end dates for search through V Immunization File.
"RTN","BIREPH3",24,0)
 ;
"RTN","BIREPH3",25,0)
 ;***********************************************************
"RTN","BIREPH3",26,0)
 ;********** PATCH 4, v8.3, DEC 30,2009, IHS/CMI/MWR
"RTN","BIREPH3",27,0)
 ;---> PATCH: Modify H1N1 Report to count 2nd doses regardless of Date Range.
"RTN","BIREPH3",28,0)
 ;
"RTN","BIREPH3",29,0)
 ;Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)
"RTN","BIREPH3",30,0)
 ;N N S N=BIBEGDT-.9999
"RTN","BIREPH3",31,0)
 ;F  S N=$O(^AUPNVIMM("ADT",N)) Q:(N>(BIENDDT+.9999)!('N))  D
"RTN","BIREPH3",32,0)
 ;.N M S M=0
"RTN","BIREPH3",33,0)
 ;.F  S M=$O(^AUPNVIMM("ADT",N,M)) Q:'M  D
"RTN","BIREPH3",34,0)
 ;..N P S P=0
"RTN","BIREPH3",35,0)
 ;..F  S P=$O(^AUPNVIMM("ADT",N,M,P)) Q:'P  D
"RTN","BIREPH3",36,0)
 ;...D CHKSET(N,M,P,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT)
"RTN","BIREPH3",37,0)
 ;
"RTN","BIREPH3",38,0)
 ;---> Hard code for 2009-2010 Season.
"RTN","BIREPH3",39,0)
 ;
"RTN","BIREPH3",40,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)
"RTN","BIREPH3",41,0)
 ;
"RTN","BIREPH3",42,0)
 ;********** PATCH 1, v8.4, AUG 01,2010, IHS/CMI/MWR
"RTN","BIREPH3",43,0)
 ;---> Extend time frame of report from Aug 1, 2009 until Aug 30, 2010.
"RTN","BIREPH3",44,0)
 ;N N S N=3090901-.9999
"RTN","BIREPH3",45,0)
 ;F  S N=$O(^AUPNVIMM("ADT",N)) Q:(N>(3100430+.9999)!('N))  D
"RTN","BIREPH3",46,0)
 N N S N=3090801-.9999
"RTN","BIREPH3",47,0)
 F  S N=$O(^AUPNVIMM("ADT",N)) Q:(N>(3100830+.9999)!('N))  D
"RTN","BIREPH3",48,0)
 .;**********
"RTN","BIREPH3",49,0)
 .;
"RTN","BIREPH3",50,0)
 .N M S M=0
"RTN","BIREPH3",51,0)
 .F  S M=$O(^AUPNVIMM("ADT",N,M)) Q:'M  D
"RTN","BIREPH3",52,0)
 ..N P S P=0
"RTN","BIREPH3",53,0)
 ..F  S P=$O(^AUPNVIMM("ADT",N,M,P)) Q:'P  D
"RTN","BIREPH3",54,0)
 ...D CHKSET(N,M,P,.BICC,.BIHCF,.BICM,.BIBEN,BIHIST,.BIVT,BIBEGDT,BIENDDT)
"RTN","BIREPH3",55,0)
 ;
"RTN","BIREPH3",56,0)
 ;************************************************************
"RTN","BIREPH3",57,0)
 ;
"RTN","BIREPH3",58,0)
 Q
"RTN","BIREPH3",59,0)
 ;
"RTN","BIREPH3",60,0)
 ;
"RTN","BIREPH3",61,0)
 ;----------
"RTN","BIREPH3",62,0)
 ;************************************************************
"RTN","BIREPH3",63,0)
 ;********** PATCH 4, v8.3, DEC 30,2009, IHS/CMI/MWR
"RTN","BIREPH3",64,0)
 ;---> PATCH: Pass Date Range Parameters to limit report display.
"RTN","BIREPH3",65,0)
CHKSET(BIDATE,BIVIEN,BIIIEN,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT,BIBEGDT,BIENDDT) ;EP
"RTN","BIREPH3",66,0)
 ;************************************************************
"RTN","BIREPH3",67,0)
 ;(BIDATE,BIVIEN,BIIIEN,BICC,BIHCF,BICM,BIBEN,BIHIST,BIVT)
"RTN","BIREPH3",68,0)
 ;---> Check if this visit fits criteria; if so, set it
"RTN","BIREPH3",69,0)
 ;---> in ^TMP("BIREPH1".
"RTN","BIREPH3",70,0)
 ;---> Parameters:
"RTN","BIREPH3",71,0)
 ;     1 - BIDATE (req) Date of Visit.
"RTN","BIREPH3",72,0)
 ;     2 - BIVIEN (req) VISIT IEN.
"RTN","BIREPH3",73,0)
 ;     3 - BIIIEN (req) V IMMUNIZAITON IEN.
"RTN","BIREPH3",74,0)
 ;     4 - BICC   (req) Current Community array.
"RTN","BIREPH3",75,0)
 ;     5 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPH3",76,0)
 ;     6 - BICM   (req) Case Manager array.
"RTN","BIREPH3",77,0)
 ;     7 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPH3",78,0)
 ;     8 - BIHIST (req) Include Historical (1=yes,0=no).
"RTN","BIREPH3",79,0)
 ;     9 - BIVT    (req) Visit Type array.
"RTN","BIREPH3",80,0)
 ;
"RTN","BIREPH3",81,0)
 ;************************************************************
"RTN","BIREPH3",82,0)
 ;     10 - BIBEGDT (req) Begin Visit Date.
"RTN","BIREPH3",83,0)
 ;     11 - BIENDDT (req) End Visit Date.
"RTN","BIREPH3",84,0)
 ;************************************************************
"RTN","BIREPH3",85,0)
 ;
"RTN","BIREPH3",86,0)
 Q:'$G(BIDATE)
"RTN","BIREPH3",87,0)
 Q:'$G(BIVIEN)
"RTN","BIREPH3",88,0)
 Q:'$G(BIIIEN)
"RTN","BIREPH3",89,0)
 Q:'$D(^AUPNVSIT(BIVIEN,0))
"RTN","BIREPH3",90,0)
 Q:'$D(^AUPNVIMM(BIIIEN,0))
"RTN","BIREPH3",91,0)
 Q:'$D(BICC)
"RTN","BIREPH3",92,0)
 Q:'$D(BIHCF)
"RTN","BIREPH3",93,0)
 Q:'$D(BICM)
"RTN","BIREPH3",94,0)
 Q:'$D(BIBEN)
"RTN","BIREPH3",95,0)
 Q:'$D(BIVT)
"RTN","BIREPH3",96,0)
 ;
"RTN","BIREPH3",97,0)
 N BIAGRP,BIDFN,BIIMM,BIVGRP,BIVNAM,BIDOSE,Y
"RTN","BIREPH3",98,0)
 S Y=^AUPNVIMM(BIIIEN,0)
"RTN","BIREPH3",99,0)
 S BIDFN=$P(Y,U,2),BIIMM=$P(Y,U) ;,BIDOSE=$P(Y,U,4)
"RTN","BIREPH3",100,0)
 ;
"RTN","BIREPH3",101,0)
 ;---> Quit if this Vaccine should not be included in this report.
"RTN","BIREPH3",102,0)
 ;---> As of v8.4, include all vaccines given during the selected time.
"RTN","BIREPH3",103,0)
 ;Q:'$P($G(^AUTTIMM(BIIMM,0)),U,17)   ;vvv8.4
"RTN","BIREPH3",104,0)
 ;
"RTN","BIREPH3",105,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPH3",106,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPH3",107,0)
 ;
"RTN","BIREPH3",108,0)
 ;---> Quit if Health Care Facility doesn't match.
"RTN","BIREPH3",109,0)
 N BIVDATA S BIVDATA=^AUPNVSIT(BIVIEN,0)
"RTN","BIREPH3",110,0)
 Q:$$HCF(BIVDATA,.BIHCF)
"RTN","BIREPH3",111,0)
 ;---> Quit if Visit Type doesn't match.
"RTN","BIREPH3",112,0)
 Q:$$VT(BIVDATA,.BIVT)
"RTN","BIREPH3",113,0)
 ;
"RTN","BIREPH3",114,0)
 ;---> Quit if not including Historical Visits and this Visit has
"RTN","BIREPH3",115,0)
 ;---> a Category of "Historical".
"RTN","BIREPH3",116,0)
 I '$G(BIHIST) Q:$$HIST(BIVDATA)
"RTN","BIREPH3",117,0)
 ;
"RTN","BIREPH3",118,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPH3",119,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPH3",120,0)
 ;
"RTN","BIREPH3",121,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPH3",122,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPH3",123,0)
 ;
"RTN","BIREPH3",124,0)
 ;---> Quit if this is not H1N1.
"RTN","BIREPH3",125,0)
 Q:($$IMMVG^BIUTL2(BIIMM,2)'=18)
"RTN","BIREPH3",126,0)
 ;
"RTN","BIREPH3",127,0)
 S BIVNAM=$$VNAME^BIUTL2(BIIMM)
"RTN","BIREPH3",128,0)
 S BIAGRP=$$AGEGRP(BIDFN,BIDATE)
"RTN","BIREPH3",129,0)
 ;S BIVGRP=$$IMMVG^BIUTL2(BIIMM,4)
"RTN","BIREPH3",130,0)
 ;---> Check if this is Dose #1 or #2.
"RTN","BIREPH3",131,0)
 D
"RTN","BIREPH3",132,0)
 .I '$D(^TMP("BIDFN",$J,BIDFN)) S BIDOSE=1,^TMP("BIDFN",$J,BIDFN)="" Q
"RTN","BIREPH3",133,0)
 .S BIDOSE=2
"RTN","BIREPH3",134,0)
 ;
"RTN","BIREPH3",135,0)
 ;************************************************************
"RTN","BIREPH3",136,0)
 ;********** PATCH 4, v8.3, DEC 30,2009, IHS/CMI/MWR
"RTN","BIREPH3",137,0)
 ;---> PATCH: Do not store this result if it is not in the REQUESTED Date Range.
"RTN","BIREPH3",138,0)
 ;
"RTN","BIREPH3",139,0)
 Q:(BIDATE<BIBEGDT)
"RTN","BIREPH3",140,0)
 Q:(BIDATE>(BIENDDT+.9999))
"RTN","BIREPH3",141,0)
 ;
"RTN","BIREPH3",142,0)
 ;************************************************************
"RTN","BIREPH3",143,0)
 ;
"RTN","BIREPH3",144,0)
 N Z
"RTN","BIREPH3",145,0)
 ;---> Add for this Vaccine, Dose, Age.
"RTN","BIREPH3",146,0)
 ;S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,BIDOSE,BIAGRP))
"RTN","BIREPH3",147,0)
 ;S BITMP("STATS",BIVGRP,BIVNAM,BIDOSE,BIAGRP)=Z+1
"RTN","BIREPH3",148,0)
 ;
"RTN","BIREPH3",149,0)
 ;---> Add for this Vaccine, Dose, Total.
"RTN","BIREPH3",150,0)
 ;S Z=$G(BITMP("STATS",BIVGRP,BIVNAM,BIDOSE,"TOTAL"))
"RTN","BIREPH3",151,0)
 ;S BITMP("STATS",BIVGRP,BIVNAM,BIDOSE,"TOTAL")=Z+1
"RTN","BIREPH3",152,0)
 ;
"RTN","BIREPH3",153,0)
 ;---> Add for this Date, Dose, Age, Total.
"RTN","BIREPH3",154,0)
 S Z=$G(BITMP("STATS",BIDATE,BIDOSE,"AGE",BIAGRP))
"RTN","BIREPH3",155,0)
 S BITMP("STATS",BIDATE,BIDOSE,"AGE",BIAGRP)=Z+1
"RTN","BIREPH3",156,0)
 ;
"RTN","BIREPH3",157,0)
 ;---> Add for this Date, Dose, Total.
"RTN","BIREPH3",158,0)
 S Z=$G(BITMP("STATS",BIDATE,BIDOSE,"TOTAL"))
"RTN","BIREPH3",159,0)
 S BITMP("STATS",BIDATE,BIDOSE,"TOTAL")=Z+1
"RTN","BIREPH3",160,0)
 ;
"RTN","BIREPH3",161,0)
 ;---> Add for this Dose, Total.
"RTN","BIREPH3",162,0)
 S Z=$G(BITMP("STATS","DOSES",BIDOSE,"TOTAL"))
"RTN","BIREPH3",163,0)
 S BITMP("STATS","DOSES",BIDOSE,"TOTAL")=Z+1
"RTN","BIREPH3",164,0)
 ;
"RTN","BIREPH3",165,0)
 ;---> Add for ALL Doses, Total.
"RTN","BIREPH3",166,0)
 S Z=$G(BITMP("STATS","ALL","TOTAL"))
"RTN","BIREPH3",167,0)
 S BITMP("STATS","ALL","TOTAL")=Z+1 K Z
"RTN","BIREPH3",168,0)
 ;
"RTN","BIREPH3",169,0)
 ;---> Add refusals, if any.
"RTN","BIREPH3",170,0)
 ;---> Not desired on this report, per Ros 10-12-05
"RTN","BIREPH3",171,0)
 ;D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) S BITMP("REFUSALS",BIDFN)=""
"RTN","BIREPH3",172,0)
 ;
"RTN","BIREPH3",173,0)
 Q
"RTN","BIREPH3",174,0)
 ;
"RTN","BIREPH3",175,0)
 ;
"RTN","BIREPH3",176,0)
 ;
"RTN","BIREPH3",177,0)
 ;----------
"RTN","BIREPH3",178,0)
AGEGRP(BIDFN,BIDATE) ;EP
"RTN","BIREPH3",179,0)
 ;---> Return Patient's Age Group.
"RTN","BIREPH3",180,0)
 ;---> Parameters:
"RTN","BIREPH3",181,0)
 ;     1 - BIDFN  (req) IEN in PATIENT File.
"RTN","BIREPH3",182,0)
 ;     2 - BIDATE (req) Date of Visit.
"RTN","BIREPH3",183,0)
 ;
"RTN","BIREPH3",184,0)
 N X S X=$$AGE^BIUTL1(BIDFN,1,BIDATE)
"RTN","BIREPH3",185,0)
 Q:X<2 1
"RTN","BIREPH3",186,0)
 Q:X<5 2
"RTN","BIREPH3",187,0)
 Q:X<19 3
"RTN","BIREPH3",188,0)
 Q:X<25 4
"RTN","BIREPH3",189,0)
 Q:X<50 5
"RTN","BIREPH3",190,0)
 Q:X<65 6
"RTN","BIREPH3",191,0)
 Q 7
"RTN","BIREPH3",192,0)
 ;
"RTN","BIREPH3",193,0)
 ;
"RTN","BIREPH3",194,0)
 ;----------
"RTN","BIREPH3",195,0)
HCF(BIVDATA,BIHCF) ;EP
"RTN","BIREPH3",196,0)
 ;---> Return Health Care Facility indicator.
"RTN","BIREPH3",197,0)
 ;---> Return 1 if not selecting all Health Care Facilities (Locations)
"RTN","BIREPH3",198,0)
 ;---> and if the Health Care Facility of this visit is not one of the
"RTN","BIREPH3",199,0)
 ;---> ones selected.
"RTN","BIREPH3",200,0)
 ;---> Parameters:
"RTN","BIREPH3",201,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPH3",202,0)
 ;     2 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPH3",203,0)
 ;
"RTN","BIREPH3",204,0)
 Q:$D(BIHCF("ALL")) 0
"RTN","BIREPH3",205,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPH3",206,0)
 N BILOC S BILOC=$P(BIVDATA,U,6)
"RTN","BIREPH3",207,0)
 Q:'BILOC 1
"RTN","BIREPH3",208,0)
 Q:'$D(BIHCF(BILOC)) 1
"RTN","BIREPH3",209,0)
 Q 0
"RTN","BIREPH3",210,0)
 ;
"RTN","BIREPH3",211,0)
 ;
"RTN","BIREPH3",212,0)
 ;----------
"RTN","BIREPH3",213,0)
VT(BIVDATA,BIVT) ;EP
"RTN","BIREPH3",214,0)
 ;---> Return Visit Type indicator.
"RTN","BIREPH3",215,0)
 ;---> Return 1 if not selecting all Visit Types and if this Visit Type
"RTN","BIREPH3",216,0)
 ;---> is not one of the ones selected.
"RTN","BIREPH3",217,0)
 ;---> Parameters:
"RTN","BIREPH3",218,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPH3",219,0)
 ;     2 - BIVT    (req) Health Care Facility array.
"RTN","BIREPH3",220,0)
 ;
"RTN","BIREPH3",221,0)
 Q:$D(BIVT("ALL")) 0
"RTN","BIREPH3",222,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPH3",223,0)
 N BIVTYPE S BIVTYPE=$P(BIVDATA,U,3)
"RTN","BIREPH3",224,0)
 Q:BIVTYPE="" 1
"RTN","BIREPH3",225,0)
 Q:'$D(BIVT(BIVTYPE)) 1
"RTN","BIREPH3",226,0)
 Q 0
"RTN","BIREPH3",227,0)
 ;
"RTN","BIREPH3",228,0)
 ;
"RTN","BIREPH3",229,0)
 ;----------
"RTN","BIREPH3",230,0)
HIST(BIVDATA) ;EP
"RTN","BIREPH3",231,0)
 ;---> Return Historical Visit indicator.
"RTN","BIREPH3",232,0)
 ;---> Return 1 if this Visit has a Category of "Historical".
"RTN","BIREPH3",233,0)
 ;---> Parameters:
"RTN","BIREPH3",234,0)
 ;     1 - BIVDATA (req) Data in ^AUPNVSIT(BIVIEN,0).
"RTN","BIREPH3",235,0)
 ;
"RTN","BIREPH3",236,0)
 Q:'$G(BIVDATA) 1
"RTN","BIREPH3",237,0)
 Q:$P(BIVDATA,U,7)="E" 1
"RTN","BIREPH3",238,0)
 Q 0
"RTN","BIREPL")
0^108^B71650642
"RTN","BIREPL",1,0)
BIREPL ;IHS/CMI/MWR - REPORT, ADULT IMM; MAY 10, 2010
"RTN","BIREPL",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPL",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPL",4,0)
 ;;  VIEW ADULT IMMUNIZATION REPORT: PARAMETERS VIEW MENU
"RTN","BIREPL",5,0)
 ;
"RTN","BIREPL",6,0)
 ;
"RTN","BIREPL",7,0)
 ;----------
"RTN","BIREPL",8,0)
START ;EP
"RTN","BIREPL",9,0)
 ;---> Listman Screen for printing Immunization Due Letters.
"RTN","BIREPL",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPL",11,0)
 ;
"RTN","BIREPL",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPL",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPL",14,0)
 ;
"RTN","BIREPL",15,0)
 D EN
"RTN","BIREPL",16,0)
 D EXIT
"RTN","BIREPL",17,0)
 Q
"RTN","BIREPL",18,0)
 ;
"RTN","BIREPL",19,0)
 ;
"RTN","BIREPL",20,0)
 ;----------
"RTN","BIREPL",21,0)
EN ;EP
"RTN","BIREPL",22,0)
 ;---> Main entry point for BI LETTER PRINT DU
"RTN","BIREPL",23,0)
 D EN^VALM("BI REPORT ADULT IMM")
"RTN","BIREPL",24,0)
 Q
"RTN","BIREPL",25,0)
 ;
"RTN","BIREPL",26,0)
 ;
"RTN","BIREPL",27,0)
 ;----------
"RTN","BIREPL",28,0)
INIT ;EP
"RTN","BIREPL",29,0)
 ;---> Initialize variables and list array.
"RTN","BIREPL",30,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPL",31,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPL",32,0)
 N BILINE,X S BILINE=0
"RTN","BIREPL",33,0)
 D WRITE(.BILINE)
"RTN","BIREPL",34,0)
 S X=IOUON_"ADULT IMMUNIZATION REPORT" D CENTERT^BIUTL5(.X,42)
"RTN","BIREPL",35,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPL",36,0)
 K X
"RTN","BIREPL",37,0)
 ;
"RTN","BIREPL",38,0)
 ;---> Date.
"RTN","BIREPL",39,0)
 D WRITE(.BILINE)
"RTN","BIREPL",40,0)
 S:'$G(BIQDT) BIQDT=$G(DT)
"RTN","BIREPL",41,0)
 D DATE^BIREP(.BILINE,"BIREPL",1,BIQDT,"Quarter Ending Date",,,,1)
"RTN","BIREPL",42,0)
 ;
"RTN","BIREPL",43,0)
 ;---> Current Community.
"RTN","BIREPL",44,0)
 D DISP^BIREP(.BILINE,"BIREPL",.BICC,"Community",2,1)
"RTN","BIREPL",45,0)
 ;
"RTN","BIREPL",46,0)
 ;---> Health Care Facility.
"RTN","BIREPL",47,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPL",48,0)
 D DISP^BIREP(.BILINE,"BIREPL",.BIHCF,A,3,2,,,,B) K A,B
"RTN","BIREPL",49,0)
 ;
"RTN","BIREPL",50,0)
 ;---> Beneficiary Type.
"RTN","BIREPL",51,0)
 S:$O(BIBEN(0))="" BIBEN(1)=""   ;vvv83
"RTN","BIREPL",52,0)
 D DISP^BIREP(.BILINE,"BIREPL",.BIBEN,"Beneficiary Type",4,4)
"RTN","BIREPL",53,0)
 ;
"RTN","BIREPL",54,0)
 ;---> Include CPT Coded Visits.
"RTN","BIREPL",55,0)
 S:'$D(BICPTI) BICPTI=0
"RTN","BIREPL",56,0)
 S X="     5 - Include CPT Coded Visits...: "
"RTN","BIREPL",57,0)
 S X=X_$S($G(BICPTI):"YES",1:"NO")
"RTN","BIREPL",58,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL",59,0)
 K X
"RTN","BIREPL",60,0)
 ;
"RTN","BIREPL",61,0)
 ;---> User Population.
"RTN","BIREPL",62,0)
 D:($G(BIUP)="")
"RTN","BIREPL",63,0)
 .I $$GPRAIEN^BIUTL6 S BIUP="a" Q
"RTN","BIREPL",64,0)
 .S BIUP="u"
"RTN","BIREPL",65,0)
 ;
"RTN","BIREPL",66,0)
 S X="     6 - Patient Population Group...: "
"RTN","BIREPL",67,0)
 D
"RTN","BIREPL",68,0)
 .I BIUP="r" S X=X_"Registered Patients (All)" Q
"RTN","BIREPL",69,0)
 .I BIUP="i" S X=X_"Immunization Register Patients (Active)" Q
"RTN","BIREPL",70,0)
 .I BIUP="u" S X=X_"User Population (1 visit, 3 yrs)" Q
"RTN","BIREPL",71,0)
 .I BIUP="a" S X=X_"Active Users (2+ visits, 3 yrs)" Q
"RTN","BIREPL",72,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL",73,0)
 K X
"RTN","BIREPL",74,0)
 ;
"RTN","BIREPL",75,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPL",76,0)
 S VALMCNT=BILINE
"RTN","BIREPL",77,0)
 S BIRTN="BIREPL"
"RTN","BIREPL",78,0)
 Q
"RTN","BIREPL",79,0)
 ;
"RTN","BIREPL",80,0)
 ;
"RTN","BIREPL",81,0)
 ;----------
"RTN","BIREPL",82,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPL",83,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPL",84,0)
 ;---> Parameters:
"RTN","BIREPL",85,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPL",86,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPL",87,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPL",88,0)
 ;
"RTN","BIREPL",89,0)
 Q:'$D(BILINE)
"RTN","BIREPL",90,0)
 D WL^BIW(.BILINE,"BIREPL",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPL",91,0)
 Q
"RTN","BIREPL",92,0)
 ;
"RTN","BIREPL",93,0)
 ;
"RTN","BIREPL",94,0)
 ;----------
"RTN","BIREPL",95,0)
RESET ;EP
"RTN","BIREPL",96,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPL",97,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPL",98,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPL",99,0)
 D INIT Q
"RTN","BIREPL",100,0)
 ;
"RTN","BIREPL",101,0)
 ;
"RTN","BIREPL",102,0)
 ;----------
"RTN","BIREPL",103,0)
HELP ;EP
"RTN","BIREPL",104,0)
 ;---> Help code.
"RTN","BIREPL",105,0)
 N BIX S BIX=X
"RTN","BIREPL",106,0)
 D FULL^VALM1
"RTN","BIREPL",107,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPL",108,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPL",109,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPL",110,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPL",111,0)
 Q
"RTN","BIREPL",112,0)
 ;
"RTN","BIREPL",113,0)
 ;
"RTN","BIREPL",114,0)
 ;----------
"RTN","BIREPL",115,0)
HELP1 ;EP
"RTN","BIREPL",116,0)
 ;----> Explanation of this report.
"RTN","BIREPL",117,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPL",118,0)
 D START^BIHELP("ADULT IMMUNIZATION REPORT - HELP",.BITEXT)
"RTN","BIREPL",119,0)
 Q
"RTN","BIREPL",120,0)
 ;
"RTN","BIREPL",121,0)
 ;
"RTN","BIREPL",122,0)
 ;----------
"RTN","BIREPL",123,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPL",124,0)
 ;;
"RTN","BIREPL",125,0)
 ;;This report will provide statistics on Adult Immunizations.
"RTN","BIREPL",126,0)
 ;;The population of patients reviewed are those 19 years and older.
"RTN","BIREPL",127,0)
 ;;
"RTN","BIREPL",128,0)
 ;;Criteria:
"RTN","BIREPL",129,0)
 ;;Tetanus:  The patient must have had a tetanus immunization documented
"RTN","BIREPL",130,0)
 ;;in the past 10 years.  This includes any of the following CVX Codes:
"RTN","BIREPL",131,0)
 ;;1, 9, 20, 22, 28, 50, 106, 107, 110, 113, 115.
"RTN","BIREPL",132,0)
 ;;If parameter 5 "Include CPT Coded Visits" is set to "yes", then any
"RTN","BIREPL",133,0)
 ;;of the following codes will count: 90701,90718,90700,90720,90702,
"RTN","BIREPL",134,0)
 ;;90703,90721,90723.
"RTN","BIREPL",135,0)
 ;;
"RTN","BIREPL",136,0)
 ;;Pneumovax:  Adults 65 years and older must have had a pneumococcal
"RTN","BIREPL",137,0)
 ;;immunization documented at or after age 65 years.  This includes any
"RTN","BIREPL",138,0)
 ;;of the following CVX Codes: 33, 100, 109.
"RTN","BIREPL",139,0)
 ;;
"RTN","BIREPL",140,0)
 ;;When VIEWING the report on-screen, you will be able to view the
"RTN","BIREPL",141,0)
 ;;lists of patients who were "Current" or "Not Current."
"RTN","BIREPL",142,0)
 ;;In this context, the list of "Current" adults includes those who
"RTN","BIREPL",143,0)
 ;;are current for Td/Tdap (within the last 10 years) and for pneumo
"RTN","BIREPL",144,0)
 ;;vaccines on the date of the report.
"RTN","BIREPL",145,0)
 ;;
"RTN","BIREPL",146,0)
 ;;The IMMUNIZATION ADULT REPORT screen allows you to adjust the
"RTN","BIREPL",147,0)
 ;;report to your needs.
"RTN","BIREPL",148,0)
 ;;
"RTN","BIREPL",149,0)
 ;;There are 6 items or "parameters" on the screen that you may
"RTN","BIREPL",150,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPL",151,0)
 ;;To change an item, enter its left column number (1-6) at the
"RTN","BIREPL",152,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPL",153,0)
 ;;you would like more information on the parameter you are changing.
"RTN","BIREPL",154,0)
 ;;
"RTN","BIREPL",155,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPL",156,0)
 ;;you want, select V to View the Adult Report or P to print it.
"RTN","BIREPL",157,0)
 ;;
"RTN","BIREPL",158,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPL",159,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPL",160,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPL",161,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPL",162,0)
 ;;
"RTN","BIREPL",163,0)
 ;;QUARTER ENDING DATE: The report will compile immunization rates
"RTN","BIREPL",164,0)
 ;;as of the date entered.  Typically, this date would be the end
"RTN","BIREPL",165,0)
 ;;of a Quarter.
"RTN","BIREPL",166,0)
 ;;
"RTN","BIREPL",167,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPL",168,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPL",169,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPL",170,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPL",171,0)
 ;;NOTE: You may want to select the GPRA set of Communities, in order
"RTN","BIREPL",172,0)
 ;;to more closely match the GPRA report produced by the CRS module
"RTN","BIREPL",173,0)
 ;;(RPMS Clinical Reporting System).
"RTN","BIREPL",174,0)
 ;;
"RTN","BIREPL",175,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIREPL",176,0)
 ;;Facilities, only Patients who have active Chart#'s at one or more
"RTN","BIREPL",177,0)
 ;;of the selected Facilities will be included in the report.
"RTN","BIREPL",178,0)
 ;;
"RTN","BIREPL",179,0)
 ;;BENEFICIARY TYPES: If you select for specific Beneficiary Types,
"RTN","BIREPL",180,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPL",181,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPL",182,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPL",183,0)
 ;;
"RTN","BIREPL",184,0)
 ;;INCLUDE CPT CODED VISITS: If you answer "YES" to this question
"RTN","BIREPL",185,0)
 ;;the report will search for any immunizations that were only entered
"RTN","BIREPL",186,0)
 ;;as CPT Codes, and it will include those immunizations in the
"RTN","BIREPL",187,0)
 ;;statistical results of this report.
"RTN","BIREPL",188,0)
 ;;
"RTN","BIREPL",189,0)
 ;;PATIENT POPULATION GROUP: You may select one of four patient groups
"RTN","BIREPL",190,0)
 ;;to be considered in the report: Registered Patients (All),
"RTN","BIREPL",191,0)
 ;;Immunization Register Patients (Active), User Population (1+ visits
"RTN","BIREPL",192,0)
 ;;in 3 yrs), or Active Clinical Users (2+ visits in 3 yrs).
"RTN","BIREPL",193,0)
 ;;Active Clinical Users is the default.
"RTN","BIREPL",194,0)
 ;;
"RTN","BIREPL",195,0)
 ;;
"RTN","BIREPL",196,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPL",197,0)
 Q
"RTN","BIREPL",198,0)
 ;
"RTN","BIREPL",199,0)
 ;
"RTN","BIREPL",200,0)
 ;----------
"RTN","BIREPL",201,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPL",202,0)
 Q:$G(BILINL)=""
"RTN","BIREPL",203,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPL",204,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPL",205,0)
 Q
"RTN","BIREPL",206,0)
 ;
"RTN","BIREPL",207,0)
 ;
"RTN","BIREPL",208,0)
 ;----------
"RTN","BIREPL",209,0)
EXIT ;EP
"RTN","BIREPL",210,0)
 ;---> End of job cleanup.
"RTN","BIREPL",211,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPL",212,0)
 K ^TMP("BIREPL",$J)
"RTN","BIREPL",213,0)
 D CLEAR^VALM1
"RTN","BIREPL",214,0)
 D FULL^VALM1
"RTN","BIREPL",215,0)
 Q
"RTN","BIREPL1")
0^109^B22816799
"RTN","BIREPL1",1,0)
BIREPL1 ;IHS/CMI/MWR - REPORT, ADULT IMM; MAY 10, 2010
"RTN","BIREPL1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPL1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPL1",4,0)
 ;;  VIEW OR PRINT ADULT IMMUNIZATION REPORT.
"RTN","BIREPL1",5,0)
 ;
"RTN","BIREPL1",6,0)
 ;
"RTN","BIREPL1",7,0)
 ;----------
"RTN","BIREPL1",8,0)
START(BIX) ;EP
"RTN","BIREPL1",9,0)
 ;---> VIEW ADULT Report.
"RTN","BIREPL1",10,0)
 ;---> Prepare and display Adult Immunization Report.
"RTN","BIREPL1",11,0)
 ;---> Parameters:
"RTN","BIREPL1",12,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Adult Report.
"RTN","BIREPL1",13,0)
 ;                      If BIX="VIEW", then view Adult Report (default).
"RTN","BIREPL1",14,0)
 ;---> Variables:
"RTN","BIREPL1",15,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPL1",16,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPL1",17,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPL1",18,0)
 ;     4 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPL1",19,0)
 ;     5 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT (default).
"RTN","BIREPL1",20,0)
 ;     6 - BIUP   (req) User Population/Group
"RTN","BIREPL1",21,0)
 ;                      (Registered, Imm Reg Active, User 1+, Active 2+).
"RTN","BIREPL1",22,0)
 ;
"RTN","BIREPL1",23,0)
 ;---> Check for required Variables.
"RTN","BIREPL1",24,0)
 I '$G(BIQDT) D ERROR(622) D RESET^BIREPL Q
"RTN","BIREPL1",25,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPL Q
"RTN","BIREPL1",26,0)
 I '$D(BIHCF) D ERROR(625) D RESET^BIREPL Q
"RTN","BIREPL1",27,0)
 I '$D(BIBEN) D ERROR(662) D RESET^BIREPL Q
"RTN","BIREPL1",28,0)
 I '$D(BICPTI) S BICPTI=0
"RTN","BIREPL1",29,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPL1",30,0)
 ;
"RTN","BIREPL1",31,0)
 D SETVARS^BIUTL5 N VALMCNT
"RTN","BIREPL1",32,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPL Q
"RTN","BIREPL1",33,0)
 ;
"RTN","BIREPL1",34,0)
 ;---> Set BIRTN in case user runs Patient List then needs to return
"RTN","BIREPL1",35,0)
 ;---> to INIT here.
"RTN","BIREPL1",36,0)
 ;---> Set BITITL for Report Name in Patient List, if called.
"RTN","BIREPL1",37,0)
 ;---> Set BIAG for Age Range in header of report.
"RTN","BIREPL1",38,0)
 N BIAG,BIRTN,BITITL S BIRTN="BIREPL1",BITITL="ADULT",BIAG="19+^1"
"RTN","BIREPL1",39,0)
 D EN
"RTN","BIREPL1",40,0)
 D RESET^BIREPL
"RTN","BIREPL1",41,0)
 Q
"RTN","BIREPL1",42,0)
 ;
"RTN","BIREPL1",43,0)
 ;
"RTN","BIREPL1",44,0)
 ;----------
"RTN","BIREPL1",45,0)
PRINT ;EP
"RTN","BIREPL1",46,0)
 ;---> Main entry point for printing the ADULT Immunization Report.
"RTN","BIREPL1",47,0)
 D DEVICE(.BIPOP)
"RTN","BIREPL1",48,0)
 Q:$G(BIPOP)
"RTN","BIREPL1",49,0)
 ;
"RTN","BIREPL1",50,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPL1",51,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPL1",52,0)
 ;
"RTN","BIREPL1",53,0)
 ;---> Prepare report.
"RTN","BIREPL1",54,0)
 K ^TMP("BIREPL1",$J),^TMP("BIDUL",$J)
"RTN","BIREPL1",55,0)
 N VALM,VALMHDR
"RTN","BIREPL1",56,0)
 D HDR,START^BIREPL2(BIQDT,.BICC,.BIHCF,.BIBEN,BICPTI,BIUP)
"RTN","BIREPL1",57,0)
 ;
"RTN","BIREPL1",58,0)
 D PRTLST^BIUTL8("BIREPL1")
"RTN","BIREPL1",59,0)
 D EXIT,RESET^BIREPL
"RTN","BIREPL1",60,0)
 Q
"RTN","BIREPL1",61,0)
 ;
"RTN","BIREPL1",62,0)
 ;
"RTN","BIREPL1",63,0)
 ;----------
"RTN","BIREPL1",64,0)
EN ;EP
"RTN","BIREPL1",65,0)
 ;---> Main entry point for List Template BI REPORT ADULT IMM1.
"RTN","BIREPL1",66,0)
 D EN^VALM("BI REPORT ADULT IMM1")
"RTN","BIREPL1",67,0)
 Q
"RTN","BIREPL1",68,0)
 ;
"RTN","BIREPL1",69,0)
 ;
"RTN","BIREPL1",70,0)
 ;----------
"RTN","BIREPL1",71,0)
HDR ;EP
"RTN","BIREPL1",72,0)
 ;---> Header code
"RTN","BIREPL1",73,0)
 D HEAD^BIREPL2(BIQDT,.BICC,.BIHCF,.BIBEN,BICPTI,BIUP)
"RTN","BIREPL1",74,0)
 Q
"RTN","BIREPL1",75,0)
 ;
"RTN","BIREPL1",76,0)
 ;
"RTN","BIREPL1",77,0)
 ;----------
"RTN","BIREPL1",78,0)
INIT ;EP
"RTN","BIREPL1",79,0)
 ;---> Initialize variables and list array.
"RTN","BIREPL1",80,0)
 K ^TMP("BIREPL1",$J),^TMP("BIDUL",$J)
"RTN","BIREPL1",81,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPL1",82,0)
 S VALMSG="To view patient rosters, select a group below:"
"RTN","BIREPL1",83,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPL1",84,0)
 D START^BIREPL2(BIQDT,.BICC,.BIHCF,.BIBEN,BICPTI,BIUP)
"RTN","BIREPL1",85,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPL1",86,0)
 D ZSAVES^BIUTL3
"RTN","BIREPL1",87,0)
 Q
"RTN","BIREPL1",88,0)
 ;
"RTN","BIREPL1",89,0)
 ;
"RTN","BIREPL1",90,0)
 ;----------
"RTN","BIREPL1",91,0)
RESET ;EP
"RTN","BIREPL1",92,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPL1",93,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPL1",94,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPL1",95,0)
 D INIT,HDR
"RTN","BIREPL1",96,0)
 Q
"RTN","BIREPL1",97,0)
 ;
"RTN","BIREPL1",98,0)
 ;
"RTN","BIREPL1",99,0)
 ;----------
"RTN","BIREPL1",100,0)
RESET1 ;EP
"RTN","BIREPL1",101,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPL1",102,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPL1",103,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPL1",104,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPL1",105,0)
 S VALMSG="To view patient lists, select a group below:"
"RTN","BIREPL1",106,0)
 D HDR
"RTN","BIREPL1",107,0)
 Q
"RTN","BIREPL1",108,0)
 ;
"RTN","BIREPL1",109,0)
 ;
"RTN","BIREPL1",110,0)
 ;----------
"RTN","BIREPL1",111,0)
HELP ;EP
"RTN","BIREPL1",112,0)
 N BIX S BIX=X
"RTN","BIREPL1",113,0)
 D FULL^VALM1 N BIPOP
"RTN","BIREPL1",114,0)
 D TITLE^BIUTL5("VIEW ADULT REPORT - HELP")
"RTN","BIREPL1",115,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIREPL1",116,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPL1",117,0)
 Q
"RTN","BIREPL1",118,0)
 ;
"RTN","BIREPL1",119,0)
 ;
"RTN","BIREPL1",120,0)
 ;----------
"RTN","BIREPL1",121,0)
TEXT1 ;EP
"RTN","BIREPL1",122,0)
 ;;You have chosen to View the Adult Report rather than Print it.
"RTN","BIREPL1",123,0)
 ;;(You may print the report from here as well by entering "PL".)
"RTN","BIREPL1",124,0)
 ;;
"RTN","BIREPL1",125,0)
 ;;Also, you may:
"RTN","BIREPL1",126,0)
 ;;
"RTN","BIREPL1",127,0)
 ;;Enter "N" to view the list of Patients who were NOT Current
"RTN","BIREPL1",128,0)
 ;;          or "NOT up-to-date" with their immunizations, according
"RTN","BIREPL1",129,0)
 ;;          to recommendeded guidelines for their age.
"RTN","BIREPL1",130,0)
 ;;
"RTN","BIREPL1",131,0)
 ;;Enter "C" to view the list of Patients who were CURRENT or
"RTN","BIREPL1",132,0)
 ;;          "up-to-date" with their immunizations, according to
"RTN","BIREPL1",133,0)
 ;;          recommendeded guidelines for their age.
"RTN","BIREPL1",134,0)
 ;;
"RTN","BIREPL1",135,0)
 ;;Enter "B" to view a list of both groups of patients combined.
"RTN","BIREPL1",136,0)
 ;;
"RTN","BIREPL1",137,0)
 ;;
"RTN","BIREPL1",138,0)
 D PRINTX("TEXT1")
"RTN","BIREPL1",139,0)
 Q
"RTN","BIREPL1",140,0)
 ;
"RTN","BIREPL1",141,0)
 ;
"RTN","BIREPL1",142,0)
 ;----------
"RTN","BIREPL1",143,0)
EXIT ;EP
"RTN","BIREPL1",144,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPL1",145,0)
 K ^TMP("BIREPL1",$J),^TMP("BIDUL",$J)
"RTN","BIREPL1",146,0)
 D CLEAR^VALM1
"RTN","BIREPL1",147,0)
 D FULL^VALM1
"RTN","BIREPL1",148,0)
 Q
"RTN","BIREPL1",149,0)
 ;
"RTN","BIREPL1",150,0)
 ;
"RTN","BIREPL1",151,0)
 ;----------
"RTN","BIREPL1",152,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPL1",153,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPL1",154,0)
 ;---> Parameters:
"RTN","BIREPL1",155,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPL1",156,0)
 ;
"RTN","BIREPL1",157,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPL1",158,0)
 S ZTRTN="DEQUEUE^BIREPL1"
"RTN","BIREPL1",159,0)
 D ZSAVES^BIUTL3
"RTN","BIREPL1",160,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPL1",161,0)
 Q
"RTN","BIREPL1",162,0)
 ;
"RTN","BIREPL1",163,0)
 ;
"RTN","BIREPL1",164,0)
 ;----------
"RTN","BIREPL1",165,0)
DEQUEUE ;EP
"RTN","BIREPL1",166,0)
 ;
"RTN","BIREPL1",167,0)
 ;---> Prepare and print ADULT Report.
"RTN","BIREPL1",168,0)
 K VALMHDR,^TMP("BIREPL1",$J)
"RTN","BIREPL1",169,0)
 D HDR^BIREPL1,START^BIREPL2(BIQDT,.BICC,.BIHCF,.BIBEN,BICPTI,BIUP)
"RTN","BIREPL1",170,0)
 D PRTLST^BIUTL8("BIREPL1"),EXIT
"RTN","BIREPL1",171,0)
 Q
"RTN","BIREPL1",172,0)
 ;
"RTN","BIREPL1",173,0)
 ;
"RTN","BIREPL1",174,0)
 ;----------
"RTN","BIREPL1",175,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPL1",176,0)
 Q:$G(BILINL)=""
"RTN","BIREPL1",177,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPL1",178,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPL1",179,0)
 Q
"RTN","BIREPL1",180,0)
 ;
"RTN","BIREPL1",181,0)
 ;
"RTN","BIREPL1",182,0)
 ;----------
"RTN","BIREPL1",183,0)
ERROR(BIERR) ;EP
"RTN","BIREPL1",184,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPL1",185,0)
 ;---> Parameters:
"RTN","BIREPL1",186,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPL1",187,0)
 ;
"RTN","BIREPL1",188,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPL1",189,0)
 Q
"RTN","BIREPL2")
0^110^B55205516
"RTN","BIREPL2",1,0)
BIREPL2 ;IHS/CMI/MWR - REPORT, ADULT IMM; MAY 10, 2010
"RTN","BIREPL2",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPL2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPL2",4,0)
 ;;  VIEW ADULT IMMUNIZATION REPORT, GATHER DATA.
"RTN","BIREPL2",5,0)
 ;;  PATCH 3: Remove Date Range line (no longer relevant).  HEAD+33
"RTN","BIREPL2",6,0)
 ;;  PATCH 3: Set HPV upper limit display for males to 21 years. DISPLAY+69
"RTN","BIREPL2",7,0)
 ;
"RTN","BIREPL2",8,0)
 ;
"RTN","BIREPL2",9,0)
 ;----------
"RTN","BIREPL2",10,0)
HEAD(BIQDT,BICC,BIHCF,BIBEN,BICPTI,BIUP) ;EP
"RTN","BIREPL2",11,0)
 ;---> Produce Header array for ADULT Immunization Report.
"RTN","BIREPL2",12,0)
 ;---> Parameters:
"RTN","BIREPL2",13,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPL2",14,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPL2",15,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPL2",16,0)
 ;     4 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPL2",17,0)
 ;     5 - BICPTI (req) 1=Include CPT Coded Visits, 0=Ignore CPT
"RTN","BIREPL2",18,0)
 ;     6 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPL2",19,0)
 ;
"RTN","BIREPL2",20,0)
 ;---> Check for required Variables.
"RTN","BIREPL2",21,0)
 Q:'$G(BIQDT)
"RTN","BIREPL2",22,0)
 Q:'$D(BICC)
"RTN","BIREPL2",23,0)
 Q:'$D(BIHCF)
"RTN","BIREPL2",24,0)
 Q:'$D(BIBEN)
"RTN","BIREPL2",25,0)
 I '$D(BICPTI) S BICPTI=0
"RTN","BIREPL2",26,0)
 Q:'$D(BIUP)
"RTN","BIREPL2",27,0)
 ;
"RTN","BIREPL2",28,0)
 K VALMHDR
"RTN","BIREPL2",29,0)
 N BILINE,X S BILINE=0
"RTN","BIREPL2",30,0)
 ;
"RTN","BIREPL2",31,0)
 N X S X=""
"RTN","BIREPL2",32,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPL2",33,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPL2",34,0)
 ;
"RTN","BIREPL2",35,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPL2",36,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPL2",37,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPL2",38,0)
 ;
"RTN","BIREPL2",39,0)
 S X="*  Adult Immunization Report  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPL2",40,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPL2",41,0)
 ;
"RTN","BIREPL2",42,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPL2",43,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPL2",44,0)
 ;---> Remove Date Range line (no longer relevant).
"RTN","BIREPL2",45,0)
 ;D WH^BIW(.BILINE,X)
"RTN","BIREPL2",46,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPL2",47,0)
 ;
"RTN","BIREPL2",48,0)
 ;S X=$$SP^BIUTL5(28)_"Date Range: "_$$SLDT1^BIUTL5(BIQDT-10000)_" - "_$$SLDT1^BIUTL5(BIQDT)
"RTN","BIREPL2",49,0)
 ;D WH^BIW(.BILINE,X,1)
"RTN","BIREPL2",50,0)
 ;**********
"RTN","BIREPL2",51,0)
 ;
"RTN","BIREPL2",52,0)
 S X=" "_$$BIUPTX^BIUTL6(BIUP)
"RTN","BIREPL2",53,0)
 I BICPTI S X=$$PAD^BIUTL5(X,52)_"* CPT Coded Visits Included"
"RTN","BIREPL2",54,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPL2",55,0)
 D WH^BIW(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPL2",56,0)
 ;
"RTN","BIREPL2",57,0)
 D
"RTN","BIREPL2",58,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPL2",59,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPL2",60,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,13)
"RTN","BIREPL2",61,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPL2",62,0)
 .;
"RTN","BIREPL2",63,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPL2",64,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,13)
"RTN","BIREPL2",65,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPL2",66,0)
 .;
"RTN","BIREPL2",67,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPL2",68,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,13)
"RTN","BIREPL2",69,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPL2",70,0)
 .;
"RTN","BIREPL2",71,0)
 .S X=$$SP^BIUTL5(59)_"Number   Percent"
"RTN","BIREPL2",72,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPL2",73,0)
 ;
"RTN","BIREPL2",74,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPL2",75,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPL2",76,0)
 D:$D(VALM("BM"))
"RTN","BIREPL2",77,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPL2",78,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPL2",79,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPL2",80,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPL2",81,0)
 Q
"RTN","BIREPL2",82,0)
 ;
"RTN","BIREPL2",83,0)
 ;
"RTN","BIREPL2",84,0)
 ;----------
"RTN","BIREPL2",85,0)
START(BIQDT,BICC,BIHCF,BIBEN,BICPTI,BIUP) ;EP
"RTN","BIREPL2",86,0)
 ;---> Produce array for ADULT Immunization Report.
"RTN","BIREPL2",87,0)
 ;---> Parameters:
"RTN","BIREPL2",88,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPL2",89,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPL2",90,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPL2",91,0)
 ;     4 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPL2",92,0)
 ;     5 - BICPTI (req) 1=Include CPT Coded Visits, 0=Ignore CPT (default).
"RTN","BIREPL2",93,0)
 ;     6 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPL2",94,0)
 ;
"RTN","BIREPL2",95,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPL2",96,0)
 K ^TMP("BIREPL1",$J)
"RTN","BIREPL2",97,0)
 ;
"RTN","BIREPL2",98,0)
 ;---> Check for required Variables.
"RTN","BIREPL2",99,0)
 ;---> Fix for v8.1 by adding .X to error calls below.
"RTN","BIREPL2",100,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(623,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPL2",101,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPL2",102,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPL2",103,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPL2",104,0)
 I '$D(BICPTI) S BICPTI=0
"RTN","BIREPL2",105,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPL2",106,0)
 ;
"RTN","BIREPL2",107,0)
 D GETSTATS^BIREPL3(BIQDT,.BICC,.BIHCF,.BIBEN,BICPTI,BIUP,.BITOTS)
"RTN","BIREPL2",108,0)
 D DISPLAY(BITOTS,.BILINE)
"RTN","BIREPL2",109,0)
 S VALMCNT=BILINE
"RTN","BIREPL2",110,0)
 Q
"RTN","BIREPL2",111,0)
 ;
"RTN","BIREPL2",112,0)
 ;
"RTN","BIREPL2",113,0)
 ;----------
"RTN","BIREPL2",114,0)
DISPLAY(BITOTS,BILINE) ;EP
"RTN","BIREPL2",115,0)
 ;---> Write Adult Stats for display.
"RTN","BIREPL2",116,0)
 ;---> Parameters:
"RTN","BIREPL2",117,0)
 ;     1 - BITOTS (req) Totals delimited by "^":
"RTN","BIREPL2",118,0)
 ;                      Pc   Variable
"RTN","BIREPL2",119,0)
 ;                       1 - BI19=Total over 19
"RTN","BIREPL2",120,0)
 ;                       2 - BIT19 = Number over 19 w/Tetanus past 10 years.
"RTN","BIREPL2",121,0)
 ;                       3 - BITDAP = Number over 19 w/Tdap past 10 years.
"RTN","BIREPL2",122,0)
 ;
"RTN","BIREPL2",123,0)
 ;                       4 - BIHPVF  = Total number of Females age 19-26
"RTN","BIREPL2",124,0)
 ;                       5 - BIHPVF1 = Number Females 19-26 w/HPV-1
"RTN","BIREPL2",125,0)
 ;                       6 - BIHPVF2 = Number Females 19-26 w/HPV-2
"RTN","BIREPL2",126,0)
 ;                       7 - BIHPVF3 = Number Females 19-26 w/HPV-3
"RTN","BIREPL2",127,0)
 ;                       8 - BIHPVF  = Total number of Males age 19-26
"RTN","BIREPL2",128,0)
 ;                       9 - BIHPVM1 = Number Males 19-26 w/HPV-1
"RTN","BIREPL2",129,0)
 ;                      10 - BIHPVM2 = Number Males 19-26 w/HPV-2
"RTN","BIREPL2",130,0)
 ;                      11 - BIHPVM3 = Number Males 19-26 w/HPV-3
"RTN","BIREPL2",131,0)
 ;
"RTN","BIREPL2",132,0)
 ;                      12 - BI60=Total over 60
"RTN","BIREPL2",133,0)
 ;                      13 - BIZ60 = Number over 60 w/Zoster ever.
"RTN","BIREPL2",134,0)
 ;                      14 - BI65=Total over 65
"RTN","BIREPL2",135,0)
 ;                      15 - BIT65 = Number over 65 w/Tetanus past 10 years.
"RTN","BIREPL2",136,0)
 ;                      16 - BIP65 = Number over 65 w/Pneumo at or after 65 years.
"RTN","BIREPL2",137,0)
 ;                      17 - BIP65E = Number over 65 w/Pneumo EVER.
"RTN","BIREPL2",138,0)
 ;
"RTN","BIREPL2",139,0)
 ;
"RTN","BIREPL2",140,0)
 ;     1 - BILINE (ret) Number of lines written to Listman scroll area.
"RTN","BIREPL2",141,0)
 ;
"RTN","BIREPL2",142,0)
 I $G(BITOTS)="" D ERRCD^BIUTL2(667,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPL2",143,0)
 ;
"RTN","BIREPL2",144,0)
 ;---> Set totals into BIV local array, 1-15.
"RTN","BIREPL2",145,0)
 N BIV,I F I=1:1:17 S BIV(I)=$P(BITOTS,U,I)
"RTN","BIREPL2",146,0)
 ;
"RTN","BIREPL2",147,0)
 S X=$$PAD("  Total Number of Patients over 19 years old",56)_": "
"RTN","BIREPL2",148,0)
 S X=X_$$C(BIV(1),0,8) D WRITE(.BILINE,X,1)
"RTN","BIREPL2",149,0)
 ;
"RTN","BIREPL2",150,0)
 S X=$$PAD("    TETANUS: # patients w/Td in past 10 years",56)
"RTN","BIREPL2",151,0)
 S X=X_": "_$$C(BIV(2),0,8)
"RTN","BIREPL2",152,0)
 I BIV(1) S X=X_$J((BIV(2)/BIV(1))*100,7,1)
"RTN","BIREPL2",153,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",154,0)
 ;
"RTN","BIREPL2",155,0)
 S X=$$PAD("    TETANUS: # patients w/Tdap in past 10 years",56)
"RTN","BIREPL2",156,0)
 S X=X_": "_$$C(BIV(3),0,8)
"RTN","BIREPL2",157,0)
 I BIV(1) S X=X_$J((BIV(3)/BIV(1))*100,7,1)
"RTN","BIREPL2",158,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL2",159,0)
 ;
"RTN","BIREPL2",160,0)
 ;---> Females (pcs 4-7).
"RTN","BIREPL2",161,0)
 S X=$$PAD("    HPV: Total # Female patients age 19-26",56)
"RTN","BIREPL2",162,0)
 S X=X_": "_$$C(BIV(4),0,8)
"RTN","BIREPL2",163,0)
 I BIV(1) S X=X_$J((BIV(4)/BIV(1))*100,7,1)
"RTN","BIREPL2",164,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",165,0)
 ;
"RTN","BIREPL2",166,0)
 S X=$$PAD("    HPV: # Female patients age 19-26 w/HPV1",56)
"RTN","BIREPL2",167,0)
 S X=X_": "_$$C(BIV(5),0,8)
"RTN","BIREPL2",168,0)
 I BIV(4) S X=X_$J((BIV(5)/BIV(4))*100,7,1)
"RTN","BIREPL2",169,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",170,0)
 ;
"RTN","BIREPL2",171,0)
 S X=$$PAD("    HPV: # Female patients age 19-26 w/HPV2",56)
"RTN","BIREPL2",172,0)
 S X=X_": "_$$C(BIV(6),0,8)
"RTN","BIREPL2",173,0)
 I BIV(4) S X=X_$J((BIV(6)/BIV(4))*100,7,1)
"RTN","BIREPL2",174,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",175,0)
 ;
"RTN","BIREPL2",176,0)
 S X=$$PAD("    HPV: # Female patients age 19-26 w/HPV3",56)
"RTN","BIREPL2",177,0)
 S X=X_": "_$$C(BIV(7),0,8)
"RTN","BIREPL2",178,0)
 I BIV(4) S X=X_$J((BIV(7)/BIV(4))*100,7,1)
"RTN","BIREPL2",179,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL2",180,0)
 ;
"RTN","BIREPL2",181,0)
 ;---> Males (pcs 8-11).
"RTN","BIREPL2",182,0)
 ;
"RTN","BIREPL2",183,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPL2",184,0)
 ;---> Change male age to display "19-21".
"RTN","BIREPL2",185,0)
 S X=$$PAD("    HPV: Total # Male patients age 19-21",56)
"RTN","BIREPL2",186,0)
 S X=X_": "_$$C(BIV(8),0,8)
"RTN","BIREPL2",187,0)
 I BIV(1) S X=X_$J((BIV(8)/BIV(1))*100,7,1)
"RTN","BIREPL2",188,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",189,0)
 ;
"RTN","BIREPL2",190,0)
 S X=$$PAD("    HPV: # Male patients age 19-21 w/HPV1",56)
"RTN","BIREPL2",191,0)
 S X=X_": "_$$C(BIV(9),0,8)
"RTN","BIREPL2",192,0)
 I BIV(8) S X=X_$J((BIV(9)/BIV(8))*100,7,1)
"RTN","BIREPL2",193,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",194,0)
 ;
"RTN","BIREPL2",195,0)
 S X=$$PAD("    HPV: # Male patients age 19-21 w/HPV2",56)
"RTN","BIREPL2",196,0)
 S X=X_": "_$$C(BIV(10),0,8)
"RTN","BIREPL2",197,0)
 I BIV(8) S X=X_$J((BIV(10)/BIV(8))*100,7,1)
"RTN","BIREPL2",198,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",199,0)
 ;
"RTN","BIREPL2",200,0)
 S X=$$PAD("    HPV: # Male patients age 19-21 w/HPV3",56)
"RTN","BIREPL2",201,0)
 ;**********
"RTN","BIREPL2",202,0)
 ;
"RTN","BIREPL2",203,0)
 S X=X_": "_$$C(BIV(11),0,8)
"RTN","BIREPL2",204,0)
 I BIV(8) S X=X_$J((BIV(11)/BIV(8))*100,7,1)
"RTN","BIREPL2",205,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL2",206,0)
 ;
"RTN","BIREPL2",207,0)
 ;---> Total patients over 60 & Zoster. (pcs 12-13).
"RTN","BIREPL2",208,0)
 S X=$$PAD("  Total Number of Patients over 60 years old",56)
"RTN","BIREPL2",209,0)
 S X=X_": "_$$C(BIV(12),0,8)
"RTN","BIREPL2",210,0)
 I BIV(1) S X=X_$J((BIV(12)/BIV(1))*100,7,1)
"RTN","BIREPL2",211,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",212,0)
 ;
"RTN","BIREPL2",213,0)
 S X=$$PAD("    ZOSTER: # patients w/Zostavax ever",56)
"RTN","BIREPL2",214,0)
 S X=X_": "_$$C(BIV(13),0,8)
"RTN","BIREPL2",215,0)
 I BIV(12) S X=X_$J((BIV(13)/BIV(12))*100,7,1)
"RTN","BIREPL2",216,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL2",217,0)
 ;
"RTN","BIREPL2",218,0)
 ;
"RTN","BIREPL2",219,0)
 ;---> Total patients over 65 (pcs 14-16).
"RTN","BIREPL2",220,0)
 S X=$$PAD("  Total Number of Patients over 65 years old",56)
"RTN","BIREPL2",221,0)
 S X=X_": "_$$C(BIV(14),0,8)
"RTN","BIREPL2",222,0)
 I BIV(1) S X=X_$J((BIV(14)/BIV(1))*100,7,1)
"RTN","BIREPL2",223,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",224,0)
 ;
"RTN","BIREPL2",225,0)
 S X=$$PAD("    TETANUS: # patients w/Td in past 10 years",56)
"RTN","BIREPL2",226,0)
 S X=X_": "_$$C(BIV(15),0,8)
"RTN","BIREPL2",227,0)
 I BIV(14) S X=X_$J((BIV(15)/BIV(14))*100,7,1)
"RTN","BIREPL2",228,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",229,0)
 ;
"RTN","BIREPL2",230,0)
 ;S X=$$PAD("    INFLUENZA: # pts w/Influenza vaccine in past year",56)
"RTN","BIREPL2",231,0)
 ;S X=X_": "_$$C(BIV(9),0,8)
"RTN","BIREPL2",232,0)
 ;I BIV(7) S X=X_$J((BIV(9)/BIV(7))*100,7,1)
"RTN","BIREPL2",233,0)
 ;D WRITE(.BILINE,X,1)
"RTN","BIREPL2",234,0)
 ;
"RTN","BIREPL2",235,0)
 S X=$$PAD("    PNEUMOVAX: # patients w/Pneumovax at or over 65 yrs",56)
"RTN","BIREPL2",236,0)
 S X=X_": "_$$C(BIV(16),0,8)
"RTN","BIREPL2",237,0)
 I BIV(14) S X=X_$J((BIV(16)/BIV(14))*100,7,1)
"RTN","BIREPL2",238,0)
 D WRITE(.BILINE,X)
"RTN","BIREPL2",239,0)
 ;
"RTN","BIREPL2",240,0)
 S X=$$PAD("    PNEUMOVAX: # patients w/Pneumovax ever",56)
"RTN","BIREPL2",241,0)
 S X=X_": "_$$C(BIV(17),0,8)
"RTN","BIREPL2",242,0)
 I BIV(14) S X=X_$J((BIV(17)/BIV(14))*100,7,1)
"RTN","BIREPL2",243,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL2",244,0)
 ;
"RTN","BIREPL2",245,0)
 ;
"RTN","BIREPL2",246,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPL2",247,0)
 N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPL2",248,0)
 S X="  Total Patients included who had Refusals on record....:"_$J(N,8)
"RTN","BIREPL2",249,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPL2",250,0)
 ;
"RTN","BIREPL2",251,0)
 S VALMCNT=BILINE
"RTN","BIREPL2",252,0)
 Q
"RTN","BIREPL2",253,0)
 ;
"RTN","BIREPL2",254,0)
 ;
"RTN","BIREPL2",255,0)
 ;----------
"RTN","BIREPL2",256,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPL2",257,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPL2",258,0)
 ;---> Parameters:
"RTN","BIREPL2",259,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPL2",260,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPL2",261,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPL2",262,0)
 ;
"RTN","BIREPL2",263,0)
 Q:'$D(BILINE)
"RTN","BIREPL2",264,0)
 D WL^BIW(.BILINE,"BIREPL1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPL2",265,0)
 ;
"RTN","BIREPL2",266,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPL2",267,0)
 S VALMCNT=BILINE
"RTN","BIREPL2",268,0)
 Q
"RTN","BIREPL2",269,0)
 ;
"RTN","BIREPL2",270,0)
 ;
"RTN","BIREPL2",271,0)
C(X,X2,X3) ;
"RTN","BIREPL2",272,0)
 D COMMA^%DTC
"RTN","BIREPL2",273,0)
 Q X
"RTN","BIREPL2",274,0)
 ;
"RTN","BIREPL2",275,0)
 ;
"RTN","BIREPL2",276,0)
 ;----------
"RTN","BIREPL2",277,0)
PAD(D,L,C) ;EP
"RTN","BIREPL2",278,0)
 Q $$PAD^BIUTL5($G(D),$G(L),".")
"RTN","BIREPL3")
0^111^B64725722
"RTN","BIREPL3",1,0)
BIREPL3 ;IHS/CMI/MWR - REPORT, ADULT IMM; OCT 15, 2010
"RTN","BIREPL3",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPL3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPL3",4,0)
 ;;  GATHER DATA FOR ADULT IMMUNIZATION REPORT.
"RTN","BIREPL3",5,0)
 ;;  PATCH 1:  Commented out for ref to ICPT for Code Set versioning. LASTFLU+25
"RTN","BIREPL3",6,0)
 ;;  PATCH 2: Filter for Active Clinical, using new standard $$ACTCLIN^BIUTL6 call.
"RTN","BIREPL3",7,0)
 ;;           GETSTATS+60
"RTN","BIREPL3",8,0)
 ;;  PATCH 3: Set HPV upper limit for males to 21 years of age. GETSTATS+119
"RTN","BIREPL3",9,0)
 ;
"RTN","BIREPL3",10,0)
 ;
"RTN","BIREPL3",11,0)
 ;----------
"RTN","BIREPL3",12,0)
GETSTATS(BIQDT,BICC,BIHCF,BIBEN,BICPTI,BIUP,BITOTS) ;EP
"RTN","BIREPL3",13,0)
 ;---> Produce array for ADULT Immunization Report.
"RTN","BIREPL3",14,0)
 ;---> Parameters:
"RTN","BIREPL3",15,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPL3",16,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPL3",17,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPL3",18,0)
 ;     4 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPL3",19,0)
 ;     5 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT (default).
"RTN","BIREPL3",20,0)
 ;     6 - BIUP   (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPL3",21,0)
 ;     7 - BITOTS (ret) Totals delimited by "^":
"RTN","BIREPL3",22,0)
 ;                      Pc   Variable
"RTN","BIREPL3",23,0)
 ;                       1 - BI19=Total over 19
"RTN","BIREPL3",24,0)
 ;                       2 - BIT19 = Number over 19 w/Tetanus past 10 years.
"RTN","BIREPL3",25,0)
 ;                       3 - BITDAP = Number over 19 w/Tdap past 10 years.
"RTN","BIREPL3",26,0)
 ;
"RTN","BIREPL3",27,0)
 ;                       4 - BIHPVF  = Total number of Females age 19-26
"RTN","BIREPL3",28,0)
 ;                       5 - BIHPVF1 = Number Females 19-26 w/HPV-1
"RTN","BIREPL3",29,0)
 ;                       6 - BIHPVF2 = Number Females 19-26 w/HPV-2
"RTN","BIREPL3",30,0)
 ;                       7 - BIHPVF3 = Number Females 19-26 w/HPV-3
"RTN","BIREPL3",31,0)
 ;                       8 - BIHPVF  = Total number of Males age 19-26
"RTN","BIREPL3",32,0)
 ;                       9 - BIHPVM1 = Number Males 19-21 w/HPV-1
"RTN","BIREPL3",33,0)
 ;                      10 - BIHPVM2 = Number Males 19-21 w/HPV-2
"RTN","BIREPL3",34,0)
 ;                      11 - BIHPVM3 = Number Males 19-21 w/HPV-3
"RTN","BIREPL3",35,0)
 ;
"RTN","BIREPL3",36,0)
 ;                      12 - BI60=Total over 60
"RTN","BIREPL3",37,0)
 ;                      13 - BIZ60 = Number over 60 w/Zoster ever.
"RTN","BIREPL3",38,0)
 ;                      14 - BI65=Total over 65
"RTN","BIREPL3",39,0)
 ;                      15 - BIT65 = Number over 65 w/Tetanus past 10 years.
"RTN","BIREPL3",40,0)
 ;                      16 - BIP65 = Number over 65 w/Pneumo at or after age 65.
"RTN","BIREPL3",41,0)
 ;                      17 - BIP65E = Number over 65 w/Pneumo EVER.
"RTN","BIREPL3",42,0)
 ;
"RTN","BIREPL3",43,0)
 N BIADOB,BIADOBE,BI19,BIT19,BITDAP
"RTN","BIREPL3",44,0)
 N BIHPVF,BIHPVF1,BIHPVF2,BIHPVF3,BIHPVM,BIHPVM1,BIHPVM2,BIHPVM3
"RTN","BIREPL3",45,0)
 N BI60,BIZ60
"RTN","BIREPL3",46,0)
 N BI65,BIT65,BIP65,BIP65E
"RTN","BIREPL3",47,0)
 S (BI19,BIHPVF,BIHPVM,BI60,BI65,BIP65,BI65E)=0
"RTN","BIREPL3",48,0)
 S:('$D(BICPTI)) BICPTI=0
"RTN","BIREPL3",49,0)
 S:('$G(BIQDT)) BIQDT=$G(DT)
"RTN","BIREPL3",50,0)
 ;
"RTN","BIREPL3",51,0)
 ;---> Loop through Patient global looking for visits and immunizations.
"RTN","BIREPL3",52,0)
 ;---> DOB must be at least 19 years before Quarter Ending Date.
"RTN","BIREPL3",53,0)
 S BIADOB=0,BIADOBE=BIQDT-190000
"RTN","BIREPL3",54,0)
 F  S BIADOB=$O(^DPT("ADOB",BIADOB)) Q:(BIADOB>BIADOBE)  D
"RTN","BIREPL3",55,0)
 .N BIDFN S BIDFN=0
"RTN","BIREPL3",56,0)
 .F  S BIDFN=$O(^DPT("ADOB",BIADOB,BIDFN)) Q:'BIDFN  D
"RTN","BIREPL3",57,0)
 ..;
"RTN","BIREPL3",58,0)
 ..;---> Filter for standard Patient Population parameter.
"RTN","BIREPL3",59,0)
 ..Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIQDT,BIUP)
"RTN","BIREPL3",60,0)
 ..;
"RTN","BIREPL3",61,0)
 ..;---> Get Age in Years for Stats.
"RTN","BIREPL3",62,0)
 ..N BIAGE S BIAGE=$$AGE^BIUTL1(BIDFN,1,BIQDT)
"RTN","BIREPL3",63,0)
 ..;---> Quit if under age 19 on the Quarter Ending Date.
"RTN","BIREPL3",64,0)
 ..Q:BIAGE<19
"RTN","BIREPL3",65,0)
 ..;
"RTN","BIREPL3",66,0)
 ..;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPL3",67,0)
 ..Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPL3",68,0)
 ..;
"RTN","BIREPL3",69,0)
 ..;---> Quit if Current Community doesn't match.
"RTN","BIREPL3",70,0)
 ..Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPL3",71,0)
 ..;
"RTN","BIREPL3",72,0)
 ..;---> Set patient as Not Due, BIVAL=2
"RTN","BIREPL3",73,0)
 ..;---> If patient is due (change below), set BIVAL=1.
"RTN","BIREPL3",74,0)
 ..S BIVAL=2
"RTN","BIREPL3",75,0)
 ..;
"RTN","BIREPL3",76,0)
 ..;---> Set totals.
"RTN","BIREPL3",77,0)
 ..S BI19=BI19+1 S:BIAGE>59 BI60=BI60+1 S:BIAGE>64 BI65=BI65+1
"RTN","BIREPL3",78,0)
 ..;
"RTN","BIREPL3",79,0)
 ..;---> Tetanus Stats.
"RTN","BIREPL3",80,0)
 ..D
"RTN","BIREPL3",81,0)
 ...I $$TD(BIDFN,BICPTI,BIQDT) D  Q
"RTN","BIREPL3",82,0)
 ....S BIT19=$G(BIT19)+1 S:BIAGE>64 BIT65=$G(BIT65)+1
"RTN","BIREPL3",83,0)
 ...;---> Patient is/was due for Tetanus.
"RTN","BIREPL3",84,0)
 ...S BIVAL=1
"RTN","BIREPL3",85,0)
 ..;
"RTN","BIREPL3",86,0)
 ..;---> Tdap Stats.
"RTN","BIREPL3",87,0)
 ..I $$TD(BIDFN,BICPTI,BIQDT,1) S BITDAP=$G(BITDAP)+1
"RTN","BIREPL3",88,0)
 ..;
"RTN","BIREPL3",89,0)
 ..;---> Flu Stats.
"RTN","BIREPL3",90,0)
 ..;D
"RTN","BIREPL3",91,0)
 ..;.I $$FLU(BIDFN,BICPTI,BIQDT) D  Q
"RTN","BIREPL3",92,0)
 ..;..S BIF19=$G(BIF19)+1 S:BIAGE>64 BIF65=$G(BIF65)+1
"RTN","BIREPL3",93,0)
 ..;..;
"RTN","BIREPL3",94,0)
 ..;.;---> Patient is due for Influenza.
"RTN","BIREPL3",95,0)
 ..;.S BIVAL=1
"RTN","BIREPL3",96,0)
 ..;
"RTN","BIREPL3",97,0)
 ..;---> Pneumo Stats.
"RTN","BIREPL3",98,0)
 ..D
"RTN","BIREPL3",99,0)
 ...N BIPNE65 S BIPNE65=$$PNEU(BIDFN,BIAGE,BICPTI,BIQDT)
"RTN","BIREPL3",100,0)
 ...;---> Patient received Pneumo sometime.
"RTN","BIREPL3",101,0)
 ...I $P(BIPNE65,U,2) S BIP65E=$G(BIP65E)+1
"RTN","BIREPL3",102,0)
 ...;---> If patient received Pneumo at or after age 65, quit: no longer due.
"RTN","BIREPL3",103,0)
 ...I $P(BIPNE65,U) S BIP65=$G(BIP65)+1 Q
"RTN","BIREPL3",104,0)
 ...;---> If >64 yrs and didn't receive pneumo, patient is due.
"RTN","BIREPL3",105,0)
 ...I BIAGE>64 S BIVAL=1
"RTN","BIREPL3",106,0)
 ..;
"RTN","BIREPL3",107,0)
 ..;*** NOT USED ANYMORE ***
"RTN","BIREPL3",108,0)
 ..;---> If pc22=1, forecast Pneumo every 6 years.
"RTN","BIREPL3",109,0)
 ..;D
"RTN","BIREPL3",110,0)
 ..;.;---> If Y=1, forecast Pneumo every 6 years.
"RTN","BIREPL3",111,0)
 ..;.;N Y S Y=$P($G(^BISITE(+$G(DUZ(2)),0)),U,22)
"RTN","BIREPL3",112,0)
 ..;.;---> If "forc q6y" and <6y, quit.
"RTN","BIREPL3",113,0)
 ..;.;I Y&($P(BIPNEU,U,2)) Q
"RTN","BIREPL3",114,0)
 ..;.;---> If "do not forc q6y" and pt has had one, then quit.
"RTN","BIREPL3",115,0)
 ..;.;I 'Y&($P(BIPNEU,U,1)) Q
"RTN","BIREPL3",116,0)
 ..;.;---> Patient is due for Pneumo.
"RTN","BIREPL3",117,0)
 ..;.;S BIVAL=1
"RTN","BIREPL3",118,0)
 ..;
"RTN","BIREPL3",119,0)
 ..;
"RTN","BIREPL3",120,0)
 ..;---> Zostavax Stats.
"RTN","BIREPL3",121,0)
 ..D
"RTN","BIREPL3",122,0)
 ...I $$OZSTER(BIDFN,BICPTI,BIQDT) D  Q
"RTN","BIREPL3",123,0)
 ....S:BIAGE>59 BIZ60=$G(BIZ60)+1
"RTN","BIREPL3",124,0)
 ...;
"RTN","BIREPL3",125,0)
 ...;---> Patient is/was due for Zostervax if 60+ years on QDT.
"RTN","BIREPL3",126,0)
 ...;********** v8.5, MAY 15,2011, IHS/CMI/MWR
"RTN","BIREPL3",127,0)
 ...;---> Do NOT include patient in Not Current group for zoster (not in
"RTN","BIREPL3",128,0)
 ...;---> widespread use.
"RTN","BIREPL3",129,0)
 ...;S:BIAGE>59 BIVAL=1
"RTN","BIREPL3",130,0)
 ..;
"RTN","BIREPL3",131,0)
 ..;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPL3",132,0)
 ..;---> Change HPV limit to 21 yrs for males.
"RTN","BIREPL3",133,0)
 ..;---> HPV Stats (ages 19-26 for females, 19-21 for males).
"RTN","BIREPL3",134,0)
 ..N BISECS S BISEX=$$SEX^BIUTL1(BIDFN)
"RTN","BIREPL3",135,0)
 ..;I (BIAGE>18)&(BIAGE<27) D
"RTN","BIREPL3",136,0)
 ..I (BIAGE>18)&(BIAGE<$S(BISEX="F":27,1:22)) D
"RTN","BIREPL3",137,0)
 ...;N BIHPVD,BISEX S BISEX=$$SEX^BIUTL1(BIDFN)
"RTN","BIREPL3",138,0)
 ...;S BIHPVD=$$HPV(BIDFN,BICPTI,BIQDT)
"RTN","BIREPL3",139,0)
 ...;**********
"RTN","BIREPL3",140,0)
 ...;
"RTN","BIREPL3",141,0)
 ...N BIHPVD S BIHPVD=$$HPV(BIDFN,BICPTI,BIQDT)
"RTN","BIREPL3",142,0)
 ...I BISEX="F" D  Q
"RTN","BIREPL3",143,0)
 ....S BIHPVF=$G(BIHPVF)+1
"RTN","BIREPL3",144,0)
 ....S:BIHPVD>0 BIHPVF1=$G(BIHPVF1)+1
"RTN","BIREPL3",145,0)
 ....S:BIHPVD>1 BIHPVF2=$G(BIHPVF2)+1
"RTN","BIREPL3",146,0)
 ....S:BIHPVD>2 BIHPVF3=$G(BIHPVF3)+1
"RTN","BIREPL3",147,0)
 ...I BISEX="M" D  Q
"RTN","BIREPL3",148,0)
 ....S BIHPVM=$G(BIHPVM)+1
"RTN","BIREPL3",149,0)
 ....S:BIHPVD>0 BIHPVM1=$G(BIHPVM1)+1
"RTN","BIREPL3",150,0)
 ....S:BIHPVD>1 BIHPVM2=$G(BIHPVM2)+1
"RTN","BIREPL3",151,0)
 ....S:BIHPVD>2 BIHPVM3=$G(BIHPVM3)+1
"RTN","BIREPL3",152,0)
 ..;
"RTN","BIREPL3",153,0)
 ..;---> Will Set ^TMP("BIDUL",$J,CURCOM,1,HRCN,BIDFN)=$G(BIVAL)
"RTN","BIREPL3",154,0)
 ..D STORE^BIDUR1(BIDFN,DT,9,,$G(BIVAL))
"RTN","BIREPL3",155,0)
 ..;
"RTN","BIREPL3",156,0)
 ..;---> Add refusals, if any.
"RTN","BIREPL3",157,0)
 ..N Z D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) S BITMP("REFUSALS",BIDFN)=""
"RTN","BIREPL3",158,0)
 ;
"RTN","BIREPL3",159,0)
 ;---> Now piece together the totals.
"RTN","BIREPL3",160,0)
 S BITOTS=$G(BI19)_U_$G(BIT19)_U_$G(BITDAP)
"RTN","BIREPL3",161,0)
 S BITOTS=BITOTS_U_$G(BIHPVF)_U_$G(BIHPVF1)_U_$G(BIHPVF2)_U_$G(BIHPVF3)
"RTN","BIREPL3",162,0)
 S BITOTS=BITOTS_U_$G(BIHPVM)_U_$G(BIHPVM1)_U_$G(BIHPVM2)_U_$G(BIHPVM3)
"RTN","BIREPL3",163,0)
 S BITOTS=BITOTS_U_$G(BI60)_U_$G(BIZ60)_U_$G(BI65)_U_$G(BIT65)_U_$G(BIP65)_U_$G(BIP65E)
"RTN","BIREPL3",164,0)
 Q
"RTN","BIREPL3",165,0)
 ;
"RTN","BIREPL3",166,0)
 ;
"RTN","BIREPL3",167,0)
 ;----------
"RTN","BIREPL3",168,0)
TD(BIDFN,BICPTI,BIQDT,BITDAP) ;EP
"RTN","BIREPL3",169,0)
 ;---> Return 1 if patient received TD during 10 years prior to QDT.
"RTN","BIREPL3",170,0)
 ;---> Parameters:
"RTN","BIREPL3",171,0)
 ;     1 - BIDFN  (req) Patient DFN
"RTN","BIREPL3",172,0)
 ;     2 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT.
"RTN","BIREPL3",173,0)
 ;     3 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date).
"RTN","BIREPL3",174,0)
 ;     4 - BIDTAP (opt) 1=Tdap ONLY and EVER (no prior date restriction).
"RTN","BIREPL3",175,0)
 ;
"RTN","BIREPL3",176,0)
 ;---> Check V Imms for TD's.
"RTN","BIREPL3",177,0)
 N BICVXS,BIDATE
"RTN","BIREPL3",178,0)
 S BIDATE=0 S:('$G(BIQDT)) BIQDT=$G(DT)
"RTN","BIREPL3",179,0)
 S BITDAP=+$G(BITDAP)
"RTN","BIREPL3",180,0)
 S BICVXS="1,9,20,22,28,50,106,107,110,113,115"
"RTN","BIREPL3",181,0)
 S:BITDAP BICVXS=115
"RTN","BIREPL3",182,0)
 S BIDATE=$$LASTIMM^BIUTL11(BIDFN,BICVXS,BIQDT)
"RTN","BIREPL3",183,0)
 ;
"RTN","BIREPL3",184,0)
 ;---> So, BIDATE is the latest TD in V Imm (but not after the QDT).
"RTN","BIREPL3",185,0)
 ;
"RTN","BIREPL3",186,0)
 ;---> Check (if requested) V CPTs for TD's.
"RTN","BIREPL3",187,0)
 D:$G(BICPTI)
"RTN","BIREPL3",188,0)
 .N BICPTS,Y
"RTN","BIREPL3",189,0)
 .S BICPTS="90701,90718,90700,90720,90702,90703,90721,90723"
"RTN","BIREPL3",190,0)
 .S:BITDAP BICPTS=90715
"RTN","BIREPL3",191,0)
 .S Y=$$LASTCPT^BIUTL11(BIDFN,BICPTS,BIQDT)
"RTN","BIREPL3",192,0)
 .S:Y>$G(BIDATE) BIDATE=Y
"RTN","BIREPL3",193,0)
 ;
"RTN","BIREPL3",194,0)
 ;---> Return 0 if last Td was MORE than 10 yrs prior to QDT (or never);
"RTN","BIREPL3",195,0)
 ;---> otherwise return 1.
"RTN","BIREPL3",196,0)
 Q $S((BIDATE+100000)<BIQDT:0,1:1)
"RTN","BIREPL3",197,0)
 ;
"RTN","BIREPL3",198,0)
 ;
"RTN","BIREPL3",199,0)
 ;----------
"RTN","BIREPL3",200,0)
FLU(BIDFN,BICPTI,BIQDT) ;EP
"RTN","BIREPL3",201,0)
 ;****** NOT USED FOR NOW *******
"RTN","BIREPL3",202,0)
 ;
"RTN","BIREPL3",203,0)
 ;---> Return 1 if patient received Flu within one year prior to the QDT.
"RTN","BIREPL3",204,0)
 ;---> Parameters:
"RTN","BIREPL3",205,0)
 ;     1 - BIDFN  (req) Patient DFN
"RTN","BIREPL3",206,0)
 ;     2 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT.
"RTN","BIREPL3",207,0)
 ;     3 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date).
"RTN","BIREPL3",208,0)
 ;
"RTN","BIREPL3",209,0)
 ;---> Check V Imms for FLU's.
"RTN","BIREPL3",210,0)
 N BICVXS,BIDATE
"RTN","BIREPL3",211,0)
 S BIDATE=0 S:('$G(BIQDT)) BIQDT=$G(DT)
"RTN","BIREPL3",212,0)
 ;********** v8.5, MAY 15,2011, IHS/CMI/MWR  Add 140 & 141.
"RTN","BIREPL3",213,0)
 S BICVXS="15,16,88,111,135,140,141"
"RTN","BIREPL3",214,0)
 S BIDATE=$$LASTIMM^BIUTL11(BIDFN,BICVXS,BIQDT)
"RTN","BIREPL3",215,0)
 ;
"RTN","BIREPL3",216,0)
 ;---> So, BIDATE is the latest FLU in V Imm (but not after the QDT).
"RTN","BIREPL3",217,0)
 ;
"RTN","BIREPL3",218,0)
 ;---> Check (if requested) V CPTs for FLU's.
"RTN","BIREPL3",219,0)
 D:$G(BICPTI)
"RTN","BIREPL3",220,0)
 .N BICPTS,Y
"RTN","BIREPL3",221,0)
 .S BICPTS="90655,90657,90658,90659,90660,90661,90662,90724"
"RTN","BIREPL3",222,0)
 .S Y=$$LASTCPT^BIUTL11(BIDFN,BICPTS,BIQDT)
"RTN","BIREPL3",223,0)
 .S:Y>$G(BIDATE) BIDATE=Y
"RTN","BIREPL3",224,0)
 ;
"RTN","BIREPL3",225,0)
 ;---> Return 0 if last Flu was MORE than 1 year prior to QDT or never;
"RTN","BIREPL3",226,0)
 ;---> otherwise 1.
"RTN","BIREPL3",227,0)
 Q $S((BIDATE+10000)<BIQDT:0,1:1)
"RTN","BIREPL3",228,0)
 ;
"RTN","BIREPL3",229,0)
 ;
"RTN","BIREPL3",230,0)
 ;----------
"RTN","BIREPL3",231,0)
PNEU(BIDFN,BIAGE,BICPTI,BIQDT) ;EP
"RTN","BIREPL3",232,0)
 ;---> Return date if patient received Pneumo, concat ^1 if received after 65.
"RTN","BIREPL3",233,0)
 ;---> Parameters:
"RTN","BIREPL3",234,0)
 ;     1 - BIDFN  (req) Patient DFN
"RTN","BIREPL3",235,0)
 ;     2 - BIAGE  (req) Patient age in years.
"RTN","BIREPL3",236,0)
 ;     3 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT.
"RTN","BIREPL3",237,0)
 ;     4 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date)
"RTN","BIREPL3",238,0)
 ;
"RTN","BIREPL3",239,0)
 ;---> Return 0 if patient is less than 65 yrs old.
"RTN","BIREPL3",240,0)
 Q:(BIAGE<65) 0
"RTN","BIREPL3",241,0)
 ;
"RTN","BIREPL3",242,0)
 ;---> Check V Imms for PNEU's.
"RTN","BIREPL3",243,0)
 N BICVXS,BIDATE
"RTN","BIREPL3",244,0)
 S BIDATE=0 S:('$G(BIQDT)) BIQDT=$G(DT)
"RTN","BIREPL3",245,0)
 S BICVXS="33,100,109"
"RTN","BIREPL3",246,0)
 S BIDATE=$$LASTIMM^BIUTL11(BIDFN,BICVXS,BIQDT)
"RTN","BIREPL3",247,0)
 ;
"RTN","BIREPL3",248,0)
 ;---> So, BIDATE is the latest PNEU in V Imm (but not after the QDT).
"RTN","BIREPL3",249,0)
 ;
"RTN","BIREPL3",250,0)
 ;---> Check (if requested) V CPTs for FLU's.
"RTN","BIREPL3",251,0)
 D:$G(BICPTI)
"RTN","BIREPL3",252,0)
 .N BICPTS,Y
"RTN","BIREPL3",253,0)
 .S BICPTS="90732,90669"
"RTN","BIREPL3",254,0)
 .S Y=$$LASTCPT^BIUTL11(BIDFN,BICPTS,BIQDT)
"RTN","BIREPL3",255,0)
 .S:Y>$G(BIDATE) BIDATE=Y
"RTN","BIREPL3",256,0)
 ;
"RTN","BIREPL3",257,0)
 ;---> Patient never received pneumo.
"RTN","BIREPL3",258,0)
 I +BIDATE=0 Q "0^0"
"RTN","BIREPL3",259,0)
 ;
"RTN","BIREPL3",260,0)
 ;---> If patient received pneumo at or after age 65, set BI65=1 (otherwise 0).
"RTN","BIREPL3",261,0)
 N BI65 S BI65=1
"RTN","BIREPL3",262,0)
 I ($$DOB^BIUTL1(BIDFN)+650000)>BIDATE S BI65=0
"RTN","BIREPL3",263,0)
 ;
"RTN","BIREPL3",264,0)
 ;---> Return After 65 indicator_^_Date of last Pneumo.
"RTN","BIREPL3",265,0)
 Q BI65_U_+BIDATE
"RTN","BIREPL3",266,0)
 ;
"RTN","BIREPL3",267,0)
 ;
"RTN","BIREPL3",268,0)
 ;----------
"RTN","BIREPL3",269,0)
OZSTER(BIDFN,BICPTI,BIQDT) ;EP
"RTN","BIREPL3",270,0)
 ;---> NOTE: "O" and "Z" reversed to avoid SACC trigger of $Z violation.
"RTN","BIREPL3",271,0)
 ;---> Return 1 if patient ever received Zostavax prior to the QDT.
"RTN","BIREPL3",272,0)
 ;---> Parameters:
"RTN","BIREPL3",273,0)
 ;     1 - BIDFN  (req) Patient DFN
"RTN","BIREPL3",274,0)
 ;     2 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT.
"RTN","BIREPL3",275,0)
 ;     3 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date).
"RTN","BIREPL3",276,0)
 ;
"RTN","BIREPL3",277,0)
 ;---> Check V Imms for Zostavax's.
"RTN","BIREPL3",278,0)
 N BICVXS,BIDATE
"RTN","BIREPL3",279,0)
 S BIDATE=0 S:('$G(BIQDT)) BIQDT=$G(DT)
"RTN","BIREPL3",280,0)
 S BICVXS="121"
"RTN","BIREPL3",281,0)
 S BIDATE=$$LASTIMM^BIUTL11(BIDFN,BICVXS,BIQDT)
"RTN","BIREPL3",282,0)
 ;
"RTN","BIREPL3",283,0)
 ;---> So, BIDATE is the latest Zostavax in V Imm (but not after the QDT).
"RTN","BIREPL3",284,0)
 ;
"RTN","BIREPL3",285,0)
 ;---> Check (if requested) V CPTs for Zostavax's.
"RTN","BIREPL3",286,0)
 D:$G(BICPTI)
"RTN","BIREPL3",287,0)
 .N BICPTS,Y
"RTN","BIREPL3",288,0)
 .S BICPTS="90736"
"RTN","BIREPL3",289,0)
 .S Y=$$LASTCPT^BIUTL11(BIDFN,BICPTS,BIQDT)
"RTN","BIREPL3",290,0)
 .S:Y>$G(BIDATE) BIDATE=Y
"RTN","BIREPL3",291,0)
 ;
"RTN","BIREPL3",292,0)
 ;---> Return 0 if patient Never received Zostavax prior to QDT otherwise 0.
"RTN","BIREPL3",293,0)
 Q +BIDATE
"RTN","BIREPL3",294,0)
 ;
"RTN","BIREPL3",295,0)
 ;
"RTN","BIREPL3",296,0)
 ;----------
"RTN","BIREPL3",297,0)
HPV(BIDFN,BICPTI,BIQDT) ;EP
"RTN","BIREPL3",298,0)
 ;---> Return number of HPV's patient received, concat
"RTN","BIREPL3",299,0)
 ;---> Parameters:
"RTN","BIREPL3",300,0)
 ;     1 - BIDFN  (req) Patient DFN
"RTN","BIREPL3",301,0)
 ;     2 - BICPTI (opt) 1=Include CPT Coded Visits, 0=Ignore CPT.
"RTN","BIREPL3",302,0)
 ;     3 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date).
"RTN","BIREPL3",303,0)
 ;
"RTN","BIREPL3",304,0)
 ;---> Check V Imms for FLU's.
"RTN","BIREPL3",305,0)
 N BICVXS,BIDATE,BIDOSES,I,J
"RTN","BIREPL3",306,0)
 S BIDATE=0,BIDOSES=0,J=0
"RTN","BIREPL3",307,0)
 S:('$G(BIQDT)) BIQDT=$G(DT)
"RTN","BIREPL3",308,0)
 S BICVXS="62,118,137"
"RTN","BIREPL3",309,0)
 S BIDATE=$$LASTIMM^BIUTL11(BIDFN,BICVXS,BIQDT,1)
"RTN","BIREPL3",310,0)
 ;
"RTN","BIREPL3",311,0)
 F I=1:1:3 I $P(BIDATE,",",I) S J=J+1
"RTN","BIREPL3",312,0)
 S BIDOSES=J
"RTN","BIREPL3",313,0)
 ;
"RTN","BIREPL3",314,0)
 ;---> Check (if requested) V CPTs for HPV's.
"RTN","BIREPL3",315,0)
 D:$G(BICPTI)
"RTN","BIREPL3",316,0)
 .N BICPTS,J S J=0
"RTN","BIREPL3",317,0)
 .S BICPTS="90649,90650"
"RTN","BIREPL3",318,0)
 .S BIDATE=$$LASTCPT^BIUTL11(BIDFN,BICPTS,BIQDT,1)
"RTN","BIREPL3",319,0)
 .F I=1:1:3 I $P(BIDATE,",",I) S J=J+1
"RTN","BIREPL3",320,0)
 .S BIDOSES=BIDOSES+J
"RTN","BIREPL3",321,0)
 ;
"RTN","BIREPL3",322,0)
 Q BIDOSES
"RTN","BIREPP")
0^112^B39936093
"RTN","BIREPP",1,0)
BIREPP ;IHS/CMI/MWR - REPORT, PCV; AUG 10,2010
"RTN","BIREPP",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPP",4,0)
 ;;  VIEW PCV REPORT.
"RTN","BIREPP",5,0)
 ;
"RTN","BIREPP",6,0)
 ;
"RTN","BIREPP",7,0)
 ;----------
"RTN","BIREPP",8,0)
START ;EP
"RTN","BIREPP",9,0)
 ;---> Listman Screen for viewing Vaccine Accountability Report.
"RTN","BIREPP",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPP",11,0)
 ;
"RTN","BIREPP",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPP",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPP",14,0)
 ;
"RTN","BIREPP",15,0)
 D EN
"RTN","BIREPP",16,0)
 D EXIT
"RTN","BIREPP",17,0)
 Q
"RTN","BIREPP",18,0)
 ;
"RTN","BIREPP",19,0)
 ;
"RTN","BIREPP",20,0)
 ;----------
"RTN","BIREPP",21,0)
EN ;EP
"RTN","BIREPP",22,0)
 ;---> Main entry point for BI REPORT VAC ACCOUNTABILITY.
"RTN","BIREPP",23,0)
 D EN^VALM("BI REPORT PCV")
"RTN","BIREPP",24,0)
 Q
"RTN","BIREPP",25,0)
 ;
"RTN","BIREPP",26,0)
 ;
"RTN","BIREPP",27,0)
 ;----------
"RTN","BIREPP",28,0)
INIT ;EP
"RTN","BIREPP",29,0)
 ;---> Initialize variables and list array.
"RTN","BIREPP",30,0)
 K ^TMP("BIREPP",$J),^TMP("BIDUL",$J)
"RTN","BIREPP",31,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPP",32,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPP",33,0)
 N BILINE,X S BILINE=0
"RTN","BIREPP",34,0)
 D WRITE(.BILINE)
"RTN","BIREPP",35,0)
 S X=IOUON_"PCV REPORT"
"RTN","BIREPP",36,0)
 D CENTERT^BIUTL5(.X,42)
"RTN","BIREPP",37,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPP",38,0)
 K X
"RTN","BIREPP",39,0)
 ;
"RTN","BIREPP",40,0)
 ;---> Date Range.
"RTN","BIREPP",41,0)
 D
"RTN","BIREPP",42,0)
 .;---> Quit if dates have already been selected.
"RTN","BIREPP",43,0)
 .Q:$G(BIBEGDT)
"RTN","BIREPP",44,0)
 .;---> Default: year prior to today.
"RTN","BIREPP",45,0)
 .N X,X1,X2
"RTN","BIREPP",46,0)
 .S (BIENDDT,X)=DT
"RTN","BIREPP",47,0)
 .S X1=X,X2=-365 D C^%DTC S BIBEGDT=X
"RTN","BIREPP",48,0)
 ;
"RTN","BIREPP",49,0)
 D DATERNG^BIREP(.BILINE,"BIREPP",1,BIBEGDT,BIENDDT,2,1,1)
"RTN","BIREPP",50,0)
 ;
"RTN","BIREPP",51,0)
 ;---> User Population.
"RTN","BIREPP",52,0)
 D:($G(BIUP)="")
"RTN","BIREPP",53,0)
 .I $$GPRAIEN^BIUTL6 S BIUP="a" Q
"RTN","BIREPP",54,0)
 .S BIUP="u"
"RTN","BIREPP",55,0)
 ;
"RTN","BIREPP",56,0)
 S X="     2 - Patient Population Group...: "_$$BIUPTX^BIUTL6(BIUP)
"RTN","BIREPP",57,0)
 D WRITE(.BILINE,X,2) K X
"RTN","BIREPP",58,0)
 ;
"RTN","BIREPP",59,0)
 ;---> Current Community.
"RTN","BIREPP",60,0)
 D DISP^BIREP(.BILINE,"BIREPP",.BICC,"Community",3,1)
"RTN","BIREPP",61,0)
 ;
"RTN","BIREPP",62,0)
 ;---> Health Care Facility.
"RTN","BIREPP",63,0)
 ;N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPP",64,0)
 ;D DISP^BIREP(.BILINE,"BIREPP",.BIHCF,A,3,2,,,,B)
"RTN","BIREPP",65,0)
 ;
"RTN","BIREPP",66,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPP",67,0)
 S VALMCNT=BILINE
"RTN","BIREPP",68,0)
 S BIRTN="BIREPP",BITITL="PCV"
"RTN","BIREPP",69,0)
 Q
"RTN","BIREPP",70,0)
 ;
"RTN","BIREPP",71,0)
 ;
"RTN","BIREPP",72,0)
 ;----------
"RTN","BIREPP",73,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPP",74,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPP",75,0)
 ;---> Parameters:
"RTN","BIREPP",76,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPP",77,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPP",78,0)
 ;
"RTN","BIREPP",79,0)
 Q:'$D(BILINE)
"RTN","BIREPP",80,0)
 D WL^BIW(.BILINE,"BIREPP",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPP",81,0)
 Q
"RTN","BIREPP",82,0)
 ;
"RTN","BIREPP",83,0)
 ;
"RTN","BIREPP",84,0)
 ;----------
"RTN","BIREPP",85,0)
RESET ;EP
"RTN","BIREPP",86,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPP",87,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPP",88,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPP",89,0)
 ;
"RTN","BIREPP",90,0)
 ;---> NOT USED.  Could be used to correct margins.
"RTN","BIREPP",91,0)
 ;K VALMHDR S VALM("BM")=15,VALM("LINES")=14,VALM("TM")=2
"RTN","BIREPP",92,0)
 D INIT
"RTN","BIREPP",93,0)
 Q
"RTN","BIREPP",94,0)
 ;
"RTN","BIREPP",95,0)
 ;
"RTN","BIREPP",96,0)
 ;----------
"RTN","BIREPP",97,0)
HELP ;EP
"RTN","BIREPP",98,0)
 ;---> Help code.
"RTN","BIREPP",99,0)
 N BIX S BIX=X
"RTN","BIREPP",100,0)
 D FULL^VALM1
"RTN","BIREPP",101,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPP",102,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPP",103,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPP",104,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPP",105,0)
 Q
"RTN","BIREPP",106,0)
 ;
"RTN","BIREPP",107,0)
 ;
"RTN","BIREPP",108,0)
 ;----------
"RTN","BIREPP",109,0)
HELP1 ;EP
"RTN","BIREPP",110,0)
 ;----> Explanation of this report.
"RTN","BIREPP",111,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPP",112,0)
 D START^BIHELP("PCV REPORT - HELP",.BITEXT)
"RTN","BIREPP",113,0)
 Q
"RTN","BIREPP",114,0)
 ;
"RTN","BIREPP",115,0)
 ;
"RTN","BIREPP",116,0)
 ;----------
"RTN","BIREPP",117,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPP",118,0)
 ;;The PCV Report provides "doses administered" by age group.
"RTN","BIREPP",119,0)
 ;;This report can be printed for any time period, and can be
"RTN","BIREPP",120,0)
 ;;limited to reporting for patients in one or more communities.
"RTN","BIREPP",121,0)
 ;;Note: Historical immunizations are included in this report
"RTN","BIREPP",122,0)
 ;;(those immunizations given at other sites and entered at this
"RTN","BIREPP",123,0)
 ;;site for completeness of records).
"RTN","BIREPP",124,0)
 ;;
"RTN","BIREPP",125,0)
 ;;There are 3 items or "parameters" on the screen that you may
"RTN","BIREPP",126,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPP",127,0)
 ;;To change an item, enter its left column number (1-3) at the
"RTN","BIREPP",128,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPP",129,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPP",130,0)
 ;;changing.
"RTN","BIREPP",131,0)
 ;;
"RTN","BIREPP",132,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPP",133,0)
 ;;you want, select V to View the PCV Report or P to print it.
"RTN","BIREPP",134,0)
 ;;
"RTN","BIREPP",135,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPP",136,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPP",137,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPP",138,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPP",139,0)
 ;;
"RTN","BIREPP",140,0)
 ;;DATE RANGE: Only immunizations given within the Date Range you
"RTN","BIREPP",141,0)
 ;;select will be included in the "Total Doses in Date Range" row
"RTN","BIREPP",142,0)
 ;;at the bottom of the report. (All other rows include PCV doses
"RTN","BIREPP",143,0)
 ;;given throughout patients' histories.
"RTN","BIREPP",144,0)
 ;;
"RTN","BIREPP",145,0)
 ;;PATIENT POPULATION GROUP: You may select one of four patient groups
"RTN","BIREPP",146,0)
 ;;to be considered in the report: Registered Patients (All),
"RTN","BIREPP",147,0)
 ;;Immunization Register Patients (Active), User Population (1+ visits
"RTN","BIREPP",148,0)
 ;;in 3 yrs), or Active Clinical Users (2+ visits in 3 yrs).
"RTN","BIREPP",149,0)
 ;;Active Clinical Users is the default.
"RTN","BIREPP",150,0)
 ;;
"RTN","BIREPP",151,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPP",152,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPP",153,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPP",154,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPP",155,0)
 ;;
"RTN","BIREPP",156,0)
 ;;
"RTN","BIREPP",157,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPP",158,0)
 Q
"RTN","BIREPP",159,0)
 ;
"RTN","BIREPP",160,0)
 ;
"RTN","BIREPP",161,0)
 ;----------
"RTN","BIREPP",162,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPP",163,0)
 Q:$G(BILINL)=""
"RTN","BIREPP",164,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPP",165,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPP",166,0)
 Q
"RTN","BIREPP",167,0)
 ;
"RTN","BIREPP",168,0)
 ;
"RTN","BIREPP",169,0)
 ;----------
"RTN","BIREPP",170,0)
EXIT ;EP
"RTN","BIREPP",171,0)
 ;---> End of job cleanup.
"RTN","BIREPP",172,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPP",173,0)
 K ^TMP("BIREPP",$J),^TMP("BIDFN",$J),^TMP("BIDUL",$J)
"RTN","BIREPP",174,0)
 D CLEAR^VALM1
"RTN","BIREPP",175,0)
 Q
"RTN","BIREPP1")
0^113^B12140642
"RTN","BIREPP1",1,0)
BIREPP1 ;IHS/CMI/MWR - REPORT, PCV; MAY 10, 2010
"RTN","BIREPP1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPP1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPP1",4,0)
 ;;  VIEW OR PRINT PCV REPORT.
"RTN","BIREPP1",5,0)
 ;
"RTN","BIREPP1",6,0)
 ;
"RTN","BIREPP1",7,0)
 ;----------
"RTN","BIREPP1",8,0)
START(BIX) ;EP
"RTN","BIREPP1",9,0)
 ;---> Prepare and display or print PCV Report.
"RTN","BIREPP1",10,0)
 ;---> Parameters:
"RTN","BIREPP1",11,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Report.
"RTN","BIREPP1",12,0)
 ;                      If BIX="VIEW", then view Report (default).
"RTN","BIREPP1",13,0)
 ;---> Variables:
"RTN","BIREPP1",14,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPP1",15,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPP1",16,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPP1",17,0)
 ;     4 - BIUP    (req) User Population/Group (r,i,u,a).
"RTN","BIREPP1",18,0)
 ;                       (Registered, Imm Reg Active, User 1+, Active 2+).
"RTN","BIREPP1",19,0)
 ;
"RTN","BIREPP1",20,0)
 ;         NOT USED FOR NOW.
"RTN","BIREPP1",21,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPP1",22,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPP1",23,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPP1",24,0)
 ;     7 - BIHIST  (req) Include Historical (1=yes,0=no).
"RTN","BIREPP1",25,0)
 ;     8 - BIVT    (req) Visit Type array.
"RTN","BIREPP1",26,0)
 ;     9 - BIPOP   (ret) BIPOP=1 if error.
"RTN","BIREPP1",27,0)
 ;
"RTN","BIREPP1",28,0)
 ;---> Check for required Variables.
"RTN","BIREPP1",29,0)
 I '$G(BIBEGDT) D ERROR(626) D RESET^BIREPP Q
"RTN","BIREPP1",30,0)
 I '$G(BIENDDT) D ERROR(627) D RESET^BIREPP Q
"RTN","BIREPP1",31,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPP Q
"RTN","BIREPP1",32,0)
 ;I '$D(BIHCF) D ERROR(625) D RESET^BIREPP Q
"RTN","BIREPP1",33,0)
 ;
"RTN","BIREPP1",34,0)
 ;
"RTN","BIREPP1",35,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPP1",36,0)
 S BIAGRPS="0059,0223,2459,0611,1223"
"RTN","BIREPP1",37,0)
 ;
"RTN","BIREPP1",38,0)
 ;---> BITOTPTS=Total Patients, used by HDR code after EN.
"RTN","BIREPP1",39,0)
 N BINOUP,BIRTN,BITOTPTS,BITOTFPT
"RTN","BIREPP1",40,0)
 S BIRTN="BIREPP1"
"RTN","BIREPP1",41,0)
 ;
"RTN","BIREPP1",42,0)
 D SETVARS^BIUTL5
"RTN","BIREPP1",43,0)
 N VALMCNT
"RTN","BIREPP1",44,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPP Q
"RTN","BIREPP1",45,0)
 D EN
"RTN","BIREPP1",46,0)
 Q
"RTN","BIREPP1",47,0)
 ;
"RTN","BIREPP1",48,0)
 ;
"RTN","BIREPP1",49,0)
 ;----------
"RTN","BIREPP1",50,0)
PRINT ;EP
"RTN","BIREPP1",51,0)
 ;---> Main entry point for printing the Quarterly Immunization Report.
"RTN","BIREPP1",52,0)
 D DEVICE(.BIPOP)
"RTN","BIREPP1",53,0)
 Q:$G(BIPOP)
"RTN","BIREPP1",54,0)
 ;
"RTN","BIREPP1",55,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPP1",56,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPP1",57,0)
 ;
"RTN","BIREPP1",58,0)
 ;---> Prepare report.
"RTN","BIREPP1",59,0)
 K VALMHDR,^TMP("BIREPP1",$J),^TMP("BIDUL",$J)
"RTN","BIREPP1",60,0)
 N VALM,VALMHDR
"RTN","BIREPP1",61,0)
 D HDR
"RTN","BIREPP1",62,0)
 D GET^BIREPP2(BIBEGDT,BIENDDT,.BICC,BIUP)
"RTN","BIREPP1",63,0)
 D DISPLAY^BIREPP2
"RTN","BIREPP1",64,0)
 D PRTLST^BIUTL8("BIREPP1")
"RTN","BIREPP1",65,0)
 D EXIT  ;,RESET^BIREPP
"RTN","BIREPP1",66,0)
 Q
"RTN","BIREPP1",67,0)
 ;
"RTN","BIREPP1",68,0)
 ;
"RTN","BIREPP1",69,0)
 ;----------
"RTN","BIREPP1",70,0)
EN ;EP
"RTN","BIREPP1",71,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIREPP1",72,0)
 D EN^VALM("BI REPORT PCV1")
"RTN","BIREPP1",73,0)
 Q
"RTN","BIREPP1",74,0)
 ;
"RTN","BIREPP1",75,0)
 ;
"RTN","BIREPP1",76,0)
 ;----------
"RTN","BIREPP1",77,0)
HDR ;EP
"RTN","BIREPP1",78,0)
 ;---> Header code
"RTN","BIREPP1",79,0)
 D HEAD^BIREPP2(BIBEGDT,BIENDDT,.BICC,BIUP)
"RTN","BIREPP1",80,0)
 Q
"RTN","BIREPP1",81,0)
 ;
"RTN","BIREPP1",82,0)
 ;
"RTN","BIREPP1",83,0)
 ;----------
"RTN","BIREPP1",84,0)
INIT ;EP
"RTN","BIREPP1",85,0)
 ;---> Initialize variables and list array.
"RTN","BIREPP1",86,0)
 ;---> Local Variable:
"RTN","BIREPP1",87,0)
 ;     1 - BINOUP  (opt) If BINOUP=1, then do NOT update.
"RTN","BIREPP1",88,0)
 ;
"RTN","BIREPP1",89,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPP1",90,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPP1",91,0)
 D:'$G(BINOUP) GET^BIREPP2(BIBEGDT,BIENDDT,.BICC,BIUP)
"RTN","BIREPP1",92,0)
 D DISPLAY^BIREPP2
"RTN","BIREPP1",93,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPP1",94,0)
 D ZSAVES^BIUTL3
"RTN","BIREPP1",95,0)
 Q
"RTN","BIREPP1",96,0)
 ;
"RTN","BIREPP1",97,0)
 ;
"RTN","BIREPP1",98,0)
 ;----------
"RTN","BIREPP1",99,0)
RESET ;EP
"RTN","BIREPP1",100,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPP1",101,0)
 ;---> Local Variable:
"RTN","BIREPP1",102,0)
 ;     1 - BINOUP  (opt) If BINOUP=1, then do NOT update.
"RTN","BIREPP1",103,0)
 ;
"RTN","BIREPP1",104,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPP1",105,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPP1",106,0)
 D INIT,HDR Q
"RTN","BIREPP1",107,0)
 ;
"RTN","BIREPP1",108,0)
 ;
"RTN","BIREPP1",109,0)
 ;----------
"RTN","BIREPP1",110,0)
HELP ;EP
"RTN","BIREPP1",111,0)
 ;---> Help code.
"RTN","BIREPP1",112,0)
 N BIX S BIX=X
"RTN","BIREPP1",113,0)
 D FULL^VALM1
"RTN","BIREPP1",114,0)
 W !!?5,"Use arrow keys to scroll up and down through the report, or"
"RTN","BIREPP1",115,0)
 W !?5,"type ""??"" for more actions, such as Search and Print List."
"RTN","BIREPP1",116,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPP1",117,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPP1",118,0)
 Q
"RTN","BIREPP1",119,0)
 ;
"RTN","BIREPP1",120,0)
 ;
"RTN","BIREPP1",121,0)
 ;----------
"RTN","BIREPP1",122,0)
EXIT ;EP
"RTN","BIREPP1",123,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPP1",124,0)
 K ^TMP("BIREPP1",$J),^TMP("BIDFN",$J),^TMP("BIDUL",$J)
"RTN","BIREPP1",125,0)
 D CLEAR^VALM1
"RTN","BIREPP1",126,0)
 D FULL^VALM1
"RTN","BIREPP1",127,0)
 Q
"RTN","BIREPP1",128,0)
 ;
"RTN","BIREPP1",129,0)
 ;
"RTN","BIREPP1",130,0)
 ;----------
"RTN","BIREPP1",131,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPP1",132,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPP1",133,0)
 ;---> Parameters:
"RTN","BIREPP1",134,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPP1",135,0)
 ;
"RTN","BIREPP1",136,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPP1",137,0)
 S ZTRTN="DEQUEUE^BIREPP1"
"RTN","BIREPP1",138,0)
 D ZSAVES^BIUTL3
"RTN","BIREPP1",139,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPP1",140,0)
 Q
"RTN","BIREPP1",141,0)
 ;
"RTN","BIREPP1",142,0)
 ;
"RTN","BIREPP1",143,0)
 ;----------
"RTN","BIREPP1",144,0)
DEQUEUE ;EP
"RTN","BIREPP1",145,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIREPP1",146,0)
 K VALMHDR,^TMP("BIREPP1",$J),^TMP("BIDUL",$J)
"RTN","BIREPP1",147,0)
 D HDR
"RTN","BIREPP1",148,0)
 D GET^BIREPP2(BIBEGDT,BIENDDT,.BICC,BIUP)
"RTN","BIREPP1",149,0)
 D DISPLAY^BIREPP2
"RTN","BIREPP1",150,0)
 D PRTLST^BIUTL8("BIREPP1"),EXIT
"RTN","BIREPP1",151,0)
 Q
"RTN","BIREPP1",152,0)
 ;
"RTN","BIREPP1",153,0)
 ;
"RTN","BIREPP1",154,0)
 ;----------
"RTN","BIREPP1",155,0)
ERROR(BIERR) ;EP
"RTN","BIREPP1",156,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPP1",157,0)
 ;---> Parameters:
"RTN","BIREPP1",158,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPP1",159,0)
 ;
"RTN","BIREPP1",160,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPP1",161,0)
 Q
"RTN","BIREPP2")
0^114^B39815467
"RTN","BIREPP2",1,0)
BIREPP2 ;IHS/CMI/MWR - REPORT, PCV; MAY 10, 2010
"RTN","BIREPP2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPP2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPP2",4,0)
 ;;  VIEW OR PRINT PCV REPORT.
"RTN","BIREPP2",5,0)
 ;
"RTN","BIREPP2",6,0)
 ;----------
"RTN","BIREPP2",7,0)
HEAD(BIBEGDT,BIENDDT,BICC,BIUP) ;EP
"RTN","BIREPP2",8,0)
 ;---> Produce Header array for PCV Report.
"RTN","BIREPP2",9,0)
 ;---> Parameters:
"RTN","BIREPP2",10,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPP2",11,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPP2",12,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPP2",13,0)
 ;     4 - BIUP    (req) User Population/Group (r,i,u,a).
"RTN","BIREPP2",14,0)
 ;
"RTN","BIREPP2",15,0)
 ;---> Check for required Variables.
"RTN","BIREPP2",16,0)
 Q:'$G(BIBEGDT)
"RTN","BIREPP2",17,0)
 Q:'$G(BIENDDT)
"RTN","BIREPP2",18,0)
 Q:'$D(BICC)
"RTN","BIREPP2",19,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPP2",20,0)
 ;
"RTN","BIREPP2",21,0)
 K VALMHDR
"RTN","BIREPP2",22,0)
 N BILINE,X S BILINE=0
"RTN","BIREPP2",23,0)
 ;
"RTN","BIREPP2",24,0)
 N X S X=""
"RTN","BIREPP2",25,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPP2",26,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPP2",27,0)
 ;
"RTN","BIREPP2",28,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPP2",29,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPP2",30,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPP2",31,0)
 ;
"RTN","BIREPP2",32,0)
 S X="*  PCV Report  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPP2",33,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPP2",34,0)
 ;
"RTN","BIREPP2",35,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPP2",36,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPP2",37,0)
 ;
"RTN","BIREPP2",38,0)
 S X=$$SP^BIUTL5(28)_"Date Range: "_$$SLDT1^BIUTL5(BIBEGDT)_" - "_$$SLDT1^BIUTL5(BIENDDT)
"RTN","BIREPP2",39,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPP2",40,0)
 ;
"RTN","BIREPP2",41,0)
 S X=" "_$$BIUPTX^BIUTL6(BIUP)
"RTN","BIREPP2",42,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPP2",43,0)
 S X=$$SP^BIUTL5(79,"-")
"RTN","BIREPP2",44,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPP2",45,0)
 ;
"RTN","BIREPP2",46,0)
 D
"RTN","BIREPP2",47,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPP2",48,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPP2",49,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPP2",50,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPP2",51,0)
 .;
"RTN","BIREPP2",52,0)
 .S X=" # of Children  |     0-59m      2-23m     24-59m      6-11m     12-23m"
"RTN","BIREPP2",53,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPP2",54,0)
 ;
"RTN","BIREPP2",55,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPP2",56,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPP2",57,0)
 D:$D(VALM("BM"))
"RTN","BIREPP2",58,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPP2",59,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPP2",60,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPP2",61,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPP2",62,0)
 Q
"RTN","BIREPP2",63,0)
 ;
"RTN","BIREPP2",64,0)
 ;
"RTN","BIREPP2",65,0)
 ;----------
"RTN","BIREPP2",66,0)
GET(BIBEGDT,BIENDDT,BICC,BIUP) ;EP
"RTN","BIREPP2",67,0)
 ;---> Produce temp global for PCV Report.
"RTN","BIREPP2",68,0)
 ;---> Parameters:
"RTN","BIREPP2",69,0)
 ;     1 - BIBEGDT (req) Begin date of report.
"RTN","BIREPP2",70,0)
 ;     2 - BIENDDT (req) End date of report.
"RTN","BIREPP2",71,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPP2",72,0)
 ;     4 - BIUP    (req) User Population/Group (r,i,u,a).
"RTN","BIREPP2",73,0)
 ;
"RTN","BIREPP2",74,0)
 K ^TMP("BIREPP1",$J),^TMP("BIDFN",$J)
"RTN","BIREPP2",75,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPP2",76,0)
 ;
"RTN","BIREPP2",77,0)
 ;---> Check for required Variables.
"RTN","BIREPP2",78,0)
 I '$G(BIBEGDT) D ERRCD^BIUTL2(626,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPP2",79,0)
 I '$G(BIENDDT) D ERRCD^BIUTL2(627,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPP2",80,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE(.BILINE,X) Q
"RTN","BIREPP2",81,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPP2",82,0)
 ;
"RTN","BIREPP2",83,0)
 ;---> Gather data.
"RTN","BIREPP2",84,0)
 D GETIMMS^BIREPP3(BIBEGDT,BIENDDT,.BICC,BIUP)
"RTN","BIREPP2",85,0)
 D TALLY^BIREPP3
"RTN","BIREPP2",86,0)
 Q
"RTN","BIREPP2",87,0)
 ;
"RTN","BIREPP2",88,0)
 ;
"RTN","BIREPP2",89,0)
 ;----------
"RTN","BIREPP2",90,0)
DISPLAY ;EP
"RTN","BIREPP2",91,0)
 ;---> Create Listman display global for PCV Report.
"RTN","BIREPP2",92,0)
 ;---> Parameters:
"RTN","BIREPP2",93,0)
 ;---> Write Denominator line.
"RTN","BIREPP2",94,0)
 N BILINE S BILINE=0
"RTN","BIREPP2",95,0)
 N X S X="  Denominator   |  "
"RTN","BIREPP2",96,0)
 N N F N=1:1:5 S X=X_$J(+$G(^TMP("BIREPP1",$J,"TOTALPATS",N)),8,0)_"   "
"RTN","BIREPP2",97,0)
 D WRITE(.BILINE,X)
"RTN","BIREPP2",98,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPP2",99,0)
 ;
"RTN","BIREPP2",100,0)
 ;---> Write Doses lines.
"RTN","BIREPP2",101,0)
 N BIAGRP,BIDOSE
"RTN","BIREPP2",102,0)
 F BIDOSE=1,3,4 D
"RTN","BIREPP2",103,0)
 .N X,Y S X=" "_BIDOSE_"+ doses PCV13 |  "
"RTN","BIREPP2",104,0)
 .;---> Next line without percents%.
"RTN","BIREPP2",105,0)
 .;F BIAGRP=1:1:5 S X=X_$J(+$G(^TMP("BIREPP1",$J,"TALLY",BIDOSE,BIAGRP)),8,0)_"   "
"RTN","BIREPP2",106,0)
 .F BIAGRP=1:1:5 S Y=+$G(^TMP("BIREPP1",$J,"TALLY",BIDOSE,BIAGRP)),X=X_$J(Y,8,0)_"   "
"RTN","BIREPP2",107,0)
 .D WRITE(.BILINE,X)
"RTN","BIREPP2",108,0)
 .S X="                |  "
"RTN","BIREPP2",109,0)
 .F BIAGRP=1:1:5 D
"RTN","BIREPP2",110,0)
 ..N Y,Z S Y=+$G(^TMP("BIREPP1",$J,"TALLY",BIDOSE,BIAGRP))
"RTN","BIREPP2",111,0)
 ..S Z=+$G(^TMP("BIREPP1",$J,"TOTALPATS",BIAGRP))
"RTN","BIREPP2",112,0)
 ..S X=X_$J(100*$S(Z:Y/Z,1:0),8,0)_"%  "
"RTN","BIREPP2",113,0)
 .D WRITE(.BILINE,X)
"RTN","BIREPP2",114,0)
 .D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPP2",115,0)
 ;
"RTN","BIREPP2",116,0)
 ;---> Write PCV13 Totals line.
"RTN","BIREPP2",117,0)
 S X=" Total Doses    |  "
"RTN","BIREPP2",118,0)
 D WRITE(.BILINE,X) D MARK^BIW(BILINE,2,"BIREPP1")
"RTN","BIREPP2",119,0)
 S X=" in Date Range  |  "
"RTN","BIREPP2",120,0)
 F N=1:1:5 S X=X_$J(+$G(^TMP("BIREPP1",$J,"TOTALPCV13",N)),8,0)_"   "
"RTN","BIREPP2",121,0)
 D WRITE(.BILINE,X)
"RTN","BIREPP2",122,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPP2",123,0)
 ;
"RTN","BIREPP2",124,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPP2",125,0)
 S VALMCNT=BILINE
"RTN","BIREPP2",126,0)
 Q
"RTN","BIREPP2",127,0)
 ;
"RTN","BIREPP2",128,0)
 ;
"RTN","BIREPP2",129,0)
 ;----------
"RTN","BIREPP2",130,0)
EXPORT ;EP
"RTN","BIREPP2",131,0)
 ;---> Export PCV Report patients to Excel(csv) File, and return to PCV Report.
"RTN","BIREPP2",132,0)
 D EXPORT1
"RTN","BIREPP2",133,0)
 ;---> BINOUP=1 means do not update report.
"RTN","BIREPP2",134,0)
 S BINOUP=1
"RTN","BIREPP2",135,0)
 D RESET^BIREPP1
"RTN","BIREPP2",136,0)
 Q
"RTN","BIREPP2",137,0)
 ;
"RTN","BIREPP2",138,0)
 ;
"RTN","BIREPP2",139,0)
 ;----------
"RTN","BIREPP2",140,0)
EXPORT1 ;EP
"RTN","BIREPP2",141,0)
 ;---> Export PCV Report patients to Excel(csv) File.
"RTN","BIREPP2",142,0)
 ;
"RTN","BIREPP2",143,0)
 I '$O(^TMP("BIREPP1",$J,"BIDFN",0)) D  Q
"RTN","BIREPP2",144,0)
 .W !!?3,"There is no patient data to export." D DIRZ^BIUTL3()
"RTN","BIREPP2",145,0)
 ;
"RTN","BIREPP2",146,0)
 N BIDT,BIDUZ2,BIFLNM,BINOW,BIPATH,BIPOP,BISITE
"RTN","BIREPP2",147,0)
 D NOW^%DTC S BIDT=$E(%,4,7)_"_"_$E(%,9,12)
"RTN","BIREPP2",148,0)
 S BIFLNM="PCV Export "_BIDT_".csv"
"RTN","BIREPP2",149,0)
 D HFS^BIEXPRT8(BIFLNM,.BIPATH,1,.BIPOP)
"RTN","BIREPP2",150,0)
 I $G(BIPOP) D ^%ZISC W !!?3,"Failure to open Host File." D DIRZ^BIUTL3() Q
"RTN","BIREPP2",151,0)
 ;---> Host file is open.
"RTN","BIREPP2",152,0)
 ;
"RTN","BIREPP2",153,0)
 ;---> Use "," for CSV delimiter.
"RTN","BIREPP2",154,0)
 N Q,D S Q="""",D=Q_","_Q
"RTN","BIREPP2",155,0)
 ;---> Write Title Header row.
"RTN","BIREPP2",156,0)
 ;---> Date String, BINOW
"RTN","BIREPP2",157,0)
 D
"RTN","BIREPP2",158,0)
 .N %,X,Y D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S BINOW=Y
"RTN","BIREPP2",159,0)
 ;---> Facility String, BIDUZ2
"RTN","BIREPP2",160,0)
 S BIDUZ2=$$INSTTX^BIUTL6($G(DUZ(2)))
"RTN","BIREPP2",161,0)
 N Y S Y=Q_"PCV Report Patient Export"_D_"at "_BIDUZ2_D_"on "_BINOW
"RTN","BIREPP2",162,0)
 I $G(BIUP)]"" S Y=Y_D_"User Population: "_$$BIUPTX^BIUTL6(BIUP)_Q
"RTN","BIREPP2",163,0)
 W Y,!
"RTN","BIREPP2",164,0)
 ;
"RTN","BIREPP2",165,0)
 ;---> Write Column Headers row.
"RTN","BIREPP2",166,0)
 S Y=Q_"Patient Name"_D_"Date of Birth"_D_"Chart#"_D_"Current Community"
"RTN","BIREPP2",167,0)
 S Y=Y_D_"CVX#1"_D_"Date"_D_"Invalid Code"
"RTN","BIREPP2",168,0)
 S Y=Y_D_"CVX#2"_D_"Date"_D_"Invalid Code"
"RTN","BIREPP2",169,0)
 S Y=Y_D_"CVX#3"_D_"Date"_D_"Invalid Code"
"RTN","BIREPP2",170,0)
 S Y=Y_D_"CVX#4"_D_"Date"_D_"Invalid Code"
"RTN","BIREPP2",171,0)
 S Y=Y_D_"CVX#5"_D_"Date"_D_"Invalid Code"
"RTN","BIREPP2",172,0)
 S Y=Y_D_"CVX#6"_D_"Date"_D_"Invalid Code"_Q
"RTN","BIREPP2",173,0)
 W Y,!
"RTN","BIREPP2",174,0)
 ;
"RTN","BIREPP2",175,0)
 ;---> Write data records.
"RTN","BIREPP2",176,0)
 N BIDFN S BIDFN=0
"RTN","BIREPP2",177,0)
 F  S BIDFN=$O(^TMP("BIREPP1",$J,"BIDFN",BIDFN)) Q:'BIDFN  D
"RTN","BIREPP2",178,0)
 .Q:'$D(^TMP("BIREPP1",$J,"BIDFN",BIDFN,"EXPORT"))
"RTN","BIREPP2",179,0)
 .N BIDATA,BIPNAME,BICC
"RTN","BIREPP2",180,0)
 .S BIDATA=^TMP("BIREPP1",$J,"BIDFN",BIDFN,"EXPORT")
"RTN","BIREPP2",181,0)
 .S BIPNAME=$$NAME^BIUTL1(BIDFN)
"RTN","BIREPP2",182,0)
 .S BIDOB=$$DOBF^BIUTL1(BIDFN,,1,1)
"RTN","BIREPP2",183,0)
 .S BIHRCN=$$HRCN^BIUTL1(BIDFN,$G(DUZ(2)),1)
"RTN","BIREPP2",184,0)
 .S BICC=$$CURCOM^BIUTL11(BIDFN,1)
"RTN","BIREPP2",185,0)
 .S Q="""",D=Q_","_Q
"RTN","BIREPP2",186,0)
 .W Q_BIPNAME_D_BIDOB_D_BIHRCN_D_BICC_D_BIDATA_Q,!
"RTN","BIREPP2",187,0)
 ;
"RTN","BIREPP2",188,0)
 ;---> Close the host file and report its location.
"RTN","BIREPP2",189,0)
 D ^%ZISC
"RTN","BIREPP2",190,0)
 D TITLE^BIUTL5("EXPORT PCV PATIENT DATA TO EXCEL FILE")
"RTN","BIREPP2",191,0)
 W !!?5,"The PCV Report patient data has been exported to:"
"RTN","BIREPP2",192,0)
 W !!?10,BIPATH_BIFLNM
"RTN","BIREPP2",193,0)
 D TEXT3^BIEXP
"RTN","BIREPP2",194,0)
 D DIRZ^BIUTL3()
"RTN","BIREPP2",195,0)
 Q
"RTN","BIREPP2",196,0)
 ;
"RTN","BIREPP2",197,0)
 ;
"RTN","BIREPP2",198,0)
 ;----------
"RTN","BIREPP2",199,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPP2",200,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPP2",201,0)
 ;---> Parameters:
"RTN","BIREPP2",202,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPP2",203,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPP2",204,0)
 ;
"RTN","BIREPP2",205,0)
 Q:'$D(BILINE)
"RTN","BIREPP2",206,0)
 D WL^BIW(.BILINE,"BIREPP1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPP2",207,0)
 ;
"RTN","BIREPP2",208,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPP2",209,0)
 S VALMCNT=BILINE
"RTN","BIREPP2",210,0)
 Q
"RTN","BIREPP2",211,0)
 ;
"RTN","BIREPP2",212,0)
 ;
"RTN","BIREPP2",213,0)
 ;----------
"RTN","BIREPP2",214,0)
SUML(Y) ;EP
"RTN","BIREPP2",215,0)
 ;---> Produce Header array for Vaccine Accountability Report.
"RTN","BIREPP2",216,0)
 ;---> Parameters:
"RTN","BIREPP2",217,0)
 ;     1 - Y (opt) Y=text, such as Date (Aug 23) or "Dose" or other text.
"RTN","BIREPP2",218,0)
 I $L($G(Y))=0 S Y="       "
"RTN","BIREPP2",219,0)
 S Y=$E(Y,1,7) S Y=$$PAD^BIUTL5(Y,7)
"RTN","BIREPP2",220,0)
 N X
"RTN","BIREPP2",221,0)
 S X=Y_" |                                                              |"
"RTN","BIREPP2",222,0)
 ;   " Date   |  6-23m   24-59m    5-18y   19-25y   25-49y   50-64y     "
"RTN","BIREPP2",223,0)
 ;S X=Y_" | ------   ------   ------   ------   ------   ------   --"
"RTN","BIREPP2",224,0)
 ;   "65+y    TOTAL"
"RTN","BIREPP2",225,0)
 ;Q X_"---- | ------"
"RTN","BIREPP2",226,0)
 Q X
"RTN","BIREPP3")
0^115^B27571704
"RTN","BIREPP3",1,0)
BIREPP3 ;IHS/CMI/MWR - REPORT, PCV; AUG 10,2010
"RTN","BIREPP3",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPP3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPP3",4,0)
 ;;  VIEW OR PRINT REPORT.
"RTN","BIREPP3",5,0)
 ;
"RTN","BIREPP3",6,0)
 ;
"RTN","BIREPP3",7,0)
 ;----------
"RTN","BIREPP3",8,0)
GETIMMS(BIBEGDT,BIENDDT,BICC,BIUP) ;EP
"RTN","BIREPP3",9,0)
 ;---> Get Immunizations from V Files.
"RTN","BIREPP3",10,0)
 ;---> Parameters:
"RTN","BIREPP3",11,0)
 ;     1 - BIBEGDT (req) Begin Visit Date.
"RTN","BIREPP3",12,0)
 ;     2 - BIENDDT (req) End Visit Date.
"RTN","BIREPP3",13,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPP3",14,0)
 ;     4 - BIUP    (req) User Population/Group (r,i,u,a).
"RTN","BIREPP3",15,0)
 ;
"RTN","BIREPP3",16,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIREPP3",17,0)
 ;
"RTN","BIREPP3",18,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)
"RTN","BIREPP3",19,0)
 ;---> Begin at earliest possible DOB (kids born the day after
"RTN","BIREPP3",20,0)
 ;---> 5 years prior to the End Date).
"RTN","BIREPP3",21,0)
 N N S N=($E(BIENDDT,1,3)-5)_$E(BIENDDT,4,7)
"RTN","BIREPP3",22,0)
 F  S N=$O(^DPT("ADOB",N)) Q:(N>BIENDDT!('N))  D
"RTN","BIREPP3",23,0)
 .S BIDFN=0
"RTN","BIREPP3",24,0)
 .F  S BIDFN=$O(^DPT("ADOB",N,BIDFN)) Q:'BIDFN  D
"RTN","BIREPP3",25,0)
 ..D CHKSET(BIDFN,.BICC,BIUP,BIBEGDT,BIENDDT)
"RTN","BIREPP3",26,0)
 Q
"RTN","BIREPP3",27,0)
 ;
"RTN","BIREPP3",28,0)
 ;
"RTN","BIREPP3",29,0)
 ;----------
"RTN","BIREPP3",30,0)
CHKSET(BIDFN,BICC,BIUP,BIBEGDT,BIENDDT) ;EP
"RTN","BIREPP3",31,0)
 ;---> Check if this patient fits criteria; if so, set DFN
"RTN","BIREPP3",32,0)
 ;---> in ^TMP("BIREPQ1".
"RTN","BIREPP3",33,0)
 ;---> Parameters:
"RTN","BIREPP3",34,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIREPP3",35,0)
 ;     2 - BICC    (req) Current Community array.
"RTN","BIREPP3",36,0)
 ;     3 - BIUP    (req) User Population/Group (r,i,u,a).
"RTN","BIREPP3",37,0)
 ;     4 - BIBEGDT (req) Begin Visit Date.
"RTN","BIREPP3",38,0)
 ;     5 - BIENDDT (req) End Visit Date.
"RTN","BIREPP3",39,0)
 ;
"RTN","BIREPP3",40,0)
 Q:'$G(BIDFN)
"RTN","BIREPP3",41,0)
 Q:'$D(BICC)
"RTN","BIREPP3",42,0)
 Q:'$D(BIUP)
"RTN","BIREPP3",43,0)
 Q:'$G(BIBEGDT)
"RTN","BIREPP3",44,0)
 Q:'$G(BIENDDT)
"RTN","BIREPP3",45,0)
 ;
"RTN","BIREPP3",46,0)
 ;---> Quit if patient not less than 60 months (5 yrs) old on the End Date.
"RTN","BIREPP3",47,0)
 S BIAGE=$$AGE^BIUTL1(BIDFN,2,BIENDDT)
"RTN","BIREPP3",48,0)
 Q:(BIAGE'?1N.N)  Q:(BIAGE>59)
"RTN","BIREPP3",49,0)
 ;
"RTN","BIREPP3",50,0)
 N BIHCF S BIHCF($G(DUZ(2)))=""
"RTN","BIREPP3",51,0)
 ;---> Filter for standard Patient Population parameter.
"RTN","BIREPP3",52,0)
 Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIENDDT,BIUP)
"RTN","BIREPP3",53,0)
 ;
"RTN","BIREPP3",54,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPP3",55,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPP3",56,0)
 ;
"RTN","BIREPP3",57,0)
 ;---> *** Okay, this patient is in the denominator.  *****************
"RTN","BIREPP3",58,0)
 ;
"RTN","BIREPP3",59,0)
 ;---> Get Age Groups string (12345) for this patient.
"RTN","BIREPP3",60,0)
 N BIAGRPS S BIAGRPS=$$AGEGRP(BIAGE)
"RTN","BIREPP3",61,0)
 ;
"RTN","BIREPP3",62,0)
 ;---> Get Lastname,Firstname.
"RTN","BIREPP3",63,0)
 N BIPNAME S BIPNAME=$$NAME^BIUTL1(BIDFN)
"RTN","BIREPP3",64,0)
 ;
"RTN","BIREPP3",65,0)
 ;---> Store in denominator total.
"RTN","BIREPP3",66,0)
 N BIAGRP,I F I=1:1 S BIAGRP=$E(BIAGRPS,I) Q:'BIAGRP  D
"RTN","BIREPP3",67,0)
 .S ^TMP("BIREPP1",$J,"TOTALPATS",BIAGRP)=$G(^TMP("BIREPP1",$J,"TOTALPATS",BIAGRP))+1
"RTN","BIREPP3",68,0)
 ;
"RTN","BIREPP3",69,0)
 ;---> Store patient for export (even if no PCV's).
"RTN","BIREPP3",70,0)
 S ^TMP("BIREPP1",$J,"BIDFN",BIDFN,"EXPORT")=""
"RTN","BIREPP3",71,0)
 ;
"RTN","BIREPP3",72,0)
 ;---> Store patient for viewing Denominator.
"RTN","BIREPP3",73,0)
 S ^TMP("BIDUL",$J,1,BIAGE,BIPNAME,BIDFN)=""
"RTN","BIREPP3",74,0)
 ;
"RTN","BIREPP3",75,0)
 ;---> RPC to gather Immunization History.
"RTN","BIREPP3",76,0)
 N BI31,BIDE,BIRETVAL,BIRETERR,I S BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIREPP3",77,0)
 ;---> 25=CVX, 55=Vaccine Group IEN, 56=Date of Visit (Fileman), 65=Dose Override.
"RTN","BIREPP3",78,0)
 F I=25,55,56,65 S BIDE(I)=""
"RTN","BIREPP3",79,0)
 ;---> Fourth parameter=0: Do not return Skin Tests.
"RTN","BIREPP3",80,0)
 ;---> Fifth parameter=0: Split out combinations as if given individually.
"RTN","BIREPP3",81,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,0,0)
"RTN","BIREPP3",82,0)
 ;
"RTN","BIREPP3",83,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BIREPP3",84,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIREPP3",85,0)
 Q:BIRETERR]""
"RTN","BIREPP3",86,0)
 Q:BIRETVAL["NO RECORDS"
"RTN","BIREPP3",87,0)
 ;
"RTN","BIREPP3",88,0)
 ;---> Set BIHX=to a valid Immunization History.
"RTN","BIREPP3",89,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BIREPP3",90,0)
 ;
"RTN","BIREPP3",91,0)
 ;---> Add this Patient's History to stats.
"RTN","BIREPP3",92,0)
 N I,Y
"RTN","BIREPP3",93,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BIREPP3",94,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BIREPP3",95,0)
 .;
"RTN","BIREPP3",96,0)
 .;---> Quit (don't count) if Visit was AFTER Quarter Ending Date.
"RTN","BIREPP3",97,0)
 .N BIDATE S BIDATE=$P(Y,"|",4)
"RTN","BIREPP3",98,0)
 .Q:(BIDATE>BIENDDT)
"RTN","BIREPP3",99,0)
 .;
"RTN","BIREPP3",100,0)
 .;---> Quit (don't count) if Vaccine Group is not Pneumo (IEN in ^BISERT=11).
"RTN","BIREPP3",101,0)
 .Q:($P(Y,"|",3)'=11)
"RTN","BIREPP3",102,0)
 .;
"RTN","BIREPP3",103,0)
 .;---> Set CVX Code and Invalid Code (Dose Override).
"RTN","BIREPP3",104,0)
 .N BICVX S BICVX=$P(Y,"|",2)
"RTN","BIREPP3",105,0)
 .N BINVLD S BINVLD=$P(Y,"|",5) D
"RTN","BIREPP3",106,0)
 ..I (BINVLD>0)&(BINVLD<9) S BINVLD=$$DOVER^BIUTL8(BINVLD,1) Q
"RTN","BIREPP3",107,0)
 ..S BINVLD=""
"RTN","BIREPP3",108,0)
 .;
"RTN","BIREPP3",109,0)
 .;---> EXPORT, store data lines.
"RTN","BIREPP3",110,0)
 .;---> Use "," for CSV delimiter in Export.
"RTN","BIREPP3",111,0)
 .N Q,D S Q="""",D=Q_","_Q
"RTN","BIREPP3",112,0)
 .N X S X=BICVX_D_$$SLDT1^BIUTL5($P(Y,"|",4))_D_BINVLD_D
"RTN","BIREPP3",113,0)
 .;--->Add or update patient node for export.
"RTN","BIREPP3",114,0)
 .N Y S Y=$G(^TMP("BIREPP1",$J,"BIDFN",BIDFN,"EXPORT"))
"RTN","BIREPP3",115,0)
 .S ^TMP("BIREPP1",$J,"BIDFN",BIDFN,"EXPORT")=Y_X
"RTN","BIREPP3",116,0)
 .;
"RTN","BIREPP3",117,0)
 .;---> REPORT, store patient tallies.
"RTN","BIREPP3",118,0)
 .;---> For each Age Group to which this patient belongs, update doses of PCV13 received.
"RTN","BIREPP3",119,0)
 .Q:BICVX'=133
"RTN","BIREPP3",120,0)
 .;
"RTN","BIREPP3",121,0)
 .S Y=$G(^TMP("BIREPP1",$J,"BIDFN",BIDFN,BIAGRPS,"DOSES"))
"RTN","BIREPP3",122,0)
 .S ^TMP("BIREPP1",$J,"BIDFN",BIDFN,BIAGRPS,"DOSES")=Y+1
"RTN","BIREPP3",123,0)
 .;
"RTN","BIREPP3",124,0)
 .;---> Do not include this dose in the Total PCV13 Doses Administered if it is not in
"RTN","BIREPP3",125,0)
 .;---> the requested DATE RANGE.
"RTN","BIREPP3",126,0)
 .Q:(BIDATE<BIBEGDT)  Q:(BIDATE>(BIENDDT+.9999))
"RTN","BIREPP3",127,0)
 .;
"RTN","BIREPP3",128,0)
 .;---> Update Total PCV13 Doses Administered.
"RTN","BIREPP3",129,0)
 .N BIAGRP,I F I=1:1 S BIAGRP=$E(BIAGRPS,I) Q:'BIAGRP  D
"RTN","BIREPP3",130,0)
 ..S ^TMP("BIREPP1",$J,"TOTALPCV13",BIAGRP)=$G(^TMP("BIREPP1",$J,"TOTALPCV13",BIAGRP))+1
"RTN","BIREPP3",131,0)
 ;
"RTN","BIREPP3",132,0)
 Q
"RTN","BIREPP3",133,0)
 ;
"RTN","BIREPP3",134,0)
 ;
"RTN","BIREPP3",135,0)
TALLY ;EP
"RTN","BIREPP3",136,0)
 ;---> Tally up the numbers of children in each age group who have received
"RTN","BIREPP3",137,0)
 ;---> 1, 3, or 4 doses.
"RTN","BIREPP3",138,0)
 ;
"RTN","BIREPP3",139,0)
 N BIDFN S BIDFN=0
"RTN","BIREPP3",140,0)
 F  S BIDFN=$O(^TMP("BIREPP1",$J,"BIDFN",BIDFN)) Q:'BIDFN  D
"RTN","BIREPP3",141,0)
 .N BIAGRPS S BIAGRPS=0 S BIAGRPS=$O(^TMP("BIREPP1",$J,"BIDFN",BIDFN,BIAGRPS))
"RTN","BIREPP3",142,0)
 .Q:'BIAGRPS
"RTN","BIREPP3",143,0)
 .N BIDOSES S BIDOSES=$G(^TMP("BIREPP1",$J,"BIDFN",BIDFN,BIAGRPS,"DOSES"))
"RTN","BIREPP3",144,0)
 .Q:'BIDOSES
"RTN","BIREPP3",145,0)
 .N BIAGRP,I F I=1:1 S BIAGRP=$E(BIAGRPS,I) Q:'BIAGRP  D
"RTN","BIREPP3",146,0)
 ..N Z S Z=$G(^TMP("BIREPP1",$J,"TALLY",1,BIAGRP))
"RTN","BIREPP3",147,0)
 ..S ^TMP("BIREPP1",$J,"TALLY",1,BIAGRP)=Z+1
"RTN","BIREPP3",148,0)
 ..Q:(BIDOSES=1)
"RTN","BIREPP3",149,0)
 ..N Z S Z=$G(^TMP("BIREPP1",$J,"TALLY",3,BIAGRP))
"RTN","BIREPP3",150,0)
 ..S ^TMP("BIREPP1",$J,"TALLY",3,BIAGRP)=Z+1
"RTN","BIREPP3",151,0)
 ..Q:(BIDOSES=3)
"RTN","BIREPP3",152,0)
 ..N Z S Z=$G(^TMP("BIREPP1",$J,"TALLY",4,BIAGRP))
"RTN","BIREPP3",153,0)
 ..S ^TMP("BIREPP1",$J,"TALLY",4,BIAGRP)=Z+1
"RTN","BIREPP3",154,0)
 ;
"RTN","BIREPP3",155,0)
 Q
"RTN","BIREPP3",156,0)
 ;
"RTN","BIREPP3",157,0)
 ;
"RTN","BIREPP3",158,0)
 ;----------
"RTN","BIREPP3",159,0)
AGEGRP(BIAGE) ;EP
"RTN","BIREPP3",160,0)
 ;---> Return Patient's Age GroupS.
"RTN","BIREPP3",161,0)
 ;---> Parameters:
"RTN","BIREPP3",162,0)
 ;     1 - BIAGE  (req) Patient's age in months.
"RTN","BIREPP3",163,0)
 ;
"RTN","BIREPP3",164,0)
 ;---> NOTE: All patients at this point fall into Age Group 1 (0-59 months).
"RTN","BIREPP3",165,0)
 N X S X=1
"RTN","BIREPP3",166,0)
 I BIAGE>1,BIAGE<24 S X=X_2
"RTN","BIREPP3",167,0)
 I BIAGE>23,BIAGE<60 S X=X_3
"RTN","BIREPP3",168,0)
 I BIAGE>5,BIAGE<12 S X=X_4
"RTN","BIREPP3",169,0)
 I BIAGE>11,BIAGE<24 S X=X_5
"RTN","BIREPP3",170,0)
 Q X
"RTN","BIREPQ")
0^116^B93020585
"RTN","BIREPQ",1,0)
BIREPQ ;IHS/CMI/MWR - REPORT, QUARTERLY IMM; MAY 10, 2010
"RTN","BIREPQ",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPQ",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPQ",4,0)
 ;;  VIEW QUARTERLY IMMUNIZATION REPORT.
"RTN","BIREPQ",5,0)
 ;
"RTN","BIREPQ",6,0)
 ;
"RTN","BIREPQ",7,0)
 ;----------
"RTN","BIREPQ",8,0)
START ;EP
"RTN","BIREPQ",9,0)
 ;---> Listman Screen for printing Immunization Due Letters.
"RTN","BIREPQ",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPQ",11,0)
 ;
"RTN","BIREPQ",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPQ",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPQ",14,0)
 ;
"RTN","BIREPQ",15,0)
 D EN
"RTN","BIREPQ",16,0)
 D EXIT
"RTN","BIREPQ",17,0)
 Q
"RTN","BIREPQ",18,0)
 ;
"RTN","BIREPQ",19,0)
 ;
"RTN","BIREPQ",20,0)
 ;----------
"RTN","BIREPQ",21,0)
EN ;EP
"RTN","BIREPQ",22,0)
 ;---> Main entry point for BI LETTER PRINT DU
"RTN","BIREPQ",23,0)
 D EN^VALM("BI REPORT QUARTERLY IMM")
"RTN","BIREPQ",24,0)
 Q
"RTN","BIREPQ",25,0)
 ;
"RTN","BIREPQ",26,0)
 ;
"RTN","BIREPQ",27,0)
 ;----------
"RTN","BIREPQ",28,0)
INIT ;EP
"RTN","BIREPQ",29,0)
 ;---> Initialize variables and list array.  vvv83
"RTN","BIREPQ",30,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPQ",31,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPQ",32,0)
 N BILINE,X S BILINE=0
"RTN","BIREPQ",33,0)
 D WRITE(.BILINE)
"RTN","BIREPQ",34,0)
 S X=IOUON_"3-27 MONTH IMMUNIZATION REPORT" D CENTERT^BIUTL5(.X,42)
"RTN","BIREPQ",35,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPQ",36,0)
 K X
"RTN","BIREPQ",37,0)
 ;
"RTN","BIREPQ",38,0)
 D WRITE(.BILINE)
"RTN","BIREPQ",39,0)
 ;---> Date.
"RTN","BIREPQ",40,0)
 S:'$G(BIQDT) BIQDT=$G(DT)
"RTN","BIREPQ",41,0)
 D DATE^BIREP(.BILINE,"BIREPQ",1,$G(BIQDT),"Quarter Ending Date",,,,1)
"RTN","BIREPQ",42,0)
 ;
"RTN","BIREPQ",43,0)
 ;---> Current Community.
"RTN","BIREPQ",44,0)
 D DISP^BIREP(.BILINE,"BIREPQ",.BICC,"Community",2,1)
"RTN","BIREPQ",45,0)
 ;
"RTN","BIREPQ",46,0)
 ;---> Health Care Facility.
"RTN","BIREPQ",47,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPQ",48,0)
 D DISP^BIREP(.BILINE,"BIREPQ",.BIHCF,A,3,2,,,,B) K A,B
"RTN","BIREPQ",49,0)
 ;
"RTN","BIREPQ",50,0)
 ;---> Case Manager.
"RTN","BIREPQ",51,0)
 D DISP^BIREP(.BILINE,"BIREPQ",.BICM,"Case Manager",4,3)
"RTN","BIREPQ",52,0)
 ;
"RTN","BIREPQ",53,0)
 ;---> Beneficiary Type.
"RTN","BIREPQ",54,0)
 S:$O(BIBEN(0))="" BIBEN(1)=""
"RTN","BIREPQ",55,0)
 D DISP^BIREP(.BILINE,"BIREPQ",.BIBEN,"Beneficiary Type",5,4)
"RTN","BIREPQ",56,0)
 ;
"RTN","BIREPQ",57,0)
 ;---> User Population.
"RTN","BIREPQ",58,0)
 D:($G(BIUP)="")
"RTN","BIREPQ",59,0)
 .I $$GPRAIEN^BIUTL6 S BIUP="i" Q
"RTN","BIREPQ",60,0)
 .S BIUP="u"
"RTN","BIREPQ",61,0)
 ;
"RTN","BIREPQ",62,0)
 S X="     6 - Patient Population Group...: "
"RTN","BIREPQ",63,0)
 D
"RTN","BIREPQ",64,0)
 .I BIUP="r" S X=X_"Registered Patients (All)" Q
"RTN","BIREPQ",65,0)
 .I BIUP="i" S X=X_"Immunization Register Patients (Active)" Q
"RTN","BIREPQ",66,0)
 .I BIUP="u" S X=X_"User Population (1 visit, 3 yrs)" Q
"RTN","BIREPQ",67,0)
 .I BIUP="a" S X=X_"Active Users (2+ visits, 3 yrs)" Q
"RTN","BIREPQ",68,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPQ",69,0)
 K X
"RTN","BIREPQ",70,0)
 ;
"RTN","BIREPQ",71,0)
 ;---> Include Hep A, Pneumo.
"RTN","BIREPQ",72,0)
 S:'$D(BIHPV) BIHPV=1
"RTN","BIREPQ",73,0)
 S X="     7 - Include Varicella & Pneumo.: "
"RTN","BIREPQ",74,0)
 S X=X_$S($G(BIHPV):"YES",1:"NO")
"RTN","BIREPQ",75,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPQ",76,0)
 K X
"RTN","BIREPQ",77,0)
 ;
"RTN","BIREPQ",78,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPQ",79,0)
 S VALMCNT=BILINE
"RTN","BIREPQ",80,0)
 S BIRTN="BIREPQ"
"RTN","BIREPQ",81,0)
 Q
"RTN","BIREPQ",82,0)
 ;
"RTN","BIREPQ",83,0)
 ;
"RTN","BIREPQ",84,0)
 ;----------
"RTN","BIREPQ",85,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPQ",86,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPQ",87,0)
 ;---> Parameters:
"RTN","BIREPQ",88,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPQ",89,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPQ",90,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPQ",91,0)
 ;
"RTN","BIREPQ",92,0)
 Q:'$D(BILINE)
"RTN","BIREPQ",93,0)
 D WL^BIW(.BILINE,"BIREPQ",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPQ",94,0)
 Q
"RTN","BIREPQ",95,0)
 ;
"RTN","BIREPQ",96,0)
 ;
"RTN","BIREPQ",97,0)
 ;----------
"RTN","BIREPQ",98,0)
RESET ;EP
"RTN","BIREPQ",99,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPQ",100,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPQ",101,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPQ",102,0)
 D INIT Q
"RTN","BIREPQ",103,0)
 ;
"RTN","BIREPQ",104,0)
 ;
"RTN","BIREPQ",105,0)
 ;----------
"RTN","BIREPQ",106,0)
HELP ;EP
"RTN","BIREPQ",107,0)
 ;---> Help code.
"RTN","BIREPQ",108,0)
 N BIX S BIX=X
"RTN","BIREPQ",109,0)
 D FULL^VALM1
"RTN","BIREPQ",110,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPQ",111,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPQ",112,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPQ",113,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPQ",114,0)
 Q
"RTN","BIREPQ",115,0)
 ;
"RTN","BIREPQ",116,0)
 ;
"RTN","BIREPQ",117,0)
 ;----------
"RTN","BIREPQ",118,0)
HELP1 ;EP
"RTN","BIREPQ",119,0)
 ;----> Explanation of this report.  vvv83
"RTN","BIREPQ",120,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPQ",121,0)
 D START^BIHELP("3-27 MONTH IMMUNIZATION REPORT - HELP",.BITEXT)
"RTN","BIREPQ",122,0)
 Q
"RTN","BIREPQ",123,0)
 ;
"RTN","BIREPQ",124,0)
 ;
"RTN","BIREPQ",125,0)
 ;----------
"RTN","BIREPQ",126,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPQ",127,0)
 ;;
"RTN","BIREPQ",128,0)
 ;;3-27 Month Immunization Report
"RTN","BIREPQ",129,0)
 ;;
"RTN","BIREPQ",130,0)
 ;;The IHS and Tribal programs report the current age-appropriate
"RTN","BIREPQ",131,0)
 ;;immunization rate of active children 3-27 months of age.
"RTN","BIREPQ",132,0)
 ;;NOTE: Any child who was Inactivated at any point during the 90 days
"RTN","BIREPQ",133,0)
 ;;prior to the Quarter Ending Date will not be included in the report.
"RTN","BIREPQ",134,0)
 ;;
"RTN","BIREPQ",135,0)
 ;;The criteria listed below are used by IHS to determine the
"RTN","BIREPQ",136,0)
 ;;up-to-date status of children in each age group, and the specific
"RTN","BIREPQ",137,0)
 ;;age group rates are combined into a total rate.  Varicella and Pneumo
"RTN","BIREPQ",138,0)
 ;;can be excluded from the report totals by entering "NO" in Option 6.
"RTN","BIREPQ",139,0)
 ;;However, for Headquarters Reports enter "YES" for Option 6 in order to
"RTN","BIREPQ",140,0)
 ;;include Varicella and Pneumo (PCV) in the totals.
"RTN","BIREPQ",141,0)
 ;;The criteria for the Headquarters Report are listed below:
"RTN","BIREPQ",142,0)
 ;;
"RTN","BIREPQ",143,0)
 ;;       3-4 months old     1-DTaP 1-IPV 1-Hib 1-HepB 1-PCV
"RTN","BIREPQ",144,0)
 ;;       5-6 months old     2-DTaP 2-IPV 2-Hib 2-HepB 2-PCV
"RTN","BIREPQ",145,0)
 ;;      7-15 months old     3-DTaP 2-IPV 2-Hib 2-HepB 3-PCV
"RTN","BIREPQ",146,0)
 ;;     16-18 months old     3-DTaP 2-IPV 3-Hib 2-HepB 3-PCV 1-MMR 1-VAR
"RTN","BIREPQ",147,0)
 ;;     19-23 months old     4-DTaP 3-IPV 3-Hib 3-HepB 4-PCV 1-MMR 1-VAR
"RTN","BIREPQ",148,0)
 ;;     24-27 months old     4-DTaP 3-IPV 3-Hib 3-HepB 4-PCV 1-MMR 1-VAR
"RTN","BIREPQ",149,0)
 ;;
"RTN","BIREPQ",150,0)
 ;;In Version 8.5 we have revised the 3-27 month report to have
"RTN","BIREPQ",151,0)
 ;;manufacturer-specific logic:
"RTN","BIREPQ",152,0)
 ;;
"RTN","BIREPQ",153,0)
 ;;   PedvaxHib (PRP-OMP) requires 3 doses
"RTN","BIREPQ",154,0)
 ;;   ActHib (PRP-T0 requires 4 doses
"RTN","BIREPQ",155,0)
 ;;   RotaTeq (Rota-5) requires 3 doses
"RTN","BIREPQ",156,0)
 ;;   RotaRix (Rota-1) requires 2 doses
"RTN","BIREPQ",157,0)
 ;;
"RTN","BIREPQ",158,0)
 ;;Version 8.5 also adjusts for catch-up schedules to require fewer doses
"RTN","BIREPQ",159,0)
 ;;of Hib and PCV13 in children who start late:
"RTN","BIREPQ",160,0)
 ;;
"RTN","BIREPQ",161,0)
 ;;   Hib:   16-27 months - requires 3 doses, or 2 doses >=12 months,
"RTN","BIREPQ",162,0)
 ;;          or 1 dose >=15 months
"RTN","BIREPQ",163,0)
 ;;
"RTN","BIREPQ",164,0)
 ;;   PCV13: 16-27 months - requires 4 doses, or 3 doses >=7 months,
"RTN","BIREPQ",165,0)
 ;;          or 2 doses >=12 months, or 1 dose >=24 months
"RTN","BIREPQ",166,0)
 ;;
"RTN","BIREPQ",167,0)
 ;;
"RTN","BIREPQ",168,0)
 ;;The 3-27 MONTH IMMUNIZATION REPORT screen allows you to adjust
"RTN","BIREPQ",169,0)
 ;;the report to your needs.
"RTN","BIREPQ",170,0)
 ;;
"RTN","BIREPQ",171,0)
 ;;There are 7 items or "parameters" on the screen that you may
"RTN","BIREPQ",172,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPQ",173,0)
 ;;To change an item, enter its left column number (1-7) at the
"RTN","BIREPQ",174,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPQ",175,0)
 ;;you would like more information on the parameter you are changing.
"RTN","BIREPQ",176,0)
 ;;
"RTN","BIREPQ",177,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPQ",178,0)
 ;;you want, select V to View the Quarterly Report or P to print it.
"RTN","BIREPQ",179,0)
 ;;
"RTN","BIREPQ",180,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPQ",181,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPQ",182,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPQ",183,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPQ",184,0)
 ;;
"RTN","BIREPQ",185,0)
 ;;QUARTER ENDING DATE: The report will compile immunization rates
"RTN","BIREPQ",186,0)
 ;;as of the date entered.  Typically, this date would be the end
"RTN","BIREPQ",187,0)
 ;;of a Quarter.
"RTN","BIREPQ",188,0)
 ;;
"RTN","BIREPQ",189,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPQ",190,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPQ",191,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPQ",192,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPQ",193,0)
 ;;
"RTN","BIREPQ",194,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIREPQ",195,0)
 ;;Facilities, only Patients who have active Chart#'s at one or more
"RTN","BIREPQ",196,0)
 ;;of the selected Facilities will be included in the report.
"RTN","BIREPQ",197,0)
 ;;
"RTN","BIREPQ",198,0)
 ;;CASE MANAGERS: If you select for specific Case Managers, only
"RTN","BIREPQ",199,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPQ",200,0)
 ;;in the report.
"RTN","BIREPQ",201,0)
 ;;
"RTN","BIREPQ",202,0)
 ;;BENEFICIARY TYPES: If you select for specific Beneficiary Types,
"RTN","BIREPQ",203,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPQ",204,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPQ",205,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPQ",206,0)
 ;;
"RTN","BIREPQ",207,0)
 ;;PATIENT POPULATION GROUP: You may select one of four patient groups
"RTN","BIREPQ",208,0)
 ;;to be considered in the report: Registered Patients (All),
"RTN","BIREPQ",209,0)
 ;;Immunization Register Patients (Active), User Population (1+ visits
"RTN","BIREPQ",210,0)
 ;;in 3 yrs), or Active Clinical Users (2+ visits in 3 yrs).
"RTN","BIREPQ",211,0)
 ;;Immunization Register Patients (Active) is the default.
"RTN","BIREPQ",212,0)
 ;;
"RTN","BIREPQ",213,0)
 ;;INCLUDE VARICELLA & PNEUMO: Answer "YES" if you wish to have Varicella
"RTN","BIREPQ",214,0)
 ;;and Pneumo included in the statistics of the "Appropriate for Age" row
"RTN","BIREPQ",215,0)
 ;;at the top of the report.  If you answer "NO", Varicella and Pneumo will
"RTN","BIREPQ",216,0)
 ;;NOT appear in the Minimum needs header row at the top of the report.
"RTN","BIREPQ",217,0)
 ;;In both cases, the statistics for Varicella and Pneumo will be displayed
"RTN","BIREPQ",218,0)
 ;;individually in additional rows at the bottom of the report.
"RTN","BIREPQ",219,0)
 ;;
"RTN","BIREPQ",220,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPQ",221,0)
 Q
"RTN","BIREPQ",222,0)
 ;
"RTN","BIREPQ",223,0)
 ;
"RTN","BIREPQ",224,0)
 ;----------
"RTN","BIREPQ",225,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPQ",226,0)
 Q:$G(BILINL)=""
"RTN","BIREPQ",227,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPQ",228,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPQ",229,0)
 Q
"RTN","BIREPQ",230,0)
 ;
"RTN","BIREPQ",231,0)
 ;
"RTN","BIREPQ",232,0)
 ;----------
"RTN","BIREPQ",233,0)
EXIT ;EP
"RTN","BIREPQ",234,0)
 ;---> End of job cleanup.
"RTN","BIREPQ",235,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPQ",236,0)
 K ^TMP("BIREPQ",$J)
"RTN","BIREPQ",237,0)
 D CLEAR^VALM1
"RTN","BIREPQ",238,0)
 D FULL^VALM1
"RTN","BIREPQ",239,0)
 Q
"RTN","BIREPQ1")
0^117^B23955170
"RTN","BIREPQ1",1,0)
BIREPQ1 ;IHS/CMI/MWR - REPORT, QUARTERLY IMM; MAY 10, 2010
"RTN","BIREPQ1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPQ1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPQ1",4,0)
 ;;  VIEW OR PRINT QUARTERLY IMMUNIZATION REPORT.
"RTN","BIREPQ1",5,0)
 ;
"RTN","BIREPQ1",6,0)
 ;
"RTN","BIREPQ1",7,0)
 ;----------
"RTN","BIREPQ1",8,0)
START(BIX) ;EP
"RTN","BIREPQ1",9,0)
 ;---> VIEW Quarterly Report.
"RTN","BIREPQ1",10,0)
 ;---> Prepare and display Quarterly Immunization Report.
"RTN","BIREPQ1",11,0)
 ;---> Parameters:
"RTN","BIREPQ1",12,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Qtr Report.
"RTN","BIREPQ1",13,0)
 ;                      If BIX="VIEW", then view Qtr Report (default).
"RTN","BIREPQ1",14,0)
 ;---> Variables:
"RTN","BIREPQ1",15,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPQ1",16,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPQ1",17,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPQ1",18,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPQ1",19,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPQ1",20,0)
 ;     6 - BIHPV  (opt) 1=Include Varicella & Pneumo.
"RTN","BIREPQ1",21,0)
 ;     7 - BIPOP  (ret) BIPOP=1 if error.
"RTN","BIREPQ1",22,0)
 ;
"RTN","BIREPQ1",23,0)
 ;---> Check for required Variables.
"RTN","BIREPQ1",24,0)
 I '$G(BIQDT) D ERROR(622) D RESET^BIREPQ Q
"RTN","BIREPQ1",25,0)
 I '$D(BICC) D ERROR(614) D RESET^BIREPQ Q
"RTN","BIREPQ1",26,0)
 I '$D(BIHCF) D ERROR(625) D RESET^BIREPQ Q
"RTN","BIREPQ1",27,0)
 I '$D(BICM)  D ERROR(615) D RESET^BIREPQ Q
"RTN","BIREPQ1",28,0)
 I '$D(BIBEN) D ERROR(662) D RESET^BIREPQ Q
"RTN","BIREPQ1",29,0)
 S:'$D(BIHPV) BIHPV=1
"RTN","BIREPQ1",30,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPQ1",31,0)
 ;
"RTN","BIREPQ1",32,0)
 D SETVARS^BIUTL5 N VALMCNT
"RTN","BIREPQ1",33,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPQ Q
"RTN","BIREPQ1",34,0)
 ;
"RTN","BIREPQ1",35,0)
 ;---> Set BIAG for Age Range in header of report.
"RTN","BIREPQ1",36,0)
 ;---> Set BIRPDT for Report Date ("Quarterly, etc.).
"RTN","BIREPQ1",37,0)
 ;---> Set BIRTN in case user runs Patient List then needs to return
"RTN","BIREPQ1",38,0)
 ;---> to INIT here.
"RTN","BIREPQ1",39,0)
 ;---> Set BITITL for Report Name in Patient List, if called.  vvv83
"RTN","BIREPQ1",40,0)
 N BIAG,BIRPDT,BIRTN,BITITL
"RTN","BIREPQ1",41,0)
 S BIAG="3-27",BIRPDT=BIQDT,BIRTN="BIREPQ1",BITITL="3-27 MONTH"
"RTN","BIREPQ1",42,0)
 D EN
"RTN","BIREPQ1",43,0)
 D RESET^BIREPQ
"RTN","BIREPQ1",44,0)
 Q
"RTN","BIREPQ1",45,0)
 ;
"RTN","BIREPQ1",46,0)
 ;
"RTN","BIREPQ1",47,0)
 ;----------
"RTN","BIREPQ1",48,0)
PRINT ;EP
"RTN","BIREPQ1",49,0)
 ;---> Main entry point for printing the Quarterly Immunization Report.
"RTN","BIREPQ1",50,0)
 D DEVICE(.BIPOP)
"RTN","BIREPQ1",51,0)
 Q:$G(BIPOP)
"RTN","BIREPQ1",52,0)
 ;
"RTN","BIREPQ1",53,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPQ1",54,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPQ1",55,0)
 ;
"RTN","BIREPQ1",56,0)
 ;---> Prepare report.
"RTN","BIREPQ1",57,0)
 K ^TMP("BIREPQ1",$J),^TMP("BIDUL",$J)
"RTN","BIREPQ1",58,0)
 N VALM,VALMHDR
"RTN","BIREPQ1",59,0)
 D HDR,START^BIREPQ2(BIQDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHPV,BIUP)
"RTN","BIREPQ1",60,0)
 ;
"RTN","BIREPQ1",61,0)
 D PRTLST^BIUTL8("BIREPQ1")
"RTN","BIREPQ1",62,0)
 D EXIT,RESET^BIREPQ
"RTN","BIREPQ1",63,0)
 Q
"RTN","BIREPQ1",64,0)
 ;
"RTN","BIREPQ1",65,0)
 ;
"RTN","BIREPQ1",66,0)
 ;----------
"RTN","BIREPQ1",67,0)
EN ;EP
"RTN","BIREPQ1",68,0)
 ;---> Main entry point for List Template BI REPORT QUARTERLY IMM1.
"RTN","BIREPQ1",69,0)
 D EN^VALM("BI REPORT QUARTERLY IMM1")
"RTN","BIREPQ1",70,0)
 Q
"RTN","BIREPQ1",71,0)
 ;
"RTN","BIREPQ1",72,0)
 ;
"RTN","BIREPQ1",73,0)
 ;----------
"RTN","BIREPQ1",74,0)
HDR ;EP
"RTN","BIREPQ1",75,0)
 ;---> Header code
"RTN","BIREPQ1",76,0)
 D HEAD^BIREPQ2(BIQDT,.BICC,.BIHCF,.BICM,.BIBEN,BIUP)
"RTN","BIREPQ1",77,0)
 Q
"RTN","BIREPQ1",78,0)
 ;
"RTN","BIREPQ1",79,0)
 ;
"RTN","BIREPQ1",80,0)
 ;----------
"RTN","BIREPQ1",81,0)
INIT ;EP
"RTN","BIREPQ1",82,0)
 ;---> Initialize variables and list array.
"RTN","BIREPQ1",83,0)
 K ^TMP("BIREPQ1",$J),^TMP("BIDUL",$J)
"RTN","BIREPQ1",84,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPQ1",85,0)
 S VALMSG="To view patient rosters, select a group below:"
"RTN","BIREPQ1",86,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPQ1",87,0)
 D START^BIREPQ2(BIQDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHPV,BIUP)
"RTN","BIREPQ1",88,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPQ1",89,0)
 D ZSAVES^BIUTL3
"RTN","BIREPQ1",90,0)
 Q
"RTN","BIREPQ1",91,0)
 ;
"RTN","BIREPQ1",92,0)
 ;
"RTN","BIREPQ1",93,0)
 ;----------
"RTN","BIREPQ1",94,0)
RESET ;EP
"RTN","BIREPQ1",95,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPQ1",96,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPQ1",97,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPQ1",98,0)
 D INIT,HDR
"RTN","BIREPQ1",99,0)
 Q
"RTN","BIREPQ1",100,0)
 ;
"RTN","BIREPQ1",101,0)
 ;
"RTN","BIREPQ1",102,0)
 ;----------
"RTN","BIREPQ1",103,0)
RESET1 ;EP
"RTN","BIREPQ1",104,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPQ1",105,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPQ1",106,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPQ1",107,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPQ1",108,0)
 S VALMSG="To view patient lists, select a group below:"
"RTN","BIREPQ1",109,0)
 D HDR
"RTN","BIREPQ1",110,0)
 Q
"RTN","BIREPQ1",111,0)
 ;
"RTN","BIREPQ1",112,0)
 ;  vvv83
"RTN","BIREPQ1",113,0)
 ;----------
"RTN","BIREPQ1",114,0)
HELP ;EP
"RTN","BIREPQ1",115,0)
 N BIX S BIX=X
"RTN","BIREPQ1",116,0)
 D FULL^VALM1 N BIPOP
"RTN","BIREPQ1",117,0)
 D TITLE^BIUTL5("VIEW 3-27 MONTH REPORT - HELP, page 1 of 1")
"RTN","BIREPQ1",118,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIREPQ1",119,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPQ1",120,0)
 Q
"RTN","BIREPQ1",121,0)
 ;
"RTN","BIREPQ1",122,0)
 ;  vvv83
"RTN","BIREPQ1",123,0)
 ;----------
"RTN","BIREPQ1",124,0)
TEXT1 ;EP
"RTN","BIREPQ1",125,0)
 ;;You have chosen to View the 3-27 Month Report rather than Print it.
"RTN","BIREPQ1",126,0)
 ;;(You may print the report from here as well by entering "PL".)
"RTN","BIREPQ1",127,0)
 ;;
"RTN","BIREPQ1",128,0)
 ;;Also, you may:
"RTN","BIREPQ1",129,0)
 ;;
"RTN","BIREPQ1",130,0)
 ;;Enter "N" to view the list of Patients who were NOT Current
"RTN","BIREPQ1",131,0)
 ;;          or "NOT up-to-date" with their immunizations, according
"RTN","BIREPQ1",132,0)
 ;;          to recommendeded guidelines for their age.
"RTN","BIREPQ1",133,0)
 ;;
"RTN","BIREPQ1",134,0)
 ;;Enter "C" to view the list of Patients who were CURRENT or
"RTN","BIREPQ1",135,0)
 ;;          "up-to-date" with their immunizations, according to
"RTN","BIREPQ1",136,0)
 ;;          recommendeded guidelines for their age.
"RTN","BIREPQ1",137,0)
 ;;
"RTN","BIREPQ1",138,0)
 ;;Enter "B" to view a list of both groups of patients combined.
"RTN","BIREPQ1",139,0)
 ;;
"RTN","BIREPQ1",140,0)
 ;;
"RTN","BIREPQ1",141,0)
 D PRINTX("TEXT1")
"RTN","BIREPQ1",142,0)
 Q
"RTN","BIREPQ1",143,0)
 ;
"RTN","BIREPQ1",144,0)
 ;
"RTN","BIREPQ1",145,0)
 ;----------
"RTN","BIREPQ1",146,0)
EXIT ;EP
"RTN","BIREPQ1",147,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPQ1",148,0)
 K ^TMP("BIREPQ1",$J),^TMP("BIDUL",$J)
"RTN","BIREPQ1",149,0)
 D CLEAR^VALM1
"RTN","BIREPQ1",150,0)
 D FULL^VALM1
"RTN","BIREPQ1",151,0)
 Q
"RTN","BIREPQ1",152,0)
 ;
"RTN","BIREPQ1",153,0)
 ;
"RTN","BIREPQ1",154,0)
 ;----------
"RTN","BIREPQ1",155,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPQ1",156,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPQ1",157,0)
 ;---> Parameters:
"RTN","BIREPQ1",158,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPQ1",159,0)
 ;
"RTN","BIREPQ1",160,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPQ1",161,0)
 S ZTRTN="DEQUEUE^BIREPQ1"
"RTN","BIREPQ1",162,0)
 D ZSAVES^BIUTL3
"RTN","BIREPQ1",163,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPQ1",164,0)
 Q
"RTN","BIREPQ1",165,0)
 ;
"RTN","BIREPQ1",166,0)
 ;
"RTN","BIREPQ1",167,0)
 ;----------
"RTN","BIREPQ1",168,0)
DEQUEUE ;EP
"RTN","BIREPQ1",169,0)
 ;
"RTN","BIREPQ1",170,0)
 ;---> Prepare and print Quarterly Report.
"RTN","BIREPQ1",171,0)
 K VALMHDR,^TMP("BIREPQ1",$J)
"RTN","BIREPQ1",172,0)
 D HDR^BIREPQ1,START^BIREPQ2(BIQDT,.BICC,.BIHCF,.BICM,.BIBEN,BIHPV,BIUP)
"RTN","BIREPQ1",173,0)
 D PRTLST^BIUTL8("BIREPQ1"),EXIT
"RTN","BIREPQ1",174,0)
 Q
"RTN","BIREPQ1",175,0)
 ;
"RTN","BIREPQ1",176,0)
 ;
"RTN","BIREPQ1",177,0)
 ;----------
"RTN","BIREPQ1",178,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPQ1",179,0)
 Q:$G(BILINL)=""
"RTN","BIREPQ1",180,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPQ1",181,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPQ1",182,0)
 Q
"RTN","BIREPQ1",183,0)
 ;
"RTN","BIREPQ1",184,0)
 ;
"RTN","BIREPQ1",185,0)
 ;----------
"RTN","BIREPQ1",186,0)
ERROR(BIERR) ;EP
"RTN","BIREPQ1",187,0)
 ;---> Report error, either to screen or print.
"RTN","BIREPQ1",188,0)
 ;---> Parameters:
"RTN","BIREPQ1",189,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIREPQ1",190,0)
 ;
"RTN","BIREPQ1",191,0)
 D ERRCD^BIUTL2($G(BIERR),,1) S BIPOP=1
"RTN","BIREPQ1",192,0)
 Q
"RTN","BIREPQ2")
0^118^B20362887
"RTN","BIREPQ2",1,0)
BIREPQ2 ;IHS/CMI/MWR - REPORT, QUARTERLY IMM; MAY 10, 2010
"RTN","BIREPQ2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPQ2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPQ2",4,0)
 ;;  VIEW QUARTERLY IMMUNIZATION REPORT, GATHER DATA.
"RTN","BIREPQ2",5,0)
 ;
"RTN","BIREPQ2",6,0)
 ;
"RTN","BIREPQ2",7,0)
 ;----------
"RTN","BIREPQ2",8,0)
HEAD(BIQDT,BICC,BIHCF,BICM,BIBEN,BIUP) ;EP
"RTN","BIREPQ2",9,0)
 ;---> Produce Header array for Quarterly Immunization Report.
"RTN","BIREPQ2",10,0)
 ;---> Parameters:
"RTN","BIREPQ2",11,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPQ2",12,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPQ2",13,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPQ2",14,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPQ2",15,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPQ2",16,0)
 ;     6 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPQ2",17,0)
 ;
"RTN","BIREPQ2",18,0)
 ;---> Check for required Variables.
"RTN","BIREPQ2",19,0)
 Q:'$G(BIQDT)
"RTN","BIREPQ2",20,0)
 Q:'$D(BICC)
"RTN","BIREPQ2",21,0)
 Q:'$D(BIHCF)
"RTN","BIREPQ2",22,0)
 Q:'$D(BICM)
"RTN","BIREPQ2",23,0)
 Q:'$D(BIBEN)
"RTN","BIREPQ2",24,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPQ2",25,0)
 ;
"RTN","BIREPQ2",26,0)
 K VALMHDR
"RTN","BIREPQ2",27,0)
 N BILINE,X S BILINE=0
"RTN","BIREPQ2",28,0)
 ;
"RTN","BIREPQ2",29,0)
 N X S X=""
"RTN","BIREPQ2",30,0)
 ;---> If Header array is NOT being for Listmananger include version.  vvv83
"RTN","BIREPQ2",31,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPQ2",32,0)
 ;
"RTN","BIREPQ2",33,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",34,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPQ2",35,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",36,0)
 ;
"RTN","BIREPQ2",37,0)
 S X="*  3-27 Month Immunization Report  *" D CENTERT^BIUTL5(.X)
"RTN","BIREPQ2",38,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",39,0)
 ;S X="For Children 3-27 Months of Age" D CENTERT^BIUTL5(.X)  vvv83
"RTN","BIREPQ2",40,0)
 ;D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",41,0)
 ;
"RTN","BIREPQ2",42,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPQ2",43,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",44,0)
 ;
"RTN","BIREPQ2",45,0)
 S X=$$SP^BIUTL5(30)_"End Date: "_$$SLDT1^BIUTL5(BIQDT)
"RTN","BIREPQ2",46,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPQ2",47,0)
 ;
"RTN","BIREPQ2",48,0)
 S X=" "_$$BIUPTX^BIUTL6(BIUP) D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",49,0)
 D WH^BIW(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPQ2",50,0)
 ;
"RTN","BIREPQ2",51,0)
 D
"RTN","BIREPQ2",52,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPQ2",53,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPQ2",54,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPQ2",55,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPQ2",56,0)
 .;
"RTN","BIREPQ2",57,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPQ2",58,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPQ2",59,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPQ2",60,0)
 .;
"RTN","BIREPQ2",61,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPQ2",62,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPQ2",63,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPQ2",64,0)
 .;
"RTN","BIREPQ2",65,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPQ2",66,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPQ2",67,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPQ2",68,0)
 .;
"RTN","BIREPQ2",69,0)
 .S X=$$SP^BIUTL5(10)_"|"_$$SP^BIUTL5(21)_"Age in Months"
"RTN","BIREPQ2",70,0)
 .S X=X_$$SP^BIUTL5(24)_"|"
"RTN","BIREPQ2",71,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",72,0)
 .S X=$$SP^BIUTL5(10)_"|"_$$SP^BIUTL5(58,"-")_"| Totals"
"RTN","BIREPQ2",73,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",74,0)
 .S X="          |    3-4       5-6      7-15     16-18     19-23"
"RTN","BIREPQ2",75,0)
 .S X=X_"     24-27 |"
"RTN","BIREPQ2",76,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPQ2",77,0)
 ;
"RTN","BIREPQ2",78,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPQ2",79,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPQ2",80,0)
 D:$D(VALM("BM"))
"RTN","BIREPQ2",81,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPQ2",82,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPQ2",83,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPQ2",84,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPQ2",85,0)
 Q
"RTN","BIREPQ2",86,0)
 ;
"RTN","BIREPQ2",87,0)
 ;
"RTN","BIREPQ2",88,0)
 ;----------
"RTN","BIREPQ2",89,0)
START(BIQDT,BICC,BIHCF,BICM,BIBEN,BIHPV,BIUP) ;EP
"RTN","BIREPQ2",90,0)
 ;---> Produce array for Quarterly Immunization Report.
"RTN","BIREPQ2",91,0)
 ;---> Parameters:
"RTN","BIREPQ2",92,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPQ2",93,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPQ2",94,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPQ2",95,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPQ2",96,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPQ2",97,0)
 ;     6 - BIHPV  (opt) 1=Include Varicella & Pneumo.
"RTN","BIREPQ2",98,0)
 ;     7 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPQ2",99,0)
 ;
"RTN","BIREPQ2",100,0)
 K ^TMP("BIREPQ1",$J)
"RTN","BIREPQ2",101,0)
 N BILINE,BITMP,X S BILINE=0,BIPOP=0
"RTN","BIREPQ2",102,0)
 ;
"RTN","BIREPQ2",103,0)
 ;---> Check for required Variables.
"RTN","BIREPQ2",104,0)
 ;
"RTN","BIREPQ2",105,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(623,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPQ2",106,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPQ2",107,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPQ2",108,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPQ2",109,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,.X) D WRITERR(BILINE,X) Q
"RTN","BIREPQ2",110,0)
 S:'$D(BIHPV) BIHPV=1
"RTN","BIREPQ2",111,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPQ2",112,0)
 ;
"RTN","BIREPQ2",113,0)
 ;---> Write Age Totals line.
"RTN","BIREPQ2",114,0)
 D AGETOT^BIREPQ3(.BILINE,.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BIHPV,BIUP,.BIPOP)
"RTN","BIREPQ2",115,0)
 Q:BIPOP
"RTN","BIREPQ2",116,0)
 ;
"RTN","BIREPQ2",117,0)
 ;---> Write lines that define minimum needs.
"RTN","BIREPQ2",118,0)
 D MNEED^BIREPQ3(.BILINE,BIHPV)
"RTN","BIREPQ2",119,0)
 ;
"RTN","BIREPQ2",120,0)
 ;---> Write Approp for Age and Vaccine Group lines.
"RTN","BIREPQ2",121,0)
 D APPROP^BIREPQ3(.BILINE)
"RTN","BIREPQ2",122,0)
 ;
"RTN","BIREPQ2",123,0)
 ;---> Write Statistics lines for each Vaccine Group (BIVGRP).
"RTN","BIREPQ2",124,0)
 F BIVGRP=1,2,6,3,4,7,9,11,15 D VGRP^BIREPQ3(.BILINE,BIVGRP)
"RTN","BIREPQ2",125,0)
 ;---> Per Ros Singleton, show HPV individual stats, even if not including
"RTN","BIREPQ2",126,0)
 ;---> them in the totals for Age Appropriate.
"RTN","BIREPQ2",127,0)
 ;F BIVGRP=1,2,6,3,4 D VGRP^BIREPQ3(.BILINE,BIVGRP)
"RTN","BIREPQ2",128,0)
 ;I $G(BIHPV) F BIVGRP=7,9,11 D VGRP^BIREPQ3(.BILINE,BIVGRP)
"RTN","BIREPQ2",129,0)
 ;
"RTN","BIREPQ2",130,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPQ2",131,0)
 N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPQ2",132,0)
 S X="  Total Patients included who had Refusals on record"_$J(N,25)
"RTN","BIREPQ2",133,0)
 D WRITE^BIREPQ3(.BILINE,X),WRITE^BIREPQ3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPQ2",134,0)
 ;
"RTN","BIREPQ2",135,0)
 S VALMCNT=BILINE
"RTN","BIREPQ2",136,0)
 Q
"RTN","BIREPQ2",137,0)
 ;
"RTN","BIREPQ2",138,0)
 ;
"RTN","BIREPQ2",139,0)
 ;----------
"RTN","BIREPQ2",140,0)
WRITERR(BILINE,X) ;EP
"RTN","BIREPQ2",141,0)
 ;---> Write error line to report.
"RTN","BIREPQ2",142,0)
 ;---> Parameters:
"RTN","BIREPQ2",143,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPQ2",144,0)
 ;     2 - BIVAL  (req) Error text.
"RTN","BIREPQ2",145,0)
 ;
"RTN","BIREPQ2",146,0)
 S:'$D(X) X="No error text."
"RTN","BIREPQ2",147,0)
 S:'$D(BILINE) BILINE=1
"RTN","BIREPQ2",148,0)
 D WRITE^BIREPQ3(.BILINE,X) S VALMCNT=BILINE
"RTN","BIREPQ2",149,0)
 Q
"RTN","BIREPQ3")
0^119^B22953670
"RTN","BIREPQ3",1,0)
BIREPQ3 ;IHS/CMI/MWR - REPORT, QUARTERLY IMM; OCT 15, 2010
"RTN","BIREPQ3",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPQ3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPQ3",4,0)
 ;;  VIEW QUARTERLY IMMUNIZATION REPORT.
"RTN","BIREPQ3",5,0)
 ;;  PATCH 2: Fix header at 16-18mths to say 4-PCV.  MNEED+24
"RTN","BIREPQ3",6,0)
 ;
"RTN","BIREPQ3",7,0)
 ;
"RTN","BIREPQ3",8,0)
 ;----------
"RTN","BIREPQ3",9,0)
AGETOT(BILINE,BICC,BIHCF,BICM,BIBEN,BIQDT,BIHPV,BIUP,BIPOP) ;EP
"RTN","BIREPQ3",10,0)
 ;---> Write Age Total line.
"RTN","BIREPQ3",11,0)
 ;---> Parameters:
"RTN","BIREPQ3",12,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPQ3",13,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPQ3",14,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPQ3",15,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPQ3",16,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPQ3",17,0)
 ;     6 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPQ3",18,0)
 ;     7 - BIHPV  (req) 1=include Hep A.
"RTN","BIREPQ3",19,0)
 ;     8 - BIUP   (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPQ3",20,0)
 ;     9 - BIPOP  (ret) BIPOP=1 if error.
"RTN","BIREPQ3",21,0)
 ;
"RTN","BIREPQ3",22,0)
 S BIPOP=0
"RTN","BIREPQ3",23,0)
 ;---> Check for required Variables.
"RTN","BIREPQ3",24,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(623,.X) D WRITERR^BIREPQ2(BILINE,X) S BIPOP=1 Q
"RTN","BIREPQ3",25,0)
 ;
"RTN","BIREPQ3",26,0)
 ;---> Gather and sort patients.
"RTN","BIREPQ3",27,0)
 N N S N=0
"RTN","BIREPQ3",28,0)
 F I="3-4","5-6","7-15","16-18","19-23","24-27" D
"RTN","BIREPQ3",29,0)
 .;---> For each age range, get Begin and End Dates (DOB's).
"RTN","BIREPQ3",30,0)
 .D AGEDATE^BIAGE(I,BIQDT,.BIBEGDT,.BIENDDT)
"RTN","BIREPQ3",31,0)
 .S N=N+1
"RTN","BIREPQ3",32,0)
 .D GETPATS^BIREPQ4(BIBEGDT,BIENDDT,N,.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BIHPV,BIUP)
"RTN","BIREPQ3",33,0)
 ;
"RTN","BIREPQ3",34,0)
 ;---> Count patients.
"RTN","BIREPQ3",35,0)
 N BIAGRP,BITOT S BITOT=0
"RTN","BIREPQ3",36,0)
 F I=1:1:6 D
"RTN","BIREPQ3",37,0)
 .N M,N S M=0,N=0,BIAGRP(I)=0
"RTN","BIREPQ3",38,0)
 .F  S N=$O(^TMP("BIREPQ1",$J,"PATS",I,N)) Q:'N  D
"RTN","BIREPQ3",39,0)
 ..S BIAGRP(I)=BIAGRP(I)+1,BITOT=BITOT+1
"RTN","BIREPQ3",40,0)
 .S BITMP("STATS","TOTAL",I)=BIAGRP(I)
"RTN","BIREPQ3",41,0)
 S BITMP("STATS","TOTAL","ALL")=BITOT
"RTN","BIREPQ3",42,0)
 ;
"RTN","BIREPQ3",43,0)
 ;---> Write Age Totals line.
"RTN","BIREPQ3",44,0)
 N X S X=" # in Age |"
"RTN","BIREPQ3",45,0)
 ;N X S X=" Age Total|"
"RTN","BIREPQ3",46,0)
 F I=1:1:6 S X=X_$J(BIAGRP(I),7)_"   "
"RTN","BIREPQ3",47,0)
 S X=$E(X,1,$L(X)-2)_"|"_$J(BITOT,7)
"RTN","BIREPQ3",48,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",49,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPQ3",50,0)
 Q
"RTN","BIREPQ3",51,0)
 ;
"RTN","BIREPQ3",52,0)
 ;
"RTN","BIREPQ3",53,0)
 ;----------
"RTN","BIREPQ3",54,0)
MNEED(BILINE,BIHPV) ;EP
"RTN","BIREPQ3",55,0)
 ;---> Write Minimum Needs lines.
"RTN","BIREPQ3",56,0)
 ;---> Parameters:
"RTN","BIREPQ3",57,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPQ3",58,0)
 ;     2 - BIHPV  (req) 1=Include Varicella & Pneumo.
"RTN","BIREPQ3",59,0)
 ;
"RTN","BIREPQ3",60,0)
 S:'$D(BILINE) BILINE=0
"RTN","BIREPQ3",61,0)
 S X=" Minimum  |    1-DTaP    2-DTaP   3-DTaP   3-DTaP    4-DTaP"
"RTN","BIREPQ3",62,0)
 S X=X_"    4-DTaP|"
"RTN","BIREPQ3",63,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",64,0)
 S X=" Needs    |    1-POLIO   2-POLIO  2-POLIO  2-POLIO"
"RTN","BIREPQ3",65,0)
 S X=X_"   3-POLIO   3-POLI|"
"RTN","BIREPQ3",66,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",67,0)
 S X="          |    1-HIB     2-HIB    2-HIB    3-HIB     3-HIB"
"RTN","BIREPQ3",68,0)
 S X=X_"     3-HIB |"
"RTN","BIREPQ3",69,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",70,0)
 S X="          |    1-HEPB    2-HEPB   2-HEPB   2-HEPB    3-HEPB"
"RTN","BIREPQ3",71,0)
 S X=X_"    3-HEPB|"
"RTN","BIREPQ3",72,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",73,0)
 D:$G(BIHPV)
"RTN","BIREPQ3",74,0)
 .;
"RTN","BIREPQ3",75,0)
 .;********** PATCH 2, v8.4, OCT 15,2010, IHS/CMI/MWR
"RTN","BIREPQ3",76,0)
 .;---> Fix header at 16-18mths to say 4-PCV.
"RTN","BIREPQ3",77,0)
 .;S X="          |    1-PCV     2-PCV    3-PCV    3-PCV "
"RTN","BIREPQ3",78,0)
 .S X="          |    1-PCV     2-PCV    3-PCV    4-PCV "
"RTN","BIREPQ3",79,0)
 .;**********
"RTN","BIREPQ3",80,0)
 .;
"RTN","BIREPQ3",81,0)
 .S X=X_"    4-PCV     4-PCV |"
"RTN","BIREPQ3",82,0)
 .D WRITE(.BILINE,X)
"RTN","BIREPQ3",83,0)
 ;S X="          |    1-ROTA    2-ROTA   3-ROTA   3-ROTA    3-ROTA"
"RTN","BIREPQ3",84,0)
 ;S X=X_"    3-ROTA|"
"RTN","BIREPQ3",85,0)
 ;D WRITE(.BILINE,X)
"RTN","BIREPQ3",86,0)
 S X="          |                                1-MMR     1-MMR   "
"RTN","BIREPQ3",87,0)
 S X=X_"  1-MMR |"
"RTN","BIREPQ3",88,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",89,0)
 D:$G(BIHPV)
"RTN","BIREPQ3",90,0)
 .S X="          |                                1-VAR     1-VAR   "
"RTN","BIREPQ3",91,0)
 .S X=X_"  1-VAR |"
"RTN","BIREPQ3",92,0)
 .D WRITE(.BILINE,X)
"RTN","BIREPQ3",93,0)
 ;D:$G(BIHPV)   ;Never include Hep A.
"RTN","BIREPQ3",94,0)
 ;.S X="          |                                                  "
"RTN","BIREPQ3",95,0)
 ;.S X=X_"  1-HEPA|"
"RTN","BIREPQ3",96,0)
 ;.D WRITE(.BILINE,X)
"RTN","BIREPQ3",97,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPQ3",98,0)
 Q
"RTN","BIREPQ3",99,0)
 ;
"RTN","BIREPQ3",100,0)
 ;
"RTN","BIREPQ3",101,0)
 ;----------
"RTN","BIREPQ3",102,0)
APPROP(BILINE) ;EP
"RTN","BIREPQ3",103,0)
 ;---> Write Appropriate for Age lines.
"RTN","BIREPQ3",104,0)
 ;---> Parameters:
"RTN","BIREPQ3",105,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPQ3",106,0)
 ;
"RTN","BIREPQ3",107,0)
 ;---> Numbers of appropriate line.
"RTN","BIREPQ3",108,0)
 N BITOT,X S BITOT=0,X=" Approp.  |"
"RTN","BIREPQ3",109,0)
 F BIAGRP=1:1:6 D
"RTN","BIREPQ3",110,0)
 .N Y S Y=$G(BITMP("STATS","APPRO",BIAGRP)) S:Y="" Y=0
"RTN","BIREPQ3",111,0)
 .S X=X_$J(Y,7)_"   ",BITOT=BITOT+Y
"RTN","BIREPQ3",112,0)
 S X=$E(X,1,$L(X)-2)_"|"_$J(BITOT,7)
"RTN","BIREPQ3",113,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",114,0)
 D MARK^BIW(BILINE,3,"BIREPQ1")
"RTN","BIREPQ3",115,0)
 ;
"RTN","BIREPQ3",116,0)
 ;---> Percentage of appropriate line.
"RTN","BIREPQ3",117,0)
 S X=" for Age  |",BITOT=0
"RTN","BIREPQ3",118,0)
 F BIAGRP=1:1:6 D
"RTN","BIREPQ3",119,0)
 .N Y S Y=$G(BITMP("STATS","APPRO",BIAGRP)) S:Y="" Y=0
"RTN","BIREPQ3",120,0)
 .N Z S Z=$G(BITMP("STATS","TOTAL",BIAGRP)) S:'Z Y=0,Z=1
"RTN","BIREPQ3",121,0)
 .N BIPERC S BIPERC="    "_$J((100*Y/Z),3,0)_"%"
"RTN","BIREPQ3",122,0)
 .S X=X_BIPERC_"  ",BITOT=BITOT+Y
"RTN","BIREPQ3",123,0)
 ;
"RTN","BIREPQ3",124,0)
 N Y S Y=BITOT S:Y="" Y=0
"RTN","BIREPQ3",125,0)
 N Z S Z=$G(BITMP("STATS","TOTAL","ALL")) S:'Z Y=0,Z=1
"RTN","BIREPQ3",126,0)
 S X=$E(X,1,$L(X)-2)_"|    "_$J((100*Y/Z),3,0)_"%"
"RTN","BIREPQ3",127,0)
 D WRITE(.BILINE,X)
"RTN","BIREPQ3",128,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPQ3",129,0)
 Q
"RTN","BIREPQ3",130,0)
 ;
"RTN","BIREPQ3",131,0)
 ;
"RTN","BIREPQ3",132,0)
 ;----------
"RTN","BIREPQ3",133,0)
VGRP(BILINE,BIVGRP) ;EP
"RTN","BIREPQ3",134,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPQ3",135,0)
 ;---> Parameters:
"RTN","BIREPQ3",136,0)
 ;     1 - BILINE (req) Line number in ^TMP Listman array.
"RTN","BIREPQ3",137,0)
 ;     2 - BIVGRP (req) IEN of Vaccine Group.
"RTN","BIREPQ3",138,0)
 ;
"RTN","BIREPQ3",139,0)
 ;---> Write a line for each Dose of this Vaccine Group.
"RTN","BIREPQ3",140,0)
 N BIDOSE,BIMAXD S BIMAXD=$$VGROUP^BIUTL2(BIVGRP,6)
"RTN","BIREPQ3",141,0)
 N BIDOSE F BIDOSE=1:1:BIMAXD D
"RTN","BIREPQ3",142,0)
 .;
"RTN","BIREPQ3",143,0)
 .;---> BIX=text of the line to write.
"RTN","BIREPQ3",144,0)
 .;---> Write the Dose#-Vaccine Group in left margin.
"RTN","BIREPQ3",145,0)
 .N BIX S BIX="  "_BIDOSE_"-"_$$VGROUP^BIUTL2(BIVGRP,5)
"RTN","BIREPQ3",146,0)
 .S BIX=$$PAD^BIUTL5(BIX,10)_"|"
"RTN","BIREPQ3",147,0)
 .;
"RTN","BIREPQ3",148,0)
 .;---> Now loop through the 6 age groups, concating subtotals.
"RTN","BIREPQ3",149,0)
 .N BIAGRP,BISUBT S BISUBT=0
"RTN","BIREPQ3",150,0)
 .F BIAGRP=1:1:6 D
"RTN","BIREPQ3",151,0)
 ..N Y S Y=$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPQ3",152,0)
 ..S BIX=BIX_$J(Y,7)_"   ",BISUBT=BISUBT+Y
"RTN","BIREPQ3",153,0)
 .;
"RTN","BIREPQ3",154,0)
 .S BIX=$E(BIX,1,$L(BIX)-2)_"|"_$J(BISUBT,7)
"RTN","BIREPQ3",155,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPQ3",156,0)
 .I BIDOSE=1 D MARK^BIW(BILINE,BIMAXD+1,"BIREPQ1")
"RTN","BIREPQ3",157,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPQ3",158,0)
 Q
"RTN","BIREPQ3",159,0)
 ;
"RTN","BIREPQ3",160,0)
 ;
"RTN","BIREPQ3",161,0)
 ;----------
"RTN","BIREPQ3",162,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPQ3",163,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPQ3",164,0)
 ;---> Parameters:
"RTN","BIREPQ3",165,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPQ3",166,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPQ3",167,0)
 ;
"RTN","BIREPQ3",168,0)
 Q:'$D(BILINE)
"RTN","BIREPQ3",169,0)
 D WL^BIW(.BILINE,"BIREPQ1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPQ3",170,0)
 Q
"RTN","BIREPQ4")
0^120^B70007941
"RTN","BIREPQ4",1,0)
BIREPQ4 ;IHS/CMI/MWR - REPORT, QUARTERLY IMM; MAY 10, 2010
"RTN","BIREPQ4",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPQ4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPQ4",4,0)
 ;;  QUARTERLY IMM REPORT, GATHER/STORE PATIENTS.
"RTN","BIREPQ4",5,0)
 ;
"RTN","BIREPQ4",6,0)
 ;
"RTN","BIREPQ4",7,0)
 ;----------
"RTN","BIREPQ4",8,0)
GETPATS(BIBEGDT,BIENDDT,BIAGRP,BICC,BIHCF,BICM,BIBEN,BIQDT,BIHPV,BIUP) ;EP
"RTN","BIREPQ4",9,0)
 ;---> Get patients from VA PATIENT File, ^DPT(.
"RTN","BIREPQ4",10,0)
 ;---> Parameters:
"RTN","BIREPQ4",11,0)
 ;     1 - BIBEGDT (req) Begin DOB for this group.
"RTN","BIREPQ4",12,0)
 ;     2 - BIENDDT (req) End DOB for this group.
"RTN","BIREPQ4",13,0)
 ;     3 - BIAGRP  (req) Node/number for this Age Group.
"RTN","BIREPQ4",14,0)
 ;     4 - BICC    (req) Current Community array.
"RTN","BIREPQ4",15,0)
 ;     5 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPQ4",16,0)
 ;     6 - BICM    (req) Case Manager array.
"RTN","BIREPQ4",17,0)
 ;     7 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPQ4",18,0)
 ;     8 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPQ4",19,0)
 ;     9 - BIHPV   (req) 1=Include Varicella & Pneumo.
"RTN","BIREPQ4",20,0)
 ;    10 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPQ4",21,0)
 ;
"RTN","BIREPQ4",22,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIREPQ4",23,0)
 ;
"RTN","BIREPQ4",24,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)  Q:'$G(BIAGRP)
"RTN","BIREPQ4",25,0)
 ;---> Start 1 day prior to Begin Date and $O into the desired DOB's.
"RTN","BIREPQ4",26,0)
 N N S N=BIBEGDT-1
"RTN","BIREPQ4",27,0)
 F  S N=$O(^DPT("ADOB",N)) Q:(N>BIENDDT!('N))  D
"RTN","BIREPQ4",28,0)
 .S BIDFN=0
"RTN","BIREPQ4",29,0)
 .F  S BIDFN=$O(^DPT("ADOB",N,BIDFN)) Q:'BIDFN  D
"RTN","BIREPQ4",30,0)
 ..D CHKSET(BIDFN,.BICC,.BIHCF,.BICM,.BIBEN,BIAGRP,BIQDT,BIHPV,BIUP)
"RTN","BIREPQ4",31,0)
 Q
"RTN","BIREPQ4",32,0)
 ;
"RTN","BIREPQ4",33,0)
 ;
"RTN","BIREPQ4",34,0)
 ;----------
"RTN","BIREPQ4",35,0)
CHKSET(BIDFN,BICC,BIHCF,BICM,BIBEN,BIAGRP,BIQDT,BIHPV,BIUP) ;EP
"RTN","BIREPQ4",36,0)
 ;---> Check if this patient fits criteria; if so, set DFN
"RTN","BIREPQ4",37,0)
 ;---> in ^TMP("BIREPQ1".
"RTN","BIREPQ4",38,0)
 ;---> Parameters:
"RTN","BIREPQ4",39,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIREPQ4",40,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPQ4",41,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPQ4",42,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPQ4",43,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPQ4",44,0)
 ;     6 - BIAGRP (req) Node/number for this Age Group.
"RTN","BIREPQ4",45,0)
 ;     7 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPQ4",46,0)
 ;     8 - BIHPV  (req) 1=Include Varicella & Pneumo.
"RTN","BIREPQ4",47,0)
 ;     9 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPQ4",48,0)
 ;
"RTN","BIREPQ4",49,0)
 Q:'$G(BIDFN)
"RTN","BIREPQ4",50,0)
 Q:'$D(BICC)
"RTN","BIREPQ4",51,0)
 Q:'$D(BIHCF)
"RTN","BIREPQ4",52,0)
 Q:'$D(BICM)
"RTN","BIREPQ4",53,0)
 Q:'$D(BIBEN)
"RTN","BIREPQ4",54,0)
 Q:'$G(BIAGRP)
"RTN","BIREPQ4",55,0)
 Q:'$G(BIQDT)
"RTN","BIREPQ4",56,0)
 Q:'$D(BIHPV)
"RTN","BIREPQ4",57,0)
 Q:$G(BIUP)=""
"RTN","BIREPQ4",58,0)
 ;
"RTN","BIREPQ4",59,0)
 ;---> Filter for standard Patient Population parameter.
"RTN","BIREPQ4",60,0)
 Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIQDT,BIUP)
"RTN","BIREPQ4",61,0)
 ;
"RTN","BIREPQ4",62,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPQ4",63,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPQ4",64,0)
 ;
"RTN","BIREPQ4",65,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPQ4",66,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPQ4",67,0)
 ;
"RTN","BIREPQ4",68,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPQ4",69,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPQ4",70,0)
 ;
"RTN","BIREPQ4",71,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPQ4",72,0)
 S ^TMP("BIREPQ1",$J,"PATS",BIAGRP,BIDFN)=""
"RTN","BIREPQ4",73,0)
 ;
"RTN","BIREPQ4",74,0)
 ;---> RPC to gather Immunization History.
"RTN","BIREPQ4",75,0)
 N BI31,BIDE,BIRETVAL,BIRETERR,I S BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIREPQ4",76,0)
 ;---> 30=Vaccine IEN, 55=Vaccine Group IEN, 56=Date of Visit(Fileman),
"RTN","BIREPQ4",77,0)
 ;---> 65=Invalid Dose (1-4).
"RTN","BIREPQ4",78,0)
 F I=30,55,56,65 S BIDE(I)=""
"RTN","BIREPQ4",79,0)
 ;---> Fourth parameter=0: Do not return Skin Tests.
"RTN","BIREPQ4",80,0)
 ;---> Fifth parameter=0: Split out combinations as if given individually.
"RTN","BIREPQ4",81,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,0,0)
"RTN","BIREPQ4",82,0)
 ;
"RTN","BIREPQ4",83,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BIREPQ4",84,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIREPQ4",85,0)
 Q:BIRETERR]""
"RTN","BIREPQ4",86,0)
 ;
"RTN","BIREPQ4",87,0)
 ;---> Add refusals, if any.
"RTN","BIREPQ4",88,0)
 N Z D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) S BITMP("REFUSALS",BIDFN)=""
"RTN","BIREPQ4",89,0)
 ;
"RTN","BIREPQ4",90,0)
 ;---> Set BIHX=to a valid Immunization History.
"RTN","BIREPQ4",91,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BIREPQ4",92,0)
 ;
"RTN","BIREPQ4",93,0)
 ;---> Add this Patient's History to stats.
"RTN","BIREPQ4",94,0)
 N BIHIB,BIPCV,I,Y
"RTN","BIREPQ4",95,0)
 ;
"RTN","BIREPQ4",96,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BIREPQ4",97,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BIREPQ4",98,0)
 .;
"RTN","BIREPQ4",99,0)
 .;---> BIIEN=Vaccine IEN, BIVGRP=Vaccine Group, BIVDAT=Visit Date, BINVLD=Invalid Code.
"RTN","BIREPQ4",100,0)
 .N BIDOSE,BIIEN,BINVLD,BIVDAT,BIVGRP,Q
"RTN","BIREPQ4",101,0)
 .S BIIEN=$P(Y,"|",2),BIVGRP=$P(Y,"|",3),BIVDAT=$P(Y,"|",4),BINVLD=$P(Y,"|",5)
"RTN","BIREPQ4",102,0)
 .;
"RTN","BIREPQ4",103,0)
 .;---> Quit (don't count) if Visit was AFTER Quarter Ending Date.
"RTN","BIREPQ4",104,0)
 .Q:(BIVDAT>BIQDT)  Q:'$G(BIVGRP)
"RTN","BIREPQ4",105,0)
 .;
"RTN","BIREPQ4",106,0)
 .;---> Quit if this dose has been overrided as Invalid (1-4).
"RTN","BIREPQ4",107,0)
 .Q:(1234[+BINVLD)
"RTN","BIREPQ4",108,0)
 .;
"RTN","BIREPQ4",109,0)
 .;---> Set this immunization in the STATS array by: Vaccine Group, Dose#, and Age Group.
"RTN","BIREPQ4",110,0)
 .;---> Set Dose# (increment by 1's to assign highest/latest dose#).
"RTN","BIREPQ4",111,0)
 .N Q S BIDOSE=1,Q=0
"RTN","BIREPQ4",112,0)
 .F  Q:Q  D
"RTN","BIREPQ4",113,0)
 ..I $D(BIHX(BIVGRP,BIDOSE)) S BIDOSE=BIDOSE+1 Q
"RTN","BIREPQ4",114,0)
 ..S BIHX(BIVGRP,BIDOSE)="",Q=1
"RTN","BIREPQ4",115,0)
 .;
"RTN","BIREPQ4",116,0)
 .N Z S Z=$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPQ4",117,0)
 .S BITMP("STATS",BIVGRP,BIDOSE,BIAGRP)=Z+1
"RTN","BIREPQ4",118,0)
 .;
"RTN","BIREPQ4",119,0)
 .;---> If this was a Hib or PCV, store it in local array for UTD eval:
"RTN","BIREPQ4",120,0)
 .;---> BIHIB(age_in_mths,IEN_of_vaccine)
"RTN","BIREPQ4",121,0)
 .I BIVGRP=3 S BIHIB($$AGE^BIUTL1(BIDFN,2,BIVDAT),BIIEN)=""
"RTN","BIREPQ4",122,0)
 .I BIVGRP=11 S BIPCV($$AGE^BIUTL1(BIDFN,2,BIVDAT),BIIEN)=""
"RTN","BIREPQ4",123,0)
 ;
"RTN","BIREPQ4",124,0)
 ;
"RTN","BIREPQ4",125,0)
 ;---> Now check whether the first 2 Hibs were Hibs=127; if so, BIH127=2.
"RTN","BIREPQ4",126,0)
 N BIH127,I,N S BIH127=0,N=""
"RTN","BIREPQ4",127,0)
 F I=1:1:2 S N=$O(BIHIB(N)) Q:'N  D
"RTN","BIREPQ4",128,0)
 .I $O(BIHIB(N,0))=127 S BIH127=BIH127+1
"RTN","BIREPQ4",129,0)
 ;
"RTN","BIREPQ4",130,0)
 ;
"RTN","BIREPQ4",131,0)
 ;---> Now calculate Hib Need (BIHNEED).
"RTN","BIREPQ4",132,0)
 N BIHNEED
"RTN","BIREPQ4",133,0)
 D
"RTN","BIREPQ4",134,0)
 .;---> If patient is 1st age group, need 1 Hib.
"RTN","BIREPQ4",135,0)
 .I BIAGRP=1 S BIHNEED=1 Q
"RTN","BIREPQ4",136,0)
 .;---> If patient is 2nd age group, need 2 Hibs.
"RTN","BIREPQ4",137,0)
 .I BIAGRP=2 S BIHNEED=2 Q
"RTN","BIREPQ4",138,0)
 .;
"RTN","BIREPQ4",139,0)
 .I BIAGRP=3 D  Q
"RTN","BIREPQ4",140,0)
 ..;---> If patient is 3rd age group:
"RTN","BIREPQ4",141,0)
 ..;---> If at least 2 Hibs recvd at 7 mths or greater, then need only 2 Hibs.
"RTN","BIREPQ4",142,0)
 ..I $$NEED(.BIHIB,7,2) S BIHNEED=2 Q
"RTN","BIREPQ4",143,0)
 ..;---> If patient rcvd 2 127's, then need only 2 Hibs.
"RTN","BIREPQ4",144,0)
 ..I BIH127=2 S BIHNEED=2 Q
"RTN","BIREPQ4",145,0)
 ..;---> Otherwise, 3rd group needs 3 Hibs.
"RTN","BIREPQ4",146,0)
 ..S BIHNEED=3
"RTN","BIREPQ4",147,0)
 .;
"RTN","BIREPQ4",148,0)
 .;
"RTN","BIREPQ4",149,0)
 .;---> BIAGRP must =4, 5, or 6.
"RTN","BIREPQ4",150,0)
 .;---> If at least 1 Hib recvd at 15 mths or greater, then need only 1 Hib.
"RTN","BIREPQ4",151,0)
 .I $$NEED(.BIHIB,15,1) S BIHNEED=1 Q
"RTN","BIREPQ4",152,0)
 .;
"RTN","BIREPQ4",153,0)
 .;---> If at least 2 Hibs recvd at 12 mths or greater, then need only 2 Hibs.
"RTN","BIREPQ4",154,0)
 .I $$NEED(.BIHIB,12,2) S BIHNEED=2 Q
"RTN","BIREPQ4",155,0)
 .;
"RTN","BIREPQ4",156,0)
 .;---> If at least 3 Hibs recvd at 7 mths or greater, then need only 3 Hibs.
"RTN","BIREPQ4",157,0)
 .I $$NEED(.BIHIB,7,3) S BIHNEED=3 Q
"RTN","BIREPQ4",158,0)
 .;
"RTN","BIREPQ4",159,0)
 .;---> If patient rcvd at least 2 127's, then need only 3 Hibs.
"RTN","BIREPQ4",160,0)
 .I BIH127=2 S BIHNEED=3 Q
"RTN","BIREPQ4",161,0)
 .;
"RTN","BIREPQ4",162,0)
 .;---> Otherwise, 4th-6th group needs 4 Hibs.
"RTN","BIREPQ4",163,0)
 .S BIHNEED=4
"RTN","BIREPQ4",164,0)
 ;
"RTN","BIREPQ4",165,0)
 ;
"RTN","BIREPQ4",166,0)
 ;---> Now calculate PCV Need (BIPNEED).
"RTN","BIREPQ4",167,0)
 N BIPNEED
"RTN","BIREPQ4",168,0)
 D
"RTN","BIREPQ4",169,0)
 .;---> If patient is 1st age group, need 1 PCV.
"RTN","BIREPQ4",170,0)
 .I BIAGRP=1 S BIPNEED=1 Q
"RTN","BIREPQ4",171,0)
 .;---> If patient is 2nd age group, need 2 PCVs.
"RTN","BIREPQ4",172,0)
 .I BIAGRP=2 S BIPNEED=2 Q
"RTN","BIREPQ4",173,0)
 .;
"RTN","BIREPQ4",174,0)
 .I BIAGRP=3 D  Q
"RTN","BIREPQ4",175,0)
 ..;---> If patient is 3rd age group:
"RTN","BIREPQ4",176,0)
 ..;---> If at least 2 PCVs recvd at 7 mths or greater, then need only 2 PCVs.
"RTN","BIREPQ4",177,0)
 ..I $$NEED(.BIPCV,7,2) S BIPNEED=2 Q
"RTN","BIREPQ4",178,0)
 ..;---> Otherwise, 3rd group needs 3 PCVs.
"RTN","BIREPQ4",179,0)
 ..S BIPNEED=3
"RTN","BIREPQ4",180,0)
 .;
"RTN","BIREPQ4",181,0)
 .;
"RTN","BIREPQ4",182,0)
 .;---> BIAGRP must =4, 5, or 6.
"RTN","BIREPQ4",183,0)
 .;---> If at least 1 PCV recvd at 15 mths or greater, then need only 1 PCV.
"RTN","BIREPQ4",184,0)
 .I $$NEED(.BIPCV,15,1) S BIPNEED=1 Q
"RTN","BIREPQ4",185,0)
 .;
"RTN","BIREPQ4",186,0)
 .;---> If at least 2 PCVs recvd at 12 mths or greater, then need only 2 PCVs.
"RTN","BIREPQ4",187,0)
 .I $$NEED(.BIPCV,12,2) S BIPNEED=2 Q
"RTN","BIREPQ4",188,0)
 .;
"RTN","BIREPQ4",189,0)
 .;---> If at least 3 PCVs recvd at 7 mths or greater, then need only 3 PCVs.
"RTN","BIREPQ4",190,0)
 .I $$NEED(.BIPCV,7,3) S BIPNEED=3 Q
"RTN","BIREPQ4",191,0)
 .;
"RTN","BIREPQ4",192,0)
 .;---> Otherwise, 4th-6th group needs 4 Hibs.
"RTN","BIREPQ4",193,0)
 .S BIPNEED=4
"RTN","BIREPQ4",194,0)
 ;
"RTN","BIREPQ4",195,0)
 ;
"RTN","BIREPQ4",196,0)
 ;---> Next Section:
"RTN","BIREPQ4",197,0)
 ;---> If this patient has the minimum required immunizations for
"RTN","BIREPQ4",198,0)
 ;---> his/her Age Group, then increment by 1 the "Appro for Age"
"RTN","BIREPQ4",199,0)
 ;---> tally for that Age Group.
"RTN","BIREPQ4",200,0)
 ;---> The code examines Imm Hx array BIHX(VacGrp,Dose#) for each patient.
"RTN","BIREPQ4",201,0)
 ;---> Each Quit represents a condition that a child in that age group
"RTN","BIREPQ4",202,0)
 ;---> must meet in order to be "appropriate for age."
"RTN","BIREPQ4",203,0)
 ;
"RTN","BIREPQ4",204,0)
 ;---> Following lines matrix: Vaccine Group, Dose#.
"RTN","BIREPQ4",205,0)
 ;---> Relies on the following Vaccine Group IEN's in ^BISERT:
"RTN","BIREPQ4",206,0)
 ;---> DTP=1, OPV=2, HIB=3, HEPB=4, MMR=6, VAR=7, HEPA=9, FLU=10, PCV=11, ROT=15
"RTN","BIREPQ4",207,0)
 ;
"RTN","BIREPQ4",208,0)
 N X S X=1
"RTN","BIREPQ4",209,0)
 I BIAGRP=1 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPQ4",210,0)
 .Q:'$D(BIHX(1,1))
"RTN","BIREPQ4",211,0)
 .Q:'$D(BIHX(2,1))
"RTN","BIREPQ4",212,0)
 .Q:'$D(BIHX(3,BIHNEED))
"RTN","BIREPQ4",213,0)
 .Q:'$D(BIHX(4,1))
"RTN","BIREPQ4",214,0)
 .;Q:'$D(BIHX(15,1))  ;Rotavirus, "not at this time" says Ros Singleton, 4-24-07
"RTN","BIREPQ4",215,0)
 .Q:(($G(BIHPV))&('$D(BIHX(11,BIPNEED))))
"RTN","BIREPQ4",216,0)
 .D APPRO(BIAGRP) S X=2
"RTN","BIREPQ4",217,0)
 ;
"RTN","BIREPQ4",218,0)
 I BIAGRP=2 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPQ4",219,0)
 .Q:'$D(BIHX(1,2))
"RTN","BIREPQ4",220,0)
 .Q:'$D(BIHX(2,2))
"RTN","BIREPQ4",221,0)
 .Q:'$D(BIHX(3,BIHNEED))
"RTN","BIREPQ4",222,0)
 .Q:'$D(BIHX(4,2))
"RTN","BIREPQ4",223,0)
 .;Q:'$D(BIHX(15,2))
"RTN","BIREPQ4",224,0)
 .Q:(($G(BIHPV))&('$D(BIHX(11,BIPNEED))))
"RTN","BIREPQ4",225,0)
 .D APPRO(BIAGRP) S X=2
"RTN","BIREPQ4",226,0)
 ;
"RTN","BIREPQ4",227,0)
 I BIAGRP=3 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPQ4",228,0)
 .Q:'$D(BIHX(1,3))
"RTN","BIREPQ4",229,0)
 .Q:'$D(BIHX(2,2))
"RTN","BIREPQ4",230,0)
 .Q:'$D(BIHX(3,BIHNEED))
"RTN","BIREPQ4",231,0)
 .Q:'$D(BIHX(4,2))
"RTN","BIREPQ4",232,0)
 .;Q:'$D(BIHX(15,3))
"RTN","BIREPQ4",233,0)
 .Q:(($G(BIHPV))&('$D(BIHX(11,BIPNEED))))
"RTN","BIREPQ4",234,0)
 .D APPRO(BIAGRP) S X=2
"RTN","BIREPQ4",235,0)
 ;
"RTN","BIREPQ4",236,0)
 I BIAGRP=4 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPQ4",237,0)
 .Q:'$D(BIHX(1,3))
"RTN","BIREPQ4",238,0)
 .Q:'$D(BIHX(2,2))
"RTN","BIREPQ4",239,0)
 .Q:'$D(BIHX(3,BIHNEED))
"RTN","BIREPQ4",240,0)
 .Q:'$D(BIHX(4,2))
"RTN","BIREPQ4",241,0)
 .Q:'$D(BIHX(6,1))
"RTN","BIREPQ4",242,0)
 .;Q:'$D(BIHX(15,3))
"RTN","BIREPQ4",243,0)
 .Q:(($G(BIHPV))&('$D(BIHX(11,BIPNEED))))
"RTN","BIREPQ4",244,0)
 .Q:(($G(BIHPV))&('$D(BIHX(7,1))))
"RTN","BIREPQ4",245,0)
 .D APPRO(BIAGRP) S X=2
"RTN","BIREPQ4",246,0)
 ;
"RTN","BIREPQ4",247,0)
 I BIAGRP=5 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPQ4",248,0)
 .Q:'$D(BIHX(1,4))
"RTN","BIREPQ4",249,0)
 .Q:'$D(BIHX(2,3))
"RTN","BIREPQ4",250,0)
 .Q:'$D(BIHX(3,BIHNEED))
"RTN","BIREPQ4",251,0)
 .Q:'$D(BIHX(4,3))
"RTN","BIREPQ4",252,0)
 .Q:'$D(BIHX(6,1))
"RTN","BIREPQ4",253,0)
 .;Q:'$D(BIHX(15,3))
"RTN","BIREPQ4",254,0)
 .Q:(($G(BIHPV))&('$D(BIHX(11,BIPNEED))))
"RTN","BIREPQ4",255,0)
 .Q:(($G(BIHPV))&('$D(BIHX(7,1))))
"RTN","BIREPQ4",256,0)
 .D APPRO(BIAGRP) S X=2
"RTN","BIREPQ4",257,0)
 ;
"RTN","BIREPQ4",258,0)
 I BIAGRP=6 D  D STOR(BIDFN,BIQDT,X) Q
"RTN","BIREPQ4",259,0)
 .Q:'$D(BIHX(1,4))
"RTN","BIREPQ4",260,0)
 .Q:'$D(BIHX(2,3))
"RTN","BIREPQ4",261,0)
 .Q:'$D(BIHX(3,BIHNEED))
"RTN","BIREPQ4",262,0)
 .Q:'$D(BIHX(4,3))
"RTN","BIREPQ4",263,0)
 .Q:'$D(BIHX(6,1))
"RTN","BIREPQ4",264,0)
 .;Q:'$D(BIHX(15,3))
"RTN","BIREPQ4",265,0)
 .Q:(($G(BIHPV))&('$D(BIHX(11,BIPNEED))))
"RTN","BIREPQ4",266,0)
 .Q:(($G(BIHPV))&('$D(BIHX(7,1))))
"RTN","BIREPQ4",267,0)
 .;Q:(($G(BIHPV))&('$D(BIHX(9,1))))  ;Never include Hep A.
"RTN","BIREPQ4",268,0)
 .D APPRO(BIAGRP) S X=2
"RTN","BIREPQ4",269,0)
 Q
"RTN","BIREPQ4",270,0)
 ;
"RTN","BIREPQ4",271,0)
 ;
"RTN","BIREPQ4",272,0)
 ;----------
"RTN","BIREPQ4",273,0)
APPRO(BIAGRP) ;EP
"RTN","BIREPQ4",274,0)
 ;---> Store Patient in Appropriate for Age Group.
"RTN","BIREPQ4",275,0)
 ;---> Parameters:
"RTN","BIREPQ4",276,0)
 ;     1 - BIAGRP (req) Node/number for this Age Group.
"RTN","BIREPQ4",277,0)
 ;
"RTN","BIREPQ4",278,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPQ4",279,0)
 N Z S Z=$G(BITMP("STATS","APPRO",BIAGRP))
"RTN","BIREPQ4",280,0)
 S BITMP("STATS","APPRO",BIAGRP)=Z+1
"RTN","BIREPQ4",281,0)
 Q
"RTN","BIREPQ4",282,0)
 ;
"RTN","BIREPQ4",283,0)
 ;
"RTN","BIREPQ4",284,0)
 ;----------
"RTN","BIREPQ4",285,0)
STOR(BIDFN,BIQDT,BIVAL) ;EP
"RTN","BIREPQ4",286,0)
 ;---> Store in ^TMP for displaying List of Patients.
"RTN","BIREPQ4",287,0)
 ;---> Parameters:
"RTN","BIREPQ4",288,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIREPQ4",289,0)
 ;     2 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPQ4",290,0)
 ;     3 - BIVAL  (opt) Value to set ^TMP(Pat...) node equal to.
"RTN","BIREPQ4",291,0)
 ;
"RTN","BIREPQ4",292,0)
 Q:'$G(BIDFN)  S:'$G(BIQDT) BIQDT=DT
"RTN","BIREPQ4",293,0)
 D UPDATE^BIPATUP(BIDFN,DT,,1)
"RTN","BIREPQ4",294,0)
 D STORE^BIDUR1(BIDFN,BIQDT,1,,$G(BIVAL))
"RTN","BIREPQ4",295,0)
 Q
"RTN","BIREPQ4",296,0)
 ;
"RTN","BIREPQ4",297,0)
 ;
"RTN","BIREPQ4",298,0)
NEED(BIARR,BIAGE,BIREQ) ;EP
"RTN","BIREPQ4",299,0)
 ;---> Return 1 if BIARRay contains required number of doses (BIREQ) after BIAGE.
"RTN","BIREPQ4",300,0)
 ;---> Parameters:
"RTN","BIREPQ4",301,0)
 ;     1 - BIARR  (req) Array contains doses of vaccine in question.
"RTN","BIREPQ4",302,0)
 ;     2 - BIAGE  (req) Age in months after which doses need to have been received.
"RTN","BIREPQ4",303,0)
 ;     3 - BIREQ  (req) Required number of doses received after BIAGE.
"RTN","BIREPQ4",304,0)
 ;
"RTN","BIREPQ4",305,0)
 ;---> If at least 2 Hibs recvd at 12 mths or greater, then need only 2 Hibs.
"RTN","BIREPQ4",306,0)
 N M,N S M=0,N=""
"RTN","BIREPQ4",307,0)
 F  S N=$O(BIARR(N)) Q:N=""  S:(N'<BIAGE) M=M+1
"RTN","BIREPQ4",308,0)
 I M'<BIREQ Q 1
"RTN","BIREPQ4",309,0)
 Q 0
"RTN","BIREPQ5")
0^121^B15940253
"RTN","BIREPQ5",1,0)
BIREPQ5 ;IHS/CMI/MWR - REPORT, QTR IMM LIST REJECTS;MAY 30,2007
"RTN","BIREPQ5",2,0)
 ;;8.2;IMMUNIZATION;;SEP 11,2007;Build 2
"RTN","BIREPQ5",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPQ5",4,0)
 ;;  QUARTERLY IMM REPORT, VIEW PATIENTS: REJECTED, APPROPRIATE, OR ALL.
"RTN","BIREPQ5",5,0)
 ;
"RTN","BIREPQ5",6,0)
 ;---> Called by ProtocolS BI REPORT QTR PATIENTS REJECTED, APPRO, ALL.
"RTN","BIREPQ5",7,0)
 ;---> on the Protocol Menu BI MENU REPORT QTR VIEW to view
"RTN","BIREPQ5",8,0)
 ;
"RTN","BIREPQ5",9,0)
 ;----------
"RTN","BIREPQ5",10,0)
MAIN(BIVAL) ;
"RTN","BIREPQ5",11,0)
 ;---> Display Patients.
"RTN","BIREPQ5",12,0)
 ;---> Parameters:
"RTN","BIREPQ5",13,0)
 ;     1 - BIVAL (opt) Value indicates which patients:
"RTN","BIREPQ5",14,0)
 ;                     0=All, 1=Rejects only, 2=Appropriate only.
"RTN","BIREPQ5",15,0)
 ;
"RTN","BIREPQ5",16,0)
 S:(($G(BIVAL)<1)!($G(BIVAL)>2)) BIVAL=0
"RTN","BIREPQ5",17,0)
 N VALMCNT
"RTN","BIREPQ5",18,0)
 ;---> If <STKOV> errors appear here, increase STACK in SYSGEN,
"RTN","BIREPQ5",19,0)
 ;---> System Configuration Parameters.
"RTN","BIREPQ5",20,0)
 ;
"RTN","BIREPQ5",21,0)
 D START(BIVAL)
"RTN","BIREPQ5",22,0)
 D RESET1^BIREPQ1
"RTN","BIREPQ5",23,0)
 Q
"RTN","BIREPQ5",24,0)
 ;
"RTN","BIREPQ5",25,0)
 ;
"RTN","BIREPQ5",26,0)
 ;----------
"RTN","BIREPQ5",27,0)
START(BIVAL) ;EP
"RTN","BIREPQ5",28,0)
 ;---> Display Patients.
"RTN","BIREPQ5",29,0)
 ;---> Parameters:
"RTN","BIREPQ5",30,0)
 ;     1 - BIVAL (opt) Value indicates which patients.
"RTN","BIREPQ5",31,0)
 ;                     0=All patients, 1=Rejects only, 2=Appropriate only
"RTN","BIREPQ5",32,0)
 ;
"RTN","BIREPQ5",33,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPQ5",34,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPQ5",35,0)
 D SETVARS^BIUTL5
"RTN","BIREPQ5",36,0)
 ;
"RTN","BIREPQ5",37,0)
 N BIPOP
"RTN","BIREPQ5",38,0)
 D  D DIRZ^BIUTL3(.BIPOP)
"RTN","BIREPQ5",39,0)
 .I $G(BIVAL)=1 D  Q
"RTN","BIREPQ5",40,0)
 ..D TITLE^BIUTL5("VIEW PATIENTS NOT APPROPRIATE IN QUARTERLY REPORT"),TEXT1 Q
"RTN","BIREPQ5",41,0)
 .I $G(BIVAL)=2 D  Q
"RTN","BIREPQ5",42,0)
 ..D TITLE^BIUTL5("VIEW PATIENTS APPROPRIATE IN QUARTERLY REPORT"),TEXT2
"RTN","BIREPQ5",43,0)
 .D TITLE^BIUTL5("VIEW ALL PATIENTS REVIEWED IN QUARTERLY REPORT"),TEXT3 Q
"RTN","BIREPQ5",44,0)
 Q:$G(BIPOP)
"RTN","BIREPQ5",45,0)
 W !!?5,"Please hold...",!
"RTN","BIREPQ5",46,0)
 ;
"RTN","BIREPQ5",47,0)
 ;---> Get Total Patients from ^TMP("BIDUL",$J,1,DOB,NAME,BIDFN)
"RTN","BIREPQ5",48,0)
 ;---> From STOR^BIREPQ4, call to STORE^BIDUR1.
"RTN","BIREPQ5",49,0)
 N BIT S BIT=0
"RTN","BIREPQ5",50,0)
 D
"RTN","BIREPQ5",51,0)
 .N M,N,P
"RTN","BIREPQ5",52,0)
 .S N=0 F  S N=$O(^TMP("BIDUL",$J,1,N)) Q:N=""  D
"RTN","BIREPQ5",53,0)
 ..S M=0 F  S M=$O(^TMP("BIDUL",$J,1,N,M)) Q:M=""  D
"RTN","BIREPQ5",54,0)
 ...N BIVAL1
"RTN","BIREPQ5",55,0)
 ...S P=0 F  S P=$O(^TMP("BIDUL",$J,1,N,M,P)) Q:P=""  S BIVAL1=^(P) D
"RTN","BIREPQ5",56,0)
 ....I $G(BIVAL) Q:BIVAL'=BIVAL1
"RTN","BIREPQ5",57,0)
 ....S BIT=BIT+1
"RTN","BIREPQ5",58,0)
 ;
"RTN","BIREPQ5",59,0)
 ;---> For now, comment out any additional info, per Group's request v8.0.
"RTN","BIREPQ5",60,0)
 ;N BINFO S BINFO="1,2,3,5,7,8"
"RTN","BIREPQ5",61,0)
 N BIPG
"RTN","BIREPQ5",62,0)
 S BIPG=$S(BIVAL=1:"Not Appropriate",BIVAL=2:"Appropriate",1:"Both Groups")
"RTN","BIREPQ5",63,0)
 S BIPG="Report - "_BIPG
"RTN","BIREPQ5",64,0)
 N BIAG S BIAG="3-27"
"RTN","BIREPQ5",65,0)
 ;---> Clear View global.
"RTN","BIREPQ5",66,0)
 K ^TMP("BIDULV",$J)
"RTN","BIREPQ5",67,0)
 ;---> For now, no Additional Info.
"RTN","BIREPQ5",68,0)
 ;D START^BIDUVLS1(BIQDT,BINFO,BIPG,BIAG,BIT,BIVAL)
"RTN","BIREPQ5",69,0)
 D START^BIDUVLS1(BIQDT,,BIPG,BIAG,BIT,BIVAL,1)
"RTN","BIREPQ5",70,0)
 Q
"RTN","BIREPQ5",71,0)
 ;
"RTN","BIREPQ5",72,0)
 ;
"RTN","BIREPQ5",73,0)
 ;----------
"RTN","BIREPQ5",74,0)
TEXT1 ;EP
"RTN","BIREPQ5",75,0)
 ;;This action will display a List of the patients who were NOT within
"RTN","BIREPQ5",76,0)
 ;;the recommended guidelines for immunizations and therefore were
"RTN","BIREPQ5",77,0)
 ;;NOT included in the tallies for the "Approp. for Age" row of the
"RTN","BIREPQ5",78,0)
 ;;report.
"RTN","BIREPQ5",79,0)
 ;;
"RTN","BIREPQ5",80,0)
 ;;NOTE! It is possible that some patients rejected by the report
"RTN","BIREPQ5",81,0)
 ;;      (as Not Appropriate for Age) are NOT DUE for any immunizations.
"RTN","BIREPQ5",82,0)
 ;;      Immunizations given after the recommended age cutoff will
"RTN","BIREPQ5",83,0)
 ;;      cause a patient to be rejected from the "Approp for Age" tally.
"RTN","BIREPQ5",84,0)
 ;;      Also, any immunizations given after the Quarter Ending Date
"RTN","BIREPQ5",85,0)
 ;;      of the report are not counted.
"RTN","BIREPQ5",86,0)
 D PRINTX("TEXT1")
"RTN","BIREPQ5",87,0)
 Q
"RTN","BIREPQ5",88,0)
 ;
"RTN","BIREPQ5",89,0)
 ;
"RTN","BIREPQ5",90,0)
 ;----------
"RTN","BIREPQ5",91,0)
TEXT2 ;EP
"RTN","BIREPQ5",92,0)
 ;;This action will display a List of the patients who were WITHIN
"RTN","BIREPQ5",93,0)
 ;;the recommended guidelines for immunizations and therefore were
"RTN","BIREPQ5",94,0)
 ;;INCLUDED in the tallies for the "Approp. for Age" row of the
"RTN","BIREPQ5",95,0)
 ;;report.
"RTN","BIREPQ5",96,0)
 ;;
"RTN","BIREPQ5",97,0)
 ;;
"RTN","BIREPQ5",98,0)
 D PRINTX("TEXT2")
"RTN","BIREPQ5",99,0)
 Q
"RTN","BIREPQ5",100,0)
 ;
"RTN","BIREPQ5",101,0)
 ;
"RTN","BIREPQ5",102,0)
 ;----------
"RTN","BIREPQ5",103,0)
TEXT3 ;EP
"RTN","BIREPQ5",104,0)
 ;;This action will display a list of ALL the patients who were
"RTN","BIREPQ5",105,0)
 ;;considered in this report.
"RTN","BIREPQ5",106,0)
 ;;
"RTN","BIREPQ5",107,0)
 ;;
"RTN","BIREPQ5",108,0)
 D PRINTX("TEXT3")
"RTN","BIREPQ5",109,0)
 Q
"RTN","BIREPQ5",110,0)
 ;
"RTN","BIREPQ5",111,0)
 ;
"RTN","BIREPQ5",112,0)
 ;----------
"RTN","BIREPQ5",113,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPQ5",114,0)
 Q:$G(BILINL)=""
"RTN","BIREPQ5",115,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPQ5",116,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPQ5",117,0)
 Q
"RTN","BIREPT")
0^122^B80988307
"RTN","BIREPT",1,0)
BIREPT ;IHS/CMI/MWR - REPORT, TWO-YR-OLD RATES; MAY 10, 2010
"RTN","BIREPT",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPT",4,0)
 ;;  VIEW TWO-YR-OLD IMMUNIZATION RATES REPORT.
"RTN","BIREPT",5,0)
 ;
"RTN","BIREPT",6,0)
 ;
"RTN","BIREPT",7,0)
 ;----------
"RTN","BIREPT",8,0)
START ;EP
"RTN","BIREPT",9,0)
 ;---> Listman Screen for Listman Two-Yr-Old Immunization Rates.
"RTN","BIREPT",10,0)
 D SETVARS^BIUTL5 N BIRTN
"RTN","BIREPT",11,0)
 ;
"RTN","BIREPT",12,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPT",13,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPT",14,0)
 ;
"RTN","BIREPT",15,0)
 D EN
"RTN","BIREPT",16,0)
 D EXIT
"RTN","BIREPT",17,0)
 Q
"RTN","BIREPT",18,0)
 ;
"RTN","BIREPT",19,0)
 ;
"RTN","BIREPT",20,0)
 ;----------
"RTN","BIREPT",21,0)
EN ;EP
"RTN","BIREPT",22,0)
 ;---> Main entry point for BI REPORT TWO-YR-OLD RATES.
"RTN","BIREPT",23,0)
 D EN^VALM("BI REPORT TWO-YR-OLD RATES")
"RTN","BIREPT",24,0)
 Q
"RTN","BIREPT",25,0)
 ;
"RTN","BIREPT",26,0)
 ;
"RTN","BIREPT",27,0)
 ;----------
"RTN","BIREPT",28,0)
INIT ;EP
"RTN","BIREPT",29,0)
 ;---> Initialize variables and list array.
"RTN","BIREPT",30,0)
 K ^TMP("BIREPT",$J)
"RTN","BIREPT",31,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPT",32,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BIREPT",33,0)
 N BILINE,X S BILINE=0
"RTN","BIREPT",34,0)
 D WRITE(.BILINE)
"RTN","BIREPT",35,0)
 S X=IOUON_"TWO-YR-OLD IMMUNIZATION RATES REPORT"
"RTN","BIREPT",36,0)
 D CENTERT^BIUTL5(.X,42)
"RTN","BIREPT",37,0)
 D WRITE(.BILINE,X_IOINORM)
"RTN","BIREPT",38,0)
 K X
"RTN","BIREPT",39,0)
 ;
"RTN","BIREPT",40,0)
 ;---> Date.
"RTN","BIREPT",41,0)
 D WRITE(.BILINE)
"RTN","BIREPT",42,0)
 S:'$G(BIQDT) BIQDT=$G(DT)
"RTN","BIREPT",43,0)
 D DATE^BIREP(.BILINE,"BIREPT",1,$G(BIQDT),"Quarter Ending Date",,,,1)
"RTN","BIREPT",44,0)
 ;
"RTN","BIREPT",45,0)
 ;---> Two-Yr-Old Age Range.
"RTN","BIREPT",46,0)
 S:'$G(BITAR) BITAR="19-35"
"RTN","BIREPT",47,0)
 S X="     2 - Age Range..................: "
"RTN","BIREPT",48,0)
 S X=X_BITAR_" months"
"RTN","BIREPT",49,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPT",50,0)
 K X
"RTN","BIREPT",51,0)
 ;
"RTN","BIREPT",52,0)
 ;---> Current Community.
"RTN","BIREPT",53,0)
 D DISP^BIREP(.BILINE,"BIREPT",.BICC,"Community",3,1)
"RTN","BIREPT",54,0)
 ;
"RTN","BIREPT",55,0)
 ;---> Health Care Facility.
"RTN","BIREPT",56,0)
 N A,B S A="Health Care Facility",B="Facilities"
"RTN","BIREPT",57,0)
 D DISP^BIREP(.BILINE,"BIREPT",.BIHCF,A,4,2,,,,B) K A,B
"RTN","BIREPT",58,0)
 ;
"RTN","BIREPT",59,0)
 ;---> Case Manager.
"RTN","BIREPT",60,0)
 D DISP^BIREP(.BILINE,"BIREPT",.BICM,"Case Manager",5,3)
"RTN","BIREPT",61,0)
 ;
"RTN","BIREPT",62,0)
 ;---> Beneficiary Type.
"RTN","BIREPT",63,0)
 S:$O(BIBEN(0))="" BIBEN(1)=""
"RTN","BIREPT",64,0)
 D DISP^BIREP(.BILINE,"BIREPT",.BIBEN,"Beneficiary Type",6,4)
"RTN","BIREPT",65,0)
 ;
"RTN","BIREPT",66,0)
 ;---> User Population.
"RTN","BIREPT",67,0)
 D:($G(BIUP)="")
"RTN","BIREPT",68,0)
 .I $$GPRAIEN^BIUTL6 S BIUP="i" Q
"RTN","BIREPT",69,0)
 .S BIUP="u"
"RTN","BIREPT",70,0)
 ;
"RTN","BIREPT",71,0)
 S X="     7 - Patient Population Group...: "
"RTN","BIREPT",72,0)
 D
"RTN","BIREPT",73,0)
 .I BIUP="r" S X=X_"Registered Patients (All)" Q
"RTN","BIREPT",74,0)
 .I BIUP="i" S X=X_"Immunization Register Patients (Active)" Q
"RTN","BIREPT",75,0)
 .I BIUP="u" S X=X_"User Population (1 visit, 3 yrs)" Q
"RTN","BIREPT",76,0)
 .I BIUP="a" S X=X_"Active Users (2+ visits, 3 yrs)" Q
"RTN","BIREPT",77,0)
 D WRITE(.BILINE,X,1)
"RTN","BIREPT",78,0)
 K X
"RTN","BIREPT",79,0)
 ;
"RTN","BIREPT",80,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIREPT",81,0)
 S VALMCNT=BILINE
"RTN","BIREPT",82,0)
 S BIRTN="BIREPT"
"RTN","BIREPT",83,0)
 Q
"RTN","BIREPT",84,0)
 ;
"RTN","BIREPT",85,0)
 ;
"RTN","BIREPT",86,0)
 ;----------
"RTN","BIREPT",87,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPT",88,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPT",89,0)
 ;---> Parameters:
"RTN","BIREPT",90,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPT",91,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPT",92,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIREPT",93,0)
 ;
"RTN","BIREPT",94,0)
 Q:'$D(BILINE)
"RTN","BIREPT",95,0)
 D WL^BIW(.BILINE,"BIREPT",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPT",96,0)
 Q
"RTN","BIREPT",97,0)
 ;
"RTN","BIREPT",98,0)
 ;
"RTN","BIREPT",99,0)
 ;----------
"RTN","BIREPT",100,0)
RESET ;EP
"RTN","BIREPT",101,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPT",102,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPT",103,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPT",104,0)
 D INIT Q
"RTN","BIREPT",105,0)
 ;
"RTN","BIREPT",106,0)
 ;
"RTN","BIREPT",107,0)
 ;----------
"RTN","BIREPT",108,0)
HELP ;EP
"RTN","BIREPT",109,0)
 ;---> Help code.
"RTN","BIREPT",110,0)
 N BIX S BIX=X
"RTN","BIREPT",111,0)
 D FULL^VALM1
"RTN","BIREPT",112,0)
 W !!?5,"Enter ""V"" to view this report on screen, ""P"" to print it,"
"RTN","BIREPT",113,0)
 W !?5,"or ""H"" to view the Help Text for this report and its parameters."
"RTN","BIREPT",114,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIREPT",115,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPT",116,0)
 Q
"RTN","BIREPT",117,0)
 ;
"RTN","BIREPT",118,0)
 ;
"RTN","BIREPT",119,0)
 ;----------
"RTN","BIREPT",120,0)
HELP1 ;EP
"RTN","BIREPT",121,0)
 ;----> Explanation of this report.
"RTN","BIREPT",122,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIREPT",123,0)
 D START^BIHELP("TWO-YR-OLD IMM RATES - HELP",.BITEXT)
"RTN","BIREPT",124,0)
 Q
"RTN","BIREPT",125,0)
 ;
"RTN","BIREPT",126,0)
 ;
"RTN","BIREPT",127,0)
 ;----------
"RTN","BIREPT",128,0)
TEXT1(BITEXT) ;EP
"RTN","BIREPT",129,0)
 ;;
"RTN","BIREPT",130,0)
 ;;Two-Yr-Old Report
"RTN","BIREPT",131,0)
 ;;
"RTN","BIREPT",132,0)
 ;;The Two-Yr-Old report follows the logic of the National
"RTN","BIREPT",133,0)
 ;;Immunization Survey to provide immunization coverage rates for
"RTN","BIREPT",134,0)
 ;;single vaccines and groups of vaccines in children 19 to 35 months
"RTN","BIREPT",135,0)
 ;;of age by certain key ages (i.e., DTaP by 3 months, by 5 months,
"RTN","BIREPT",136,0)
 ;;by 7 months, by 16 months, by 19 months, by 24 months and by the
"RTN","BIREPT",137,0)
 ;;date of the report).  A nationally reported parameter is the
"RTN","BIREPT",138,0)
 ;;percent of children 19-35 months of age who had ever received
"RTN","BIREPT",139,0)
 ;;4-DTP, 3-Polio, 1-MMR, 3-Hib, 3-HepB (43133).
"RTN","BIREPT",140,0)
 ;;
"RTN","BIREPT",141,0)
 ;;This report displays Active children who are between 19 and 35
"RTN","BIREPT",142,0)
 ;;months of age on the selected date of the report.  The key ages
"RTN","BIREPT",143,0)
 ;;by which vaccines were received are listed across the top of the
"RTN","BIREPT",144,0)
 ;;report.  Total patients who received each dose of the vaccines
"RTN","BIREPT",145,0)
 ;;are listed in rows beside each dose and are cumulative from left
"RTN","BIREPT",146,0)
 ;;to right (e.g., the total patients receiving 1-DTaP by 16 months
"RTN","BIREPT",147,0)
 ;;includes those who received it by 3, 5 and 7 months).
"RTN","BIREPT",148,0)
 ;;
"RTN","BIREPT",149,0)
 ;;The date header on far right column signifies "received by the
"RTN","BIREPT",150,0)
 ;;report date" and includes all doses a child received up to the
"RTN","BIREPT",151,0)
 ;;"Quarter Ending Date" chosen.  This is the column that compares with
"RTN","BIREPT",152,0)
 ;;the National Immunization Survey and Year 2010 Health Objectives.
"RTN","BIREPT",153,0)
 ;;All percentages represent a fraction of the total patients as
"RTN","BIREPT",154,0)
 ;;noted at the top and bottom of the report.
"RTN","BIREPT",155,0)
 ;;
"RTN","BIREPT",156,0)
 ;;
"RTN","BIREPT",157,0)
 ;;The TWO-YR-OLD IMMUNIZATIONS RATES screen allows you to adjust
"RTN","BIREPT",158,0)
 ;;the report to your needs.
"RTN","BIREPT",159,0)
 ;;
"RTN","BIREPT",160,0)
 ;;There are 7 items or "parameters" on the screen that you may
"RTN","BIREPT",161,0)
 ;;change in order to select for a specific group of patients.
"RTN","BIREPT",162,0)
 ;;To change an item, enter its left column number (1-7) at the
"RTN","BIREPT",163,0)
 ;;prompt on the bottom of the screen.  Use "?" at any prompt where
"RTN","BIREPT",164,0)
 ;;you would like help or more information on the parameter you are
"RTN","BIREPT",165,0)
 ;;changing.
"RTN","BIREPT",166,0)
 ;;
"RTN","BIREPT",167,0)
 ;;Once you have the parameters set to retrieve the group of patients
"RTN","BIREPT",168,0)
 ;;you want, select V to View the Two-Year-Old Report or P to print it.
"RTN","BIREPT",169,0)
 ;;
"RTN","BIREPT",170,0)
 ;;If it customarily takes a long time for your computer to prepare
"RTN","BIREPT",171,0)
 ;;this report, it may be preferable to Print and Queue the report
"RTN","BIREPT",172,0)
 ;;to a printer, rather than Viewing it on screen.  (This would avoid
"RTN","BIREPT",173,0)
 ;;tying up your screen while the report is being prepared.)
"RTN","BIREPT",174,0)
 ;;
"RTN","BIREPT",175,0)
 ;;QUARTER ENDING DATE: The report will compile immunization rates
"RTN","BIREPT",176,0)
 ;;as of the date entered.  Typically, this date would be the end
"RTN","BIREPT",177,0)
 ;;of a Quarter.
"RTN","BIREPT",178,0)
 ;;
"RTN","BIREPT",179,0)
 ;;COMMUNITIES: If you select for specific Communities, only patients
"RTN","BIREPT",180,0)
 ;;whose Current Community matches one of the Communities selected will
"RTN","BIREPT",181,0)
 ;;be included in the report.  "Current Community" is refers to Item 6
"RTN","BIREPT",182,0)
 ;;on Page 1 of the RPMS Patient Registration.
"RTN","BIREPT",183,0)
 ;;
"RTN","BIREPT",184,0)
 ;;HEALTH CARE FACILITIES: If you select for specific Health Care
"RTN","BIREPT",185,0)
 ;;Facilities, only Patients who have active Chart#'s at one or more
"RTN","BIREPT",186,0)
 ;;of the selected Facilities will be included in the report.
"RTN","BIREPT",187,0)
 ;;
"RTN","BIREPT",188,0)
 ;;CASE MANAGERS: If you select for specific Case Managers, only
"RTN","BIREPT",189,0)
 ;;patients who have the selected Case Managers will be included
"RTN","BIREPT",190,0)
 ;;in the report.
"RTN","BIREPT",191,0)
 ;;
"RTN","BIREPT",192,0)
 ;;BENEFICIARY TYPES: If you select for specific Beneficiary Types,
"RTN","BIREPT",193,0)
 ;;only patients whose Beneficiary Type is one of those you select
"RTN","BIREPT",194,0)
 ;;will be included in the report.  "Beneficiary Type" refers to
"RTN","BIREPT",195,0)
 ;;Item 3 on Page 2 of the RPMS Patient Registration.
"RTN","BIREPT",196,0)
 ;;
"RTN","BIREPT",197,0)
 ;;PATIENT POPULATION GROUP: You may select one of four patient groups
"RTN","BIREPT",198,0)
 ;;to be considered in the report: Registered Patients (All),
"RTN","BIREPT",199,0)
 ;;Immunization Register Patients (Active), User Population (1+ visits
"RTN","BIREPT",200,0)
 ;;in 3 yrs), or Active Clinical Users (2+ visits in 3 yrs).
"RTN","BIREPT",201,0)
 ;;Immunization Register Patients (Active) is the default.
"RTN","BIREPT",202,0)
 ;;
"RTN","BIREPT",203,0)
 ;;INCLUDE VARICELLA & PNEUMO: This option allows you to include Varicella
"RTN","BIREPT",204,0)
 ;;and Pneumo in the statistics of the "Appropriate for Age" row at the
"RTN","BIREPT",205,0)
 ;;top of the report.
"RTN","BIREPT",206,0)
 ;;
"RTN","BIREPT",207,0)
 ;;
"RTN","BIREPT",208,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIREPT",209,0)
 Q
"RTN","BIREPT",210,0)
 ;
"RTN","BIREPT",211,0)
 ;
"RTN","BIREPT",212,0)
 ;----------
"RTN","BIREPT",213,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIREPT",214,0)
 Q:$G(BILINL)=""
"RTN","BIREPT",215,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPT",216,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIREPT",217,0)
 Q
"RTN","BIREPT",218,0)
 ;
"RTN","BIREPT",219,0)
 ;
"RTN","BIREPT",220,0)
 ;----------
"RTN","BIREPT",221,0)
EXIT ;EP
"RTN","BIREPT",222,0)
 ;---> EOJ cleanup.
"RTN","BIREPT",223,0)
 D KILLALL^BIUTL8(1)
"RTN","BIREPT",224,0)
 K ^TMP("BIREPT",$J)
"RTN","BIREPT",225,0)
 D CLEAR^VALM1
"RTN","BIREPT",226,0)
 D FULL^VALM1
"RTN","BIREPT",227,0)
 Q
"RTN","BIREPT1")
0^123^B22145420
"RTN","BIREPT1",1,0)
BIREPT1 ;IHS/CMI/MWR - REPORT, TWO-YR-OLD RATES; MAY 10, 2010
"RTN","BIREPT1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPT1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPT1",4,0)
 ;;  VIEW OR PRINT TWO-YR-OLD IMMUNIZATION RATES REPORT.
"RTN","BIREPT1",5,0)
 ;
"RTN","BIREPT1",6,0)
 ;
"RTN","BIREPT1",7,0)
 ;----------
"RTN","BIREPT1",8,0)
START(BIX) ;EP
"RTN","BIREPT1",9,0)
 ;---> Prepare and display or print Two-Yr-Old Rates Report.
"RTN","BIREPT1",10,0)
 ;---> Parameters:
"RTN","BIREPT1",11,0)
 ;     1 - BIX    (req) If BIX="PRINT", then print Report.
"RTN","BIREPT1",12,0)
 ;                      If BIX="VIEW", then view Report (default).
"RTN","BIREPT1",13,0)
 ;---> Variables:
"RTN","BIREPT1",14,0)
 ;     1 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPT1",15,0)
 ;     2 - BITAR   (opt) Two-Yr-Old Report Age Range, default="19-35".
"RTN","BIREPT1",16,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPT1",17,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPT1",18,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPT1",19,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPT1",20,0)
 ;     7 - BIPOP   (ret) BIPOP=1 if error.
"RTN","BIREPT1",21,0)
 ;     8 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPT1",22,0)
 ;
"RTN","BIREPT1",23,0)
 ;---> Check for required Variables.
"RTN","BIREPT1",24,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(622,,1) D RESET^BIREPT Q
"RTN","BIREPT1",25,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,,1) D RESET^BIREPT Q
"RTN","BIREPT1",26,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,,1) D RESET^BIREPT Q
"RTN","BIREPT1",27,0)
 I '$D(BICM)  D ERRCD^BIUTL2(615,,1) D RESET^BIREPT Q
"RTN","BIREPT1",28,0)
 I '$D(BIBEN) D ERRCD^BIUTL2(662,,1) D RESET^BIREPT Q
"RTN","BIREPT1",29,0)
 I '$G(BISITE) S BISITE=$G(DUZ(2))
"RTN","BIREPT1",30,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,,1) D RESET^BIREPT Q
"RTN","BIREPT1",31,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPT1",32,0)
 ;
"RTN","BIREPT1",33,0)
 S:'$G(BITAR) BITAR="19-35"
"RTN","BIREPT1",34,0)
 S BIAGRPS=$S(BITAR="19-35":"3,5,7,16,19,36",1:"3,5,7,16,19,24,36")
"RTN","BIREPT1",35,0)
 ;
"RTN","BIREPT1",36,0)
 ;---> BITOTPTS=Total Patients, used by HDR code after EN.
"RTN","BIREPT1",37,0)
 N BITOTPTS
"RTN","BIREPT1",38,0)
 ;
"RTN","BIREPT1",39,0)
 D SETVARS^BIUTL5 N VALMCNT
"RTN","BIREPT1",40,0)
 I $G(BIX)="PRINT" D PRINT,RESET^BIREPT Q
"RTN","BIREPT1",41,0)
 ;
"RTN","BIREPT1",42,0)
 ;
"RTN","BIREPT1",43,0)
 ;---> Set BIAG for Age Range in header of report.
"RTN","BIREPT1",44,0)
 ;---> Set BIRPDT for Report Date ("Quarterly, etc.).
"RTN","BIREPT1",45,0)
 ;---> Set BIRTN in case user runs Patient List then needs to return
"RTN","BIREPT1",46,0)
 ;---> to INIT here.
"RTN","BIREPT1",47,0)
 ;---> Set BITITL for Report Name in Patient List, if called.
"RTN","BIREPT1",48,0)
 N BIRPDT,BIRTN,BITITL
"RTN","BIREPT1",49,0)
 S BIRPDT=BIQDT,BIRTN="BIREPT1",BITITL="TWO-YR-OLD"
"RTN","BIREPT1",50,0)
 D EN
"RTN","BIREPT1",51,0)
 Q
"RTN","BIREPT1",52,0)
 ;
"RTN","BIREPT1",53,0)
 ;
"RTN","BIREPT1",54,0)
 ;----------
"RTN","BIREPT1",55,0)
PRINT ;EP
"RTN","BIREPT1",56,0)
 ;---> Main entry point for printing the Two-Yr-Old Rates Report.
"RTN","BIREPT1",57,0)
 D DEVICE(.BIPOP)
"RTN","BIREPT1",58,0)
 Q:$G(BIPOP)
"RTN","BIREPT1",59,0)
 ;
"RTN","BIREPT1",60,0)
 D:$G(IO)'=$G(IO(0))
"RTN","BIREPT1",61,0)
 .W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPT1",62,0)
 ;
"RTN","BIREPT1",63,0)
 ;---> Prepare report.
"RTN","BIREPT1",64,0)
 K ^TMP("BIREPT1",$J),^TMP("BIDUL",$J)
"RTN","BIREPT1",65,0)
 N VALM,VALMHDR
"RTN","BIREPT1",66,0)
 D START^BIREPT2(BIQDT,BITAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP),HDR
"RTN","BIREPT1",67,0)
 ;
"RTN","BIREPT1",68,0)
 D PRTLST^BIUTL8("BIREPT1")
"RTN","BIREPT1",69,0)
 D EXIT,RESET^BIREPT
"RTN","BIREPT1",70,0)
 Q
"RTN","BIREPT1",71,0)
 ;
"RTN","BIREPT1",72,0)
 ;
"RTN","BIREPT1",73,0)
 ;----------
"RTN","BIREPT1",74,0)
EN ;EP
"RTN","BIREPT1",75,0)
 ;---> Main entry point for List Template BI REPORT TWO-YR-OLD RATES1.
"RTN","BIREPT1",76,0)
 D EN^VALM("BI REPORT TWO-YR-OLD RATES1")
"RTN","BIREPT1",77,0)
 Q
"RTN","BIREPT1",78,0)
 ;
"RTN","BIREPT1",79,0)
 ;
"RTN","BIREPT1",80,0)
 ;----------
"RTN","BIREPT1",81,0)
HDR ;EP
"RTN","BIREPT1",82,0)
 ;---> Header code
"RTN","BIREPT1",83,0)
 D HEAD^BIREPT2(BIQDT,BITAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BIUP)
"RTN","BIREPT1",84,0)
 Q
"RTN","BIREPT1",85,0)
 ;
"RTN","BIREPT1",86,0)
 ;
"RTN","BIREPT1",87,0)
 ;----------
"RTN","BIREPT1",88,0)
INIT ;EP
"RTN","BIREPT1",89,0)
 ;---> Initialize variables and list array.
"RTN","BIREPT1",90,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIREPT1",91,0)
 W !!?10,"This may take some time.  Please hold on...",!
"RTN","BIREPT1",92,0)
 K ^TMP("BIREPT1",$J),^TMP("BIDUL",$J)
"RTN","BIREPT1",93,0)
 D START^BIREPT2(BIQDT,BITAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP)
"RTN","BIREPT1",94,0)
 ;---> Set up ZTSAVE in case user Queues from PL in List.
"RTN","BIREPT1",95,0)
 D ZSAVES^BIUTL3
"RTN","BIREPT1",96,0)
 Q
"RTN","BIREPT1",97,0)
 ;
"RTN","BIREPT1",98,0)
 ;
"RTN","BIREPT1",99,0)
 ;----------
"RTN","BIREPT1",100,0)
RESET ;EP
"RTN","BIREPT1",101,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIREPT1",102,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIREPT1",103,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIREPT1",104,0)
 D INIT,HDR Q
"RTN","BIREPT1",105,0)
 ;
"RTN","BIREPT1",106,0)
 ;
"RTN","BIREPT1",107,0)
 ;----------
"RTN","BIREPT1",108,0)
HELP ;EP
"RTN","BIREPT1",109,0)
 N BIX S BIX=X
"RTN","BIREPT1",110,0)
 D FULL^VALM1 N BIPOP
"RTN","BIREPT1",111,0)
 D TITLE^BIUTL5("VIEW TWO-YR-OLD REPORT - HELP")
"RTN","BIREPT1",112,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIREPT1",113,0)
 D:BIX'="??" RE^VALM4
"RTN","BIREPT1",114,0)
 Q
"RTN","BIREPT1",115,0)
 ;
"RTN","BIREPT1",116,0)
 ;
"RTN","BIREPT1",117,0)
 ;----------
"RTN","BIREPT1",118,0)
TEXT1 ;EP
"RTN","BIREPT1",119,0)
 ;;You have chosen to View the Two-Yr-Old Report rather than Print it.
"RTN","BIREPT1",120,0)
 ;;(You may print the report from here as well by entering "PL".)
"RTN","BIREPT1",121,0)
 ;;
"RTN","BIREPT1",122,0)
 ;;Also, you may:
"RTN","BIREPT1",123,0)
 ;;
"RTN","BIREPT1",124,0)
 ;;Enter "N" to view the list of Patients who were NOT Current
"RTN","BIREPT1",125,0)
 ;;          or "NOT up-to-date" with their immunizations, according
"RTN","BIREPT1",126,0)
 ;;          to recommendeded guidelines for their age.
"RTN","BIREPT1",127,0)
 ;;
"RTN","BIREPT1",128,0)
 ;;Enter "C" to view the list of Patients who were CURRENT or
"RTN","BIREPT1",129,0)
 ;;          "up-to-date" with their immunizations, according to
"RTN","BIREPT1",130,0)
 ;;          recommendeded guidelines for their age.
"RTN","BIREPT1",131,0)
 ;;
"RTN","BIREPT1",132,0)
 ;;Enter "B" to view a list of both groups of patients combined.
"RTN","BIREPT1",133,0)
 ;;
"RTN","BIREPT1",134,0)
 ;;
"RTN","BIREPT1",135,0)
 D PRINTX("TEXT1")
"RTN","BIREPT1",136,0)
 Q
"RTN","BIREPT1",137,0)
 ;
"RTN","BIREPT1",138,0)
 ;
"RTN","BIREPT1",139,0)
 ;----------
"RTN","BIREPT1",140,0)
EXIT ;EP
"RTN","BIREPT1",141,0)
 ;---> Cleanup, EOJ.
"RTN","BIREPT1",142,0)
 K ^TMP("BIREPT1",$J)
"RTN","BIREPT1",143,0)
 D CLEAR^VALM1
"RTN","BIREPT1",144,0)
 D FULL^VALM1
"RTN","BIREPT1",145,0)
 Q
"RTN","BIREPT1",146,0)
 ;
"RTN","BIREPT1",147,0)
 ;
"RTN","BIREPT1",148,0)
 ;----------
"RTN","BIREPT1",149,0)
DEVICE(BIPOP) ;EP
"RTN","BIREPT1",150,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIREPT1",151,0)
 ;---> Parameters:
"RTN","BIREPT1",152,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIREPT1",153,0)
 ;
"RTN","BIREPT1",154,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIREPT1",155,0)
 S ZTRTN="DEQUEUE^BIREPT1"
"RTN","BIREPT1",156,0)
 D ZSAVES^BIUTL3
"RTN","BIREPT1",157,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIREPT1",158,0)
 Q
"RTN","BIREPT1",159,0)
 ;
"RTN","BIREPT1",160,0)
 ;
"RTN","BIREPT1",161,0)
 ;----------
"RTN","BIREPT1",162,0)
DEQUEUE ;EP
"RTN","BIREPT1",163,0)
 ;
"RTN","BIREPT1",164,0)
 ;---> Prepare and print Two-Year-Old Report.
"RTN","BIREPT1",165,0)
 K VALMHDR,^TMP("BIREPT1",$J)
"RTN","BIREPT1",166,0)
 D HDR^BIREPT1
"RTN","BIREPT1",167,0)
 D START^BIREPT2(BIQDT,BITAR,BIAGRPS,.BICC,.BIHCF,.BICM,.BIBEN,BISITE,BIUP)
"RTN","BIREPT1",168,0)
 D PRTLST^BIUTL8("BIREPT1"),EXIT
"RTN","BIREPT1",169,0)
 Q
"RTN","BIREPT1",170,0)
 ;
"RTN","BIREPT1",171,0)
 ;
"RTN","BIREPT1",172,0)
 ;----------
"RTN","BIREPT1",173,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPT1",174,0)
 Q:$G(BILINL)=""
"RTN","BIREPT1",175,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPT1",176,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPT1",177,0)
 Q
"RTN","BIREPT2")
0^124^B36921120
"RTN","BIREPT2",1,0)
BIREPT2 ;IHS/CMI/MWR - REPORT, TWO-YR-OLD RATES; MAY 10, 2010
"RTN","BIREPT2",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPT2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPT2",4,0)
 ;;  VIEW TWO-YR-OLD IMMUNIZATION RATES REPORT, GATHER DATA.
"RTN","BIREPT2",5,0)
 ;;  PATCH 3: Add report line for Hx of Chickenpox.  START+34
"RTN","BIREPT2",6,0)
 ;
"RTN","BIREPT2",7,0)
 ;
"RTN","BIREPT2",8,0)
 ;----------
"RTN","BIREPT2",9,0)
HEAD(BIQDT,BITAR,BIAGRPS,BICC,BIHCF,BICM,BIBEN,BIUP) ;EP
"RTN","BIREPT2",10,0)
 ;---> Produce Header array for Two-Yr-Old Report.
"RTN","BIREPT2",11,0)
 ;---> Parameters:
"RTN","BIREPT2",12,0)
 ;     1 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPT2",13,0)
 ;     2 - BITAR   (req) Two-Yr-Old Report Age Range, default="19-35".
"RTN","BIREPT2",14,0)
 ;     3 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT2",15,0)
 ;     4 - BICC    (req) Current Community array.
"RTN","BIREPT2",16,0)
 ;     5 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPT2",17,0)
 ;     6 - BICM    (req) Case Manager array.
"RTN","BIREPT2",18,0)
 ;     7 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPT2",19,0)
 ;     8 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPT2",20,0)
 ;
"RTN","BIREPT2",21,0)
 ;---> Check for required Variables.
"RTN","BIREPT2",22,0)
 Q:'$G(BIQDT)
"RTN","BIREPT2",23,0)
 Q:'$D(BICC)
"RTN","BIREPT2",24,0)
 Q:'$D(BIHCF)
"RTN","BIREPT2",25,0)
 Q:'$D(BICM)
"RTN","BIREPT2",26,0)
 Q:'$D(BIBEN)
"RTN","BIREPT2",27,0)
 Q:'$D(BITAR)
"RTN","BIREPT2",28,0)
 Q:'$G(BIAGRPS)
"RTN","BIREPT2",29,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPT2",30,0)
 ;
"RTN","BIREPT2",31,0)
 K VALMHDR
"RTN","BIREPT2",32,0)
 N BILINE,X S BILINE=0
"RTN","BIREPT2",33,0)
 ;
"RTN","BIREPT2",34,0)
 N X S X=""
"RTN","BIREPT2",35,0)
 ;---> If Header array is NOT being for Listmananger include version.
"RTN","BIREPT2",36,0)
 S:'$D(VALM("BM")) X=$$LMVER^BILOGO()
"RTN","BIREPT2",37,0)
 ;
"RTN","BIREPT2",38,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPT2",39,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)) D CENTERT^BIUTL5(.X)
"RTN","BIREPT2",40,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPT2",41,0)
 ;
"RTN","BIREPT2",42,0)
 S X="*  Two-Yr-Old Immunization Report ("_$P(BITAR,"-")_"-35 mths)  *"
"RTN","BIREPT2",43,0)
 D CENTERT^BIUTL5(.X)
"RTN","BIREPT2",44,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPT2",45,0)
 ;
"RTN","BIREPT2",46,0)
 S X=$$SP^BIUTL5(27)_"Report Date: "_$$SLDT1^BIUTL5(DT)
"RTN","BIREPT2",47,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPT2",48,0)
 ;
"RTN","BIREPT2",49,0)
 S X=$$SP^BIUTL5(30)_"End Date: "_$$SLDT1^BIUTL5(BIQDT)
"RTN","BIREPT2",50,0)
 D WH^BIW(.BILINE,X,1)
"RTN","BIREPT2",51,0)
 ;
"RTN","BIREPT2",52,0)
 S X=" "_$$BIUPTX^BIUTL6(BIUP)
"RTN","BIREPT2",53,0)
 I BIUP="i" S X=" "_$$BIUPTX^BIUTL6(BIUP,1)_" (Active)"
"RTN","BIREPT2",54,0)
 S X=$$PAD^BIUTL5(X,54)
"RTN","BIREPT2",55,0)
 ;
"RTN","BIREPT2",56,0)
 S X=X_$J("Total Patients: "_$G(BITOTPTS),24)
"RTN","BIREPT2",57,0)
 D WH^BIW(.BILINE,X)
"RTN","BIREPT2",58,0)
 ;
"RTN","BIREPT2",59,0)
 D WH^BIW(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPT2",60,0)
 ;
"RTN","BIREPT2",61,0)
 D
"RTN","BIREPT2",62,0)
 .;---> If specific Communities were selected (not ALL), then print
"RTN","BIREPT2",63,0)
 .;---> the Communities in a subheader at the top of the report.
"RTN","BIREPT2",64,0)
 .D SUBH^BIOUTPT5("BICC","Community",,"^AUTTCOM(",.BILINE,.BIERR,,12)
"RTN","BIREPT2",65,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPT2",66,0)
 .;
"RTN","BIREPT2",67,0)
 .;---> If specific Health Care Facilities, print subheader.
"RTN","BIREPT2",68,0)
 .D SUBH^BIOUTPT5("BIHCF","Facility",,"^DIC(4,",.BILINE,.BIERR,,12)
"RTN","BIREPT2",69,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPT2",70,0)
 .;
"RTN","BIREPT2",71,0)
 .;---> If specific Case Managers, print Case Manager subheader.
"RTN","BIREPT2",72,0)
 .D SUBH^BIOUTPT5("BICM","Case Manager",,"^VA(200,",.BILINE,.BIERR,,12)
"RTN","BIREPT2",73,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPT2",74,0)
 .;
"RTN","BIREPT2",75,0)
 .;---> If specific Beneficiary Types, print Beneficiary Type subheader.
"RTN","BIREPT2",76,0)
 .D SUBH^BIOUTPT5("BIBEN","Beneficiary Type",,"^AUTTBEN(",.BILINE,.BIERR,,12)
"RTN","BIREPT2",77,0)
 .I $G(BIERR) D ERRCD^BIUTL2(BIERR,.X) D WH^BIW(.BILINE,X) Q
"RTN","BIREPT2",78,0)
 .;
"RTN","BIREPT2",79,0)
 .S X=" Received by |    3 mo     5 mo     7 mo    16 mo    19 mo"
"RTN","BIREPT2",80,0)
 .S:BIAGRPS["24" X=X_"    24 mo"
"RTN","BIREPT2",81,0)
 .S X=X_"   "_$$SLDT2^BIUTL5(BIQDT,1)
"RTN","BIREPT2",82,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPT2",83,0)
 .S X="             |    # %      # %      # %      # %      # %"
"RTN","BIREPT2",84,0)
 .S X=X_"      # %"
"RTN","BIREPT2",85,0)
 .S:BIAGRPS["24" X=X_"      # %"
"RTN","BIREPT2",86,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIREPT2",87,0)
 ;
"RTN","BIREPT2",88,0)
 ;---> If Header array is being built for Listmananger,
"RTN","BIREPT2",89,0)
 ;---> reset display window margins for Communities, etc.
"RTN","BIREPT2",90,0)
 D:$D(VALM("BM"))
"RTN","BIREPT2",91,0)
 .S VALM("TM")=BILINE+3
"RTN","BIREPT2",92,0)
 .S VALM("LINES")=VALM("BM")-VALM("TM")+1
"RTN","BIREPT2",93,0)
 .;---> Safeguard to prevent divide/0 error.
"RTN","BIREPT2",94,0)
 .S:VALM("LINES")<1 VALM("LINES")=1
"RTN","BIREPT2",95,0)
 Q
"RTN","BIREPT2",96,0)
 ;
"RTN","BIREPT2",97,0)
 ;
"RTN","BIREPT2",98,0)
 ;----------
"RTN","BIREPT2",99,0)
START(BIQDT,BITAR,BIAGRPS,BICC,BIHCF,BICM,BIBEN,BISITE,BIUP) ;EP
"RTN","BIREPT2",100,0)
 ;---> Produce array for Quarterly Immunization Report.
"RTN","BIREPT2",101,0)
 ;---> Parameters:
"RTN","BIREPT2",102,0)
 ;     1 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPT2",103,0)
 ;     2 - BITAR   (opt) Two-Yr-Old Report Age Range, default="19-35".
"RTN","BIREPT2",104,0)
 ;     3 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT2",105,0)
 ;     4 - BICC    (req) Current Community array.
"RTN","BIREPT2",106,0)
 ;     5 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPT2",107,0)
 ;     6 - BICM    (req) Case Manager array.
"RTN","BIREPT2",108,0)
 ;     7 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPT2",109,0)
 ;     8 - BISITE  (req) Site IEN.
"RTN","BIREPT2",110,0)
 ;     9 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPT2",111,0)
 ;
"RTN","BIREPT2",112,0)
 K ^TMP("BIREPT1",$J)
"RTN","BIREPT2",113,0)
 N BILINE,BITMP,X S BILINE=0
"RTN","BIREPT2",114,0)
 ;
"RTN","BIREPT2",115,0)
 ;---> Check for required Variables.
"RTN","BIREPT2",116,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(623,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",117,0)
 I '$D(BITAR)  D ERRCD^BIUTL2(613,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",118,0)
 I '$G(BIAGRPS) D ERRCD^BIUTL2(677,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",119,0)
 I '$D(BICC) D ERRCD^BIUTL2(614,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",120,0)
 I '$D(BIHCF) D ERRCD^BIUTL2(625,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",121,0)
 I '$D(BICM) D ERRCD^BIUTL2(615,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",122,0)
 I '$D(BIBEN)  D ERRCD^BIUTL2(662,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",123,0)
 I '$G(BISITE) S BISITE=$G(DUZ(2))
"RTN","BIREPT2",124,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,.X) D WRITE^BIREPT3(.BILINE,X) Q
"RTN","BIREPT2",125,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPT2",126,0)
 ;
"RTN","BIREPT2",127,0)
 ;---> Gather data.
"RTN","BIREPT2",128,0)
 D GETDATA^BIREPT3(.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BITAR,BIAGRPS,BISITE,BIUP,.BIERR)
"RTN","BIREPT2",129,0)
 I $G(BIERR)]"" D WRITE^BIREPT3(.BILINE,BIERR) Q
"RTN","BIREPT2",130,0)
 ;
"RTN","BIREPT2",131,0)
 ;---> Write Statistics lines for each Vaccine Group (BIVGRP).
"RTN","BIREPT2",132,0)
 ;
"RTN","BIREPT2",133,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPT2",134,0)
 ;---> Add report line for Hx of Chickenpox.
"RTN","BIREPT2",135,0)
 ;F BIVGRP=1,2,3,4,6,7,9,10,11,15 D VGRP^BIREPT3(.BILINE,BIVGRP,BIAGRPS,.BIERR)
"RTN","BIREPT2",136,0)
 F BIVGRP=1,2,3,4,6,7,132,9,10,11,15 D VGRP^BIREPT3(.BILINE,BIVGRP,BIAGRPS,.BIERR)
"RTN","BIREPT2",137,0)
 ;**********
"RTN","BIREPT2",138,0)
 ;
"RTN","BIREPT2",139,0)
 I $G(BIERR)]"" D WRITE^BIREPT3(.BILINE,BIERR) Q
"RTN","BIREPT2",140,0)
 ;
"RTN","BIREPT2",141,0)
 ;---> Write Statistics lines for each Vaccine Combinations.
"RTN","BIREPT2",142,0)
 ;---> NOTE: These Combo strings are also used to set BITMP("STATS"
"RTN","BIREPT2",143,0)
 ;---> nodes beginning at +130^BIREPT4.  vvv83
"RTN","BIREPT2",144,0)
 D VCOMB^BIREPT3(.BILINE,"1|1^2|1^3|1^4|1",BIAGRPS,.BIERR)
"RTN","BIREPT2",145,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1",BIAGRPS,.BIERR)
"RTN","BIREPT2",146,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3",BIAGRPS,.BIERR)
"RTN","BIREPT2",147,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3",BIAGRPS,.BIERR)
"RTN","BIREPT2",148,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3^7|1",BIAGRPS,.BIERR)
"RTN","BIREPT2",149,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3^7|1^11|3",BIAGRPS,.BIERR)
"RTN","BIREPT2",150,0)
 ;---> Next combo is up to date (UTD); send 5th parameter=1.
"RTN","BIREPT2",151,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3^7|1^11|4",BIAGRPS,.BIERR,1)
"RTN","BIREPT2",152,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3^7|1^11|4^9|1",BIAGRPS,.BIERR)
"RTN","BIREPT2",153,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3^7|1^11|4^9|2^15|3",BIAGRPS,.BIERR)
"RTN","BIREPT2",154,0)
 D VCOMB^BIREPT3(.BILINE,"1|4^2|3^6|1^3|3^4|3^7|1^11|4^9|2^15|3^10|2",BIAGRPS,.BIERR)
"RTN","BIREPT2",155,0)
 I $G(BIERR)]"" D WRITE^BIREPT3(.BILINE,BIERR) Q
"RTN","BIREPT2",156,0)
 ;
"RTN","BIREPT2",157,0)
 ;---> BITOTPTS (total patients) not newed here because it is also
"RTN","BIREPT2",158,0)
 ;---> used in the Header.
"RTN","BIREPT2",159,0)
 S BITOTPTS=+$G(BITMP("STATS","TOTLPTS"))
"RTN","BIREPT2",160,0)
 S X=" Total Active Patients reviewed"_$J(BITOTPTS,44)
"RTN","BIREPT2",161,0)
 D WRITE^BIREPT3(.BILINE,X)
"RTN","BIREPT2",162,0)
 D WRITE^BIREPT3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPT2",163,0)
 ;
"RTN","BIREPT2",164,0)
 ;---> Now write total patients considered who had refusals.
"RTN","BIREPT2",165,0)
 N M,N S (M,N)=0 F  S M=$O(BITMP("REFUSALS",M)) Q:'M  S N=N+1
"RTN","BIREPT2",166,0)
 S X=" Total Patients included who had Refusals on record"_$J(N,24)
"RTN","BIREPT2",167,0)
 D WRITE^BIREPT3(.BILINE,X),WRITE^BIREPT3(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPT2",168,0)
 ;
"RTN","BIREPT2",169,0)
 ;---> Set final VALMCNT (Listman line count).
"RTN","BIREPT2",170,0)
 S VALMCNT=BILINE
"RTN","BIREPT2",171,0)
 Q
"RTN","BIREPT3")
0^125^B22745337
"RTN","BIREPT3",1,0)
BIREPT3 ;IHS/CMI/MWR - REPORT, TWO-YR-OLD RATES; MAY 10, 2010
"RTN","BIREPT3",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPT3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPT3",4,0)
 ;;  VIEW TWO-YR-OLD IMMUNIZATION RATES REPORT.
"RTN","BIREPT3",5,0)
 ;;  PATCH 3: Add report line for Hx of Chickenpox.  VGRP+19
"RTN","BIREPT3",6,0)
 ;
"RTN","BIREPT3",7,0)
 ;
"RTN","BIREPT3",8,0)
 ;----------
"RTN","BIREPT3",9,0)
GETDATA(BICC,BIHCF,BICM,BIBEN,BIQDT,BITAR,BIAGRPS,BISITE,BIUP,BIERR) ;EP
"RTN","BIREPT3",10,0)
 ;---> Gather Immunization History data on selected patients.
"RTN","BIREPT3",11,0)
 ;---> Parameters:
"RTN","BIREPT3",12,0)
 ;     1 - BICC    (req) Current Community array.
"RTN","BIREPT3",13,0)
 ;     2 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPT3",14,0)
 ;     3 - BICM    (req) Case Manager array.
"RTN","BIREPT3",15,0)
 ;     4 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPT3",16,0)
 ;     5 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPT3",17,0)
 ;     6 - BITAR   (opt) Two-Yr-Old Age Range; default="19-35" (months).
"RTN","BIREPT3",18,0)
 ;     7 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT3",19,0)
 ;     8 - BISITE  (req) Site IEN.
"RTN","BIREPT3",20,0)
 ;     9 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPT3",21,0)
 ;    10 - BIERR   (ret) Error.
"RTN","BIREPT3",22,0)
 ;
"RTN","BIREPT3",23,0)
 S:'$G(BISITE) BISITE=$G(DUZ(2)) I '$G(BISITE) S BIERR=109 Q
"RTN","BIREPT3",24,0)
 S:'$G(BIQDT) BIQDT=DT
"RTN","BIREPT3",25,0)
 S:'$D(BITAR) BITAR="19-35"
"RTN","BIREPT3",26,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPT3",27,0)
 ;
"RTN","BIREPT3",28,0)
 ;---> Get Begin and End Dates (DOB's).
"RTN","BIREPT3",29,0)
 D AGEDATE^BIAGE(BITAR,BIQDT,.BIBEGDT,.BIENDDT,.BIERR)
"RTN","BIREPT3",30,0)
 Q:$G(BIERR)]""
"RTN","BIREPT3",31,0)
 ;
"RTN","BIREPT3",32,0)
 ;---> Gather and sort patients.
"RTN","BIREPT3",33,0)
 D GETPATS^BIREPT4(BIBEGDT,BIENDDT,.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BIAGRPS,BISITE,BIUP)
"RTN","BIREPT3",34,0)
 Q
"RTN","BIREPT3",35,0)
 ;
"RTN","BIREPT3",36,0)
 ;
"RTN","BIREPT3",37,0)
 ;----------
"RTN","BIREPT3",38,0)
VGRP(BILINE,BIVGRP,BIAGRPS,BIERR) ;EP
"RTN","BIREPT3",39,0)
 ;---> Write Stats lines for each Vaccine Group.
"RTN","BIREPT3",40,0)
 ;---> Parameters:
"RTN","BIREPT3",41,0)
 ;     1 - BILINE  (req) Line number in ^TMP Listman array.
"RTN","BIREPT3",42,0)
 ;     2 - BIVGRP  (req) IEN of Vaccine Group.
"RTN","BIREPT3",43,0)
 ;     3 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT3",44,0)
 ;     4 - BIERR   (ret) Error.
"RTN","BIREPT3",45,0)
 ;
"RTN","BIREPT3",46,0)
 I '$G(BIVGRP) D ERRCD^BIUTL2(510,.BIERR) Q
"RTN","BIREPT3",47,0)
 I '$G(BIAGRPS) D ERRCD^BIUTL2(677,.BIERR) Q
"RTN","BIREPT3",48,0)
 ;
"RTN","BIREPT3",49,0)
 ;---> Write two lines for each Dose of this Vaccine Group.
"RTN","BIREPT3",50,0)
 N BIDOSE,BIMAXD S BIMAXD=$$VGROUP^BIUTL2(BIVGRP,6)
"RTN","BIREPT3",51,0)
 ;**********
"RTN","BIREPT3",52,0)
 S:'BIMAXD BIMAXD=1
"RTN","BIREPT3",53,0)
 ;**********
"RTN","BIREPT3",54,0)
 F BIDOSE=1:1:BIMAXD D
"RTN","BIREPT3",55,0)
 .;---> BIX=text of the line to write.
"RTN","BIREPT3",56,0)
 .;
"RTN","BIREPT3",57,0)
 .;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPT3",58,0)
 .;---> Add report line for Hx of Chickenpox.
"RTN","BIREPT3",59,0)
 .;N BIX S BIX="    "_BIDOSE_"-"_$$VGROUP^BIUTL2(BIVGRP,5)
"RTN","BIREPT3",60,0)
 .N BIX D
"RTN","BIREPT3",61,0)
 ..;---> Include exception here for Chickenpox.
"RTN","BIREPT3",62,0)
 ..I BIVGRP=132 S BIX=" Hx of ChPox" Q
"RTN","BIREPT3",63,0)
 ..;---> Write the Dose#-Vaccine Group in left margin.
"RTN","BIREPT3",64,0)
 ..S BIX="    "_BIDOSE_"-"_$$VGROUP^BIUTL2(BIVGRP,5)
"RTN","BIREPT3",65,0)
 .;**********
"RTN","BIREPT3",66,0)
 .;
"RTN","BIREPT3",67,0)
 .S BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPT3",68,0)
 .;
"RTN","BIREPT3",69,0)
 .;---> Now loop through the 6 age groups, concating subtotals.
"RTN","BIREPT3",70,0)
 .N BIAGRP,K
"RTN","BIREPT3",71,0)
 .F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPT3",72,0)
 ..N Y S Y=$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPT3",73,0)
 ..S BIX=BIX_$J(Y,7)_"  "
"RTN","BIREPT3",74,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPT3",75,0)
 .D MARK^BIW(BILINE,3,"BIREPT1")
"RTN","BIREPT3",76,0)
 .;
"RTN","BIREPT3",77,0)
 .;---> Now write percentages line.
"RTN","BIREPT3",78,0)
 .;
"RTN","BIREPT3",79,0)
 .;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPT3",80,0)
 .;---> Add report line for Hx of Chickenpox.
"RTN","BIREPT3",81,0)
 .S BIX=$$SP^BIUTL5(13)_"|"
"RTN","BIREPT3",82,0)
 .S BIX="" S:BIVGRP=132 BIX="   (Immune)"
"RTN","BIREPT3",83,0)
 .S BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPT3",84,0)
 .;**********
"RTN","BIREPT3",85,0)
 .;
"RTN","BIREPT3",86,0)
 .F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPT3",87,0)
 ..N Y S Y=$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGRP))
"RTN","BIREPT3",88,0)
 ..I 'Y S BIX=BIX_$J(Y,7)_"  " Q
"RTN","BIREPT3",89,0)
 ..I '$G(BITMP("STATS","TOTLPTS")) S BIX=BIX_$J(Y,7)_"  " Q
"RTN","BIREPT3",90,0)
 ..S Y=(Y*100)/$G(BITMP("STATS","TOTLPTS"))
"RTN","BIREPT3",91,0)
 ..S BIX=BIX_$J(Y,7,0)_"% "
"RTN","BIREPT3",92,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPT3",93,0)
 .Q:BIDOSE=BIMAXD
"RTN","BIREPT3",94,0)
 .S BIX=$$SP^BIUTL5(13)_"|"_$$SP^BIUTL5(65,"-")
"RTN","BIREPT3",95,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPT3",96,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPT3",97,0)
 Q
"RTN","BIREPT3",98,0)
 ;
"RTN","BIREPT3",99,0)
 ;
"RTN","BIREPT3",100,0)
 ;----------
"RTN","BIREPT3",101,0)
VCOMB(BILINE,BICOMB,BIAGRPS,BIERR,BIUTD) ;EP
"RTN","BIREPT3",102,0)
 ;---> Write Stats lines for each Vaccine Combination.
"RTN","BIREPT3",103,0)
 ;---> Parameters:
"RTN","BIREPT3",104,0)
 ;     1 - BILINE  (req) Line number in ^TMP Listman array.
"RTN","BIREPT3",105,0)
 ;     2 - BICOMB  (req) Numeric code of Vaccine Combination.
"RTN","BIREPT3",106,0)
 ;     3 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT3",107,0)
 ;     4 - BIERR   (ret) Error.
"RTN","BIREPT3",108,0)
 ;     5 - BIUTD   (opt) If BIUTD=1, tack on text: "*UTD"
"RTN","BIREPT3",109,0)
 ;
"RTN","BIREPT3",110,0)
 I '$G(BIVGRP) D ERRCD^BIUTL2(678,.BIERR) Q
"RTN","BIREPT3",111,0)
 I '$G(BIAGRPS) D ERRCD^BIUTL2(677,.BIERR) Q
"RTN","BIREPT3",112,0)
 ;     vvv83
"RTN","BIREPT3",113,0)
 ;
"RTN","BIREPT3",114,0)
 N BIX,I,X
"RTN","BIREPT3",115,0)
 F I=1:1:5 S BIX(I)=""
"RTN","BIREPT3",116,0)
 F I=1:1 S X=$P(BICOMB,U,I) Q:X=""  D
"RTN","BIREPT3",117,0)
 .S X=$P(X,"|",2)_"-"_$$VGROUP^BIUTL2($P(X,"|"),5)
"RTN","BIREPT3",118,0)
 .I I<3 S BIX(1)=BIX(1)_" "_X Q
"RTN","BIREPT3",119,0)
 .I I<5 S BIX(2)=BIX(2)_" "_X Q
"RTN","BIREPT3",120,0)
 .I I<7 S BIX(3)=BIX(3)_" "_X Q
"RTN","BIREPT3",121,0)
 .I I<9 S BIX(4)=BIX(4)_" "_X S:$G(BIUTD) BIX(4)=BIX(4)_"  *UTD" Q
"RTN","BIREPT3",122,0)
 .S BIX(5)=BIX(5)_" "_X
"RTN","BIREPT3",123,0)
 ;
"RTN","BIREPT3",124,0)
 ;---> Now loop through the age groups, concating subtotals.
"RTN","BIREPT3",125,0)
 S BIX=BIX(1),BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPT3",126,0)
 N BIAGRP,K
"RTN","BIREPT3",127,0)
 F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPT3",128,0)
 .N Y S Y=$G(BITMP("STATS",BICOMB,BIAGRP))
"RTN","BIREPT3",129,0)
 .S BIX=BIX_$J(Y,7)_"  "
"RTN","BIREPT3",130,0)
 D WRITE(.BILINE,BIX)
"RTN","BIREPT3",131,0)
 S I=3 S:BIX(3)]"" I=4 S:BIX(4)]"" I=5
"RTN","BIREPT3",132,0)
 D MARK^BIW(BILINE,I,"BIREPT1")
"RTN","BIREPT3",133,0)
 ;
"RTN","BIREPT3",134,0)
 ;---> Now write percentages line.
"RTN","BIREPT3",135,0)
 S BIX=BIX(2),BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPT3",136,0)
 F K=1:1 S BIAGRP=$P(BIAGRPS,",",K) Q:'BIAGRP  D
"RTN","BIREPT3",137,0)
 .N Y S Y=$G(BITMP("STATS",BICOMB,BIAGRP))
"RTN","BIREPT3",138,0)
 .I 'Y S BIX=BIX_$J(Y,7)_"  " Q
"RTN","BIREPT3",139,0)
 .I '$G(BITMP("STATS","TOTLPTS")) S BIX=BIX_$J(Y,7)_"  " Q
"RTN","BIREPT3",140,0)
 .S Y=(Y*100)/$G(BITMP("STATS","TOTLPTS"))
"RTN","BIREPT3",141,0)
 .S BIX=BIX_$J(Y,7,0)_"% "
"RTN","BIREPT3",142,0)
 D WRITE(.BILINE,BIX)
"RTN","BIREPT3",143,0)
 ;
"RTN","BIREPT3",144,0)
 F I=3,4,5 D:BIX(I)]""
"RTN","BIREPT3",145,0)
 .S BIX=BIX(I),BIX=$$PAD^BIUTL5(BIX,13)_"|"
"RTN","BIREPT3",146,0)
 .D WRITE(.BILINE,BIX)
"RTN","BIREPT3",147,0)
 ;
"RTN","BIREPT3",148,0)
 D WRITE(.BILINE,$$SP^BIUTL5(79,"-"))
"RTN","BIREPT3",149,0)
 Q
"RTN","BIREPT3",150,0)
 ;
"RTN","BIREPT3",151,0)
 ;
"RTN","BIREPT3",152,0)
 ;----------
"RTN","BIREPT3",153,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIREPT3",154,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIREPT3",155,0)
 ;---> Parameters:
"RTN","BIREPT3",156,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIREPT3",157,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIREPT3",158,0)
 ;
"RTN","BIREPT3",159,0)
 Q:'$D(BILINE)
"RTN","BIREPT3",160,0)
 D WL^BIW(.BILINE,"BIREPT1",$G(BIVAL),$G(BIBLNK))
"RTN","BIREPT3",161,0)
 ;
"RTN","BIREPT3",162,0)
 ;--->Set VALMCNT (Listman line count) for errors calls above.
"RTN","BIREPT3",163,0)
 S VALMCNT=BILINE
"RTN","BIREPT3",164,0)
 Q
"RTN","BIREPT4")
0^126^B108702724
"RTN","BIREPT4",1,0)
BIREPT4 ;IHS/CMI/MWR - REPORT, TWO-YR-OLD RATES; MAY 10, 2010
"RTN","BIREPT4",2,0)
 ;;8.5;IMMUNIZATION;**3**;SEP 10,2012;Build 2
"RTN","BIREPT4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPT4",4,0)
 ;;  VIEW TWO-YR-OLD IMMUNIZATION RATES REPORT, WRITE HEADERS, ETC.
"RTN","BIREPT4",5,0)
 ;;  PATCH 1: Exclude patients whose Inactive Date=Not in Register.  CHKSET+35
"RTN","BIREPT4",6,0)
 ;;  PATCH 3: Extensive edits to allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",7,0)
 ;;           CHKSET+60, CHKSET+209
"RTN","BIREPT4",8,0)
 ;
"RTN","BIREPT4",9,0)
 ;----------
"RTN","BIREPT4",10,0)
GETPATS(BIBEGDT,BIENDDT,BICC,BIHCF,BICM,BIBEN,BIQDT,BIAGRPS,BISITE,BIUP) ;EP
"RTN","BIREPT4",11,0)
 ;---> Get patients from VA PATIENT File, ^DPT(.
"RTN","BIREPT4",12,0)
 ;---> Parameters:
"RTN","BIREPT4",13,0)
 ;     1 - BIBEGDT (req) Begin DOB for this group.
"RTN","BIREPT4",14,0)
 ;     2 - BIENDDT (req) End DOB for this group.
"RTN","BIREPT4",15,0)
 ;     3 - BICC    (req) Current Community array.
"RTN","BIREPT4",16,0)
 ;     4 - BIHCF   (req) Health Care Facility array.
"RTN","BIREPT4",17,0)
 ;     5 - BICM    (req) Case Manager array.
"RTN","BIREPT4",18,0)
 ;     6 - BIBEN   (req) Beneficiary Type array.
"RTN","BIREPT4",19,0)
 ;     7 - BIQDT   (req) Quarter Ending Date.
"RTN","BIREPT4",20,0)
 ;     8 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT4",21,0)
 ;     9 - BISITE  (req) Site IEN.
"RTN","BIREPT4",22,0)
 ;     9 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPT4",23,0)
 ;
"RTN","BIREPT4",24,0)
 ;---> Set begin and end dates for search through PATIENT File.
"RTN","BIREPT4",25,0)
 ;
"RTN","BIREPT4",26,0)
 Q:'$G(BIBEGDT)  Q:'$G(BIENDDT)  Q:'$G(BIQDT)  Q:'$G(BIAGRPS)
"RTN","BIREPT4",27,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPT4",28,0)
 ;
"RTN","BIREPT4",29,0)
 ;---> Start 1 day prior to Begin Date and $O into the desired DOB's.
"RTN","BIREPT4",30,0)
 N BIDOB S BIDOB=BIBEGDT-1
"RTN","BIREPT4",31,0)
 F  S BIDOB=$O(^DPT("ADOB",BIDOB)) Q:(BIDOB>BIENDDT!('BIDOB))  D
"RTN","BIREPT4",32,0)
 .S BIDFN=0
"RTN","BIREPT4",33,0)
 .F  S BIDFN=$O(^DPT("ADOB",BIDOB,BIDFN)) Q:'BIDFN  D
"RTN","BIREPT4",34,0)
 ..D CHKSET(BIDFN,.BICC,.BIHCF,.BICM,.BIBEN,BIDOB,BIQDT,.BIVAL,BIAGRPS,BIUP)
"RTN","BIREPT4",35,0)
 ..;---> Set ^TMP("BIDUL",$J,CURCOM,1,HRCN,BIDFN)=$G(BIVAL) for Patient Roster.
"RTN","BIREPT4",36,0)
 ..D:$G(BIVAL) STORE^BIDUR1(BIDFN,DT,9,,BIVAL,BISITE)
"RTN","BIREPT4",37,0)
 Q
"RTN","BIREPT4",38,0)
 ;
"RTN","BIREPT4",39,0)
 ;
"RTN","BIREPT4",40,0)
 ;----------
"RTN","BIREPT4",41,0)
CHKSET(BIDFN,BICC,BIHCF,BICM,BIBEN,BIDOB,BIQDT,BIVAL,BIAGRPS,BIUP) ;EP
"RTN","BIREPT4",42,0)
 ;---> Check if this patient fits criteria; if so, set DFN
"RTN","BIREPT4",43,0)
 ;---> in ^TMP("BIREPT1".
"RTN","BIREPT4",44,0)
 ;---> Parameters:
"RTN","BIREPT4",45,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIREPT4",46,0)
 ;     2 - BICC   (req) Current Community array.
"RTN","BIREPT4",47,0)
 ;     3 - BIHCF  (req) Health Care Facility array.
"RTN","BIREPT4",48,0)
 ;     4 - BICM   (req) Case Manager array.
"RTN","BIREPT4",49,0)
 ;     5 - BIBEN  (req) Beneficiary Type array.
"RTN","BIREPT4",50,0)
 ;     6 - BIDOB  (req) Patient's Date of Birth.
"RTN","BIREPT4",51,0)
 ;     7 - BIQDT  (req) Quarter Ending Date.
"RTN","BIREPT4",52,0)
 ;     8 - BIVAL  (ret) 1=Not appropriate/complete, 2=43133 complete.
"RTN","BIREPT4",53,0)
 ;     9 - BIAGRPS (req) String of Age Groups (e.g., 3,5,7,16,19,24,36)
"RTN","BIREPT4",54,0)
 ;     9 - BIUP    (req) User Population/Group (Registered, Imm, User, Active).
"RTN","BIREPT4",55,0)
 ;
"RTN","BIREPT4",56,0)
 Q:'$G(BIDFN)
"RTN","BIREPT4",57,0)
 Q:'$D(BICC)
"RTN","BIREPT4",58,0)
 Q:'$D(BIHCF)
"RTN","BIREPT4",59,0)
 Q:'$D(BICM)
"RTN","BIREPT4",60,0)
 Q:'$D(BIBEN)
"RTN","BIREPT4",61,0)
 I '$G(BIDOB) S BIDOB=$$DOB^BIUTL1(BIDFN)
"RTN","BIREPT4",62,0)
 Q:'$G(BIQDT)
"RTN","BIREPT4",63,0)
 Q:'$G(BIAGRPS)
"RTN","BIREPT4",64,0)
 S:$G(BIUP)="" BIUP="u"
"RTN","BIREPT4",65,0)
 ;
"RTN","BIREPT4",66,0)
 ;---> Don't include this patient in Roster unless set below.
"RTN","BIREPT4",67,0)
 S BIVAL=0
"RTN","BIREPT4",68,0)
 ;
"RTN","BIREPT4",69,0)
 ;---> Filter for standard Patient Population parameter.
"RTN","BIREPT4",70,0)
 Q:'$$PPFILTR^BIREP(BIDFN,.BIHCF,BIQDT,BIUP)
"RTN","BIREPT4",71,0)
 ;
"RTN","BIREPT4",72,0)
 ;---> Quit if Current Community doesn't match.
"RTN","BIREPT4",73,0)
 Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BIREPT4",74,0)
 ;
"RTN","BIREPT4",75,0)
 ;---> Quit if Case Manager doesn't match.
"RTN","BIREPT4",76,0)
 Q:$$CMGR^BIDUR(BIDFN,.BICM)
"RTN","BIREPT4",77,0)
 ;
"RTN","BIREPT4",78,0)
 ;---> Quit if Beneficiary Type doesn't match.
"RTN","BIREPT4",79,0)
 Q:$$BENT^BIDUR1(BIDFN,.BIBEN)
"RTN","BIREPT4",80,0)
 ;
"RTN","BIREPT4",81,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPT4",82,0)
 N Z S Z=$G(BITMP("STATS","TOTLPTS")) S BITMP("STATS","TOTLPTS")=Z+1
"RTN","BIREPT4",83,0)
 ;---> Store for Patient Report Roster (not yet determined if complete 43133).
"RTN","BIREPT4",84,0)
 S BIVAL=1
"RTN","BIREPT4",85,0)
 ;
"RTN","BIREPT4",86,0)
 ;---> RPC to gather Immunization History.
"RTN","BIREPT4",87,0)
 N BI31,BIDE,BIRETVAL,BIRETERR,I S BI31=$C(31)_$C(31),BIRETVAL=""
"RTN","BIREPT4",88,0)
 ;---> 30=Vaccine IEN, 55=Vaccine Group IEN, 56=Date of Visit(Fileman),
"RTN","BIREPT4",89,0)
 ;---> 65=Invalid Dose (1-4).
"RTN","BIREPT4",90,0)
 F I=30,55,56,65 S BIDE(I)=""
"RTN","BIREPT4",91,0)
 ;---> Fourth parameter=0: Do not return Skin Tests.
"RTN","BIREPT4",92,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,0,0)
"RTN","BIREPT4",93,0)
 ;
"RTN","BIREPT4",94,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BIREPT4",95,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BIREPT4",96,0)
 Q:BIRETERR]""
"RTN","BIREPT4",97,0)
 ;
"RTN","BIREPT4",98,0)
 ;---> Add refusals, if any.
"RTN","BIREPT4",99,0)
 N Z D CONTRA^BIUTL11(BIDFN,.Z,1) I $O(Z(0)) S BITMP("REFUSALS",BIDFN)=""
"RTN","BIREPT4",100,0)
 ;
"RTN","BIREPT4",101,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPT4",102,0)
 ;---> Check for Hx of Chicken Pox (as a reason for contra to Var & MMRV.)
"RTN","BIREPT4",103,0)
 ;---> If HX of Chicken Pox to add to Hx of Chickenpox line and count as
"RTN","BIREPT4",104,0)
 ;---> Varicella Combo Stats Lines.
"RTN","BIREPT4",105,0)
 N BICHXDT,BIHXX,Z
"RTN","BIREPT4",106,0)
 D CONTRA^BIUTL11(BIDFN,.Z,2,1) I (+$G(Z(21))=12)!(+$G(Z(94))=12) D
"RTN","BIREPT4",107,0)
 .N BICHXDT D
"RTN","BIREPT4",108,0)
 ..;---> Get the date of Chickenpox contraindication.
"RTN","BIREPT4",109,0)
 ..I $D(Z(21)) S BICHXDT=$P(Z(21),U,2) Q
"RTN","BIREPT4",110,0)
 ..I $D(Z(21)) S BICHXDT=$P(Z(94),U,2)
"RTN","BIREPT4",111,0)
 .Q:'BICHXDT
"RTN","BIREPT4",112,0)
 .;
"RTN","BIREPT4",113,0)
 .N BIAGE,J,K S J=1
"RTN","BIREPT4",114,0)
 .F K=1:1 S BIAGE=$P(BIAGRPS,",",K) Q:'BIAGE  D
"RTN","BIREPT4",115,0)
 ..D:J PASTMTH^BIAGE(BICHXDT,BIAGE,.BIDATE)
"RTN","BIREPT4",116,0)
 ..Q:BIDATE>BIDOB
"RTN","BIREPT4",117,0)
 ..;---> Patient received imm by BIAGE months, set in stats array.
"RTN","BIREPT4",118,0)
 ..N Z S Z=$G(BITMP("STATS",132,1,BIAGE)) S BITMP("STATS",132,1,BIAGE)=Z+1
"RTN","BIREPT4",119,0)
 ..S J=0
"RTN","BIREPT4",120,0)
 ..;---> Also set for combo lines.
"RTN","BIREPT4",121,0)
 ..S BIHXX(132,1,BIAGE)=""
"RTN","BIREPT4",122,0)
 ;**********
"RTN","BIREPT4",123,0)
 ;
"RTN","BIREPT4",124,0)
 ;---> Set BIHX=to a valid Immunization History.
"RTN","BIREPT4",125,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BIREPT4",126,0)
 ;
"RTN","BIREPT4",127,0)
 ;---> *** Okay, add this Patient's History to stats.
"RTN","BIREPT4",128,0)
 ;
"RTN","BIREPT4",129,0)
 ;---> BIHIB local array by date gets built; if the first two were CVX 49's (IEN=127)
"RTN","BIREPT4",130,0)
 ;---> then patient will only need 3 Hibs to be UTD.
"RTN","BIREPT4",131,0)
 N BIHIB,BIROT,I,Y
"RTN","BIREPT4",132,0)
 ;
"RTN","BIREPT4",133,0)
 ;---> BIROT gets set=1 if there were 2 CVX 119's (IEN=225)--patient is UTD for Rota.
"RTN","BIREPT4",134,0)
 S BIROT=0
"RTN","BIREPT4",135,0)
 ;
"RTN","BIREPT4",136,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BIREPT4",137,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BIREPT4",138,0)
 .;
"RTN","BIREPT4",139,0)
 .;---> BIIEN=Vaccine IEN, BIVGRP=Vaccine Group, BIVDAT=Visit Date, BINVLD=Invalid Code.
"RTN","BIREPT4",140,0)
 .N BIAGE,BIDOSE,BIIEN,BINVLD,BIVDAT,BIVGRP,Q
"RTN","BIREPT4",141,0)
 .S BIIEN=$P(Y,"|",2),BIVGRP=$P(Y,"|",3),BIVDAT=$P(Y,"|",4),BINVLD=$P(Y,"|",5)
"RTN","BIREPT4",142,0)
 .;
"RTN","BIREPT4",143,0)
 .;---> Quit if not Vaccine Group or Visit Date.
"RTN","BIREPT4",144,0)
 .Q:'$G(BIVGRP)  Q:'$G(BIVDAT)
"RTN","BIREPT4",145,0)
 .;
"RTN","BIREPT4",146,0)
 .;---> Quit if this dose has been overrided as Invalid (1-4).
"RTN","BIREPT4",147,0)
 .Q:(1234[+BINVLD)
"RTN","BIREPT4",148,0)
 .;
"RTN","BIREPT4",149,0)
 .;---> Quit if this imm was given after the Quarter Ending Date.
"RTN","BIREPT4",150,0)
 .;---> NOTE: This will cause some patients to appear in the "NOT Current"
"RTN","BIREPT4",151,0)
 .;---> group, even if they got caught up to date later.
"RTN","BIREPT4",152,0)
 .Q:(BIVDAT>BIQDT)
"RTN","BIREPT4",153,0)
 .;
"RTN","BIREPT4",154,0)
 .;---> Quit if this Vaccine Group should not be included.
"RTN","BIREPT4",155,0)
 .Q:'($$VGROUP^BIUTL2(BIVGRP,8))
"RTN","BIREPT4",156,0)
 .;
"RTN","BIREPT4",157,0)
 .;---> Set BIDOSE=Dose# (increment by 1's to assign highest/latest dose#)
"RTN","BIREPT4",158,0)
 .S BIDOSE=1,Q=0
"RTN","BIREPT4",159,0)
 .F  Q:Q  D
"RTN","BIREPT4",160,0)
 ..I $D(BIHX(BIVGRP,BIDOSE)) S BIDOSE=BIDOSE+1 Q
"RTN","BIREPT4",161,0)
 ..S BIHX(BIVGRP,BIDOSE)="",Q=1
"RTN","BIREPT4",162,0)
 .;
"RTN","BIREPT4",163,0)
 .;
"RTN","BIREPT4",164,0)
 .;---> If this was a Hib, store it in local array for UTD eval.
"RTN","BIREPT4",165,0)
 .I BIVGRP=3 S BIHIB(BIVDAT,BIIEN)=""
"RTN","BIREPT4",166,0)
 .;
"RTN","BIREPT4",167,0)
 .;---> If this was a Rotarix, increment its counter.
"RTN","BIREPT4",168,0)
 .S:BIIEN=225 BIROT=BIROT+1
"RTN","BIREPT4",169,0)
 .;
"RTN","BIREPT4",170,0)
 .;---> Set this immunization in the STATS array for each Age (A)
"RTN","BIREPT4",171,0)
 .;---> by which the patient had already received it (cumulative).
"RTN","BIREPT4",172,0)
 .N J,K S J=1
"RTN","BIREPT4",173,0)
 .F K=1:1 S BIAGE=$P(BIAGRPS,",",K) Q:'BIAGE  D
"RTN","BIREPT4",174,0)
 ..;---> If patient received imm by BIAGE months on the previous iteration
"RTN","BIREPT4",175,0)
 ..;---> of this loop (and J was set=0), then bypass call to PASTMTH
"RTN","BIREPT4",176,0)
 ..;---> and simply set it for the higher BIAGE values, cumulatively.
"RTN","BIREPT4",177,0)
 ..;---> (i.e., if patient received it by 3 months, then he also
"RTN","BIREPT4",178,0)
 ..;--->  necessarily received it by 5 months, 7 months, etc.)
"RTN","BIREPT4",179,0)
 ..D:J PASTMTH^BIAGE(BIVDAT,BIAGE,.BIDATE)
"RTN","BIREPT4",180,0)
 ..;
"RTN","BIREPT4",181,0)
 ..;---> Quit if BIAGE months prior to Visit Date is AFTER the DOB
"RTN","BIREPT4",182,0)
 ..;---> (means patient was OLDER than BIAGE months when he received
"RTN","BIREPT4",183,0)
 ..;---> the imm--did NOT receive the imm by BIAGE months).
"RTN","BIREPT4",184,0)
 ..Q:BIDATE>BIDOB
"RTN","BIREPT4",185,0)
 ..;
"RTN","BIREPT4",186,0)
 ..;---> Patient received imm by BIAGE months, set in stats array.
"RTN","BIREPT4",187,0)
 ..N Z S Z=$G(BITMP("STATS",BIVGRP,BIDOSE,BIAGE)) S BITMP("STATS",BIVGRP,BIDOSE,BIAGE)=Z+1
"RTN","BIREPT4",188,0)
 ..S J=0
"RTN","BIREPT4",189,0)
 ..S BIHX(BIVGRP,BIDOSE,BIAGE)=""
"RTN","BIREPT4",190,0)
 ;
"RTN","BIREPT4",191,0)
 ;
"RTN","BIREPT4",192,0)
 ;---> Now calculate whether this patient needs 3 Hibs or 4 Hibs to be UTD.
"RTN","BIREPT4",193,0)
 ;---> If first 2 Hibs=127 (CVX 49), then BIHIB2=2 and patient only needs 3 Hibs to be UTD.
"RTN","BIREPT4",194,0)
 N BIHIB2,I,N S BIHIB2=0,N=0
"RTN","BIREPT4",195,0)
 F I=1:1:2 S N=$O(BIHIB(N)) Q:'N  D
"RTN","BIREPT4",196,0)
 .I $O(BIHIB(N,0))=127 S BIHIB2=BIHIB2+1
"RTN","BIREPT4",197,0)
 ;
"RTN","BIREPT4",198,0)
 ;---> Now calculate vaccine combination stats.
"RTN","BIREPT4",199,0)
 ;---> NOTE: DO NOT GENERALIZE CODE BELOW (highly iterative).
"RTN","BIREPT4",200,0)
 ;---> Relies on the following Vaccine Group IEN's in ^BISERT:
"RTN","BIREPT4",201,0)
 ;---> DTP=1, OPV=2, HIB=3, HEPB=4, MMR=6, VAR=7, HEPA=9, FLU=10, PNE=11, ROT=15
"RTN","BIREPT4",202,0)
 ;
"RTN","BIREPT4",203,0)
 ;---> 1-DTP, 1-OPV, 1-HIB, 1-HEPB
"RTN","BIREPT4",204,0)
 N K
"RTN","BIREPT4",205,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",206,0)
 .;---> Matrix=Vaccine Group, Dose#, Age Group.
"RTN","BIREPT4",207,0)
 .Q:'$D(BIHX(1,1,A))
"RTN","BIREPT4",208,0)
 .Q:'$D(BIHX(2,1,A))
"RTN","BIREPT4",209,0)
 .Q:'$D(BIHX(3,1,A))
"RTN","BIREPT4",210,0)
 .Q:'$D(BIHX(4,1,A))
"RTN","BIREPT4",211,0)
 .D COMBO("1|1^2|1^3|1^4|1",A)
"RTN","BIREPT4",212,0)
 ;
"RTN","BIREPT4",213,0)
 ;---> 4-DTP, 3-OPV, 1-MMR
"RTN","BIREPT4",214,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",215,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",216,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",217,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",218,0)
 .D COMBO("1|4^2|3^6|1",A)
"RTN","BIREPT4",219,0)
 ;
"RTN","BIREPT4",220,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB
"RTN","BIREPT4",221,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",222,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",223,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",224,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",225,0)
 .;---> If you don't have 2 Hib 49's, then quit if you don't have 4 Hibs.
"RTN","BIREPT4",226,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",227,0)
 .;---> Okay, first 2 Hibs are 49's, quit if you don't have 3 Hibs.
"RTN","BIREPT4",228,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",229,0)
 .D COMBO("1|4^2|3^6|1^3|3",A)
"RTN","BIREPT4",230,0)
 ;
"RTN","BIREPT4",231,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB
"RTN","BIREPT4",232,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",233,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",234,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",235,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",236,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",237,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",238,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",239,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3",A)
"RTN","BIREPT4",240,0)
 ;
"RTN","BIREPT4",241,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB, 1-VAR
"RTN","BIREPT4",242,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",243,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",244,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",245,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",246,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",247,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",248,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",249,0)
 .;
"RTN","BIREPT4",250,0)
 .;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIREPT4",251,0)
 .;---> Allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",252,0)
 .;Q:'$D(BIHX(7,1,A))
"RTN","BIREPT4",253,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPT4",254,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3^7|1",A)
"RTN","BIREPT4",255,0)
 ;
"RTN","BIREPT4",256,0)
 ;
"RTN","BIREPT4",257,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB, 1-VAR, 3-PNE
"RTN","BIREPT4",258,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",259,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",260,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",261,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",262,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",263,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",264,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",265,0)
 .;---> Allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",266,0)
 .;Q:'$D(BIHX(7,1,A))
"RTN","BIREPT4",267,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPT4",268,0)
 .Q:'$D(BIHX(11,3,A))
"RTN","BIREPT4",269,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3^7|1^11|3",A)
"RTN","BIREPT4",270,0)
 ;
"RTN","BIREPT4",271,0)
 ;
"RTN","BIREPT4",272,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB, 1-VAR, 4-PNE  vvv83
"RTN","BIREPT4",273,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",274,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",275,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",276,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",277,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",278,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",279,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",280,0)
 .;---> Allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",281,0)
 .;Q:'$D(BIHX(7,1,A))
"RTN","BIREPT4",282,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPT4",283,0)
 .Q:'$D(BIHX(11,4,A))
"RTN","BIREPT4",284,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3^7|1^11|4",A)
"RTN","BIREPT4",285,0)
 .;---> Store for Patient Report Roster (complete 4313314).
"RTN","BIREPT4",286,0)
 .S BIVAL=2
"RTN","BIREPT4",287,0)
 ;
"RTN","BIREPT4",288,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB, 1-VAR, 4-PNE, 1-HEPA
"RTN","BIREPT4",289,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",290,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",291,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",292,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",293,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",294,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",295,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",296,0)
 .;---> Allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",297,0)
 .;Q:'$D(BIHX(7,1,A))
"RTN","BIREPT4",298,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPT4",299,0)
 .Q:'$D(BIHX(11,4,A))
"RTN","BIREPT4",300,0)
 .Q:'$D(BIHX(9,1,A))
"RTN","BIREPT4",301,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3^7|1^11|4^9|1",A)
"RTN","BIREPT4",302,0)
 ;
"RTN","BIREPT4",303,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB, 1-VAR, 4-PNE, 2-HEPA, 3-ROTA  vvv83
"RTN","BIREPT4",304,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",305,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",306,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",307,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",308,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",309,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",310,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",311,0)
 .;---> Allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",312,0)
 .;Q:'$D(BIHX(7,1,A))
"RTN","BIREPT4",313,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPT4",314,0)
 .Q:'$D(BIHX(11,4,A))
"RTN","BIREPT4",315,0)
 .Q:'$D(BIHX(9,2,A))
"RTN","BIREPT4",316,0)
 .;Q:'$D(BIHX(15,3,A))
"RTN","BIREPT4",317,0)
 .;---> If you don't have 2 Rota 119's, then quit if you don't have 3 Rotas.
"RTN","BIREPT4",318,0)
 .I BIROT<2 Q:'$D(BIHX(15,3,A))
"RTN","BIREPT4",319,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3^7|1^11|4^9|2^15|3",A)
"RTN","BIREPT4",320,0)
 ;
"RTN","BIREPT4",321,0)
 ;---> 4-DTP, 3-OPV, 1-MMR, 3-HIB, 3-HEPB, 1-VAR, 4-PNE, 2-HEPA, 3-ROTA, 2-FLU  vvv83
"RTN","BIREPT4",322,0)
 F K=1:1 S A=$P(BIAGRPS,",",K) Q:'A  D
"RTN","BIREPT4",323,0)
 .Q:'$D(BIHX(1,4,A))
"RTN","BIREPT4",324,0)
 .Q:'$D(BIHX(2,3,A))
"RTN","BIREPT4",325,0)
 .Q:'$D(BIHX(6,1,A))
"RTN","BIREPT4",326,0)
 .I BIHIB2<2 Q:'$D(BIHX(3,4,A))
"RTN","BIREPT4",327,0)
 .Q:'$D(BIHX(3,3,A))
"RTN","BIREPT4",328,0)
 .Q:'$D(BIHX(4,3,A))
"RTN","BIREPT4",329,0)
 .;---> Allow Hx of Chickenpox to count for Varicella.
"RTN","BIREPT4",330,0)
 .;Q:'$D(BIHX(7,1,A))
"RTN","BIREPT4",331,0)
 .Q:(('$D(BIHX(7,1,A)))&('$D(BIHXX(132,1,A))))
"RTN","BIREPT4",332,0)
 .;**********
"RTN","BIREPT4",333,0)
 .Q:'$D(BIHX(11,4,A))
"RTN","BIREPT4",334,0)
 .Q:'$D(BIHX(9,2,A))
"RTN","BIREPT4",335,0)
 .;Q:'$D(BIHX(15,3,A))
"RTN","BIREPT4",336,0)
 .I BIROT<2 Q:'$D(BIHX(15,3,A))
"RTN","BIREPT4",337,0)
 .Q:'$D(BIHX(10,2,A))
"RTN","BIREPT4",338,0)
 .D COMBO("1|4^2|3^6|1^3|3^4|3^7|1^11|4^9|2^15|3^10|2",A)
"RTN","BIREPT4",339,0)
 ;
"RTN","BIREPT4",340,0)
 ;---> Re-evaluate Current vs. Non-current based on Hib and Rota regimens.
"RTN","BIREPT4",341,0)
 ;---> If BIVAL=1,
"RTN","BIREPT4",342,0)
 Q:BIVAL=1
"RTN","BIREPT4",343,0)
 ;
"RTN","BIREPT4",344,0)
 Q
"RTN","BIREPT4",345,0)
 ;
"RTN","BIREPT4",346,0)
 ;
"RTN","BIREPT4",347,0)
 ;----------
"RTN","BIREPT4",348,0)
COMBO(BICOMB,BIAGRP) ;EP
"RTN","BIREPT4",349,0)
 ;---> Store Patient vaccine combination for Age Group.
"RTN","BIREPT4",350,0)
 ;---> Parameters:
"RTN","BIREPT4",351,0)
 ;     1 - BICOMB (req) Combination number.
"RTN","BIREPT4",352,0)
 ;     1 - BIAGRP (req) Node/number for this Age Group.
"RTN","BIREPT4",353,0)
 ;
"RTN","BIREPT4",354,0)
 ;---> Store Patient in Age Group.
"RTN","BIREPT4",355,0)
 N Z S Z=$G(BITMP("STATS",BICOMB,BIAGRP))
"RTN","BIREPT4",356,0)
 S BITMP("STATS",BICOMB,BIAGRP)=Z+1
"RTN","BIREPT4",357,0)
 Q
"RTN","BIREPVP")
0^127^B29949628
"RTN","BIREPVP",1,0)
BIREPVP ;IHS/CMI/MWR - REPORT, VIEW PATIENTS IN REPORT.; MAY 10, 2010
"RTN","BIREPVP",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIREPVP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIREPVP",4,0)
 ;;  REPORTS, VIEW LIST OF PATIENTS IN REPORT: REJECTED, APPROPRIATE, OR ALL.
"RTN","BIREPVP",5,0)
 ;
"RTN","BIREPVP",6,0)
 ;---> Called by Protocols BI REPORT GEN PATIENTS - NOT APPRO, - APPRO,
"RTN","BIREPVP",7,0)
 ;---> and - ALL, on the Protocol Menu BI MENU REPORT GEN PATIENTS VIEW.
"RTN","BIREPVP",8,0)
 ;---> Assumption is that a list of patients is sitting out in ^TMP("BIDUL",$J.
"RTN","BIREPVP",9,0)
 ;
"RTN","BIREPVP",10,0)
 ;----------
"RTN","BIREPVP",11,0)
MAIN(BIPG1,BIRTN,BITITL,BIRPDT,BIPG2) ;
"RTN","BIREPVP",12,0)
 ;W !,"JUST CALLED BIREPVP, PASSED BIRTN: ",BIRTN R ZZZ
"RTN","BIREPVP",13,0)
 ;---> Display Patients.
"RTN","BIREPVP",14,0)
 ;---> Parameters:
"RTN","BIREPVP",15,0)
 ;     1 - BIPG1  (opt) Patient Group: 0=All, 1=Due only, 2=Appropriate only.
"RTN","BIREPVP",16,0)
 ;     2 - BIRTN  (req) Routine to make Init call when returning.
"RTN","BIREPVP",17,0)
 ;     3 - BITITL (opt) Report Name
"RTN","BIREPVP",18,0)
 ;     4 - BIRPDT (opt) Report Date: Today unless passed from reports
"RTN","BIREPVP",19,0)
 ;                                   (e.g., Quarterly Report).
"RTN","BIREPVP",20,0)
 ;     5 - BIPG2  (opt) Patient Group: Text for Patient Group report header.
"RTN","BIREPVP",21,0)
 ;                                     If it follows null, overrides BIPG1.
"RTN","BIREPVP",22,0)
 ;
"RTN","BIREPVP",23,0)
 ;---> If <STKOV> errors appear here, increase STACK in SYSGEN,
"RTN","BIREPVP",24,0)
 ;---> System Configuration Parameters.
"RTN","BIREPVP",25,0)
 ;
"RTN","BIREPVP",26,0)
 S:(($G(BIPG1)<1)!($G(BIPG1)>2)) BIPG1=0
"RTN","BIREPVP",27,0)
 S BITITL=$S($G(BITITL)]"":BITITL_" ",1:"")
"RTN","BIREPVP",28,0)
 S:'$G(BIRPDT) BIRPDT=DT
"RTN","BIREPVP",29,0)
 ;
"RTN","BIREPVP",30,0)
 D
"RTN","BIREPVP",31,0)
 .N BIAGRPS,BIBEGDT,BIBEN,BICC,BICM,BICPT,BICPTI,BIDAR,BIENDDT,BIFDT,BIFH,BIHCF
"RTN","BIREPVP",32,0)
 .N BIHPV,BILOT,BIMD
"RTN","BIREPVP",33,0)
 .N BIMMD,BIMMR,BINFO,BINFO1,BIORD,BIPG,BIQDT,BIRTN,BISITE,BIT,BITAR,BITOTFPT
"RTN","BIREPVP",34,0)
 .N BITOTMPT,BITOTPTS,BIUP,BIYEAR
"RTN","BIREPVP",35,0)
 .D START(BIPG1,BITITL,BIRPDT,$G(BIPG2))
"RTN","BIREPVP",36,0)
 ;
"RTN","BIREPVP",37,0)
 Q:$G(BIRTN)=""
"RTN","BIREPVP",38,0)
 D TITLE^BIUTL5("RETURNING TO THE "_BITITL_"REPORT"),TEXT4
"RTN","BIREPVP",39,0)
 N DIR S DIR("A")="     Update Report now (Yes/No)",DIR(0)="Y",DIR("B")="NO"
"RTN","BIREPVP",40,0)
 S DIR("?")="       Enter YES to update the report, enter NO to save time."
"RTN","BIREPVP",41,0)
 D ^DIR W !
"RTN","BIREPVP",42,0)
 Q:$D(DIRUT)!('Y)
"RTN","BIREPVP",43,0)
 D @("INIT^"_BIRTN)
"RTN","BIREPVP",44,0)
 Q
"RTN","BIREPVP",45,0)
 ;
"RTN","BIREPVP",46,0)
 ;
"RTN","BIREPVP",47,0)
 ;----------
"RTN","BIREPVP",48,0)
START(BIPG1,BITITL,BIRPDT,BIPG2) ;EP
"RTN","BIREPVP",49,0)
 ;---> Display Patients.
"RTN","BIREPVP",50,0)
 ;---> Parameters:
"RTN","BIREPVP",51,0)
 ;     1 - BIPG1  (opt) Patient Group: 0=All, 1=Due only, 2=Appropriate only.
"RTN","BIREPVP",52,0)
 ;     2 - BITITL (opt) Report Name
"RTN","BIREPVP",53,0)
 ;     3 - BIRPDT (opt) Report Date: Today unless passed from reports
"RTN","BIREPVP",54,0)
 ;                                   (e.g., Quarterly Report).
"RTN","BIREPVP",55,0)
 ;     4 - BIPG2  (opt) Patient Group: Text for Patient Group report header.
"RTN","BIREPVP",56,0)
 ;                                     If it follows null, overrides BIPG1.
"RTN","BIREPVP",57,0)
 ;
"RTN","BIREPVP",58,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIREPVP",59,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIREPVP",60,0)
 D SETVARS^BIUTL5
"RTN","BIREPVP",61,0)
 ;
"RTN","BIREPVP",62,0)
 N BIPOP
"RTN","BIREPVP",63,0)
 D  D DIRZ^BIUTL3(.BIPOP)
"RTN","BIREPVP",64,0)
 .I $G(BIPG1)=1 D  Q
"RTN","BIREPVP",65,0)
 ..D TITLE^BIUTL5("VIEW PATIENTS NOT CURRENT IN "_BITITL_"REPORT"),TEXT1 Q
"RTN","BIREPVP",66,0)
 .I $G(BIPG1)=2 D  Q
"RTN","BIREPVP",67,0)
 ..D TITLE^BIUTL5("VIEW PATIENTS CURRENT IN "_BITITL_"REPORT"),TEXT2
"RTN","BIREPVP",68,0)
 .D TITLE^BIUTL5("VIEW ALL PATIENTS REVIEWED IN "_BITITL_"REPORT"),TEXT3 Q
"RTN","BIREPVP",69,0)
 Q:$G(BIPOP)
"RTN","BIREPVP",70,0)
 W !!?5,"Please hold...",!
"RTN","BIREPVP",71,0)
 ;
"RTN","BIREPVP",72,0)
 ;---> Get Total Patients from ^TMP("BIDUL",$J,CURCOM,1,HRCN,BIDFN)
"RTN","BIREPVP",73,0)
 ;---> Seed loops with -1 to pick up entries with a subscript of 0. Imm v8.5.
"RTN","BIREPVP",74,0)
 N BIT S BIT=0
"RTN","BIREPVP",75,0)
 D
"RTN","BIREPVP",76,0)
 .N BIDFN,N,M,P
"RTN","BIREPVP",77,0)
 .S N=-1
"RTN","BIREPVP",78,0)
 .F  S N=$O(^TMP("BIDUL",$J,N)) Q:N=""  D
"RTN","BIREPVP",79,0)
 ..S M=-1
"RTN","BIREPVP",80,0)
 ..F  S M=$O(^TMP("BIDUL",$J,N,M)) Q:M=""  D
"RTN","BIREPVP",81,0)
 ...S P=-1
"RTN","BIREPVP",82,0)
 ...F  S P=$O(^TMP("BIDUL",$J,N,M,P)) Q:P=""  D
"RTN","BIREPVP",83,0)
 ....N BIPG11
"RTN","BIREPVP",84,0)
 ....S BIDFN=0
"RTN","BIREPVP",85,0)
 ....F  S BIDFN=$O(^TMP("BIDUL",$J,N,M,P,BIDFN)) Q:'BIDFN  S BIPG11=^(BIDFN) D
"RTN","BIREPVP",86,0)
 .....;---> BIPG1=0=All (no filter), 1=Not Appro, 2=Appropriate.
"RTN","BIREPVP",87,0)
 .....I $G(BIPG1) Q:BIPG1'=BIPG11
"RTN","BIREPVP",88,0)
 .....S BIT=BIT+1
"RTN","BIREPVP",89,0)
 ;
"RTN","BIREPVP",90,0)
 ;---> For now, comment out any additional info, per Group's request v8.0.
"RTN","BIREPVP",91,0)
 ;N BINFO S BINFO="1,2,3,5,7,8"
"RTN","BIREPVP",92,0)
 N BIPG D
"RTN","BIREPVP",93,0)
 .I BIPG2]"" S BIPG=BIPG2 Q
"RTN","BIREPVP",94,0)
 .S BIPG="Report - "_$S(BIPG1=1:"Not Current",BIPG1=2:"Current",1:"Both Groups")
"RTN","BIREPVP",95,0)
 ;---> Second piece of Age: 0 or null=months, 1=years.
"RTN","BIREPVP",96,0)
 K ^TMP("BIDULV",$J)
"RTN","BIREPVP",97,0)
 D START^BIDUVLS1(+$G(DT),,BIPG,$G(BIAG),BIT,BIPG1,1,BITITL,BIRPDT)
"RTN","BIREPVP",98,0)
 Q
"RTN","BIREPVP",99,0)
 ;
"RTN","BIREPVP",100,0)
 ;
"RTN","BIREPVP",101,0)
 ;----------
"RTN","BIREPVP",102,0)
TEXT1 ;EP
"RTN","BIREPVP",103,0)
 ;;This action will display a List of the patients who were NOT within
"RTN","BIREPVP",104,0)
 ;;the recommended guidelines for immunizations for their age.
"RTN","BIREPVP",105,0)
 ;;
"RTN","BIREPVP",106,0)
 D PRINTX("TEXT1")
"RTN","BIREPVP",107,0)
 Q
"RTN","BIREPVP",108,0)
 ;
"RTN","BIREPVP",109,0)
 ;
"RTN","BIREPVP",110,0)
 ;----------
"RTN","BIREPVP",111,0)
TEXT2 ;EP
"RTN","BIREPVP",112,0)
 ;;This action will display a List of the patients who were WITHIN
"RTN","BIREPVP",113,0)
 ;;the recommended guidelines for immunizations for their age.
"RTN","BIREPVP",114,0)
 ;;
"RTN","BIREPVP",115,0)
 ;;
"RTN","BIREPVP",116,0)
 D PRINTX("TEXT2")
"RTN","BIREPVP",117,0)
 Q
"RTN","BIREPVP",118,0)
 ;
"RTN","BIREPVP",119,0)
 ;
"RTN","BIREPVP",120,0)
 ;----------
"RTN","BIREPVP",121,0)
TEXT3 ;EP
"RTN","BIREPVP",122,0)
 ;;This action will display a list of ALL the patients who were
"RTN","BIREPVP",123,0)
 ;;considered in this report.
"RTN","BIREPVP",124,0)
 ;;
"RTN","BIREPVP",125,0)
 ;;
"RTN","BIREPVP",126,0)
 D PRINTX("TEXT3")
"RTN","BIREPVP",127,0)
 Q
"RTN","BIREPVP",128,0)
 ;
"RTN","BIREPVP",129,0)
 ;
"RTN","BIREPVP",130,0)
 ;----------
"RTN","BIREPVP",131,0)
TEXT4 ;EP
"RTN","BIREPVP",132,0)
 ;;You are about to return to the report that included these patients.
"RTN","BIREPVP",133,0)
 ;;If you made changes to the patient you were just viewing, it is possible
"RTN","BIREPVP",134,0)
 ;;that the changes have affected the report.
"RTN","BIREPVP",135,0)
 ;;
"RTN","BIREPVP",136,0)
 ;;At this point you have two options:
"RTN","BIREPVP",137,0)
 ;;
"RTN","BIREPVP",138,0)
 ;;  1) You may re-run the report to reflect any updated information you
"RTN","BIREPVP",139,0)
 ;;     have entered.  HOWEVER, be aware that re-running the report may take
"RTN","BIREPVP",140,0)
 ;;     considerable time, depending on the amount of data in your database.
"RTN","BIREPVP",141,0)
 ;;
"RTN","BIREPVP",142,0)
 ;;  2) You may return to the report and select other patients, without
"RTN","BIREPVP",143,0)
 ;;     taking time to update the report immediately.  This would save time,
"RTN","BIREPVP",144,0)
 ;;     allowing you to continue working with a series of patients more
"RTN","BIREPVP",145,0)
 ;;     efficiently and updating the report only when you're done.
"RTN","BIREPVP",146,0)
 ;;
"RTN","BIREPVP",147,0)
 ;;Do you wish to update the report now, before returning to it?
"RTN","BIREPVP",148,0)
 ;;
"RTN","BIREPVP",149,0)
 D PRINTX("TEXT4")
"RTN","BIREPVP",150,0)
 Q
"RTN","BIREPVP",151,0)
 ;
"RTN","BIREPVP",152,0)
 ;
"RTN","BIREPVP",153,0)
 ;----------
"RTN","BIREPVP",154,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIREPVP",155,0)
 Q:$G(BILINL)=""
"RTN","BIREPVP",156,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIREPVP",157,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIREPVP",158,0)
 Q
"RTN","BIRESTD")
0^128^B19219313
"RTN","BIRESTD",1,0)
BIRESTD ;IHS/CMI/MWR - CHECK AND RESTANDARDIZE VACCINE TABLE.; MAY 10, 2010
"RTN","BIRESTD",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIRESTD",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRESTD",4,0)
 ;;  CHECK IMMUNIZATION (VACCINE) TABLE AGAINST HL7 STANDARD;
"RTN","BIRESTD",5,0)
 ;;  RESTANDARDIZE IF NECESSARY.
"RTN","BIRESTD",6,0)
 ;
"RTN","BIRESTD",7,0)
 ;----------
"RTN","BIRESTD",8,0)
CHKSTAND(BIERROR) ;EP
"RTN","BIRESTD",9,0)
 ;---> Check the Vaccine Table (IMMUNIZATION File #9999999.14)
"RTN","BIRESTD",10,0)
 ;---> against the HL7 Standard Table (BI IMMUNIZATION TABLE
"RTN","BIRESTD",11,0)
 ;---> HL7 STANDARD File #9002084.94), each entry, piece by piece.
"RTN","BIRESTD",12,0)
 ;---> If there is an error, return the Error Text and set ^BISITE(-1)
"RTN","BIRESTD",13,0)
 ;---> to act as a flag for other calls.
"RTN","BIRESTD",14,0)
 ;---> Parameters:
"RTN","BIRESTD",15,0)
 ;     1 - BIERROR (ret) BIERROR=Text.
"RTN","BIRESTD",16,0)
 ;
"RTN","BIRESTD",17,0)
 ; VEN/SMH: Most of this doesn't apply to VISTA as ^AUTTIMM is Standardized and
"RTN","BIRESTD",18,0)
 ;          not allowed to be changed. So we will not run this at all here.
"RTN","BIRESTD",19,0)
 ;
"RTN","BIRESTD",20,0)
 I '$$RPMS^BIUTL9() K ^BISITE(-1) QUIT  ; quit if we are on VISTA (and say a ok)
"RTN","BIRESTD",21,0)
 ;
"RTN","BIRESTD",22,0)
 S BIERROR=""
"RTN","BIRESTD",23,0)
 ;
"RTN","BIRESTD",24,0)
 ;---> If Vaccine globals do not exist, return Error Text and quit.
"RTN","BIRESTD",25,0)
 I '$D(^AUTTIMM(0))!('$D(^BITN(0))) D  Q
"RTN","BIRESTD",26,0)
 .D ERRCD^BIUTL2(505,.BIERROR) S ^BISITE(-1)=""
"RTN","BIRESTD",27,0)
 ;
"RTN","BIRESTD",28,0)
 ;---> If there are any non-standard entries in the Vaccine Table,
"RTN","BIRESTD",29,0)
 ;---> return Error Text, set ^BISITE(-1), and quit.
"RTN","BIRESTD",30,0)
 N N S N=0
"RTN","BIRESTD",31,0)
 F  S N=$O(^AUTTIMM(N)) Q:'N  D  Q:BIERROR]""
"RTN","BIRESTD",32,0)
 .I '$D(^BITN(N,0)) D ERRCD^BIUTL2(508,.BIERROR)
"RTN","BIRESTD",33,0)
 I BIERROR]"" S ^BISITE(-1)="" Q
"RTN","BIRESTD",34,0)
 ;---> NOTE: If ^AUTTIMM(0) does not exist, set it ="IMMUNIZATION^9999999.14I"
"RTN","BIRESTD",35,0)
 ;--->       then restandardize.
"RTN","BIRESTD",36,0)
 ;--->       Likewise, ^BITN(0)="BI IMMUNIZATION TABLE HL7 STANDARD^9002084.94"
"RTN","BIRESTD",37,0)
 ;
"RTN","BIRESTD",38,0)
 ;---> Now check every Standard piece of the Vaccine Table.
"RTN","BIRESTD",39,0)
 ;---> If any Standard piece of data of a Vaccine is non-standard,
"RTN","BIRESTD",40,0)
 ;---> return Error Text, set ^BISITE(-1), and quit.
"RTN","BIRESTD",41,0)
 S N=0
"RTN","BIRESTD",42,0)
 F  S N=$O(^BITN(N)) Q:'N  D  Q:BIERROR]""
"RTN","BIRESTD",43,0)
 .I '$D(^AUTTIMM(N,0)) D ERRCD^BIUTL2(503,.BIERROR) Q
"RTN","BIRESTD",44,0)
 .;---> The following fields are copied below in COPYNEW, but are not checked
"RTN","BIRESTD",45,0)
 .;---> as part of the standard: 7-Active, 13-VIS Def, 16-Include in Forecast,
"RTN","BIRESTD",46,0)
 .;---> 18-Def Volume.
"RTN","BIRESTD",47,0)
 .N BIPC F BIPC=1,2,3,8,9,10,11,12,14,15,17,21:1:26 D
"RTN","BIRESTD",48,0)
 ..I $P(^AUTTIMM(N,0),U,BIPC)'=$P(^BITN(N,0),U,BIPC) D
"RTN","BIRESTD",49,0)
 ...D ERRCD^BIUTL2(503,.BIERROR)
"RTN","BIRESTD",50,0)
 I BIERROR]"" S ^BISITE(-1)="" Q
"RTN","BIRESTD",51,0)
 ;
"RTN","BIRESTD",52,0)
 ;---> Clear Non-standard flag.
"RTN","BIRESTD",53,0)
 K ^BISITE(-1)
"RTN","BIRESTD",54,0)
 Q
"RTN","BIRESTD",55,0)
 ;
"RTN","BIRESTD",56,0)
 ;
"RTN","BIRESTD",57,0)
 ;----------
"RTN","BIRESTD",58,0)
RESTAND(BIERROR,BIPRMPT) ;EP
"RTN","BIRESTD",59,0)
 ;---> Restandardize the Vaccine Table (IMMUNIZATION File #9999999.14)
"RTN","BIRESTD",60,0)
 ;---> by copying from the HL7 Standard Table (BI IMMUNIZATION TABLE
"RTN","BIRESTD",61,0)
 ;---> HL7 STANDARD File #9002084.94).
"RTN","BIRESTD",62,0)
 ;---> Parameters:
"RTN","BIRESTD",63,0)
 ;     1 - BIERROR (ret) BIERROR=Text (Translation Table is corrupt).
"RTN","BIRESTD",64,0)
 ;     2 - BIPRMPT (opt) If BIPRMPT=1 report "Complete".
"RTN","BIRESTD",65,0)
 ;
"RTN","BIRESTD",66,0)
 S:'$G(BIPRMPT) BIPRMPT=""
"RTN","BIRESTD",67,0)
 S BIERROR=""
"RTN","BIRESTD",68,0)
 I '$D(^AUTTIMM(0))!('$D(^BITN(0))) D  Q
"RTN","BIRESTD",69,0)
 .D ERRCD^BIUTL2(505,.BIERROR,1)
"RTN","BIRESTD",70,0)
 ;
"RTN","BIRESTD",71,0)
 ;---> First, rebuild ^BITN global.
"RTN","BIRESTD",72,0)
 D ^BITN
"RTN","BIRESTD",73,0)
 ;
"RTN","BIRESTD",74,0)
 ;---> Remove any non-standard entries in the Vaccine Table.
"RTN","BIRESTD",75,0)
 N N S N=0
"RTN","BIRESTD",76,0)
 F  S N=$O(^AUTTIMM(N)) Q:'N  D
"RTN","BIRESTD",77,0)
 .I '$D(^BITN(N,0)) K ^AUTTIMM(N)
"RTN","BIRESTD",78,0)
 ;
"RTN","BIRESTD",79,0)
 ;---> Copy every HL7 Standard Table piece to the Vaccine Table.
"RTN","BIRESTD",80,0)
 D COPYNEW(.BIERROR)
"RTN","BIRESTD",81,0)
 ;
"RTN","BIRESTD",82,0)
 ;---> RestandardizE the Vaccine Manufacturer Table.
"RTN","BIRESTD",83,0)
 Q:BIERROR
"RTN","BIRESTD",84,0)
 W:BIPRMPT>0 !!?5,"Restandardization of Vaccine Table complete."
"RTN","BIRESTD",85,0)
 D RESTDMAN(.BIERROR)
"RTN","BIRESTD",86,0)
 Q:BIERROR  D:BIPRMPT>0
"RTN","BIRESTD",87,0)
 .W !?5,"Restandardization of Manufacturer Table complete."
"RTN","BIRESTD",88,0)
 .D DIRZ^BIUTL3()
"RTN","BIRESTD",89,0)
 ;
"RTN","BIRESTD",90,0)
 ;---> Clear Non-standard flag.
"RTN","BIRESTD",91,0)
 K ^BISITE(-1)
"RTN","BIRESTD",92,0)
 Q
"RTN","BIRESTD",93,0)
 ;
"RTN","BIRESTD",94,0)
 ;
"RTN","BIRESTD",95,0)
 ;----------
"RTN","BIRESTD",96,0)
COPYNEW(BIPOP) ;EP
"RTN","BIRESTD",97,0)
 ;---> Copy New Standard to Vaccine Table (IMMUNIZATION File).
"RTN","BIRESTD",98,0)
 ;---> Parameters:
"RTN","BIRESTD",99,0)
 ;     1 - BIPOP (ret) BIPOP=1 if Translation Table is corrupt.
"RTN","BIRESTD",100,0)
 ;
"RTN","BIRESTD",101,0)
 S BIPOP=0
"RTN","BIRESTD",102,0)
 I '$O(^BITN(0)) D ERRCD^BIUTL2(505,,1) S BIPOP=1 Q
"RTN","BIRESTD",103,0)
 N BIN S BIN=0
"RTN","BIRESTD",104,0)
 F  S BIN=$O(^BITN(BIN)) Q:'BIN  Q:BIPOP  D
"RTN","BIRESTD",105,0)
 .I '$D(^BITN(BIN,0)) D ERRCD^BIUTL2(505,,1) S BIPOP=1 Q
"RTN","BIRESTD",106,0)
 .;
"RTN","BIRESTD",107,0)
 .;---> Copy HL7 Standard Table pieces to the Vaccine Table.
"RTN","BIRESTD",108,0)
 .;---> Imm v8.3: Remove .07 field, "ACTIVE"; (leave local site setting).  vvv83
"RTN","BIRESTD",109,0)
 .N BIPC F BIPC=1,2,3,8,9,10,11,12,13,14,15,16,17,18,21:1:26 D
"RTN","BIRESTD",110,0)
 ..S $P(^AUTTIMM(BIN,0),U,BIPC)=$P(^BITN(BIN,0),U,BIPC)
"RTN","BIRESTD",111,0)
 .;
"RTN","BIRESTD",112,0)
 .;---> Set Status, .07, if not already set (i.e., don't overwrite local settings).
"RTN","BIRESTD",113,0)
 .I $P(^AUTTIMM(BIN,0),U,7)="" S $P(^AUTTIMM(BIN,0),U,7)=$P(^BITN(BIN,0),U,7)
"RTN","BIRESTD",114,0)
 .;
"RTN","BIRESTD",115,0)
 .Q:'$D(^BITN(BIN,1))
"RTN","BIRESTD",116,0)
 .;---> Reset 1 node as well.  Include 1.15 - vvv83.
"RTN","BIRESTD",117,0)
 .F BIPC=1:1:15 S $P(^AUTTIMM(BIN,1),U,BIPC)=$P(^BITN(BIN,1),U,BIPC)
"RTN","BIRESTD",118,0)
 ;
"RTN","BIRESTD",119,0)
 ;---> Now re-index all indices on the file.
"RTN","BIRESTD",120,0)
 D REIND1
"RTN","BIRESTD",121,0)
 Q
"RTN","BIRESTD",122,0)
 ;
"RTN","BIRESTD",123,0)
 ;
"RTN","BIRESTD",124,0)
 ;----------
"RTN","BIRESTD",125,0)
REIND1 ;EP
"RTN","BIRESTD",126,0)
 ;---> Re-index IMMUNIZATION File, ^AUTTIMM(.
"RTN","BIRESTD",127,0)
 ;---> First, remove all previous Vaccine Table indices.
"RTN","BIRESTD",128,0)
 N BIN S BIN="A"
"RTN","BIRESTD",129,0)
 F  S BIN=$O(^AUTTIMM(BIN)) Q:BIN=""  K @("^AUTTIMM("""_BIN_""")")
"RTN","BIRESTD",130,0)
 ;
"RTN","BIRESTD",131,0)
 ;---> Now re-index table.
"RTN","BIRESTD",132,0)
 S BIN=0
"RTN","BIRESTD",133,0)
 F  S BIN=$O(^AUTTIMM(BIN)) Q:'BIN  D
"RTN","BIRESTD",134,0)
 .N DA,DIK S DA=BIN,DIK="^AUTTIMM("
"RTN","BIRESTD",135,0)
 .D IX1^DIK
"RTN","BIRESTD",136,0)
 Q
"RTN","BIRESTD",137,0)
 ;
"RTN","BIRESTD",138,0)
 ;
"RTN","BIRESTD",139,0)
 ;----------
"RTN","BIRESTD",140,0)
RESTDMAN(BIPOP) ;EP
"RTN","BIRESTD",141,0)
 ;---> Standardardize 100+ Entries in Manufacturer Table, ^AUTTIMAN.
"RTN","BIRESTD",142,0)
 ;---> Parameters:
"RTN","BIRESTD",143,0)
 ;     1 - BIPOP (ret) BIPOP=1 Error.
"RTN","BIRESTD",144,0)
 ;
"RTN","BIRESTD",145,0)
 S ^AUTTIMAN(0)="IMM MANUFACTURER^9999999.04I"
"RTN","BIRESTD",146,0)
 N N S N=99
"RTN","BIRESTD",147,0)
 F  S N=$O(^BIMAN(N)) Q:'N  D
"RTN","BIRESTD",148,0)
 .S ^AUTTIMAN(N,0)=^BIMAN(N,0)
"RTN","BIRESTD",149,0)
 D REIND2
"RTN","BIRESTD",150,0)
 ;
"RTN","BIRESTD",151,0)
 Q
"RTN","BIRESTD",152,0)
 ;
"RTN","BIRESTD",153,0)
 ;
"RTN","BIRESTD",154,0)
 ;----------
"RTN","BIRESTD",155,0)
REIND2 ;EP
"RTN","BIRESTD",156,0)
 ;---> Re-index IMM MANUFACTURER File, ^AUTTIMAN(.
"RTN","BIRESTD",157,0)
 ;---> First, remove all previous indices.
"RTN","BIRESTD",158,0)
 N BIN S BIN="A"
"RTN","BIRESTD",159,0)
 F  S BIN=$O(^AUTTIMAN(BIN)) Q:BIN=""  K @("^AUTTIMAN("""_BIN_""")")
"RTN","BIRESTD",160,0)
 ;
"RTN","BIRESTD",161,0)
 ;---> Now re-index table.
"RTN","BIRESTD",162,0)
 S BIN=0
"RTN","BIRESTD",163,0)
 F  S BIN=$O(^AUTTIMAN(BIN)) Q:'BIN  D
"RTN","BIRESTD",164,0)
 .N DA,DIK S DA=BIN,DIK="^AUTTIMAN("
"RTN","BIRESTD",165,0)
 .D IX1^DIK
"RTN","BIRESTD",166,0)
 Q
"RTN","BIRPC")
0^129^B39859102
"RTN","BIRPC",1,0)
BIRPC ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIRPC",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC",4,0)
 ;;  RETURNS IMMUNIZATION HISTORY, FORECAST, IMM/SERV PROFILE.
"RTN","BIRPC",5,0)
 ;;  PATCH 1: Add API: FORCALL, to allow queued update of all BI Patients.
"RTN","BIRPC",6,0)
 ;;  PATCH 3: Add NDC and Elig Codes, plus Date of Event to default Hx string. IMMHX+60
"RTN","BIRPC",7,0)
 ;;  PATCH 5: Add Admin Note to default Hx string. IMMHX+60
"RTN","BIRPC",8,0)
 ;;  PATCH 9: Add Date VIS Presented to Patient as piece 26.  IMMHX+65
"RTN","BIRPC",9,0)
 ;
"RTN","BIRPC",10,0)
 ;
"RTN","BIRPC",11,0)
 ;----------
"RTN","BIRPC",12,0)
IMMHX(BIHX,BIDFN,BIDE,BISKIN,BIFMT) ;PEP - Return Immunization History.
"RTN","BIRPC",13,0)
 ;---> Return Patient's Immunization History.
"RTN","BIRPC",14,0)
 ;---> Immunizations returned in one string, delimited by "^".
"RTN","BIRPC",15,0)
 ;---> Parameters:
"RTN","BIRPC",16,0)
 ;     1 - BIHX   (ret) String of patient's immunizations_||_Error.
"RTN","BIRPC",17,0)
 ;     2 - BIDFN  (req) DFN of patient.
"RTN","BIRPC",18,0)
 ;     3 - BIDE   (opt) Array of Data Elements to be returned:
"RTN","BIRPC",19,0)
 ;                      BIDE(IEN of Data Element).
"RTN","BIRPC",20,0)
 ;     4 - BISKIN (opt) =1 if Skin Tests should be included (DEFAULT);
"RTN","BIRPC",21,0)
 ;                      =0 if Skin Tests should NOT be included.
"RTN","BIRPC",22,0)
 ;     5 - BIFMT  (opt) Format: 0=ASCII Split, 1=ASCII, 3=IMM/SERVE
"RTN","BIRPC",23,0)
 ;                      "Split" means the components of a combination vaccine
"RTN","BIRPC",24,0)
 ;                      will be split out as if they were given individually.
"RTN","BIRPC",25,0)
 ;
"RTN","BIRPC",26,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC",27,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIRPC",28,0)
 S BIHX="",BIERR=""
"RTN","BIRPC",29,0)
 ;
"RTN","BIRPC",30,0)
 ;---> If DFN not provided, set Error Code and quit.
"RTN","BIRPC",31,0)
 ;I $G(BIDFN) D  Q  ;---> Use this line to test error handling.
"RTN","BIRPC",32,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC",33,0)
 .D ERRCD^BIUTL2(306,.BIERR) S BIHX=BI31_BIERR
"RTN","BIRPC",34,0)
 ;
"RTN","BIRPC",35,0)
 ;---> Set required variables, kill ^BITMP($J).
"RTN","BIRPC",36,0)
 D SETVARS^BIUTL5 K ^BITMP($J)
"RTN","BIRPC",37,0)
 ;
"RTN","BIRPC",38,0)
 ;---> Set the Patient TEMP global.
"RTN","BIRPC",39,0)
 S ^BITMP($J,1,BIDFN)=""
"RTN","BIRPC",40,0)
 ;
"RTN","BIRPC",41,0)
 ;---> If BIDE local array (Data Elements to be returned) is not
"RTN","BIRPC",42,0)
 ;---> passed, then set the following default Data Elements.
"RTN","BIRPC",43,0)
 ;---> The following are IEN's in ^BIEXPDD(.
"RTN","BIRPC",44,0)
 ;---> IEN PC  DATA
"RTN","BIRPC",45,0)
 ;---> --- --  ----
"RTN","BIRPC",46,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC",47,0)
 ;--->  4  2 = Vaccine Name, Short.
"RTN","BIRPC",48,0)
 ;--->  8  3 = Vaccine Component IEN'S.  ;v8.0
"RTN","BIRPC",49,0)
 ;---> 24  4 = IEN, V File Visit.
"RTN","BIRPC",50,0)
 ;---> 26  5 = Location (or Outside Location) where Imm was given.
"RTN","BIRPC",51,0)
 ;---> 27  6 = Vaccine Group (Series Type) for grouping of vaccines.
"RTN","BIRPC",52,0)
 ;---> 29  7 = Date of Visit (DD-Mmm-YYYY @HH:MM).
"RTN","BIRPC",53,0)
 ;---> 38  8 = Skin Test Result.
"RTN","BIRPC",54,0)
 ;---> 39  9 = Skin Test Reading.
"RTN","BIRPC",55,0)
 ;---> 40 10 = Skin Test date read.
"RTN","BIRPC",56,0)
 ;---> 41 11 = Skin Test Name.
"RTN","BIRPC",57,0)
 ;---> 42 12 = Skin Test Name IEN.
"RTN","BIRPC",58,0)
 ;---> 44 13 = Reaction to Immunization, text.
"RTN","BIRPC",59,0)
 ;---> 51 14 = Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIRPC",60,0)
 ;---> 61 15 = Encounter Provider.
"RTN","BIRPC",61,0)
 ;---> 65 16 = Dose Override.
"RTN","BIRPC",62,0)
 ;---> 66 17 = Date of Visit (MM/DD/YY).
"RTN","BIRPC",63,0)
 ;---> 69 18 = Vaccine Component CVX Code.
"RTN","BIRPC",64,0)
 ;---> 74 19 = CPT-Coded Visit.
"RTN","BIRPC",65,0)
 ;---> 78 20 = Imported from Outside Registry (if = 1).
"RTN","BIRPC",66,0)
 ;---> 80 21 = NDC Code pointer IEN.
"RTN","BIRPC",67,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC",68,0)
 ;---> Add NDC and Eligibility Codes, plus Date of Event to default Hx string.
"RTN","BIRPC",69,0)
 ;---> 82 22 = Elilgibility Code Text.
"RTN","BIRPC",70,0)
 ;---> 84 23 = NDC Code text.
"RTN","BIRPC",71,0)
 ;---> 85 24 = Date of Event/Administer shot (1201 field of V File) in MM/DD/YY
"RTN","BIRPC",72,0)
 ;
"RTN","BIRPC",73,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC",74,0)
 ;---> Add Admin Note to default Hx string.
"RTN","BIRPC",75,0)
 ;---> 87 25 = Administrative Note.
"RTN","BIRPC",76,0)
 ;
"RTN","BIRPC",77,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIRPC",78,0)
 ;---> Add Date VIS Presented to Patient (MM/DD/YY).
"RTN","BIRPC",79,0)
 ;---> 90 26 = Date VIS Presented to Patient.
"RTN","BIRPC",80,0)
 ;
"RTN","BIRPC",81,0)
 D:'$D(BIDE)
"RTN","BIRPC",82,0)
 .;N I F I=4,8,24,26,27,29,38,39,40,41,42,44,51,61,65,66,69,74,78,80,82,84,85,87 S BIDE(I)=""
"RTN","BIRPC",83,0)
 .N I F I=4,8,24,26,27,29,38,39,40,41,42,44,51,61,65,66,69,74,78,80,82,84,85,87,90 S BIDE(I)=""
"RTN","BIRPC",84,0)
 ;**********
"RTN","BIRPC",85,0)
 N BIMM S BIMM("ALL")=""
"RTN","BIRPC",86,0)
 ;
"RTN","BIRPC",87,0)
 ;---> Next, gather Immunization History for this patient.
"RTN","BIRPC",88,0)
 ;     1 - BIFMT  (req) Format: 0=ASCII Split, 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIRPC",89,0)
 ;     2 - BIDE   (req) Data Elements array (null if HL7)
"RTN","BIRPC",90,0)
 ;     3 - BIMM   (req) Array of Vaccine Types
"RTN","BIRPC",91,0)
 ;     4 - BIFDT  (opt) Forecast Date (not needed for history only).
"RTN","BIRPC",92,0)
 ;     5 - BISKIN (opt) =1 if Skin Tests should be included.
"RTN","BIRPC",93,0)
 ;
"RTN","BIRPC",94,0)
 S:'$D(BISKIN) BISKIN=1
"RTN","BIRPC",95,0)
 S:'$D(BIFMT) BIFMT=0
"RTN","BIRPC",96,0)
 D HISTORY^BIEXPRT3(BIFMT,.BIDE,.BIMM,,BISKIN)
"RTN","BIRPC",97,0)
 ;
"RTN","BIRPC",98,0)
 ;
"RTN","BIRPC",99,0)
 ;---> Next, set parameters for writing data as a string in BIHX.
"RTN","BIRPC",100,0)
 ;---> Parameters:
"RTN","BIRPC",101,0)
 ;     1 - BIEXP    (req) Export: 0=screen, 1=host file, 2=string
"RTN","BIRPC",102,0)
 ;     2 - BIFMT    (req) Format: 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIRPC",103,0)
 ;     3 - BIFLNM   (opt) File name
"RTN","BIRPC",104,0)
 ;     4 - BIPATH   (opt) BI Path name for host files
"RTN","BIRPC",105,0)
 ;     5 - BIHX     (ret) Immunization History in "^"-delimited string
"RTN","BIRPC",106,0)
 ;
"RTN","BIRPC",107,0)
 D WRITE^BIEXPRT4(2,1,,,.BIHX)
"RTN","BIRPC",108,0)
 ;
"RTN","BIRPC",109,0)
 ;W !,BIHX,!,"IMMHX^BIRPC" R ZZZ
"RTN","BIRPC",110,0)
 S BIHX=BIHX_BI31
"RTN","BIRPC",111,0)
 Q
"RTN","BIRPC",112,0)
 ;
"RTN","BIRPC",113,0)
 ;
"RTN","BIRPC",114,0)
 ;----------
"RTN","BIRPC",115,0)
IMMFORC(BIFORC,BIDFN,BIFDT,BIUPD,BIDUZ2,BIPDSS) ;PEP - Return Immunization Forecast.
"RTN","BIRPC",116,0)
 ;---> Return Immserve Patient Forecast in one string.
"RTN","BIRPC",117,0)
 ;---> Lines delimited by "^".
"RTN","BIRPC",118,0)
 ;---> Called by RPC: BI IMMSERVE PT PROFILE
"RTN","BIRPC",119,0)
 ;---> Parameters:
"RTN","BIRPC",120,0)
 ;     1 - BIFORC (ret) String of patient's forecast_||_Error.
"RTN","BIRPC",121,0)
 ;     2 - BIDFN  (req) DFN of patient.
"RTN","BIRPC",122,0)
 ;     3 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIRPC",123,0)
 ;     4 - BIUPD  (opt) If BIUPD=1, do NOT update Immserve Forecast.
"RTN","BIRPC",124,0)
 ;                      Default $G(BIUPD)="", forecast gets updated.
"RTN","BIRPC",125,0)
 ;     5 - BIDUZ2 (opt) User's DUZ(2) to indicate Immserve Forecasting
"RTN","BIRPC",126,0)
 ;                      Rules in Patient History data string.
"RTN","BIRPC",127,0)
 ;     6 - BIPDSS (ret) Returned string of V IMM IEN's that are
"RTN","BIRPC",128,0)
 ;                      Problem Doses, according to TCH.
"RTN","BIRPC",129,0)
 ;
"RTN","BIRPC",130,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC",131,0)
 N BI31,BIERR S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC",132,0)
 ;
"RTN","BIRPC",133,0)
 ;---> If the Vaccine Table is not standard, set Error Code and quit.
"RTN","BIRPC",134,0)
 I $D(^BISITE(-1)) D  Q
"RTN","BIRPC",135,0)
 .D ERRCD^BIUTL2(503,.BIERR) S BIFORC=BI31_BIERR
"RTN","BIRPC",136,0)
 ;
"RTN","BIRPC",137,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(301,.BIERR) S BIFORC=BI31_BIERR Q
"RTN","BIRPC",138,0)
 ;
"RTN","BIRPC",139,0)
 ;---> If patient is deceased, report it as error (in msgbox).
"RTN","BIRPC",140,0)
 I $$DECEASED^BIUTL1(BIDFN) D  Q
"RTN","BIRPC",141,0)
 .D ERRCD^BIUTL2(205,.BIERR) S BIFORC=BI31_BIERR Q
"RTN","BIRPC",142,0)
 ;
"RTN","BIRPC",143,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIRPC",144,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIRPC",145,0)
 ;
"RTN","BIRPC",146,0)
 ;---> If Forecast Date is before Patient's DOB, set Error Code and quit.
"RTN","BIRPC",147,0)
 I BIFDT<$$DOB^BIUTL1(BIDFN) D  Q
"RTN","BIRPC",148,0)
 .D ERRCD^BIUTL2(315,.BIERR) S BIFORC=BI31_BIERR
"RTN","BIRPC",149,0)
 ;
"RTN","BIRPC",150,0)
 ;---> Update patient's forecast with Immserve Utility (in ^BIPDUE).
"RTN","BIRPC",151,0)
 D:'$G(BIUPD) UPDATE^BIPATUP(BIDFN,BIFDT,.BIERR,1,$G(BIDUZ2),.BIPDSS)
"RTN","BIRPC",152,0)
 I BIERR]"" S BIFORC=BI31_BIERR Q
"RTN","BIRPC",153,0)
 ;
"RTN","BIRPC",154,0)
 ;---> If no Immunizations are due for this patient, return message.
"RTN","BIRPC",155,0)
 I '$D(^BIPDUE("B",BIDFN))&('$D(^BIPERR("B",BIDFN))) D  Q
"RTN","BIRPC",156,0)
 .S BIFORC="No immunizations due."_BI31
"RTN","BIRPC",157,0)
 .;---> NOTE! The above text is specifically checked for in ^BIPATVW1.
"RTN","BIRPC",158,0)
 ;
"RTN","BIRPC",159,0)
 ;---> Copy Immserve Patient Forecast (stored in ^BIPDUE) to string.
"RTN","BIRPC",160,0)
 N A,B,C,N,U,V,X,Z
"RTN","BIRPC",161,0)
 S:'$D(BIFORC) BIFORC="" S U="^",V="|"
"RTN","BIRPC",162,0)
 S N=0
"RTN","BIRPC",163,0)
 F  S N=$O(^BIPDUE("B",BIDFN,N)) Q:'N  D
"RTN","BIRPC",164,0)
 .S Z=$G(^BIPDUE(N,0))
"RTN","BIRPC",165,0)
 .I $P(Z,U)'=BIDFN K ^BIPDUE(N),^BIPDUE("B",BIDFN,N) Q
"RTN","BIRPC",166,0)
 .;
"RTN","BIRPC",167,0)
 .;---> A=Date Due, B=Date Past Due.
"RTN","BIRPC",168,0)
 .S A=$P(Z,U,4),B=$P(Z,U,5)
"RTN","BIRPC",169,0)
 .S X="  "_$$VNAME^BIUTL2($P(Z,U,2))  ;v8.0
"RTN","BIRPC",170,0)
 .;
"RTN","BIRPC",171,0)
 .;---> Concatenate due by/past due appropriate text and date.
"RTN","BIRPC",172,0)
 .S X=X_V_$S(B:" past due",1:" due")
"RTN","BIRPC",173,0)
 .S BIFORC=BIFORC_X_U
"RTN","BIRPC",174,0)
 ;
"RTN","BIRPC",175,0)
 ;
"RTN","BIRPC",176,0)
 ;---> Copy any Forecasting Errors (stored in ^BIPERR) to string.
"RTN","BIRPC",177,0)
 S N=0
"RTN","BIRPC",178,0)
 F  S N=$O(^BIPERR("B",BIDFN,N)) Q:'N  D
"RTN","BIRPC",179,0)
 .S Z=$G(^BIPERR(N,0))
"RTN","BIRPC",180,0)
 .I $P(Z,U)'=BIDFN K ^BIPERR(N),^BIPERR("B",BIDFN,N) Q
"RTN","BIRPC",181,0)
 .S X=$P(Z,U,2) S:'X X=999
"RTN","BIRPC",182,0)
 .;
"RTN","BIRPC",183,0)
 .S X=$P(Z,U,3)_" ERROR: "_$P((^BIERR(X,0)),"^",2)
"RTN","BIRPC",184,0)
 .S BIFORC=BIFORC_X_U
"RTN","BIRPC",185,0)
 ;
"RTN","BIRPC",186,0)
 S BIFORC=BIFORC_BI31
"RTN","BIRPC",187,0)
 Q
"RTN","BIRPC",188,0)
 ;
"RTN","BIRPC",189,0)
 ;
"RTN","BIRPC",190,0)
 ;
"RTN","BIRPC",191,0)
 ;----------
"RTN","BIRPC",192,0)
IMMPROF(BIGBL,BIDFN,BIFDT,BIDUZ2) ;PEP - Return ImmServe Profile in global array.
"RTN","BIRPC",193,0)
 ;---> Return ImmServe Profile in global array, ^BITEMP($J,"PROF".
"RTN","BIRPC",194,0)
 ;---> Lines delimited by "^".
"RTN","BIRPC",195,0)
 ;---> Called by RPC: BI PATIENT PROFILE GET
"RTN","BIRPC",196,0)
 ;---> Parameters:
"RTN","BIRPC",197,0)
 ;     1 - BIGBL  (ret) Name of result global containing patient's
"RTN","BIRPC",198,0)
 ;                      ImmServe Profile, passed to Broker.
"RTN","BIRPC",199,0)
 ;     2 - BIDFN  (req) DFN of patient.
"RTN","BIRPC",200,0)
 ;     3 - BIFDT  (opt) Forecast Date (date used to calc Imms due).
"RTN","BIRPC",201,0)
 ;     4 - BIDUZ2 (opt) User's DUZ(2) to indicate Immserve Forecasting
"RTN","BIRPC",202,0)
 ;                      Rules in Patient History data string.
"RTN","BIRPC",203,0)
 ;
"RTN","BIRPC",204,0)
 ;---> Delimiters to pass error with result to GUI.
"RTN","BIRPC",205,0)
 N BI30,BI31,BIERR,X
"RTN","BIRPC",206,0)
 S BI30=$C(30),BI31=$C(31)_$C(31)
"RTN","BIRPC",207,0)
 S BIGBL="^BITEMP("_$J_",""PROF"")",BIERR=""
"RTN","BIRPC",208,0)
 K ^BITEMP($J,"PROF")
"RTN","BIRPC",209,0)
 ;
"RTN","BIRPC",210,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC",211,0)
 .D ERRCD^BIUTL2(305,.BIERR) S ^BITEMP($J,"PROF",1)=BI31_BIERR
"RTN","BIRPC",212,0)
 ;
"RTN","BIRPC",213,0)
 ;---> If patient is deceased, report it as error (in msgbox).
"RTN","BIRPC",214,0)
 I $$DECEASED^BIUTL1(BIDFN) D  Q
"RTN","BIRPC",215,0)
 .D ERRCD^BIUTL2(205,.BIERR) S ^BITEMP($J,"PROF",1)=BI31_BIERR
"RTN","BIRPC",216,0)
 ;
"RTN","BIRPC",217,0)
 ;---> If the Patient is not in the Immunization Register,
"RTN","BIRPC",218,0)
 ;---> report the fact in the Profile (instead of as an error).
"RTN","BIRPC",219,0)
 I '$D(^BIP(BIDFN)) D  Q
"RTN","BIRPC",220,0)
 .N X
"RTN","BIRPC",221,0)
 .S X="This patient is not in the Immunization Register."
"RTN","BIRPC",222,0)
 .S ^BITEMP($J,"PROF",1)=X_BI30
"RTN","BIRPC",223,0)
 .S X="The Immserve Profile cannot be stored and displayed"
"RTN","BIRPC",224,0)
 .S ^BITEMP($J,"PROF",2)=X_BI30
"RTN","BIRPC",225,0)
 .S X="if the patient is not in the Register."
"RTN","BIRPC",226,0)
 .S ^BITEMP($J,"PROF",3)=X_BI30
"RTN","BIRPC",227,0)
 .S ^BITEMP($J,"PROF",4)=BI31
"RTN","BIRPC",228,0)
 ;
"RTN","BIRPC",229,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIRPC",230,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BIRPC",231,0)
 ;
"RTN","BIRPC",232,0)
 ;---> Update patient's profile with Immserve Utility.
"RTN","BIRPC",233,0)
 D UPDATE^BIPATUP(BIDFN,BIFDT,.BIERR,,$G(BIDUZ2))
"RTN","BIRPC",234,0)
 ;
"RTN","BIRPC",235,0)
 ;---> Copy Immserve Patient Profile to string.
"RTN","BIRPC",236,0)
 N I,N,U,X S U="^"
"RTN","BIRPC",237,0)
 S N=0
"RTN","BIRPC",238,0)
 F I=1:1 S N=$O(^BIP(BIDFN,1,N)) Q:'N  D
"RTN","BIRPC",239,0)
 .;---> Set null lines (line breaks) equal to one space, so that
"RTN","BIRPC",240,0)
 .;---> Windows reader will quit only at the final "null" line.
"RTN","BIRPC",241,0)
 .S X=^BIP(BIDFN,1,N,0) S:X="" X=" "
"RTN","BIRPC",242,0)
 .S ^BITEMP($J,"PROF",I)=X_BI30
"RTN","BIRPC",243,0)
 ;
"RTN","BIRPC",244,0)
 ;---> If no ImmServe Profile produced, report it as an error.
"RTN","BIRPC",245,0)
 I '$O(^BITEMP($J,"PROF",0)) D ERRCD^BIUTL2(307,.BIERR)
"RTN","BIRPC",246,0)
 ;
"RTN","BIRPC",247,0)
 ;---> Tack on Error Delimiter and any error.
"RTN","BIRPC",248,0)
 S ^BITEMP($J,"PROF",I)=BI31_BIERR
"RTN","BIRPC",249,0)
 Q
"RTN","BIRPC",250,0)
 ;
"RTN","BIRPC",251,0)
 ;
"RTN","BIRPC",252,0)
 ;----------
"RTN","BIRPC",253,0)
FORCALL ;PEP - Update Forecast for all Immunization Patients.
"RTN","BIRPC",254,0)
 ;---> Can be called by RPC: BI FORECAST ALL
"RTN","BIRPC",255,0)
 ;---> Can be called by OPTION: BI FORECAST ALL (may be queued in Taskman)
"RTN","BIRPC",256,0)
 ;---> This subroutine updates the immunization forecast for all patients in
"RTN","BIRPC",257,0)
 ;---> the File BI PATIENT IMMUNIZATIONS DUE File #9002084.1 for today.
"RTN","BIRPC",258,0)
 D ^XBKVAR
"RTN","BIRPC",259,0)
 N ZTIO S ZTIO=""
"RTN","BIRPC",260,0)
 N BIN S BIN=0
"RTN","BIRPC",261,0)
 F  S BIN=$O(^BIP(BIN)) Q:'BIN  D IMMFORC^BIRPC(,BIN)
"RTN","BIRPC",262,0)
 Q
"RTN","BIRPC1")
0^130^B6937183
"RTN","BIRPC1",1,0)
BIRPC1 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC1",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIRPC1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC1",4,0)
 ;;  RETURNS PATIENT DATA, DATA FOR AN IMMUNIZATION OR SKIN TEST VISIT.
"RTN","BIRPC1",5,0)
 ;;  PATCH 3: Add Eligibility Code to default Hx string.  GET+35
"RTN","BIRPC1",6,0)
 ;;  PATCH 5: Add Admin Note to default Hx string. GET+38
"RTN","BIRPC1",7,0)
 ;;  PATCH 9: Add Date VIS Presented and Admin Date to data string. GET+40
"RTN","BIRPC1",8,0)
 ;
"RTN","BIRPC1",9,0)
 ;
"RTN","BIRPC1",10,0)
 ;----------
"RTN","BIRPC1",11,0)
PDATA(BIDATA,BIDFN) ;EP
"RTN","BIRPC1",12,0)
 ;---> Return Patient Data in 5 ^-delimited pieces:
"RTN","BIRPC1",13,0)
 ;--->   1 - DOB in format: OCT 01,1994.
"RTN","BIRPC1",14,0)
 ;--->   2 - Age in format: 35 Months.
"RTN","BIRPC1",15,0)
 ;--->   3 - Text of Patient's sex.
"RTN","BIRPC1",16,0)
 ;--->   4 - HRCN in the format XX-XX-XX.
"RTN","BIRPC1",17,0)
 ;--->   5 - Text of ACTIVE/INACTIVE Status.
"RTN","BIRPC1",18,0)
 ;---> Parameters:
"RTN","BIRPC1",19,0)
 ;     1 - BIDATA  (ret) String of patient data||error.
"RTN","BIRPC1",20,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIRPC1",21,0)
 ;
"RTN","BIRPC1",22,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC1",23,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIRPC1",24,0)
 S BIDATA="",BIERR=""
"RTN","BIRPC1",25,0)
 ;
"RTN","BIRPC1",26,0)
 ;---> If DFN not supplied, set Error Code and quit.
"RTN","BIRPC1",27,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC1",28,0)
 .D ERRCD^BIUTL2(201,.BIERR) S BIDATA=BI31_BIERR
"RTN","BIRPC1",29,0)
 ;
"RTN","BIRPC1",30,0)
 ;---> DOB.
"RTN","BIRPC1",31,0)
 S BIDATA=$$TXDT1^BIUTL5($$DOB^BIUTL1(BIDFN))
"RTN","BIRPC1",32,0)
 ;
"RTN","BIRPC1",33,0)
 ;---> Age.
"RTN","BIRPC1",34,0)
 S BIDATA=BIDATA_U_$$AGEF^BIUTL1(BIDFN)
"RTN","BIRPC1",35,0)
 ;
"RTN","BIRPC1",36,0)
 ;---> Text of sex.
"RTN","BIRPC1",37,0)
 S BIDATA=BIDATA_U_$$SEXW^BIUTL1(BIDFN)
"RTN","BIRPC1",38,0)
 ;
"RTN","BIRPC1",39,0)
 ;---> HRCN, format XX-XX-XX.
"RTN","BIRPC1",40,0)
 S BIDATA=BIDATA_U_$$HRCN^BIUTL1(BIDFN)
"RTN","BIRPC1",41,0)
 ;
"RTN","BIRPC1",42,0)
 ;---> Active/Inactive Status.
"RTN","BIRPC1",43,0)
 S BIDATA=BIDATA_U_$$ACTIVE^BIUTL1(BIDFN)
"RTN","BIRPC1",44,0)
 ;
"RTN","BIRPC1",45,0)
 S BIDATA=BIDATA_BI31
"RTN","BIRPC1",46,0)
 ;
"RTN","BIRPC1",47,0)
 Q
"RTN","BIRPC1",48,0)
 ;
"RTN","BIRPC1",49,0)
 ;
"RTN","BIRPC1",50,0)
 ;----------
"RTN","BIRPC1",51,0)
GET(BIDATA,BIDA,BIVTYPE,BIDE) ;PEP - Return data for one Immunization or Skin Test.
"RTN","BIRPC1",52,0)
 ;---> Return data for one Immunization or Skin Test.
"RTN","BIRPC1",53,0)
 ;---> Called by RPC: BI VISIT GET.
"RTN","BIRPC1",54,0)
 ;---> Parameters:
"RTN","BIRPC1",55,0)
 ;     1 - BIDATA  (ret) Visit Data or Text of Error Code if any.
"RTN","BIRPC1",56,0)
 ;     2 - BIDA    (req) IEN of V IMM or V SKIN entry for data retrieval.
"RTN","BIRPC1",57,0)
 ;     3 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC1",58,0)
 ;     4 - BIDE    (opt) Local array for Data Elements to be returned.
"RTN","BIRPC1",59,0)
 ;
"RTN","BIRPC1",60,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC1",61,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIRPC1",62,0)
 S BIDATA="",BIERR=""
"RTN","BIRPC1",63,0)
 ;
"RTN","BIRPC1",64,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIRPC1",65,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIRPC1",66,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIRPC1",67,0)
 .D ERRCD^BIUTL2(410,.BIERR) S BIDATA=BI31_BIERR
"RTN","BIRPC1",68,0)
 ;
"RTN","BIRPC1",69,0)
 ;---> If BIDA not supplied, set Error Code and quit.
"RTN","BIRPC1",70,0)
 I '$G(BIDA) D  Q
"RTN","BIRPC1",71,0)
 .D ERRCD^BIUTL2(409,.BIERR) S BIDATA=BI31_BIERR
"RTN","BIRPC1",72,0)
 ;
"RTN","BIRPC1",73,0)
 ;---> Set required variables, kill ^BITMP($J).
"RTN","BIRPC1",74,0)
 D SETVARS^BIUTL5 K ^BITMP($J)
"RTN","BIRPC1",75,0)
 ;
"RTN","BIRPC1",76,0)
 ;---> Set BIDE local array for Data Elements to be returned.
"RTN","BIRPC1",77,0)
 ;---> IENs are in ^BIEXPDD(, the BI TABLE DATA ELEMENT File.
"RTN","BIRPC1",78,0)
 ;---> The Pieces (PC) indicate position in the returned data string,
"RTN","BIRPC1",79,0)
 ;---> BIDATA, below.
"RTN","BIRPC1",80,0)
 ;---> Branching logic for Immunization versus Skin Test Visits.
"RTN","BIRPC1",81,0)
 ;
"RTN","BIRPC1",82,0)
 ;---> IMMUNIZATION:
"RTN","BIRPC1",83,0)
 ;---> If this is an Immunization Visit, collect these Data Elements.
"RTN","BIRPC1",84,0)
 N I
"RTN","BIRPC1",85,0)
 ;---> Next line: 6 (Dose#) defunct, but serves as a place holder. v8.0
"RTN","BIRPC1",86,0)
 ;
"RTN","BIRPC1",87,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC1",88,0)
 ;---> Add Eligibility Code Text and NDC Code Text to default Hx string.
"RTN","BIRPC1",89,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC1",90,0)
 ;---> Add Admin Note to default Hx string.
"RTN","BIRPC1",91,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIRPC1",92,0)
 ;---> Add Date VIS Presented to Patient (YYYYMMDD) and Date of Event ONLY.
"RTN","BIRPC1",93,0)
 ;I '$D(BIDE),BIVTYPE="I" F I=4,6,24,27,29:1:37,43,49,51,61,65,67,68,76,77,78,80,82,84,87  S BIDE(I)=""
"RTN","BIRPC1",94,0)
 I '$D(BIDE),BIVTYPE="I" D
"RTN","BIRPC1",95,0)
 .F I=4,6,24,27,29:1:37,43,49,51,61,65,67,68,76,77,78,80,82,84,85,87,90,91  S BIDE(I)=""
"RTN","BIRPC1",96,0)
 ;**********
"RTN","BIRPC1",97,0)
 ;
"RTN","BIRPC1",98,0)
 ;---> IEN PC  DATA
"RTN","BIRPC1",99,0)
 ;---> --- --  ----
"RTN","BIRPC1",100,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC1",101,0)
 ;---> 4   2 = Vaccine Name, Short.
"RTN","BIRPC1",102,0)
 ;---> 6   3 = Dose#.  v8.0 No longer used.
"RTN","BIRPC1",103,0)
 ;---> 24  4 = V IMMUNIZATION IEN.
"RTN","BIRPC1",104,0)
 ;---> 27  5 = Vaccine Group ("Series Type").
"RTN","BIRPC1",105,0)
 ;---> 29  6 = Date of Immunization (DD-Mmm-YYYY @HH:MM).
"RTN","BIRPC1",106,0)
 ;---> 30  7 = Vaccine Name, IEN.
"RTN","BIRPC1",107,0)
 ;---> 31  8 = Vaccine maximum Dose#.
"RTN","BIRPC1",108,0)
 ;---> 32  9 = Vaccine Lot Number, IEN.
"RTN","BIRPC1",109,0)
 ;---> 33 10 = Vaccine Lot Number.
"RTN","BIRPC1",110,0)
 ;---> 34 11 = Location IEN.
"RTN","BIRPC1",111,0)
 ;---> 35 12 = Category of Visit (A,E, or I)
"RTN","BIRPC1",112,0)
 ;---> 36 13 = Location Other (text).
"RTN","BIRPC1",113,0)
 ;---> 37 14 = Location IHS (text).
"RTN","BIRPC1",114,0)
 ;---> 43 15 = Vaccine Reaction.
"RTN","BIRPC1",115,0)
 ;---> 49 16 = VIS Statement Info (Yes/No).
"RTN","BIRPC1",116,0)
 ;---> 51 17 = Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIRPC1",117,0)
 ;---> 61 18 = Immunization Provider IEN.
"RTN","BIRPC1",118,0)
 ;---> 65 19 = Dose Override.
"RTN","BIRPC1",119,0)
 ;---> 67 20 = Injection Site.
"RTN","BIRPC1",120,0)
 ;---> 68 21 = Volume.
"RTN","BIRPC1",121,0)
 ;---> 76 22 = Visit IEN.
"RTN","BIRPC1",122,0)
 ;---> 77 23 = Eligibility Code IEN.
"RTN","BIRPC1",123,0)
 ;---> 78 24 - Imported from Outside Registry (1=imported, 2=imported & edited).
"RTN","BIRPC1",124,0)
 ;---> 80 25 = NDC Code pointer IEN.
"RTN","BIRPC1",125,0)
 ;---> 82 26 = Eligibility Code Text.
"RTN","BIRPC1",126,0)
 ;---> 84 27 = NDC Code Text.
"RTN","BIRPC1",127,0)
 ;---> 85 28 = Date of Event OR Visit; Admin Shot Date (1201 of V File) in MM/DD/YY
"RTN","BIRPC1",128,0)
 ;--->         If 1201 is not populated, this element returns the Visit Date!
"RTN","BIRPC1",129,0)
 ;---> 87 29 = Administrative Note.
"RTN","BIRPC1",130,0)
 ;---> 90 30 = Date VIS Presented to Patient.
"RTN","BIRPC1",131,0)
 ;---> 91 31 = Date of Event (1201) ONLY; if 1201 is null, return null.
"RTN","BIRPC1",132,0)
 ;
"RTN","BIRPC1",133,0)
 ;
"RTN","BIRPC1",134,0)
 ;---> SKIN TEST:
"RTN","BIRPC1",135,0)
 ;---> If this is a Skin Test Visit, collect these Data Elements.
"RTN","BIRPC1",136,0)
 I '$D(BIDE),BIVTYPE="S" F I=24,26,29,34:1:42,61,67,68,70,76 S BIDE(I)=""
"RTN","BIRPC1",137,0)
 ;
"RTN","BIRPC1",138,0)
 ;---> IEN PC  DATA
"RTN","BIRPC1",139,0)
 ;---> --- --  ----
"RTN","BIRPC1",140,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC1",141,0)
 ;---> 24  2 = V File IEN.
"RTN","BIRPC1",142,0)
 ;---> 26  3 = Location (or Outside Location) of Visit.
"RTN","BIRPC1",143,0)
 ;---> 29  4 = Date of Skin Test (DD-Mmm-YYYY @HH:MM).
"RTN","BIRPC1",144,0)
 ;---> 34  5 = Location IEN.
"RTN","BIRPC1",145,0)
 ;---> 35  6 = Category of Visit (A,E, or I)
"RTN","BIRPC1",146,0)
 ;---> 36  7 = Location Other (text).
"RTN","BIRPC1",147,0)
 ;---> 37  8 = Location IHS (text).
"RTN","BIRPC1",148,0)
 ;---> 38  9 = Skin Test Result.
"RTN","BIRPC1",149,0)
 ;---> 39 10 = Skin Test Reading.
"RTN","BIRPC1",150,0)
 ;---> 40 11 = Skin Test Date Read.
"RTN","BIRPC1",151,0)
 ;---> 41 12 = Skin Test Name.
"RTN","BIRPC1",152,0)
 ;---> 42 13 = Skin Test Name IEN.
"RTN","BIRPC1",153,0)
 ;---> 61 14 = Immunization Provider IEN.
"RTN","BIRPC1",154,0)
 ;---> 67 15 = Injection Site.
"RTN","BIRPC1",155,0)
 ;---> 68 16 = Volume.
"RTN","BIRPC1",156,0)
 ;---> 70 17 = Skin Test Reader (Provider) IEN.
"RTN","BIRPC1",157,0)
 ;---> 76 18 = Visit IEN.
"RTN","BIRPC1",158,0)
 ;
"RTN","BIRPC1",159,0)
 ;
"RTN","BIRPC1",160,0)
 ;---> Now, gather data from one V File Visit.
"RTN","BIRPC1",161,0)
 ;     1 - BIDA    (req) IEN of V File Visit.
"RTN","BIRPC1",162,0)
 ;     2 - BIDE    (req) Data Elements array (null if HL7)
"RTN","BIRPC1",163,0)
 ;     3 - BIFMT   (req) Format: 0=ASCII Split, 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIRPC1",164,0)
 ;     4 - BIVTYPE (req) Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC1",165,0)
 ;     5 - BIDATA  (opt) Data returned in this param if desired.
"RTN","BIRPC1",166,0)
 ;
"RTN","BIRPC1",167,0)
 D HISTORY1^BIEXPRT3(BIDA,.BIDE,1,BIVTYPE,,.BIERR)
"RTN","BIRPC1",168,0)
 I BIERR]"" S BIDATA=BI31_BIERR Q
"RTN","BIRPC1",169,0)
 ;
"RTN","BIRPC1",170,0)
 ;
"RTN","BIRPC1",171,0)
 ;---> Set parameters for writing data as a string in BIDATA.
"RTN","BIRPC1",172,0)
 ;---> Parameters:
"RTN","BIRPC1",173,0)
 ;     1 - BIEXP    (req) Export: 0=screen, 1=host file, 2=string
"RTN","BIRPC1",174,0)
 ;     2 - BIFMT    (req) Format: 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIRPC1",175,0)
 ;     3 - BIFLNM   (opt) File name
"RTN","BIRPC1",176,0)
 ;     4 - BIPATH   (opt) BI Path name for host files
"RTN","BIRPC1",177,0)
 ;     5 - BIDATA   (ret) Immunization History in "|"-delimited string
"RTN","BIRPC1",178,0)
 ;                        NOTE: Since this is necessarily only one
"RTN","BIRPC1",179,0)
 ;                              record, strip "^"-delimiter at end.
"RTN","BIRPC1",180,0)
 ;
"RTN","BIRPC1",181,0)
 D WRITE^BIEXPRT4(2,1,,,.BIDATA)
"RTN","BIRPC1",182,0)
 ;
"RTN","BIRPC1",183,0)
 ;---> Returned data string, with error delimiter concatenated.
"RTN","BIRPC1",184,0)
 S BIDATA=$P(BIDATA,U)_BI31
"RTN","BIRPC1",185,0)
 Q
"RTN","BIRPC2")
0^131^B10052475
"RTN","BIRPC2",1,0)
BIRPC2 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIRPC2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC2",4,0)
 ;;  RETURNS LISTS OF VACCINES, LOT NUMBERS, LOCATIONS FOR SELECTION.
"RTN","BIRPC2",5,0)
 ;
"RTN","BIRPC2",6,0)
 ;
"RTN","BIRPC2",7,0)
 ;----------
"RTN","BIRPC2",8,0)
VACNAMS(BIGBL) ;EP
"RTN","BIRPC2",9,0)
 ;---> Return list of available Vaccine Names delimited by
"RTN","BIRPC2",10,0)
 ;---> "^" into 4 pieces:
"RTN","BIRPC2",11,0)
 ;--->   1 - IEN of Vaccine Name.
"RTN","BIRPC2",12,0)
 ;--->   2 - Vaccine Name Short in IMMUNIZATION File #9999999.14.
"RTN","BIRPC2",13,0)
 ;--->   3 - Default Lot Number for this vaccine.
"RTN","BIRPC2",14,0)
 ;--->   4 - Maximum Dose# for the vaccine.
"RTN","BIRPC2",15,0)
 ;
"RTN","BIRPC2",16,0)
 ;---> Parameters:
"RTN","BIRPC2",17,0)
 ;     1 - BIGBL  (ret) Result global for Broker (last node=||error).
"RTN","BIRPC2",18,0)
 ;
"RTN","BIRPC2",19,0)
 ;---> Generic Fileman file Lookup.  (Can be called from client side.)
"RTN","BIRPC2",20,0)
 N A,B,C,D,E,F,G
"RTN","BIRPC2",21,0)
 S BIGBL=""
"RTN","BIRPC2",22,0)
 ;
"RTN","BIRPC2",23,0)
 S A=9999999.14                   ;Immunization Table File.
"RTN","BIRPC2",24,0)
 S B=".02;.04;.05"                ;Fields to return w/each entry.
"RTN","BIRPC2",25,0)
 ;                                ;   IEN;Short Name;Default Lot#;
"RTN","BIRPC2",26,0)
 ;                                ;   Max in Vaccine Group (Series).
"RTN","BIRPC2",27,0)
 S BIINPUT=""                     ;Retrieve all.
"RTN","BIRPC2",28,0)
 S C=""                           ;Flags for lookup.
"RTN","BIRPC2",29,0)
 S D=""                           ;Max number of entries (*=all).
"RTN","BIRPC2",30,0)
 S E="B"                          ;Indexes to search.
"RTN","BIRPC2",31,0)
 S F="I '$P(^AUTTIMM(Y,0),U,7)"   ;Screen (Eliminate "Inactives".)
"RTN","BIRPC2",32,0)
 ;
"RTN","BIRPC2",33,0)
 D LOOKUP^BIXRPC(.BIGBL,A,B,C,BIINPUT,D,E,F)
"RTN","BIRPC2",34,0)
 Q
"RTN","BIRPC2",35,0)
 ;
"RTN","BIRPC2",36,0)
 ;
"RTN","BIRPC2",37,0)
 ;----------
"RTN","BIRPC2",38,0)
LOTNUMS(BIGBL,BIVAC) ;EP
"RTN","BIRPC2",39,0)
 ;---> Return list of available Lot Numbers for the Vaccine passed.
"RTN","BIRPC2",40,0)
 ;---> Delimited by "^" into 2 pieces:
"RTN","BIRPC2",41,0)
 ;--->   1 - IEN of Lot Number.
"RTN","BIRPC2",42,0)
 ;--->   2 - Lot Number (text).
"RTN","BIRPC2",43,0)
 ;
"RTN","BIRPC2",44,0)
 ;---> Parameters:
"RTN","BIRPC2",45,0)
 ;     1 - BIGBL  (ret) Result global for Broker (last node=||error).
"RTN","BIRPC2",46,0)
 ;     2 - BIVAC  (req) IEN of the Vaccine to match Lot Number on.
"RTN","BIRPC2",47,0)
 ;
"RTN","BIRPC2",48,0)
 S BIGBL=""
"RTN","BIRPC2",49,0)
 ;
"RTN","BIRPC2",50,0)
 ;---> If Vaccine IEN not provided, set Error Code and quit.
"RTN","BIRPC2",51,0)
 I '$G(BIVAC) D  Q
"RTN","BIRPC2",52,0)
 .N BIERR S BIERR=""
"RTN","BIRPC2",53,0)
 .;---> Get text of Error Code.
"RTN","BIRPC2",54,0)
 .D ERRCD^BIUTL2(502,.BIERR)
"RTN","BIRPC2",55,0)
 .;---> Set error text in temp global and quit.
"RTN","BIRPC2",56,0)
 .D PASSERR^BIXRPC(.BIGBL,BIERR)
"RTN","BIRPC2",57,0)
 ;
"RTN","BIRPC2",58,0)
 ;---> Generic Fileman file Lookup.  (Can be called from client side.)
"RTN","BIRPC2",59,0)
 N A,B,C,D,E,F,G
"RTN","BIRPC2",60,0)
 ;
"RTN","BIRPC2",61,0)
 S A=9999999.41                         ;Immunization Lot Number file.
"RTN","BIRPC2",62,0)
 S B=".01;.02"                          ;Fields to return w/each entry.
"RTN","BIRPC2",63,0)
 ;                                      ;   IEN;Lot Number;Manufacturer
"RTN","BIRPC2",64,0)
 S BIINPUT=""                           ;Retrieve all.
"RTN","BIRPC2",65,0)
 S C=""                                 ;Flags for lookup.
"RTN","BIRPC2",66,0)
 S D=""                                 ;Max number of entries (*=all).
"RTN","BIRPC2",67,0)
 S E=""                                 ;Indexes to search.
"RTN","BIRPC2",68,0)
 ;                                      ;Only ACTIVE Lot Numbers for
"RTN","BIRPC2",69,0)
 ;                                      ;the Vaccine provided.
"RTN","BIRPC2",70,0)
 S F="I $P(^AUTTIML(Y,0),U,3),$P(^(0),U,4)="_BIVAC
"RTN","BIRPC2",71,0)
 ;
"RTN","BIRPC2",72,0)
 D LOOKUP^BIXRPC(.BIGBL,A,B,C,BIINPUT,D,E,F)
"RTN","BIRPC2",73,0)
 Q
"RTN","BIRPC2",74,0)
 ;
"RTN","BIRPC2",75,0)
 ;
"RTN","BIRPC2",76,0)
 ;----------
"RTN","BIRPC2",77,0)
LOCATION(BIGBL,BIINPUT) ;EP
"RTN","BIRPC2",78,0)
 ;---> Return list of available Locations for an Immunization visit.
"RTN","BIRPC2",79,0)
 ;---> in the global @BIGBL.  Each matching entry has a node in
"RTN","BIRPC2",80,0)
 ;---> in @BIGBL.  The last node contains the error delimiter
"RTN","BIRPC2",81,0)
 ;---> BI31 and an error (text) if one exists.
"RTN","BIRPC2",82,0)
 ;
"RTN","BIRPC2",83,0)
 ;---> Parameters:
"RTN","BIRPC2",84,0)
 ;     1 - BIGBL   (ret) Result global for Broker (last node=||error).
"RTN","BIRPC2",85,0)
 ;     2 - BIINPUT (opt) Input string to match Location on.
"RTN","BIRPC2",86,0)
 ;
"RTN","BIRPC2",87,0)
 ;---> Generic Fileman file Lookup.  (Can be called from client side.)
"RTN","BIRPC2",88,0)
 N A,B,C,D,E,F,G
"RTN","BIRPC2",89,0)
 ;
"RTN","BIRPC2",90,0)
 S A=9999999.06                   ;IHS Location File.
"RTN","BIRPC2",91,0)
 S B=".01;.04;.05;.07"            ;Fields to return w/each entry.
"RTN","BIRPC2",92,0)
 ;                                ;Return value for each entry:
"RTN","BIRPC2",93,0)
 ;                                ;   IEN;Name;State;Service Unit;Code
"RTN","BIRPC2",94,0)
 S C="M"                          ;Flags for lookup.
"RTN","BIRPC2",95,0)
 S D="20"                         ;Max number of entries (*=all).
"RTN","BIRPC2",96,0)
 S E="B^C^D"                      ;Indexes to search.
"RTN","BIRPC2",97,0)
 S F="I '$P(^AUTTLOC(Y,0),U,21)"  ;Screen (Eliminate "Inactives".)
"RTN","BIRPC2",98,0)
 S G=1                            ;Mixed Case: 1=mixed, 0=no change
"RTN","BIRPC2",99,0)
 ;
"RTN","BIRPC2",100,0)
 D LOOKUP^BIXRPC(.BIGBL,A,B,C,BIINPUT,D,E,F,G)
"RTN","BIRPC2",101,0)
 Q
"RTN","BIRPC3")
0^132^B46738139
"RTN","BIRPC3",1,0)
BIRPC3 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC3",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIRPC3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC3",4,0)
 ;;  ADD/EDIT A VISIT (IMMUNIZATION OR SKIN TEST), DELETE A VISIT.
"RTN","BIRPC3",5,0)
 ;;  Check validity of data in several fields.
"RTN","BIRPC3",6,0)
 ;;  PATCH 3: If Category=Historical Event, Lot need not be Active.
"RTN","BIRPC3",7,0)
 ;;                                                    ADDEDIT+117, LOTCHK+34
"RTN","BIRPC3",8,0)
 ;;  PATCH 5: Added BINOM parameter to ADDEDIT P.E.P. for Visit Selection Menu.
"RTN","BIRPC3",9,0)
 ;;                                                    ADDEDIT+0
"RTN","BIRPC3",10,0)
 ;;  PATCH 5: Ignore 1st piece of zero node; just check for node. ADDEDIT+63
"RTN","BIRPC3",11,0)
 ;;  PATCH 9: Added save of Admin Date and VIS Presented Date.  ADDEDIT+39
"RTN","BIRPC3",12,0)
 ;
"RTN","BIRPC3",13,0)
 ;
"RTN","BIRPC3",14,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",15,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIRPC3",16,0)
 ;---> Added Admin Note, piece 27.
"RTN","BIRPC3",17,0)
 ;----------
"RTN","BIRPC3",18,0)
ADDEDIT(BIERR,BIDATA,BINOM) ;PEP - Add/Edit an V IMMUNIZATION or V SKIN TEST.
"RTN","BIRPC3",19,0)
 ;---> Add/Edit an V IMMUNIZATION or V SKIN TEST.
"RTN","BIRPC3",20,0)
 ;---> Called by RPC: BI VISIT ADD/EDIT.
"RTN","BIRPC3",21,0)
 ;---> Parameters:
"RTN","BIRPC3",22,0)
 ;     1 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC3",23,0)
 ;     2 - BIDATA  (req) String of data for the Visit to be added.
"RTN","BIRPC3",24,0)
 ;     3 - BINOM   (opt) 0=Allow display of Visit Selection Menu if site
"RTN","BIRPC3",25,0)
 ;                       parameter is set. 1=No display (for export).
"RTN","BIRPC3",26,0)
 ;
"RTN","BIRPC3",27,0)
 ;---> Pieces of BIDATA delimited by "|":
"RTN","BIRPC3",28,0)
 ;     ----------------------------------
"RTN","BIRPC3",29,0)
 ;     1 - (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC3",30,0)
 ;     2 - (req) DFN of patient.
"RTN","BIRPC3",31,0)
 ;     3 - (req) Vaccine or Skin Test .01 pointer.
"RTN","BIRPC3",32,0)
 ;     4 - (opt) Dose# number for this Immunization (NO LONGER USED).
"RTN","BIRPC3",33,0)
 ;     5 - (opt) Lot number IEN for this Immunization.
"RTN","BIRPC3",34,0)
 ;     6 - (req) Date.Time of Visit.
"RTN","BIRPC3",35,0)
 ;     7 - (req) Location of encounter IEN.
"RTN","BIRPC3",36,0)
 ;     8 - (opt) Other Location of encounter.
"RTN","BIRPC3",37,0)
 ;     9 - (req) Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIRPC3",38,0)
 ;    10 - (opt) Visit IEN.
"RTN","BIRPC3",39,0)
 ;    11 - (opt) Old V File IEN (for edits).
"RTN","BIRPC3",40,0)
 ;    12 - (req) Skin Test Result: P,N,D,O.
"RTN","BIRPC3",41,0)
 ;    13 - (req) Skin Test Reading: 0-40.
"RTN","BIRPC3",42,0)
 ;    14 - (req) Skin Test Date Read.
"RTN","BIRPC3",43,0)
 ;    15 - (opt) Vaccine Reaction.
"RTN","BIRPC3",44,0)
 ;    16 - (opt) VFC Eligibility.  vvv83
"RTN","BIRPC3",45,0)
 ;    17 - (opt) Release/Revision Date of VIS.
"RTN","BIRPC3",46,0)
 ;    18 - (opt) IEN of Provider of Immunization/Skin Test.
"RTN","BIRPC3",47,0)
 ;    19 - (opt) Dose Override.
"RTN","BIRPC3",48,0)
 ;    20 - (opt) Injection Site.
"RTN","BIRPC3",49,0)
 ;    21 - (opt) Volume.
"RTN","BIRPC3",50,0)
 ;    22 - (opt) IEN of Reader (Provider) of Skin Test.
"RTN","BIRPC3",51,0)
 ;    23 - (req) DUZ(2) for Site Parameters.
"RTN","BIRPC3",52,0)
 ;    24 - (opt) If this was an imported CPT Coded Imm from PCC (=IEN of V CPT).
"RTN","BIRPC3",53,0)
 ;    25 - (opt) If this =1, then imported (IF =2, then was edited after import).
"RTN","BIRPC3",54,0)
 ;    26 - (opt) NDC pointer IEN (to file #9002084.95).
"RTN","BIRPC3",55,0)
 ;    27 - (opt) Administrative Note (<161 chars).
"RTN","BIRPC3",56,0)
 ;
"RTN","BIRPC3",57,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIRPC3",58,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIRPC3",59,0)
 ;    28 - (opt) Admin Date (Date shot admin'd to patient.
"RTN","BIRPC3",60,0)
 ;    29 - (opt) Date VIS Presented to Patient.
"RTN","BIRPC3",61,0)
 ;
"RTN","BIRPC3",62,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC3",63,0)
 N BI31,BIDUZ2,BIOIEN
"RTN","BIRPC3",64,0)
 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC3",65,0)
 ;
"RTN","BIRPC3",66,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",67,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIRPC3",68,0)
 S:($G(BINOM)="") BINOM=0
"RTN","BIRPC3",69,0)
 ;
"RTN","BIRPC3",70,0)
 ;---> If this is an edit of an old Visit, preserve IEN of old V File entry.
"RTN","BIRPC3",71,0)
 S BIOIEN=$P(BIDATA,"|",11)
"RTN","BIRPC3",72,0)
 ;
"RTN","BIRPC3",73,0)
 ;---> If DATA not supplied, set Error Code and quit.
"RTN","BIRPC3",74,0)
 I $G(BIDATA)']"" D  Q
"RTN","BIRPC3",75,0)
 .D ERRCD^BIUTL2(403,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",76,0)
 ;
"RTN","BIRPC3",77,0)
 ;---> Get Site IEN (passed DUZ(2)) for Site Parameters.
"RTN","BIRPC3",78,0)
 S BIDUZ2=$P(BIDATA,"|",23)
"RTN","BIRPC3",79,0)
 ;---> If no Site IEN was passed, try to get it from local symbol table.
"RTN","BIRPC3",80,0)
 S:'BIDUZ2 (BIDUZ2,$P(BIDATA,"|",23))=$G(DUZ(2))
"RTN","BIRPC3",81,0)
 ;--> If still no Site IEN, error out.
"RTN","BIRPC3",82,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(121,.BIERR) S BIERR=BI31_BIERR Q
"RTN","BIRPC3",83,0)
 ;
"RTN","BIRPC3",84,0)
 ;---> Check for valid Patient.
"RTN","BIRPC3",85,0)
 N BIDFN S BIDFN=$P(BIDATA,"|",2)
"RTN","BIRPC3",86,0)
 ;
"RTN","BIRPC3",87,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",88,0)
 ;---> Ignore 1st piece of zero node; just check for node.
"RTN","BIRPC3",89,0)
 ;I '$G(^AUPNPAT(+BIDFN,0)) D  Q
"RTN","BIRPC3",90,0)
 I '$D(^AUPNPAT(+BIDFN,0)) D  Q
"RTN","BIRPC3",91,0)
 .;**********
"RTN","BIRPC3",92,0)
 .;
"RTN","BIRPC3",93,0)
 .D ERRCD^BIUTL2(217,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",94,0)
 ;
"RTN","BIRPC3",95,0)
 ;---> Visit Type: "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC3",96,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIRPC3",97,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIRPC3",98,0)
 N BIVTYPE S BIVTYPE=$P(BIDATA,"|",1)
"RTN","BIRPC3",99,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIRPC3",100,0)
 .D ERRCD^BIUTL2(410,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",101,0)
 ;
"RTN","BIRPC3",102,0)
 ;---> If this is an Immunization Visit and the Vaccine Table
"RTN","BIRPC3",103,0)
 ;---> not standard, set Error Code and quit.
"RTN","BIRPC3",104,0)
 I (BIVTYPE="I")&($D(^BISITE(-1))) D  Q
"RTN","BIRPC3",105,0)
 .D ERRCD^BIUTL2(503,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",106,0)
 ;
"RTN","BIRPC3",107,0)
 ;---> If this Visit (new or edited) will be a duplicate, set error
"RTN","BIRPC3",108,0)
 ;---> and quit.
"RTN","BIRPC3",109,0)
 D DUPTEST^BIUTL8(.BIERR,BIDATA,$G(BIOIEN))
"RTN","BIRPC3",110,0)
 Q:BIERR]""
"RTN","BIRPC3",111,0)
 ;
"RTN","BIRPC3",112,0)
 ;---> Reformat dates to Fileman Internal format.
"RTN","BIRPC3",113,0)
 D
"RTN","BIRPC3",114,0)
 .N I F I=6,14,17 D
"RTN","BIRPC3",115,0)
 ..N X S X=$P(BIDATA,"|",I)
"RTN","BIRPC3",116,0)
 ..D DT^DILF("PT",X,.X)
"RTN","BIRPC3",117,0)
 ..S $P(BIDATA,"|",I)=X
"RTN","BIRPC3",118,0)
 ;
"RTN","BIRPC3",119,0)
 ;---> If Visit Date is before Patient's DOB, set Error Code and quit.
"RTN","BIRPC3",120,0)
 I $P(BIDATA,"|",6)<$$DOB^BIUTL1($P(BIDATA,"|",2)) D  Q
"RTN","BIRPC3",121,0)
 .D ERRCD^BIUTL2(422,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",122,0)
 ;
"RTN","BIRPC3",123,0)
 ;---> Set Lot# and Category.
"RTN","BIRPC3",124,0)
 N BILOT S BILOT=$P(BIDATA,"|",5)
"RTN","BIRPC3",125,0)
 N BICAT S BICAT=$P(BIDATA,"|",9)
"RTN","BIRPC3",126,0)
 ;
"RTN","BIRPC3",127,0)
 ;---> If this is an Immunization, check for valid.
"RTN","BIRPC3",128,0)
 D:BIVTYPE="I"  Q:$G(BIERR)]""
"RTN","BIRPC3",129,0)
 .N BIVAC S BIVAC=$P(BIDATA,"|",3)
"RTN","BIRPC3",130,0)
 .;
"RTN","BIRPC3",131,0)
 .;---> If Vaccine not provided, set Error and quit.
"RTN","BIRPC3",132,0)
 .I '$G(BIVAC) D  Q
"RTN","BIRPC3",133,0)
 ..D ERRCD^BIUTL2(502,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",134,0)
 .;
"RTN","BIRPC3",135,0)
 .;---> If Vaccine does not exist, set Error and quit.
"RTN","BIRPC3",136,0)
 .I '$D(^AUTTIMM(BIVAC,0)) D  Q
"RTN","BIRPC3",137,0)
 ..D ERRCD^BIUTL2(430,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",138,0)
 .;
"RTN","BIRPC3",139,0)
 .;---> If the Vaccine is INACTIVE and Category is NOT "Historical Event"
"RTN","BIRPC3",140,0)
 .;---> set Error Code and quit.
"RTN","BIRPC3",141,0)
 .I $P(^AUTTIMM(BIVAC,0),U,7)&(BICAT'="E") D  Q
"RTN","BIRPC3",142,0)
 ..D ERRCD^BIUTL2(429,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",143,0)
 .;
"RTN","BIRPC3",144,0)
 .;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIRPC3",145,0)
 .;---> Use new call, LOTCHK, to check validity of Lot Number.
"RTN","BIRPC3",146,0)
 .;---> If Lot# is required and one was not passed, set Error and quit.
"RTN","BIRPC3",147,0)
 .;---> (If Category is Historical Event, Lot# not required.)
"RTN","BIRPC3",148,0)
 .I $$LOTREQ^BIUTL2(BIDUZ2)&(BILOT="")&(BICAT'="E") D  Q
"RTN","BIRPC3",149,0)
 ..D ERRCD^BIUTL2(431,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",150,0)
 .;
"RTN","BIRPC3",151,0)
 .;---> If Lot Number was passed, check it.
"RTN","BIRPC3",152,0)
 .D:BILOT  Q:$G(BIERR)]""
"RTN","BIRPC3",153,0)
 ..;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC3",154,0)
 ..;---> If Category=Historical Event, Lot need not be Active.
"RTN","BIRPC3",155,0)
 ..;D LOTCHK(BILOT,BIVAC,.BIERR)
"RTN","BIRPC3",156,0)
 ..D LOTCHK(BILOT,BIVAC,BICAT,.BIERR)
"RTN","BIRPC3",157,0)
 ..;**********
"RTN","BIRPC3",158,0)
 ..;
"RTN","BIRPC3",159,0)
 ..I $G(BIERR)]"" S BIERR=BI31_BIERR
"RTN","BIRPC3",160,0)
 ;
"RTN","BIRPC3",161,0)
 ;---> If this is a Skin Test, Category is NOT Historical, and it has a Result,
"RTN","BIRPC3",162,0)
 ;---> then check for Reading in mm.
"RTN","BIRPC3",163,0)
 I BIVTYPE="S",BICAT'="E",$P(BIDATA,"|",12)]"",$P(BIDATA,"|",13)="" D  Q
"RTN","BIRPC3",164,0)
 .D ERRCD^BIUTL2(436,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",165,0)
 ;
"RTN","BIRPC3",166,0)
 ;
"RTN","BIRPC3",167,0)
 ;---> Add Visit.
"RTN","BIRPC3",168,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",169,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIRPC3",170,0)
 ;D ADDV^BIVISIT(.BIERR,BIDATA)
"RTN","BIRPC3",171,0)
 D ADDV^BIVISIT(.BIERR,BIDATA,,BINOM)
"RTN","BIRPC3",172,0)
 ;
"RTN","BIRPC3",173,0)
 ;---> If add Visit fails, then return error and quit;
"RTN","BIRPC3",174,0)
 ;---> do NOT delete the old Visit.
"RTN","BIRPC3",175,0)
 I BIERR S BIERR=BI31_$P(BIERR,U,2) Q
"RTN","BIRPC3",176,0)
 ;
"RTN","BIRPC3",177,0)
 ;---> If this is an Edit of an old Visit, then DELETE the old V File entry.
"RTN","BIRPC3",178,0)
 I $G(BIOIEN) D DELETE(.BIERR,BIOIEN,BIVTYPE) Q
"RTN","BIRPC3",179,0)
 ;
"RTN","BIRPC3",180,0)
 ;---> Since this was a New Visit (not an Edit), decrement the Lot Total.
"RTN","BIRPC3",181,0)
 I $G(BILOT) D LOTDECR(BILOT)
"RTN","BIRPC3",182,0)
 ;
"RTN","BIRPC3",183,0)
 Q
"RTN","BIRPC3",184,0)
 ;
"RTN","BIRPC3",185,0)
 ;
"RTN","BIRPC3",186,0)
 ;----------
"RTN","BIRPC3",187,0)
LOTDECR(BILOT) ;PEP - Decrement Lot Total for a given Lot Number.
"RTN","BIRPC3",188,0)
 ;---> Parameters:
"RTN","BIRPC3",189,0)
 ;     1 - BILOT  (req) Lot Number IEN for this Immunization.
"RTN","BIRPC3",190,0)
 ;
"RTN","BIRPC3",191,0)
 Q:'$G(BILOT)  Q:'$D(^AUTTIML(BILOT,0))
"RTN","BIRPC3",192,0)
 N X,Y,Z S X=^AUTTIML(BILOT,0),Y=$P(X,U,11),Z=$P(X,U,12)
"RTN","BIRPC3",193,0)
 ;---> Quit if no Starting Amount (i.e., not tracked).
"RTN","BIRPC3",194,0)
 Q:Y=""
"RTN","BIRPC3",195,0)
 ;---> Okay, decrement Number Unused by 1.
"RTN","BIRPC3",196,0)
 S $P(^AUTTIML(BILOT,0),U,12)=Z-1
"RTN","BIRPC3",197,0)
 ;
"RTN","BIRPC3",198,0)
 Q
"RTN","BIRPC3",199,0)
 ;
"RTN","BIRPC3",200,0)
 ;
"RTN","BIRPC3",201,0)
 ;----------
"RTN","BIRPC3",202,0)
LOTRBAL(BILIEN) ;PEP - Return Remaining Balance (Starting Total - Number Used).
"RTN","BIRPC3",203,0)
 ;---> Parameters:
"RTN","BIRPC3",204,0)
 ;     1 - BILIEN (req) Lot Number IEN for this Immunization.
"RTN","BIRPC3",205,0)
 ;
"RTN","BIRPC3",206,0)
 N BIERR
"RTN","BIRPC3",207,0)
 I '$G(BILIEN) D ERRCD^BIUTL2(511,.BIERR) Q BIERR
"RTN","BIRPC3",208,0)
 I '$D(^AUTTIML(BILIEN,0)) D ERRCD^BIUTL2(512,.BIERR) Q BIERR
"RTN","BIRPC3",209,0)
 N X,Y,Z S X=^AUTTIML(BILIEN,0),Y=$P(X,U,11),Z=$P(X,U,12)
"RTN","BIRPC3",210,0)
 Q:(Y="") "Not tracked"
"RTN","BIRPC3",211,0)
 Q +Z
"RTN","BIRPC3",212,0)
 ;
"RTN","BIRPC3",213,0)
 ;
"RTN","BIRPC3",214,0)
 ;----------
"RTN","BIRPC3",215,0)
LOTEXP(BILIEN,BIYY) ;PEP - Return Lot Expiration Date in format: MM/DD/YYYY.
"RTN","BIRPC3",216,0)
 ;---> Parameters:
"RTN","BIRPC3",217,0)
 ;     1 - BILIEN (req) Lot Number IEN for this Immunization.
"RTN","BIRPC3",218,0)
 ;     2 - BIYY   (opt) If BIYY=1, return 2-digit year: MM/DD/YY.
"RTN","BIRPC3",219,0)
 ;                      If BIYY=2, return Fileman format of date.
"RTN","BIRPC3",220,0)
 ;
"RTN","BIRPC3",221,0)
 I '$G(BILIEN) D ERRCD^BIUTL2(511,.BIERR) Q BIERR
"RTN","BIRPC3",222,0)
 I '$D(^AUTTIML(BILIEN,0)) D ERRCD^BIUTL2(512,.BIERR) Q BIERR
"RTN","BIRPC3",223,0)
 N BIDATE S BIDATE=$P(^AUTTIML(BILIEN,0),U,9)
"RTN","BIRPC3",224,0)
 Q:($G(BIYY)=2) BIDATE
"RTN","BIRPC3",225,0)
 Q $$SLDT2^BIUTL5(BIDATE,$G(BIYY))
"RTN","BIRPC3",226,0)
 ;
"RTN","BIRPC3",227,0)
 ;
"RTN","BIRPC3",228,0)
 ;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIRPC3",229,0)
 ;---> New LOTCHK subroutine to combine all checks for valid Lot Number.
"RTN","BIRPC3",230,0)
 ;----------
"RTN","BIRPC3",231,0)
LOTCHK(BILOT,BIVAC,BICAT,BIERR) ;EP
"RTN","BIRPC3",232,0)
 ;---> Check for valid Lot Number given the Vaccine passed.
"RTN","BIRPC3",233,0)
 ;---> Parameters:
"RTN","BIRPC3",234,0)
 ;     1 - BILOT (req) IEN of Lot Number.
"RTN","BIRPC3",235,0)
 ;     2 - BIVAC (req) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIRPC3",236,0)
 ;     3 - BICAT (opt) Category of Visit.
"RTN","BIRPC3",237,0)
 ;     4 - BIERR (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC3",238,0)
 ;
"RTN","BIRPC3",239,0)
 ;---> Check a) Valid Vaccine and Lot Number
"RTN","BIRPC3",240,0)
 ;--->       b) Lot Number has been assigned to the Vaccine passed;
"RTN","BIRPC3",241,0)
 ;--->       b) Lot Number is Active
"RTN","BIRPC3",242,0)
 ;--->       c) Lot Number does not have duplicates
"RTN","BIRPC3",243,0)
 ;
"RTN","BIRPC3",244,0)
 S BIERR=""
"RTN","BIRPC3",245,0)
 ;
"RTN","BIRPC3",246,0)
 ;---> If Lot# IEN not passed, set Error and quit.
"RTN","BIRPC3",247,0)
 I '$G(BILOT) D ERRCD^BIUTL2(511,.BIERR) Q
"RTN","BIRPC3",248,0)
 ;
"RTN","BIRPC3",249,0)
 ;---> If Vaccine IEN not passed, set Error and quit.
"RTN","BIRPC3",250,0)
 I '$G(BILOT) D ERRCD^BIUTL2(502,.BIERR) Q
"RTN","BIRPC3",251,0)
 ;
"RTN","BIRPC3",252,0)
 ;---> Set Y=^AUTTIML(BILOT,0).
"RTN","BIRPC3",253,0)
 N Y S Y=$G(^AUTTIML(BILOT,0))
"RTN","BIRPC3",254,0)
 ;
"RTN","BIRPC3",255,0)
 ;---> If Lot# does not exist, set Error and quit.
"RTN","BIRPC3",256,0)
 I Y="" D  Q
"RTN","BIRPC3",257,0)
 .D ERRCD^BIUTL2(512,.BIERR)
"RTN","BIRPC3",258,0)
 ;
"RTN","BIRPC3",259,0)
 ;---> If this Lot# does NOT point back to this Vaccine, set Error and quit.
"RTN","BIRPC3",260,0)
 I $P(Y,U,4)'=BIVAC D ERRCD^BIUTL2(513,.BIERR) Q
"RTN","BIRPC3",261,0)
 ;
"RTN","BIRPC3",262,0)
 ;---> If the Lot# is INACTIVE (attempted save of earlier visit
"RTN","BIRPC3",263,0)
 ;---> with Lot# previously chosen), set Error Code and quit.
"RTN","BIRPC3",264,0)
 ;
"RTN","BIRPC3",265,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC3",266,0)
 ;---> If Category=Historical Event, Lot need not be Active.
"RTN","BIRPC3",267,0)
 ;I $P(Y,U,3) D ERRCD^BIUTL2(426,.BIERR) Q
"RTN","BIRPC3",268,0)
 I ($P(Y,U,3)&($G(BICAT)'="E")) D ERRCD^BIUTL2(426,.BIERR) Q
"RTN","BIRPC3",269,0)
 ;**********
"RTN","BIRPC3",270,0)
 ;
"RTN","BIRPC3",271,0)
 ;---> If Lot# is duplicated in the IMM LOT File, set Error and quit.
"RTN","BIRPC3",272,0)
 I $$LOTDUP^BIUTL4(BILOT) D ERRCD^BIUTL2(427,.BIERR)
"RTN","BIRPC3",273,0)
 ;
"RTN","BIRPC3",274,0)
 Q
"RTN","BIRPC3",275,0)
 ;**********
"RTN","BIRPC3",276,0)
 ;
"RTN","BIRPC3",277,0)
 ;
"RTN","BIRPC3",278,0)
 ;----------
"RTN","BIRPC3",279,0)
DELETE(BIERR,BIDA,BIVTYPE) ;PEP - Delete an Immunization or Skin Test.
"RTN","BIRPC3",280,0)
 ;---> Delete an Immunization or Skin Test.
"RTN","BIRPC3",281,0)
 ;---> Called by RPC: BI VISIT DELETE.
"RTN","BIRPC3",282,0)
 ;---> Parameters:
"RTN","BIRPC3",283,0)
 ;     1 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC3",284,0)
 ;     2 - BIDA    (req) IEN of V IMM or V SKIN entry to be deleted.
"RTN","BIRPC3",285,0)
 ;     3 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC3",286,0)
 ;
"RTN","BIRPC3",287,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC3",288,0)
 N BI31 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC3",289,0)
 ;
"RTN","BIRPC3",290,0)
 ;---> If DA not supplied, set Error Code and quit.
"RTN","BIRPC3",291,0)
 I '$G(BIDA) D  Q
"RTN","BIRPC3",292,0)
 .D ERRCD^BIUTL2(404,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",293,0)
 ;
"RTN","BIRPC3",294,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIRPC3",295,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIRPC3",296,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIRPC3",297,0)
 .D ERRCD^BIUTL2(410,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",298,0)
 ;
"RTN","BIRPC3",299,0)
 ;---> Delete V IMMUNIZATION entry.
"RTN","BIRPC3",300,0)
 D DELETE^BIVISIT2(BIDA,BIVTYPE,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",301,0)
 Q
"RTN","BIRPC4")
0^133^B78239729
"RTN","BIRPC4",1,0)
BIRPC4 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC4",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIRPC4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC4",4,0)
 ;;  ADD AND DELETE CONTRAINDICATIONS, EDIT PATIENT CASE DATA.
"RTN","BIRPC4",5,0)
 ;;  PATCH 5: Switch to logical deletions of Contraindications.  DELCONT+14
"RTN","BIRPC4",6,0)
 ;;  PATCH 5: Add SNOMED Codes for Contraindication.  ADDCONT+54, SNOMED
"RTN","BIRPC4",7,0)
 ;
"RTN","BIRPC4",8,0)
 ;
"RTN","BIRPC4",9,0)
 ;----------
"RTN","BIRPC4",10,0)
ADDCONT(BIERR,BIDATA) ;PEP - Add a Contraindication.
"RTN","BIRPC4",11,0)
 ;---> Add Contraindication for a patient.
"RTN","BIRPC4",12,0)
 ;---> Called by RPC: BI CONTRAINDICATION ADD.
"RTN","BIRPC4",13,0)
 ;---> Parameters:
"RTN","BIRPC4",14,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC4",15,0)
 ;     2 - BIDATA (req) String of data for the Contraindication to be added.
"RTN","BIRPC4",16,0)
 ;                      Data elements are parsed by "|" as follows:
"RTN","BIRPC4",17,0)
 ;                      Patient IEN|Vaccine IEN|Contra Reason IEN|Date Noted|Edit Flag
"RTN","BIRPC4",18,0)
 ;
"RTN","BIRPC4",19,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC4",20,0)
 N BI31 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC4",21,0)
 ;
"RTN","BIRPC4",22,0)
 ;---> If BIDATA not supplied, set Error Code and quit.
"RTN","BIRPC4",23,0)
 I $G(BIDATA)']"" D  Q
"RTN","BIRPC4",24,0)
 .D ERRCD^BIUTL2(416,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",25,0)
 ;
"RTN","BIRPC4",26,0)
 ;---> Break out BIDATA into pieces.
"RTN","BIRPC4",27,0)
 N BICRIEN,BIDATE,BIDFN,BIEDIT,BIMDEF,BIVIEN
"RTN","BIRPC4",28,0)
 S BIDFN=$P(BIDATA,"|",1)   ;Patient DFN.
"RTN","BIRPC4",29,0)
 S BIVIEN=$P(BIDATA,"|",2)  ;Vaccine IEN.
"RTN","BIRPC4",30,0)
 S BICRIEN=$P(BIDATA,"|",3) ;Contraindication Reason IEN.
"RTN","BIRPC4",31,0)
 S BIDATE=$P(BIDATA,"|",4)  ;Date Noted.
"RTN","BIRPC4",32,0)
 S BIEDIT=$P(BIDATA,"|",5)  ;If BIEDIT=1, this is an Edit.
"RTN","BIRPC4",33,0)
 ;
"RTN","BIRPC4",34,0)
 ;---> If valid Patient DFN not provided, set Error Code and quit.
"RTN","BIRPC4",35,0)
 I ('BIDFN)!('$D(^AUPNPAT(BIDFN,0))) D  Q
"RTN","BIRPC4",36,0)
 .D ERRCD^BIUTL2(417,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",37,0)
 ;
"RTN","BIRPC4",38,0)
 ;---> If valid Vaccine IEN not provided, set Error Code and quit.
"RTN","BIRPC4",39,0)
 I ('BIVIEN)!('$D(^AUTTIMM(BIVIEN,0))) D  Q
"RTN","BIRPC4",40,0)
 .D ERRCD^BIUTL2(418,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",41,0)
 ;
"RTN","BIRPC4",42,0)
 ;---> If IEN for Contra Reason is not valid, set Error Code and quit.
"RTN","BIRPC4",43,0)
 ;I BICRIEN I '$D(^BICONT(BICRIEN,0)) D  Q
"RTN","BIRPC4",44,0)
 I BICRIEN I '$D(^PXV(920.4,BICRIEN,0)) D  Q
"RTN","BIRPC4",45,0)
 .D ERRCD^BIUTL2(419,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",46,0)
 ;
"RTN","BIRPC4",47,0)
 ;---> Check if Contra already exists for this reason; quit if duplicate.
"RTN","BIRPC4",48,0)
 N BIQUIT,N,X S BIQUIT=0
"RTN","BIRPC4",49,0)
 I '$G(BIEDIT) D
"RTN","BIRPC4",50,0)
 .S X=BIDFN_"^"_BIVIEN_"^"_BICRIEN
"RTN","BIRPC4",51,0)
 .S N=0
"RTN","BIRPC4",52,0)
 .F  S N=$O(^BIPC("B",BIDFN,N)) Q:'N  Q:BIQUIT  D
"RTN","BIRPC4",53,0)
 ..I $P(^BIPC(N,0),U,1,3)=X S BIQUIT=1 D  Q
"RTN","BIRPC4",54,0)
 ...D ERRCD^BIUTL2(439,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",55,0)
 Q:BIQUIT
"RTN","BIRPC4",56,0)
 ;
"RTN","BIRPC4",57,0)
 ;---> If this patient is Immune Deficient, use BIMDEF array below
"RTN","BIRPC4",58,0)
 ;---> to add other live vaccines as contraindicated.
"RTN","BIRPC4",59,0)
 ;
"RTN","BIRPC4",60,0)
 ; ^PXV(920.4,"C","VXC27",20)="" <-- Immune deficiency; record 20.
"RTN","BIRPC4",61,0)
 ; Record locked down by MFS. We can rely on its presence at record 20.
"RTN","BIRPC4",62,0)
 ; VXC27 is defined by OID 2.16.840.1.114222.4.11.3288 Vaccine Contraindications
"RTN","BIRPC4",63,0)
 ; http://www.cdc.gov/vaccines/programs/iis/technical-guidance/downloads/hl7guide-1-5-Mar2014.pdf
"RTN","BIRPC4",64,0)
 ;
"RTN","BIRPC4",65,0)
 ; Old RPMS code; won't use for RPMS nor VISTA.
"RTN","BIRPC4",66,0)
 ; I $P($G(^BICONT(+BICRIEN,0)),U)="Immune Deficiency" D
"RTN","BIRPC4",67,0)
 ; .S BIMDEF("C")=BICRIEN,BIMDEF("D")=BIDATE
"RTN","BIRPC4",68,0)
 ;
"RTN","BIRPC4",69,0)
 I +BICRIEN=20 S BIMDEF("C")=BICRIEN,BIMDEF("D")=BIDATE
"RTN","BIRPC4",70,0)
 ;
"RTN","BIRPC4",71,0)
 ;---> Get CDC concept code (may be SNOMED)
"RTN","BIRPC4",72,0)
 N CDCCON S CDCCON=$P(^PXV(920.4,BICRIEN,0),U,2)
"RTN","BIRPC4",73,0)
 ;
"RTN","BIRPC4",74,0)
 ;---> ADD Contraindication w/ Concept
"RTN","BIRPC4",75,0)
 N DIERR,BIFDA,BIIEN,BIERR,BIMSG
"RTN","BIRPC4",76,0)
 S BIFDA(9002084.11,"+1,",.01)=BIDFN   ; pt
"RTN","BIRPC4",77,0)
 S BIFDA(9002084.11,"+1,",.02)=BIVIEN  ; vaccine
"RTN","BIRPC4",78,0)
 S BIFDA(9002084.11,"+1,",.03)=BICRIEN ; ci
"RTN","BIRPC4",79,0)
 S BIFDA(9002084.11,"+1,",.04)=BIDATE  ; recording data
"RTN","BIRPC4",80,0)
 S BIFDA(9002084.111,"+2,+1,",.01)=CDCCON ; concept
"RTN","BIRPC4",81,0)
 D UPDATE^DIE(,$NA(BIFDA),$NA(BIIEN),$NA(BIMSG))
"RTN","BIRPC4",82,0)
 I $D(DIERR) S BIERR=BIMSG("DIERR",1,"TEXT",1)
"RTN","BIRPC4",83,0)
 ;
"RTN","BIRPC4",84,0)
 ;---> If add contraindication fails, set Error Code and quit.
"RTN","BIRPC4",85,0)
 I $G(BIERR)]"" D  QUIT  ; <---------- QUIT HERE
"RTN","BIRPC4",86,0)
 .N X S X=BIERR
"RTN","BIRPC4",87,0)
 .D ERRCD^BIUTL2(420,.BIERR) S BIERR=BI31_BIERR_" "_X
"RTN","BIRPC4",88,0)
 ;
"RTN","BIRPC4",89,0)
 ;---> If add of Contra is successful, BIIEN(1)=IEN of new Patient Contra,
"RTN","BIRPC4",90,0)
 ;---> so add extra SNOMED Codes (IHS only)
"RTN","BIRPC4",91,0)
 ; TODO: This is certainly different for VISTA; perhaps change this for RPMS
"RTN","BIRPC4",92,0)
 ; as well?
"RTN","BIRPC4",93,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC4",94,0)
 ;---> Add SNOMED Codes for this Contraindication.
"RTN","BIRPC4",95,0)
 D:$G(BIIEN(1))&$$RPMS^BIUTL9() SNOMED0(BIVIEN,BICRIEN,.BIIEN)
"RTN","BIRPC4",96,0)
 ;**********
"RTN","BIRPC4",97,0)
 ;
"RTN","BIRPC4",98,0)
 ; NOW REALLY---A REFUSAL IS A CONTRAINDICATION????
"RTN","BIRPC4",99,0)
 ; VEN/SMH - COMMENTING OUT
"RTN","BIRPC4",100,0)
 ;---> If this is a Refusal, add it to PATIENT REFUSALS FOR SERVICE/NMI
"RTN","BIRPC4",101,0)
 ;---> File #9000022.
"RTN","BIRPC4",102,0)
 ;D:((BICRIEN=11)!(BICRIEN=16))
"RTN","BIRPC4",103,0)
 ;.N BIREFI S BIREFI=$$VNAME^BIUTL2(BIVIEN)_" - "_$$CONTXT^BIUTL6(BICRIEN)
"RTN","BIRPC4",104,0)
 ;.D REFUSAL("IMMUNIZATION",BIDFN,BIDATE,BIREFI,9999999.14,BIVIEN,"R",$G(DUZ))
"RTN","BIRPC4",105,0)
 ;
"RTN","BIRPC4",106,0)
 ;
"RTN","BIRPC4",107,0)
 ;---> Add Adverse Reaction to ART Package.
"RTN","BIRPC4",108,0)
 ;---> Sept 2005: Not possible at this time.
"RTN","BIRPC4",109,0)
 ;---> VEN/SMH - 2015, 10 years later. I still don't think we can do it.
"RTN","BIRPC4",110,0)
 I (BICRIEN=4)!(BICRIEN=8)!(BICRIEN=9) D
"RTN","BIRPC4",111,0)
 .;SEND EVENT(?) TO ART PACKAGE.
"RTN","BIRPC4",112,0)
 ;
"RTN","BIRPC4",113,0)
 ;---> Quit if this patient is not Immune Deficient.
"RTN","BIRPC4",114,0)
 Q:'$D(BIMDEF)
"RTN","BIRPC4",115,0)
 ;
"RTN","BIRPC4",116,0)
 ;---> Patient is Immune Deficient, so add MMR, Varicella, & Flu-Nasal
"RTN","BIRPC4",117,0)
 ;---> contraindications.
"RTN","BIRPC4",118,0)
 ;---> Imm v8.5: added all Rotavirus, per Ros.
"RTN","BIRPC4",119,0)
 N BIHL7
"RTN","BIRPC4",120,0)
 F BIHL7=3,21,111,74,116,119,122 D
"RTN","BIRPC4",121,0)
 .N BIIEN,DR S BIIEN=$$HL7TX^BIUTL2(BIHL7)
"RTN","BIRPC4",122,0)
 .;
"RTN","BIRPC4",123,0)
 .N BIADD,N S N=0,BIADD=1
"RTN","BIRPC4",124,0)
 .;---> Loop through patient's existing contraindications.
"RTN","BIRPC4",125,0)
 .F  S N=$O(^BIPC("B",BIDFN,N)) Q:'N  Q:'BIADD  D
"RTN","BIRPC4",126,0)
 ..N X S X=$G(^BIPC(N,0))
"RTN","BIRPC4",127,0)
 ..Q:'X
"RTN","BIRPC4",128,0)
 ..;---> Quit (BIADD=0) if this contra & reason already exists.
"RTN","BIRPC4",129,0)
 ..I $P(X,U,2)=BIIEN&($P(X,U,3)=BIMDEF("C")) S BIADD=0
"RTN","BIRPC4",130,0)
 .Q:'BIADD
"RTN","BIRPC4",131,0)
 .;
"RTN","BIRPC4",132,0)
 .;---> Add contraindication with a reason of Immune Deficiency.
"RTN","BIRPC4",133,0)
 .N BIERR,BIFLD
"RTN","BIRPC4",134,0)
 .S BIFLD(.01)=BIDFN,BIFLD(.02)=BIIEN
"RTN","BIRPC4",135,0)
 .S BIFLD(.03)=BIMDEF("C"),BIFLD(.04)=BIMDEF("D")
"RTN","BIRPC4",136,0)
 .D UPDATE^BIFMAN(9002084.11,,.BIFLD,.BIERR)
"RTN","BIRPC4",137,0)
 QUIT
"RTN","BIRPC4",138,0)
 ;
"RTN","BIRPC4",139,0)
 ;---> Add extra SNOMED Codes for this Contraindication (IHS)
"RTN","BIRPC4",140,0)
 ;---> (VEN/SMH - I really don't know if this is needed)
"RTN","BIRPC4",141,0)
 ;----------
"RTN","BIRPC4",142,0)
SNOMED0(BIVIEN,BICRIEN,BIIEN) ; EP only for IHS - Prep to add SNOMED data.
"RTN","BIRPC4",143,0)
 ; VEN/SMH Moved down here for code clarity as only applicable for RPMS
"RTN","BIRPC4",144,0)
 ; ---> Internal Call to call SNOMED below; this does the actual filing
"RTN","BIRPC4",145,0)
 ; ---> Pars:
"RTN","BIRPC4",146,0)
 ; ---> - BIVIEN  Vaccine IEN
"RTN","BIRPC4",147,0)
 ; ---> - BICRIEN CI IEN
"RTN","BIRPC4",148,0)
 ; ---> - BIIEN (ref) BIIEN(1) contains the recored obtained by UPDATE^DIE
"RTN","BIRPC4",149,0)
 N I,X,Y
"RTN","BIRPC4",150,0)
 ;---> Get string of Vaccine Component IEN's.
"RTN","BIRPC4",151,0)
 S X=$$VCOMPS^BIUTL2(BIVIEN)
"RTN","BIRPC4",152,0)
 ;---> If no components process the vaccine itself.
"RTN","BIRPC4",153,0)
 S:('+X) X=BIVIEN
"RTN","BIRPC4",154,0)
 ;
"RTN","BIRPC4",155,0)
 F I=1:1:6 S Y=$P(X,";",I) Q:'Y  D
"RTN","BIRPC4",156,0)
 .;---> Get Vaccine Group IEN of this vaccine.
"RTN","BIRPC4",157,0)
 .N BIVGRP S BIVGRP=$$IMMVG^BIUTL2(Y)
"RTN","BIRPC4",158,0)
 .;---> Quit if Vaccine Group is Other, Skin Test, or Combo.
"RTN","BIRPC4",159,0)
 .Q:((BIVGRP=12)!(BIVGRP=13)!(BIVGRP=14)!(BIVGRP<1))
"RTN","BIRPC4",160,0)
 .;---> Call Lori's Magic Mapper to get SNOMED Code.
"RTN","BIRPC4",161,0)
 .D SNOMED(BIVGRP,BICRIEN,BIIEN(1))
"RTN","BIRPC4",162,0)
 QUIT
"RTN","BIRPC4",163,0)
 ;
"RTN","BIRPC4",164,0)
SNOMED(BIVGRP,BICRIEN,BIIEN) ;PP - Add SNOMED data.
"RTN","BIRPC4",165,0)
 ;---> File SNOMED data for this Contraindication.
"RTN","BIRPC4",166,0)
 ;---> Parameters:
"RTN","BIRPC4",167,0)
 ;     1 - BIVGRP  (req) Vaccine Group IEN.
"RTN","BIRPC4",168,0)
 ;     2 - BICRIEN (req) Contraindication Reason IEN.
"RTN","BIRPC4",169,0)
 ;     3 - BIIEN   (req) Patient Contraindication IEN.
"RTN","BIRPC4",170,0)
 ;
"RTN","BIRPC4",171,0)
 Q:'$G(BIVGRP)  Q:'$G(BICRIEN)  Q:'$G(BIIEN)
"RTN","BIRPC4",172,0)
 N BICODES,Z
"RTN","BIRPC4",173,0)
 ;---> Call Mapper to set up BICODES Array of SNOMED Code(s).
"RTN","BIRPC4",174,0)
 ;---> Quit if BCQM not installed.
"RTN","BIRPC4",175,0)
 Q:('$L($T(MM^BCQMAPI)))
"RTN","BIRPC4",176,0)
 ;---> First clear out old SNOMED Codes for this Contra if they exist.
"RTN","BIRPC4",177,0)
 K ^BIPC(BIIEN,1)
"RTN","BIRPC4",178,0)
 ;---> Get array of Codes for this entry.
"RTN","BIRPC4",179,0)
 S Z=$$MM^BCQMAPI(9002084.81,BICRIEN,"I",BIVGRP,,,,,,,"BICODES")
"RTN","BIRPC4",180,0)
 N BIFDA,J S J=0
"RTN","BIRPC4",181,0)
 F  S J=$O(BICODES(J)) Q:'J  D
"RTN","BIRPC4",182,0)
 .N BISNOMED S BISNOMED=BICODES(J,"SNOMED")
"RTN","BIRPC4",183,0)
 .S BIFDA(9002084.111,"+"_J_","_BIIEN_",",.01)=BISNOMED
"RTN","BIRPC4",184,0)
 ;---> Now file these.
"RTN","BIRPC4",185,0)
 D UPDATE^DIE("","BIFDA")
"RTN","BIRPC4",186,0)
 Q
"RTN","BIRPC4",187,0)
 ;**********
"RTN","BIRPC4",188,0)
 ;
"RTN","BIRPC4",189,0)
 ;----------
"RTN","BIRPC4",190,0)
DELCONT(BIERR,BICIEN) ;PEP - Add a Contraindication.
"RTN","BIRPC4",191,0)
 ;---> Delete a Contraindication.
"RTN","BIRPC4",192,0)
 ;---> Called by RPC: BI CONTRAINDICATION DELETE.
"RTN","BIRPC4",193,0)
 ;---> Parameters:
"RTN","BIRPC4",194,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC4",195,0)
 ;     2 - BICIEN (req) IEN of BI CONTRAINDICATION to be deleted.
"RTN","BIRPC4",196,0)
 ;
"RTN","BIRPC4",197,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC4",198,0)
 N BI31 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC4",199,0)
 ;
"RTN","BIRPC4",200,0)
 ;---> If DA not supplied, set Error Code and quit.
"RTN","BIRPC4",201,0)
 I '$G(BICIEN) D  Q
"RTN","BIRPC4",202,0)
 .D ERRCD^BIUTL2(414,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",203,0)
 ;
"RTN","BIRPC4",204,0)
 ;
"RTN","BIRPC4",205,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC4",206,0)
 ;---> Switch to logical deletion of Contraindications.
"RTN","BIRPC4",207,0)
 ;---> First copy Contra nodes to Deleted file, then delete Contra.
"RTN","BIRPC4",208,0)
 ;
"RTN","BIRPC4",209,0)
 ;---> Quit if bad IEN for Contra.
"RTN","BIRPC4",210,0)
 I '$D(^BIPC(BICIEN,0)) D  Q
"RTN","BIRPC4",211,0)
 .D ERRCD^BIUTL2(448,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",212,0)
 ;---> Quit if bad Patient DFN for Contra.
"RTN","BIRPC4",213,0)
 N BIDFN,BINODE
"RTN","BIRPC4",214,0)
 S BINODE=^BIPC(BICIEN,0),BIDFN=$P(BINODE,U)
"RTN","BIRPC4",215,0)
 I 'BIDFN D  Q
"RTN","BIRPC4",216,0)
 .D ERRCD^BIUTL2(417,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",217,0)
 ;
"RTN","BIRPC4",218,0)
 ;---> Create an entry in BI PATIENT CONTRAINDICATION DELETED File.
"RTN","BIRPC4",219,0)
 N BIERR,BIIEN,BIFLD
"RTN","BIRPC4",220,0)
 S BIFLD(.01)=BIDFN
"RTN","BIRPC4",221,0)
 S BIFLD(.02)=$P(BINODE,U,2)
"RTN","BIRPC4",222,0)
 S BIFLD(.03)=$P(BINODE,U,3)
"RTN","BIRPC4",223,0)
 S BIFLD(.04)=$P(BINODE,U,4)
"RTN","BIRPC4",224,0)
 S BIFLD(2.01)=+$G(DUZ)
"RTN","BIRPC4",225,0)
 N % D NOW^%DTC S BIFLD(2.02)=%
"RTN","BIRPC4",226,0)
 D UPDATE^BIFMAN(9002084.115,.BIIEN,.BIFLD,.BIERR)
"RTN","BIRPC4",227,0)
 ;---> Quit if new entry failed.
"RTN","BIRPC4",228,0)
 I BIERR]"" S BIERR=BI31_BIERR Q
"RTN","BIRPC4",229,0)
 ;---> Quit if new entry IEN bad.
"RTN","BIRPC4",230,0)
 I '$D(^BIPCD(+BIIEN(1),0)) D  Q
"RTN","BIRPC4",231,0)
 .D ERRCD^BIUTL2(449,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",232,0)
 ;**********
"RTN","BIRPC4",233,0)
 ;
"RTN","BIRPC4",234,0)
 ;---> Okay, now delete BI CONTRAINDICATION entry.
"RTN","BIRPC4",235,0)
 N DA,DIK S DA=BICIEN,DIK="^BIPC("
"RTN","BIRPC4",236,0)
 D ^DIK
"RTN","BIRPC4",237,0)
 ;
"RTN","BIRPC4",238,0)
 ;---> Don't need to copy SNOMED fields, but save for prototype code.
"RTN","BIRPC4",239,0)
 ;I $D(^BIPC(BICIEN,1,0)) S ^BIPCD(BIIEN,1,0)=^BIPC(BICIEN,1,0)
"RTN","BIRPC4",240,0)
 ;N N S N=0 F  S N=$O(^BIPC(BICIEN,1,N)) Q:'N  D
"RTN","BIRPC4",241,0)
 ;.N BISNO S BISNO=^BIPC(BICIEN,1,N,0),^BIPCD(BIIEN,1,N,0)=BISNO
"RTN","BIRPC4",242,0)
 ;.S ^BIPCD(BIIEN,1,"B",BISNO,N)=""
"RTN","BIRPC4",243,0)
 ;**********
"RTN","BIRPC4",244,0)
 ;
"RTN","BIRPC4",245,0)
 Q
"RTN","BIRPC4",246,0)
 ;
"RTN","BIRPC4",247,0)
 ;
"RTN","BIRPC4",248,0)
 ;----------
"RTN","BIRPC4",249,0)
EDITCAS(BIERR,BIDATA) ;EP
"RTN","BIRPC4",250,0)
 ;---> Edit a Patient's Case Data.
"RTN","BIRPC4",251,0)
 ;---> Called by RPC: BI ?
"RTN","BIRPC4",252,0)
 ;---> Parameters:
"RTN","BIRPC4",253,0)
 ;     1 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC4",254,0)
 ;     2 - BIDATA  (req) String of Patient's Case Data to be edited.
"RTN","BIRPC4",255,0)
 ;
"RTN","BIRPC4",256,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC4",257,0)
 N BI31,U S BI31=$C(31)_$C(31),BIERR="",U="^"
"RTN","BIRPC4",258,0)
 ;
"RTN","BIRPC4",259,0)
 ;---> If BIDATA not supplied, set Error Code and quit.
"RTN","BIRPC4",260,0)
 I $G(BIDATA)']"" D  Q
"RTN","BIRPC4",261,0)
 .D ERRCD^BIUTL2(207,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",262,0)
 ;
"RTN","BIRPC4",263,0)
 ;---> Break out BIDATA into pieces.
"RTN","BIRPC4",264,0)
 N A,B,C,D,E,F,G,H,I,J,K
"RTN","BIRPC4",265,0)
 S A=$P(BIDATA,U,1)    ;Patient DFN.
"RTN","BIRPC4",266,0)
 S B=$P(BIDATA,U,2)    ;IEN of Case Manager.
"RTN","BIRPC4",267,0)
 S C=$P(BIDATA,U,3)    ;Parent or Guardian, text.
"RTN","BIRPC4",268,0)
 S D=$P(BIDATA,U,4)    ;Mother's HBsAG Status (P,N,A,U).
"RTN","BIRPC4",269,0)
 S E=$P(BIDATA,U,5)    ;Date Patient became Inactive (external format).
"RTN","BIRPC4",270,0)
 S F=$P(BIDATA,U,6)    ;Reason for Inactive.
"RTN","BIRPC4",271,0)
 S G=$P(BIDATA,U,7)    ;Other Info.
"RTN","BIRPC4",272,0)
 S H=$P(BIDATA,U,8)    ;Forecast Influ/Pneumo.
"RTN","BIRPC4",273,0)
 S I=$P(BIDATA,U,9)    ;Location Moved or Tx Elsewhere.
"RTN","BIRPC4",274,0)
 S J=$P(BIDATA,U,10)   ;IEN of User who Inactivated this patient.
"RTN","BIRPC4",275,0)
 S K=$P(BIDATA,U,11)   ;Consent State Registry.
"RTN","BIRPC4",276,0)
 ;
"RTN","BIRPC4",277,0)
 ;---> If valid Patient DFN not provided, set Error Code and quit.
"RTN","BIRPC4",278,0)
 I ('A)!('$D(^BIP(+A,0))) D  Q
"RTN","BIRPC4",279,0)
 .D ERRCD^BIUTL2(206,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",280,0)
 ;
"RTN","BIRPC4",281,0)
 ;---> If Case Manager is null (possibly deleted), send @ to delete.
"RTN","BIRPC4",282,0)
 S:'B B="@"
"RTN","BIRPC4",283,0)
 ;
"RTN","BIRPC4",284,0)
 ;---> If valid Case Manager IEN not provided, set Error Code and quit.
"RTN","BIRPC4",285,0)
 I B&('$D(^BIMGR(+B,0))) D  Q
"RTN","BIRPC4",286,0)
 .D ERRCD^BIUTL2(208,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",287,0)
 ;
"RTN","BIRPC4",288,0)
 ;---> If Case Manager is INACTIVE, set Error Code and quit.
"RTN","BIRPC4",289,0)
 I B,$$CMGRACT^BIUTL2(B) D  Q
"RTN","BIRPC4",290,0)
 .D ERRCD^BIUTL2(213,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",291,0)
 ;
"RTN","BIRPC4",292,0)
 ;---> If Inactive Date was set but no Reason given, set Error Code and quit.
"RTN","BIRPC4",293,0)
 I (E]"")&(F="") D  Q
"RTN","BIRPC4",294,0)
 .D ERRCD^BIUTL2(219,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",295,0)
 ;
"RTN","BIRPC4",296,0)
 ;---> If Parent or Guardian="" or was deleted, set C="@" to delete.
"RTN","BIRPC4",297,0)
 S:C="" C="@" S C=$$TR(.C)
"RTN","BIRPC4",298,0)
 ;
"RTN","BIRPC4",299,0)
 ;---> If Mother's HGsAG Status not valid, set to null.
"RTN","BIRPC4",300,0)
 S:"PANU"'[D D=""
"RTN","BIRPC4",301,0)
 ;
"RTN","BIRPC4",302,0)
 ;---> If Inactive Date is null (possibly deleted), send @ to delete.
"RTN","BIRPC4",303,0)
 ;---> If Date is valid, convert to Fileman format.
"RTN","BIRPC4",304,0)
 D
"RTN","BIRPC4",305,0)
 .I E="" S E="@" Q
"RTN","BIRPC4",306,0)
 .N %DT,X,Y S X=E
"RTN","BIRPC4",307,0)
 .D ^%DT S E=Y
"RTN","BIRPC4",308,0)
 ;
"RTN","BIRPC4",309,0)
 ;---> If Inactive Date=@, set Reason for Inactive and Inactivated by User
"RTN","BIRPC4",310,0)
 ;---> both ="" (E,F="" to delete).
"RTN","BIRPC4",311,0)
 S:(E="@"!(F="")) (F,J)="" S F=$$TR(.F)
"RTN","BIRPC4",312,0)
 ;
"RTN","BIRPC4",313,0)
 ;---> If Date is invalid, set Error Code and quit.
"RTN","BIRPC4",314,0)
 I E=-1 D  Q
"RTN","BIRPC4",315,0)
 .D ERRCD^BIUTL2(209,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC4",316,0)
 ;
"RTN","BIRPC4",317,0)
 ;---> If Other Info="" or was deleted, set G="@" to delete.
"RTN","BIRPC4",318,0)
 S:G="" G="@" S G=$$TR(.G)
"RTN","BIRPC4",319,0)
 ;
"RTN","BIRPC4",320,0)
 ;---> If Forecast Influ/Pneumo is not valid, set to null.
"RTN","BIRPC4",321,0)
 S:"01234"'[H H="" S:H="" H="@"
"RTN","BIRPC4",322,0)
 ;
"RTN","BIRPC4",323,0)
 ;---> Build FDA field=value array.
"RTN","BIRPC4",324,0)
 N BIFLD
"RTN","BIRPC4",325,0)
 S BIFLD(.08)=E
"RTN","BIRPC4",326,0)
 S BIFLD(.09)=C
"RTN","BIRPC4",327,0)
 S BIFLD(.1)=B
"RTN","BIRPC4",328,0)
 S BIFLD(.11)=D
"RTN","BIRPC4",329,0)
 S BIFLD(.12)=I
"RTN","BIRPC4",330,0)
 S BIFLD(.13)=G
"RTN","BIRPC4",331,0)
 S BIFLD(.15)=H
"RTN","BIRPC4",332,0)
 S BIFLD(.16)=F
"RTN","BIRPC4",333,0)
 S BIFLD(.23)=J
"RTN","BIRPC4",334,0)
 S BIFLD(.24)=K
"RTN","BIRPC4",335,0)
 ;
"RTN","BIRPC4",336,0)
 ;---> Store edit data.
"RTN","BIRPC4",337,0)
 D FDIE^BIFMAN(9002084,+A,.BIFLD,.BIERR)
"RTN","BIRPC4",338,0)
 S:BIERR["" BIERR=BI31_BIERR
"RTN","BIRPC4",339,0)
 Q
"RTN","BIRPC4",340,0)
 ;
"RTN","BIRPC4",341,0)
 ;
"RTN","BIRPC4",342,0)
 ;----------
"RTN","BIRPC4",343,0)
REFUSAL(BIREFT,BIDFN,BIDATE,BIREFI,BIREFF,BIREFV,BIREFR,BIPROV,BIERR) ;EP
"RTN","BIRPC4",344,0)
 ;---> Add a Refusal to the PATIENT REFUSALS FOR SERVICE/NMI File #9000022.
"RTN","BIRPC4",345,0)
 ;---> Parameters:
"RTN","BIRPC4",346,0)
 ;     1 - BIREFT (req) Text of Refusal Type in REFUSAL TYPE File #9999999.73.
"RTN","BIRPC4",347,0)
 ;     2 - BIDFN  (req) Patient DFN, .02.
"RTN","BIRPC4",348,0)
 ;     3 - BIDATE (req) Date (Fman) refused or not indicated, .03.
"RTN","BIRPC4",349,0)
 ;     4 - BIREFI (req) Refusal Item (80 characters of free text), .04.
"RTN","BIRPC4",350,0)
 ;     5 - BIREFF (req) Pointer file (Immunization #9999999.14), .05
"RTN","BIRPC4",351,0)
 ;     6 - BIREFV (req) Pointer Value (IEN of vaccine in #9999999.14), .06
"RTN","BIRPC4",352,0)
 ;     7 - BIREFR (opt) Reason for Refusal (set of codes), .07
"RTN","BIRPC4",353,0)
 ;     8 - BIPROV (opt) Provider IEN, 1204,
"RTN","BIRPC4",354,0)
 ;     9 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC4",355,0)
 ;
"RTN","BIRPC4",356,0)
 N BIREFT1 S BIREFT1=$O(^AUTTREFT("B",BIREFT,0))
"RTN","BIRPC4",357,0)
 ;---> Quit if there isn't a good pointer to the Refusal Type file.
"RTN","BIRPC4",358,0)
 I 'BIREFT1 D ERRCD^BIUTL2(440,.BIERR) Q
"RTN","BIRPC4",359,0)
 ;
"RTN","BIRPC4",360,0)
 ;---> First check for duplicate refusal already on file.
"RTN","BIRPC4",361,0)
 N BIFLD,BIQUIT,N,X S BIQUIT=0
"RTN","BIRPC4",362,0)
 S X=BIREFT1_"^"_BIDFN_"^"_BIDATE_"^"_BIREFI
"RTN","BIRPC4",363,0)
 S N=0
"RTN","BIRPC4",364,0)
 F  S N=$O(^AUPNPREF("AC",BIDFN,N)) Q:'N  Q:BIQUIT  D
"RTN","BIRPC4",365,0)
 .I $P(^AUPNPREF(N,0),U,1,4)=X S BIQUIT=1 Q
"RTN","BIRPC4",366,0)
 Q:BIQUIT
"RTN","BIRPC4",367,0)
 ;
"RTN","BIRPC4",368,0)
 ;---> Okay, no duplicates; store this in Patient Refusals file.
"RTN","BIRPC4",369,0)
 ;
"RTN","BIRPC4",370,0)
 S BIFLD(.01)=BIREFT1,BIFLD(.02)=BIDFN,BIFLD(.03)=BIDATE,BIFLD(.04)=BIREFI
"RTN","BIRPC4",371,0)
 S BIFLD(.05)=BIREFF,BIFLD(.06)=BIREFV,BIFLD(.07)=BIREFR,BIFLD(1204)=BIPROV
"RTN","BIRPC4",372,0)
 D UPDATE^BIFMAN(9000022,,.BIFLD,.BIERR)
"RTN","BIRPC4",373,0)
 Q
"RTN","BIRPC4",374,0)
 ;
"RTN","BIRPC4",375,0)
 ;
"RTN","BIRPC4",376,0)
 ;----------
"RTN","BIRPC4",377,0)
TR(X) ;EP
"RTN","BIRPC4",378,0)
 ;---> Translate any ";" to ",", so that DR string will parse
"RTN","BIRPC4",379,0)
 ;---> correctly.
"RTN","BIRPC4",380,0)
 ;---> Parameters:
"RTN","BIRPC4",381,0)
 ;     1 - X   (req) String to be scanned for ";".
"RTN","BIRPC4",382,0)
 ;
"RTN","BIRPC4",383,0)
 S X=$TR($G(X),";",",")
"RTN","BIRPC4",384,0)
 Q X
"RTN","BIRPC5")
0^134^B20034069
"RTN","BIRPC5",1,0)
BIRPC5 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC5",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BIRPC5",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC5",4,0)
 ;;  RETURN IMMUNIZATION CONTRAINDICATIONS, CASE DATA, AND LAST LETTER.
"RTN","BIRPC5",5,0)
 ;   PATCH 2: New Public Entry Point to automatically add Lot Number.  ADDLOT+0
"RTN","BIRPC5",6,0)
 ;
"RTN","BIRPC5",7,0)
 ;
"RTN","BIRPC5",8,0)
 ;----------
"RTN","BIRPC5",9,0)
CONTRAS(BICONTR,BIDFN) ;PEP - Return Patient's Contraindications and their Reasons.
"RTN","BIRPC5",10,0)
 ;---> Return Patient's Contraindications and their Reasons.
"RTN","BIRPC5",11,0)
 ;---> Contraindications returned in one string, delimited by "^".
"RTN","BIRPC5",12,0)
 ;---> Each Contra has 3 "|" pieces: Vaccine Name|Reason|Date Entered.
"RTN","BIRPC5",13,0)
 ;---> Parameters:
"RTN","BIRPC5",14,0)
 ;     1 - BICONTR (ret) String of patient's Contraindications_||_Error.
"RTN","BIRPC5",15,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIRPC5",16,0)
 ;
"RTN","BIRPC5",17,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC5",18,0)
 N BI31,BIERR,U,V S BI31=$C(31)_$C(31),U="^",V="|"
"RTN","BIRPC5",19,0)
 S BICONTR="",BIERR=""
"RTN","BIRPC5",20,0)
 ;
"RTN","BIRPC5",21,0)
 ;---> If DFN not provided, set Error Code and quit.
"RTN","BIRPC5",22,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC5",23,0)
 .D ERRCD^BIUTL2(308,.BIERR) S BICONTR=BI31_BIERR
"RTN","BIRPC5",24,0)
 ;
"RTN","BIRPC5",25,0)
 N N,X S N=0,X=""
"RTN","BIRPC5",26,0)
 F  S N=$O(^BIPC("B",BIDFN,N)) Q:'N  D
"RTN","BIRPC5",27,0)
 .;
"RTN","BIRPC5",28,0)
 .;---> Kill any false xref.
"RTN","BIRPC5",29,0)
 .I '$D(^BIPC(N,0)) K ^BIPC("B",BIDFN,N) Q
"RTN","BIRPC5",30,0)
 .;
"RTN","BIRPC5",31,0)
 .N Y S Y=^BIPC(N,0)
"RTN","BIRPC5",32,0)
 .;---> Get Contraindication:
"RTN","BIRPC5",33,0)
 .;---> IEN of Contraindication, Vaccine Short Name, Reason, Date.
"RTN","BIRPC5",34,0)
 .S X=X_N_V_$$VNAME^BIUTL2($P(Y,U,2))_V_$$CONTXT^BIUTL6($P(Y,U,3))
"RTN","BIRPC5",35,0)
 .S X=X_V_$$TXDT1^BIUTL5($P(Y,U,4))_U
"RTN","BIRPC5",36,0)
 ;
"RTN","BIRPC5",37,0)
 S BICONTR=X_BI31
"RTN","BIRPC5",38,0)
 Q
"RTN","BIRPC5",39,0)
 ;
"RTN","BIRPC5",40,0)
 ;
"RTN","BIRPC5",41,0)
 ;----------
"RTN","BIRPC5",42,0)
CASEDAT(BICASED,BIDFN) ;PEP - Return Patient's Case Data, pieces delimited by "^".
"RTN","BIRPC5",43,0)
 ;---> Parameters:
"RTN","BIRPC5",44,0)
 ;     1 - BICASED (ret) String of Patient's Case Data_||_Error.
"RTN","BIRPC5",45,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIRPC5",46,0)
 ;
"RTN","BIRPC5",47,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC5",48,0)
 N BI31,BIERR,U S BI31=$C(31)_$C(31),U="^"
"RTN","BIRPC5",49,0)
 S BICASED="",BIERR=""
"RTN","BIRPC5",50,0)
 ;
"RTN","BIRPC5",51,0)
 ;---> If DFN not provided, set Error Code and quit.
"RTN","BIRPC5",52,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC5",53,0)
 .D ERRCD^BIUTL2(206,.BIERR) S BICASED=BI31_BIERR
"RTN","BIRPC5",54,0)
 ;
"RTN","BIRPC5",55,0)
 ;---> If Patient not in Immunization database, set Error Code and quit.
"RTN","BIRPC5",56,0)
 I '$D(^BIP(BIDFN,0)) D  Q
"RTN","BIRPC5",57,0)
 .D ERRCD^BIUTL2(204,.BIERR) S BICASED=BI31_BIERR
"RTN","BIRPC5",58,0)
 ;
"RTN","BIRPC5",59,0)
 ;---> Case Data Elements returned as follows:
"RTN","BIRPC5",60,0)
 ;
"RTN","BIRPC5",61,0)
 ;--->  PC  DATA
"RTN","BIRPC5",62,0)
 ;--->  --  ----
"RTN","BIRPC5",63,0)
 ;--->   1 = Text of Case Manager's name.
"RTN","BIRPC5",64,0)
 ;--->   2 = Text of Parent or Guardian in Immunization database.
"RTN","BIRPC5",65,0)
 ;--->   3 = Mother's HBsAG Status Code (P,N,A,U).
"RTN","BIRPC5",66,0)
 ;--->   4 = Date Patient became Inactive (DD-Mmm-YYYY).
"RTN","BIRPC5",67,0)
 ;--->   5 = Reason for Inactive.
"RTN","BIRPC5",68,0)
 ;--->   6 = Other Info.
"RTN","BIRPC5",69,0)
 ;--->   7 = Forecast Influenza/Pneumococcal.
"RTN","BIRPC5",70,0)
 ;--->   8 = Location Moved or Tx Elsewhere.
"RTN","BIRPC5",71,0)
 ;--->   9 = State Registry Consent.
"RTN","BIRPC5",72,0)
 ;
"RTN","BIRPC5",73,0)
 N X
"RTN","BIRPC5",74,0)
 S X=$$CMGR^BIUTL1(BIDFN,1) S:X="Unknown" X=""
"RTN","BIRPC5",75,0)
 S X=X_U_$$PARENT^BIUTL1(BIDFN)
"RTN","BIRPC5",76,0)
 S X=X_U_$$MOTHER^BIUTL11(BIDFN)
"RTN","BIRPC5",77,0)
 S Z=$$TXDT1^BIUTL5($$INACT^BIUTL1(BIDFN)) S:Z="NO DATE" Z=""
"RTN","BIRPC5",78,0)
 S X=X_U_Z
"RTN","BIRPC5",79,0)
 S X=X_U_$$INACTRE^BIUTL1(BIDFN)_U_$$OTHERIN^BIUTL11(BIDFN)
"RTN","BIRPC5",80,0)
 S X=X_U_$$INFL^BIUTL11(BIDFN)
"RTN","BIRPC5",81,0)
 S X=X_U_$$MOVEDLOC^BIUTL1(BIDFN)
"RTN","BIRPC5",82,0)
 S X=X_U_$$CONSENT^BIUTL1(BIDFN)
"RTN","BIRPC5",83,0)
 ;
"RTN","BIRPC5",84,0)
 S BICASED=X_BI31
"RTN","BIRPC5",85,0)
 Q
"RTN","BIRPC5",86,0)
 ;
"RTN","BIRPC5",87,0)
 ;
"RTN","BIRPC5",88,0)
 ;----------
"RTN","BIRPC5",89,0)
LASTLET(BILASTL,BIDFN) ;EP
"RTN","BIRPC5",90,0)
 ;---> Return date of last letter sent to this patient.
"RTN","BIRPC5",91,0)
 ;---> Parameters:
"RTN","BIRPC5",92,0)
 ;     1 - BILASTL (ret) Date of last letter_||_Error.
"RTN","BIRPC5",93,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIRPC5",94,0)
 ;
"RTN","BIRPC5",95,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC5",96,0)
 N BI31,BIERR,U S BI31=$C(31)_$C(31),U="^"
"RTN","BIRPC5",97,0)
 S BILASTL="",BIERR=""
"RTN","BIRPC5",98,0)
 ;
"RTN","BIRPC5",99,0)
 ;---> If DFN not provided, set Error Code and quit.
"RTN","BIRPC5",100,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC5",101,0)
 .D ERRCD^BIUTL2(201,.BIERR) S BILASTL=BI31_BIERR
"RTN","BIRPC5",102,0)
 ;
"RTN","BIRPC5",103,0)
 ;---> Last Letter Elements returned as follows:
"RTN","BIRPC5",104,0)
 ;
"RTN","BIRPC5",105,0)
 ;--->  PC  DATA
"RTN","BIRPC5",106,0)
 ;--->  --  ----
"RTN","BIRPC5",107,0)
 ;--->   1 = Date of last letter (DD-Mmm-YYYY) or "None".
"RTN","BIRPC5",108,0)
 ;
"RTN","BIRPC5",109,0)
 S BILASTL=$$LASTLET^BIUTL1(BIDFN,1)_BI31
"RTN","BIRPC5",110,0)
 Q
"RTN","BIRPC5",111,0)
 ;
"RTN","BIRPC5",112,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BIRPC5",113,0)
 ;---> New Public Entry Point to automatically add Lot Number.
"RTN","BIRPC5",114,0)
 ;
"RTN","BIRPC5",115,0)
 ;
"RTN","BIRPC5",116,0)
 ;----------
"RTN","BIRPC5",117,0)
ADDLOT(BIERR,BIDATA,BIIEN) ;PEP - Add a new Lot Number for imported data.
"RTN","BIRPC5",118,0)
 ;---> Add new (imported) Lot Number to the IMMUNIZATION LOT File #9999999.41.
"RTN","BIRPC5",119,0)
 ;---> Called by RPC: BI LOT NUMBER ADD.
"RTN","BIRPC5",120,0)
 ;---> Parameters:
"RTN","BIRPC5",121,0)
 ;     1 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC5",122,0)
 ;     2 - BIDATA  (req) String of data for the Lot Number to be added.
"RTN","BIRPC5",123,0)
 ;     3 - BIIEN   (ret) IEN of newly added Lot Number in ^AUTTIML(.
"RTN","BIRPC5",124,0)
 ;                       NOTE: If Lot Number already exists, BIERR will return
"RTN","BIRPC5",125,0)
 ;                             error #444, but BIIEN will be returned with IEN
"RTN","BIRPC5",126,0)
 ;                             pre-existing Lot Number.
"RTN","BIRPC5",127,0)
 ;
"RTN","BIRPC5",128,0)
 ;---> Pieces of BIDATA delimited by "|":
"RTN","BIRPC5",129,0)
 ;     ----------------------------------
"RTN","BIRPC5",130,0)
 ;     1 - (req) Text of the Lot Number.
"RTN","BIRPC5",131,0)
 ;     2 - (req) CVX Code of the Vaccine associated with this Lot Number.
"RTN","BIRPC5",132,0)
 ;     3 - (req) MVX Code of the Manufacturer associated with this Lot Number.
"RTN","BIRPC5",133,0)
 ;
"RTN","BIRPC5",134,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC5",135,0)
 N BI31
"RTN","BIRPC5",136,0)
 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC5",137,0)
 ;
"RTN","BIRPC5",138,0)
 ;---> If DATA not supplied, set Error Code and quit.
"RTN","BIRPC5",139,0)
 I $G(BIDATA)']"" D  Q
"RTN","BIRPC5",140,0)
 .D ERRCD^BIUTL2(442,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",141,0)
 ;
"RTN","BIRPC5",142,0)
 ;---> Set data values in BI local array.
"RTN","BIRPC5",143,0)
 N BI
"RTN","BIRPC5",144,0)
 S BI("AS")=$P(BIDATA,"|",1)   ;Full Lot Number Text.
"RTN","BIRPC5",145,0)
 S BI("B")=$P(BIDATA,"|",2)    ;CVX Code of Vaccine.
"RTN","BIRPC5",146,0)
 S BI("M")=$P(BIDATA,"|",3)    ;MVX Code of Manufacturer.
"RTN","BIRPC5",147,0)
 ;
"RTN","BIRPC5",148,0)
 ;---> If Lot Number="", quit with error.
"RTN","BIRPC5",149,0)
 I 'BI("AS")']"" D  Q
"RTN","BIRPC5",150,0)
 .D ERRCD^BIUTL2(442,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",151,0)
 ;
"RTN","BIRPC5",152,0)
 ;---> If Lot Number is too long, quit with error.
"RTN","BIRPC5",153,0)
 I $L(BI("AS"))>19 D  Q
"RTN","BIRPC5",154,0)
 .D ERRCD^BIUTL2(443,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",155,0)
 ;
"RTN","BIRPC5",156,0)
 ;---> If Lot Number already exists, set BIIEN=IEN, BUT quit with error.
"RTN","BIRPC5",157,0)
 I $D(^AUTTIML("B",BI("AS"))) D  Q
"RTN","BIRPC5",158,0)
 .N Y S Y=$O(^AUTTIML("B",BI("AS"),0))
"RTN","BIRPC5",159,0)
 .I $P($G(^AUTTIML(Y,0)),U)=BI("AS") S BIIEN=Y
"RTN","BIRPC5",160,0)
 .D ERRCD^BIUTL2(444,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",161,0)
 ;
"RTN","BIRPC5",162,0)
 ;
"RTN","BIRPC5",163,0)
 ;---> S BI("B")=IEN of Vaccine.
"RTN","BIRPC5",164,0)
 S BI("B")=$O(^AUTTIMM("C",+$G(BI("B")),0))
"RTN","BIRPC5",165,0)
 ;---> If CVX Code is invalid, quit with error.
"RTN","BIRPC5",166,0)
 I 'BI("B") D  Q
"RTN","BIRPC5",167,0)
 .D ERRCD^BIUTL2(445,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",168,0)
 ;
"RTN","BIRPC5",169,0)
 ;
"RTN","BIRPC5",170,0)
 ;---> S BI("M")=IEN of Manufacturer.
"RTN","BIRPC5",171,0)
 ;---> If MVX Code is invalid, quit with error.
"RTN","BIRPC5",172,0)
 I BI("M")="" D  Q
"RTN","BIRPC5",173,0)
 .D ERRCD^BIUTL2(446,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",174,0)
 S BI("M")=$O(^AUTTIMAN("C",BI("M"),0))
"RTN","BIRPC5",175,0)
 I BI("M")="" D  Q
"RTN","BIRPC5",176,0)
 .D ERRCD^BIUTL2(446,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",177,0)
 ;
"RTN","BIRPC5",178,0)
 ;
"RTN","BIRPC5",179,0)
 ;---> Build local array for this Lot Number.
"RTN","BIRPC5",180,0)
 S BIFLD(.01)=$G(BI("AS")),BIFLD(.02)=$G(BI("M"))
"RTN","BIRPC5",181,0)
 ;---> Imported Lot Number will have a Status of Inactive.
"RTN","BIRPC5",182,0)
 S BIFLD(.03)=1,BIFLD(.04)=$G(BI("B"))
"RTN","BIRPC5",183,0)
 ;
"RTN","BIRPC5",184,0)
 ;---> Add the Lot Number.  BIIEN1(1) will equal IEN of newly added Lot Number.
"RTN","BIRPC5",185,0)
 N BIIEN1
"RTN","BIRPC5",186,0)
 D UPDATE^BIFMAN(9999999.41,.BIIEN1,.BIFLD,.BIERR)
"RTN","BIRPC5",187,0)
 ;
"RTN","BIRPC5",188,0)
 ;---> If there was an error, return it.
"RTN","BIRPC5",189,0)
 S BIERR=BI31_BIERR
"RTN","BIRPC5",190,0)
 ;
"RTN","BIRPC5",191,0)
 ;---> Return BIIEN.
"RTN","BIRPC5",192,0)
 S BIIEN=$G(BIIEN1(1))
"RTN","BIRPC5",193,0)
 ;
"RTN","BIRPC5",194,0)
 ;---> Check IEN.
"RTN","BIRPC5",195,0)
 I $P($G(^AUTTIML(+BIIEN,0)),U)'=BI("AS") D  Q
"RTN","BIRPC5",196,0)
 .D ERRCD^BIUTL2(447,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC5",197,0)
 ;
"RTN","BIRPC5",198,0)
 Q
"RTN","BIRPC6")
0^135^B5724193
"RTN","BIRPC6",1,0)
BIRPC6 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC6",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIRPC6",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC6",4,0)
 ;;  CALL TO PRODUCE TEMP GLOBAL OF PATIENTS FOR TWO-YR-OLD GPRA REPORT.
"RTN","BIRPC6",5,0)
 ;;  PATCH 1: If Code Set versioning is present, use standard call.  CPTIMM+14
"RTN","BIRPC6",6,0)
 ;
"RTN","BIRPC6",7,0)
 ;
"RTN","BIRPC6",8,0)
 ;----------
"RTN","BIRPC6",9,0)
ACTLIST(BIQDT,BITAR,BISITE,BIERR) ;PEP - Produce ^TMP of Patients for Imm Report.
"RTN","BIRPC6",10,0)
 ;---> Produce ^TMP array of Patients for Quarterly Immunization Report.
"RTN","BIRPC6",11,0)
 ;---> Parameters:
"RTN","BIRPC6",12,0)
 ;     1 - BIQDT  (req) Quarter Ending Date.
"RTN","BIRPC6",13,0)
 ;     2 - BITAR  (opt) Two-Yr-Old Report Age Range: either "19-35" or "24-35"
"RTN","BIRPC6",14,0)
 ;     3 - BISITE (req) Site IEN.
"RTN","BIRPC6",15,0)
 ;     4 - BIERR  (ret) Error text (if null, then no error).
"RTN","BIRPC6",16,0)
 ;
"RTN","BIRPC6",17,0)
 K ^TMP("BIDUL",$J),^TMP("BIREPT1",$J)
"RTN","BIRPC6",18,0)
 ;
"RTN","BIRPC6",19,0)
 ;---> Check for required Variables.
"RTN","BIRPC6",20,0)
 I '$G(BIQDT) D ERRCD^BIUTL2(623,.BIERR) Q
"RTN","BIRPC6",21,0)
 I '$D(BITAR)  D ERRCD^BIUTL2(613,.BIERR) Q
"RTN","BIRPC6",22,0)
 S:'%G(BISITE) BISITE=$G(DUZ(2)) I '$G(BISITE) S BIERR=109 Q
"RTN","BIRPC6",23,0)
 ;
"RTN","BIRPC6",24,0)
 S BIBEN("ALL")="",BICC("ALL")="",BICM("ALL")="",BIHCF("ALL")=""
"RTN","BIRPC6",25,0)
 S BIAGRPS="3,5,7,16,19,36"
"RTN","BIRPC6",26,0)
 S:'$G(BITAR) BITAR="19-35"
"RTN","BIRPC6",27,0)
 ;
"RTN","BIRPC6",28,0)
 ;---> Gather data.
"RTN","BIRPC6",29,0)
 ;***** GO BACK TO GETDATA^BIREPT3 AND CHECK OUT BIVAL (STORE/DON'T STORE) DEAL!!!!
"RTN","BIRPC6",30,0)
 D GETDATA^BIREPT3(.BICC,.BIHCF,.BICM,.BIBEN,BIQDT,BITAR,BIAGRPS,BISITE,.BIERR)
"RTN","BIRPC6",31,0)
 ;
"RTN","BIRPC6",32,0)
 ;***** NEXT LINE: PASS AS LOCAL ARRAY OR SIMPLER ^TMP ARRAY?
"RTN","BIRPC6",33,0)
 ;***** ASK LORI HOW SHE WANTS IT?
"RTN","BIRPC6",34,0)
 ;***** Array is stored in ^TMP("BIDUL",$J,CURRENT-COMMUNITY-IEN,1,HRCN,DFN)
"RTN","BIRPC6",35,0)
 ;
"RTN","BIRPC6",36,0)
 ;---> Clean up would be:
"RTN","BIRPC6",37,0)
 ;K ^TMP("BIDUL",$J),^TMP("BIREPT1",$J)
"RTN","BIRPC6",38,0)
 Q
"RTN","BIRPC6",39,0)
 ;
"RTN","BIRPC6",40,0)
 ;
"RTN","BIRPC6",41,0)
 ;----------
"RTN","BIRPC6",42,0)
CPTIMM ;EP
"RTN","BIRPC6",43,0)
 ;---> Create a V Immunization entry (if none exists) for a CPT Coded
"RTN","BIRPC6",44,0)
 ;---> Immunization.  Called by the AIMM Mumps Cross Reference on the
"RTN","BIRPC6",45,0)
 ;---> .01 Field of the V CPT File# 9000010.18.
"RTN","BIRPC6",46,0)
 ;
"RTN","BIRPC6",47,0)
 ;---> Edit and uncomment next line to test directly.
"RTN","BIRPC6",48,0)
 ;;S APCDVSIT=37529775,APCDPAT=227582,APCDDATE=3051017,X=90663,BICCPT=1776
"RTN","BIRPC6",49,0)
 ;
"RTN","BIRPC6",50,0)
 Q:'$G(X)
"RTN","BIRPC6",51,0)
 N BICPT,BIDATE,BIDFN,BIPTR,BIVAC,BIVSIT
"RTN","BIRPC6",52,0)
 ;
"RTN","BIRPC6",53,0)
 ;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIRPC6",54,0)
 ;---> If Code Set versioning is present, use standard call.
"RTN","BIRPC6",55,0)
 D
"RTN","BIRPC6",56,0)
 .I $L($T(^ICPTCOD)) S BICPT=$P($$CPT^ICPTCOD(X),"^",2) Q
"RTN","BIRPC6",57,0)
 .S BICPT=$P($G(^ICPT(X,0)),"^")
"RTN","BIRPC6",58,0)
 ;**********
"RTN","BIRPC6",59,0)
 ;
"RTN","BIRPC6",60,0)
 S BIVSIT=$G(APCDVSIT)
"RTN","BIRPC6",61,0)
 S BIDFN=$G(APCDPAT)
"RTN","BIRPC6",62,0)
 S BIDATE=$G(APCDDATE)
"RTN","BIRPC6",63,0)
 Q:'BICPT  Q:'BIVSIT  Q:'BIDFN  Q:'BIDATE
"RTN","BIRPC6",64,0)
 ;
"RTN","BIRPC6",65,0)
 ;---> Quit if Site Parameter has Import CPT Visits feature disabled.
"RTN","BIRPC6",66,0)
 Q:'$$IMPCPT^BIUTL2($G(DUZ(2)))
"RTN","BIRPC6",67,0)
 ;
"RTN","BIRPC6",68,0)
 ;---> Set this piece = IEN in V CPT if available.
"RTN","BIRPC6",69,0)
 S BICCPT=$S($G(DA):DA,1:1)
"RTN","BIRPC6",70,0)
 ;
"RTN","BIRPC6",71,0)
 ;---> Quit if this CPT Code is not in the Immunization File (Vaccine Table).
"RTN","BIRPC6",72,0)
 S BIVAC=$O(^AUTTIMM("ACPT",BICPT,0))
"RTN","BIRPC6",73,0)
 Q:'BIVAC  Q:'$D(^AUTTIMM(BIVAC,0))
"RTN","BIRPC6",74,0)
 ;
"RTN","BIRPC6",75,0)
 ;---> Quit if an Immunization for this Patient and this Vaccine
"RTN","BIRPC6",76,0)
 ;---> on this Date already exists.
"RTN","BIRPC6",77,0)
 ;
"RTN","BIRPC6",78,0)
 ;********** PATCH 1, APR 4,2006, IHS/CMI/MWR
"RTN","BIRPC6",79,0)
 ;---> Fix xref lookup when checking to avoid CPT-Coded duplicate
"RTN","BIRPC6",80,0)
 ;---> immunizations by striping time from BIDATE.
"RTN","BIRPC6",81,0)
 Q:$D(^AUPNVIMM("AA",BIDFN,BIVAC,(9999999-$P(BIDATE,"."))))
"RTN","BIRPC6",82,0)
 ;**********
"RTN","BIRPC6",83,0)
 ;
"RTN","BIRPC6",84,0)
 N BIDATA
"RTN","BIRPC6",85,0)
 S BIDATA="I|"_BIDFN_"|"_BIVAC_"|||"_BIDATE_"||||||||||||||||||"_BICCPT
"RTN","BIRPC6",86,0)
 D
"RTN","BIRPC6",87,0)
 .D EN^XBNEW("VFILE1^BIVISIT","BIVSIT;BIDATA")
"RTN","BIRPC6",88,0)
 Q
"RTN","BISCAN")
0^136^B42175673
"RTN","BISCAN",1,0)
BISCAN ;IHS/CMI/MWR - SCAN PATIENT DB FOR <36 MTHS, ADD TO IMM DB; MAY 10, 2010
"RTN","BISCAN",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BISCAN",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISCAN",4,0)
 ;;  SCAN PATIENT DATABASE FOR PATIENTS <36 MTHS NOT IN IMM DB.
"RTN","BISCAN",5,0)
 ;;  PATCH 1: Correct Age Range in report from 1-36 to 0-35.  REVIEW+9
"RTN","BISCAN",6,0)
 ;;           Also disabled PREVINA (no longer stuffing previously inactive).
"RTN","BISCAN",7,0)
 ;;           Also "please hold..." prompt while getting patient total. SCAN+11
"RTN","BISCAN",8,0)
 ;;           Also do not add patient if Ineligible in Registration.  SCAN+40
"RTN","BISCAN",9,0)
 ;
"RTN","BISCAN",10,0)
 ;----------
"RTN","BISCAN",11,0)
START ;EP
"RTN","BISCAN",12,0)
 ;---> Scan for patients in ^AUPNPAT <36 mths not in Imm database ^BIP.
"RTN","BISCAN",13,0)
 ;
"RTN","BISCAN",14,0)
 D SETVARS^BIUTL5 S BIPOP=0 N BICC
"RTN","BISCAN",15,0)
 D
"RTN","BISCAN",16,0)
 .D PROMPT(.BICC,.BIPOP) Q:BIPOP
"RTN","BISCAN",17,0)
 .Q:BIPOP
"RTN","BISCAN",18,0)
 .D SCAN(.BICC,.BIPOP) Q:BIPOP
"RTN","BISCAN",19,0)
 .D REVIEW
"RTN","BISCAN",20,0)
 D EXIT(BIPOP)
"RTN","BISCAN",21,0)
 Q
"RTN","BISCAN",22,0)
 ;
"RTN","BISCAN",23,0)
 ;
"RTN","BISCAN",24,0)
 ;----------
"RTN","BISCAN",25,0)
PROMPT(BICC,BIPOP) ;EP
"RTN","BISCAN",26,0)
 ;---> Describe conversion.
"RTN","BISCAN",27,0)
 ;     1 - BICC  (ret) Current Community array.
"RTN","BISCAN",28,0)
 ;     2 - BIPOP (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BISCAN",29,0)
 ;
"RTN","BISCAN",30,0)
 N Z S Z="",BIPOP=0,Z="YES"
"RTN","BISCAN",31,0)
 D TITLE,TEXT1 W !
"RTN","BISCAN",32,0)
 D DIRZ^BIUTL3(.BIPOP)
"RTN","BISCAN",33,0)
 Q:BIPOP
"RTN","BISCAN",34,0)
 ;
"RTN","BISCAN",35,0)
 ;---> Current Community.
"RTN","BISCAN",36,0)
 D CC^BIOUTPT(.BICC,"BISCAN",.BIPOP)
"RTN","BISCAN",37,0)
 Q:BIPOP
"RTN","BISCAN",38,0)
 ;
"RTN","BISCAN",39,0)
 D TITLE W !!
"RTN","BISCAN",40,0)
 D DIR^BIFMAN("Y",.Y,.BIPOP,"     Do you wish to continue with the Scan",Z)
"RTN","BISCAN",41,0)
 Q:BIPOP
"RTN","BISCAN",42,0)
 S:Y<1 BIPOP=1
"RTN","BISCAN",43,0)
 Q
"RTN","BISCAN",44,0)
 ;
"RTN","BISCAN",45,0)
 ;
"RTN","BISCAN",46,0)
 ;----------
"RTN","BISCAN",47,0)
RESET ;EP
"RTN","BISCAN",48,0)
 ;---> To satisfy return from call to BIOUTPT.
"RTN","BISCAN",49,0)
 Q
"RTN","BISCAN",50,0)
 ;
"RTN","BISCAN",51,0)
 ;
"RTN","BISCAN",52,0)
 ;----------
"RTN","BISCAN",53,0)
SCAN(BICC,BIPOP) ;EP
"RTN","BISCAN",54,0)
 ;---> Convert patients to new file/register.
"RTN","BISCAN",55,0)
 ;     1 - BICC  (ret) Current Community array.
"RTN","BISCAN",56,0)
 ;     2 - BIPOP (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BISCAN",57,0)
 ;
"RTN","BISCAN",58,0)
 K ^BITMP($J)
"RTN","BISCAN",59,0)
 N BIERR,BIFACT,BIX,BIY,N
"RTN","BISCAN",60,0)
 ;
"RTN","BISCAN",61,0)
 ;---> Check for DUZ(2).
"RTN","BISCAN",62,0)
 I '$G(DUZ(2)) D ERRCD^BIUTL2(105,,1) Q
"RTN","BISCAN",63,0)
 ;
"RTN","BISCAN",64,0)
 ;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BISCAN",65,0)
 ;---> Hold prompt while getting total patient count.
"RTN","BISCAN",66,0)
 W !!?12,"Please hold..."
"RTN","BISCAN",67,0)
 ;**********
"RTN","BISCAN",68,0)
 ;
"RTN","BISCAN",69,0)
 ;
"RTN","BISCAN",70,0)
 S N=0 F  S N=$O(^AUPNPAT(N)) Q:'N  S BIFACT=N
"RTN","BISCAN",71,0)
 S:BIFACT<1 BIFACT=1 S BIFACT=BIFACT\50
"RTN","BISCAN",72,0)
 S (BIPOP,BIX,BIY)=0
"RTN","BISCAN",73,0)
 ;
"RTN","BISCAN",74,0)
 D TITLE
"RTN","BISCAN",75,0)
 W !!?12,"Converting Patients to the new Register..."
"RTN","BISCAN",76,0)
 W !!?12,"0%---10---20---30---40---50---60---70---80---90---100%"
"RTN","BISCAN",77,0)
 W !?12,"|"
"RTN","BISCAN",78,0)
 ;
"RTN","BISCAN",79,0)
 ;---> Loop through the RPMS Patient global, adding to
"RTN","BISCAN",80,0)
 ;---> new BI Patient global.
"RTN","BISCAN",81,0)
 ;---> * Consider using DOB xref (time versus reliability?).
"RTN","BISCAN",82,0)
 S BIDFN=0,BIPATS=0
"RTN","BISCAN",83,0)
 F  S BIDFN=$O(^AUPNPAT(BIDFN)) Q:'BIDFN  Q:$G(BIERR)]""  D
"RTN","BISCAN",84,0)
 .;
"RTN","BISCAN",85,0)
 .;---> Display bar graph of progress.
"RTN","BISCAN",86,0)
 .S BIX=BIX+1 I BIFACT,'(BIX#BIFACT)&(BIY<51) W "=" S BIY=BIY+1
"RTN","BISCAN",87,0)
 .;
"RTN","BISCAN",88,0)
 .;---> Quit if this patient already exists in the Imm Patient File.
"RTN","BISCAN",89,0)
 .Q:$D(^BIP(BIDFN,0))
"RTN","BISCAN",90,0)
 .;---> Quit if patient does not have an Active Chart at this site.
"RTN","BISCAN",91,0)
 .Q:$$INACTREG^BIUTL1(BIDFN,DUZ(2))
"RTN","BISCAN",92,0)
 .;
"RTN","BISCAN",93,0)
 .;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BISCAN",94,0)
 .;---> Quit if patient is Ineligible in RPMS Registration.
"RTN","BISCAN",95,0)
 .Q:$$INELIG^BIUTL1(BIDFN)
"RTN","BISCAN",96,0)
 .;**********
"RTN","BISCAN",97,0)
 .;
"RTN","BISCAN",98,0)
 .;---> Quit if patient is not less than 36 months.
"RTN","BISCAN",99,0)
 .Q:($$AGE^BIUTL1(BIDFN,2,$G(DT))>35)
"RTN","BISCAN",100,0)
 .;---> Quit if patient is deceased.
"RTN","BISCAN",101,0)
 .Q:$$DECEASED^BIUTL1(BIDFN)
"RTN","BISCAN",102,0)
 .;---> Quit If patient does not have one of the selected Current Communities.
"RTN","BISCAN",103,0)
 .Q:$$CURCOM^BIEXPRT2(BIDFN,.BICC)
"RTN","BISCAN",104,0)
 .;
"RTN","BISCAN",105,0)
 .;---> Add patient to ^BIP Imm Database.
"RTN","BISCAN",106,0)
 .D ADD(BIDFN,.BIPATS,.BIERR)
"RTN","BISCAN",107,0)
 ;
"RTN","BISCAN",108,0)
 I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() Q
"RTN","BISCAN",109,0)
 ;
"RTN","BISCAN",110,0)
 ;---> Update Zero Node of BI PATIENT File #9002084.
"RTN","BISCAN",111,0)
 N M,N S (L,N,T)=0 F  S N=$O(^BIP(N)) Q:'N  S L=N,T=T+1
"RTN","BISCAN",112,0)
 S $P(^BIP(0),U,3,4)=L_U_T
"RTN","BISCAN",113,0)
 ;
"RTN","BISCAN",114,0)
 N BII F BII=1:1:50-BIY W "="
"RTN","BISCAN",115,0)
 W "|",!?33,"Complete"
"RTN","BISCAN",116,0)
 W !!?12,"Patients added to the new Immunization Register: ",BIPATS
"RTN","BISCAN",117,0)
 W !!?12,"Total Patients in the new Immunization Register....: ",T
"RTN","BISCAN",118,0)
 W !!!!!! D DIRZ^BIUTL3(.BIPOP) Q:BIPOP
"RTN","BISCAN",119,0)
 ;
"RTN","BISCAN",120,0)
 Q
"RTN","BISCAN",121,0)
 ;
"RTN","BISCAN",122,0)
 ;
"RTN","BISCAN",123,0)
 ;----------
"RTN","BISCAN",124,0)
ADD(BIDFN,BIPATS,BIERR) ;EP
"RTN","BISCAN",125,0)
 ;---> Add patient to new Immunization database.
"RTN","BISCAN",126,0)
 ;---> Parameters:
"RTN","BISCAN",127,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BISCAN",128,0)
 ;     2 - BIPATS (opt) Bookeeper node, total patients in ^BIP(0)
"RTN","BISCAN",129,0)
 ;     3 - BIERR  (ret)   Error text, if any.
"RTN","BISCAN",130,0)
 ;
"RTN","BISCAN",131,0)
 Q:'$D(^AUPNPAT(BIDFN,0))
"RTN","BISCAN",132,0)
 S:'$D(BIPATS) BIPATS=0
"RTN","BISCAN",133,0)
 ;
"RTN","BISCAN",134,0)
 D ADDPAT^BIPATE(BIDFN,1665,.BIERR,,,1)
"RTN","BISCAN",135,0)
 Q:($G(BIERR)]"")
"RTN","BISCAN",136,0)
 S ^BITMP($J,BIDFN)="",BIPATS=BIPATS+1
"RTN","BISCAN",137,0)
 Q
"RTN","BISCAN",138,0)
 ;
"RTN","BISCAN",139,0)
 ;
"RTN","BISCAN",140,0)
 ;----------
"RTN","BISCAN",141,0)
REVIEW ;EP
"RTN","BISCAN",142,0)
 ;---> Review/Print List of Patients automatically activated.
"RTN","BISCAN",143,0)
 ;
"RTN","BISCAN",144,0)
 D TITLE,TEXT2 W !
"RTN","BISCAN",145,0)
 N BIPOP S BIPOP=0
"RTN","BISCAN",146,0)
 D DIR^BIFMAN("Y",.Y,.BIPOP,"     Review List of Auto Activated now")
"RTN","BISCAN",147,0)
 Q:BIPOP
"RTN","BISCAN",148,0)
 Q:Y<1
"RTN","BISCAN",149,0)
 ;
"RTN","BISCAN",150,0)
 ;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BISCAN",151,0)
 ;---> Correct Age Range in report from 1-36 to 0-35.
"RTN","BISCAN",152,0)
 ;K BICC S BIPG="5^^^^"_DT_":"_DT,BIAG="1-36"
"RTN","BISCAN",153,0)
 K BICC S BIPG="5^^^^"_DT_":"_DT,BIAG="0-35"
"RTN","BISCAN",154,0)
 ;**********
"RTN","BISCAN",155,0)
 ;
"RTN","BISCAN",156,0)
 D ^BIDU
"RTN","BISCAN",157,0)
 Q
"RTN","BISCAN",158,0)
 ;
"RTN","BISCAN",159,0)
 ;
"RTN","BISCAN",160,0)
 ;----------
"RTN","BISCAN",161,0)
PREVINA ;EP
"RTN","BISCAN",162,0)
 ;---> Stuff "Previously Inactivated" in the .16 Field of the BI PATIENT
"RTN","BISCAN",163,0)
 ;---> File for any patients who were Inactive prior to v8.1.
"RTN","BISCAN",164,0)
 ;
"RTN","BISCAN",165,0)
 ;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BISCAN",166,0)
 ;---> No longer stuffing "Previously Inactivated".
"RTN","BISCAN",167,0)
 Q
"RTN","BISCAN",168,0)
 ;**********
"RTN","BISCAN",169,0)
 ;
"RTN","BISCAN",170,0)
 N N S N=0
"RTN","BISCAN",171,0)
 F  S N=$O(^BIP(N)) Q:'N  D
"RTN","BISCAN",172,0)
 .Q:'$P($G(^BIP(N,0)),"^",8)
"RTN","BISCAN",173,0)
 .S $P(^BIP(N,0),"^",16)="p"
"RTN","BISCAN",174,0)
 Q
"RTN","BISCAN",175,0)
 ;
"RTN","BISCAN",176,0)
 ;
"RTN","BISCAN",177,0)
 ;----------
"RTN","BISCAN",178,0)
TEXT1 ;EP
"RTN","BISCAN",179,0)
 ;;
"RTN","BISCAN",180,0)
 ;;This program will scan the RPMS Patient Database for children who
"RTN","BISCAN",181,0)
 ;;are less than 36 months old.  Of those children, any who are not in
"RTN","BISCAN",182,0)
 ;;the Immunization Database and who live in one of the Communities
"RTN","BISCAN",183,0)
 ;;you select will be added to the Immunization Register.
"RTN","BISCAN",184,0)
 ;;
"RTN","BISCAN",185,0)
 ;;NOTE: This scan program, if interrupted, may be restarted at any time.
"RTN","BISCAN",186,0)
 ;;      It may also be rerun at any time.  It will not create duplicates.
"RTN","BISCAN",187,0)
 ;;
"RTN","BISCAN",188,0)
 ;;The next screen will provide an opportunity to select specific
"RTN","BISCAN",189,0)
 ;;communities from which patients will be scanned.  (This is the
"RTN","BISCAN",190,0)
 ;;"Current Community" field in RPMS Patient Registration.)  You will have
"RTN","BISCAN",191,0)
 ;;the opportunity to automatically use the GPRA set of communities.
"RTN","BISCAN",192,0)
 ;;
"RTN","BISCAN",193,0)
 ;;
"RTN","BISCAN",194,0)
 ;;
"RTN","BISCAN",195,0)
 D PRINTX("TEXT1",5)
"RTN","BISCAN",196,0)
 Q
"RTN","BISCAN",197,0)
 ;
"RTN","BISCAN",198,0)
 ;
"RTN","BISCAN",199,0)
 ;----------
"RTN","BISCAN",200,0)
TEXT2 ;EP
"RTN","BISCAN",201,0)
 ;;
"RTN","BISCAN",202,0)
 ;;You may review the list of Patients who have been Automatically
"RTN","BISCAN",203,0)
 ;;Activated today.  Would you like to view that list now?
"RTN","BISCAN",204,0)
 ;;
"RTN","BISCAN",205,0)
 ;;
"RTN","BISCAN",206,0)
 D PRINTX("TEXT2",5)
"RTN","BISCAN",207,0)
 Q
"RTN","BISCAN",208,0)
 ;
"RTN","BISCAN",209,0)
 ;
"RTN","BISCAN",210,0)
 ;----------
"RTN","BISCAN",211,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BISCAN",212,0)
 Q:$G(BILINL)=""
"RTN","BISCAN",213,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BISCAN",214,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BISCAN",215,0)
 Q
"RTN","BISCAN",216,0)
 ;
"RTN","BISCAN",217,0)
 ;
"RTN","BISCAN",218,0)
 ;----------
"RTN","BISCAN",219,0)
EXIT(BIPOP) ;EP
"RTN","BISCAN",220,0)
 ;---> EOJ Cleanup.
"RTN","BISCAN",221,0)
 ;---> Parameters:
"RTN","BISCAN",222,0)
 ;     1 - BIPOP   (opt) BIPOP=1 if DTOUT or DUOUT
"RTN","BISCAN",223,0)
 ;
"RTN","BISCAN",224,0)
 D:$G(BIPOP)
"RTN","BISCAN",225,0)
 .W !!?5,"* SCAN ABORTED. *" D DIRZ^BIUTL3()
"RTN","BISCAN",226,0)
 N BIPOP
"RTN","BISCAN",227,0)
 D KILLALL^BIUTL8(1)
"RTN","BISCAN",228,0)
 Q
"RTN","BISCAN",229,0)
 ;
"RTN","BISCAN",230,0)
 ;
"RTN","BISCAN",231,0)
 ;----------
"RTN","BISCAN",232,0)
TITLE ;EP
"RTN","BISCAN",233,0)
 D TITLE^BIUTL5("SCAN FOR PATIENTS <36 MONTHS")
"RTN","BISCAN",234,0)
 Q
"RTN","BISELEC1")
0^137^B74913736
"RTN","BISELEC1",1,0)
BISELEC1 ;IHS/CMI/MWR - GENERIC SELETION UTILITY; MAY 10, 2010
"RTN","BISELEC1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BISELEC1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISELEC1",4,0)
 ;;  LISTMANAGER DRIVER ROUTINE FOR GENERIC SELECTION UTILITY.
"RTN","BISELEC1",5,0)
 ;
"RTN","BISELEC1",6,0)
 ;
"RTN","BISELEC1",7,0)
 ;----------
"RTN","BISELEC1",8,0)
START(BIARR1,BIGBL,BIITEMS,BITITEMS,BIPIECE,BISCRN,BIID,BICOL,BIFLD,BIPOP) ;EP
"RTN","BISELEC1",9,0)
 ;---> Call Listmanager to select a list of Items.
"RTN","BISELEC1",10,0)
 ;---> Parameters:
"RTN","BISELEC1",11,0)
 ;     1 - BIARR1  (req) Selection Array (local).
"RTN","BISELEC1",12,0)
 ;     2 - BIGBL   (req) Lookup global.
"RTN","BISELEC1",13,0)
 ;     3 - BIITEMS (req) Catagoric name of Items being selected.
"RTN","BISELEC1",14,0)
 ;     4 - BITITEMS (req) Title name of selected Items.
"RTN","BISELEC1",15,0)
 ;     5 - BIPIECE (req) Piece of zero node to display as ItemName.
"RTN","BISELEC1",16,0)
 ;     6 - BISCRN  (opt) Screen used in selection lookup.
"RTN","BISELEC1",17,0)
 ;     7 - BIID    (opt) Identifier and code.
"RTN","BISELEC1",18,0)
 ;     8 - BICOL   (opt) Column header text.
"RTN","BISELEC1",19,0)
 ;     9 - BIFLD   (opt) Field# in BIFILE with Set of Codes to select.
"RTN","BISELEC1",20,0)
 ;    10 - BIPOP   (ret) BIPOP, =1 if quit or error.
"RTN","BISELEC1",21,0)
 ;
"RTN","BISELEC1",22,0)
 ;
"RTN","BISELEC1",23,0)
 ;---> New VALMQUIT so that quit from "ENTIRE1^BISELEC2" will work but
"RTN","BISELEC1",24,0)
 ;---> will not cause the calling/parent instance of Listman to quit also.
"RTN","BISELEC1",25,0)
 D SETVARS^BIUTL5 N VALMQUIT
"RTN","BISELEC1",26,0)
 S BIPOP=0
"RTN","BISELEC1",27,0)
 D EN^VALM("BI GENERIC SELECTION")
"RTN","BISELEC1",28,0)
 D FULL^VALM1
"RTN","BISELEC1",29,0)
 D EXIT
"RTN","BISELEC1",30,0)
 Q
"RTN","BISELEC1",31,0)
 ;
"RTN","BISELEC1",32,0)
 ;
"RTN","BISELEC1",33,0)
 ;----------
"RTN","BISELEC1",34,0)
HDR ;EP
"RTN","BISELEC1",35,0)
 ;---> Header code.
"RTN","BISELEC1",36,0)
 N X,Y
"RTN","BISELEC1",37,0)
 S VALMHDR(1)=""
"RTN","BISELEC1",38,0)
 S X="   Select one or more "_BITITEMS_":"
"RTN","BISELEC1",39,0)
 S VALMHDR(2)=X
"RTN","BISELEC1",40,0)
 Q
"RTN","BISELEC1",41,0)
 ;
"RTN","BISELEC1",42,0)
 ;
"RTN","BISELEC1",43,0)
 ;----------
"RTN","BISELEC1",44,0)
INIT ;EP
"RTN","BISELEC1",45,0)
 ;---> Initialize variables and list array.
"RTN","BISELEC1",46,0)
 K ^TMP("BILMGS",$J),^TMP("BILMGS1",$J),^TMP("BILMGS2",$J)
"RTN","BISELEC1",47,0)
 ;
"RTN","BISELEC1",48,0)
 ;---> Check for necessary variables present.
"RTN","BISELEC1",49,0)
 I $$CHECK^BISELECT() S BIPOP=1,VALMQUIT="" Q
"RTN","BISELEC1",50,0)
 ;
"RTN","BISELEC1",51,0)
 ;---> *** SET OF CODES
"RTN","BISELEC1",52,0)
 ;---> If this is a Set of Codes, go to INIT1, then QUIT.
"RTN","BISELEC1",53,0)
 I +$G(BIFLD) D INIT1 Q
"RTN","BISELEC1",54,0)
 ;
"RTN","BISELEC1",55,0)
 ;---> Continue with selection from a file.
"RTN","BISELEC1",56,0)
 I '$O(@(BIARR1_"(0)")) S VALMCNT=0 Q
"RTN","BISELEC1",57,0)
 ;
"RTN","BISELEC1",58,0)
 ;---> Set Lower Frame Bar and Screen Title.
"RTN","BISELEC1",59,0)
 S VALMSG="Type ?? for more actions."
"RTN","BISELEC1",60,0)
 ;S VALM("TITLE")="Select "_BIITEMS
"RTN","BISELEC1",61,0)
 ;
"RTN","BISELEC1",62,0)
 ;---> Set Column Header line.
"RTN","BISELEC1",63,0)
 D:$G(BICOL)]""
"RTN","BISELEC1",64,0)
 .S VALMCAP=$$PAD^BIUTL5(BICOL,80)
"RTN","BISELEC1",65,0)
 ;
"RTN","BISELEC1",66,0)
 ;---> Convert IEN-sorted array to ItemName-sorted array.
"RTN","BISELEC1",67,0)
 ;---> This will present Items in a numbered list, 1,2,3...,
"RTN","BISELEC1",68,0)
 ;---> with the Item names in alphabetical order, so the user
"RTN","BISELEC1",69,0)
 ;---> can search the list of Items in order.
"RTN","BISELEC1",70,0)
 ;
"RTN","BISELEC1",71,0)
 ;---> First, build array sorted by ItemName.
"RTN","BISELEC1",72,0)
 N BIIEN S BIIEN=0
"RTN","BISELEC1",73,0)
 F  S BIIEN=$O(@(BIARR1_"(BIIEN)")) Q:'BIIEN  D
"RTN","BISELEC1",74,0)
 .;
"RTN","BISELEC1",75,0)
 .;---> If IEN passed does not really exist in the File,
"RTN","BISELEC1",76,0)
 .;---> remove it from the Selection Array.
"RTN","BISELEC1",77,0)
 .I '$D(@(BIGBL_"BIIEN,0)")) K @(BIARR1_"(BIIEN)") Q
"RTN","BISELEC1",78,0)
 .;
"RTN","BISELEC1",79,0)
 .;---> If (previously stored) IEN does not pass the screen,
"RTN","BISELEC1",80,0)
 .;---> then remove it from the Selection Array.
"RTN","BISELEC1",81,0)
 .I BISCRN]"" N Y S Y=BIIEN X BISCRN I '$T K @(BIARR1_"(BIIEN)") Q
"RTN","BISELEC1",82,0)
 .;
"RTN","BISELEC1",83,0)
 .N BI0,BINAME,BIIDTX
"RTN","BISELEC1",84,0)
 .S BI0=@(BIGBL_"BIIEN,0)")
"RTN","BISELEC1",85,0)
 .S BINAME=$P(BI0,U,BIPIECE)
"RTN","BISELEC1",86,0)
 .Q:BINAME=""
"RTN","BISELEC1",87,0)
 .;
"RTN","BISELEC1",88,0)
 .;---> Set Identifer if passed.
"RTN","BISELEC1",89,0)
 .D:BIID]""
"RTN","BISELEC1",90,0)
 ..;---> BIID Identifier: Three pieces delimited by ";".
"RTN","BISELEC1",91,0)
 ..;                      1st piece = the "^" piece of 0 node to get X.
"RTN","BISELEC1",92,0)
 ..;                      2nd piece = Code to set X=text of identifier.
"RTN","BISELEC1",93,0)
 ..;                      3rd piece = Tab for identfier in Listman.
"RTN","BISELEC1",94,0)
 ..;
"RTN","BISELEC1",95,0)
 ..;---> Get piece (BIPC) of zero node that holds Identifier data.
"RTN","BISELEC1",96,0)
 ..N BIPC,X S BIPC=$P(BIID,";")
"RTN","BISELEC1",97,0)
 ..Q:'BIPC
"RTN","BISELEC1",98,0)
 ..;---> Get Identifier data.
"RTN","BISELEC1",99,0)
 ..S X=$P(BI0,U,BIPC)
"RTN","BISELEC1",100,0)
 ..Q:X=""
"RTN","BISELEC1",101,0)
 ..;---> Xecute code to process X (return ID text in X).
"RTN","BISELEC1",102,0)
 ..;---> If there is no code, then value of X is displayed unchanged.
"RTN","BISELEC1",103,0)
 ..X $P(BIID,";",2)
"RTN","BISELEC1",104,0)
 ..S BIIDTX=X
"RTN","BISELEC1",105,0)
 ..Q:BIIDTX=""
"RTN","BISELEC1",106,0)
 ..;---> Tab out to specified column.
"RTN","BISELEC1",107,0)
 ..N BITAB S BITAB=$P(BIID,";",3)
"RTN","BISELEC1",108,0)
 ..N BIADD S BIADD=BITAB-($L(BINAME)+5)
"RTN","BISELEC1",109,0)
 ..;---> Minimum of 2 spaces between Name and Identifier.
"RTN","BISELEC1",110,0)
 ..S:BIADD<1 BIADD=2
"RTN","BISELEC1",111,0)
 ..S BIIDTX=$$SP^BIUTL5(BIADD)_BIIDTX
"RTN","BISELEC1",112,0)
 .;
"RTN","BISELEC1",113,0)
 .;---> Each node=IEN of Item_^_ItemName.
"RTN","BISELEC1",114,0)
 .;---> The array will be sorted alphabetically by ItemName.
"RTN","BISELEC1",115,0)
 .;---> Append IEN to ItemName to include legitimate duplicate names.
"RTN","BISELEC1",116,0)
 .S ^TMP("BILMGS1",$J,BINAME_BIIEN)=BIIEN_U_BINAME_$G(BIIDTX)
"RTN","BISELEC1",117,0)
 ;
"RTN","BISELEC1",118,0)
 ;
"RTN","BISELEC1",119,0)
 ;---> Now, convert ItemName-sorted array to Item-numbered array.
"RTN","BISELEC1",120,0)
 N I,N S N=0
"RTN","BISELEC1",121,0)
 F I=1:1 S N=$O(^TMP("BILMGS1",$J,N)) Q:N=""  D
"RTN","BISELEC1",122,0)
 .S ^TMP("BILMGS2",$J,I)=^TMP("BILMGS1",$J,N)
"RTN","BISELEC1",123,0)
 ;
"RTN","BISELEC1",124,0)
 ;---> Insert blank line at the top of the List Region.
"RTN","BISELEC1",125,0)
 S ^TMP("BILMGS",$J,1,0)=""
"RTN","BISELEC1",126,0)
 S ^TMP("BILMGS",$J,"IDX",1,1)=""
"RTN","BISELEC1",127,0)
 ;
"RTN","BISELEC1",128,0)
 ;---> Set each Item (or previously) selected into the array.
"RTN","BISELEC1",129,0)
 N N S N=0
"RTN","BISELEC1",130,0)
 F  S N=$O(^TMP("BILMGS2",$J,N)) Q:'N  D
"RTN","BISELEC1",131,0)
 .;---> Build display line for this Item.
"RTN","BISELEC1",132,0)
 .N X
"RTN","BISELEC1",133,0)
 .S X="  "_$J(N,3)_"  "_$P(^TMP("BILMGS2",$J,N),U,2)
"RTN","BISELEC1",134,0)
 .;
"RTN","BISELEC1",135,0)
 .;---> Set formatted Item line and index in ^TMP.
"RTN","BISELEC1",136,0)
 .S ^TMP("BILMGS",$J,N+1,0)=X
"RTN","BISELEC1",137,0)
 .S ^TMP("BILMGS",$J,"IDX",N+1,N)=""
"RTN","BISELEC1",138,0)
 ;
"RTN","BISELEC1",139,0)
 ;---> Finish up Listmanager List Count.
"RTN","BISELEC1",140,0)
 S VALMCNT=I
"RTN","BISELEC1",141,0)
 I VALMCNT>13 D
"RTN","BISELEC1",142,0)
 .S VALMSG="Scroll down to view more.  Type ?? for more actions."
"RTN","BISELEC1",143,0)
 Q
"RTN","BISELEC1",144,0)
 ;
"RTN","BISELEC1",145,0)
 ;
"RTN","BISELEC1",146,0)
 ;----------
"RTN","BISELEC1",147,0)
INIT1 ;EP
"RTN","BISELEC1",148,0)
 ;
"RTN","BISELEC1",149,0)
 I $O(@(BIARR1_"(0)"))="" S VALMCNT=0 Q
"RTN","BISELEC1",150,0)
 ;
"RTN","BISELEC1",151,0)
 ;---> Set Lower Frame Bar and Screen Title.
"RTN","BISELEC1",152,0)
 S VALMSG="Type ?? for more actions."
"RTN","BISELEC1",153,0)
 ;S VALM("TITLE")="Select "_BIITEMS
"RTN","BISELEC1",154,0)
 ;
"RTN","BISELEC1",155,0)
 ;---> Set Column Header line.
"RTN","BISELEC1",156,0)
 D:$G(BICOL)]""
"RTN","BISELEC1",157,0)
 .S VALMCAP=$$PAD^BIUTL5(BICOL,80)
"RTN","BISELEC1",158,0)
 ;
"RTN","BISELEC1",159,0)
 ;---> Convert CODE-sorted array to CodeName-sorted array.
"RTN","BISELEC1",160,0)
 ;---> This will present Items in a numbered list, 1,2,3...,
"RTN","BISELEC1",161,0)
 ;---> with the Item names in alphabetical order, so the user
"RTN","BISELEC1",162,0)
 ;---> can search the list of Items in order.
"RTN","BISELEC1",163,0)
 ;
"RTN","BISELEC1",164,0)
 Q:'$D(^DD(BIFILE,BIFLD,0))
"RTN","BISELEC1",165,0)
 N BISET S BISET=$P(^DD(BIFILE,BIFLD,0),U,3)
"RTN","BISELEC1",166,0)
 ;
"RTN","BISELEC1",167,0)
 ;---> First, build array sorted by Code.
"RTN","BISELEC1",168,0)
 N BICODE S BICODE=0
"RTN","BISELEC1",169,0)
 F  S BICODE=$O(@(BIARR1_"(BICODE)")) Q:BICODE=""  D
"RTN","BISELEC1",170,0)
 .;
"RTN","BISELEC1",171,0)
 .;---> If the Code does not really exist in the Set of Codes,
"RTN","BISELEC1",172,0)
 .;---> remove it from the Selection Array.
"RTN","BISELEC1",173,0)
 .I BISET'[BICODE_":" K @(BIARR1_"(BICODE)") Q
"RTN","BISELEC1",174,0)
 .;
"RTN","BISELEC1",175,0)
 .N BICODNM
"RTN","BISELEC1",176,0)
 .S BICODNM=$P($P(BISET,BICODE_":",2),";")
"RTN","BISELEC1",177,0)
 .;
"RTN","BISELEC1",178,0)
 .;---> The array will be sorted alphabetically by CodeName.
"RTN","BISELEC1",179,0)
 .;---> Append Code to CodeName to include legitimate duplicate names.
"RTN","BISELEC1",180,0)
 .S ^TMP("BILMGS1",$J,BICODNM_BICODE)=BICODE_U_BICODNM
"RTN","BISELEC1",181,0)
 ;
"RTN","BISELEC1",182,0)
 ;---> Now, convert ItemName-sorted array to Item-numbered array.
"RTN","BISELEC1",183,0)
 N I,N S N=0
"RTN","BISELEC1",184,0)
 F I=1:1 S N=$O(^TMP("BILMGS1",$J,N)) Q:N=""  D
"RTN","BISELEC1",185,0)
 .S ^TMP("BILMGS2",$J,I)=^TMP("BILMGS1",$J,N)
"RTN","BISELEC1",186,0)
 ;
"RTN","BISELEC1",187,0)
 ;---> Insert blank line at the top of the List Region.
"RTN","BISELEC1",188,0)
 S ^TMP("BILMGS",$J,1,0)=""
"RTN","BISELEC1",189,0)
 S ^TMP("BILMGS",$J,"IDX",1,1)=""
"RTN","BISELEC1",190,0)
 ;
"RTN","BISELEC1",191,0)
 ;---> Set each Item (or previously) selected into the array.
"RTN","BISELEC1",192,0)
 N N S N=0
"RTN","BISELEC1",193,0)
 F  S N=$O(^TMP("BILMGS2",$J,N)) Q:'N  D
"RTN","BISELEC1",194,0)
 .;---> Build display line for this Item.
"RTN","BISELEC1",195,0)
 .N X,Y
"RTN","BISELEC1",196,0)
 .S Y=^TMP("BILMGS2",$J,N)
"RTN","BISELEC1",197,0)
 .S X="  "_$J(N,3)_"  "_$$PAD^BIUTL5($P(Y,U,2),32)_$P(Y,U)
"RTN","BISELEC1",198,0)
 .;
"RTN","BISELEC1",199,0)
 .;---> Set formatted Item line and index in ^TMP.  Also, save
"RTN","BISELEC1",200,0)
 .;---> "Left Column Number" and its corresponding Code, for deletions.
"RTN","BISELEC1",201,0)
 .S ^TMP("BILMGS",$J,N+1,0)=X
"RTN","BISELEC1",202,0)
 .S ^TMP("BILMGS",$J,"IDX",N+1,N)=""
"RTN","BISELEC1",203,0)
 ;
"RTN","BISELEC1",204,0)
 ;---> Finish up Listmanager List Count.
"RTN","BISELEC1",205,0)
 S VALMCNT=I
"RTN","BISELEC1",206,0)
 I VALMCNT>13 D
"RTN","BISELEC1",207,0)
 .S VALMSG="Scroll down to view more.  Type ?? for more actions."
"RTN","BISELEC1",208,0)
 Q
"RTN","BISELEC1",209,0)
 ;
"RTN","BISELEC1",210,0)
 ;
"RTN","BISELEC1",211,0)
 ;----------
"RTN","BISELEC1",212,0)
RESET ;EP
"RTN","BISELEC1",213,0)
 ;---> Update partition for return to Listmanager.
"RTN","BISELEC1",214,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BISELEC1",215,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BISELEC1",216,0)
 D INIT,HDR
"RTN","BISELEC1",217,0)
 Q
"RTN","BISELEC1",218,0)
 ;
"RTN","BISELEC1",219,0)
 ;
"RTN","BISELEC1",220,0)
 ;----------
"RTN","BISELEC1",221,0)
HELP ;EP
"RTN","BISELEC1",222,0)
 ;----> Help text display when "?" is entered.
"RTN","BISELEC1",223,0)
 N BIXX S BIXX=$S($G(BIITEMS)="":"Items",1:BIITEMS)
"RTN","BISELEC1",224,0)
 D EN^XBNEW("HELP1^BISELEC1","VALM*;IO*;BIXX")
"RTN","BISELEC1",225,0)
 D RESET
"RTN","BISELEC1",226,0)
 Q
"RTN","BISELEC1",227,0)
 ;
"RTN","BISELEC1",228,0)
 ;
"RTN","BISELEC1",229,0)
 ;----------
"RTN","BISELEC1",230,0)
HELP1 ;EP
"RTN","BISELEC1",231,0)
 ;---> Display Help Text in Listmanager.
"RTN","BISELEC1",232,0)
 ;
"RTN","BISELEC1",233,0)
 ;---> Set Help Text into local array.
"RTN","BISELEC1",234,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BISELEC1",235,0)
 ;---> Insert the passed Item Name into the Help Text array.
"RTN","BISELEC1",236,0)
 N N S N=0
"RTN","BISELEC1",237,0)
 F  S N=$O(BITEXT(N)) Q:'N  D
"RTN","BISELEC1",238,0)
 .Q:BITEXT(N)'[" BIXX"
"RTN","BISELEC1",239,0)
 .N X S X=$P(BITEXT(N),"BIXX")_BIXX_$P(BITEXT(N),"BIXX",2),BITEXT(N)=X
"RTN","BISELEC1",240,0)
 ;
"RTN","BISELEC1",241,0)
 D START^BIHELP("LIST SELECTION UTILITY - HELP",.BITEXT)
"RTN","BISELEC1",242,0)
 Q
"RTN","BISELEC1",243,0)
 ;
"RTN","BISELEC1",244,0)
 ;
"RTN","BISELEC1",245,0)
 ;----------
"RTN","BISELEC1",246,0)
TEXT1(BITEXT) ;EP
"RTN","BISELEC1",247,0)
 ;;This allows you to select and build a list of BIXX
"RTN","BISELEC1",248,0)
 ;;for your report.  The following four actions are available:
"RTN","BISELEC1",249,0)
 ;;
"RTN","BISELEC1",250,0)
 ;;ADD...: Use this to select BIXX from the file of
"RTN","BISELEC1",251,0)
 ;;        BIXX and add them to your list.
"RTN","BISELEC1",252,0)
 ;;
"RTN","BISELEC1",253,0)
 ;;DELETE: Use this to remove items from your list.
"RTN","BISELEC1",254,0)
 ;;
"RTN","BISELEC1",255,0)
 ;;ENTIRE: Use this to add ALL items from the file to your list.
"RTN","BISELEC1",256,0)
 ;;        This may be useful if you want to select MOST of the items
"RTN","BISELEC1",257,0)
 ;;        in the file by adding all and then deleting the few items
"RTN","BISELEC1",258,0)
 ;;        you do not want.  This will only work for up to 300 items.
"RTN","BISELEC1",259,0)
 ;;        If the file contains more than 300 items, it will simply add
"RTN","BISELEC1",260,0)
 ;;        ALL items and quit.
"RTN","BISELEC1",261,0)
 ;;
"RTN","BISELEC1",262,0)
 ;;CLEAR.: Use this to remove all items from your list (and start over).
"RTN","BISELEC1",263,0)
 ;;
"RTN","BISELEC1",264,0)
 ;;Your personal list of BIXX will be saved each time
"RTN","BISELEC1",265,0)
 ;;you build it.  Whenever you return to this list, the previous
"RTN","BISELEC1",266,0)
 ;;list of BIXX you built will be presented as a
"RTN","BISELEC1",267,0)
 ;;default list.
"RTN","BISELEC1",268,0)
 ;;
"RTN","BISELEC1",269,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BISELEC1",270,0)
 Q
"RTN","BISELEC1",271,0)
 ;
"RTN","BISELEC1",272,0)
 ;
"RTN","BISELEC1",273,0)
 ;----------
"RTN","BISELEC1",274,0)
EXIT ;EP
"RTN","BISELEC1",275,0)
 K ^TMP("BILMGS",$J),^TMP("BILMGS1",$J),^TMP("BILMGS2",$J),^TMP("BILMGS3",$J)
"RTN","BISELEC1",276,0)
 D CLEAR^VALM1
"RTN","BISELEC1",277,0)
 Q
"RTN","BISELEC1",278,0)
 ;
"RTN","BISELEC1",279,0)
 ;
"RTN","BISELEC1",280,0)
 ;----------
"RTN","BISELEC1",281,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BISELEC1",282,0)
 Q:$G(BILINL)=""
"RTN","BISELEC1",283,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BISELEC1",284,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BISELEC1",285,0)
 Q
"RTN","BISELEC2")
0^138^B18939256
"RTN","BISELEC2",1,0)
BISELEC2 ;IHS/CMI/MWR - GENERIC SELECTION UTILITY; MAY 10, 2010
"RTN","BISELEC2",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BISELEC2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISELEC2",4,0)
 ;;  ADD AND DELETE ITEMS IN THE SELECTION ARRAY.
"RTN","BISELEC2",5,0)
 ;
"RTN","BISELEC2",6,0)
 ;
"RTN","BISELEC2",7,0)
 ;----------
"RTN","BISELEC2",8,0)
ADDITEM ;EP
"RTN","BISELEC2",9,0)
 ;---> Add an Item to the Selection Array via List Manager.
"RTN","BISELEC2",10,0)
 ;---> Steps:
"RTN","BISELEC2",11,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BISELEC2",12,0)
 ;               BI GEN SELECT ADD, an action on the List Manager
"RTN","BISELEC2",13,0)
 ;               menu protocol: BI MENU GEN SELECT.
"RTN","BISELEC2",14,0)
 ;
"RTN","BISELEC2",15,0)
 ;            2) This code calls ^DIC for the user to lookup and
"RTN","BISELEC2",16,0)
 ;               and select Items in the file/global @BIGBL.
"RTN","BISELEC2",17,0)
 ;
"RTN","BISELEC2",18,0)
 ;            3) The IEN of the selected Item is then stored as
"RTN","BISELEC2",19,0)
 ;               as a subscript in the Selection Array, @BIARR1.
"RTN","BISELEC2",20,0)
 ;
"RTN","BISELEC2",21,0)
 Q:$$CHECK^BISELECT()
"RTN","BISELEC2",22,0)
 ;
"RTN","BISELEC2",23,0)
 ;---> Call to select Item from File.
"RTN","BISELEC2",24,0)
 N BIART S BIART=$S("AEIOU"[$E(BIITEM):"an ",1:"a ")
"RTN","BISELEC2",25,0)
 D FULL^VALM1,TITLE^BIUTL5("Select "_BIART_BIITEM)
"RTN","BISELEC2",26,0)
 ;
"RTN","BISELEC2",27,0)
 ;---> Checks.
"RTN","BISELEC2",28,0)
 I '$G(BIFILE) D ERRCD^BIUTL2(607,,1) Q
"RTN","BISELEC2",29,0)
 I '$D(^DD(BIFILE)) D ERRCD^BIUTL2(608,,1) Q
"RTN","BISELEC2",30,0)
 I '$D(@(BIGBL_"0)")) D ERRCD^BIUTL2(601,,1) Q
"RTN","BISELEC2",31,0)
 ;
"RTN","BISELEC2",32,0)
 N Y
"RTN","BISELEC2",33,0)
 D
"RTN","BISELEC2",34,0)
 .;---> If this is a Set of Codes, make selection and quit.
"RTN","BISELEC2",35,0)
 .I $G(BIFLD) D  Q
"RTN","BISELEC2",36,0)
 ..N BISET S BISET=$P(^DD(BIFILE,BIFLD,0),U,3)
"RTN","BISELEC2",37,0)
 ..D DIR^BIFMAN("SOM"_U_BISET,.Y)  ;,"   Select "_BIITEM_": ")
"RTN","BISELEC2",38,0)
 ..;---> Set selected Item IEN into Selection Array.
"RTN","BISELEC2",39,0)
 ..S:((Y'="")&(Y'="^")) @(BIARR1_"(Y)")=""
"RTN","BISELEC2",40,0)
 .;
"RTN","BISELEC2",41,0)
 .;---> Select from a File.
"RTN","BISELEC2",42,0)
 .D DIC^BIFMAN(BIGBL,"QEMA",.Y,"   Select "_BIITEM_": ",,BISCRN)
"RTN","BISELEC2",43,0)
 .;---> Set selected Item IEN into Selection Array.
"RTN","BISELEC2",44,0)
 .S:+Y>0 @(BIARR1_"(+Y)")=""
"RTN","BISELEC2",45,0)
 ;
"RTN","BISELEC2",46,0)
 D RESET^BISELEC1
"RTN","BISELEC2",47,0)
 Q
"RTN","BISELEC2",48,0)
 ;
"RTN","BISELEC2",49,0)
 ;
"RTN","BISELEC2",50,0)
 ;----------
"RTN","BISELEC2",51,0)
ENTIRE ;EP
"RTN","BISELEC2",52,0)
 ;---> Add Entire File of Items or Set of Codes to the Selection Array.
"RTN","BISELEC2",53,0)
 ;---> Steps:
"RTN","BISELEC2",54,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BISELEC2",55,0)
 ;               BI GEN SELECT ENTIRE, an action on the List Manager
"RTN","BISELEC2",56,0)
 ;               menu protocol: BI MENU GEN SELECT.
"RTN","BISELEC2",57,0)
 ;
"RTN","BISELEC2",58,0)
 ;            2) If BIFIELD (a Field#) exists, load the entire Set of Codes.
"RTN","BISELEC2",59,0)
 ;               If the selection is from a File, this code evaluates the size
"RTN","BISELEC2",60,0)
 ;               of the entire global and determines if it is >300 entries.
"RTN","BISELEC2",61,0)
 ;               If so, then it returns @BIARR1("ALL") and quits Listmanager.
"RTN","BISELEC2",62,0)
 ;
"RTN","BISELEC2",63,0)
 ;            3) If the entire global is <300 entries, this code
"RTN","BISELEC2",64,0)
 ;               loops through the file global, evaluating entries
"RTN","BISELEC2",65,0)
 ;               against the screen, if there is a screen.
"RTN","BISELEC2",66,0)
 ;
"RTN","BISELEC2",67,0)
 ;            4) The IEN of each Item is then stored as
"RTN","BISELEC2",68,0)
 ;               as a subscript in the Selection Array, @BIARR1.
"RTN","BISELEC2",69,0)
 ;
"RTN","BISELEC2",70,0)
 Q:$$CHECK^BISELECT()
"RTN","BISELEC2",71,0)
 K @(BIARR1)
"RTN","BISELEC2",72,0)
 S @(BIARR1_"(""ALL"")")=""
"RTN","BISELEC2",73,0)
 ;
"RTN","BISELEC2",74,0)
 D
"RTN","BISELEC2",75,0)
 .;---> If this is a Set of Codes, set all Codes in Selection Array and quit.
"RTN","BISELEC2",76,0)
 .I $G(BIFLD) D  Q
"RTN","BISELEC2",77,0)
 ..N BISET S BISET=$P(^DD(BIFILE,BIFLD,0),U,3)
"RTN","BISELEC2",78,0)
 ..N I,X
"RTN","BISELEC2",79,0)
 ..F I=1:1 S X=$P(BISET,";",I) Q:X=""  D
"RTN","BISELEC2",80,0)
 ...N Y S Y=$P(X,":") S:Y]"" @(BIARR1_"(Y)")=""
"RTN","BISELEC2",81,0)
 .;
"RTN","BISELEC2",82,0)
 .;---> This is a selection from a File.
"RTN","BISELEC2",83,0)
 .;---> If entire file is too large for local partition,
"RTN","BISELEC2",84,0)
 .;---> do ENTIRE1 and quit.
"RTN","BISELEC2",85,0)
 .I $P(@(BIGBL_"0)"),U,4)>300 D ENTIRE1 Q
"RTN","BISELEC2",86,0)
 .;
"RTN","BISELEC2",87,0)
 .;---> Entire file is small enough to store and display locally.
"RTN","BISELEC2",88,0)
 .;---> Load each entry into Selection Array for review.
"RTN","BISELEC2",89,0)
 .;---> Screen, if there is one, applies.
"RTN","BISELEC2",90,0)
 .;
"RTN","BISELEC2",91,0)
 .;
"RTN","BISELEC2",92,0)
 .N BIIEN,I S BIIEN=0
"RTN","BISELEC2",93,0)
 .F I=1:1 S BIIEN=$O(@(BIGBL_"BIIEN)")) Q:'BIIEN  Q:I>300  D
"RTN","BISELEC2",94,0)
 ..;---> Check screen.
"RTN","BISELEC2",95,0)
 ..I BISCRN]"" N Y S Y=BIIEN X BISCRN Q:'$T
"RTN","BISELEC2",96,0)
 ..;
"RTN","BISELEC2",97,0)
 ..;---> Set Item IEN into Selection Array.
"RTN","BISELEC2",98,0)
 ..S @(BIARR1_"(BIIEN)")=""
"RTN","BISELEC2",99,0)
 .;
"RTN","BISELEC2",100,0)
 .;---> Global had more than 300 entries.
"RTN","BISELEC2",101,0)
 .I I>300 D ENTIRE1 Q
"RTN","BISELEC2",102,0)
 ;
"RTN","BISELEC2",103,0)
 D RESET^BISELEC1
"RTN","BISELEC2",104,0)
 Q
"RTN","BISELEC2",105,0)
 ;
"RTN","BISELEC2",106,0)
 ;
"RTN","BISELEC2",107,0)
 ;----------
"RTN","BISELEC2",108,0)
ENTIRE1 ;EP
"RTN","BISELEC2",109,0)
 ;---> Entire file of Items is too large to load and display
"RTN","BISELEC2",110,0)
 ;---> in local partition.
"RTN","BISELEC2",111,0)
 ;---> Set BIARR1("ALL"), inform user, tell Listman to quit.
"RTN","BISELEC2",112,0)
 ;---> NOTE: A Screen will not apply here.  See documentation
"RTN","BISELEC2",113,0)
 ;--->       top of ^BISELECT.
"RTN","BISELEC2",114,0)
 ;
"RTN","BISELEC2",115,0)
 ;
"RTN","BISELEC2",116,0)
 D FULL^VALM1,TITLE^BIUTL5("Select Entire File of "_BIITEMS)
"RTN","BISELEC2",117,0)
 W !!!?8,"NOTE: This file is too large to load for screen selection."
"RTN","BISELEC2",118,0)
 W !?14,"Instead, the entire file (ALL Items) have been selected"
"RTN","BISELEC2",119,0)
 W !?14,"automatically.",!!
"RTN","BISELEC2",120,0)
 D DIRZ^BIUTL3()
"RTN","BISELEC2",121,0)
 K @(BIARR1)
"RTN","BISELEC2",122,0)
 S @(BIARR1_"(""ALL"")")=""
"RTN","BISELEC2",123,0)
 S VALMBCK="Q"
"RTN","BISELEC2",124,0)
 S VALMQUIT=""
"RTN","BISELEC2",125,0)
 Q
"RTN","BISELEC2",126,0)
 ;
"RTN","BISELEC2",127,0)
 ;
"RTN","BISELEC2",128,0)
 ;----------
"RTN","BISELEC2",129,0)
DELITEM ;EP
"RTN","BISELEC2",130,0)
 ;---> Delete an Item from the Selection Array via List Manager.
"RTN","BISELEC2",131,0)
 ;---> Steps:
"RTN","BISELEC2",132,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BISELEC2",133,0)
 ;               BI GEN SELECT DELETE, an action on the List Manager
"RTN","BISELEC2",134,0)
 ;               menu protocol: BI MENU GEN SELECT.
"RTN","BISELEC2",135,0)
 ;
"RTN","BISELEC2",136,0)
 ;            2) This code gets an Item from Listmanager and
"RTN","BISELEC2",137,0)
 ;               deletes the Item from the Selection Array and the
"RTN","BISELEC2",138,0)
 ;               ^TMP global.
"RTN","BISELEC2",139,0)
 ;
"RTN","BISELEC2",140,0)
 Q:$$CHECK^BISELECT()
"RTN","BISELEC2",141,0)
 ;
"RTN","BISELEC2",142,0)
 ;---> Call the Listmanager Generic Selector of Items displayed.
"RTN","BISELEC2",143,0)
 N VALMY
"RTN","BISELEC2",144,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BISELEC2",145,0)
 ;
"RTN","BISELEC2",146,0)
 ;---> Check that a Listman Item was passed.
"RTN","BISELEC2",147,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET^BISELEC1 Q
"RTN","BISELEC2",148,0)
 N Y S Y=$O(VALMY(0))
"RTN","BISELEC2",149,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET^BISELEC1 Q
"RTN","BISELEC2",150,0)
 ;
"RTN","BISELEC2",151,0)
 ;---> Now set Y=IEN of the Item to delete in the BIARR1 local array.
"RTN","BISELEC2",152,0)
 S Y=$P($G(^TMP("BILMGS2",$J,Y)),U)
"RTN","BISELEC2",153,0)
 I Y="" D ERRCD^BIUTL2(604,,1) D RESET^BISELEC1 Q
"RTN","BISELEC2",154,0)
 ;
"RTN","BISELEC2",155,0)
 ;---> If ALL/ENTIRE was previously selected, it is no longer valid,
"RTN","BISELEC2",156,0)
 ;---> so kill it.
"RTN","BISELEC2",157,0)
 K @(BIARR1_"(""ALL"")")
"RTN","BISELEC2",158,0)
 ;---> Delete the Item from the Selection Array.
"RTN","BISELEC2",159,0)
 K @(BIARR1_"(Y)")
"RTN","BISELEC2",160,0)
 S BIPOP=""
"RTN","BISELEC2",161,0)
 ;
"RTN","BISELEC2",162,0)
 D RESET^BISELEC1
"RTN","BISELEC2",163,0)
 Q
"RTN","BISELEC2",164,0)
 ;
"RTN","BISELEC2",165,0)
 ;
"RTN","BISELEC2",166,0)
 ;----------
"RTN","BISELEC2",167,0)
CLEARALL ;EP
"RTN","BISELEC2",168,0)
 ;---> Clear/Delete ALL Items from the Selection Array.
"RTN","BISELEC2",169,0)
 ;---> Steps:
"RTN","BISELEC2",170,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BISELEC2",171,0)
 ;               BI GEN SELECT CLEAR ALL, an action on the List Manager
"RTN","BISELEC2",172,0)
 ;               menu protocol: BI MENU GEN SELECT.
"RTN","BISELEC2",173,0)
 ;
"RTN","BISELEC2",174,0)
 ;            2) This code deletes ALL Items from Listmanager and
"RTN","BISELEC2",175,0)
 ;               from the Selection Array and ^TMP global.
"RTN","BISELEC2",176,0)
 ;
"RTN","BISELEC2",177,0)
 Q:$$CHECK^BISELECT()
"RTN","BISELEC2",178,0)
 ;
"RTN","BISELEC2",179,0)
 ;---> Delete the Item from the Selection Array.
"RTN","BISELEC2",180,0)
 K @(BIARR1)
"RTN","BISELEC2",181,0)
 K ^TMP("BILMGS",$J),^TMP("BILMGS1",$J),^TMP("BILMGS2",$J)
"RTN","BISELEC2",182,0)
 ;
"RTN","BISELEC2",183,0)
 D RESET^BISELEC1
"RTN","BISELEC2",184,0)
 Q
"RTN","BISELECT")
0^139^B36757927
"RTN","BISELECT",1,0)
BISELECT ;IHS/CMI/MWR - GENERIC SELECTION UTILITY ; MAY 10, 2010
"RTN","BISELECT",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BISELECT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISELECT",4,0)
 ;;  UTILITY TO PROMPT FOR MULTIPLE SELECTIONS FROM A FILE AND STORE
"RTN","BISELECT",5,0)
 ;;  THEM IN A LOCAL ARRAY FOR CALLING PROGRAM.
"RTN","BISELECT",6,0)
 ;
"RTN","BISELECT",7,0)
 ;
"RTN","BISELECT",8,0)
 ;---> Executable example selecting Entries from a File.
"RTN","BISELECT",9,0)
 D SEL(9999999.14,"BIZZ")
"RTN","BISELECT",10,0)
 Q
"RTN","BISELECT",11,0)
 ;
"RTN","BISELECT",12,0)
 ;---> Executable example selecting Codes from a Set of Codes in a Field.
"RTN","BISELECT",13,0)
 ;---> Key element is 11th Parameter, the Field# (must be a Set of Codes).
"RTN","BISELECT",14,0)
 N BINAM S BINAM="Visit Type"
"RTN","BISELECT",15,0)
 N BICOL S BICOL="    #  Visit Type                     Code"
"RTN","BISELECT",16,0)
 D SEL^BISELECT(9000010,"BIVT",BINAM,,,,,BICOL,.BIPOP,,".03")
"RTN","BISELECT",17,0)
 Q
"RTN","BISELECT",18,0)
 ;
"RTN","BISELECT",19,0)
 ;
"RTN","BISELECT",20,0)
 ;----------
"RTN","BISELECT",21,0)
SEL(BIFILE,BIARR1,BIITEM,BISCRN,BIDFLT,BIPC,BIID,BICOL,BIPOP,BINONE,BIFLD,BIDFA,BITITEM) ;EP
"RTN","BISELECT",22,0)
 ;---> Generic utility to prompt user for selections from a file.
"RTN","BISELECT",23,0)
 ;---> Returns local array with subscripts of IENs selected.
"RTN","BISELECT",24,0)
 ;---> Parameters:
"RTN","BISELECT",25,0)
 ;     1 - BIFILE  (req) File Number from which selection will be made.
"RTN","BISELECT",26,0)
 ;
"RTN","BISELECT",27,0)
 ;     2 - BIARR1  (req) Selection Array.
"RTN","BISELECT",28,0)
 ;                       Local array in which selections will be stored.
"RTN","BISELECT",29,0)
 ;                       May not be a global.
"RTN","BISELECT",30,0)
 ;                       The Selection Array MUST BE UNSUBSCRIPTED--
"RTN","BISELECT",31,0)
 ;                       may not contain "(", commas, or subscripts.
"RTN","BISELECT",32,0)
 ;                       If ALL entries in the file are selected and
"RTN","BISELECT",33,0)
 ;                       the array would be more than 300 entries, then
"RTN","BISELECT",34,0)
 ;                       BIARR1_"(""ALL"")" is returned.
"RTN","BISELECT",35,0)
 ;                       NOTE: This CANNOT be "BIARR1" or it will
"RTN","BISELECT",36,0)
 ;                             kill the variable, BIARR1, that stores
"RTN","BISELECT",37,0)
 ;                             the local array name!
"RTN","BISELECT",38,0)
 ;
"RTN","BISELECT",39,0)
 ;     3 - BIITEM  (opt) Catagoric name of Items being selected.
"RTN","BISELECT",40,0)
 ;     4 - BISCRN  (opt) Screen used in selection lookup.
"RTN","BISELECT",41,0)
 ;                       NO NAKED REFERENCES.  Use full global refs.
"RTN","BISELECT",42,0)
 ;     5 - BIDFLT  (opt) Default first selection (if no previous).
"RTN","BISELECT",43,0)
 ;     6 - BIPC    (opt) Piece of zero node to display as ItemName.
"RTN","BISELECT",44,0)
 ;                       (Default is 1.)
"RTN","BISELECT",45,0)
 ;
"RTN","BISELECT",46,0)
 ;     7 - BIID    (opt) Identifier: Three pieces delimited by ";".
"RTN","BISELECT",47,0)
 ;                       1st piece = the "^" piece of 0 node to get X.
"RTN","BISELECT",48,0)
 ;                       2nd piece = Code to set X=text of identifier.
"RTN","BISELECT",49,0)
 ;                                   If null, raw data in the piece of
"RTN","BISELECT",50,0)
 ;                                   0 node (as specified above) will
"RTN","BISELECT",51,0)
 ;                                   be displayed.
"RTN","BISELECT",52,0)
 ;                       3rd piece = Tab for identfier.
"RTN","BISELECT",53,0)
 ;
"RTN","BISELECT",54,0)
 ;                       Examples:
"RTN","BISELECT",55,0)
 ;                         Display 3rd pc of 0 node:  S BIID="3"
"RTN","BISELECT",56,0)
 ;
"RTN","BISELECT",57,0)
 ;                         Display 3rd pc of 0 node,
"RTN","BISELECT",58,0)
 ;                                 tabbed out to 40:  S BIID="3;;40"
"RTN","BISELECT",59,0)
 ;
"RTN","BISELECT",60,0)
 ;                         Set X=3rd pc of 0 node, use it as an IEN in
"RTN","BISELECT",61,0)
 ;                         the STATE file, set X=text of State, tab out
"RTN","BISELECT",62,0)
 ;                         to column 25 in Listman display:
"RTN","BISELECT",63,0)
 ;
"RTN","BISELECT",64,0)
 ;                 S BIID="3;I $G(X) S:$D(^DIC(5,X,0)) X=$P(^(0),U);25"
"RTN","BISELECT",65,0)
 ;
"RTN","BISELECT",66,0)
 ;
"RTN","BISELECT",67,0)
 ;     8 - BICOL   (opt) Line of text that will be column headers.
"RTN","BISELECT",68,0)
 ;
"RTN","BISELECT",69,0)
 ;     9 - BIPOP   (ret) BIPOP=1 if quit or error.
"RTN","BISELECT",70,0)
 ;
"RTN","BISELECT",71,0)
 ;    10 - BINONE  (opt) If BINONE=1 and NO selections were made,
"RTN","BISELECT",72,0)
 ;                          do not return any BIARR1.
"RTN","BISELECT",73,0)
 ;                       If '$G(BINONE) and NO selections were made,
"RTN","BISELECT",74,0)
 ;                          return BIARR1_("ALL").
"RTN","BISELECT",75,0)
 ;                       If user selects "Entire File", then "ALL" will
"RTN","BISELECT",76,0)
 ;                          be returned regardless of BINONE.
"RTN","BISELECT",77,0)
 ;
"RTN","BISELECT",78,0)
 ;    11 - BIFLD   (opt) BIFLD=Field# If BIFLD has a value, it indicates
"RTN","BISELECT",79,0)
 ;                       that this is NOT a selection from a file; rather
"RTN","BISELECT",80,0)
 ;                       it is a selection of Codes from a field in BIFILE.
"RTN","BISELECT",81,0)
 ;
"RTN","BISELECT",82,0)
 ;    12 - BIDFA   (opt) BIDFA=Default Array of choices.
"RTN","BISELECT",83,0)
 ;    13 - BITITEM (opt) Catagoric name of Title Items being selected.
"RTN","BISELECT",84,0)
 ;                       This might be a specific name for the items chosen,
"RTN","BISELECT",85,0)
 ;                       as opposed to the generic name (e.g,. "ER Doctors"
"RTN","BISELECT",86,0)
 ;                       as opposed to "Doctors").
"RTN","BISELECT",87,0)
 ;
"RTN","BISELECT",88,0)
 ;
"RTN","BISELECT",89,0)
 ;---> Examples of calls:
"RTN","BISELECT",90,0)
 ;
"RTN","BISELECT",91,0)
 ;  Simple call: Select one or more Vaccines and store
"RTN","BISELECT",92,0)
 ;               in the local array BIZZ:
"RTN","BISELECT",93,0)
 ;
"RTN","BISELECT",94,0)
 ;   D SEL^BISELECT(9999999.14,"BIZZ")
"RTN","BISELECT",95,0)
 ;
"RTN","BISELECT",96,0)
 ;
"RTN","BISELECT",97,0)
 ;  Complex call: Select one or more Active Vaccines and store
"RTN","BISELECT",98,0)
 ;                in the local array BIZZ.  Also, display Current
"RTN","BISELECT",99,0)
 ;                Lot Number, tabbed to column 20 in Listman display.
"RTN","BISELECT",100,0)
 ;
"RTN","BISELECT",101,0)
 ;   S SCRN="I '$P(^AUTTIMM(Y,0),U,7)"
"RTN","BISELECT",102,0)
 ;   S IDEN="4;I $G(X) S:$D(^AUTTIML(X,0)) X=$P(^(0),U);20"
"RTN","BISELECT",103,0)
 ;   D SEL^BISELECT(9999999.14,"BIZZ","Vaccine",SCRN,,2,IDEN,,.BIPOP)
"RTN","BISELECT",104,0)
 ;
"RTN","BISELECT",105,0)
 ;
"RTN","BISELECT",106,0)
 ;---> Example use of Selection Array in calling routine:
"RTN","BISELECT",107,0)
 ;       I '$D(BIARR("ALL")) Q:'$D(BIARR($P(Y,U,4)))
"RTN","BISELECT",108,0)
 ;       "If not selecting all, then quit if the fourth piece of
"RTN","BISELECT",109,0)
 ;        this entry (Y) is not one of the items selected."
"RTN","BISELECT",110,0)
 ;
"RTN","BISELECT",111,0)
 ;
"RTN","BISELECT",112,0)
 N BIDUZF,BIGBL,BIITEMS,BITITEMS,DIC,DIK,DIR,I,X,Y,Z
"RTN","BISELECT",113,0)
 S BIPOP=0
"RTN","BISELECT",114,0)
 ;
"RTN","BISELECT",115,0)
 ;---> Check/set required variables.
"RTN","BISELECT",116,0)
 I $$CHECK() S BIPOP=1 Q
"RTN","BISELECT",117,0)
 ;
"RTN","BISELECT",118,0)
 ;---> BIDUZF=User-File# identifier to store and retrieve
"RTN","BISELECT",119,0)
 ;---> previous lists of selections from this file.
"RTN","BISELECT",120,0)
 S BIDUZF=DUZ_"-"_BIFILE
"RTN","BISELECT",121,0)
 ;---> If this is a Set of Codes, concat Field#.
"RTN","BISELECT",122,0)
 S:$G(BIFLD) BIDUZF=BIDUZF_"-"_BIFLD
"RTN","BISELECT",123,0)
 ;
"RTN","BISELECT",124,0)
 ;---> Clear "ALL" node.
"RTN","BISELECT",125,0)
 K @(BIARR1_"(""ALL"")")
"RTN","BISELECT",126,0)
 ;
"RTN","BISELECT",127,0)
 ;---> If a Default Local Array of selections was passed, set them now.
"RTN","BISELECT",128,0)
 ;---> NOTE: This passed default array will OVERRIDE a previously selected
"RTN","BISELECT",129,0)
 ;---> and stored array in ^BISELECT.
"RTN","BISELECT",130,0)
 D:$O(BIDFA(0))
"RTN","BISELECT",131,0)
 .N N S N=0
"RTN","BISELECT",132,0)
 .F  S N=$O(BIDFA(N)) Q:'N  S @(BIARR1_"(N)")=""
"RTN","BISELECT",133,0)
 ;
"RTN","BISELECT",134,0)
 ;---> If previously stored selections exist for this user,
"RTN","BISELECT",135,0)
 ;---> pre-load these into the Selection Array that Listmanager
"RTN","BISELECT",136,0)
 ;---> will be processing.
"RTN","BISELECT",137,0)
 I $D(^BISELECT("B",BIDUZF)) D
"RTN","BISELECT",138,0)
 .;---> Quit if a local array of selections already exists.
"RTN","BISELECT",139,0)
 .Q:$O(@(BIARR1_"(0)"))
"RTN","BISELECT",140,0)
 .N BIDA S BIDA=$O(^BISELECT("B",BIDUZF,0))
"RTN","BISELECT",141,0)
 .Q:'BIDA  Q:$G(^BISELECT(BIDA,0))=""
"RTN","BISELECT",142,0)
 .Q:'$O(^BISELECT(BIDA,1,0))
"RTN","BISELECT",143,0)
 .N Y S Y=0
"RTN","BISELECT",144,0)
 .F  S Y=$O(^BISELECT(BIDA,1,Y)) Q:Y=""  D
"RTN","BISELECT",145,0)
 ..;---> If this is a Set of Codes, set the Value of the stored node
"RTN","BISELECT",146,0)
 ..;---> (rather than the subscript) into the Selection Array.
"RTN","BISELECT",147,0)
 ..I $G(BIFLD) D  Q
"RTN","BISELECT",148,0)
 ...N Z S Z=^BISELECT(BIDA,1,Y,0),@(BIARR1_"(Z)")=""
"RTN","BISELECT",149,0)
 ..S @(BIARR1_"(Y)")=""
"RTN","BISELECT",150,0)
 ;
"RTN","BISELECT",151,0)
 ;
"RTN","BISELECT",152,0)
 ;---> If there are no previous selections and a default
"RTN","BISELECT",153,0)
 ;---> was passed, load the default into the Selection Array.
"RTN","BISELECT",154,0)
 I '$O(@(BIARR1_"(0)")) I BIDFLT S @(BIARR1_"(+BIDFLT)")=""
"RTN","BISELECT",155,0)
 ;
"RTN","BISELECT",156,0)
 ;
"RTN","BISELECT",157,0)
 ;---> * Listmanager call to add/delete Items in the Selection Array.
"RTN","BISELECT",158,0)
 D START^BISELEC1(.BIARR1,BIGBL,BIITEMS,BITITEMS,BIPC,BISCRN,BIID,BICOL,BIFLD,.BIPOP)
"RTN","BISELECT",159,0)
 ;
"RTN","BISELECT",160,0)
 ;---> If All were selected, remove any specific IENs from array.
"RTN","BISELECT",161,0)
 ;---> Also leave intact user's previous selection (don't store "Entire").
"RTN","BISELECT",162,0)
 I $D(@(BIARR1_"(""ALL"")")) K @(BIARR1) S @(BIARR1_"(""ALL"")")="" Q
"RTN","BISELECT",163,0)
 ;
"RTN","BISELECT",164,0)
 ;---> If none were selected BINONE'=1, Set (return) BIARR1_"ALL"
"RTN","BISELECT",165,0)
 I '$D(@(BIARR1)),'$G(BINONE) S @(BIARR1_"(""ALL"")")=""
"RTN","BISELECT",166,0)
 Q:BIPOP
"RTN","BISELECT",167,0)
 ;
"RTN","BISELECT",168,0)
 ;
"RTN","BISELECT",169,0)
 ;---> Now store list of Items selected in this file for next time.
"RTN","BISELECT",170,0)
 ;
"RTN","BISELECT",171,0)
 ;---> If the user selected nothing or Entire, leave previous selection intact.
"RTN","BISELECT",172,0)
 Q:$O(@(BIARR1_"(0)"))=""
"RTN","BISELECT",173,0)
 ;
"RTN","BISELECT",174,0)
 ;---> Clear any previous selection this user had for this file.
"RTN","BISELECT",175,0)
 I $D(^BISELECT("B",BIDUZF)) D
"RTN","BISELECT",176,0)
 .N DA,DIK S DA=$O(^BISELECT("B",BIDUZF,0)),DIK="^BISELECT("
"RTN","BISELECT",177,0)
 .D ^DIK
"RTN","BISELECT",178,0)
 .S $P(^BISELECT(0),U,3)=1
"RTN","BISELECT",179,0)
 ;
"RTN","BISELECT",180,0)
 ;---> Now store the selections for this user.
"RTN","BISELECT",181,0)
 N Y
"RTN","BISELECT",182,0)
 D FILE^BIFMAN(9002084.61,BIDUZF,"ML",,,.Y)
"RTN","BISELECT",183,0)
 Q:Y<1
"RTN","BISELECT",184,0)
 D
"RTN","BISELECT",185,0)
 .;---> If this is a Set of Codes, assign IEN's.
"RTN","BISELECT",186,0)
 .I +$G(BIFLD) D  Q
"RTN","BISELECT",187,0)
 ..N I,N S N=0,Y=+Y
"RTN","BISELECT",188,0)
 ..F I=1:1 S N=$O(@(BIARR1_"(N)")) Q:N=""  D
"RTN","BISELECT",189,0)
 ...S ^BISELECT(Y,1,I,0)=N
"RTN","BISELECT",190,0)
 .;
"RTN","BISELECT",191,0)
 .;---> Store IEN's of a File.
"RTN","BISELECT",192,0)
 .N N S N=0,Y=+Y
"RTN","BISELECT",193,0)
 .F  S N=$O(@(BIARR1_"(N)")) Q:'N  D
"RTN","BISELECT",194,0)
 ..S ^BISELECT(Y,1,N,0)=N
"RTN","BISELECT",195,0)
 ;
"RTN","BISELECT",196,0)
 Q
"RTN","BISELECT",197,0)
 ;
"RTN","BISELECT",198,0)
 ;
"RTN","BISELECT",199,0)
 ;----------
"RTN","BISELECT",200,0)
CHECK() ;EP
"RTN","BISELECT",201,0)
 ;---> Check required variables.
"RTN","BISELECT",202,0)
 ;
"RTN","BISELECT",203,0)
 I $G(DUZ)="" D ERRCD^BIUTL2(106,,1) Q 1
"RTN","BISELECT",204,0)
 ;
"RTN","BISELECT",205,0)
 ;---> Check that the File Number was passed and is legitimate.
"RTN","BISELECT",206,0)
 I '$G(BIFILE) D ERRCD^BIUTL2(607,,1) Q 1
"RTN","BISELECT",207,0)
 I '$D(^DD(BIFILE)) D ERRCD^BIUTL2(608,,1) Q 1
"RTN","BISELECT",208,0)
 I '$D(^DIC(BIFILE,0,"GL")) D ERRCD^BIUTL2(608,,1) Q 1
"RTN","BISELECT",209,0)
 ;
"RTN","BISELECT",210,0)
 ;---> Check that Selection Array name for Item storage is present.
"RTN","BISELECT",211,0)
 I $G(BIARR1)="" D ERRCD^BIUTL2(602,,1) Q 1
"RTN","BISELECT",212,0)
 ;---> Check valid form of Selection Array root.
"RTN","BISELECT",213,0)
 I BIARR1["(" D ERRCD^BIUTL2(605,,1) Q 1
"RTN","BISELECT",214,0)
 I $E(BIARR1)="^" D ERRCD^BIUTL2(606,,1) Q 1
"RTN","BISELECT",215,0)
 ;
"RTN","BISELECT",216,0)
 ;---> Set lookup global.
"RTN","BISELECT",217,0)
 D:$G(BIGBL)=""
"RTN","BISELECT",218,0)
 .S BIGBL=^DIC(BIFILE,0,"GL")
"RTN","BISELECT",219,0)
 .;
"RTN","BISELECT",220,0)
 .;---> If .01 field is a pointer, reset global to get text from
"RTN","BISELECT",221,0)
 .;---> pointed-to global.
"RTN","BISELECT",222,0)
 .I $P(^DD(BIFILE,.01,0),U,2)["P" S BIGBL="^"_$P(^(0),U,3)
"RTN","BISELECT",223,0)
 ;
"RTN","BISELECT",224,0)
 ;---> Check that the global for Item selection is legitimate.
"RTN","BISELECT",225,0)
 I '$D(@(BIGBL_"0)")) D ERRCD^BIUTL2(601,,1) Q 1
"RTN","BISELECT",226,0)
 ;
"RTN","BISELECT",227,0)
 ;---> Check that variable for Item name is present.
"RTN","BISELECT",228,0)
 I $G(BIITEM)="" S BIITEM=$P($G(^DD(BIFILE,.01,0)),U)
"RTN","BISELECT",229,0)
 S:BIITEM="" BIITEM="Item"
"RTN","BISELECT",230,0)
 S:'$D(BITITEM) BITITEM=BIITEM
"RTN","BISELECT",231,0)
 ;
"RTN","BISELECT",232,0)
 ;---> Check for plural form of Item Name.
"RTN","BISELECT",233,0)
 I $G(BIITEMS)="" D PLURAL(BIITEM,.BIITEMS)
"RTN","BISELECT",234,0)
 I $G(BITITEMS)="" D PLURAL(BITITEM,.BITITEMS)
"RTN","BISELECT",235,0)
 ;
"RTN","BISELECT",236,0)
 ;---> Check for existence and value of optional input parameters.
"RTN","BISELECT",237,0)
 S:'$G(BIPC) BIPC=1
"RTN","BISELECT",238,0)
 S:$G(BISCRN)="" BISCRN=""
"RTN","BISELECT",239,0)
 S:'$G(BIDFLT) BIDFLT=""
"RTN","BISELECT",240,0)
 S:$G(BIID)="" BIID=""
"RTN","BISELECT",241,0)
 S:$G(BICOL)="" BICOL=""
"RTN","BISELECT",242,0)
 S:$G(BIFLD)="" BIFLD=""
"RTN","BISELECT",243,0)
 ;
"RTN","BISELECT",244,0)
 Q 0
"RTN","BISELECT",245,0)
 ;
"RTN","BISELECT",246,0)
 ;
"RTN","BISELECT",247,0)
 ;----------
"RTN","BISELECT",248,0)
PLURAL(BIITEM,BIITEMS) ;EP
"RTN","BISELECT",249,0)
 ;---> Add "s" for plural.
"RTN","BISELECT",250,0)
 ;---> If necessary change "y" to "i" and add "es".
"RTN","BISELECT",251,0)
 ;---> Parameters:
"RTN","BISELECT",252,0)
 ;     1 - BIITEM  (req) Item name, singular form.
"RTN","BISELECT",253,0)
 ;     2 - BIITEMS (ret) Item name, plural form.
"RTN","BISELECT",254,0)
 ;
"RTN","BISELECT",255,0)
 I $G(BIITEM)="" S BIITEMS="" Q
"RTN","BISELECT",256,0)
 ;
"RTN","BISELECT",257,0)
 I "Yy"[$E(BIITEM,$L(BIITEM)) D  Q
"RTN","BISELECT",258,0)
 .S BIITEMS=$E(BIITEM,1,($L(BIITEM)-1))_"ies"
"RTN","BISELECT",259,0)
 ;
"RTN","BISELECT",260,0)
 I "Xx"[$E(BIITEM,$L(BIITEM)) D  Q
"RTN","BISELECT",261,0)
 .S BIITEMS=BIITEM_"es"
"RTN","BISELECT",262,0)
 ;
"RTN","BISELECT",263,0)
 S BIITEMS=BIITEM_"s"
"RTN","BISELECT",264,0)
 Q
"RTN","BISELECT",265,0)
 ;
"RTN","BISELECT",266,0)
 ;
"RTN","BISELECT",267,0)
 ;----------
"RTN","BISELECT",268,0)
SELCODE(BIFILE,BIARR1,BIITEM,BISCRN,BIDFLT,BIPC,BIID,BICOL,BIPOP,BINONE) ;EP
"RTN","BISELECT",269,0)
 ;---> Generic utility to prompt user for selections from a file.
"RTN","BISELECT",270,0)
 ;---> Returns local array with subscripts of IENs selected.
"RTN","BISELECT",271,0)
 ;---> Parameters:
"RTN","BISELECT",272,0)
 ;     1 - BIFILE  (req) File Number from which selection will be made.
"RTN","BISELECT",273,0)
 Q
"RTN","BISITE")
0^1^B10999594
"RTN","BISITE",1,0)
BISITE ;IHS/CMI/MWR - EDIT SITE PARAMETERS; MAY 10, 2010
"RTN","BISITE",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BISITE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISITE",4,0)
 ;;  EDIT SITE PARAMETERS VIA LISTMAN.
"RTN","BISITE",5,0)
 ;
"RTN","BISITE",6,0)
 ;
"RTN","BISITE",7,0)
 ;----------
"RTN","BISITE",8,0)
START ;EP
"RTN","BISITE",9,0)
 ;---> Lookup and edit a Site.
"RTN","BISITE",10,0)
 D SETVARS^BIUTL5
"RTN","BISITE",11,0)
 N A,B
"RTN","BISITE",12,0)
 D TITLE^BIUTL5("EDIT SITE PARAMETERS") W !
"RTN","BISITE",13,0)
 S BIPRMPT="   Select SITE/FACILITY: ",BIDFLT=""
"RTN","BISITE",14,0)
 S:$D(DUZ(2)) BIDFLT=$$INSTTX^BIUTL6(DUZ(2))
"RTN","BISITE",15,0)
 D DIC^BIFMAN(9002084.02,"QEMAL",.Y,BIPRMPT,BIDFLT)
"RTN","BISITE",16,0)
 Q:Y<0
"RTN","BISITE",17,0)
 K BIPRMPT,BIDFLT
"RTN","BISITE",18,0)
 S BISITE=+Y
"RTN","BISITE",19,0)
 L +^BISITE(BISITE):2 I '$T D LOCKED^BIUTL3 Q
"RTN","BISITE",20,0)
 D EN(BISITE)
"RTN","BISITE",21,0)
 L -^BISITE(BISITE) L -^BISITE(BISITE)
"RTN","BISITE",22,0)
 Q
"RTN","BISITE",23,0)
 ;
"RTN","BISITE",24,0)
 ;
"RTN","BISITE",25,0)
 ;----------
"RTN","BISITE",26,0)
EN(BISITE) ;EP
"RTN","BISITE",27,0)
 ;---> Main entry point for BI SITE PARAMETERS EDIT.
"RTN","BISITE",28,0)
 ;---> If BISITE not supplied, set Error Code and quit.
"RTN","BISITE",29,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,,1) Q
"RTN","BISITE",30,0)
 I '$D(^BISITE(BISITE,0)) D ERRCD^BIUTL2(110,,1) Q
"RTN","BISITE",31,0)
 D EN^VALM("BI SITE PARAMETERS EDIT")
"RTN","BISITE",32,0)
 Q
"RTN","BISITE",33,0)
 ;
"RTN","BISITE",34,0)
 ;
"RTN","BISITE",35,0)
 ;----------
"RTN","BISITE",36,0)
HDR ;EP
"RTN","BISITE",37,0)
 ;---> Header code
"RTN","BISITE",38,0)
 N X S X="     Edit Site Parameters for: "
"RTN","BISITE",39,0)
 S X=X_IOINHI_$$INSTTX^BIUTL6(BISITE)_IOINORM
"RTN","BISITE",40,0)
 S VALMHDR(1)=""
"RTN","BISITE",41,0)
 S VALMHDR(2)=X
"RTN","BISITE",42,0)
 ;
"RTN","BISITE",43,0)
 Q
"RTN","BISITE",44,0)
 ;
"RTN","BISITE",45,0)
 ;
"RTN","BISITE",46,0)
 ;----------
"RTN","BISITE",47,0)
INIT ;EP
"RTN","BISITE",48,0)
 ;---> Initialize variables and list array.
"RTN","BISITE",49,0)
 D INIT^BISITE1
"RTN","BISITE",50,0)
 Q
"RTN","BISITE",51,0)
 ;
"RTN","BISITE",52,0)
 ;
"RTN","BISITE",53,0)
 ;----------
"RTN","BISITE",54,0)
RESET ;EP
"RTN","BISITE",55,0)
 ;---> Update partition for return to Listmanager.
"RTN","BISITE",56,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BISITE",57,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BISITE",58,0)
 S VALMSG="Scroll down to view more Parameters."
"RTN","BISITE",59,0)
 D INIT,HDR Q
"RTN","BISITE",60,0)
 ;
"RTN","BISITE",61,0)
 ;
"RTN","BISITE",62,0)
 ;----------
"RTN","BISITE",63,0)
HELP ;EP
"RTN","BISITE",64,0)
 ;---> Help code.
"RTN","BISITE",65,0)
 N BIX S BIX=X
"RTN","BISITE",66,0)
 D FULL^VALM1
"RTN","BISITE",67,0)
 D TITLE^BIUTL5("SITE PARAMETER SCREEN - HELP")
"RTN","BISITE",68,0)
 D TEXT1
"RTN","BISITE",69,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BISITE",70,0)
 S VALMSG="Scroll down to view more Parameters."
"RTN","BISITE",71,0)
 D:BIX'="??" RE^VALM4
"RTN","BISITE",72,0)
 Q
"RTN","BISITE",73,0)
 ;
"RTN","BISITE",74,0)
 ;
"RTN","BISITE",75,0)
 ;----------
"RTN","BISITE",76,0)
TEXT1 ;EP
"RTN","BISITE",77,0)
 ;;This is the screen for editing Site Parameters.
"RTN","BISITE",78,0)
 ;;
"RTN","BISITE",79,0)
 ;;To edit a parameter, enter its left column number.  Helpful
"RTN","BISITE",80,0)
 ;;information is presented with each parameter when it is selected.
"RTN","BISITE",81,0)
 ;;
"RTN","BISITE",82,0)
 ;;The Site that these parameters applies to is displayed at the top
"RTN","BISITE",83,0)
 ;;of the screen.  This Site is determined when you log on to RPMS.
"RTN","BISITE",84,0)
 ;;If you are running more than one Site on the same computer and
"RTN","BISITE",85,0)
 ;;wish to edit parameters for another site, you must log off and
"RTN","BISITE",86,0)
 ;;log back on under the Site you wish to edit.
"RTN","BISITE",87,0)
 ;;
"RTN","BISITE",88,0)
 D PRINTX("TEXT1")
"RTN","BISITE",89,0)
 Q
"RTN","BISITE",90,0)
 ;
"RTN","BISITE",91,0)
 ;
"RTN","BISITE",92,0)
 ;----------
"RTN","BISITE",93,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BISITE",94,0)
 Q:$G(BILINL)=""
"RTN","BISITE",95,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BISITE",96,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BISITE",97,0)
 Q
"RTN","BISITE",98,0)
 ;
"RTN","BISITE",99,0)
 ;
"RTN","BISITE",100,0)
 ;----------
"RTN","BISITE",101,0)
EXIT ;EP
"RTN","BISITE",102,0)
 ;---> EOJ cleanup.
"RTN","BISITE",103,0)
 D KILLALL^BIUTL8(1)
"RTN","BISITE",104,0)
 K ^TMP("BISITE",$J)
"RTN","BISITE",105,0)
 D CLEAR^VALM1
"RTN","BISITE",106,0)
 D FULL^VALM1
"RTN","BISITE",107,0)
 Q
"RTN","BISITE1")
0^2^B47092305
"RTN","BISITE1",1,0)
BISITE1 ;IHS/CMI/MWR - EDIT SITE PARAMETERS; MAY 10, 2010
"RTN","BISITE1",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BISITE1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISITE1",4,0)
 ;;  INIT FOR EDIT SITE PARAMETERS.
"RTN","BISITE1",5,0)
 ;   PATCH 2: Fix display of default Low Supply Alert.  INIT+72
"RTN","BISITE1",6,0)
 ;            Provide call to retrieve Site's Low Alert default.  LOTSDEF
"RTN","BISITE1",7,0)
 ;;  PATCH 8: Changes to accommodate new TCH Forecaster   INIT+55,+66,+92,+132
"RTN","BISITE1",8,0)
 ;;  PATCH 9: Return the IP Address used for the TCH Forecaster.  INIT+139
"RTN","BISITE1",9,0)
 ;;           Update display of selected High Risk parameters.  INIT+165
"RTN","BISITE1",10,0)
 ;
"RTN","BISITE1",11,0)
 ;
"RTN","BISITE1",12,0)
 ;----------
"RTN","BISITE1",13,0)
INIT ;EP
"RTN","BISITE1",14,0)
 ; ZEXCEPT: VALM,VALMCNT,VALMQUIT,VALMSG ; LM vars
"RTN","BISITE1",15,0)
 ; ZEXCEPT: BISITE ; Set before LM Callbacks in BISITE
"RTN","BISITE1",16,0)
 ;---> Initialize variables and list array.
"RTN","BISITE1",17,0)
 ;---> If BISITE not supplied, set Error Code and quit.
"RTN","BISITE1",18,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,,1) S VALMQUIT="" Q
"RTN","BISITE1",19,0)
 I '$D(^BISITE(BISITE,0)) D ERRCD^BIUTL2(110,,1) S VALMQUIT="" Q
"RTN","BISITE1",20,0)
 ;
"RTN","BISITE1",21,0)
 K ^TMP("BISITE",$J)
"RTN","BISITE1",22,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BISITE1",23,0)
 S VALMSG="Select a left column number to change an item."
"RTN","BISITE1",24,0)
 N BILINE,X,Y S BILINE=0
"RTN","BISITE1",25,0)
 ;
"RTN","BISITE1",26,0)
 ;---> Default Case Manager.
"RTN","BISITE1",27,0)
 D WRITE(.BILINE)
"RTN","BISITE1",28,0)
 S X="   1) Default Case Manager.........: "_$$CMGRDEF^BIUTL2(BISITE,1)
"RTN","BISITE1",29,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",30,0)
 K X
"RTN","BISITE1",31,0)
 ;
"RTN","BISITE1",32,0)
 ;---> Other Location.
"RTN","BISITE1",33,0)
 N BIOTH S BIOTH=$$OTHERLOC^BIUTL6(BISITE),X=""
"RTN","BISITE1",34,0)
 I $$RPMS^BIUTL9() D
"RTN","BISITE1",35,0)
 . D:BIOTH
"RTN","BISITE1",36,0)
 .. S X=$P(^AUTTLOC(BIOTH,0),U,4)
"RTN","BISITE1",37,0)
 .. I $G(X) S:$D(^AUTTAREA(X,0)) X=$P(^(0),U)
"RTN","BISITE1",38,0)
 .. S X=$$INSTTX^BIUTL6(BIOTH)_"   "_X
"RTN","BISITE1",39,0)
 E  S X=BIOTH ; Phantom Else for documentation only. $$OTHERLOC^BIUTL6 will return the
"RTN","BISITE1",40,0)
    ; free text location name in field 920000.01
"RTN","BISITE1",41,0)
 S X=$E("   2) Other Location...............: "_X,1,79)
"RTN","BISITE1",42,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",43,0)
 K X
"RTN","BISITE1",44,0)
 ;
"RTN","BISITE1",45,0)
 ;---> Standard Immunizations Due Letter.
"RTN","BISITE1",46,0)
 S X="   3) Standard Imm Due Letter .....: "_$$DEFLET^BIUTL2(BISITE,1)
"RTN","BISITE1",47,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",48,0)
 K X
"RTN","BISITE1",49,0)
 ;
"RTN","BISITE1",50,0)
 ;---> Official Immunization Record.
"RTN","BISITE1",51,0)
 S X="   4) Official Imm Record Letter...: "_$$DEFLET^BIUTL2(BISITE,1,1)
"RTN","BISITE1",52,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",53,0)
 K X
"RTN","BISITE1",54,0)
 ;
"RTN","BISITE1",55,0)
 ;---> Facility Record/Report Header.
"RTN","BISITE1",56,0)
 S X="   5) Facility Report Header.......: "_$$REPHDR^BIUTL6(BISITE)
"RTN","BISITE1",57,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",58,0)
 K X
"RTN","BISITE1",59,0)
 ;
"RTN","BISITE1",60,0)
 ;---> Host File Server Path.
"RTN","BISITE1",61,0)
 S X="   6) Host File Server Path........: "_$$HFSPATH^BIUTL8(BISITE)
"RTN","BISITE1",62,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",63,0)
 K X
"RTN","BISITE1",64,0)
 ;
"RTN","BISITE1",65,0)
 ;---> Minimum Days Last Letter.
"RTN","BISITE1",66,0)
 S X=$$MINDAYS^BIUTL2(BISITE)_" day" S:+X'=1 X=X_"s"
"RTN","BISITE1",67,0)
 S X="   7) Minimum Days Last Letter.....: "_X
"RTN","BISITE1",68,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",69,0)
 K X
"RTN","BISITE1",70,0)
 ;
"RTN","BISITE1",71,0)
 ;---> Forecast Minimum Age vs Recommended Age.
"RTN","BISITE1",72,0)
 S X=$$MINAGE^BIUTL2(BISITE)
"RTN","BISITE1",73,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE1",74,0)
 ;---> Change parameter prompt to just Min vs Rec.
"RTN","BISITE1",75,0)
 S X=$S(X=1:"Minimum Acceptable Age",1:"Recommended Age")
"RTN","BISITE1",76,0)
 ;**********
"RTN","BISITE1",77,0)
 S X="   8) Minimum vs Recommended Age...: "_X
"RTN","BISITE1",78,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",79,0)
 K X
"RTN","BISITE1",80,0)
 ;
"RTN","BISITE1",81,0)
 ;---> ImmServe Forecasting Option.
"RTN","BISITE1",82,0)
 D
"RTN","BISITE1",83,0)
 .N G,H,Y,Z S Z=$G(^BISITE(BISITE,0))
"RTN","BISITE1",84,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE1",85,0)
 .;---> Change parameter prompt to just Grace Period.
"RTN","BISITE1",86,0)
 .;S Y=$P(Z,U,8),G=$P(Z,U,21),H=$P(Z,U,24)
"RTN","BISITE1",87,0)
 .;S X="#"_Y_", "_$S(G:"WITH",1:"NO")_" 4-Day Grace"
"RTN","BISITE1",88,0)
 .;S X=X_", HPV through "_$S(H=2:26,1:18)
"RTN","BISITE1",89,0)
 .S Y=$P($G(^BISITE(BISITE,0)),U,21)
"RTN","BISITE1",90,0)
 .S X="4-Day Grace Period "_$S(Y=1:"",1:"NOT ")_"Used"
"RTN","BISITE1",91,0)
 S X="   9) 4-Day Grace Period option....: "_X
"RTN","BISITE1",92,0)
 ;**********
"RTN","BISITE1",93,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",94,0)
 K X
"RTN","BISITE1",95,0)
 ;
"RTN","BISITE1",96,0)
 ;---> Lot Numbers required.
"RTN","BISITE1",97,0)
 S X=$S($$LOTREQ^BIUTL2(BISITE):"Required",1:"NOT Required")
"RTN","BISITE1",98,0)
 ;
"RTN","BISITE1",99,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BISITE1",100,0)
 ;---> Fix display of default Low Supply Alert.
"RTN","BISITE1",101,0)
 ;S X=X_", Default Low Supply Alert="_$$LOTLOW^BIUTL2(BISITE)
"RTN","BISITE1",102,0)
 S X=X_", Default Low Supply Alert="_$$LOTSDEF(BISITE)
"RTN","BISITE1",103,0)
 ;**********
"RTN","BISITE1",104,0)
 ;
"RTN","BISITE1",105,0)
 S X="  10) Lot Number Options...........: "_X
"RTN","BISITE1",106,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",107,0)
 K X
"RTN","BISITE1",108,0)
 ;
"RTN","BISITE1",109,0)
 ;---> Pneumo, Flu, Zostervax Site Parameters. v8.5
"RTN","BISITE1",110,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE1",111,0)
 ;---> Change parameter prompt to just Pneumo.
"RTN","BISITE1",112,0)
 D
"RTN","BISITE1",113,0)
 .N Y,Z
"RTN","BISITE1",114,0)
 .S Y=$$PNMAGE^BIPATUP2(BISITE)
"RTN","BISITE1",115,0)
 .;S Y=$P(X,U),Z=$P(X,U,2)
"RTN","BISITE1",116,0)
 .;S X=Y_" years old, "_$S(Z:"every 6 years.",1:"one time only.")
"RTN","BISITE1",117,0)
 .S X="Begin Pneumo at "_Y_" years"
"RTN","BISITE1",118,0)
 .;S Y=$$FLUALL^BIPATUP2(BISITE)
"RTN","BISITE1",119,0)
 .;S X=X_$S(Y:"All ages",1:"6m-18y,50y+")
"RTN","BISITE1",120,0)
 .;S X=X_"  Zoster: "
"RTN","BISITE1",121,0)
 .;S Y=$$ZOSTER^BIPATUP2(BISITE)
"RTN","BISITE1",122,0)
 .;S X=X_$S(Y:"Yes",1:"No")
"RTN","BISITE1",123,0)
 ;S X="  11) Pneumo, Flu, Zoster Options..: "_X
"RTN","BISITE1",124,0)
 S X="  11) Pneumo routine age to begin..: "_X
"RTN","BISITE1",125,0)
 ;**********
"RTN","BISITE1",126,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",127,0)
 K X
"RTN","BISITE1",128,0)
 ;
"RTN","BISITE1",129,0)
 ;---> Forecasting enabled.
"RTN","BISITE1",130,0)
 S X=$S($$FORECAS^BIUTL2(BISITE):"Enabled",1:"Disabled")
"RTN","BISITE1",131,0)
 S X="  12) Forecasting (Imms Due).......: "_X
"RTN","BISITE1",132,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",133,0)
 K X
"RTN","BISITE1",134,0)
 ;
"RTN","BISITE1",135,0)
 ;---> Include dashes in Chart# display.
"RTN","BISITE1",136,0)
 D
"RTN","BISITE1",137,0)
 .I $$DASH^BIUTL1(BISITE) S X="Dashes Included (12-34-56)" Q
"RTN","BISITE1",138,0)
 .S X="No Dashes (123456)"
"RTN","BISITE1",139,0)
 S X="  13) Chart# with dashes...........: "_X
"RTN","BISITE1",140,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",141,0)
 K X
"RTN","BISITE1",142,0)
 ;
"RTN","BISITE1",143,0)
 ;---> User as Default Provider.
"RTN","BISITE1",144,0)
 S X=$S($$DEFPROV^BIUTL6(BISITE):"Yes",1:"No")
"RTN","BISITE1",145,0)
 S X="  14) User as Default Provider.....: "_X
"RTN","BISITE1",146,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",147,0)
 K X
"RTN","BISITE1",148,0)
 ;
"RTN","BISITE1",149,0)
 ;---> ImmServe Directory.
"RTN","BISITE1",150,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE1",151,0)
 ;---> Leave parameter place keeper on menu, but disable.
"RTN","BISITE1",152,0)
 ;S X=$$IMMSVDIR^BIUTL8(BISITE)
"RTN","BISITE1",153,0)
 ;S:($L(X)>39) X=$E(X,1,39)_"..."
"RTN","BISITE1",154,0)
 ;S X="  15) ImmServe Directory...........: "_X
"RTN","BISITE1",155,0)
 ;**********
"RTN","BISITE1",156,0)
 ;
"RTN","BISITE1",157,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BISITE1",158,0)
 ;---> IP Address for TCH Forecaster.
"RTN","BISITE1",159,0)
 S X=$$IPTCH^BIUTL8(BISITE)
"RTN","BISITE1",160,0)
 S X="  15) IP Address for TCH Forecaster: "_X
"RTN","BISITE1",161,0)
 ;**********
"RTN","BISITE1",162,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",163,0)
 K X
"RTN","BISITE1",164,0)
 ;
"RTN","BISITE1",165,0)
 ;---> GPRA Communities.
"RTN","BISITE1",166,0)
 I $$RPMS^BIUTL9() D  ; RPMS - original logic
"RTN","BISITE1",167,0)
 .N BIGPRA D GETGPRA^BISITE4(.BIGPRA,BISITE)
"RTN","BISITE1",168,0)
 .I '$O(BIGPRA(0)) S X="No"
"RTN","BISITE1",169,0)
 .E  N N S (N,X)=0 F  S N=$O(BIGPRA(N)) Q:'N  S X=X+1
"RTN","BISITE1",170,0)
 .S X=X_" Communities selected for GPRA."
"RTN","BISITE1",171,0)
 .S X="  16) GPRA Communities.............: "_X
"RTN","BISITE1",172,0)
 .D WRITE(.BILINE,X)
"RTN","BISITE1",173,0)
 .K X
"RTN","BISITE1",174,0)
 ;
"RTN","BISITE1",175,0)
 ELSE  DO  ; VISTA
"RTN","BISITE1",176,0)
 .N COMMS D GETCOMMS^BISITE4(.COMMS,BISITE)
"RTN","BISITE1",177,0)
 .I '$O(COMMS(0)) S X="No"
"RTN","BISITE1",178,0)
 .E  N N S (N,X)=0 F  S N=$O(COMMS(N)) Q:'N  S X=X+1
"RTN","BISITE1",179,0)
 .S X=X_" communities selected."
"RTN","BISITE1",180,0)
 .S X="  16) Communities for Statistics...: "_X
"RTN","BISITE1",181,0)
 .D WRITE(.BILINE,X)
"RTN","BISITE1",182,0)
 .K X
"RTN","BISITE1",183,0)
 ;
"RTN","BISITE1",184,0)
 ;---> Inpatient Check enabled.
"RTN","BISITE1",185,0)
 S X=$S($$INPTCHK^BIUTL2(BISITE):"Enabled",1:"Disabled")
"RTN","BISITE1",186,0)
 S X="  17) Inpatient Visit Check........: "_X
"RTN","BISITE1",187,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",188,0)
 K X
"RTN","BISITE1",189,0)
 ;
"RTN","BISITE1",190,0)
 ;
"RTN","BISITE1",191,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BISITE1",192,0)
 ;---> Update display of selected High Risk parameters.
"RTN","BISITE1",193,0)
 ;---> Risk Check enabled.
"RTN","BISITE1",194,0)
 N Z S Z=$$RISKP^BIUTL2(BISITE)
"RTN","BISITE1",195,0)
 D
"RTN","BISITE1",196,0)
 .I 'Z S X="Disabled" Q
"RTN","BISITE1",197,0)
 .I Z=1 S X="Enabled: Hep B Only" Q
"RTN","BISITE1",198,0)
 .I Z=2 S X="Enabled: Pneumo Only" Q
"RTN","BISITE1",199,0)
 .I Z=12 S X="Enabled: Hep B and Pneumo" Q
"RTN","BISITE1",200,0)
 .I Z=23 S X="Enabled: Pneumo Only (+Smoking)" Q
"RTN","BISITE1",201,0)
 .I Z=123 S X="Enabled: Hep B and Pneumo (+Smoking)" Q
"RTN","BISITE1",202,0)
 .S X="ERROR: Unable to determine."
"RTN","BISITE1",203,0)
 ;**********
"RTN","BISITE1",204,0)
 ;
"RTN","BISITE1",205,0)
 S X="  18) High Risk Factor Check.......: "_X
"RTN","BISITE1",206,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",207,0)
 K X,Z
"RTN","BISITE1",208,0)
 ;
"RTN","BISITE1",209,0)
 ;---> CPT-coded Visits enabled.
"RTN","BISITE1",210,0)
 S X=$S($$IMPCPT^BIUTL2(BISITE):"Enabled",1:"Disabled")
"RTN","BISITE1",211,0)
 S X="  19) Import CPT-coded Visits......: "_X
"RTN","BISITE1",212,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",213,0)
 K X
"RTN","BISITE1",214,0)
 ;
"RTN","BISITE1",215,0)
 ;---> Visit Selection Menu enabled.
"RTN","BISITE1",216,0)
 D
"RTN","BISITE1",217,0)
 .I $$VISMNU^BIUTL2(BISITE) S X="Enabled (Display Visit Selection Menu)" Q
"RTN","BISITE1",218,0)
 .S X="Disabled (Link Visits automatically)"
"RTN","BISITE1",219,0)
 S X="  20) Visit Selection Menu.........: "_X
"RTN","BISITE1",220,0)
 D WRITE(.BILINE,X)
"RTN","BISITE1",221,0)
 K X
"RTN","BISITE1",222,0)
 ;
"RTN","BISITE1",223,0)
 S VALMSG="Scroll down to view more Parameters."
"RTN","BISITE1",224,0)
 S VALMCNT=BILINE
"RTN","BISITE1",225,0)
 Q
"RTN","BISITE1",226,0)
 ;
"RTN","BISITE1",227,0)
 ;
"RTN","BISITE1",228,0)
 ;----------
"RTN","BISITE1",229,0)
WRITE(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BISITE1",230,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BISITE1",231,0)
 ;---> Parameters:
"RTN","BISITE1",232,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BISITE1",233,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BISITE1",234,0)
 ;
"RTN","BISITE1",235,0)
 Q:'$D(BILINE)
"RTN","BISITE1",236,0)
 D WL^BIW(.BILINE,"BISITE",$G(BIVAL),$G(BIBLNK))
"RTN","BISITE1",237,0)
 Q
"RTN","BISITE1",238,0)
 ;
"RTN","BISITE1",239,0)
 ;
"RTN","BISITE1",240,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BISITE1",241,0)
 ;----------
"RTN","BISITE1",242,0)
LOTSDEF(BIDUZ2) ;EP
"RTN","BISITE1",243,0)
 ;---> Return Site's Default Low Alert for Lot Numbers.
"RTN","BISITE1",244,0)
 ;---> Parameters:
"RTN","BISITE1",245,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BISITE1",246,0)
 ;
"RTN","BISITE1",247,0)
 Q:'$D(^BISITE(+$G(BIDUZ2),0)) 50
"RTN","BISITE1",248,0)
 Q:($P($G(^BISITE(+$G(BIDUZ2),0)),U,25)="") 50
"RTN","BISITE1",249,0)
 Q $P($G(^BISITE(+$G(BIDUZ2),0)),U,25)
"RTN","BISITE1",250,0)
 ;**********
"RTN","BISITE2")
0^3^B171005337
"RTN","BISITE2",1,0)
BISITE2 ;IHS/CMI/MWR - EDIT SITE PARAMETERS; MAY 10, 2010
"RTN","BISITE2",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BISITE2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISITE2",4,0)
 ;;  EDIT SITE PARAMETERS.
"RTN","BISITE2",5,0)
 ;;  PATCH 1: Update text to relect DTap change in Option 1,
"RTN","BISITE2",6,0)
 ;;           and allow for Option 11.  RULES+9 and TEXT-4.
"RTN","BISITE2",7,0)
 ;;  PATCH 2: Update prompts and help text for HPV.  RULES+41, TEXT9+15
"RTN","BISITE2",8,0)
 ;;  PATCH 5: Update help text for HPV.  TEXT8+8
"RTN","BISITE2",9,0)
 ;;  PATCH 8: Changes to accommodate new TCH Forecaster   MINAGE+12, RULES+6
"RTN","BISITE2",10,0)
 ;
"RTN","BISITE2",11,0)
 ;
"RTN","BISITE2",12,0)
 ;----------
"RTN","BISITE2",13,0)
CMGR ;EP
"RTN","BISITE2",14,0)
 ;---> Select Default Case Manager.
"RTN","BISITE2",15,0)
 ;---> Called by Protocol BI SITE CASE MANAGER.
"RTN","BISITE2",16,0)
 ;#
"RTN","BISITE2",17,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",18,0)
 Q:$$BISITE
"RTN","BISITE2",19,0)
 D FULL^VALM1,TITLE^BIUTL5("DEFAULT CASE MANAGER"),TEXT1
"RTN","BISITE2",20,0)
 D DIE^BIFMAN(9002084.02,".02",BISITE)
"RTN","BISITE2",21,0)
 D RESET^BISITE
"RTN","BISITE2",22,0)
 Q
"RTN","BISITE2",23,0)
 ;
"RTN","BISITE2",24,0)
 ;
"RTN","BISITE2",25,0)
 ;----------
"RTN","BISITE2",26,0)
TEXT1 ;EP
"RTN","BISITE2",27,0)
 ;;The Default Case Manager is the Case Manager who will be
"RTN","BISITE2",28,0)
 ;;presented automatically at all Case Manager prompts, such as
"RTN","BISITE2",29,0)
 ;;when you are adding a new patient.
"RTN","BISITE2",30,0)
 ;;
"RTN","BISITE2",31,0)
 ;;
"RTN","BISITE2",32,0)
 D PRINTX("TEXT1")
"RTN","BISITE2",33,0)
 Q
"RTN","BISITE2",34,0)
 ;
"RTN","BISITE2",35,0)
 ;
"RTN","BISITE2",36,0)
 ;----------
"RTN","BISITE2",37,0)
OTHER ;EP
"RTN","BISITE2",38,0)
 ;---> Select Other Location.
"RTN","BISITE2",39,0)
 ;---> Called by Protocol BI SITE OTHER LOCATION.
"RTN","BISITE2",40,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",41,0)
 ;
"RTN","BISITE2",42,0)
 Q:$$BISITE
"RTN","BISITE2",43,0)
 D FULL^VALM1,TITLE^BIUTL5("OTHER LOCATION")
"RTN","BISITE2",44,0)
 I $$RPMS^BIUTL9() D TEXT2RPM,DIE^BIFMAN(9002084.02,".03",BISITE)
"RTN","BISITE2",45,0)
 E  D TEXT2VIS,DIE^BIFMAN(9002084.02,"920000.01",BISITE)
"RTN","BISITE2",46,0)
 D RESET^BISITE
"RTN","BISITE2",47,0)
 Q
"RTN","BISITE2",48,0)
 ;
"RTN","BISITE2",49,0)
 ;
"RTN","BISITE2",50,0)
 ;----------
"RTN","BISITE2",51,0)
TEXT2RPM ;EP
"RTN","BISITE2",52,0)
 ;;The Other Location is an entry in the IHS LOCATION file
"RTN","BISITE2",53,0)
 ;;that will serve as the Location for a PCC Visit when the
"RTN","BISITE2",54,0)
 ;;actual location is not in the LOCATION File.
"RTN","BISITE2",55,0)
 ;;
"RTN","BISITE2",56,0)
 ;;
"RTN","BISITE2",57,0)
 D PRINTX("TEXT2RPM")
"RTN","BISITE2",58,0)
 Q
"RTN","BISITE2",59,0)
 ;
"RTN","BISITE2",60,0)
 ;
"RTN","BISITE2",61,0)
 ;----------
"RTN","BISITE2",62,0)
TEXT2VIS ;EP
"RTN","BISITE2",63,0)
 ;;The Other Location is a free text field that will be used
"RTN","BISITE2",64,0)
 ;;as the default other location when entering an external
"RTN","BISITE2",65,0)
 ;;immunization
"RTN","BISITE2",66,0)
 ;;
"RTN","BISITE2",67,0)
 ;;
"RTN","BISITE2",68,0)
 D PRINTX("TEXT2VIS")
"RTN","BISITE2",69,0)
 Q
"RTN","BISITE2",70,0)
 ;----------
"RTN","BISITE2",71,0)
DUELET ;EP
"RTN","BISITE2",72,0)
 ;---> Select Immunizations Due Letter.
"RTN","BISITE2",73,0)
 ;---> Called by Protocol BI SITE DUE LETTER.
"RTN","BISITE2",74,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",75,0)
 ;
"RTN","BISITE2",76,0)
 Q:$$BISITE
"RTN","BISITE2",77,0)
 D FULL^VALM1,TITLE^BIUTL5("IMMUNIZATIONS DUE LETTER"),TEXT3
"RTN","BISITE2",78,0)
 D DIE^BIFMAN(9002084.02,".04",BISITE)
"RTN","BISITE2",79,0)
 D RESET^BISITE
"RTN","BISITE2",80,0)
 Q
"RTN","BISITE2",81,0)
 ;
"RTN","BISITE2",82,0)
 ;
"RTN","BISITE2",83,0)
 ;----------
"RTN","BISITE2",84,0)
TEXT3 ;EP
"RTN","BISITE2",85,0)
 ;;The Immunizations Due Letter is the form letter that is sent to
"RTN","BISITE2",86,0)
 ;;patients or their parents, listing their Immunization History and
"RTN","BISITE2",87,0)
 ;;informing them of which immunizations are due next.  It may also
"RTN","BISITE2",88,0)
 ;;contain information about where and when to receive the next
"RTN","BISITE2",89,0)
 ;;immunizations.
"RTN","BISITE2",90,0)
 ;;
"RTN","BISITE2",91,0)
 ;;The letter selected here will be presented as the default letter
"RTN","BISITE2",92,0)
 ;;to use when printing Due Letters.
"RTN","BISITE2",93,0)
 ;;
"RTN","BISITE2",94,0)
 ;;In order to select the letter for this Site Parameter, it must
"RTN","BISITE2",95,0)
 ;;already have been created.  To create the Standard Due Letter,
"RTN","BISITE2",96,0)
 ;;select LET under the Manager Menu (MGR-->LET).  Create a new letter
"RTN","BISITE2",97,0)
 ;;named "Standard Due Letter," and then return to this site parameter
"RTN","BISITE2",98,0)
 ;;to choose it.
"RTN","BISITE2",99,0)
 ;;
"RTN","BISITE2",100,0)
 D PRINTX("TEXT3")
"RTN","BISITE2",101,0)
 Q
"RTN","BISITE2",102,0)
 ;
"RTN","BISITE2",103,0)
 ;
"RTN","BISITE2",104,0)
 ;----------
"RTN","BISITE2",105,0)
REPHDR ;EP
"RTN","BISITE2",106,0)
 ;---> Edit Report Header.
"RTN","BISITE2",107,0)
 ;---> Called by Protocol BI SITE REPORT HEADER
"RTN","BISITE2",108,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",109,0)
 ;
"RTN","BISITE2",110,0)
 Q:$$BISITE
"RTN","BISITE2",111,0)
 D FULL^VALM1,TITLE^BIUTL5("REPORT & SCREEN HEADER"),TEXT4
"RTN","BISITE2",112,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE2",113,0)
 S DIR(0)="FOA",DIR("A")="     Enter the Report/Screen Header: "
"RTN","BISITE2",114,0)
 S DIR("B")=$$REPHDR^BIUTL6(BISITE)
"RTN","BISITE2",115,0)
 S DIR("?")="     Enter the site name as you would like it to appear"
"RTN","BISITE2",116,0)
 D ^DIR
"RTN","BISITE2",117,0)
 S:Y="" Y="@"
"RTN","BISITE2",118,0)
 ;
"RTN","BISITE2",119,0)
 ;---> CodeChange for v7.1 - IHS/CMI/MWR 12/01/2000:
"RTN","BISITE2",120,0)
 ;---> Next line missing negation.
"RTN","BISITE2",121,0)
 ;D:$D(DUOUT) DIE^BIFMAN(9002084.02,".06///"_Y,BISITE)
"RTN","BISITE2",122,0)
 D:'$D(DUOUT) DIE^BIFMAN(9002084.02,".06///"_Y,BISITE)
"RTN","BISITE2",123,0)
 ;
"RTN","BISITE2",124,0)
 D RESET^BISITE
"RTN","BISITE2",125,0)
 Q
"RTN","BISITE2",126,0)
 ;
"RTN","BISITE2",127,0)
 ;
"RTN","BISITE2",128,0)
 ;----------
"RTN","BISITE2",129,0)
TEXT4 ;EP
"RTN","BISITE2",130,0)
 ;;The Report/Screen Header is the name of your site or institution
"RTN","BISITE2",131,0)
 ;;as you would like it to appear at the top of various reports and
"RTN","BISITE2",132,0)
 ;;screens throughout this software.
"RTN","BISITE2",133,0)
 ;;
"RTN","BISITE2",134,0)
 ;;(This may be the same as the Site Name that appears on some
"RTN","BISITE2",135,0)
 ;;of screens, however, that name is often an abbreviated
"RTN","BISITE2",136,0)
 ;;form of the actual site name.)
"RTN","BISITE2",137,0)
 ;;
"RTN","BISITE2",138,0)
 ;;Please enter the name of your facility as you would like it
"RTN","BISITE2",139,0)
 ;;to appear at the top of reports and screens in this software.
"RTN","BISITE2",140,0)
 ;;
"RTN","BISITE2",141,0)
 D PRINTX("TEXT4")
"RTN","BISITE2",142,0)
 Q
"RTN","BISITE2",143,0)
 ;
"RTN","BISITE2",144,0)
 ;
"RTN","BISITE2",145,0)
 ;----------
"RTN","BISITE2",146,0)
HFSPATH ;EP
"RTN","BISITE2",147,0)
 ;---> Edit Host File Server path.
"RTN","BISITE2",148,0)
 ;---> Called by Protocol BI SITE HFS PATH
"RTN","BISITE2",149,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",150,0)
 ;
"RTN","BISITE2",151,0)
 Q:$$BISITE  N BIPOP S BIPOP=0
"RTN","BISITE2",152,0)
 F  D  Q:$G(BIPOP)
"RTN","BISITE2",153,0)
 .D FULL^VALM1,TITLE^BIUTL5("HOST FILE SERVER PATH"),TEXT5
"RTN","BISITE2",154,0)
 .N BIFLD,BIERR,BIDFLT,BIZ,DIR,DIRUT,X,Y S BIZ=0
"RTN","BISITE2",155,0)
 .;
"RTN","BISITE2",156,0)
 .S DIR(0)="FOA^1:30",DIR("A")="     Please enter the Host File Path: "
"RTN","BISITE2",157,0)
 .S DIR("B")=$$HFSPATH^BIUTL8(BISITE)
"RTN","BISITE2",158,0)
 .S DIR("?")="     Enter the full path name of the Host File directory"
"RTN","BISITE2",159,0)
 .D ^DIR
"RTN","BISITE2",160,0)
 .I $D(DIRUT) S BIPOP=1 Q
"RTN","BISITE2",161,0)
 .D:Y'="@" CHKSLASH(.Y,.BIZ,.BIPOP)
"RTN","BISITE2",162,0)
 .Q:(BIZ=1!($G(BIPOP)))
"RTN","BISITE2",163,0)
 .;D DIE^BIFMAN(9002084.02,".14////"_Y,BISITE) S BIPOP=1
"RTN","BISITE2",164,0)
 .S BIFLD(.14)=Y D FDIE^BIFMAN(9002084.02,+BISITE,.BIFLD,.BIERR) S BIPOP=1
"RTN","BISITE2",165,0)
 ;
"RTN","BISITE2",166,0)
 D RESET^BISITE
"RTN","BISITE2",167,0)
 Q
"RTN","BISITE2",168,0)
 ;
"RTN","BISITE2",169,0)
 ;
"RTN","BISITE2",170,0)
 ;----------
"RTN","BISITE2",171,0)
CHKSLASH(Y,Z,BIPOP) ;EP
"RTN","BISITE2",172,0)
 ;---> Make sure there is a final slash in the path name.
"RTN","BISITE2",173,0)
 ;---> Parameters:
"RTN","BISITE2",174,0)
 ;     1 - Y  (req) File Path submitted for verification.
"RTN","BISITE2",175,0)
 ;     2 - Z  (ret) Z=1 if path contains both "/" and "\" or other error.
"RTN","BISITE2",176,0)
 ;     3 - BIPOP (ret) =1 if user ^-out.
"RTN","BISITE2",177,0)
 ;
"RTN","BISITE2",178,0)
 I Y["/"&(Y["\") D  S Z=1 Q
"RTN","BISITE2",179,0)
 .W !!?5,"Path may not contain both ""/"" and ""\""."
"RTN","BISITE2",180,0)
 .D DIRZ^BIUTL3()
"RTN","BISITE2",181,0)
 ;---> Get rid of any quotes.
"RTN","BISITE2",182,0)
 S Y=$TR(Y,"""","")
"RTN","BISITE2",183,0)
 ;
"RTN","BISITE2",184,0)
 D
"RTN","BISITE2",185,0)
 .N X S X=$$VERSION^%ZOSV(1)
"RTN","BISITE2",186,0)
 .;
"RTN","BISITE2",187,0)
 .;---> Ensure Windows path contains drive & root path.
"RTN","BISITE2",188,0)
 .I (X["Windows")&(Y'[":\") D  S Z=1  Q
"RTN","BISITE2",189,0)
 ..W !!?5,"Path must contain a drive specification (e.g., C:\path...)."
"RTN","BISITE2",190,0)
 ..D DIRZ^BIUTL3(.BIPOP)
"RTN","BISITE2",191,0)
 .;
"RTN","BISITE2",192,0)
 .;---> Ensure path terminates with appropriate slash.
"RTN","BISITE2",193,0)
 .I (X["Windows")!(Y["\") D  Q
"RTN","BISITE2",194,0)
 ..I $E(Y,$L(Y))'="\" S Y=Y_"\" Q
"RTN","BISITE2",195,0)
 .;
"RTN","BISITE2",196,0)
 .I (X["Linux")!(X["UNIX")!(Y["/") D  Q
"RTN","BISITE2",197,0)
 ..I $E(Y,$L(Y))'="/" S Y=Y_"/" Q
"RTN","BISITE2",198,0)
 Q
"RTN","BISITE2",199,0)
 ;
"RTN","BISITE2",200,0)
 ;
"RTN","BISITE2",201,0)
 ;----------
"RTN","BISITE2",202,0)
TEXT5 ;EP
"RTN","BISITE2",203,0)
 ;;The Host File Server Path is the directory on the Host File Server
"RTN","BISITE2",204,0)
 ;;where files to be imported and exported are stored.
"RTN","BISITE2",205,0)
 ;;
"RTN","BISITE2",206,0)
 ;;Include ALL necessary slashes in the path name (everything except
"RTN","BISITE2",207,0)
 ;;the filename itself).
"RTN","BISITE2",208,0)
 ;;
"RTN","BISITE2",209,0)
 ;;Examples would be: C:\TEMP\ (on a Windows PC)
"RTN","BISITE2",210,0)
 ;;               or  /usr/local/ (in unix/AIX)
"RTN","BISITE2",211,0)
 ;;
"RTN","BISITE2",212,0)
 ;;
"RTN","BISITE2",213,0)
 D PRINTX("TEXT5")
"RTN","BISITE2",214,0)
 Q
"RTN","BISITE2",215,0)
 ;
"RTN","BISITE2",216,0)
 ;
"RTN","BISITE2",217,0)
 ;----------
"RTN","BISITE2",218,0)
MINDAYS ;EP
"RTN","BISITE2",219,0)
 ;---> Edit the default Minimum Number of days since last letter sent.
"RTN","BISITE2",220,0)
 ;---> Called by Protocol BI SITE MIN DAYS LAST LET.
"RTN","BISITE2",221,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",222,0)
 ;
"RTN","BISITE2",223,0)
 Q:$$BISITE
"RTN","BISITE2",224,0)
 D FULL^VALM1,TITLE^BIUTL5("EDIT MINIMUM DAYS LAST LETTER"),TEXT6
"RTN","BISITE2",225,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE2",226,0)
 S DIR(0)="NOA^0:9999:0"
"RTN","BISITE2",227,0)
 S DIR("A")="     Number of days: "
"RTN","BISITE2",228,0)
 S DIR("B")=$$MINDAYS^BIUTL2(BISITE)
"RTN","BISITE2",229,0)
 D ^DIR
"RTN","BISITE2",230,0)
 D:'$D(DUOUT) DIE^BIFMAN(9002084.02,".05///"_+Y,BISITE)
"RTN","BISITE2",231,0)
 D RESET^BISITE
"RTN","BISITE2",232,0)
 Q
"RTN","BISITE2",233,0)
 ;
"RTN","BISITE2",234,0)
 ;
"RTN","BISITE2",235,0)
 ;----------
"RTN","BISITE2",236,0)
TEXT6 ;EP
"RTN","BISITE2",237,0)
 ;;The Minimum Days Last Letter is the least number of days that must
"RTN","BISITE2",238,0)
 ;;pass--after a letter is sent to a patient--before the software
"RTN","BISITE2",239,0)
 ;;will automatically send another letter to that same patient.
"RTN","BISITE2",240,0)
 ;;(This pertains only to the printing of letters.)
"RTN","BISITE2",241,0)
 ;;
"RTN","BISITE2",242,0)
 ;;For example, if a patient received a letter 2 weeks ago and
"RTN","BISITE2",243,0)
 ;;the Minimum Days Last Letter is 60, then the software will not
"RTN","BISITE2",244,0)
 ;;generate a letter for that patient today, even if the patient
"RTN","BISITE2",245,0)
 ;;is due for immunizations.
"RTN","BISITE2",246,0)
 ;;
"RTN","BISITE2",247,0)
 ;;This Site Parameter sets only the DEFAULT Minimum Days Last Letter--
"RTN","BISITE2",248,0)
 ;;the Case Manager always has the option to change it when printing
"RTN","BISITE2",249,0)
 ;;Due Letters.
"RTN","BISITE2",250,0)
 ;;
"RTN","BISITE2",251,0)
 ;;Please enter the default Minimum number Days since Last Letter.
"RTN","BISITE2",252,0)
 ;;
"RTN","BISITE2",253,0)
 D PRINTX("TEXT6")
"RTN","BISITE2",254,0)
 Q
"RTN","BISITE2",255,0)
 ;
"RTN","BISITE2",256,0)
 ;
"RTN","BISITE2",257,0)
 ;----------
"RTN","BISITE2",258,0)
MINAGE ;EP
"RTN","BISITE2",259,0)
 ;---> Edit the parameter directing the ImmServe Forecast to return
"RTN","BISITE2",260,0)
 ;---> Immunization Due dates for either the Minimum Acceptable Age
"RTN","BISITE2",261,0)
 ;---> or the Recommended Age.
"RTN","BISITE2",262,0)
 ;---> Called by Protocol BI SITE FORC MIN VS RECOMM
"RTN","BISITE2",263,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",264,0)
 ;
"RTN","BISITE2",265,0)
 Q:$$BISITE
"RTN","BISITE2",266,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT MINIMUM VS RECOMMENDED AGE"),TEXT7
"RTN","BISITE2",267,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE2",268,0)
 S DIR(0)="SOA^M:Minimum;R:Recommended"
"RTN","BISITE2",269,0)
 S DIR("A")="     Please select either MINIMUM or RECOMMENDED: "
"RTN","BISITE2",270,0)
 ;
"RTN","BISITE2",271,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE2",272,0)
 ;---> Change parameter prompt to default recommended.
"RTN","BISITE2",273,0)
 S DIR("B")=$S($$MINAGE^BIUTL2(BISITE)=1:"Minimum",1:"Recommended")
"RTN","BISITE2",274,0)
 ;**********
"RTN","BISITE2",275,0)
 D ^DIR
"RTN","BISITE2",276,0)
 S:Y="M" Y="A"
"RTN","BISITE2",277,0)
 D:'$D(DIRUT) DIE^BIFMAN(9002084.02,".07///"_Y,BISITE)
"RTN","BISITE2",278,0)
 D RESET^BISITE
"RTN","BISITE2",279,0)
 Q
"RTN","BISITE2",280,0)
 ;
"RTN","BISITE2",281,0)
 ;
"RTN","BISITE2",282,0)
 ;----------
"RTN","BISITE2",283,0)
TEXT7 ;EP
"RTN","BISITE2",284,0)
 ;;
"RTN","BISITE2",285,0)
 ;;The Minimum vs Recommended Age parameter allows you to direct the
"RTN","BISITE2",286,0)
 ;;Forecasting program to forecast Immunizations due at either the
"RTN","BISITE2",287,0)
 ;;Minimum Acceptable Patient Age or at the Recommended Age.
"RTN","BISITE2",288,0)
 ;;
"RTN","BISITE2",289,0)
 D PRINTX("TEXT7")
"RTN","BISITE2",290,0)
 Q
"RTN","BISITE2",291,0)
 ;
"RTN","BISITE2",292,0)
 ;
"RTN","BISITE2",293,0)
 ;----------
"RTN","BISITE2",294,0)
RULES ;EP
"RTN","BISITE2",295,0)
 ;---> Edit the parameter directing which version of Forecasting
"RTN","BISITE2",296,0)
 ;---> Rules should be used by ImmServe.
"RTN","BISITE2",297,0)
 ;---> Called by Protocol BI SITE FORC RULES
"RTN","BISITE2",298,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",299,0)
 ;
"RTN","BISITE2",300,0)
 Q:$$BISITE
"RTN","BISITE2",301,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE2",302,0)
 ;---> Change parameter prompt to just Grace Period.
"RTN","BISITE2",303,0)
 ;D FULL^VALM1,TITLE^BIUTL5("SELECT FORECASTING OPTIONS",1),TEXT8
"RTN","BISITE2",304,0)
 N BIDFLT,BIPOP,DIR,DIRUT,X,Y
"RTN","BISITE2",305,0)
 ;
"RTN","BISITE2",306,0)
 ;---> For a new set of Immserve Rules, change here below and $$VALIDRUL^BIUTL2.
"RTN","BISITE2",307,0)
 ;S DIR(0)="NOA^1,2,3,4,5,6,7,11"
"RTN","BISITE2",308,0)
 ;S DIR("?")="     Enter a number from the left column to choose one of the Options."
"RTN","BISITE2",309,0)
 ;S DIR("A")="     Select Forecasting Option: "
"RTN","BISITE2",310,0)
 ;S Y=$P($G(^BISITE(BISITE,0)),U,8)
"RTN","BISITE2",311,0)
 ;S:'Y Y=1 S DIR("B")=+Y
"RTN","BISITE2",312,0)
 ;D ^DIR
"RTN","BISITE2",313,0)
 ;---> For a new set of Immserve Rules, change here below and $$VALIDRUL^BIUTL2.
"RTN","BISITE2",314,0)
 ;I (Y>7)&(Y<11) D  G RULES
"RTN","BISITE2",315,0)
 ;.W !!?8,Y," is not a valid Option.  Please choose again."
"RTN","BISITE2",316,0)
 ;.D DIRZ^BIUTL3(.BIPOP)
"RTN","BISITE2",317,0)
 ;
"RTN","BISITE2",318,0)
 ;D:'$D(DIRUT) DIE^BIFMAN(9002084.02,".08///"_+Y,BISITE,.BIPOP)
"RTN","BISITE2",319,0)
 ;I $G(DIRUT) D RESET^BISITE Q
"RTN","BISITE2",320,0)
 ;
"RTN","BISITE2",321,0)
 ;---> Grace Period question.
"RTN","BISITE2",322,0)
 ;D TITLE^BIUTL5("SELECT FORECASTING RULES"),TEXT9
"RTN","BISITE2",323,0)
 D FULL^VALM1,TITLE^BIUTL5("4-DAY GRACE PERIOD OPTION",1),TEXT9
"RTN","BISITE2",324,0)
 N BIDFLT,BIHELP,BIHELP1,BIPRMPT,X,Y
"RTN","BISITE2",325,0)
 S BIPRMPT="     Do you wish to implement a 4-Day Grace Period"
"RTN","BISITE2",326,0)
 S BIHELP1="        Enter Yes to allow a 4-day grace period."
"RTN","BISITE2",327,0)
 S BIHELP="        Enter No to disallow any grace period."
"RTN","BISITE2",328,0)
 S BIDFLT=$P($G(^BISITE(BISITE,0)),U,21)
"RTN","BISITE2",329,0)
 S BIDFLT=$S(BIDFLT:"YES",1:"NO")
"RTN","BISITE2",330,0)
 W !
"RTN","BISITE2",331,0)
 D DIR^BIFMAN("YO",.Y,,BIPRMPT,BIDFLT,BIHELP,BIHELP1)
"RTN","BISITE2",332,0)
 I $G(Y)="^" D RESET^BISITE Q
"RTN","BISITE2",333,0)
 D DIE^BIFMAN(9002084.02,".21///"_Y,BISITE)
"RTN","BISITE2",334,0)
 ;
"RTN","BISITE2",335,0)
 ;---> HPV Age question.
"RTN","BISITE2",336,0)
 ;D TITLE^BIUTL5("SELECT FORECASTING RULES"),TEXT10
"RTN","BISITE2",337,0)
 ;N BIDFLT,BIHELP,BIPRMPT,X,Y
"RTN","BISITE2",338,0)
 ;
"RTN","BISITE2",339,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BISITE2",340,0)
 ;---> Update prompts and help text for HPV.
"RTN","BISITE2",341,0)
 ;S BIPRMPT="     Select 1 (18 yrs) or 2 for (26f/21m yrs): "
"RTN","BISITE2",342,0)
 ;S BIHELP="        Enter 1 to stop HPV at 18 yrs old; or 2 to stop"
"RTN","BISITE2",343,0)
 ;S BIHELP=BIHELP_" at 26f/21m yrs."
"RTN","BISITE2",344,0)
 ;**********
"RTN","BISITE2",345,0)
 ;
"RTN","BISITE2",346,0)
 ;S BIDFLT=+$P($G(^BISITE(BISITE,0)),U,24)  S:'BIDFLT BIDFLT=1
"RTN","BISITE2",347,0)
 ;D DIR^BIFMAN("SAB^1:18;2:26",.Y,,BIPRMPT,BIDFLT,BIHELP)
"RTN","BISITE2",348,0)
 ;I $G(Y)="^" D RESET^BISITE Q
"RTN","BISITE2",349,0)
 ;D DIE^BIFMAN(9002084.02,".24///"_Y,BISITE)
"RTN","BISITE2",350,0)
 ;**********
"RTN","BISITE2",351,0)
 ;
"RTN","BISITE2",352,0)
 D RESET^BISITE
"RTN","BISITE2",353,0)
 Q
"RTN","BISITE2",354,0)
 ;
"RTN","BISITE2",355,0)
 ;
"RTN","BISITE2",356,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BISITE2",357,0)
 ;---> Update HPV text below.
"RTN","BISITE2",358,0)
 ;**********
"RTN","BISITE2",359,0)
 ;----------
"RTN","BISITE2",360,0)
TEXT8 ;EP
"RTN","BISITE2",361,0)
 ;;Versions 1, 3, 5, 6, 7 and 11 forecast the first vaccines series at 6 wks;
"RTN","BISITE2",362,0)
 ;;the others beginning at 2 mths.  All versions forecast Rotavirus at
"RTN","BISITE2",363,0)
 ;;2 (6 wks), 4, and 6 mths, and Influenza between Aug 15 and March 14
"RTN","BISITE2",364,0)
 ;;for infants 6 months-18 years (or all ages).  Options 3,4 & 6 forecast
"RTN","BISITE2",365,0)
 ;;Hep A starting at 12 months, while options 1,2,5 and 11 forecast Hep A
"RTN","BISITE2",366,0)
 ;;at 15 months.  Option 11 does not forecast Hep A or Hep B in persons
"RTN","BISITE2",367,0)
 ;;over 18 years, regardless of prior doses. All options forecast Tdap, MCV4,
"RTN","BISITE2",368,0)
 ;;and HPV for adolescents per ACIP recommendations.
"RTN","BISITE2",369,0)
 ;;
"RTN","BISITE2",370,0)
 ;;   Option       6 Mths         12 Mths                     15 Mths
"RTN","BISITE2",371,0)
 ;;   ------       ------  -----------------------------      ----------
"RTN","BISITE2",372,0)
 ;;    1) ......   IPV     Hib, MMR, Pn, Var ...........      DTaP, HepA
"RTN","BISITE2",373,0)
 ;;    2) ......   ....    Hib, IPV, MMR, Pn, Var ......      DTaP, HepA
"RTN","BISITE2",374,0)
 ;;    3) ......   IPV     DTaP, Hib, MMR, Pn, Var, HepA
"RTN","BISITE2",375,0)
 ;;    4) ......   ....    DTaP, Hib, IPV, MMR, Pn, Var, HepA
"RTN","BISITE2",376,0)
 ;;    5) ......   IPV     Hib, MMR, Var ...............      DTaP, Pn, HepA
"RTN","BISITE2",377,0)
 ;;    6) ......   IPV     Hib, MMR, Var, HepA..........      DTaP, Pn
"RTN","BISITE2",378,0)
 ;;    7) Comvax   IPV     DTaP, HepB, Hib, MMR, Pn, Var      Hep A
"RTN","BISITE2",379,0)
 ;;   11) ......   IPV     Hib, MMR, Pn, Var ...........      DTaP, HepA
"RTN","BISITE2",380,0)
 ;;
"RTN","BISITE2",381,0)
 D PRINTX("TEXT8",3)
"RTN","BISITE2",382,0)
 Q
"RTN","BISITE2",383,0)
 ;
"RTN","BISITE2",384,0)
 ;
"RTN","BISITE2",385,0)
 ;----------
"RTN","BISITE2",386,0)
TEXT9 ;EP
"RTN","BISITE2",387,0)
 ;;The ACIP recommends that vaccine doses administered 4 days or less
"RTN","BISITE2",388,0)
 ;;before the minimum interval or age be counted as valid.  (Not all
"RTN","BISITE2",389,0)
 ;;states accept this "4-Day Grace Period.")
"RTN","BISITE2",390,0)
 ;;
"RTN","BISITE2",391,0)
 ;;Below, choose "Yes" if you would like to screen using the 4-Day Grace
"RTN","BISITE2",392,0)
 ;;Period.  Choose "No" to adhere strictly to the recommended intervals.
"RTN","BISITE2",393,0)
 ;;
"RTN","BISITE2",394,0)
 ;;Note: The 4-Day Grace Period will not affect vaccine forecasting, only
"RTN","BISITE2",395,0)
 ;;screening for the validity of the dose administered.
"RTN","BISITE2",396,0)
 ;;
"RTN","BISITE2",397,0)
 D PRINTX("TEXT9")
"RTN","BISITE2",398,0)
 Q
"RTN","BISITE2",399,0)
 ;
"RTN","BISITE2",400,0)
 ;
"RTN","BISITE2",401,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BISITE2",402,0)
 ;---> Update prompts and help text for HPV.
"RTN","BISITE2",403,0)
 ;
"RTN","BISITE2",404,0)
 ;----------
"RTN","BISITE2",405,0)
TEXT10 ;EP
"RTN","BISITE2",406,0)
 ;;The ACIP recommends HPV for females 11-12 years with catch up for
"RTN","BISITE2",407,0)
 ;;13-26 years for females and 13-21 years for males.  But HPV is provided
"RTN","BISITE2",408,0)
 ;;by the Vaccine for Children's Program only for 9-18 year olds.
"RTN","BISITE2",409,0)
 ;;
"RTN","BISITE2",410,0)
 ;;Please select whether HPV should forecast for all patients from age 11
"RTN","BISITE2",411,0)
 ;;through 18 years, or only through age 26 for females and age 21 for males.
"RTN","BISITE2",412,0)
 ;;
"RTN","BISITE2",413,0)
 ;**********
"RTN","BISITE2",414,0)
 D PRINTX("TEXT10")
"RTN","BISITE2",415,0)
 Q
"RTN","BISITE2",416,0)
 ;
"RTN","BISITE2",417,0)
 ;
"RTN","BISITE2",418,0)
 ;----------
"RTN","BISITE2",419,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BISITE2",420,0)
 Q:$G(BILINL)=""
"RTN","BISITE2",421,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BISITE2",422,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BISITE2",423,0)
 Q
"RTN","BISITE2",424,0)
 ;
"RTN","BISITE2",425,0)
 ;
"RTN","BISITE2",426,0)
 ;----------
"RTN","BISITE2",427,0)
BISITE() ;EP
"RTN","BISITE2",428,0)
 ; ZEXCEPT:BISITE
"RTN","BISITE2",429,0)
 ;---> Check for local variable BISITE.
"RTN","BISITE2",430,0)
 ;---> Variables:
"RTN","BISITE2",431,0)
 ;     1 - BISITE (req) Site IEN in BI SITE PARAMETER File.
"RTN","BISITE2",432,0)
 ;
"RTN","BISITE2",433,0)
 I '$G(BISITE) D ERRCD^BIUTL2(111,,1),RESET^BISITE Q 1
"RTN","BISITE2",434,0)
 I '$D(^BISITE(BISITE,0)) D ERRCD^BIUTL2(110,,1),RESET^BISITE Q 1
"RTN","BISITE2",435,0)
 Q 0
"RTN","BISITE3")
0^4^B165989063
"RTN","BISITE3",1,0)
BISITE3 ;IHS/CMI/MWR - EDIT SITE PARAMETERS; MAY 10, 2010
"RTN","BISITE3",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BISITE3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISITE3",4,0)
 ;;  EDIT SITE PARAMETERS.
"RTN","BISITE3",5,0)
 ;   PATCH 2: Fix SET of default Low Supply Alert.  LOTREQ+21
"RTN","BISITE3",6,0)
 ;;  PATCH 8: Change to limit Pneumo prompt to 65 yrs.  PNUFLU+10
"RTN","BISITE3",7,0)
 ;;  PATCH 9: Add ability to edit IP address for TCH Forecaster.  IPTCH
"RTN","BISITE3",8,0)
 ;
"RTN","BISITE3",9,0)
 ;
"RTN","BISITE3",10,0)
 ;----------
"RTN","BISITE3",11,0)
FORECAS ;EP
"RTN","BISITE3",12,0)
 ;---> Edit the parameter that determines whether the ImmServe
"RTN","BISITE3",13,0)
 ;---> Forecasting utility is called ("enabled") or not.
"RTN","BISITE3",14,0)
 ;---> Called by Protocol BI SITE FORECAST ENABLE.
"RTN","BISITE3",15,0)
 ;
"RTN","BISITE3",16,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE3",17,0)
 D FULL^VALM1,TITLE^BIUTL5("ENABLE/DISABLE FORECASTING"),TEXT1
"RTN","BISITE3",18,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE3",19,0)
 S DIR(0)="SOA^E:Enable;D:Disable"
"RTN","BISITE3",20,0)
 S DIR("A")="     Please select either Enable or Disable: "
"RTN","BISITE3",21,0)
 S DIR("B")=$S($$FORECAS^BIUTL2(BISITE):"Enable",1:"Disable")
"RTN","BISITE3",22,0)
 D ^DIR
"RTN","BISITE3",23,0)
 D:'$D(DIRUT)
"RTN","BISITE3",24,0)
 .N BIFLD,BIERR S BIFLD(.11)=Y
"RTN","BISITE3",25,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE3",26,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",27,0)
 D RESET^BISITE
"RTN","BISITE3",28,0)
 Q
"RTN","BISITE3",29,0)
 ;
"RTN","BISITE3",30,0)
 ;
"RTN","BISITE3",31,0)
 ;----------
"RTN","BISITE3",32,0)
TEXT1 ;EP
"RTN","BISITE3",33,0)
 ;;
"RTN","BISITE3",34,0)
 ;;If the Forecasting Utility is properly installed and
"RTN","BISITE3",35,0)
 ;;Immunizations Due should be forecast when viewing and editing
"RTN","BISITE3",36,0)
 ;;patient histories, printing Due Lists, etc., choose "Enable" below.
"RTN","BISITE3",37,0)
 ;;If the Forecasting Utility is not installed, choose "Disable" below.
"RTN","BISITE3",38,0)
 ;;
"RTN","BISITE3",39,0)
 ;;NOTE: If at any point in the software an error message saying
"RTN","BISITE3",40,0)
 ;;      "Failure to open forecaster. Check Apache Tomcat Service."
"RTN","BISITE3",41,0)
 ;;      appears, then this is due to an error in the Forecasting Utility.
"RTN","BISITE3",42,0)
 ;;      In this case, either the Forecaster needs to be fixed (see the
"RTN","BISITE3",43,0)
 ;;      release notes), or this parameter should be Disabled.
"RTN","BISITE3",44,0)
 ;;
"RTN","BISITE3",45,0)
 D PRINTX("TEXT1")
"RTN","BISITE3",46,0)
 Q
"RTN","BISITE3",47,0)
 ;
"RTN","BISITE3",48,0)
 ;
"RTN","BISITE3",49,0)
 ;----------
"RTN","BISITE3",50,0)
DASHES ;EP
"RTN","BISITE3",51,0)
 ;---> Edit the parameter that determines whether Chart#s should
"RTN","BISITE3",52,0)
 ;---> be displayed with dashes inserted or not.
"RTN","BISITE3",53,0)
 ;---> Called by Protocol BI SITE CHART# DASHES.
"RTN","BISITE3",54,0)
 ;
"RTN","BISITE3",55,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE3",56,0)
 D FULL^VALM1,TITLE^BIUTL5("DISPLAY CHART# WITH DASHES"),TEXT2
"RTN","BISITE3",57,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE3",58,0)
 S DIR(0)="SOA^0:No Dashes;1:Dashes Included"
"RTN","BISITE3",59,0)
 S DIR("A")="     Please select No Dashes or Dashes Included: "
"RTN","BISITE3",60,0)
 S DIR("B")=$S($$DASH^BIUTL1(BISITE):"Dashes Included",1:"No Dashes")
"RTN","BISITE3",61,0)
 D ^DIR
"RTN","BISITE3",62,0)
 D:'$D(DIRUT)
"RTN","BISITE3",63,0)
 .N BIFLD,BIERR S BIFLD(.12)=Y
"RTN","BISITE3",64,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR)
"RTN","BISITE3",65,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",66,0)
 D RESET^BISITE
"RTN","BISITE3",67,0)
 Q
"RTN","BISITE3",68,0)
 ;
"RTN","BISITE3",69,0)
 ;
"RTN","BISITE3",70,0)
 ;----------
"RTN","BISITE3",71,0)
TEXT2 ;EP
"RTN","BISITE3",72,0)
 ;;You may select whether Chart#'s (Health Record Numbers) are
"RTN","BISITE3",73,0)
 ;;displayed throughout the Immunization package with dashes or not.
"RTN","BISITE3",74,0)
 ;;
"RTN","BISITE3",75,0)
 ;;Chart# displayed without dashes..:  12345
"RTN","BISITE3",76,0)
 ;;Same Chart# displayed with dashes:  01-23-45
"RTN","BISITE3",77,0)
 ;;
"RTN","BISITE3",78,0)
 ;;
"RTN","BISITE3",79,0)
 D PRINTX("TEXT2")
"RTN","BISITE3",80,0)
 Q
"RTN","BISITE3",81,0)
 ;
"RTN","BISITE3",82,0)
 ;
"RTN","BISITE3",83,0)
 ;----------
"RTN","BISITE3",84,0)
OFFREC ;EP
"RTN","BISITE3",85,0)
 ;---> Select the Letter that will serve as the Official Immunization
"RTN","BISITE3",86,0)
 ;---> Record.
"RTN","BISITE3",87,0)
 ;---> Called by Protocol BI SITE OFFICIAL PT RECORD.
"RTN","BISITE3",88,0)
 ;
"RTN","BISITE3",89,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE3",90,0)
 D FULL^VALM1,TITLE^BIUTL5("OFFICIAL IMMUNIZATION RECORD"),TEXT3
"RTN","BISITE3",91,0)
 D DIE^BIFMAN(9002084.02,".13",BISITE)
"RTN","BISITE3",92,0)
 D RESET^BISITE
"RTN","BISITE3",93,0)
 Q
"RTN","BISITE3",94,0)
 ;
"RTN","BISITE3",95,0)
 ;
"RTN","BISITE3",96,0)
 ;----------
"RTN","BISITE3",97,0)
TEXT3 ;EP
"RTN","BISITE3",98,0)
 ;;The Official Immunization Record is the letter that presents all of
"RTN","BISITE3",99,0)
 ;;a patient's Immunization information and is generally used to send
"RTN","BISITE3",100,0)
 ;;to schools, parents, other clinics, etc.
"RTN","BISITE3",101,0)
 ;;
"RTN","BISITE3",102,0)
 ;;The letter selected here will be used as the patient's Official
"RTN","BISITE3",103,0)
 ;;Immunization Record whenever users select that action.
"RTN","BISITE3",104,0)
 ;;
"RTN","BISITE3",105,0)
 ;;In order to select the letter for this Site Parameter, it must
"RTN","BISITE3",106,0)
 ;;already have been created.  To create the Official Immunization
"RTN","BISITE3",107,0)
 ;;Record letter, select LET under the Manager Menu (MGR-->LET).
"RTN","BISITE3",108,0)
 ;;Create a new letter named "Official Immunization Record," and then
"RTN","BISITE3",109,0)
 ;;return to this site parameter to choose it.
"RTN","BISITE3",110,0)
 ;;
"RTN","BISITE3",111,0)
 D PRINTX("TEXT3")
"RTN","BISITE3",112,0)
 Q
"RTN","BISITE3",113,0)
 ;
"RTN","BISITE3",114,0)
 ;
"RTN","BISITE3",115,0)
 ;----------
"RTN","BISITE3",116,0)
PNUFLU ;EP
"RTN","BISITE3",117,0)
 ;---> Edit Pneumo, Flu, and Zoster site parameters.  v8.5
"RTN","BISITE3",118,0)
 ;
"RTN","BISITE3",119,0)
 ;---> Edit the age at which adults should be forecast to receive
"RTN","BISITE3",120,0)
 ;---> pneumococcal vaccines.
"RTN","BISITE3",121,0)
 ;---> Called by Protocol BI SITE PNEUMO AGE.
"RTN","BISITE3",122,0)
 ;
"RTN","BISITE3",123,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE3",124,0)
 D FULL^VALM1,TITLE^BIUTL5("EDIT AGE APPROPRIATE FOR PNEUMO"),TEXT4
"RTN","BISITE3",125,0)
 N BIDFLT,BIPOP,DIR,DIRUT,Y
"RTN","BISITE3",126,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE3",127,0)
 ;---> Only allow age range up to 65.
"RTN","BISITE3",128,0)
 ;S DIR(0)="NOA^1:9999:0"
"RTN","BISITE3",129,0)
 S DIR(0)="NOA^1:65:0"
"RTN","BISITE3",130,0)
 S DIR("A")="     Adult Age for Pneumo: "
"RTN","BISITE3",131,0)
 S DIR("B")=$P($$PNMAGE^BIPATUP2(BISITE),U)
"RTN","BISITE3",132,0)
 ;S DIR("?")="       Enter a number between 1 and 99 years of age."
"RTN","BISITE3",133,0)
 S DIR("?")="       Enter a number between 1 and 65 years of age."
"RTN","BISITE3",134,0)
 D ^DIR
"RTN","BISITE3",135,0)
 I $D(DIRUT) D RESET^BISITE Q
"RTN","BISITE3",136,0)
 ;
"RTN","BISITE3",137,0)
 N BIFLD,BIERR S BIFLD(.1)=+Y
"RTN","BISITE3",138,0)
 D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR)
"RTN","BISITE3",139,0)
 I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3(),RESET^BISITE Q
"RTN","BISITE3",140,0)
 ;
"RTN","BISITE3",141,0)
 ;---> Flu Forecast for ALL question.
"RTN","BISITE3",142,0)
 ;D TITLE^BIUTL5("SELECT FLU FORECASTING AGES"),TEXT11
"RTN","BISITE3",143,0)
 ;N BIDFLT,BIHELP,BIHELP1,BIPRMPT,X,Y
"RTN","BISITE3",144,0)
 ;S BIPRMPT="     Forecast Flu vaccination for ALL patients"
"RTN","BISITE3",145,0)
 ;S BIHELP1="        Enter Yes to forecast Flu for ALL patients."
"RTN","BISITE3",146,0)
 ;S BIHELP="        Enter No to limit Flu forecasting (6m-18y, 50y+)."
"RTN","BISITE3",147,0)
 ;S BIDFLT=$S($$FLUALL^BIPATUP2(BISITE):"YES",1:"NO")
"RTN","BISITE3",148,0)
 ;W !
"RTN","BISITE3",149,0)
 ;D DIR^BIFMAN("YO",.Y,,BIPRMPT,BIDFLT,BIHELP,BIHELP1)
"RTN","BISITE3",150,0)
 ;I $G(Y)="^" D RESET^BISITE Q
"RTN","BISITE3",151,0)
 ;D DIE^BIFMAN(9002084.02,".27///"_Y,BISITE)
"RTN","BISITE3",152,0)
 ;
"RTN","BISITE3",153,0)
 ;---> Zoster Vaccine Forecast question.
"RTN","BISITE3",154,0)
 ;D TITLE^BIUTL5("SELECT FORECASTING FOR ZOSTER VACCINE"),TEXT12
"RTN","BISITE3",155,0)
 ;N BIDFLT,BIHELP,BIHELP1,BIPRMPT,X,Y
"RTN","BISITE3",156,0)
 ;S BIPRMPT="     Forecast Zoster vaccine for ALL patients over age 60"
"RTN","BISITE3",157,0)
 ;S BIHELP1="        Enter Yes to forecast Zoster vaccine for ALL patients over age 60."
"RTN","BISITE3",158,0)
 ;S BIHELP="        Enter No to disable Zoster vaccine forecasting."
"RTN","BISITE3",159,0)
 ;S BIDFLT=$S($$ZOSTER^BIPATUP2(BISITE):"YES",1:"NO")
"RTN","BISITE3",160,0)
 ;W !
"RTN","BISITE3",161,0)
 ;D DIR^BIFMAN("YO",.Y,,BIPRMPT,BIDFLT,BIHELP,BIHELP1)
"RTN","BISITE3",162,0)
 ;I $G(Y)="^" D RESET^BISITE Q
"RTN","BISITE3",163,0)
 ;D DIE^BIFMAN(9002084.02,".29///"_Y,BISITE)
"RTN","BISITE3",164,0)
 ;**********
"RTN","BISITE3",165,0)
 ;
"RTN","BISITE3",166,0)
 D RESET^BISITE
"RTN","BISITE3",167,0)
 Q
"RTN","BISITE3",168,0)
 ;
"RTN","BISITE3",169,0)
 ;---> q6-year parameter no longer used.  Feb 2010.
"RTN","BISITE3",170,0)
 ;W !!?5,"For people "_+Y_" years of age and older, should Pneumo-PS"
"RTN","BISITE3",171,0)
 ;W !?5,"be routinely forecast every 6 years after the age of "_+Y_", "
"RTN","BISITE3",172,0)
 ;W !?5,"or should it be a one-time immunization?"
"RTN","BISITE3",173,0)
 ;S BIDFLT=$P($G(^BISITE(BISITE,0)),U,22)
"RTN","BISITE3",174,0)
 ;S BIDFLT=$S(BIDFLT:"YES",1:"NO")
"RTN","BISITE3",175,0)
 ;W !
"RTN","BISITE3",176,0)
 ;D DIR^BIFMAN("YO",.Y,.BIPOP,"     Forecast every 6 years",BIDFLT)
"RTN","BISITE3",177,0)
 ;D:'$G(BIPOP)
"RTN","BISITE3",178,0)
 ;.N BIFLD,BIERR S BIFLD(.22)=+Y
"RTN","BISITE3",179,0)
 ;.D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR)
"RTN","BISITE3",180,0)
 ;.I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",181,0)
 ;D RESET^BISITE
"RTN","BISITE3",182,0)
 Q
"RTN","BISITE3",183,0)
 ;
"RTN","BISITE3",184,0)
 ;
"RTN","BISITE3",185,0)
 ;----------
"RTN","BISITE3",186,0)
TEXT4 ;EP
"RTN","BISITE3",187,0)
 ;;Enter the adult age at which you wish pneumococcal immunizations
"RTN","BISITE3",188,0)
 ;;to be routinely forecast (prescribed).  Typically this is set to
"RTN","BISITE3",189,0)
 ;;65 years of age.
"RTN","BISITE3",190,0)
 ;;
"RTN","BISITE3",191,0)
 D PRINTX("TEXT4")
"RTN","BISITE3",192,0)
 Q
"RTN","BISITE3",193,0)
 ;
"RTN","BISITE3",194,0)
 ;
"RTN","BISITE3",195,0)
 ;----------
"RTN","BISITE3",196,0)
TEXT11 ;EP
"RTN","BISITE3",197,0)
 ;;Influenza vaccine is recommend for ALL ages.
"RTN","BISITE3",198,0)
 ;;You can, however, choose to limit influenza vaccine forecasting to
"RTN","BISITE3",199,0)
 ;;patients ages 6 months to 18 years and to those 50 years and older.
"RTN","BISITE3",200,0)
 ;;
"RTN","BISITE3",201,0)
 ;;Do you wish to forecast Flu vaccination for ALL patients (over 6 months)?
"RTN","BISITE3",202,0)
 ;;
"RTN","BISITE3",203,0)
 D PRINTX("TEXT11")
"RTN","BISITE3",204,0)
 Q
"RTN","BISITE3",205,0)
 ;
"RTN","BISITE3",206,0)
 ;
"RTN","BISITE3",207,0)
 ;----------
"RTN","BISITE3",208,0)
TEXT12 ;EP
"RTN","BISITE3",209,0)
 ;;A single dose of Zoster vaccine vaccination is recommended for ALL
"RTN","BISITE3",210,0)
 ;;patients over 60 years of age.
"RTN","BISITE3",211,0)
 ;;
"RTN","BISITE3",212,0)
 ;;Do you wish to forecast Zoster vaccine for ALL patients over age 60?
"RTN","BISITE3",213,0)
 ;;
"RTN","BISITE3",214,0)
 D PRINTX("TEXT12")
"RTN","BISITE3",215,0)
 Q
"RTN","BISITE3",216,0)
 ;
"RTN","BISITE3",217,0)
 ;
"RTN","BISITE3",218,0)
 ;----------
"RTN","BISITE3",219,0)
DEFPRV ;EP
"RTN","BISITE3",220,0)
 ;---> Edit the parameter that determines whether the User
"RTN","BISITE3",221,0)
 ;---> should appear as the Default Provider.
"RTN","BISITE3",222,0)
 ;---> Called by Protocol BI SITE DEFAULT PROVIDER.
"RTN","BISITE3",223,0)
 ;
"RTN","BISITE3",224,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE3",225,0)
 D FULL^VALM1,TITLE^BIUTL5("USER AS DEFAULT PROVIDER"),TEXT5
"RTN","BISITE3",226,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE3",227,0)
 S DIR(0)="SOA^0:No;1:Yes"
"RTN","BISITE3",228,0)
 S DIR("A")="     Should the User appear as the Default Provider: "
"RTN","BISITE3",229,0)
 S DIR("B")=$S($$DEFPROV^BIUTL6(BISITE):"Yes",1:"No")
"RTN","BISITE3",230,0)
 D ^DIR
"RTN","BISITE3",231,0)
 D:'$D(DIRUT)
"RTN","BISITE3",232,0)
 .N BIFLD,BIERR S BIFLD(.16)=Y
"RTN","BISITE3",233,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE3",234,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",235,0)
 D RESET^BISITE
"RTN","BISITE3",236,0)
 Q
"RTN","BISITE3",237,0)
 ;
"RTN","BISITE3",238,0)
 ;
"RTN","BISITE3",239,0)
 ;----------
"RTN","BISITE3",240,0)
TEXT5 ;EP
"RTN","BISITE3",241,0)
 ;;When new Immunizations or new Skin Tests are being added,
"RTN","BISITE3",242,0)
 ;;it is possible to have the User appear as the Default Provider.
"RTN","BISITE3",243,0)
 ;;In other words, when the screen for a new Visit first comes up,
"RTN","BISITE3",244,0)
 ;;the Provider field is already filled in with the User's name.
"RTN","BISITE3",245,0)
 ;;(The User is the person logged on and entering the data.)
"RTN","BISITE3",246,0)
 ;;
"RTN","BISITE3",247,0)
 ;;This will ONLY occur if the User is a Provider (has been given
"RTN","BISITE3",248,0)
 ;;the Provider Key).  This will NOT occur on edits of pre-existing
"RTN","BISITE3",249,0)
 ;;Visits, whether they have a Provider or not.
"RTN","BISITE3",250,0)
 ;;
"RTN","BISITE3",251,0)
 D PRINTX("TEXT5")
"RTN","BISITE3",252,0)
 Q
"RTN","BISITE3",253,0)
 ;
"RTN","BISITE3",254,0)
 ;
"RTN","BISITE3",255,0)
 ;----------
"RTN","BISITE3",256,0)
IMMSVDIR ;EP
"RTN","BISITE3",257,0)
 ;---> Edit the parameter indicating the Immserve Directory.
"RTN","BISITE3",258,0)
 ;
"RTN","BISITE3",259,0)
 K BIDFLT,DIR,DIRUT,X,Y
"RTN","BISITE3",260,0)
 ;
"RTN","BISITE3",261,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE3",262,0)
 ;---> The Immserve Directory is no longer relevant.
"RTN","BISITE3",263,0)
 D TITLE^BIUTL5("INDICATE IMMSERVE DIRECTORY")
"RTN","BISITE3",264,0)
 W !!?20,"This parameter is no longer in use.",!!
"RTN","BISITE3",265,0)
 D DIRZ^BIUTL3()
"RTN","BISITE3",266,0)
 D RESET^BISITE
"RTN","BISITE3",267,0)
 Q
"RTN","BISITE3",268,0)
 ;**********
"RTN","BISITE3",269,0)
 ;
"RTN","BISITE3",270,0)
 D TITLE^BIUTL5("INDICATE IMMSERVE DIRECTORY"),TEXT7
"RTN","BISITE3",271,0)
 S DIR(0)="FOA^3:70"
"RTN","BISITE3",272,0)
 S DIR("A")="     "
"RTN","BISITE3",273,0)
 S DIR("B")=$$IMMSVDIR^BIUTL8(BISITE)
"RTN","BISITE3",274,0)
 S X="       Enter the path for ImmServe files.  Simply enter the directory"
"RTN","BISITE3",275,0)
 S DIR("?",1)=X
"RTN","BISITE3",276,0)
 S X="       name with its path.  Terminate the path with a slash."
"RTN","BISITE3",277,0)
 S DIR("?")=X K X
"RTN","BISITE3",278,0)
 D ^DIR
"RTN","BISITE3",279,0)
 S:Y="" Y="@"
"RTN","BISITE3",280,0)
 S Z=0
"RTN","BISITE3",281,0)
 D CHKSLASH^BISITE2(.Y,.Z)
"RTN","BISITE3",282,0)
 G:Z IMMSVDIR
"RTN","BISITE3",283,0)
 D:'$D(DIRUT)
"RTN","BISITE3",284,0)
 .N BIFLD,BIERR S BIFLD(.18)=Y
"RTN","BISITE3",285,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR)
"RTN","BISITE3",286,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",287,0)
 D RESET^BISITE
"RTN","BISITE3",288,0)
 Q
"RTN","BISITE3",289,0)
 ;
"RTN","BISITE3",290,0)
 ;
"RTN","BISITE3",291,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BISITE3",292,0)
 ;---> Add ability to edit IP address for TCH Forecaster.
"RTN","BISITE3",293,0)
IPTCH ;EP
"RTN","BISITE3",294,0)
 D TITLE^BIUTL5("INDICATE IP ADDRESS FOR TCH FORECASTER"),TEXT13
"RTN","BISITE3",295,0)
 N DIR,DIRUT,X
"RTN","BISITE3",296,0)
 S DIR(0)="FOA^7:25",DIR("A")="     "
"RTN","BISITE3",297,0)
 D
"RTN","BISITE3",298,0)
 .N Y S Y=$$IPTCH^BIUTL8(BISITE)
"RTN","BISITE3",299,0)
 .I Y]"" S DIR("B")=Y Q
"RTN","BISITE3",300,0)
 .S DIR("B")="127.0.0.1"
"RTN","BISITE3",301,0)
 S DIR("?")="       Enter the IP address of the machine hosting the TCH Forecaster."
"RTN","BISITE3",302,0)
 D ^DIR
"RTN","BISITE3",303,0)
 ;W  R ZZZ
"RTN","BISITE3",304,0)
 I X="^" D RESET^BISITE Q
"RTN","BISITE3",305,0)
 S:X="@" Y="127.0.0.1" K DIRUT
"RTN","BISITE3",306,0)
 D:'$D(DIRUT)
"RTN","BISITE3",307,0)
 .N BIFLD,BIERR S BIFLD(.30)=Y
"RTN","BISITE3",308,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR)
"RTN","BISITE3",309,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",310,0)
 D RESET^BISITE
"RTN","BISITE3",311,0)
 Q
"RTN","BISITE3",312,0)
 ;
"RTN","BISITE3",313,0)
 ;----------
"RTN","BISITE3",314,0)
TEXT13 ;EP
"RTN","BISITE3",315,0)
 ;;Enter the IP Address of the server hosting the TCH Forecaster.
"RTN","BISITE3",316,0)
 ;;A typical installation has the forecaster running on the same
"RTN","BISITE3",317,0)
 ;;machine as the one hosting this system.  In that case the address
"RTN","BISITE3",318,0)
 ;;would be 127.0.0.1 (which is the default).
"RTN","BISITE3",319,0)
 ;;
"RTN","BISITE3",320,0)
 ;;However, the TCH Forecaster hosted on another machine at a different
"RTN","BISITE3",321,0)
 ;;IP address.
"RTN","BISITE3",322,0)
 ;;
"RTN","BISITE3",323,0)
 ;;Enter a different IP address for the TCH Forecaster below, if you wish
"RTN","BISITE3",324,0)
 ;;to change it:
"RTN","BISITE3",325,0)
 ;;
"RTN","BISITE3",326,0)
 D PRINTX("TEXT13")
"RTN","BISITE3",327,0)
 Q
"RTN","BISITE3",328,0)
 ;**********
"RTN","BISITE3",329,0)
 ;
"RTN","BISITE3",330,0)
 ;----------
"RTN","BISITE3",331,0)
TEXT7 ;EP
"RTN","BISITE3",332,0)
 ;;
"RTN","BISITE3",333,0)
 ;;Enter or edit, if necessary, the full path of the directory in which
"RTN","BISITE3",334,0)
 ;;the ImmServe Files will be stored.  (Path length may not be more than
"RTN","BISITE3",335,0)
 ;;70 characters long.)
"RTN","BISITE3",336,0)
 ;;
"RTN","BISITE3",337,0)
 ;;For Immunization v8.1 the settings should be:
"RTN","BISITE3",338,0)
 ;;
"RTN","BISITE3",339,0)
 ;;   AIX:    /usr/local/immserve84/
"RTN","BISITE3",340,0)
 ;;   NT/XP:  C:\Program Files\Immserve84\
"RTN","BISITE3",341,0)
 ;;
"RTN","BISITE3",342,0)
 ;;
"RTN","BISITE3",343,0)
 ;;Enter or edit the Immserve Directory Path below:
"RTN","BISITE3",344,0)
 ;;
"RTN","BISITE3",345,0)
 D PRINTX("TEXT7")
"RTN","BISITE3",346,0)
 Q
"RTN","BISITE3",347,0)
 ;
"RTN","BISITE3",348,0)
 ;
"RTN","BISITE3",349,0)
 ;----------
"RTN","BISITE3",350,0)
LOTREQ ;EP
"RTN","BISITE3",351,0)
 ;---> Edit the parameter for whether Lot Numbers should be required.
"RTN","BISITE3",352,0)
 ;---> Called by Protocol BI SITE LOT# REQ'D.
"RTN","BISITE3",353,0)
 ;
"RTN","BISITE3",354,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE3",355,0)
 D FULL^VALM1,TITLE^BIUTL5("LOT NUMBER REQUIRED"),TEXT9
"RTN","BISITE3",356,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE3",357,0)
 S DIR(0)="SOA^Y:YES;N:NO"
"RTN","BISITE3",358,0)
 S DIR("A")="     Please select either Yes or No: "
"RTN","BISITE3",359,0)
 S DIR("B")=$S($$LOTREQ^BIUTL2(BISITE):"Yes",1:"No")
"RTN","BISITE3",360,0)
 D ^DIR
"RTN","BISITE3",361,0)
 D:'$D(DIRUT)
"RTN","BISITE3",362,0)
 .N BIFLD,BIERR S BIFLD(.09)=Y
"RTN","BISITE3",363,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE3",364,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",365,0)
 ;
"RTN","BISITE3",366,0)
 D FULL^VALM1,TITLE^BIUTL5("LOT NUMBER LOW SUPPLY ALERT"),TEXT10
"RTN","BISITE3",367,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE3",368,0)
 S DIR(0)="NOA^0:9999"
"RTN","BISITE3",369,0)
 S DIR("A")="     Please enter a Low Supply Alert number: "
"RTN","BISITE3",370,0)
 ;
"RTN","BISITE3",371,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BISITE3",372,0)
 ;---> Fix SET of default Low Supply Alert.
"RTN","BISITE3",373,0)
 ;S DIR("B")=$$LOTLOW^BIUTL2(BISITE)
"RTN","BISITE3",374,0)
 S DIR("B")=$$LOTSDEF^BISITE1(BISITE)
"RTN","BISITE3",375,0)
 ;**********
"RTN","BISITE3",376,0)
 ;
"RTN","BISITE3",377,0)
 D ^DIR
"RTN","BISITE3",378,0)
 D:'$D(DIRUT)
"RTN","BISITE3",379,0)
 .N BIFLD,BIERR S BIFLD(.25)=Y
"RTN","BISITE3",380,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE3",381,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE3",382,0)
 D RESET^BISITE
"RTN","BISITE3",383,0)
 Q
"RTN","BISITE3",384,0)
 ;
"RTN","BISITE3",385,0)
 ;
"RTN","BISITE3",386,0)
 ;----------
"RTN","BISITE3",387,0)
TEXT9 ;EP
"RTN","BISITE3",388,0)
 ;;
"RTN","BISITE3",389,0)
 ;;If Lot Numbers should be required when entering Immunization visits,
"RTN","BISITE3",390,0)
 ;;enter YES for this parameter.  If Lot Numbers should be optional,
"RTN","BISITE3",391,0)
 ;;enter NO.
"RTN","BISITE3",392,0)
 ;;
"RTN","BISITE3",393,0)
 ;;Note: Lot Numbers will NOT be required for Immunizations with a
"RTN","BISITE3",394,0)
 ;;      Category of "Historical Event", even if this site parameter
"RTN","BISITE3",395,0)
 ;;      is to YES.
"RTN","BISITE3",396,0)
 ;;
"RTN","BISITE3",397,0)
 ;;
"RTN","BISITE3",398,0)
 D PRINTX("TEXT9")
"RTN","BISITE3",399,0)
 Q
"RTN","BISITE3",400,0)
 ;
"RTN","BISITE3",401,0)
 ;
"RTN","BISITE3",402,0)
 ;----------  vvv83
"RTN","BISITE3",403,0)
TEXT10 ;EP
"RTN","BISITE3",404,0)
 ;;
"RTN","BISITE3",405,0)
 ;;When the number of remaining doses of a given Lot falls below
"RTN","BISITE3",406,0)
 ;;its Low Supply Alert (set by the manager when editing Lot Numbers),
"RTN","BISITE3",407,0)
 ;;a "Low Supply Alert" will pop up on the screen as a user is
"RTN","BISITE3",408,0)
 ;;adding or editing an immunization with that particular Lot Number.
"RTN","BISITE3",409,0)
 ;;
"RTN","BISITE3",410,0)
 ;;The number entered here, under the Site Parameters, is the Low
"RTN","BISITE3",411,0)
 ;;Supply Alert DEFAULT.  In the absence of a specific Low Supply Alert
"RTN","BISITE3",412,0)
 ;;for a given Lot Number, this Default will be used.
"RTN","BISITE3",413,0)
 ;;
"RTN","BISITE3",414,0)
 ;;NOTE: No alert will occur if a "Starting Amount" has not been entered
"RTN","BISITE3",415,0)
 ;;for the particular Lot Number in the EDIT LOT NUMBER TABLE.
"RTN","BISITE3",416,0)
 ;;
"RTN","BISITE3",417,0)
 ;;
"RTN","BISITE3",418,0)
 D PRINTX("TEXT10")
"RTN","BISITE3",419,0)
 Q
"RTN","BISITE3",420,0)
 ;
"RTN","BISITE3",421,0)
 ;
"RTN","BISITE3",422,0)
 ;----------
"RTN","BISITE3",423,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BISITE3",424,0)
 Q:$G(BILINL)=""
"RTN","BISITE3",425,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BISITE3",426,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BISITE3",427,0)
 Q
"RTN","BISITE4")
0^5^B148107237
"RTN","BISITE4",1,0)
BISITE4 ;IHS/CMI/MWR - SELECT GPRA COMMUNITIES.; MAY 10, 2010
"RTN","BISITE4",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BISITE4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BISITE4",4,0)
 ;;  SELECT COMMUNITIES TO BE INCLUDED IN GPRA GROUPS AND REPORTS.
"RTN","BISITE4",5,0)
 ;;  PATCH 8: Update Help Text to exclude influenza.  TEXT2+3
"RTN","BISITE4",6,0)
 ;;  PATCH 9: Update options to include Hep B. TEXT1+24
"RTN","BISITE4",7,0)
 ;
"RTN","BISITE4",8,0)
 ;
"RTN","BISITE4",9,0)
 ;----------
"RTN","BISITE4",10,0)
GPRA ;EP Select Communities for GPRA.
"RTN","BISITE4",11,0)
 ;---> Called by Protocol BI SITE GPRA COMS.
"RTN","BISITE4",12,0)
 ;
"RTN","BISITE4",13,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE4",14,0)
 ;
"RTN","BISITE4",15,0)
 ;---> Do VISTA stuff and quit if we are on VISTA
"RTN","BISITE4",16,0)
 I '$$RPMS^BIUTL9() D COMMS QUIT
"RTN","BISITE4",17,0)
 ;
"RTN","BISITE4",18,0)
 N BIITEM S BIITEM="Community"
"RTN","BISITE4",19,0)
 N BITITEM S BITITEM="GPRA Community"
"RTN","BISITE4",20,0)
 N BICOL S BICOL="    #  Community                  State"
"RTN","BISITE4",21,0)
 N BIID S BIID="3;I $G(X) S:$D(^DIC(5,X,0)) X=$P(^(0),U);32"
"RTN","BISITE4",22,0)
 N BIGPRA,BIGPRAD,BIPOP
"RTN","BISITE4",23,0)
 ;
"RTN","BISITE4",24,0)
 ;---> Use previous GPRA List for this site as default.
"RTN","BISITE4",25,0)
 D GETGPRA(.BIGPRAD,DUZ(2))
"RTN","BISITE4",26,0)
 D SEL^BISELECT(9999999.05,"BIGPRA",BIITEM,,,,BIID,BICOL,.BIPOP,1,,.BIGPRAD,BITITEM)
"RTN","BISITE4",27,0)
 ;
"RTN","BISITE4",28,0)
 ;---> Now replace the previous list for this site with the newly selected list.
"RTN","BISITE4",29,0)
 D
"RTN","BISITE4",30,0)
 .Q:$G(BIPOP)
"RTN","BISITE4",31,0)
 .;---> If user tried to select ALL Communities for GPRA, don't change.
"RTN","BISITE4",32,0)
 .I $D(BIGPRA("ALL")) D  Q
"RTN","BISITE4",33,0)
 ..W !!,"                    * GPRA Communities *"
"RTN","BISITE4",34,0)
 ..W !!!,"   You may not select ""ALL"" for your set of GPRA Communities."
"RTN","BISITE4",35,0)
 ..D DIRZ^BIUTL3()
"RTN","BISITE4",36,0)
 .;
"RTN","BISITE4",37,0)
 .N BIK S BIK="^BISITE("_DUZ(2)_",2)" K @BIK
"RTN","BISITE4",38,0)
 .S ^BISITE(DUZ(2),2,0)="^9002084.04PA"
"RTN","BISITE4",39,0)
 .N N S N=0
"RTN","BISITE4",40,0)
 .F  S N=$O(BIGPRA(N)) Q:'N  D
"RTN","BISITE4",41,0)
 ..S ^BISITE(DUZ(2),2,N,0)=N,^BISITE(DUZ(2),2,"B",N,N)=""
"RTN","BISITE4",42,0)
 ..N X S X=$P($G(^BISITE(DUZ(2),2,0)),U,4)+1
"RTN","BISITE4",43,0)
 ..S ^BISITE(DUZ(2),2,0)="^9002084.04PA^"_N_U_X
"RTN","BISITE4",44,0)
 ;
"RTN","BISITE4",45,0)
 D RESET^BISITE
"RTN","BISITE4",46,0)
 Q
"RTN","BISITE4",47,0)
 ;
"RTN","BISITE4",48,0)
COMMS ; EP - Ask user to add/edit communities for statistics
"RTN","BISITE4",49,0)
 ;---> Called by Protocol BI SITE GPRA COMS.
"RTN","BISITE4",50,0)
 ; I am so so sad sad that I can't use Mike's way way too cool picker
"RTN","BISITE4",51,0)
 ;
"RTN","BISITE4",52,0)
 ; ZEXCEPT: BISITE
"RTN","BISITE4",53,0)
 ;
"RTN","BISITE4",54,0)
 D FULL^VALM1,TITLE^BIUTL5("SELECT COMMUNITIES FOR STATISTICS")
"RTN","BISITE4",55,0)
 D TXTCOMMS  ; intro
"RTN","BISITE4",56,0)
 ;
"RTN","BISITE4",57,0)
 ; We edit fields:
"RTN","BISITE4",58,0)
 ; --> 920000.02: COMMUNITY LOCATION TYPE (ZIP or Postal?)
"RTN","BISITE4",59,0)
 ; -->    920001: COMMUNITY (Multiple)
"RTN","BISITE4",60,0)
 ;
"RTN","BISITE4",61,0)
 N DIE,DA,DR,X,Y,DIDEL,DTOUT
"RTN","BISITE4",62,0)
 S DIE="^BISITE(",DA=BISITE,DR="920000.02;920001" D ^DIE
"RTN","BISITE4",63,0)
 ;
"RTN","BISITE4",64,0)
 ;----> Go back
"RTN","BISITE4",65,0)
 D RESET^BISITE
"RTN","BISITE4",66,0)
 ;
"RTN","BISITE4",67,0)
 QUIT
"RTN","BISITE4",68,0)
 ;
"RTN","BISITE4",69,0)
 ;
"RTN","BISITE4",70,0)
TXTCOMMS ; [Internal] - Intro text to COMMS
"RTN","BISITE4",71,0)
 ;;The following questions ask you about the communities you want to use
"RTN","BISITE4",72,0)
 ;;for collection of statistics in various reports in the Immunization
"RTN","BISITE4",73,0)
 ;;Package (e.g. who is immunized and who isn't).
"RTN","BISITE4",74,0)
 ;;
"RTN","BISITE4",75,0)
 ;;You will be prompted for a regular field (Use ZIP code or Postal Codes),
"RTN","BISITE4",76,0)
 ;;then you can populate the ZIPs/Codes that you want to collect data from
"RTN","BISITE4",77,0)
 ;;in the multiple. It's up to you to make sure that you are using the
"RTN","BISITE4",78,0)
 ;;correct type (ZIP or Postal Code) and whether the data you populate is
"RTN","BISITE4",79,0)
 ;;correct. The data will only be evaluated as a free text field match on
"RTN","BISITE4",80,0)
 ;;indexes in the patient file.
"RTN","BISITE4",81,0)
 ;;
"RTN","BISITE4",82,0)
 D PRINTX("TXTCOMMS")
"RTN","BISITE4",83,0)
 QUIT
"RTN","BISITE4",84,0)
 ;
"RTN","BISITE4",85,0)
 ;----------
"RTN","BISITE4",86,0)
 ;
"RTN","BISITE4",87,0)
GETGPRA(BIGPRA,BIDUZ2,BIERR) ;PEP - Return GPRA Communities Array (RPMS).
"RTN","BISITE4",88,0)
 ;---> Retrieve GPRA Communities Array of IEN's for this DUZ(2).
"RTN","BISITE4",89,0)
 ;---> Parameters:
"RTN","BISITE4",90,0)
 ;     1 - BIGPRA (ret) Array of GPRA IEN's in the COMMUNITY file - ^AUTTCOM(.
"RTN","BISITE4",91,0)
 ;     2 - BIDUZ2  (req) Site IEN or DUZ(2).
"RTN","BISITE4",92,0)
 ;     3 - BIERR  (ret) Error text, if any.
"RTN","BISITE4",93,0)
 ;
"RTN","BISITE4",94,0)
 I '$G(BIDUZ2) S BIDUZ2=$G(DUZ(2))
"RTN","BISITE4",95,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(109,.BIERR) Q
"RTN","BISITE4",96,0)
 ; Absence of data is NOT A BUG.
"RTN","BISITE4",97,0)
 ; I '$O(^BISITE(BIDUZ2,2,0)) D ERRCD^BIUTL2(110,.BIERR) Q
"RTN","BISITE4",98,0)
 N N S N=0
"RTN","BISITE4",99,0)
 F  S N=$O(^BISITE(BIDUZ2,2,N)) Q:'N  S BIGPRA(N)=""
"RTN","BISITE4",100,0)
 Q
"RTN","BISITE4",101,0)
 ;
"RTN","BISITE4",102,0)
GETCOMMS(COMMS,DUZ2,BIERR) ; PEP - Return Stats Communities (VISTA only)
"RTN","BISITE4",103,0)
 ;---> Retrieve GPRA Communities Array of IEN's for this DUZ(2).
"RTN","BISITE4",104,0)
 ;---> Parameters:
"RTN","BISITE4",105,0)
 ;     1 - COMMS (ret) Array of GPRA IEN's in the COMMUNITY file - ^AUTTCOM(.
"RTN","BISITE4",106,0)
 ;     2 - DUZ2  (req) Site IEN or DUZ(2).
"RTN","BISITE4",107,0)
 ;     3 - BIERR  (ret) Error text, if any.
"RTN","BISITE4",108,0)
 I '$G(DUZ2) S DUZ2=$G(DUZ(2))
"RTN","BISITE4",109,0)
 I '$G(DUZ2) D ERRCD^BIUTL2(109,.BIERR) Q
"RTN","BISITE4",110,0)
 N N S N=0
"RTN","BISITE4",111,0)
 F  S N=$O(^BISITE(DUZ2,920001,N)) Q:'N  S COMMS(N)=""
"RTN","BISITE4",112,0)
 Q
"RTN","BISITE4",113,0)
 ;
"RTN","BISITE4",114,0)
 ;----------
"RTN","BISITE4",115,0)
 ;
"RTN","BISITE4",116,0)
INPTCHK ;EP
"RTN","BISITE4",117,0)
 ;---> Edit the parameter that determines whether Inpatient Status
"RTN","BISITE4",118,0)
 ;---> is checked (and changed, if necessary) when storing Visits.
"RTN","BISITE4",119,0)
 ;---> Called by Protocol BI SITE INPATIENT CHECK ENABLE.
"RTN","BISITE4",120,0)
 ;
"RTN","BISITE4",121,0)
 ; ZEXCEPT: BISITE
"RTN","BISITE4",122,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE4",123,0)
 D FULL^VALM1,TITLE^BIUTL5("ENABLE/DISABLE INPATIENT VISIT CHECK"),TEXT1
"RTN","BISITE4",124,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE4",125,0)
 S DIR(0)="SOA^E:Enable;D:Disable"
"RTN","BISITE4",126,0)
 S DIR("A")="     Please select either Enable or Disable: "
"RTN","BISITE4",127,0)
 S DIR("B")=$S($$INPTCHK^BIUTL2(BISITE):"Enable",1:"Disable")
"RTN","BISITE4",128,0)
 D ^DIR
"RTN","BISITE4",129,0)
 D:'$D(DIRUT)
"RTN","BISITE4",130,0)
 .N BIFLD,BIERR S BIFLD(.23)=Y
"RTN","BISITE4",131,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE4",132,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE4",133,0)
 D RESET^BISITE
"RTN","BISITE4",134,0)
 Q
"RTN","BISITE4",135,0)
 ;
"RTN","BISITE4",136,0)
 ;
"RTN","BISITE4",137,0)
 ;----------
"RTN","BISITE4",138,0)
TEXT1 ;EP
"RTN","BISITE4",139,0)
 ;;When an Immunization Visit or Skin Test Visit is stored, the default
"RTN","BISITE4",140,0)
 ;;Category of Visit is "Ambulatory" (Outpatient).
"RTN","BISITE4",141,0)
 ;;However, if the PIMS (Patient Information Management System) or
"RTN","BISITE4",142,0)
 ;;various Billing applications are in use, the patient may have the
"RTN","BISITE4",143,0)
 ;;Status of "Inpatient" at the time of the visit.
"RTN","BISITE4",144,0)
 ;;
"RTN","BISITE4",145,0)
 ;;In order to avoid conflicts that might arise from Inpatient and
"RTN","BISITE4",146,0)
 ;;Ambulatory Visits being listed for the same day, this software
"RTN","BISITE4",147,0)
 ;;can check the Inpatient Status of the patient at the time of the
"RTN","BISITE4",148,0)
 ;;immunization or skin test.  If the patient is listed as an Inpatient
"RTN","BISITE4",149,0)
 ;;at the time of the immunization, the software can automatically
"RTN","BISITE4",150,0)
 ;;change the Category from Ambulatory to Inpatient for the immunization.
"RTN","BISITE4",151,0)
 ;;
"RTN","BISITE4",152,0)
 ;;This feature is turned on by setting "Inpatient Visit Check" to ENABLE.
"RTN","BISITE4",153,0)
 ;;If the "Inpatient Visit Check" feature is causing problems, however,
"RTN","BISITE4",154,0)
 ;;(such as conflicts with third-party Billing software), then set the
"RTN","BISITE4",155,0)
 ;;parameter to DISABLE and no Inpatient check will occur.
"RTN","BISITE4",156,0)
 ;;
"RTN","BISITE4",157,0)
 D PRINTX("TEXT1")
"RTN","BISITE4",158,0)
 Q
"RTN","BISITE4",159,0)
 ;
"RTN","BISITE4",160,0)
 ;
"RTN","BISITE4",161,0)
 ;
"RTN","BISITE4",162,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BISITE4",163,0)
 ;---> Update options to include Hep B.
"RTN","BISITE4",164,0)
 ;----------
"RTN","BISITE4",165,0)
RISKP ;EP
"RTN","BISITE4",166,0)
 ;---> Edit the parameter that determines whether the Risk Status
"RTN","BISITE4",167,0)
 ;---> for patients with regard to Flu and Pneumo should be checked
"RTN","BISITE4",168,0)
 ;---> (in the Visit files) when forecasting those vaccines.
"RTN","BISITE4",169,0)
 ;---> Called by Protocol BI SITE INPATIENT CHECK ENABLE.
"RTN","BISITE4",170,0)
 ;
"RTN","BISITE4",171,0)
 ; ZEXCEPT: BISITE
"RTN","BISITE4",172,0)
 ;
"RTN","BISITE4",173,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE4",174,0)
 D FULL^VALM1,TITLE^BIUTL5("ENABLE/DISABLE RISK FACTOR CHECKS"),TEXT2
"RTN","BISITE4",175,0)
 N BIERR,BIDFLT,BIDFLT1,BISEL,DIR,DIRUT,Y
"RTN","BISITE4",176,0)
 S BIDFLT=$$RISKP^BIUTL2(BISITE)
"RTN","BISITE4",177,0)
 S DIR(0)="SO^0:None;1:Hep B only;2:Pneumo only;3:Both"
"RTN","BISITE4",178,0)
 S DIR("A")="     High Risk option"
"RTN","BISITE4",179,0)
 D
"RTN","BISITE4",180,0)
 .I BIDFLT=1 S BIDFLT1="Hep B only" Q
"RTN","BISITE4",181,0)
 .I (BIDFLT=2)!(BIDFLT=23) S BIDFLT1="Pneumo only" Q
"RTN","BISITE4",182,0)
 .I (BIDFLT=12)!(BIDFLT=123) S BIDFLT1="Both" Q
"RTN","BISITE4",183,0)
 .S BIDFLT1="None"
"RTN","BISITE4",184,0)
 S DIR("B")=BIDFLT1
"RTN","BISITE4",185,0)
 D ^DIR
"RTN","BISITE4",186,0)
 I $D(DIRUT) D RESET^BISITE Q
"RTN","BISITE4",187,0)
 ;---> Save user selection.
"RTN","BISITE4",188,0)
 S BISEL=Y S:Y=3 BISEL=12
"RTN","BISITE4",189,0)
 ;
"RTN","BISITE4",190,0)
 ;---> Ask for current smokers.
"RTN","BISITE4",191,0)
 ; Don't ask for smokers on VISTA. WHY?
"RTN","BISITE4",192,0)
 ; In VISTA, it's very close to impossible (today) to identify smokers.
"RTN","BISITE4",193,0)
 ; I will beg again for an API to determine smokers in VISTA.
"RTN","BISITE4",194,0)
 ;
"RTN","BISITE4",195,0)
 N BISMOK S BISMOK=0
"RTN","BISITE4",196,0)
 I $$RPMS^BIUTL9(),BISEL[2 D  ; only ask for smokers on RPMS
"RTN","BISITE4",197,0)
 .D FULL^VALM1,TITLE^BIUTL5("INCLUDE SMOKING AS A PNEUMO RISK FACTOR"),TEXT21
"RTN","BISITE4",198,0)
 .W !!,"     Do you wish to include a history of SMOKING in the criteria for"
"RTN","BISITE4",199,0)
 .W !,"     the High Risk Pneumo group?",!
"RTN","BISITE4",200,0)
 .S DIR("?",1)="     Enter YES to include SMOKING as a Pneumo High Risk Factor, "
"RTN","BISITE4",201,0)
 .S DIR("?")="     enter NO to disregard it as a High Risk Factor."
"RTN","BISITE4",202,0)
 .S DIR(0)="Y",DIR("A")="     Enter Yes or No"
"RTN","BISITE4",203,0)
 .S DIR("B")=$S(BIDFLT[3:"YES",1:"NO")
"RTN","BISITE4",204,0)
 .D ^DIR
"RTN","BISITE4",205,0)
 .I Y S BISMOK=1
"RTN","BISITE4",206,0)
 E  ; Phantom else for VISTA!
"RTN","BISITE4",207,0)
 Q:$D(DIRUT)
"RTN","BISITE4",208,0)
 D
"RTN","BISITE4",209,0)
 .I BISEL<2 Q
"RTN","BISITE4",210,0)
 .I (BISEL=2)&(BISMOK=0) Q
"RTN","BISITE4",211,0)
 .I (BISEL=2)&(BISMOK=1) S BISEL=23 Q
"RTN","BISITE4",212,0)
 .I (BISEL=12)&(BISMOK=0) Q
"RTN","BISITE4",213,0)
 .I (BISEL=12)&(BISMOK=1) S BISEL=123 Q
"RTN","BISITE4",214,0)
 ;
"RTN","BISITE4",215,0)
 N BIFLD,BIERR S BIFLD(.19)=BISEL
"RTN","BISITE4",216,0)
 D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE4",217,0)
 I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE4",218,0)
 ;
"RTN","BISITE4",219,0)
 D RESET^BISITE
"RTN","BISITE4",220,0)
 Q
"RTN","BISITE4",221,0)
 ;**********
"RTN","BISITE4",222,0)
 ;
"RTN","BISITE4",223,0)
 ;
"RTN","BISITE4",224,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BISITE4",225,0)
 ;---> Update Help TEXT2 to no longer include influenza.
"RTN","BISITE4",226,0)
 ;
"RTN","BISITE4",227,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BISITE4",228,0)
 ;---> Update Help TEXT2 to include Hep B.
"RTN","BISITE4",229,0)
 ;----------
"RTN","BISITE4",230,0)
TEXT2 ;EP
"RTN","BISITE4",231,0)
 ;;When forecasting immunizations for a patient, this program is able
"RTN","BISITE4",232,0)
 ;;to look at the patient's medical history of visits and attempt to
"RTN","BISITE4",233,0)
 ;;determine if the patient has an increased risk for pneumococcal disease
"RTN","BISITE4",234,0)
 ;;and/or Hepatitis B due to Diabetes.  If the patient fits the High Risk
"RTN","BISITE4",235,0)
 ;;criteria, the program will forecast the patient as due for those
"RTN","BISITE4",236,0)
 ;;immunizations.
"RTN","BISITE4",237,0)
 ;;
"RTN","BISITE4",238,0)
 ;;This parameter allows you to select which, if any, High Risk forecasting
"RTN","BISITE4",239,0)
 ;;should be enabled on your system.
"RTN","BISITE4",240,0)
 D PRINTX("TEXT2")
"RTN","BISITE4",241,0)
 Q
"RTN","BISITE4",242,0)
 ;**********
"RTN","BISITE4",243,0)
 ;
"RTN","BISITE4",244,0)
 ;
"RTN","BISITE4",245,0)
 ;----------
"RTN","BISITE4",246,0)
TEXT21 ;EP
"RTN","BISITE4",247,0)
 ;;You have the option to include smoking in the High Risk factors for
"RTN","BISITE4",248,0)
 ;;Pneumococcal disease.  Specifically, the Health Factors looked for will
"RTN","BISITE4",249,0)
 ;;be either "Current Smoker" or "Current Smoker and Smokeless" within
"RTN","BISITE4",250,0)
 ;;the last two years.
"RTN","BISITE4",251,0)
 ;;
"RTN","BISITE4",252,0)
 D PRINTX("TEXT21")
"RTN","BISITE4",253,0)
 Q
"RTN","BISITE4",254,0)
 ;
"RTN","BISITE4",255,0)
 ;
"RTN","BISITE4",256,0)
 ;----------
"RTN","BISITE4",257,0)
IMPCPT ;EP
"RTN","BISITE4",258,0)
 ;---> Edit the parameter that determines whether the CPT-coded Visits
"RTN","BISITE4",259,0)
 ;---> should be imported into the V Immunization File if they have
"RTN","BISITE4",260,0)
 ;---> not already been entered.
"RTN","BISITE4",261,0)
 ;---> Called by Protocol BI SITE CPT VISITS IMPORT.
"RTN","BISITE4",262,0)
 ;
"RTN","BISITE4",263,0)
 ; ZEXCEPT: BISITE
"RTN","BISITE4",264,0)
 ;
"RTN","BISITE4",265,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE4",266,0)
 D FULL^VALM1,TITLE^BIUTL5("ENABLE/DISABLE IMPORT OF CPT-CODED VISITS"),TEXT3
"RTN","BISITE4",267,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE4",268,0)
 S DIR(0)="SOA^E:Enable;D:Disable"
"RTN","BISITE4",269,0)
 S DIR("A")="     Please select either Enable or Disable: "
"RTN","BISITE4",270,0)
 S DIR("B")=$S($$IMPCPT^BIUTL2(BISITE):"Enable",1:"Disable")
"RTN","BISITE4",271,0)
 D ^DIR
"RTN","BISITE4",272,0)
 D:'$D(DIRUT)
"RTN","BISITE4",273,0)
 .N BIFLD,BIERR S BIFLD(.2)=$G(Y)
"RTN","BISITE4",274,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE4",275,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE4",276,0)
 D RESET^BISITE
"RTN","BISITE4",277,0)
 Q
"RTN","BISITE4",278,0)
 ;
"RTN","BISITE4",279,0)
 ;
"RTN","BISITE4",280,0)
 ;----------
"RTN","BISITE4",281,0)
TEXT3 ;EP
"RTN","BISITE4",282,0)
 ;;It is possible for some immunizations to be entered by
"RTN","BISITE4",283,0)
 ;;CPT Code into the CPT Visit File, rather than into the true
"RTN","BISITE4",284,0)
 ;;Immunization Visit File.  These "CPT-coded immunizations"
"RTN","BISITE4",285,0)
 ;;do NOT appear on the patient's Immunization Profile, nor are
"RTN","BISITE4",286,0)
 ;;they always included in the Immunization Package Reports.
"RTN","BISITE4",287,0)
 ;;
"RTN","BISITE4",288,0)
 ;;When the "Import CPT-coded Visits" site parameter is enabled,
"RTN","BISITE4",289,0)
 ;;those immunizations that are entered only as CPT Visits will be
"RTN","BISITE4",290,0)
 ;;checked and automatically entered into the proper Immunization
"RTN","BISITE4",291,0)
 ;;Visits File if they do not already exist there.
"RTN","BISITE4",292,0)
 ;;
"RTN","BISITE4",293,0)
 ;;If this parameter is disabled, the program will make no attempt
"RTN","BISITE4",294,0)
 ;;to bring CPT-coded Visits into the Immunization files.
"RTN","BISITE4",295,0)
 ;;
"RTN","BISITE4",296,0)
 D PRINTX("TEXT3")
"RTN","BISITE4",297,0)
 Q
"RTN","BISITE4",298,0)
 ;
"RTN","BISITE4",299,0)
 ;
"RTN","BISITE4",300,0)
 ;----------
"RTN","BISITE4",301,0)
VISMNU ;EP
"RTN","BISITE4",302,0)
 ;---> Edit the parameter that determines whether the Risk Status
"RTN","BISITE4",303,0)
 ;---> for patients with regard to Flu and Pneumo should be checked
"RTN","BISITE4",304,0)
 ;---> (in the Visit files) when forecasting those vaccines.
"RTN","BISITE4",305,0)
 ;---> Called by Protocol BI SITE INPATIENT CHECK ENABLE.
"RTN","BISITE4",306,0)
 ;
"RTN","BISITE4",307,0)
 ; ZEXCEPT: BISITE
"RTN","BISITE4",308,0)
 ;
"RTN","BISITE4",309,0)
 Q:$$BISITE^BISITE2
"RTN","BISITE4",310,0)
 D FULL^VALM1,TITLE^BIUTL5("ENABLE/DISABLE VISIT SELECTION MENU"),TEXT4
"RTN","BISITE4",311,0)
 N BIDFLT,DIR,DIRUT,Y
"RTN","BISITE4",312,0)
 S DIR(0)="SOA^E:Enable;D:Disable"
"RTN","BISITE4",313,0)
 S DIR("A")="     Please select either Enable or Disable: "
"RTN","BISITE4",314,0)
 S DIR("B")=$S($$VISMNU^BIUTL2(BISITE):"Enable",1:"Disable")
"RTN","BISITE4",315,0)
 D ^DIR
"RTN","BISITE4",316,0)
 D:'$D(DIRUT)
"RTN","BISITE4",317,0)
 .N BIFLD,BIERR S BIFLD(.28)=$G(Y)
"RTN","BISITE4",318,0)
 .D FDIE^BIFMAN(9002084.02,BISITE,.BIFLD,.BIERR,1)
"RTN","BISITE4",319,0)
 .I BIERR]"" W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BISITE4",320,0)
 D RESET^BISITE
"RTN","BISITE4",321,0)
 Q
"RTN","BISITE4",322,0)
 ;
"RTN","BISITE4",323,0)
 ;
"RTN","BISITE4",324,0)
 ;----------
"RTN","BISITE4",325,0)
TEXT4 ;EP
"RTN","BISITE4",326,0)
 ;;When adding or editing immunizations, this program will either
"RTN","BISITE4",327,0)
 ;;create a NEW Visit or link the immunization to an EXISTING Visit.
"RTN","BISITE4",328,0)
 ;;This process can be occur automatically, or it can be controlled
"RTN","BISITE4",329,0)
 ;;by the user at the time the immunization is being entered.
"RTN","BISITE4",330,0)
 ;;
"RTN","BISITE4",331,0)
 ;;If the Visit Selection Menu is DISABLED, the program will look for
"RTN","BISITE4",332,0)
 ;;similar Visits for the patient on that day and attempt to link with
"RTN","BISITE4",333,0)
 ;;one if enough information matches.  If no such Visits exist, a new
"RTN","BISITE4",334,0)
 ;;Visit will be created automatically.  (This can sometimes lead to
"RTN","BISITE4",335,0)
 ;;Visits that are incorrectly linked and must be corrected manually.)
"RTN","BISITE4",336,0)
 ;;
"RTN","BISITE4",337,0)
 ;;If the Visit Selection Menu is ENABLED, the program will look for
"RTN","BISITE4",338,0)
 ;;similar Visits--and if any exist--a Visit Selection Menu will pop up.
"RTN","BISITE4",339,0)
 ;;The Visit Selection Menu will allow the user to either create a new
"RTN","BISITE4",340,0)
 ;;Visit or select from existing Visits for that day.  (If there are no
"RTN","BISITE4",341,0)
 ;;existing Visits, a new Visit will be created automatically.)
"RTN","BISITE4",342,0)
 ;;
"RTN","BISITE4",343,0)
 D PRINTX("TEXT4")
"RTN","BISITE4",344,0)
 Q
"RTN","BISITE4",345,0)
 ;
"RTN","BISITE4",346,0)
 ;
"RTN","BISITE4",347,0)
 ;----------
"RTN","BISITE4",348,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BISITE4",349,0)
 Q:$G(BILINL)=""
"RTN","BISITE4",350,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BISITE4",351,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BISITE4",352,0)
 Q
"RTN","BITEST")
0^140^B2092544
"RTN","BITEST",1,0)
BITEST ;IHS/CMI/MWR - TEST SPEED OF FORECASTING.; MAY 10, 2010
"RTN","BITEST",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BITEST",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITEST",4,0)
 ;;  TEST SPEED OF IMMSERVE FORECASTING.
"RTN","BITEST",5,0)
 ;
"RTN","BITEST",6,0)
 ;
"RTN","BITEST",7,0)
 ;----------
"RTN","BITEST",8,0)
BEGIN ;EP
"RTN","BITEST",9,0)
 N BIERR,BIFORC,BIHX,BIPROF,BITTTB,BITTTE
"RTN","BITEST",10,0)
 ;
"RTN","BITEST",11,0)
 ;---> Build a sample Immunization History.
"RTN","BITEST",12,0)
 S BIHX="0^12172005^0^0^0^0^0^0^R^I^I^1^1^1^1^1^1^1^1^0^1^1^1^IHS_10^0^0"
"RTN","BITEST",13,0)
 S BIHX=BIHX_"^HOGU,SYLVIA  Chart#: 00-00-20^20^09202003^U"
"RTN","BITEST",14,0)
 S BIHX=BIHX_"^0^0^0^0^0^0^0^0^0^0^0^1^0^0^0^0^0^5^2022^49^0^0^0"
"RTN","BITEST",15,0)
 S BIHX=BIHX_"^09212003^0^2085^3^0^0^0^01012004^0^2033^3^0^0^0"
"RTN","BITEST",16,0)
 S BIHX=BIHX_"^01012004^0^2033^3^0^0^0^10112005^0^2086^83^0^0^0^01012004"
"RTN","BITEST",17,0)
 S BIHX=BIHX_"^0^2084^50^0^0^0^01012004^0^"
"RTN","BITEST",18,0)
 ;
"RTN","BITEST",19,0)
 ;
"RTN","BITEST",20,0)
 ;---> Ensure correct call to $$DEL^%ZISH.
"RTN","BITEST",21,0)
 N X S X=$E("BIXQY0",3,6) I '$D(@X) N @X S @X="A"
"RTN","BITEST",22,0)
 ;
"RTN","BITEST",23,0)
 ;---> Multiple calls to ImmServe and get Forecast and Profile.
"RTN","BITEST",24,0)
 W !!," Begin..."
"RTN","BITEST",25,0)
 N BISTART S BISTART=$H,BISTART=$P(BISTART,",",2)
"RTN","BITEST",26,0)
 N I
"RTN","BITEST",27,0)
 F I=1:1:1000 D
"RTN","BITEST",28,0)
 .D RUN^BIXCALL(BIHX,.BIPROF,.BIFORC,.BIERR)
"RTN","BITEST",29,0)
 ;
"RTN","BITEST",30,0)
 ;---> Report Total Time.
"RTN","BITEST",31,0)
 W !," Seconds: ",$P($H,",",2)-BISTART
"RTN","BITEST",32,0)
 Q
"RTN","BITN")
0^141^B169851237
"RTN","BITN",1,0)
BITN ;IHS/CMI/MWR - BUILD ^BITN GLOBAL.
"RTN","BITN",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BITN",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITN",4,0)
 ;;  UTILITY: BUILD STANDARD ^BITN GLOBAL.
"RTN","BITN",5,0)
 ;
"RTN","BITN",6,0)
 ;
"RTN","BITN",7,0)
 ;----------
"RTN","BITN",8,0)
START ;EP
"RTN","BITN",9,0)
 D KGBL^BIUTL8("^BITN")
"RTN","BITN",10,0)
 S ^BITN(0)="BI IMMUNIZATION TABLE HL7 STANDARD^9002084.94I"
"RTN","BITN",11,0)
 N I,X,Y,Z
"RTN","BITN",12,0)
 F I=1:2 S X=$T(@"TABLE"+I) Q:X'[";;"  D
"RTN","BITN",13,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BITN",14,0)
 .S ^BITN(Y,0)=Z
"RTN","BITN",15,0)
 .S X=$T(@"TABLE"+(I+1)),Z=$P(X,";;",3),^BITN(Y,1)=Z
"RTN","BITN",16,0)
 ;
"RTN","BITN",17,0)
 F I=1:2 S X=$T(@"TABLE"+I^BITN2) Q:X'[";;"  D
"RTN","BITN",18,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BITN",19,0)
 .S ^BITN(Y,0)=Z
"RTN","BITN",20,0)
 .S X=$T(@"TABLE"+(I+1)^BITN2),Z=$P(X,";;",3),^BITN(Y,1)=Z
"RTN","BITN",21,0)
 ;
"RTN","BITN",22,0)
 N DIK S DIK="^BITN(" D IXALL^DIK
"RTN","BITN",23,0)
 Q
"RTN","BITN",24,0)
 ;
"RTN","BITN",25,0)
 ;
"RTN","BITN",26,0)
 ;----------
"RTN","BITN",27,0)
TABLE ; EP
"RTN","BITN",28,0)
 ;;101;;SMALLPOX^SMALLPOX^75^^^^1^^12^^^^3070831^V04.1^99.42^0^1^.5^^^^
"RTN","BITN",29,0)
 ;;101a;;^^^^^^^^^^^^^Smallpox vaccine
"RTN","BITN",30,0)
 ;;102;;TD (ADULT)^Td-ADULT^9^^^^0^^8^TD-ADULT^90718^9,28,35,112,113,115,138,139,142^3140204^V06.5^99.38^0^1^.5^^^
"RTN","BITN",31,0)
 ;;102a;;Tetanus and Diphtheria Toxoids^54^^^^^^^^^^^^Tetanus and Diphtheria Toxoids, adsorbed for adult use
"RTN","BITN",32,0)
 ;;103;;DTP^DTP^1^^8^^1^^1^^90701^^^V06.1^99.39^0^1^.5^^^^
"RTN","BITN",33,0)
 ;;103a;;Diphtheria and Tetanus Toxoids^54^Tri-Immunol^63^^^^^^^^^^Diphtheria, tetanus toxoids and pertussis vaccine
"RTN","BITN",34,0)
 ;;104;;TETANUS TOXOID^TET TOX^35^^^^0^^1^^90703^9,28,35,112,113,115,138,139,142^3140204^V03.7^99.38^0^1^.5^^^
"RTN","BITN",35,0)
 ;;104a;;Tetanus Toxoids USP For Booste^54^Tetanus Toxoid USP^63^^^^^^^^^^Tetanus Toxoid
"RTN","BITN",36,0)
 ;;105;;TYPHOID, NOS^TYPH,NOS^91^^^^1^^12^^90714^^^V03.1^99.32^0^1^.5^^^
"RTN","BITN",37,0)
 ;;105a;;^^^^^^^^^^^^^Typhoid vaccine, NOS
"RTN","BITN",38,0)
 ;;106;;OPV^OPV^2^^8^^1^^2^SABIN^90712^^^V04.0^99.41^1^1^.5^^^^
"RTN","BITN",39,0)
 ;;106a;;Orimune^63^^^^^^^^^^^^Poliovirus vaccine, live, oral
"RTN","BITN",40,0)
 ;;107;;IPV^IPV^10^^7^^0^^2^SALK^90713^110^3141022^V04.0^99.41^0^1^.5^^^^
"RTN","BITN",41,0)
 ;;107a;;IPOL^54^^^^^^^^^^^^Poliovirus vaccine, inactivated
"RTN","BITN",42,0)
 ;;108;;INFLUENZA, NOS^FLU,NOS^88^^^^1^^10^^90724^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^^V04.8^99.52^0^1^.5^^^^
"RTN","BITN",43,0)
 ;;108a;;^^^^^^^^^^^^^Influenza virus vaccine, NOS
"RTN","BITN",44,0)
 ;;110;;HEP B, NOS^HEP B,NOS^45^^6^^1^^4^RECOMBIVAX^90731^8,43,44,51,110,104^^V05.3^99.59^0^1^.5^^^^
"RTN","BITN",45,0)
 ;;110a;;Hepagene^56^^^^^^^^^^^^Hepatitis B vaccine, NOS
"RTN","BITN",46,0)
 ;;111;;MEASLES^MEASLES^5^^3^^1^^6^^90705^3,4,94^^V04.2^99.45^0^1^.5^^^^
"RTN","BITN",47,0)
 ;;111a;;ATTENUVAX^45^^^^^^^^^^^^Measles virus vaccine
"RTN","BITN",48,0)
 ;;113;;CHOLERA^CHOLERA^26^^^^1^^12^^90725^^^V03.0^99.31^0^0^.5^^^^
"RTN","BITN",49,0)
 ;;113a;;Generic-Intramuscular^63^^^^^^^^^^^^Cholera vaccine, intramuscular
"RTN","BITN",50,0)
 ;;114;;RUBELLA^RUBELLA^6^^3^^1^^6^^90706^3,4,94,38^^V04.3^99.47^0^1^.5^^^^
"RTN","BITN",51,0)
 ;;114a;;MERUVAX II^45^^^^^^^^^^^^Rubella Virus vaccine
"RTN","BITN",52,0)
 ;;115;;MUMPS^MUMPS^7^^3^^1^^6^^90704^7,94,38^^V04.6^99.46^0^0^.5^^^^
"RTN","BITN",53,0)
 ;;115a;;MUMPSVAX^45^^^^^^^^^^^^Mumps Virus vaccine
"RTN","BITN",54,0)
 ;;116;;BCG^BCG^19^^^^1^^12^^90728^^^V03.2^99.33^1^1^.5^^^^
"RTN","BITN",55,0)
 ;;116a;;Tice BCG^51^Mycobax^54^^^^^^^^^^Bacillus Calmette-Guerin vaccine^90585
"RTN","BITN",56,0)
 ;;117;;MMR^MMR^3^^3^^0^^6^^90707^4,5,6,7,94,38^3120420^V06.4^99.48^0^1^.5^^^^
"RTN","BITN",57,0)
 ;;117a;;M-M-R II^45^^^^^^^^^^^^Measles, Mumps, and Rubella virus vaccine
"RTN","BITN",58,0)
 ;;118;;M/R^MR^4^^3^^1^^6^^90708^3,5,6,94,38^^V04.2^99.59^0^1^.5^^^^
"RTN","BITN",59,0)
 ;;118a;;M-R-VAX II^45^^^^^^^^^^^^Measles and Rubella virus vaccine
"RTN","BITN",60,0)
 ;;119;;PNEUMOCOCCAL^PNEUMO-PS^33^^^^0^^11^^90732^33,100,109,133^3091006^V03.82^99.55^0^1^.5^^^^
"RTN","BITN",61,0)
 ;;119a;;PNEUMOVAX 23^45^PNU-IMUNE 23^63^PPV23^^^^^^^^^Pneumococcal polysaccharide PPV23
"RTN","BITN",62,0)
 ;;120;;YELLOW FEVER^YELLOW FEV^37^^^^0^^12^^90717^^3110330^V04.4^99.43^0^1^.5^^^
"RTN","BITN",63,0)
 ;;120a;;YF-VAX^54^^^^^^^^^^^^Yellow Fever Vaccine
"RTN","BITN",64,0)
 ;;122;;RABIES, NOS^RABIES,NOS^90^^^^1^^12^^90726^^^V04.5^99.44^0^1^.5^^^^
"RTN","BITN",65,0)
 ;;122a;;^^^^^^^^^^^^^Rabies vaccine, NOS
"RTN","BITN",66,0)
 ;;123;;DT (PEDIATRIC)^DT-PEDS^28^^8^^0^^1^^90702^9,28,35,112,113,115,138,139,142^3141022^V06.5^99.38^0^1^.5^^^^
"RTN","BITN",67,0)
 ;;123a;;Diphtheria and Tetanus Toxoids^40^^^^^^^^^^^^Diphtheria and tetanus toxoids adsorbed for pediatric use
"RTN","BITN",68,0)
 ;;124;;HIB, NOS^HIB,NOS^17^^6^^1^^3^^90737^46,47,48,49,51,110^^V03.81^99.59^0^1^.5^^^^
"RTN","BITN",69,0)
 ;;124a;;^^^^^^^^^^^^^Haemophilus influenza type b vaccine, conjugate NOS
"RTN","BITN",70,0)
 ;;126;;HIB (HBOC)^HIBTITER^47^^6^^0^^3^HIB,HBOC^90645^17,46,48,49^3141022^V03.81^99.59^0^1^.5^^^^
"RTN","BITN",71,0)
 ;;126a;;HibTITER^63^^^^^^^^^^^^Haemophilus influenza type b vaccine, HbOC
"RTN","BITN",72,0)
 ;;127;;HIB (PRP-OMP)^PEDVAXHIB^49^^5^^0^^3^HIB,PRPOMP^90647^17,46,47,48,51^3141022^V03.81^99.59^0^1^.5^^^^
"RTN","BITN",73,0)
 ;;127a;;PedvaxHIB^45^^^^^^^^^^^^Haemophilus influenza type b vaccine, PRP-OMP conjugate
"RTN","BITN",74,0)
 ;;128;;HIB (PRP-D)^PROHIBIT^46^^6^^1^^3^HIB,PRP-D^90646^17,47,48,49^3141022^V03.81^99.59^0^0^.5^^^^
"RTN","BITN",75,0)
 ;;128a;;ProHIBiT^54^^^^^^^^^^^^Haemophilus influenza type b vaccine, PRP-D conjugate
"RTN","BITN",76,0)
 ;;129;;HBIG^HBIG^30^^^^0^^5^^90371^^^V07.2^99.14^0^1^^^^^
"RTN","BITN",77,0)
 ;;129a;;Hepatitis B Immune Globulin (H^19^^^^^^^^^^^^Hepatitis B immune globulin
"RTN","BITN",78,0)
 ;;130;;IG, NOS^IG,NOS^14^^^^1^^12^^90741^^^V07.2^99.14^0^0^^^^^
"RTN","BITN",79,0)
 ;;130a;;^^^^^^^^^^^^^Immune globulin, NOS
"RTN","BITN",80,0)
 ;;131;;HEP A, NOS^HEP A,NOS^85^^3^^1^^9^^90730^52,83,84,31,104^^V05.3^99.59^0^1^.5^^^^^
"RTN","BITN",81,0)
 ;;131a;;^^^^^^^^^^^^^Hepatitis A vaccine, NOS
"RTN","BITN",82,0)
 ;;132;;VARICELLA^VARICELLA^21^^3^^0^^7^^90716^94,121^3080313^V05.4^99.59^0^1^.5^^^
"RTN","BITN",83,0)
 ;;132a;;VARIVAX^45^^^^^^^^^^^^Varicella virus vaccine
"RTN","BITN",84,0)
 ;;133;;DTAP^DTaP^20^^6^^0^^1^DTAP^90700^106,107,110,50^3141022^V06.1^99.39^0^1^.5^^^^
"RTN","BITN",85,0)
 ;;133a;;Tripedia^54^Infanrix^59^Acel-Imune^63^Certiva^24^^^^^^Diphtheria, tetanus toxoids and acellular pertussis vaccine
"RTN","BITN",86,0)
 ;;134;;MENINGOCOCCAL^MENING-PS^32^^^^0^^16^^90733^32,103,108,114,136,147,148^3111014^V03.89^99.59^0^1^.5^^^^
"RTN","BITN",87,0)
 ;;134a;;Menomume A/C/Y/W-135^54^^^^^^^^^^^^Meningococcal polysaccharide vaccine
"RTN","BITN",88,0)
 ;;135;;ROTAVIRUS TETRAVALENT^ROTA-4^74^^4^^1^^15^^^116,119,122^^V04.89^99.59^1^1^.5^^^^
"RTN","BITN",89,0)
 ;;135a;;ROTASHIELD^63^^^^^^^^^^^^Rotavirus vaccine, tetravalent, live, oral
"RTN","BITN",90,0)
 ;;136;;HIB (PRP-T)^ACTHIB^48^^6^^0^^3^HIB,PRP-T^90648^17,46,47,49^3141022^V03.81^99.59^0^1^.5^^^
"RTN","BITN",91,0)
 ;;136a;;ActHIB^54^OmniHIB^59^Hiberix^^^^^^^^^Haemophilus influenza type b vaccine, PRP-T conjugate
"RTN","BITN",92,0)
 ;;137;;UNKNOWN^OTHER^999^^^^1^^12^TEST^90749^^^^99.59^0^0^.5^^^
"RTN","BITN",93,0)
 ;;137a;;^^^^^^^^^^^^^Unknown vaccine or immune globulin
"RTN","BITN",94,0)
 ;;138;;HEP B, ADOLESCENT OR PEDIATRIC^HEP B PED^8^^6^^0^^4^^90744^43,44,45,51,110,42,104^3141022^V05.3^99.59^0^1^.5^^^
"RTN","BITN",95,0)
 ;;138a;;Recombivax HB pediatric formul^45^Engerix-B pediatric/adolescent^59^^^^^^^^^^Hepatitis B vaccine, pediatric or pediatric/adolescent dosage
"RTN","BITN",96,0)
 ;;139;;POLIO, NOS^POLIO,NOS^89^^^^1^^2^^^^^V04.0^99.41^0^1^.5^^^
"RTN","BITN",97,0)
 ;;139a;;^^^^^^^^^^^^^Polio, NOS
"RTN","BITN",98,0)
 ;;140;;LYME DISEASE^LYME^66^^^^1^^12^^90665^^^V03.89^99.59^1^1^.5^^^
"RTN","BITN",99,0)
 ;;140a;;LYMErix^59^^^^^^^^^^^^Lyme Disease Vaccine
"RTN","BITN",100,0)
 ;;141;;RSV-MAB^RSV-MAb^93^^^^0^^12^SYNAGIS^90378^71,93,145^^V07.2^99.14^0^1^^^^
"RTN","BITN",101,0)
 ;;141a;;Synagis^42^^^^^^^^^^^^Respiratory Syncytial virus monoclanal antibody (palivizumab), intramuscular
"RTN","BITN",102,0)
 ;;142;;Pneumococcal, PCV-7^PCV-7^100^^6^^1^^11^PCV7^90669^33,100,109,133^^V03.82^99.55^0^1^.5^^^
"RTN","BITN",103,0)
 ;;142a;;Prevnar 7^63^PREVNAR 7^^^^^^^^^^^pneumococcal conjugate vaccine, 7 valent
"RTN","BITN",104,0)
 ;;143;;MENINGOCOCCAL C CONJUGATE^MEN-C CONJ^103^^^^1^^16^^^32,103,108,114,136,147,148^^V03.89^99.59^0^1^.5^^^
"RTN","BITN",105,0)
 ;;143a;;^^^^^^^^^^^^^Meningococcal C conjugate vaccine
"RTN","BITN",106,0)
 ;;144;;HEP B,ADULT^HEP B ADLT^43^^6^^0^^4^^90746^8,42,44,45,104^3120202^V05.3^99.59^0^1^1^^^
"RTN","BITN",107,0)
 ;;144a;;Recombivax HB adult formulatio^45^Heptavax-B^45^Engerix-B adult dose^59^^^^^^^^Hepatitis B vaccine, adult dosage^90743
"RTN","BITN",108,0)
 ;;145;;PERTUSSIS^PERTUSSIS^11^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",109,0)
 ;;145a;;^^^^^^^^^^^^^Pertussis
"RTN","BITN",110,0)
 ;;146;;DIPHTHERIA ANTITOXIN^DIPHTHERIA^12^^^^1^^^^90296^^^^^0^1^.5^^
"RTN","BITN",111,0)
 ;;146a;;Diphtheria antitoxin^^^^^^^^^^^^^Diphtheria antitoxin
"RTN","BITN",112,0)
 ;;147;;TIG^TIG^13^^^^0^^^^90389^^^^^0^1^
"RTN","BITN",113,0)
 ;;147a;;^^^^^^^^^^^^^Tetanus immune globulin
"RTN","BITN",114,0)
 ;;148;;INFLUENZA, SPLIT [TIVhx] (INCL PURIFIED)^FLU-TIVhx^15^^^^1^^10^^90657^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^^^^0^1^.5
"RTN","BITN",115,0)
 ;;148a;;^^^^^^^^^^^^^Influenza virus vaccine, split virus (incl. Purified surface antigen)^90658
"RTN","BITN",116,0)
 ;;149;;INFLUENZA, WHOLE^FLU-WHOLE^16^^^^1^^10^^90659^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^^^^0^1^.5
"RTN","BITN",117,0)
 ;;149a;;^54^^^^^^^^^^^^Influenza virus vaccine, whole virus
"RTN","BITN",118,0)
 ;;150;;RABIES, INTRAMUSCULAR INJECTION^RABIES,IM^18^^^^0^^^^90675^^3091006^^^0^1^.5
"RTN","BITN",119,0)
 ;;150a;;RabAvert^29^Imovax Rabies^54^Rabies Vaccine Absorbed^44^^^^^^^^Rabies vaccine - for intramuscular injection
"RTN","BITN",120,0)
 ;;151;;DTP-HIB^DTP-HIB^22^^^^1^^14^^90720^^^^^0^1^.5^^^103^126
"RTN","BITN",121,0)
 ;;151a;;ActHIB/DTP^54^Tetramune^63^^^^^^^^^^DTP-Haemophilus influenza type b conjugate vaccine
"RTN","BITN",122,0)
 ;;152;;PLAGUE^PLAGUE^23^^^^1^^^^90727^^^^^0^0^.5
"RTN","BITN",123,0)
 ;;152a;;^^^^^^^^^^^^^Plague
"RTN","BITN",124,0)
 ;;153;;ANTHRAX^ANTHRAX^24^^^^1^^^^90581^^3100310^^^0^1^.5^^
"RTN","BITN",125,0)
 ;;153a;;Biothrax^44^^^^^^^^^^^^Anthrax vaccine
"RTN","BITN",126,0)
 ;;154;;TYPHOID, ORAL^TYPHOID,OR^25^^^^0^^^^90690^^3120529^^^0^1^.5
"RTN","BITN",127,0)
 ;;154a;;Vivotif Berna^27^^^^^^^^^^^^Typhoid vaccine, live, oral
"RTN","BITN",128,0)
 ;;155;;BOTULINUM ANTITOXIN^BOTULINUM^27^^^^1^^^^90287^^^^^0^1^.5^^
"RTN","BITN",129,0)
 ;;155a;;Botox^17^^^^^^^^^^^^Botulinum antitoxin
"RTN","BITN",130,0)
 ;;156;;CMVIG^CMVIG^29^^^^0^^^^90291^^^^^0^1^.5^^
"RTN","BITN",131,0)
 ;;156a;;CytoGam^40^^^^^^^^^^^^Cytomegalovirus immune globulin, intravenous
"RTN","BITN",132,0)
 ;;157;;HEP A, PEDIATRIC, NOS^HEP AP,NOS^31^^^^1^^9^^^83,84,85,52,104^^^^0^1^.5^^
"RTN","BITN",133,0)
 ;;157a;;^^^^^^^^^^^^^Hepatitis A vaccine, pediatric dosage NOS
"RTN","BITN",134,0)
 ;;158;;RIG^RIG^34^^^^0^^^^90376^^^^^0^0^.5
"RTN","BITN",135,0)
 ;;158a;;BayRab^25^IMOGRAM RABIES - HT^54^^^^^^^^^^Rabies immune globulin^90375
"RTN","BITN",136,0)
 ;;159;;VZIG^VZIG^36^^^^0^^^^90396^117^^^^0^0^
"RTN","BITN",137,0)
 ;;159a;;^^^^^^^^^^^^^Varicella zoster immune globulin
"RTN","BITN",138,0)
 ;;160;;RUBELLA/MUMPS^RUBELLA/MU^38^^^^1^^^^^6,3,4,94^^^^0^0^.5
"RTN","BITN",139,0)
 ;;160a;;BIAVAX II^45^^^^^^^^^^^^Rubella and Mumps virus vaccine
"RTN","BITN",140,0)
 ;;161;;JAPANESE ENCEPHALITIS^JAPANESE E^39^^^^1^^^^90735^^3140124^^^0^1^.5
"RTN","BITN",141,0)
 ;;161a;;JE-VAX^54^^^^^^^^^^^^Japanese Encephalitis virus vaccine
"RTN","BITN",142,0)
 ;;162;;RABIES, INTRADERMAL INJECTION^RABIES,ID^40^^^^0^^^^90676^^3091006^^^0^1^.5
"RTN","BITN",143,0)
 ;;162a;;Imovax Rabies I.D.^54^^^^^^^^^^^^Rabies vaccine, for intradermal injection
"RTN","BITN",144,0)
 ;;163;;TYPHOID, PARENTERAL^TYPHOID,PA^41^^^^1^^^^90692^^3120529^^^0^1^.5
"RTN","BITN",145,0)
 ;;163a;;Typhim Vi^54^^^^^^^^^^^^Typhoid vaccine, Parenteral; other than acetone killed, dried
"RTN","BITN",146,0)
 ;;164;;HEP B, ADOLESCENT/HIGH RISK INFA^HEP B ADOL^42^^^^1^^4^^90745^43,44,45,8,104^3120202^^^0^1^.5
"RTN","BITN",147,0)
 ;;164a;;Recombivax HB adolescent/high-^45^^^^^^^^^^^^Hepatitis B vaccine, adolescent/high risk infant dosage
"RTN","BITN",148,0)
 ;;165;;HEP B, DIALYSIS^HEP B DIAL^44^^^^1^^4^^90740^8,43,45,42,104^3120202^^^0^1^1
"RTN","BITN",149,0)
 ;;165a;;^^^^^^^^^^^^^Hepatitis B vaccine, dialysis patient dosage^90747
"RTN","BITN",150,0)
 ;;166;;DTAP-HIB^DTAP-HIB^50^^^^1^^14^^90721^20,106,107,110,46,47,48,49,17,51,120^3141022^^^0^1^.5^^^133^136
"RTN","BITN",151,0)
 ;;166a;;TriHIBit^54^^^^^^^^^^^^DTaP-Haemophilus influenza type b conjugate vaccine
"RTN","BITN",152,0)
 ;;167;;HIB-HEP B^COMVAX^51^^^^0^^14^^90748^46,47,48,8,42,43,44,45,49,17^3141022^^^0^1^.5^^^138^127
"RTN","BITN",153,0)
 ;;167a;;Comvax^45^^^^^^^^^^^^Haemophilus influenza type b vaccine conjugate and Hepatitis B vaccine
"RTN","BITN",154,0)
 ;;168;;HEP A, ADULT^HEP A ADLT^52^^^^0^^9^^90632^83,84,31,104,85^3111025^^^0^1^1
"RTN","BITN",155,0)
 ;;168a;;VAQTA adult formulation^45^Havrix 1440 ELU/1 mL^59^^^^^^^^^^Hepatitis A vaccine, adult dosage
"RTN","BITN",156,0)
 ;;169;;TYPHOID, PARENTERAL, AKD (U.S. M^TYPHOID,PM^53^^^^1^^^^90693^^3120529^^^0^1^.5
"RTN","BITN",157,0)
 ;;169a;;^^^^^^^^^^^^^Typhoid vaccine, Parenteral; acetone killed, dried (U.S. military)
"RTN","BITN",158,0)
 ;;170;;ADENOVIRUS, TYPE 4^ADENOVI,T4^54^^^^1^^^^90476^54,55,82,143^^^^0^0^.5
"RTN","BITN",159,0)
 ;;170a;;^^^^^^^^^^^^^Adenovirus vaccine, type 4, live, oral
"RTN","BITN",160,0)
 ;;171;;ADENOVIRUS, TYPE 7^ADENOVI,T7^55^^^^1^^^^90477^54,55,82,143^^^^0^0^.5^^
"RTN","BITN",161,0)
 ;;171a;;^^^^^^^^^^^^^Adenovirus vaccine, type 7, live, oral
"RTN","BITN",162,0)
 ;;172;;DENGUE FEVER^DENGUE FEV^56^^^^1^^^^^^^^^0^0^.5^^
"RTN","BITN",163,0)
 ;;172a;;^^^^^^^^^^^^^Dengue fever vaccine
"RTN","BITN",164,0)
 ;;173;;HANTAVIRUS^HANTAVIRUS^57^^^^1^^^^^^^^^0^0^.5^^
"RTN","BITN",165,0)
 ;;173a;;^^^^^^^^^^^^^Hantavirus vaccine
"RTN","BITN",166,0)
 ;;174;;HEP C^HEP C^58^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",167,0)
 ;;174a;;^^^^^^^^^^^^^Hepatitis C vaccine
"RTN","BITN",168,0)
 ;;175;;HEP E^HEP E^59^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",169,0)
 ;;175a;;^^^^^^^^^^^^^Hepatitis E vaccine
"RTN","BITN",170,0)
 ;;176;;HERPES SIMPLEX 2^HERPES SIM^60^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",171,0)
 ;;176a;;^^^^^^^^^^^^^Herpes simples virus, type 2 vaccine
"RTN","BITN",172,0)
 ;;177;;HIV^HIV^61^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",173,0)
 ;;177a;;^^^^^^^^^^^^^Human immunodeficiency virus vaccine
"RTN","BITN",174,0)
 ;;178;;HPV QUADRIVALENT^HPV-4^62^^^^0^^17^^90649^62,118,137^3130517^^^0^1^.5
"RTN","BITN",175,0)
 ;;178a;;Gardasil^^^^^^^^^^^^^Human papilloma virus vaccine
"RTN","BITN",176,0)
 ;;179;;JUNIN VIRUS^JUNIN VIRU^63^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",177,0)
 ;;179a;;^^^^^^^^^^^^^Junin virus vaccine
"RTN","BITN",178,0)
 ;;180;;LEISHMANIASIS^LEISHMANIA^64^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",179,0)
 ;;180a;;^^^^^^^^^^^^^Leishmaniasis vaccine
"RTN","BITN",180,0)
 ;;181;;LEPROSY^LEPROSY^65^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",181,0)
 ;;181a;;^^^^^^^^^^^^^Leprosy vaccine
"RTN","BITN",182,0)
 ;;182;;MALARIA^MALARIA^67^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",183,0)
 ;;182a;;^^^^^^^^^^^^^Malaria vaccine
"RTN","BITN",184,0)
 ;;183;;MELANOMA^MELANOMA^68^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",185,0)
 ;;183a;;^^^^^^^^^^^^^Melanoma vaccine
"RTN","BITN",186,0)
 ;;184;;PARAINFLUENZA-3^PARAINFLUE^69^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",187,0)
 ;;184a;;^^^^^^^^^^^^^Parinfluenza - 3 virus vaccine
"RTN","BITN",188,0)
 ;;185;;Q FEVER^Q FEVER^70^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",189,0)
 ;;185a;;^^^^^^^^^^^^^Q Fever vaccine
"RTN","BITN",190,0)
 ;;186;;RSV-IGIV ^RSV-IGIV ^71^^^^1^^^^90379^71,93,145^^^^0^1^
"RTN","BITN",191,0)
 ;;186a;;RespiGam^42^^^^^^^^^^^^Respiratory Syncytial virus immune globulin, intravenous
"RTN","BITN",192,0)
 ;;187;;RHEUMATIC FEVER^RHEUMATIC ^72^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",193,0)
 ;;187a;;^^^^^^^^^^^^^Rheumatic fever vaccine
"RTN","BITN",194,0)
 ;;188;;RIFT VALLEY FEVER^RIFT VALLE^73^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",195,0)
 ;;188a;;^^^^^^^^^^^^^Rift Valley Fever vaccine
"RTN","BITN",196,0)
 ;;189;;STAPHYLOCOCCUS BACTERIO LYSATE^STAPHYLOCO^76^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",197,0)
 ;;189a;;^^^^^^^^^^^^^Staphylococcus Bacterophage lysate
"RTN","BITN",198,0)
 ;;190;;TICK-BORNE ENCEPHALITIS^TICK-BORNE^77^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",199,0)
 ;;190a;;^^^^^^^^^^^^^Tick-borne enchephalitis vaccine
"RTN","BITN",200,0)
 ;;191;;TULAREMIA VACCINE^TULAREMIA ^78^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",201,0)
 ;;191a;;^^^^^^^^^^^^^Tularemia vaccine
"RTN","BITN",202,0)
 ;;192;;VACCINIA IMMUNE GLOBULIN^VACCINIA I^79^^^^1^^^^90393^^3070831^^^0^0^.5
"RTN","BITN",203,0)
 ;;192a;;^^^^^^^^^^^^^Vaccinia immune globulin
"RTN","BITN",204,0)
 ;;193;;VEE, LIVE^VEE, LIVE^80^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",205,0)
 ;;193a;;^^^^^^^^^^^^^Venezuelan equine enchapahlitis vaccine, live, attenuated
"RTN","BITN",206,0)
 ;;194;;VEE, INACTIVATED^VEE, INACT^81^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",207,0)
 ;;194a;;^^^^^^^^^^^^^Venezuelan equine enchapahlitis vaccine, inactivated
"RTN","BITN",208,0)
 ;;195;;ADENOVIRUS, NOS^ADENOV,NOS^82^^^^1^^^^^54,55,82,143^^^^0^0^.5^^
"RTN","BITN",209,0)
 ;;195a;;^^^^^^^^^^^^^Adenovirus vaccine, NOS
"RTN","BITN",210,0)
 ;;196;;HEP A, PED/ADOL, 2 DOSE^HEP A PED^83^^^^0^^9^^90633^52,84,31,85,104^3111025^^^0^1^.5^^
"RTN","BITN",211,0)
 ;;196a;;VAQTA pediatric/adolescent for^45^Havrix 720 ELU/0.5 mL^59^^^^^^^^^^Hepatitis A vaccine, pediatric/adolescent dosage, 2 dose schedule
"RTN","BITN",212,0)
 ;;197;;HEP A, PED/ADOL, 3 DOSE^HEP A 3PED^84^^^^1^^9^^90634^52,83,31,85,104^^^^0^1^.5^^
"RTN","BITN",213,0)
 ;;197a;;Havrix 360 ELU/0.5 mL^59^^^^^^^^^^^^Hepatitis A vaccine, pediatric/adolescent dosage, 3 dose schedule
"RTN","BITN",214,0)
 ;;198;;IG^IG^86^^^^^^^^90281^^^^^0^0^
"RTN","BITN",215,0)
 ;;198a;;^^^^^^^^^^^^^Immune globulin, intramuscular
"RTN","BITN",216,0)
 ;;199;;IGIV^IGIV^87^^^^0^^^^90283^^^^^0^0^
"RTN","BITN",217,0)
 ;;199a;;Gammar-P IV^21^Venoglobulin-S^19^^^^^^^^^^Immune globulin, intravenous
"RTN","BITN2")
0^142^B108426735
"RTN","BITN2",1,0)
BITN2 ;IHS/CMI/MWR - BUILD ^BITN GLOBAL.
"RTN","BITN2",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BITN2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITN2",4,0)
 ;;  UTILITY: BUILD STANDARD ^BITN GLOBAL.
"RTN","BITN2",5,0)
 ;
"RTN","BITN2",6,0)
 ;
"RTN","BITN2",7,0)
 ;----------
"RTN","BITN2",8,0)
TABLE ; EP
"RTN","BITN2",9,0)
 ;;200;;VEE, NOS^VEE,NOS^92^^^^1^^^^^^^^^0^0^.5
"RTN","BITN2",10,0)
 ;;200a;;^^^^^^^^^^^^^Venezuelan equine enchapahlitis vaccine, NOS
"RTN","BITN2",11,0)
 ;;201;;MMRV^MMRV^94^^^^0^^14^^90710^3,4,5,6,7,21,38,121^3100521^^^0^1^.5^^^117^132
"RTN","BITN2",12,0)
 ;;201a;;Pro-Quad^^^^^^^^^^^^^Measles, Mumps, Rubella, and Varicella virus vaccine
"RTN","BITN2",13,0)
 ;;202;;TST-OT TINE TEST^TST-OT TIN^95^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",14,0)
 ;;202a;;^^^^^^^^^^^^^Tuberculin skin test; old tuberculin, multipuncture device
"RTN","BITN2",15,0)
 ;;203;;TST-PPD INTRADERMAL^TST-PPD^96^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",16,0)
 ;;203a;;PPD^^^^^^^^^^^^^Tuberculin skin test; purified protein derivative, intradermal
"RTN","BITN2",17,0)
 ;;204;;TST-PPD TINE TEST^TST-PPD TI^97^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",18,0)
 ;;204a;;^^^^^^^^^^^^^Tuberculin skin test; purified proten derivative, multipuncture device
"RTN","BITN2",19,0)
 ;;205;;TST, NOS^TST,NOS^98^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",20,0)
 ;;205a;;^^^^^^^^^^^^^Tuberculin skin test; NOS
"RTN","BITN2",21,0)
 ;;206;;RESERVED - DO NOT USE3^RESERVED -^99^^^^1^^^^^^^^^0^0^.5
"RTN","BITN2",22,0)
 ;;206a;;^^^^^^^^^^^^^RESERVED -do not use
"RTN","BITN2",23,0)
 ;;207;;TYPHOID, VICPS^TYPHOID,VI^101^^^^1^^^^90691^^3120529^^^0^1^.5
"RTN","BITN2",24,0)
 ;;207a;;^^^^^^^^^^^^^Typhoid Vi capsular polysaccharide vaccine
"RTN","BITN2",25,0)
 ;;208;;DTP-HIB-HEP B^DTP-HIB-HE^102^^^^1^^14^^^^3080918^^^0^0^.5^^^103^136^138
"RTN","BITN2",26,0)
 ;;208a;;^^^^^^^^^^^^^DTP-Haemophilus influenzae type b conjugate and hepatitis b vaccine
"RTN","BITN2",27,0)
 ;;209;;HEP A-HEP B^TWINRIX^104^^^^0^^14^^90636^52,83,84,31,85,8,42,43,44,45,51,110^3120202^^^0^1^1^^^144^168
"RTN","BITN2",28,0)
 ;;209a;;Twinrix^59^^^^^^^^^^^^Hepatitis A and hepatitis B vaccine
"RTN","BITN2",29,0)
 ;;210;;SMALLPOX, DILUTED^SMALLPOX,D^105^^^^1^^^^^^3070831^^^0^1^.5
"RTN","BITN2",30,0)
 ;;210a;;^^^^^^^^^^^^^Smallpox vaccine, diluted
"RTN","BITN2",31,0)
 ;;211;;DTAP, 5 PERTUSSIS ANTIGENS^DTAP,5PE^106^^^^1^^1^^90700^20,107,110,50^3141022^^^0^1^.5^^
"RTN","BITN2",32,0)
 ;;211a;;Daptacel^54^^^^^^^^^^^^Diphtheria, tetanus toxoids and acellular pertussis vaccine, 5 pertussis antigens
"RTN","BITN2",33,0)
 ;;212;;DTAP, NOS^DTAP,NOS^107^^^^1^^1^^^20,106,110,50^^^^0^1^.5^^
"RTN","BITN2",34,0)
 ;;212a;;^^^^^^^^^^^^^Diphtheria, tetanus toxoids and acellular pertussis vaccine, NOS
"RTN","BITN2",35,0)
 ;;213;;MENINGOCOCCAL, NOS^MENING,NOS^108^^^^1^^16^^^32,103,108,114,136,147,148^^^^0^1^.5
"RTN","BITN2",36,0)
 ;;213a;;^^^^^^^^^^^^^Meningococcal vaccine, NOS
"RTN","BITN2",37,0)
 ;;214;;PNEUMOCOCCAL, NOS^PNEUMO,NOS^109^^^^1^^11^^^33,100,109,133^^^^0^1^.5
"RTN","BITN2",38,0)
 ;;214a;;^^^^^^^^^^^^^Pneumococcal vaccine, NOS
"RTN","BITN2",39,0)
 ;;215;;NO VACCINE ADMINISTERED^NO VACCINE^998^^^^1^^^^^^^^^0^0^.5
"RTN","BITN2",40,0)
 ;;215a;;^^^^^^^^^^^^^No vaccine administered
"RTN","BITN2",41,0)
 ;;216;;DTaP-Hep B-IPV^PEDIARIX^110^^^^0^^14^^90723^1,22,28,102,43,44,45,10,106,107,50,8,42,20^3141022^^^0^1^.5^^^138^107^133
"RTN","BITN2",42,0)
 ;;216a;;Pediarix^59^^^^^^^^^^^^DTap- hepatitis B and poliovirus vaccine
"RTN","BITN2",43,0)
 ;;217;;INFLUENZA, Intranasal, Trivalent^FLU-LAIV3^111^^^^1^0^10^^90660^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3120702^^^0^1^.2
"RTN","BITN2",44,0)
 ;;217a;;FluMist^42^^^^^^^^^^^^Influenza virus vaccine, live, attenuated, for intranasal use
"RTN","BITN2",45,0)
 ;;218;;TETANUS TOXOID, NOS^TETTOX,NOS^112^^^^1^^1^^^9,28,35,112,113,115,138,139,142^^^^^1^.5
"RTN","BITN2",46,0)
 ;;218a;;^^^^^^^^^^^^^TETANUS TOXOID, NOS
"RTN","BITN2",47,0)
 ;;219;;TD (ADULT) PRESERVATIVE FREE^Td-ADULTpf^113^^^^0^^8^^90714^9,28,35,112,113,115,138,139,142^3140204^^^0^1^.5
"RTN","BITN2",48,0)
 ;;219a;;^^^^^^^^^^^^^TD (ADULT) PRESERVATIVE FREE
"RTN","BITN2",49,0)
 ;;220;;MENINGOCOCCAL A,C,Y,W-135 DIPHTHERIA CONJ^MENING-CV4^114^^^^0^^16^^90734^32,103,108,114,136,147,148^3111014^^^^1^.5
"RTN","BITN2",50,0)
 ;;220a;;Menactra^^^^^^^^^^^^^MENINGOCOCCAL POLYSACCHARIDE (groups A, C, Y and W-135) diphtheria toxoid conj
"RTN","BITN2",51,0)
 ;;221;;Tdap^Tdap^115^^^^0^^8^^90715^9,28,35,112,113,115,138,139,142^3130519^V06.1^^^1^.5
"RTN","BITN2",52,0)
 ;;221a;;Boostrix^^Adacel^^^^^^^^^^^TETANUS TOXOID, REDUCED DIPHTHERIA, ACELL PERTUSSIS VACCINE, ABSORBED
"RTN","BITN2",53,0)
 ;;222;;ROTAVIRUS, PENTAVALENT^ROTA-5^116^^^^0^0^15^^90680^74,119,122^3130826^V04.89^^^1^2
"RTN","BITN2",54,0)
 ;;222a;;Rotateq^^^^^^^^^^^^^rotavirus, live, pentavalent vaccine
"RTN","BITN2",55,0)
 ;;223;;VZIG-IND^VZIG-IND^117^^^^1^0^7^^^36^^^^^1
"RTN","BITN2",56,0)
 ;;223a;;^^^^^^^^^^^^^varicella zoster immune globulin (Investigational New Drug)
"RTN","BITN2",57,0)
 ;;224;;HPV, bivalent^HPV-2^118^^^^0^0^17^^90650^62,118,137^3110503^^^^1^.5
"RTN","BITN2",58,0)
 ;;224a;;Cervarix^^^^^^^^^^^^^human papilloma virus vaccine, bivalent
"RTN","BITN2",59,0)
 ;;225;;ROTAVIRUS, MONOVALENT^ROTA-1^119^^^^0^0^15^^90681^74,116,122^3130826^V04.89^^^1
"RTN","BITN2",60,0)
 ;;225a;;Rotarix^^^^^^^^^^^^^rotavirus, live, monovalent vaccine
"RTN","BITN2",61,0)
 ;;226;;DTaP-Hib-IPV^PENTACEL^120^^^^1^0^14^^90698^01,10,17,20,22,46,47,48,49,50,51,102,106,107,110,120^3141022^^^^1^.5^^^133^136^107
"RTN","BITN2",62,0)
 ;;226a;;^^^^^^^^^^^^^DTaP-Hib-IPV
"RTN","BITN2",63,0)
 ;;227;;ZOSTER^ZOSTER^121^^^^0^0^7^^90736^21,94,117^3091006^^^^^.65
"RTN","BITN2",64,0)
 ;;227a;;Zostavax^^^^^^^^^^^^^zoster vaccine, live
"RTN","BITN2",65,0)
 ;;228;;ROTAVIRUS, NOS^ROTA,NOS^122^^^^1^0^15^^^74,116,119^^^^^1
"RTN","BITN2",66,0)
 ;;228a;;^^^^^^^^^^^^^rotavirus vaccine, NOS
"RTN","BITN2",67,0)
 ;;229;;INFLUENZA, H5N1^FLU-H5N1^123^^^^1^^10^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^^^^0^0^
"RTN","BITN2",68,0)
 ;;229a;;^^^^^^^^^^^^^Influenza virus vaccine, H5N1, A/Vietnam/1203/2004 (national stockpile)
"RTN","BITN2",69,0)
 ;;230;;DTaP-IPV^KINRIX^130^^^^0^0^14^^90696^10,110,20,50,106,107^3141022^^^^1^.5^^^133^107
"RTN","BITN2",70,0)
 ;;230a;;Kinrix^^^^^^^^^^^^^Diphtheria, tetanus toxoids and acellular pertussis, and poliovirus, inactivated
"RTN","BITN2",71,0)
 ;;231;;Novel Influenza-H1N1-09, Nasal^H1N1-NASAL^125^^^^1^0^18^SWINEFLU^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3091001^^^0^1^.2
"RTN","BITN2",72,0)
 ;;231a;;^^^^^^^^^^^^^Novel Influenza-H1N1-09, live virus for nasal administration
"RTN","BITN2",73,0)
 ;;232;;Novel influenza-H1N1-09, preservative-free^H1N1-pfree^126^^^^1^0^18^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3091001^^^0^1
"RTN","BITN2",74,0)
 ;;232a;;^^^^^^^^^^^^^Novel influenza-H1N1-09, preservative-free, injectable
"RTN","BITN2",75,0)
 ;;233;;Novel influenza-H1N1-09^H1N1^127^^^^1^0^18^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3091001^^^0^1^.5
"RTN","BITN2",76,0)
 ;;233a;;^^^^^^^^^^^^^Novel influenza-H1N1-09, injectable
"RTN","BITN2",77,0)
 ;;234;;Novel influenza-H1N1-09, all formulations^H1N1,NOS^128^^^^1^0^18^^90663^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^^^^0^1^.5
"RTN","BITN2",78,0)
 ;;234a;;^^^^^^^^^^^^^Novel influenza-H1N1-09, all formulations^90470
"RTN","BITN2",79,0)
 ;;235;;Pneumococcal, PCV-13^PCV-13^133^^^^0^0^11^PCV13^90670^33,100,109,133^3141022^^^0^1^.5
"RTN","BITN2",80,0)
 ;;235a;;Prevnar 13^^PREVNAR 13^^^^^^^^^^^pneumococcal conjugate vaccine, 13 valent
"RTN","BITN2",81,0)
 ;;236;;INFLUENZA, HIGH DOSE SEASONAL^FLU-HIGH^135^^^^0^0^10^^90662^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^^1^.5
"RTN","BITN2",82,0)
 ;;236a;;Fluzone High Dose^^^^^^^^^^^^^INFLUENZA, HIGH DOSE SEASONAL, PRESERVATIVE-FREE
"RTN","BITN2",83,0)
 ;;237;;Meningococcal MCV4O^MeningCV4O^136^^^^0^^16^^90734^32,103,108,114,136,147,148^3111014^^^0^1^.5
"RTN","BITN2",84,0)
 ;;237a;;Menveo^^^^^^^^^^^^^meningococcal oligosaccharide (groups A, C, Y and W-135) diphtheria toxoid conj
"RTN","BITN2",85,0)
 ;;238;;DTaP-IPV-HIB-HEP B, historical^DTaPIPVHHb^132^^^^1^^14^^^^^^^^^^^^133^107^124^110
"RTN","BITN2",86,0)
 ;;238a;;^^^^^^^^^^^^^DTaP-IPV-HIB-HEP B, historical
"RTN","BITN2",87,0)
 ;;239;;HPV,NOS^HPV,NOS^137^^^^1^0^17^^^62,118,137^^^^0^1^.5
"RTN","BITN2",88,0)
 ;;239a;;^^^^^^^^^^^^^HPV, unspecified formulation
"RTN","BITN2",89,0)
 ;;240;;Japanese Encephalitis-IM^JAPAN E IM^134^^^^1^^12^^90738^^3140124
"RTN","BITN2",90,0)
 ;;240a;;^^^^^^^^^^^^^Japanese Encephalitis vaccine for intramuscular administration.
"RTN","BITN2",91,0)
 ;;241;;Typhus, historical^TYPHUS,NOS^131^^^^1^^12
"RTN","BITN2",92,0)
 ;;241a;;^^^^^^^^^^^^^Historical record of a typhus vaccination
"RTN","BITN2",93,0)
 ;;242;;Influenza, seasonal, injectable, preservative free, trivalent ^FLU-IIV3pf^140^^^^0^0^10^^90655^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3130726^^^0^1^
"RTN","BITN2",94,0)
 ;;242a;;Fluzone^^Fluvirin^^^^^^^^^^^INFLUENZA, SEASONAL INJ, PRES. FREE^90656
"RTN","BITN2",95,0)
 ;;243;;INFLUENZA [TIV], SEASONAL, INJ^FLU-IIV3^141^^^^0^0^10^^90657^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^0^1^.5
"RTN","BITN2",96,0)
 ;;243a;;Fluzone^^Fluvirin ^^^^^^^^^^^INFLUENZA, SEASONAL INJECTABLE^90658
"RTN","BITN2",97,0)
 ;;244;;Td-NA^Td-NA^138^^^^1^0^8^^^9,28,35,112,113,115,138,139,142^3140204^^^0^1^.5
"RTN","BITN2",98,0)
 ;;244a;;^^^^^^^^^^^^^tetanus and diphtheria toxoids, not adsorbed, for adult use
"RTN","BITN2",99,0)
 ;;245;;Td,NOS^Td,NOS^139^^^^1^0^8^^^9,28,35,112,113,115,138,139,142^3140204^^^0^1^.5
"RTN","BITN2",100,0)
 ;;245a;;^^^^^^^^^^^^^Td(adult) unspecified formulation
"RTN","BITN2",101,0)
 ;;246;;TET TOX,NA^TET TOX,NA^142^^^^1^0^8^^^9,28,35,112,113,115,138,139,142^3140204^^^0^1
"RTN","BITN2",102,0)
 ;;246a;;^^^^^^^^^^^^^tetanus toxoid, not adsorbed
"RTN","BITN2",103,0)
 ;;247;;ADENOVIRUS, TYPES 4&7^ADENO,oral^143^^^^1^0^12^^^54,55,82,143^^^^0^1
"RTN","BITN2",104,0)
 ;;247a;;^^^^^^^^^^^^^Adenovirus, type 4 and type 7, live, oral
"RTN","BITN2",105,0)
 ;;248;;INFLUENZA, INTRADERMAL^FLU-DERMAL^144^^^^0^0^10^^90654^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^0^1^.1
"RTN","BITN2",106,0)
 ;;248a;;Fluzone Intradermal^^^^^^^^^^^^^seasonal influenza, intradermal, preservative free
"RTN","BITN2",107,0)
 ;;249;;RSV-MAb,M^RSV-MAb,M^145^^^^1^0^12^^^71,93,145^^^^0^1
"RTN","BITN2",108,0)
 ;;249a;;Motavizumab^^^^^^^^^^^^^respiratory syncytial virus monoclonal antibody (motavizumab), intramuscular
"RTN","BITN2",109,0)
 ;;250;;DTaP,IPV,Hib,HepB^DTaPPVHHb^146^^^^1^0^12^^^^
"RTN","BITN2",110,0)
 ;;250a;;^^^^^^^^^^^^^Diphtheria, Tetanus, Acell Pertussis Absorbed, Inactiv Polio, HIB Conj, Hep B
"RTN","BITN2",111,0)
 ;;251;;Meningococcal MCV4, unspecified form^MenCV4-NOS^147^^^^1^0^16^^^32,103,108,114,136,147,148^3111014^^^^1^.5
"RTN","BITN2",112,0)
 ;;251a;;^^^^^^^^^^^^^Meningococcal, MCV4, unspecified formulation(groups A, C, Y and W-135)
"RTN","BITN2",113,0)
 ;;252;;Meningococcal C/Y-HIB PRP^MenCY-Hib^148^^^^1^0^14^^90644^32,103,108,114,136,147,148^^^^0^1^.5^^^136^213
"RTN","BITN2",114,0)
 ;;252a;;MenHibrix^^^^^^^^^^^^^Meningococcal Groups C and Y and Haemophilus b Tetanus Toxoid Conjugate Vaccine
"RTN","BITN2",115,0)
 ;;253;;INFLUENZA, Live, Intranasal, Quadrivalent^FLU-LAIV4^149^^^^0^0^10^^90672^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^0^1^.2
"RTN","BITN2",116,0)
 ;;253a;;FluMist^^^^^^^^^^^^^Influenza, Live, Intranasal, Quadrivalent
"RTN","BITN2",117,0)
 ;;254;;INFLUENZA, INJECTABLE, QUAD, PF^FLU-IIV4pf^150^^^^1^0^10^^90685^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^^1
"RTN","BITN2",118,0)
 ;;254a;;^^^^^^^^^^^^^Influenza, injectable, quadrivalent, preservative free^90686
"RTN","BITN2",119,0)
 ;;255;;INFLUENZA NASAL, UNSPECIFIED^FLU-NasNOS^151^^^^1^0^10^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161
"RTN","BITN2",120,0)
 ;;255a;;FluMist^^^^^^^^^^^^^influenza nasal, unspecified formulation
"RTN","BITN2",121,0)
 ;;256;;Pneumococcal, Unspecified^PCV-NOS^152^^^^1^0^11
"RTN","BITN2",122,0)
 ;;256a;;^^^^^^^^^^^^^Pneumococcal Conjugate, unspecified formulation
"RTN","BITN2",123,0)
 ;;257;;INFLUENZA, INJECTABLE, MDCK, PF^FLU-ccIIV3^153^^^^1^0^10^^90661^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^^1
"RTN","BITN2",124,0)
 ;;257a;;Flucelvax^^^^^^^^^^^^^Influenza, injectable, Madin Darby Canine Kidney, preservative free
"RTN","BITN2",125,0)
 ;;258;;HEP A, IG^HEP A,IG^154^^^^1^0^9^^^^^^^^1
"RTN","BITN2",126,0)
 ;;258a;;^^^^^^^^^^^^^Hepatitis A immune globulin
"RTN","BITN2",127,0)
 ;;259;;INFLUENZA, INJECTABLE, RECOMB, PF^FLU-RIV3^155^^^^1^0^10^^90673^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819
"RTN","BITN2",128,0)
 ;;259a;;FluBlok^^^^^^^^^^^^^Seasonal, trivalent, recombinant, injectable influenza, preservative free
"RTN","BITN2",129,0)
 ;;260;;INFLUENZA, Injectable, Quadravalent^FLU-IIV4^158^^^^1^0^10^^90688^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^^1
"RTN","BITN2",130,0)
 ;;260a;;FluLaval Quadrivalent^^^^^^^^^^^^^Influenza, injectable, quadrivalent
"RTN","BITN2",131,0)
 ;;261;;Rho(D)-IG^Rho(D)-IG^156^^^^1^0^12
"RTN","BITN2",132,0)
 ;;261a;;^^^^^^^^^^^^^Rho(D) Immune globulin- IV or IM
"RTN","BITN2",133,0)
 ;;262;;Rho(D) -IG IM^Rho(D)IGIM^157^^^^1^^12
"RTN","BITN2",134,0)
 ;;262a;;^^^^^^^^^^^^^Rho(D) Immune globulin - IM
"RTN","BITN2",135,0)
 ;;263;;Rho(D) - Unspecified formulation^Rho(D),NOS^159^^^^1^^12
"RTN","BITN2",136,0)
 ;;263a;;^^^^^^^^^^^^^Rho(D) Unspecified formulation
"RTN","BITN2",137,0)
 ;;264;;Influenza A monovalent (H5N1), ADJUVANTED-2013^H5N1,adj^160^^^^1^0^10
"RTN","BITN2",138,0)
 ;;264a;;^^^^^^^^^^^^^Influenza A monovalent (H5N1), adjuvanted, National stockpile 2013
"RTN","BITN2",139,0)
 ;;265;;Influenza, injectable,quadrivalent, preservative free, pediatric^FLU-PEDIV4^161^^^^0^0^10^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^0^1^.25
"RTN","BITN2",140,0)
 ;;265a;;^^^^^^^^^^^^^Influenza, injectable,quadrivalent, preservative free, pediatric
"RTN","BITRS")
0^143^B3764707
"RTN","BITRS",1,0)
BITRS ;IHS/CMI/MWR - TRANSFORM X INTO REQD CASE; MAY 10, 2010
"RTN","BITRS",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BITRS",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITRS",4,0)
 ;;  UTILITY: TRANSFORMS X INTO MIXED CASE OR UPPERCASE.
"RTN","BITRS",5,0)
 ;
"RTN","BITRS",6,0)
 ;
"RTN","BITRS",7,0)
 ;----------
"RTN","BITRS",8,0)
T(X) ;EP
"RTN","BITRS",9,0)
 ;---> Translate word to mixed case.
"RTN","BITRS",10,0)
 ;
"RTN","BITRS",11,0)
 Q:"^ "[$G(X) X
"RTN","BITRS",12,0)
 N BIWORD,I
"RTN","BITRS",13,0)
 ;
"RTN","BITRS",14,0)
 ;---> Remove leading inappropriate characters if present.
"RTN","BITRS",15,0)
 F  Q:$E(X)'?1P  S X=$E(X,2,99)
"RTN","BITRS",16,0)
 ;
"RTN","BITRS",17,0)
 ;---> Change first letter to uppercase.
"RTN","BITRS",18,0)
 S BIWORD=$E(X)
"RTN","BITRS",19,0)
 I BIWORD?1L S BIWORD=$C($A($E(BIWORD))-32)
"RTN","BITRS",20,0)
 ;
"RTN","BITRS",21,0)
 ;---> Do following characters.
"RTN","BITRS",22,0)
 F I=2:1:$L(X) D CHAR
"RTN","BITRS",23,0)
 ;
"RTN","BITRS",24,0)
 ;
"RTN","BITRS",25,0)
 ;---> Remove trailing space or quote.
"RTN","BITRS",26,0)
 ;F  Q:""" "'[$E(BIWORD,$L(BIWORD)) S BIWORD=$E(BIWORD,1,($L(BIWORD)-1))
"RTN","BITRS",27,0)
 ;---> CodeChange for v7.1 - IHS/CMI/MWR 12/01/2000:
"RTN","BITRS",28,0)
 ;---> Next line, handle word with leading space.
"RTN","BITRS",29,0)
 F  Q:(""" "'[$E(BIWORD,$L(BIWORD)))!($L(BIWORD)=0)  D
"RTN","BITRS",30,0)
 .S BIWORD=$E(BIWORD,1,($L(BIWORD)-1))
"RTN","BITRS",31,0)
 ;
"RTN","BITRS",32,0)
 ;
"RTN","BITRS",33,0)
 Q BIWORD
"RTN","BITRS",34,0)
 ;
"RTN","BITRS",35,0)
 ;
"RTN","BITRS",36,0)
 ;----------
"RTN","BITRS",37,0)
CHAR ;EP
"RTN","BITRS",38,0)
 ;---> If this character is uppercase and previous character is
"RTN","BITRS",39,0)
 ;---> not punctuation (except for an apostrophy) or a space,
"RTN","BITRS",40,0)
 ;---> then change character to lowercase.
"RTN","BITRS",41,0)
 ;
"RTN","BITRS",42,0)
 I ($E(X,I)?1U)&(($E(X,I-1)'?1P)!($E(X,I-1)="'")) D  Q
"RTN","BITRS",43,0)
 .S BIWORD=BIWORD_$C($A($E(X,I))+32)
"RTN","BITRS",44,0)
 ;
"RTN","BITRS",45,0)
 ;
"RTN","BITRS",46,0)
 ;---> If this character is lowercase and previous character is
"RTN","BITRS",47,0)
 ;---> punctuation (but not an apostrophy) or a space, then change
"RTN","BITRS",48,0)
 ;---> character to uppercase.
"RTN","BITRS",49,0)
 ;
"RTN","BITRS",50,0)
 I $E(X,I)?1L,$E(X,I-1)?1P,$E(X,I-1)'="'" D  Q
"RTN","BITRS",51,0)
 .S BIWORD=BIWORD_$C($A($E(X,I))-32) Q
"RTN","BITRS",52,0)
 ;
"RTN","BITRS",53,0)
 ;
"RTN","BITRS",54,0)
 ;---> Add character to BIWORD string without modification.
"RTN","BITRS",55,0)
 ;---> "\" placed before a letter forces it to be uppercase;
"RTN","BITRS",56,0)
 ;---> HERE REMOVE ANY "\"'s.
"RTN","BITRS",57,0)
 I $E(X,I)'="\" S BIWORD=BIWORD_$E(X,I)
"RTN","BITRS",58,0)
 Q
"RTN","BITRS",59,0)
 ;
"RTN","BITRS",60,0)
 ;
"RTN","BITRS",61,0)
 ;----------
"RTN","BITRS",62,0)
UP(X) ;EP
"RTN","BITRS",63,0)
 ;---> Translate any lowercase letters to uppercase.
"RTN","BITRS",64,0)
 ;---> Leave all other characters untouched.
"RTN","BITRS",65,0)
 ;
"RTN","BITRS",66,0)
 Q:"^ "[$G(X) X
"RTN","BITRS",67,0)
 N BICHAR,BIWORD,I S BIWORD=""
"RTN","BITRS",68,0)
 ;
"RTN","BITRS",69,0)
 F I=1:1:$L(X) D  S BIWORD=BIWORD_BICHAR
"RTN","BITRS",70,0)
 .S BICHAR=$E(X,I)
"RTN","BITRS",71,0)
 .Q:(($A(BICHAR)<97)!($A(BICHAR)>122))
"RTN","BITRS",72,0)
 .S BICHAR=$C($A(BICHAR)-32)
"RTN","BITRS",73,0)
 ;
"RTN","BITRS",74,0)
 Q BIWORD
"RTN","BITRS",75,0)
 ;
"RTN","BITRS",76,0)
 ;
"RTN","BITRS",77,0)
 ;----------
"RTN","BITRS",78,0)
LOW(X) ;EP
"RTN","BITRS",79,0)
 ;---> Translate any uppercase letters to lowercase.
"RTN","BITRS",80,0)
 ;---> Leave all other characters untouched.
"RTN","BITRS",81,0)
 ;
"RTN","BITRS",82,0)
 Q:"^ "[$G(X) X
"RTN","BITRS",83,0)
 N BICHAR,BIWORD,I S BIWORD=""
"RTN","BITRS",84,0)
 ;
"RTN","BITRS",85,0)
 F I=1:1:$L(X) D  S BIWORD=BIWORD_BICHAR
"RTN","BITRS",86,0)
 .S BICHAR=$E(X,I)
"RTN","BITRS",87,0)
 .Q:(($A(BICHAR)<65)!($A(BICHAR)>90))
"RTN","BITRS",88,0)
 .S BICHAR=$C($A(BICHAR)+32)
"RTN","BITRS",89,0)
 ;
"RTN","BITRS",90,0)
 Q BIWORD
"RTN","BITX")
0^144^B368637
"RTN","BITX",1,0)
BITX ;IHS/CMI/MWR - ROUTINES TO CREATE FLU AND PNEUMO RISK TAXONOMIES; MAY 10, 2010
"RTN","BITX",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BITX",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITX",4,0)
 ;;IHS/CMI/LAB-CREATED BY ^ATXSTX ON FEB 03, 2010.
"RTN","BITX",5,0)
 ;
"RTN","BITX",6,0)
 ; See referenced routines to see taxonomies being loaded.
"RTN","BITX",7,0)
 ;
"RTN","BITX",8,0)
START ;
"RTN","BITX",9,0)
 ;D ^BITXA ;     BI HIGH RISK FLU
"RTN","BITX",10,0)
 ;D ^BITXB ;     BI HIGH RISK PNEUMO
"RTN","BITX",11,0)
 ;D ^BITXC ;     BI HIGH RISK PNEUMO W/SMOKING
"RTN","BITX",12,0)
 ;
"RTN","BITX",13,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BITX",14,0)
 ;---> Distribute new taxonomy from Lori.
"RTN","BITX",15,0)
 D ^BITXD ;     SURVEILLANCE FLU CVX CODES
"RTN","BITX",16,0)
 Q
"RTN","BITXA")
0^145^B15236777
"RTN","BITXA",1,0)
BITXA ;IHS/CMI/MWR - ROUTINES TO CREATE FLU RISK TAXONOMY; MAY 10, 2010
"RTN","BITXA",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BITXA",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITXA",4,0)
 ;;IHS/CMI/LAB-CREATED BY ^ATXSTX ON SEP 19, 2005
"RTN","BITXA",5,0)
 ;;BI HIGH RISK FLU
"RTN","BITXA",6,0)
 ;
"RTN","BITXA",7,0)
 ; This routine loads Taxonomy BI HIGH RISK FLU
"RTN","BITXA",8,0)
 ;
"RTN","BITXA",9,0)
START ;
"RTN","BITXA",10,0)
 K:'$G(ATXPGMC) ^TMP("ATX",$J)
"RTN","BITXA",11,0)
 S ATXPGMC=$G(ATXPGMC)+1
"RTN","BITXA",12,0)
 F ATXI=1:1 S X=$P($T(TMP+ATXI),";;",2,99) Q:X=""  S X="^TMP(""ATX"",$J,"_X,ATXI=ATXI+1,Y=$P($T(TMP+ATXI),";;",2,99) S @X=Y
"RTN","BITXA",13,0)
 D OTHER
"RTN","BITXA",14,0)
 I $O(^TMP("ATX",$J,3.6,0)) D BULL^ATXSTX2
"RTN","BITXA",15,0)
 I $O(^TMP("ATX",$J,9002226,0)) D TAX^ATXSTX2
"RTN","BITXA",16,0)
 D KILL^ATXSTX2
"RTN","BITXA",17,0)
 Q
"RTN","BITXA",18,0)
 ;
"RTN","BITXA",19,0)
TMP ;;TAXONOMY (WITH BULLETIN)
"RTN","BITXA",20,0)
 ;;21,"042.0 ")
"RTN","BITXA",21,0)
 ;;1
"RTN","BITXA",22,0)
 ;;21,"044.9 ")
"RTN","BITXA",23,0)
 ;;2
"RTN","BITXA",24,0)
 ;;21,"250.00 ")
"RTN","BITXA",25,0)
 ;;3
"RTN","BITXA",26,0)
 ;;21,"393. ")
"RTN","BITXA",27,0)
 ;;4
"RTN","BITXA",28,0)
 ;;21,"402.00 ")
"RTN","BITXA",29,0)
 ;;5
"RTN","BITXA",30,0)
 ;;21,"404.0 ")
"RTN","BITXA",31,0)
 ;;6
"RTN","BITXA",32,0)
 ;;21,"410.00 ")
"RTN","BITXA",33,0)
 ;;7
"RTN","BITXA",34,0)
 ;;21,"424.0 ")
"RTN","BITXA",35,0)
 ;;8
"RTN","BITXA",36,0)
 ;;21,"428.0 ")
"RTN","BITXA",37,0)
 ;;9
"RTN","BITXA",38,0)
 ;;21,"429.2 ")
"RTN","BITXA",39,0)
 ;;10
"RTN","BITXA",40,0)
 ;;21,"491.0 ")
"RTN","BITXA",41,0)
 ;;11
"RTN","BITXA",42,0)
 ;;21,"494. ")
"RTN","BITXA",43,0)
 ;;12
"RTN","BITXA",44,0)
 ;;21,"501. ")
"RTN","BITXA",45,0)
 ;;13
"RTN","BITXA",46,0)
 ;;21,"571.0 ")
"RTN","BITXA",47,0)
 ;;14
"RTN","BITXA",48,0)
 ;;21,"581.0 ")
"RTN","BITXA",49,0)
 ;;15
"RTN","BITXA",50,0)
 ;;21,"585.6 ")
"RTN","BITXA",51,0)
 ;;16
"RTN","BITXA",52,0)
 ;;21,"996.80 ")
"RTN","BITXA",53,0)
 ;;17
"RTN","BITXA",54,0)
 ;;21,"V42.0 ")
"RTN","BITXA",55,0)
 ;;18
"RTN","BITXA",56,0)
 ;;21,"V58.1 ")
"RTN","BITXA",57,0)
 ;;19
"RTN","BITXA",58,0)
 ;;21,"V67.2 ")
"RTN","BITXA",59,0)
 ;;20
"RTN","BITXA",60,0)
 ;;9002226,458,.01)
"RTN","BITXA",61,0)
 ;;BI HIGH RISK FLU
"RTN","BITXA",62,0)
 ;;9002226,458,.02)
"RTN","BITXA",63,0)
 ;;@
"RTN","BITXA",64,0)
 ;;9002226,458,.04)
"RTN","BITXA",65,0)
 ;;@
"RTN","BITXA",66,0)
 ;;9002226,458,.06)
"RTN","BITXA",67,0)
 ;;@
"RTN","BITXA",68,0)
 ;;9002226,458,.08)
"RTN","BITXA",69,0)
 ;;0
"RTN","BITXA",70,0)
 ;;9002226,458,.09)
"RTN","BITXA",71,0)
 ;;3050916
"RTN","BITXA",72,0)
 ;;9002226,458,.11)
"RTN","BITXA",73,0)
 ;;@
"RTN","BITXA",74,0)
 ;;9002226,458,.12)
"RTN","BITXA",75,0)
 ;;31
"RTN","BITXA",76,0)
 ;;9002226,458,.13)
"RTN","BITXA",77,0)
 ;;1
"RTN","BITXA",78,0)
 ;;9002226,458,.14)
"RTN","BITXA",79,0)
 ;;@
"RTN","BITXA",80,0)
 ;;9002226,458,.15)
"RTN","BITXA",81,0)
 ;;80
"RTN","BITXA",82,0)
 ;;9002226,458,.16)
"RTN","BITXA",83,0)
 ;;@
"RTN","BITXA",84,0)
 ;;9002226,458,.17)
"RTN","BITXA",85,0)
 ;;@
"RTN","BITXA",86,0)
 ;;9002226,458,3101)
"RTN","BITXA",87,0)
 ;;@
"RTN","BITXA",88,0)
 ;;9002226.02101,"458,042.0 ",.01)
"RTN","BITXA",89,0)
 ;;042.0
"RTN","BITXA",90,0)
 ;;9002226.02101,"458,042.0 ",.02)
"RTN","BITXA",91,0)
 ;;043.9
"RTN","BITXA",92,0)
 ;;9002226.02101,"458,044.9 ",.01)
"RTN","BITXA",93,0)
 ;;044.9
"RTN","BITXA",94,0)
 ;;9002226.02101,"458,044.9 ",.02)
"RTN","BITXA",95,0)
 ;;044.9
"RTN","BITXA",96,0)
 ;;9002226.02101,"458,250.00 ",.01)
"RTN","BITXA",97,0)
 ;;250.00
"RTN","BITXA",98,0)
 ;;9002226.02101,"458,250.00 ",.02)
"RTN","BITXA",99,0)
 ;;250.93
"RTN","BITXA",100,0)
 ;;9002226.02101,"458,393. ",.01)
"RTN","BITXA",101,0)
 ;;393.
"RTN","BITXA",102,0)
 ;;9002226.02101,"458,393. ",.02)
"RTN","BITXA",103,0)
 ;;398.99
"RTN","BITXA",104,0)
 ;;9002226.02101,"458,402.00 ",.01)
"RTN","BITXA",105,0)
 ;;402.00
"RTN","BITXA",106,0)
 ;;9002226.02101,"458,402.00 ",.02)
"RTN","BITXA",107,0)
 ;;402.91
"RTN","BITXA",108,0)
 ;;9002226.02101,"458,404.0 ",.01)
"RTN","BITXA",109,0)
 ;;404.0
"RTN","BITXA",110,0)
 ;;9002226.02101,"458,404.0 ",.02)
"RTN","BITXA",111,0)
 ;;404.93
"RTN","BITXA",112,0)
 ;;9002226.02101,"458,410.00 ",.01)
"RTN","BITXA",113,0)
 ;;410.00
"RTN","BITXA",114,0)
 ;;9002226.02101,"458,410.00 ",.02)
"RTN","BITXA",115,0)
 ;;416.9
"RTN","BITXA",116,0)
 ;;9002226.02101,"458,424.0 ",.01)
"RTN","BITXA",117,0)
 ;;424.0
"RTN","BITXA",118,0)
 ;;9002226.02101,"458,424.0 ",.02)
"RTN","BITXA",119,0)
 ;;425.9
"RTN","BITXA",120,0)
 ;;9002226.02101,"458,428.0 ",.01)
"RTN","BITXA",121,0)
 ;;428.0
"RTN","BITXA",122,0)
 ;;9002226.02101,"458,428.0 ",.02)
"RTN","BITXA",123,0)
 ;;428.9
"RTN","BITXA",124,0)
 ;;9002226.02101,"458,429.2 ",.01)
"RTN","BITXA",125,0)
 ;;429.2
"RTN","BITXA",126,0)
 ;;9002226.02101,"458,429.2 ",.02)
"RTN","BITXA",127,0)
 ;;429.2
"RTN","BITXA",128,0)
 ;;9002226.02101,"458,491.0 ",.01)
"RTN","BITXA",129,0)
 ;;491.0
"RTN","BITXA",130,0)
 ;;9002226.02101,"458,491.0 ",.02)
"RTN","BITXA",131,0)
 ;;493.91
"RTN","BITXA",132,0)
 ;;9002226.02101,"458,494. ",.01)
"RTN","BITXA",133,0)
 ;;494.
"RTN","BITXA",134,0)
 ;;9002226.02101,"458,494. ",.02)
"RTN","BITXA",135,0)
 ;;496.
"RTN","BITXA",136,0)
 ;;9002226.02101,"458,501. ",.01)
"RTN","BITXA",137,0)
 ;;501.
"RTN","BITXA",138,0)
 ;;9002226.02101,"458,501. ",.02)
"RTN","BITXA",139,0)
 ;;505.
"RTN","BITXA",140,0)
 ;;9002226.02101,"458,571.0 ",.01)
"RTN","BITXA",141,0)
 ;;571.0
"RTN","BITXA",142,0)
 ;;9002226.02101,"458,571.0 ",.02)
"RTN","BITXA",143,0)
 ;;571.9
"RTN","BITXA",144,0)
 ;;9002226.02101,"458,581.0 ",.01)
"RTN","BITXA",145,0)
 ;;581.0
"RTN","BITXA",146,0)
 ;;9002226.02101,"458,581.0 ",.02)
"RTN","BITXA",147,0)
 ;;581.9
"RTN","BITXA",148,0)
 ;;9002226.02101,"458,585.6 ",.01)
"RTN","BITXA",149,0)
 ;;585.6
"RTN","BITXA",150,0)
 ;;9002226.02101,"458,585.6 ",.02)
"RTN","BITXA",151,0)
 ;;585.9
"RTN","BITXA",152,0)
 ;;9002226.02101,"458,996.80 ",.01)
"RTN","BITXA",153,0)
 ;;996.80
"RTN","BITXA",154,0)
 ;;9002226.02101,"458,996.80 ",.02)
"RTN","BITXA",155,0)
 ;;996.89
"RTN","BITXA",156,0)
 ;;9002226.02101,"458,V42.0 ",.01)
"RTN","BITXA",157,0)
 ;;V42.0
"RTN","BITXA",158,0)
 ;;9002226.02101,"458,V42.0 ",.02)
"RTN","BITXA",159,0)
 ;;V42.89
"RTN","BITXA",160,0)
 ;;9002226.02101,"458,V58.1 ",.01)
"RTN","BITXA",161,0)
 ;;V58.1
"RTN","BITXA",162,0)
 ;;9002226.02101,"458,V58.1 ",.02)
"RTN","BITXA",163,0)
 ;;V58.1
"RTN","BITXA",164,0)
 ;;9002226.02101,"458,V67.2 ",.01)
"RTN","BITXA",165,0)
 ;;V67.2
"RTN","BITXA",166,0)
 ;;9002226.02101,"458,V67.2 ",.02)
"RTN","BITXA",167,0)
 ;;V67.2
"RTN","BITXA",168,0)
 ;
"RTN","BITXA",169,0)
OTHER ; OTHER ROUTINES
"RTN","BITXA",170,0)
 Q
"RTN","BITXB")
0^146^B14336456
"RTN","BITXB",1,0)
BITXB ;IHS/CMI/MWR - ROUTINES TO CREATE PNEUMO RISK TAXONOMY; MAY 10, 2010
"RTN","BITXB",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BITXB",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITXB",4,0)
 ;;IHS/CMI/LAB-CREATED BY ^ATXSTX ON FEB 3, 2010
"RTN","BITXB",5,0)
 ;;BI HIGH RISK PNEUMO
"RTN","BITXB",6,0)
 ;
"RTN","BITXB",7,0)
 ; This routine loads Taxonomy BI HIGH RISK PNEUMO
"RTN","BITXB",8,0)
 ;
"RTN","BITXB",9,0)
START ;
"RTN","BITXB",10,0)
 K:'$G(ATXPGMC) ^TMP("ATX",$J)
"RTN","BITXB",11,0)
 S ATXPGMC=$G(ATXPGMC)+1
"RTN","BITXB",12,0)
 F ATXI=1:1 S X=$P($T(TMP+ATXI),";;",2,99) Q:X=""  S X="^TMP(""ATX"",$J,"_X,ATXI=ATXI+1,Y=$P($T(TMP+ATXI),";;",2,99) S @X=Y
"RTN","BITXB",13,0)
 D OTHER
"RTN","BITXB",14,0)
 I $O(^TMP("ATX",$J,3.6,0)) D BULL^ATXSTX2
"RTN","BITXB",15,0)
 I $O(^TMP("ATX",$J,9002226,0)) D TAX^ATXSTX2
"RTN","BITXB",16,0)
 D KILL^ATXSTX2
"RTN","BITXB",17,0)
 Q
"RTN","BITXB",18,0)
 ;
"RTN","BITXB",19,0)
TMP ;;TAXONOMY (WITH BULLETIN)
"RTN","BITXB",20,0)
 ;;21,"042.0 ")
"RTN","BITXB",21,0)
 ;;1
"RTN","BITXB",22,0)
 ;;21,"044.9 ")
"RTN","BITXB",23,0)
 ;;2
"RTN","BITXB",24,0)
 ;;21,"250.00 ")
"RTN","BITXB",25,0)
 ;;3
"RTN","BITXB",26,0)
 ;;21,"303.90 ")
"RTN","BITXB",27,0)
 ;;4
"RTN","BITXB",28,0)
 ;;21,"303.91 ")
"RTN","BITXB",29,0)
 ;;5
"RTN","BITXB",30,0)
 ;;21,"428.0 ")
"RTN","BITXB",31,0)
 ;;6
"RTN","BITXB",32,0)
 ;;21,"429.2 ")
"RTN","BITXB",33,0)
 ;;7
"RTN","BITXB",34,0)
 ;;21,"492.0 ")
"RTN","BITXB",35,0)
 ;;8
"RTN","BITXB",36,0)
 ;;21,"493.00 ")
"RTN","BITXB",37,0)
 ;;9
"RTN","BITXB",38,0)
 ;;21,"494. ")
"RTN","BITXB",39,0)
 ;;10
"RTN","BITXB",40,0)
 ;;21,"501. ")
"RTN","BITXB",41,0)
 ;;11
"RTN","BITXB",42,0)
 ;;21,"571.0 ")
"RTN","BITXB",43,0)
 ;;12
"RTN","BITXB",44,0)
 ;;21,"581.0 ")
"RTN","BITXB",45,0)
 ;;13
"RTN","BITXB",46,0)
 ;;21,"585.6 ")
"RTN","BITXB",47,0)
 ;;14
"RTN","BITXB",48,0)
 ;;21,"865.00 ")
"RTN","BITXB",49,0)
 ;;15
"RTN","BITXB",50,0)
 ;;21,"996.80 ")
"RTN","BITXB",51,0)
 ;;16
"RTN","BITXB",52,0)
 ;;21,"V42.0 ")
"RTN","BITXB",53,0)
 ;;17
"RTN","BITXB",54,0)
 ;;21,"V58.1 ")
"RTN","BITXB",55,0)
 ;;18
"RTN","BITXB",56,0)
 ;;21,"V67.2 ")
"RTN","BITXB",57,0)
 ;;19
"RTN","BITXB",58,0)
 ;;9002226,707,.01)
"RTN","BITXB",59,0)
 ;;BI HIGH RISK PNEUMO
"RTN","BITXB",60,0)
 ;;9002226,707,.02)
"RTN","BITXB",61,0)
 ;;@
"RTN","BITXB",62,0)
 ;;9002226,707,.04)
"RTN","BITXB",63,0)
 ;;@
"RTN","BITXB",64,0)
 ;;9002226,707,.06)
"RTN","BITXB",65,0)
 ;;@
"RTN","BITXB",66,0)
 ;;9002226,707,.08)
"RTN","BITXB",67,0)
 ;;0
"RTN","BITXB",68,0)
 ;;9002226,707,.09)
"RTN","BITXB",69,0)
 ;;3100203
"RTN","BITXB",70,0)
 ;;9002226,707,.11)
"RTN","BITXB",71,0)
 ;;@
"RTN","BITXB",72,0)
 ;;9002226,707,.12)
"RTN","BITXB",73,0)
 ;;31
"RTN","BITXB",74,0)
 ;;9002226,707,.13)
"RTN","BITXB",75,0)
 ;;1
"RTN","BITXB",76,0)
 ;;9002226,707,.14)
"RTN","BITXB",77,0)
 ;;@
"RTN","BITXB",78,0)
 ;;9002226,707,.15)
"RTN","BITXB",79,0)
 ;;80
"RTN","BITXB",80,0)
 ;;9002226,707,.16)
"RTN","BITXB",81,0)
 ;;@
"RTN","BITXB",82,0)
 ;;9002226,707,.17)
"RTN","BITXB",83,0)
 ;;@
"RTN","BITXB",84,0)
 ;;9002226,707,3101)
"RTN","BITXB",85,0)
 ;;@
"RTN","BITXB",86,0)
 ;;9002226.02101,"707,042.0 ",.01)
"RTN","BITXB",87,0)
 ;;042.0
"RTN","BITXB",88,0)
 ;;9002226.02101,"707,042.0 ",.02)
"RTN","BITXB",89,0)
 ;;043.9
"RTN","BITXB",90,0)
 ;;9002226.02101,"707,044.9 ",.01)
"RTN","BITXB",91,0)
 ;;044.9
"RTN","BITXB",92,0)
 ;;9002226.02101,"707,044.9 ",.02)
"RTN","BITXB",93,0)
 ;;044.9
"RTN","BITXB",94,0)
 ;;9002226.02101,"707,250.00 ",.01)
"RTN","BITXB",95,0)
 ;;250.00
"RTN","BITXB",96,0)
 ;;9002226.02101,"707,250.00 ",.02)
"RTN","BITXB",97,0)
 ;;250.93
"RTN","BITXB",98,0)
 ;;9002226.02101,"707,303.90 ",.01)
"RTN","BITXB",99,0)
 ;;303.90
"RTN","BITXB",100,0)
 ;;9002226.02101,"707,303.90 ",.02)
"RTN","BITXB",101,0)
 ;;303.90
"RTN","BITXB",102,0)
 ;;9002226.02101,"707,303.91 ",.01)
"RTN","BITXB",103,0)
 ;;303.91
"RTN","BITXB",104,0)
 ;;9002226.02101,"707,303.91 ",.02)
"RTN","BITXB",105,0)
 ;;303.91
"RTN","BITXB",106,0)
 ;;9002226.02101,"707,428.0 ",.01)
"RTN","BITXB",107,0)
 ;;428.0
"RTN","BITXB",108,0)
 ;;9002226.02101,"707,428.0 ",.02)
"RTN","BITXB",109,0)
 ;;428.9
"RTN","BITXB",110,0)
 ;;9002226.02101,"707,429.2 ",.01)
"RTN","BITXB",111,0)
 ;;429.2
"RTN","BITXB",112,0)
 ;;9002226.02101,"707,429.2 ",.02)
"RTN","BITXB",113,0)
 ;;429.2
"RTN","BITXB",114,0)
 ;;9002226.02101,"707,492.0 ",.01)
"RTN","BITXB",115,0)
 ;;492.0
"RTN","BITXB",116,0)
 ;;9002226.02101,"707,492.0 ",.02)
"RTN","BITXB",117,0)
 ;;492.8
"RTN","BITXB",118,0)
 ;;9002226.02101,"707,493.00 ",.01)
"RTN","BITXB",119,0)
 ;;493.00
"RTN","BITXB",120,0)
 ;;9002226.02101,"707,493.00 ",.02)
"RTN","BITXB",121,0)
 ;;493.91
"RTN","BITXB",122,0)
 ;;9002226.02101,"707,494. ",.01)
"RTN","BITXB",123,0)
 ;;494.
"RTN","BITXB",124,0)
 ;;9002226.02101,"707,494. ",.02)
"RTN","BITXB",125,0)
 ;;496.
"RTN","BITXB",126,0)
 ;;9002226.02101,"707,501. ",.01)
"RTN","BITXB",127,0)
 ;;501.
"RTN","BITXB",128,0)
 ;;9002226.02101,"707,501. ",.02)
"RTN","BITXB",129,0)
 ;;505.
"RTN","BITXB",130,0)
 ;;9002226.02101,"707,571.0 ",.01)
"RTN","BITXB",131,0)
 ;;571.0
"RTN","BITXB",132,0)
 ;;9002226.02101,"707,571.0 ",.02)
"RTN","BITXB",133,0)
 ;;571.9
"RTN","BITXB",134,0)
 ;;9002226.02101,"707,581.0 ",.01)
"RTN","BITXB",135,0)
 ;;581.0
"RTN","BITXB",136,0)
 ;;9002226.02101,"707,581.0 ",.02)
"RTN","BITXB",137,0)
 ;;581.9
"RTN","BITXB",138,0)
 ;;9002226.02101,"707,585.6 ",.01)
"RTN","BITXB",139,0)
 ;;585.6
"RTN","BITXB",140,0)
 ;;9002226.02101,"707,585.6 ",.02)
"RTN","BITXB",141,0)
 ;;585.9
"RTN","BITXB",142,0)
 ;;9002226.02101,"707,865.00 ",.01)
"RTN","BITXB",143,0)
 ;;865.00
"RTN","BITXB",144,0)
 ;;9002226.02101,"707,865.00 ",.02)
"RTN","BITXB",145,0)
 ;;865.19
"RTN","BITXB",146,0)
 ;;9002226.02101,"707,996.80 ",.01)
"RTN","BITXB",147,0)
 ;;996.80
"RTN","BITXB",148,0)
 ;;9002226.02101,"707,996.80 ",.02)
"RTN","BITXB",149,0)
 ;;996.89
"RTN","BITXB",150,0)
 ;;9002226.02101,"707,V42.0 ",.01)
"RTN","BITXB",151,0)
 ;;V42.0
"RTN","BITXB",152,0)
 ;;9002226.02101,"707,V42.0 ",.02)
"RTN","BITXB",153,0)
 ;;V42.89
"RTN","BITXB",154,0)
 ;;9002226.02101,"707,V58.1 ",.01)
"RTN","BITXB",155,0)
 ;;V58.1
"RTN","BITXB",156,0)
 ;;9002226.02101,"707,V58.1 ",.02)
"RTN","BITXB",157,0)
 ;;V58.1
"RTN","BITXB",158,0)
 ;;9002226.02101,"707,V67.2 ",.01)
"RTN","BITXB",159,0)
 ;;V67.2
"RTN","BITXB",160,0)
 ;;9002226.02101,"707,V67.2 ",.02)
"RTN","BITXB",161,0)
 ;;V67.2
"RTN","BITXB",162,0)
 ;
"RTN","BITXB",163,0)
OTHER ; OTHER ROUTINES
"RTN","BITXB",164,0)
 Q
"RTN","BITXC")
0^147^B16462944
"RTN","BITXC",1,0)
BITXC ;IHS/CMI/MWR - ROUTINES TO CREATE PNEUMO SMOKING RISK TAXONOMY; MAY 10, 2010
"RTN","BITXC",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BITXC",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITXC",4,0)
 ;;IHS/CMI/LAB-CREATED BY ^ATXSTX ON FEB 3, 2010
"RTN","BITXC",5,0)
 ;;BI HIGH RISK PNEUMO W/SMOKING
"RTN","BITXC",6,0)
 ;
"RTN","BITXC",7,0)
 ; This routine loads Taxonomy BI HIGH RISK PNEUMO W/SMOKING
"RTN","BITXC",8,0)
 ;
"RTN","BITXC",9,0)
START ;
"RTN","BITXC",10,0)
 K:'$G(ATXPGMC) ^TMP("ATX",$J)
"RTN","BITXC",11,0)
 S ATXPGMC=$G(ATXPGMC)+1
"RTN","BITXC",12,0)
 F ATXI=1:1 S X=$P($T(TMP+ATXI),";;",2,99) Q:X=""  S X="^TMP(""ATX"",$J,"_X,ATXI=ATXI+1,Y=$P($T(TMP+ATXI),";;",2,99) S @X=Y
"RTN","BITXC",13,0)
 D OTHER
"RTN","BITXC",14,0)
 I $O(^TMP("ATX",$J,3.6,0)) D BULL^ATXSTX2
"RTN","BITXC",15,0)
 I $O(^TMP("ATX",$J,9002226,0)) D TAX^ATXSTX2
"RTN","BITXC",16,0)
 D KILL^ATXSTX2
"RTN","BITXC",17,0)
 Q
"RTN","BITXC",18,0)
 ;
"RTN","BITXC",19,0)
TMP ;;TAXONOMY (WITH BULLETIN)
"RTN","BITXC",20,0)
 ;;21,"042.0 ")
"RTN","BITXC",21,0)
 ;;1
"RTN","BITXC",22,0)
 ;;21,"044.9 ")
"RTN","BITXC",23,0)
 ;;2
"RTN","BITXC",24,0)
 ;;21,"250.00 ")
"RTN","BITXC",25,0)
 ;;3
"RTN","BITXC",26,0)
 ;;21,"303.90 ")
"RTN","BITXC",27,0)
 ;;4
"RTN","BITXC",28,0)
 ;;21,"303.91 ")
"RTN","BITXC",29,0)
 ;;5
"RTN","BITXC",30,0)
 ;;21,"305.1 ")
"RTN","BITXC",31,0)
 ;;6
"RTN","BITXC",32,0)
 ;;21,"428.0 ")
"RTN","BITXC",33,0)
 ;;7
"RTN","BITXC",34,0)
 ;;21,"429.2 ")
"RTN","BITXC",35,0)
 ;;8
"RTN","BITXC",36,0)
 ;;21,"492.0 ")
"RTN","BITXC",37,0)
 ;;9
"RTN","BITXC",38,0)
 ;;21,"493.00 ")
"RTN","BITXC",39,0)
 ;;10
"RTN","BITXC",40,0)
 ;;21,"494. ")
"RTN","BITXC",41,0)
 ;;11
"RTN","BITXC",42,0)
 ;;21,"501. ")
"RTN","BITXC",43,0)
 ;;12
"RTN","BITXC",44,0)
 ;;21,"571.0 ")
"RTN","BITXC",45,0)
 ;;13
"RTN","BITXC",46,0)
 ;;21,"581.0 ")
"RTN","BITXC",47,0)
 ;;14
"RTN","BITXC",48,0)
 ;;21,"585.6 ")
"RTN","BITXC",49,0)
 ;;15
"RTN","BITXC",50,0)
 ;;21,"649.00 ")
"RTN","BITXC",51,0)
 ;;16
"RTN","BITXC",52,0)
 ;;21,"865.00 ")
"RTN","BITXC",53,0)
 ;;17
"RTN","BITXC",54,0)
 ;;21,"996.80 ")
"RTN","BITXC",55,0)
 ;;18
"RTN","BITXC",56,0)
 ;;21,"V42.0 ")
"RTN","BITXC",57,0)
 ;;19
"RTN","BITXC",58,0)
 ;;21,"V58.1 ")
"RTN","BITXC",59,0)
 ;;20
"RTN","BITXC",60,0)
 ;;21,"V67.2 ")
"RTN","BITXC",61,0)
 ;;21
"RTN","BITXC",62,0)
 ;;9002226,714,.01)
"RTN","BITXC",63,0)
 ;;BI HIGH RISK PNEUMO W/SMOKING
"RTN","BITXC",64,0)
 ;;9002226,714,.02)
"RTN","BITXC",65,0)
 ;;@
"RTN","BITXC",66,0)
 ;;9002226,714,.04)
"RTN","BITXC",67,0)
 ;;@
"RTN","BITXC",68,0)
 ;;9002226,714,.06)
"RTN","BITXC",69,0)
 ;;@
"RTN","BITXC",70,0)
 ;;9002226,714,.08)
"RTN","BITXC",71,0)
 ;;0
"RTN","BITXC",72,0)
 ;;9002226,714,.09)
"RTN","BITXC",73,0)
 ;;3100203
"RTN","BITXC",74,0)
 ;;9002226,714,.11)
"RTN","BITXC",75,0)
 ;;@
"RTN","BITXC",76,0)
 ;;9002226,714,.12)
"RTN","BITXC",77,0)
 ;;31
"RTN","BITXC",78,0)
 ;;9002226,714,.13)
"RTN","BITXC",79,0)
 ;;1
"RTN","BITXC",80,0)
 ;;9002226,714,.14)
"RTN","BITXC",81,0)
 ;;@
"RTN","BITXC",82,0)
 ;;9002226,714,.15)
"RTN","BITXC",83,0)
 ;;80
"RTN","BITXC",84,0)
 ;;9002226,714,.16)
"RTN","BITXC",85,0)
 ;;@
"RTN","BITXC",86,0)
 ;;9002226,714,.17)
"RTN","BITXC",87,0)
 ;;@
"RTN","BITXC",88,0)
 ;;9002226,714,3101)
"RTN","BITXC",89,0)
 ;;@
"RTN","BITXC",90,0)
 ;;9002226.02101,"714,042.0 ",.01)
"RTN","BITXC",91,0)
 ;;042.0
"RTN","BITXC",92,0)
 ;;9002226.02101,"714,042.0 ",.02)
"RTN","BITXC",93,0)
 ;;043.9
"RTN","BITXC",94,0)
 ;;9002226.02101,"714,044.9 ",.01)
"RTN","BITXC",95,0)
 ;;044.9
"RTN","BITXC",96,0)
 ;;9002226.02101,"714,044.9 ",.02)
"RTN","BITXC",97,0)
 ;;044.9
"RTN","BITXC",98,0)
 ;;9002226.02101,"714,250.00 ",.01)
"RTN","BITXC",99,0)
 ;;250.00
"RTN","BITXC",100,0)
 ;;9002226.02101,"714,250.00 ",.02)
"RTN","BITXC",101,0)
 ;;250.93
"RTN","BITXC",102,0)
 ;;9002226.02101,"714,303.90 ",.01)
"RTN","BITXC",103,0)
 ;;303.90
"RTN","BITXC",104,0)
 ;;9002226.02101,"714,303.90 ",.02)
"RTN","BITXC",105,0)
 ;;303.90
"RTN","BITXC",106,0)
 ;;9002226.02101,"714,303.91 ",.01)
"RTN","BITXC",107,0)
 ;;303.91
"RTN","BITXC",108,0)
 ;;9002226.02101,"714,303.91 ",.02)
"RTN","BITXC",109,0)
 ;;303.91
"RTN","BITXC",110,0)
 ;;9002226.02101,"714,305.1 ",.01)
"RTN","BITXC",111,0)
 ;;305.1
"RTN","BITXC",112,0)
 ;;9002226.02101,"714,305.1 ",.02)
"RTN","BITXC",113,0)
 ;;305.12
"RTN","BITXC",114,0)
 ;;9002226.02101,"714,428.0 ",.01)
"RTN","BITXC",115,0)
 ;;428.0
"RTN","BITXC",116,0)
 ;;9002226.02101,"714,428.0 ",.02)
"RTN","BITXC",117,0)
 ;;428.9
"RTN","BITXC",118,0)
 ;;9002226.02101,"714,429.2 ",.01)
"RTN","BITXC",119,0)
 ;;429.2
"RTN","BITXC",120,0)
 ;;9002226.02101,"714,429.2 ",.02)
"RTN","BITXC",121,0)
 ;;429.2
"RTN","BITXC",122,0)
 ;;9002226.02101,"714,492.0 ",.01)
"RTN","BITXC",123,0)
 ;;492.0
"RTN","BITXC",124,0)
 ;;9002226.02101,"714,492.0 ",.02)
"RTN","BITXC",125,0)
 ;;492.8
"RTN","BITXC",126,0)
 ;;9002226.02101,"714,493.00 ",.01)
"RTN","BITXC",127,0)
 ;;493.00
"RTN","BITXC",128,0)
 ;;9002226.02101,"714,493.00 ",.02)
"RTN","BITXC",129,0)
 ;;493.91
"RTN","BITXC",130,0)
 ;;9002226.02101,"714,494. ",.01)
"RTN","BITXC",131,0)
 ;;494.
"RTN","BITXC",132,0)
 ;;9002226.02101,"714,494. ",.02)
"RTN","BITXC",133,0)
 ;;496.
"RTN","BITXC",134,0)
 ;;9002226.02101,"714,501. ",.01)
"RTN","BITXC",135,0)
 ;;501.
"RTN","BITXC",136,0)
 ;;9002226.02101,"714,501. ",.02)
"RTN","BITXC",137,0)
 ;;505.
"RTN","BITXC",138,0)
 ;;9002226.02101,"714,571.0 ",.01)
"RTN","BITXC",139,0)
 ;;571.0
"RTN","BITXC",140,0)
 ;;9002226.02101,"714,571.0 ",.02)
"RTN","BITXC",141,0)
 ;;571.9
"RTN","BITXC",142,0)
 ;;9002226.02101,"714,581.0 ",.01)
"RTN","BITXC",143,0)
 ;;581.0
"RTN","BITXC",144,0)
 ;;9002226.02101,"714,581.0 ",.02)
"RTN","BITXC",145,0)
 ;;581.9
"RTN","BITXC",146,0)
 ;;9002226.02101,"714,585.6 ",.01)
"RTN","BITXC",147,0)
 ;;585.6
"RTN","BITXC",148,0)
 ;;9002226.02101,"714,585.6 ",.02)
"RTN","BITXC",149,0)
 ;;585.9
"RTN","BITXC",150,0)
 ;;9002226.02101,"714,649.00 ",.01)
"RTN","BITXC",151,0)
 ;;649.00
"RTN","BITXC",152,0)
 ;;9002226.02101,"714,649.00 ",.02)
"RTN","BITXC",153,0)
 ;;649.04
"RTN","BITXC",154,0)
 ;;9002226.02101,"714,865.00 ",.01)
"RTN","BITXC",155,0)
 ;;865.00
"RTN","BITXC",156,0)
 ;;9002226.02101,"714,865.00 ",.02)
"RTN","BITXC",157,0)
 ;;865.19
"RTN","BITXC",158,0)
 ;;9002226.02101,"714,996.80 ",.01)
"RTN","BITXC",159,0)
 ;;996.80
"RTN","BITXC",160,0)
 ;;9002226.02101,"714,996.80 ",.02)
"RTN","BITXC",161,0)
 ;;996.89
"RTN","BITXC",162,0)
 ;;9002226.02101,"714,V42.0 ",.01)
"RTN","BITXC",163,0)
 ;;V42.0
"RTN","BITXC",164,0)
 ;;9002226.02101,"714,V42.0 ",.02)
"RTN","BITXC",165,0)
 ;;V42.89
"RTN","BITXC",166,0)
 ;;9002226.02101,"714,V58.1 ",.01)
"RTN","BITXC",167,0)
 ;;V58.1
"RTN","BITXC",168,0)
 ;;9002226.02101,"714,V58.1 ",.02)
"RTN","BITXC",169,0)
 ;;V58.1
"RTN","BITXC",170,0)
 ;;9002226.02101,"714,V67.2 ",.01)
"RTN","BITXC",171,0)
 ;;V67.2
"RTN","BITXC",172,0)
 ;;9002226.02101,"714,V67.2 ",.02)
"RTN","BITXC",173,0)
 ;;V67.2
"RTN","BITXC",174,0)
 ;
"RTN","BITXC",175,0)
OTHER ; OTHER ROUTINES
"RTN","BITXC",176,0)
 Q
"RTN","BITXD")
0^148^B10181675
"RTN","BITXD",1,0)
BITXD ;IHS/CMI/MWR - CREATE SURVEILLANCE FLU CVX CODES TAXONOMY; MAY 10, 2010
"RTN","BITXD",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BITXD",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITXD",4,0)
 ;;IHS/CMI/LAB-CREATED BY ^ATXSTX ON AUG 25, 2014;
"RTN","BITXD",5,0)
 ;;SURVEILLANCE FLU CVX CODES
"RTN","BITXD",6,0)
 ;
"RTN","BITXD",7,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BITXD",8,0)
 ;---> This routine loads Taxonomy SURVEILLANCE FLU CVX CODES.
"RTN","BITXD",9,0)
 ;
"RTN","BITXD",10,0)
START ;
"RTN","BITXD",11,0)
 K:'$G(ATXPGMC) ^TMP("ATX",$J)
"RTN","BITXD",12,0)
 S ATXPGMC=$G(ATXPGMC)+1
"RTN","BITXD",13,0)
 F ATXI=1:1 S X=$P($T(TMP+ATXI),";;",2,99) Q:X=""  S X="^TMP(""ATX"",$J,"_X,ATXI=ATXI+1,Y=$P($T(TMP+ATXI),";;",2,99) S @X=Y
"RTN","BITXD",14,0)
 D OTHER
"RTN","BITXD",15,0)
 I $O(^TMP("ATX",$J,3.6,0)) D BULL^ATXSTX2
"RTN","BITXD",16,0)
 I $O(^TMP("ATX",$J,9002226,0)) D TAX^ATXSTX2
"RTN","BITXD",17,0)
 D KILL^ATXSTX2
"RTN","BITXD",18,0)
 Q
"RTN","BITXD",19,0)
 ;
"RTN","BITXD",20,0)
TMP ;;TAXONOMY (WITH BULLETIN)
"RTN","BITXD",21,0)
 ;;21,"111 ")
"RTN","BITXD",22,0)
 ;;1
"RTN","BITXD",23,0)
 ;;21,"135 ")
"RTN","BITXD",24,0)
 ;;2
"RTN","BITXD",25,0)
 ;;21,"140 ")
"RTN","BITXD",26,0)
 ;;3
"RTN","BITXD",27,0)
 ;;21,"141 ")
"RTN","BITXD",28,0)
 ;;4
"RTN","BITXD",29,0)
 ;;21,"144 ")
"RTN","BITXD",30,0)
 ;;5
"RTN","BITXD",31,0)
 ;;21,"149 ")
"RTN","BITXD",32,0)
 ;;6
"RTN","BITXD",33,0)
 ;;21,"15 ")
"RTN","BITXD",34,0)
 ;;7
"RTN","BITXD",35,0)
 ;;21,"150 ")
"RTN","BITXD",36,0)
 ;;8
"RTN","BITXD",37,0)
 ;;21,"151 ")
"RTN","BITXD",38,0)
 ;;9
"RTN","BITXD",39,0)
 ;;21,"153 ")
"RTN","BITXD",40,0)
 ;;10
"RTN","BITXD",41,0)
 ;;21,"155 ")
"RTN","BITXD",42,0)
 ;;11
"RTN","BITXD",43,0)
 ;;21,"158 ")
"RTN","BITXD",44,0)
 ;;12
"RTN","BITXD",45,0)
 ;;21,"16 ")
"RTN","BITXD",46,0)
 ;;13
"RTN","BITXD",47,0)
 ;;21,"161 ")
"RTN","BITXD",48,0)
 ;;14
"RTN","BITXD",49,0)
 ;;21,"88 ")
"RTN","BITXD",50,0)
 ;;15
"RTN","BITXD",51,0)
 ;;9002226,1895,.01)
"RTN","BITXD",52,0)
 ;;SURVEILLANCE FLU CVX CODES
"RTN","BITXD",53,0)
 ;;9002226,1895,.02)
"RTN","BITXD",54,0)
 ;;FLU IZ CVX CODES
"RTN","BITXD",55,0)
 ;;9002226,1895,.04)
"RTN","BITXD",56,0)
 ;;n
"RTN","BITXD",57,0)
 ;;9002226,1895,.06)
"RTN","BITXD",58,0)
 ;;@
"RTN","BITXD",59,0)
 ;;9002226,1895,.08)
"RTN","BITXD",60,0)
 ;;0
"RTN","BITXD",61,0)
 ;;9002226,1895,.09)
"RTN","BITXD",62,0)
 ;;3100216
"RTN","BITXD",63,0)
 ;;9002226,1895,.11)
"RTN","BITXD",64,0)
 ;;@
"RTN","BITXD",65,0)
 ;;9002226,1895,.12)
"RTN","BITXD",66,0)
 ;;145
"RTN","BITXD",67,0)
 ;;9002226,1895,.13)
"RTN","BITXD",68,0)
 ;;1
"RTN","BITXD",69,0)
 ;;9002226,1895,.14)
"RTN","BITXD",70,0)
 ;;@
"RTN","BITXD",71,0)
 ;;9002226,1895,.15)
"RTN","BITXD",72,0)
 ;;9999999.14
"RTN","BITXD",73,0)
 ;;9002226,1895,.16)
"RTN","BITXD",74,0)
 ;;@
"RTN","BITXD",75,0)
 ;;9002226,1895,.17)
"RTN","BITXD",76,0)
 ;;@
"RTN","BITXD",77,0)
 ;;9002226,1895,3101)
"RTN","BITXD",78,0)
 ;;@
"RTN","BITXD",79,0)
 ;;9002226.02101,"1895,111 ",.01)
"RTN","BITXD",80,0)
 ;;111
"RTN","BITXD",81,0)
 ;;9002226.02101,"1895,111 ",.02)
"RTN","BITXD",82,0)
 ;;111
"RTN","BITXD",83,0)
 ;;9002226.02101,"1895,135 ",.01)
"RTN","BITXD",84,0)
 ;;135
"RTN","BITXD",85,0)
 ;;9002226.02101,"1895,135 ",.02)
"RTN","BITXD",86,0)
 ;;135
"RTN","BITXD",87,0)
 ;;9002226.02101,"1895,140 ",.01)
"RTN","BITXD",88,0)
 ;;140
"RTN","BITXD",89,0)
 ;;9002226.02101,"1895,140 ",.02)
"RTN","BITXD",90,0)
 ;;140
"RTN","BITXD",91,0)
 ;;9002226.02101,"1895,141 ",.01)
"RTN","BITXD",92,0)
 ;;141
"RTN","BITXD",93,0)
 ;;9002226.02101,"1895,141 ",.02)
"RTN","BITXD",94,0)
 ;;141
"RTN","BITXD",95,0)
 ;;9002226.02101,"1895,144 ",.01)
"RTN","BITXD",96,0)
 ;;144
"RTN","BITXD",97,0)
 ;;9002226.02101,"1895,144 ",.02)
"RTN","BITXD",98,0)
 ;;144
"RTN","BITXD",99,0)
 ;;9002226.02101,"1895,149 ",.01)
"RTN","BITXD",100,0)
 ;;149
"RTN","BITXD",101,0)
 ;;9002226.02101,"1895,149 ",.02)
"RTN","BITXD",102,0)
 ;;149
"RTN","BITXD",103,0)
 ;;9002226.02101,"1895,15 ",.01)
"RTN","BITXD",104,0)
 ;;15
"RTN","BITXD",105,0)
 ;;9002226.02101,"1895,15 ",.02)
"RTN","BITXD",106,0)
 ;;15
"RTN","BITXD",107,0)
 ;;9002226.02101,"1895,150 ",.01)
"RTN","BITXD",108,0)
 ;;150
"RTN","BITXD",109,0)
 ;;9002226.02101,"1895,150 ",.02)
"RTN","BITXD",110,0)
 ;;150
"RTN","BITXD",111,0)
 ;;9002226.02101,"1895,151 ",.01)
"RTN","BITXD",112,0)
 ;;151
"RTN","BITXD",113,0)
 ;;9002226.02101,"1895,151 ",.02)
"RTN","BITXD",114,0)
 ;;151
"RTN","BITXD",115,0)
 ;;9002226.02101,"1895,153 ",.01)
"RTN","BITXD",116,0)
 ;;153
"RTN","BITXD",117,0)
 ;;9002226.02101,"1895,153 ",.02)
"RTN","BITXD",118,0)
 ;;153
"RTN","BITXD",119,0)
 ;;9002226.02101,"1895,155 ",.01)
"RTN","BITXD",120,0)
 ;;155
"RTN","BITXD",121,0)
 ;;9002226.02101,"1895,155 ",.02)
"RTN","BITXD",122,0)
 ;;155
"RTN","BITXD",123,0)
 ;;9002226.02101,"1895,158 ",.01)
"RTN","BITXD",124,0)
 ;;158
"RTN","BITXD",125,0)
 ;;9002226.02101,"1895,158 ",.02)
"RTN","BITXD",126,0)
 ;;158
"RTN","BITXD",127,0)
 ;;9002226.02101,"1895,16 ",.01)
"RTN","BITXD",128,0)
 ;;16
"RTN","BITXD",129,0)
 ;;9002226.02101,"1895,16 ",.02)
"RTN","BITXD",130,0)
 ;;16
"RTN","BITXD",131,0)
 ;;9002226.02101,"1895,161 ",.01)
"RTN","BITXD",132,0)
 ;;161
"RTN","BITXD",133,0)
 ;;9002226.02101,"1895,161 ",.02)
"RTN","BITXD",134,0)
 ;;161
"RTN","BITXD",135,0)
 ;;9002226.02101,"1895,88 ",.01)
"RTN","BITXD",136,0)
 ;;88
"RTN","BITXD",137,0)
 ;;9002226.02101,"1895,88 ",.02)
"RTN","BITXD",138,0)
 ;;88
"RTN","BITXD",139,0)
 ;
"RTN","BITXD",140,0)
OTHER ; OTHER ROUTINES
"RTN","BITXD",141,0)
 Q
"RTN","BIUTL1")
0^149^B88339060
"RTN","BIUTL1",1,0)
BIUTL1 ;IHS/CMI/MWR - UTIL: PATIENT DEMOGRAPHICS; MAY 10, 2010
"RTN","BIUTL1",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BIUTL1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL1",4,0)
 ;;  RETRIEVE PATIENTS FOR DUE LISTS & LETTERS.
"RTN","BIUTL1",5,0)
 ;;  PATCH 2: Add YY option to DOBF.  DOBF
"RTN","BIUTL1",6,0)
 ;
"RTN","BIUTL1",7,0)
 ;----------
"RTN","BIUTL1",8,0)
NAME(DFN,ORDER) ;EP
"RTN","BIUTL1",9,0)
 ;---> Return text of Patient Name.
"RTN","BIUTL1",10,0)
 ;---> Parameters:
"RTN","BIUTL1",11,0)
 ;     1 - DFN   (req) Patient's IEN (DFN).
"RTN","BIUTL1",12,0)
 ;     2 - ORDER (opt) ""/0=Last,First   2=First Only
"RTN","BIUTL1",13,0)
 ;                        1=First Last   3=Last Only
"RTN","BIUTL1",14,0)
 ;
"RTN","BIUTL1",15,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","BIUTL1",16,0)
 Q:'$D(^DPT(DFN,0)) "Unknown"
"RTN","BIUTL1",17,0)
 N X S X=$P(^DPT(DFN,0),U)
"RTN","BIUTL1",18,0)
 Q:'$G(ORDER) X
"RTN","BIUTL1",19,0)
 S X=$$FL(X)
"RTN","BIUTL1",20,0)
 Q:ORDER=1 X
"RTN","BIUTL1",21,0)
 Q:ORDER=2 $P(X," ")
"RTN","BIUTL1",22,0)
 Q:ORDER=3 $P(X," ",2)
"RTN","BIUTL1",23,0)
 Q "UNKNOWN ORDER"
"RTN","BIUTL1",24,0)
 ;
"RTN","BIUTL1",25,0)
 ;
"RTN","BIUTL1",26,0)
 ;----------
"RTN","BIUTL1",27,0)
FL(X) ;EP
"RTN","BIUTL1",28,0)
 ;---> Switch First and Last Names.
"RTN","BIUTL1",29,0)
 Q $P($P(X,",",2)," ")_" "_$P(X,",")
"RTN","BIUTL1",30,0)
 ;
"RTN","BIUTL1",31,0)
 ;
"RTN","BIUTL1",32,0)
 ;----------
"RTN","BIUTL1",33,0)
DOB(DFN) ;EP
"RTN","BIUTL1",34,0)
 ;---> Return Patient's Date of Birth in Fileman format.
"RTN","BIUTL1",35,0)
 ;---> Parameters:
"RTN","BIUTL1",36,0)
 ;     1 - DFN   (req) Patient's IEN (DFN).
"RTN","BIUTL1",37,0)
 ;
"RTN","BIUTL1",38,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","BIUTL1",39,0)
 Q:'$P($G(^DPT(DFN,0)),U,3) "NOT ENTERED"
"RTN","BIUTL1",40,0)
 Q $P(^DPT(DFN,0),U,3)
"RTN","BIUTL1",41,0)
 ;
"RTN","BIUTL1",42,0)
 ;
"RTN","BIUTL1",43,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BIUTL1",44,0)
 ;---> Add BIYY option/parameter to DOBF
"RTN","BIUTL1",45,0)
 ;----------
"RTN","BIUTL1",46,0)
DOBF(DFN,BIDT,BINOA,BISL,BIADT,BIYY) ;EP
"RTN","BIUTL1",47,0)
 ;---> Date of Birth formatted "09-Sep-1994 (35 Months)"
"RTN","BIUTL1",48,0)
 ;---> Parameters:
"RTN","BIUTL1",49,0)
 ;     1 - DFN   (req) Patient's IEN (DFN).
"RTN","BIUTL1",50,0)
 ;     2 - BIDT  (opt) Date on which Age should be calculated.
"RTN","BIUTL1",51,0)
 ;     3 - BINOA (opt) 1=No age (don't append age).
"RTN","BIUTL1",52,0)
 ;     4 - BISL  (opt) 1=Slash Date Format: MM/DD/YYYY
"RTN","BIUTL1",53,0)
 ;     5 - BIADT (opt) 1=Append "on BIDT" to age.
"RTN","BIUTL1",54,0)
 ;     6 - BIYY  (opt) 1=2-digit year.
"RTN","BIUTL1",55,0)
 ;
"RTN","BIUTL1",56,0)
 N X,Y
"RTN","BIUTL1",57,0)
 S X=$$DOB($G(DFN))
"RTN","BIUTL1",58,0)
 Q:'X X
"RTN","BIUTL1",59,0)
 S X=$S($G(BISL):$$SLDT2^BIUTL5(X,+$G(BIYY)),1:$$TXDT1^BIUTL5(X))
"RTN","BIUTL1",60,0)
 Q:$G(BINOA) X
"RTN","BIUTL1",61,0)
 S Y=$$AGEF(DFN,$G(BIDT))
"RTN","BIUTL1",62,0)
 S:Y["DECEASED" Y="DECEASED"
"RTN","BIUTL1",63,0)
 S X=X_" ("_Y
"RTN","BIUTL1",64,0)
 I $G(BIADT),$G(BIDT) S X=X_" on "_$$SLDT2^BIUTL5(BIDT,+$G(BIYY))
"RTN","BIUTL1",65,0)
 S X=X_")"
"RTN","BIUTL1",66,0)
 Q X
"RTN","BIUTL1",67,0)
 ;**********
"RTN","BIUTL1",68,0)
 ;
"RTN","BIUTL1",69,0)
 ;
"RTN","BIUTL1",70,0)
 ;----------
"RTN","BIUTL1",71,0)
AGE(DFN,BIZ,BIDT) ;EP
"RTN","BIUTL1",72,0)
 ;---> Return Patient's Age.
"RTN","BIUTL1",73,0)
 ;---> Parameters:
"RTN","BIUTL1",74,0)
 ;     1 - DFN  (req) IEN in PATIENT File.
"RTN","BIUTL1",75,0)
 ;     2 - BIZ  (opt) BIZ=1,2,3  1=years, 2=months, 3=days.
"RTN","BIUTL1",76,0)
 ;                               2 will be assumed if not passed.
"RTN","BIUTL1",77,0)
 ;     3 - BIDT (opt) Date on which Age should be calculated.
"RTN","BIUTL1",78,0)
 ;
"RTN","BIUTL1",79,0)
 N BIDOB,X,X1,X2  S:$G(BIZ)="" BIZ=2
"RTN","BIUTL1",80,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","BIUTL1",81,0)
 S BIDOB=$$DOB(DFN)
"RTN","BIUTL1",82,0)
 Q:'BIDOB "Unknown"
"RTN","BIUTL1",83,0)
 I '$G(BIDT)&($$DECEASED(DFN)) D  Q X
"RTN","BIUTL1",84,0)
 .S X="DECEASED: "_$$TXDT1^BIUTL5(+^DPT(DFN,.35))
"RTN","BIUTL1",85,0)
 S:'$G(DT) DT=$$DT^XLFDT
"RTN","BIUTL1",86,0)
 S:'$G(BIDT) BIDT=DT
"RTN","BIUTL1",87,0)
 Q:BIDT<BIDOB "NOT BORN"
"RTN","BIUTL1",88,0)
 ;
"RTN","BIUTL1",89,0)
 ;---> Age in Years.
"RTN","BIUTL1",90,0)
 N BIAGEY,BIAGEM,BID1,BID2,BIM1,BIM2,BIY1,BIY2
"RTN","BIUTL1",91,0)
 S BIM1=$E(BIDOB,4,7),BIM2=$E(BIDT,4,7)
"RTN","BIUTL1",92,0)
 S BIY1=$E(BIDOB,1,3),BIY2=$E(BIDT,1,3)
"RTN","BIUTL1",93,0)
 S BIAGEY=BIY2-BIY1 S:BIM2<BIM1 BIAGEY=BIAGEY-1
"RTN","BIUTL1",94,0)
 S:BIAGEY<1 BIAGEY="<1"
"RTN","BIUTL1",95,0)
 Q:BIZ=1 BIAGEY
"RTN","BIUTL1",96,0)
 ;
"RTN","BIUTL1",97,0)
 ;---> Age in Months.
"RTN","BIUTL1",98,0)
 S BID1=$E(BIM1,3,4),BIM1=$E(BIM1,1,2)
"RTN","BIUTL1",99,0)
 S BID2=$E(BIM2,3,4),BIM2=$E(BIM2,1,2)
"RTN","BIUTL1",100,0)
 S BIAGEM=12*BIAGEY
"RTN","BIUTL1",101,0)
 I BIM2=BIM1&(BID2<BID1) S BIAGEM=BIAGEM+12
"RTN","BIUTL1",102,0)
 I BIM2>BIM1 S BIAGEM=BIAGEM+BIM2-BIM1
"RTN","BIUTL1",103,0)
 I BIM2<BIM1 S BIAGEM=BIAGEM+BIM2+(12-BIM1)
"RTN","BIUTL1",104,0)
 S:BID2<BID1 BIAGEM=BIAGEM-1
"RTN","BIUTL1",105,0)
 Q:BIZ=2 BIAGEM
"RTN","BIUTL1",106,0)
 ;
"RTN","BIUTL1",107,0)
 ;---> Age in Days.
"RTN","BIUTL1",108,0)
 S X1=BIDT,X2=BIDOB
"RTN","BIUTL1",109,0)
 D ^%DTC
"RTN","BIUTL1",110,0)
 Q X
"RTN","BIUTL1",111,0)
 ;
"RTN","BIUTL1",112,0)
 ;
"RTN","BIUTL1",113,0)
 ;----------
"RTN","BIUTL1",114,0)
AGEF(DFN,BIDT) ;EP
"RTN","BIUTL1",115,0)
 ;---> Age formatted "35 Months" or "23 Years"
"RTN","BIUTL1",116,0)
 ;---> Parameters:
"RTN","BIUTL1",117,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",118,0)
 ;     2 - BIDT (opt) Date on which Age should be calculated.
"RTN","BIUTL1",119,0)
 ;
"RTN","BIUTL1",120,0)
 N Y
"RTN","BIUTL1",121,0)
 S Y=$$AGE(DFN,2,$G(BIDT))
"RTN","BIUTL1",122,0)
 Q:Y["DECEASED" Y
"RTN","BIUTL1",123,0)
 Q:Y["NOT BORN" Y
"RTN","BIUTL1",124,0)
 ;
"RTN","BIUTL1",125,0)
 ;---> If over 60 months, return years.
"RTN","BIUTL1",126,0)
 I Y>60 S Y=$$AGE(DFN,1,$G(BIDT)) Q Y_$S(Y=1:"year",1:" yrs")
"RTN","BIUTL1",127,0)
 ;
"RTN","BIUTL1",128,0)
 ;---> If under 1 month return days.
"RTN","BIUTL1",129,0)
 I Y<1 S Y=$$AGE(DFN,3,$G(BIDT)) Q Y_$S(Y=1:" day",1:" days")
"RTN","BIUTL1",130,0)
 ;
"RTN","BIUTL1",131,0)
 ;---> Return months
"RTN","BIUTL1",132,0)
 Q Y_$S(Y=1:" mth",1:" mths")
"RTN","BIUTL1",133,0)
 ;
"RTN","BIUTL1",134,0)
 ;
"RTN","BIUTL1",135,0)
 ;----------
"RTN","BIUTL1",136,0)
DECEASED(DFN,BIDT) ;EP
"RTN","BIUTL1",137,0)
 ;---> Return 1 if patient is deceased, 0 if not deceased.
"RTN","BIUTL1",138,0)
 ;---> Parameters:
"RTN","BIUTL1",139,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",140,0)
 ;     2 - BIDT (opt) If BIDT=1 return Date of Death (Fileman format).
"RTN","BIUTL1",141,0)
 ;
"RTN","BIUTL1",142,0)
 Q:'$G(DFN) 0
"RTN","BIUTL1",143,0)
 N X S X=+$G(^DPT(DFN,.35))
"RTN","BIUTL1",144,0)
 Q:'X 0
"RTN","BIUTL1",145,0)
 Q:'$G(BIDT) 1
"RTN","BIUTL1",146,0)
 Q X
"RTN","BIUTL1",147,0)
 ;
"RTN","BIUTL1",148,0)
 ;
"RTN","BIUTL1",149,0)
 ;----------
"RTN","BIUTL1",150,0)
SEX(DFN,PRON) ;EP
"RTN","BIUTL1",151,0)
 ;---> Return "F" is patient is female, "M" if male.
"RTN","BIUTL1",152,0)
 ;---> Parameters:
"RTN","BIUTL1",153,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",154,0)
 ;     2 - PRON (opt) Pronoun: 1=he/she, 2=him/her,3=his,her
"RTN","BIUTL1",155,0)
 ;
"RTN","BIUTL1",156,0)
 Q:'$G(DFN) ""
"RTN","BIUTL1",157,0)
 Q:'$D(^DPT(DFN,0)) ""
"RTN","BIUTL1",158,0)
 N X S X=$P(^DPT(DFN,0),U,2)
"RTN","BIUTL1",159,0)
 Q:'$G(PRON) X
"RTN","BIUTL1",160,0)
 I PRON=1 Q $S(X="F":"she",1:"he")
"RTN","BIUTL1",161,0)
 I PRON=2 Q $S(X="F":"her",1:"him")
"RTN","BIUTL1",162,0)
 I PRON=3 Q $S(X="F":"her",1:"his")
"RTN","BIUTL1",163,0)
 Q X
"RTN","BIUTL1",164,0)
 ;
"RTN","BIUTL1",165,0)
 ;
"RTN","BIUTL1",166,0)
 ;----------
"RTN","BIUTL1",167,0)
SEXW(DFN) ;EP
"RTN","BIUTL1",168,0)
 ;---> Return Patient sex: "Female"/"Male".
"RTN","BIUTL1",169,0)
 ;---> Parameters:
"RTN","BIUTL1",170,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",171,0)
 ;
"RTN","BIUTL1",172,0)
 Q:$$SEX(DFN)="M" "Male"
"RTN","BIUTL1",173,0)
 Q:$$SEX(DFN)="F" "Female"
"RTN","BIUTL1",174,0)
 Q "Unknown"
"RTN","BIUTL1",175,0)
 ;
"RTN","BIUTL1",176,0)
 ;
"RTN","BIUTL1",177,0)
 ;----------
"RTN","BIUTL1",178,0)
ACTIVE(DFN) ;PEP - Return Patient's Active Status in Immunization Package.
"RTN","BIUTL1",179,0)
 ;---> Return text of Patient's Active Status.
"RTN","BIUTL1",180,0)
 ;---> $$ACTIVE^BIUTL1(DFN) will return values of either:
"RTN","BIUTL1",181,0)
 ;---> "Deceased","Inactive", or "Active".
"RTN","BIUTL1",182,0)
 ;---> Parameters:
"RTN","BIUTL1",183,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",184,0)
 ;
"RTN","BIUTL1",185,0)
 N X
"RTN","BIUTL1",186,0)
 S X=$$DECEASED(DFN)
"RTN","BIUTL1",187,0)
 Q:X>0 "Deceased"
"RTN","BIUTL1",188,0)
 S X=$$INACT(DFN)
"RTN","BIUTL1",189,0)
 Q:X "Inactive"
"RTN","BIUTL1",190,0)
 Q:X]"" X
"RTN","BIUTL1",191,0)
 Q "Active"
"RTN","BIUTL1",192,0)
 ;
"RTN","BIUTL1",193,0)
 ;
"RTN","BIUTL1",194,0)
 ;----------
"RTN","BIUTL1",195,0)
INACT(DFN,TEXT) ;PEP - Return date this patient became Inactive in Immunization.
"RTN","BIUTL1",196,0)
 ;---> Return date this patient became Inactive.
"RTN","BIUTL1",197,0)
 ;---> $$INACT^BIUTL1(DFN) will return values of either:
"RTN","BIUTL1",198,0)
 ;---> "NO PATIENT","UNKNOWN", "NOT IN REGISTER", DATE INACTIVE, or null.
"RTN","BIUTL1",199,0)
 ;
"RTN","BIUTL1",200,0)
 ;---> NOTE: If $$INACT^BIUTL1(DFN)="" then the Patient is Active.
"RTN","BIUTL1",201,0)
 ;
"RTN","BIUTL1",202,0)
 ;---> Parameters:
"RTN","BIUTL1",203,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",204,0)
 ;     2 - TEXT (opt) If TEXT=1, return text of date.
"RTN","BIUTL1",205,0)
 ;
"RTN","BIUTL1",206,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","BIUTL1",207,0)
 Q:'$D(^DPT(DFN,0)) "UNKNOWN"
"RTN","BIUTL1",208,0)
 Q:'$D(^BIP(DFN,0)) "NOT IN REGISTER"
"RTN","BIUTL1",209,0)
 N X S X=$P(^BIP(DFN,0),U,8)
"RTN","BIUTL1",210,0)
 Q:'X ""
"RTN","BIUTL1",211,0)
 Q:'$G(TEXT) X
"RTN","BIUTL1",212,0)
 Q $$TXDT1^BIUTL5(X)
"RTN","BIUTL1",213,0)
 ;
"RTN","BIUTL1",214,0)
 ;
"RTN","BIUTL1",215,0)
 ;----------
"RTN","BIUTL1",216,0)
INACTRE(DFN,BICODE) ;EP
"RTN","BIUTL1",217,0)
 ;---> Return Reason for Inactive.
"RTN","BIUTL1",218,0)
 ;---> Parameters:
"RTN","BIUTL1",219,0)
 ;     1 - DFN    (req) Patient's IEN (DFN).
"RTN","BIUTL1",220,0)
 ;     2 - BICODE (opt) If BICODE=1 return Code rather than text.
"RTN","BIUTL1",221,0)
 ;
"RTN","BIUTL1",222,0)
 Q:'$G(DFN) ""
"RTN","BIUTL1",223,0)
 N X,Y,Z S X=$P($G(^BIP(DFN,0)),U,16)
"RTN","BIUTL1",224,0)
 Q:(X="") ""
"RTN","BIUTL1",225,0)
 S Y=$P($G(^DD(9002084,.16,0)),U,3)
"RTN","BIUTL1",226,0)
 S Z=$P($P(Y,X_":",2),";")
"RTN","BIUTL1",227,0)
 S:Z="" Z="Not Recorded"
"RTN","BIUTL1",228,0)
 Q Z
"RTN","BIUTL1",229,0)
 ;
"RTN","BIUTL1",230,0)
 ;
"RTN","BIUTL1",231,0)
 ;----------
"RTN","BIUTL1",232,0)
INACTUSR(DFN,Z) ;EP
"RTN","BIUTL1",233,0)
 ;---> Return User who made this Patient Inactive.
"RTN","BIUTL1",234,0)
 ;---> Parameters:
"RTN","BIUTL1",235,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",236,0)
 ;     2 - Z    (opt) If Z=1 return IEN of user.
"RTN","BIUTL1",237,0)
 ;
"RTN","BIUTL1",238,0)
 Q:'$G(DFN) ""
"RTN","BIUTL1",239,0)
 N X S X=$P($G(^BIP(DFN,0)),U,23)
"RTN","BIUTL1",240,0)
 Q:$G(Z) X
"RTN","BIUTL1",241,0)
 Q $$PERSON(X)
"RTN","BIUTL1",242,0)
 ;
"RTN","BIUTL1",243,0)
 ;
"RTN","BIUTL1",244,0)
 ;----------
"RTN","BIUTL1",245,0)
INACTREG(DFN,DUZ2) ;EP
"RTN","BIUTL1",246,0)
 ;---> Return 1 if patient does not have an Active Chart in
"RTN","BIUTL1",247,0)
 ;---> RPMS Patient Registration at this site DUZ(2).
"RTN","BIUTL1",248,0)
 ;---> Parameters:
"RTN","BIUTL1",249,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",250,0)
 ;     2 - DUZ2 (req) IEN of site DUZ(2) to check for Active Chart.
"RTN","BIUTL1",251,0)
 ;
"RTN","BIUTL1",252,0)
 Q:'$G(DFN) 1
"RTN","BIUTL1",253,0)
 Q:'$G(DUZ2) 1
"RTN","BIUTL1",254,0)
 Q:'$D(^AUPNPAT(DFN,41,DUZ2,0)) 1
"RTN","BIUTL1",255,0)
 ;
"RTN","BIUTL1",256,0)
 ;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BIUTL1",257,0)
 ;---> Correct test for Active Chart at site DUZ2.
"RTN","BIUTL1",258,0)
 ;Q:$P($D(^AUPNPAT(DFN,41,DUZ2,0)),"^",3) 1
"RTN","BIUTL1",259,0)
 Q:$P(^AUPNPAT(DFN,41,DUZ2,0),"^",3) 1
"RTN","BIUTL1",260,0)
 ;**********
"RTN","BIUTL1",261,0)
 ;
"RTN","BIUTL1",262,0)
 Q 0
"RTN","BIUTL1",263,0)
 ;
"RTN","BIUTL1",264,0)
 ;
"RTN","BIUTL1",265,0)
 ;----------
"RTN","BIUTL1",266,0)
ENTERED(DFN,BIA,BIT) ;EP
"RTN","BIUTL1",267,0)
 ;---> Return date this patient was entered.
"RTN","BIUTL1",268,0)
 ;---> Parameters:
"RTN","BIUTL1",269,0)
 ;     1 - DFN (req) Patient's IEN (DFN).
"RTN","BIUTL1",270,0)
 ;     2 - BIA (opt) If BIA="", return Date Entered.
"RTN","BIUTL1",271,0)
 ;                   If BIA=1, return 1 if Automatically entered during Scan.
"RTN","BIUTL1",272,0)
 ;     3 - BIT (opt) If BIT=1, return text of Date or Auto field.
"RTN","BIUTL1",273,0)
 ;
"RTN","BIUTL1",274,0)
 Q:'$G(DFN) ""
"RTN","BIUTL1",275,0)
 Q:'$D(^BIP(DFN,0)) ""
"RTN","BIUTL1",276,0)
 N X,Y
"RTN","BIUTL1",277,0)
 S Y=$S($G(BIA):22,1:21)
"RTN","BIUTL1",278,0)
 S X=$P(^BIP(DFN,0),U,Y)
"RTN","BIUTL1",279,0)
 Q:$G(BIA) $S($G(BIT):$S(X:"Automatically",1:"Manually"),1:X)
"RTN","BIUTL1",280,0)
 Q:'$G(BIT) X
"RTN","BIUTL1",281,0)
 Q $$TXDT1^BIUTL5(X)
"RTN","BIUTL1",282,0)
 ;
"RTN","BIUTL1",283,0)
 ;
"RTN","BIUTL1",284,0)
 ;----------
"RTN","BIUTL1",285,0)
MOVEDLOC(DFN) ;EP
"RTN","BIUTL1",286,0)
 ;---> Return Location where patient moved is receiving treatment elsewhere.
"RTN","BIUTL1",287,0)
 ;---> Parameters:
"RTN","BIUTL1",288,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",289,0)
 ;
"RTN","BIUTL1",290,0)
 Q:'$G(DFN) ""
"RTN","BIUTL1",291,0)
 Q $P($G(^BIP(DFN,0)),U,12)
"RTN","BIUTL1",292,0)
 ;
"RTN","BIUTL1",293,0)
 ;
"RTN","BIUTL1",294,0)
 ;----------
"RTN","BIUTL1",295,0)
LASTLET(DFN,TEXT) ;EP
"RTN","BIUTL1",296,0)
 ;---> Return Fileman date of the last letter sent to this patient.
"RTN","BIUTL1",297,0)
 ;---> Parameters:
"RTN","BIUTL1",298,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",299,0)
 ;     2 - TEXT (opt) If TEXT=1, return text of date.
"RTN","BIUTL1",300,0)
 ;
"RTN","BIUTL1",301,0)
 Q:'$G(DFN) 0
"RTN","BIUTL1",302,0)
 Q:'$D(^DPT(DFN,0)) "None"
"RTN","BIUTL1",303,0)
 Q:'$D(^BIP(DFN,0)) "Not in Register"
"RTN","BIUTL1",304,0)
 N X S X=$P(^BIP(DFN,0),U,14)
"RTN","BIUTL1",305,0)
 Q:'X "None"
"RTN","BIUTL1",306,0)
 Q:'$G(TEXT) X
"RTN","BIUTL1",307,0)
 Q $$TXDT1^BIUTL5(X)
"RTN","BIUTL1",308,0)
 ;
"RTN","BIUTL1",309,0)
 ;
"RTN","BIUTL1",310,0)
 ;----------
"RTN","BIUTL1",311,0)
NAMAGE(DFN) ;EP
"RTN","BIUTL1",312,0)
 ;---> Return Patient Name concatenated with age.
"RTN","BIUTL1",313,0)
 ;---> Parameters:
"RTN","BIUTL1",314,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",315,0)
 ;
"RTN","BIUTL1",316,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","BIUTL1",317,0)
 Q $$NAME(DFN)_" ("_$$AGE(DFN)_"y/o)"
"RTN","BIUTL1",318,0)
 ;
"RTN","BIUTL1",319,0)
 ;
"RTN","BIUTL1",320,0)
 ;----------
"RTN","BIUTL1",321,0)
SSN(DFN) ;EP
"RTN","BIUTL1",322,0)
 ;---> Return Social Security Number (SSN).
"RTN","BIUTL1",323,0)
 ;---> Parameters:
"RTN","BIUTL1",324,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",325,0)
 N X
"RTN","BIUTL1",326,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","BIUTL1",327,0)
 Q:'$D(^DPT(DFN,0)) "Unknown"
"RTN","BIUTL1",328,0)
 S X=$P(^DPT(DFN,0),U,9)
"RTN","BIUTL1",329,0)
 Q:X']"" "Unknown"
"RTN","BIUTL1",330,0)
 Q X
"RTN","BIUTL1",331,0)
 ;
"RTN","BIUTL1",332,0)
 ;
"RTN","BIUTL1",333,0)
 ;----------
"RTN","BIUTL1",334,0)
HRCN(DFN,DUZ2,BIX) ;EP
"RTN","BIUTL1",335,0)
 ;---> Return IHS Health Record Number.
"RTN","BIUTL1",336,0)
 ;---> Parameters:
"RTN","BIUTL1",337,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",338,0)
 ;     2 - DUZ2 (opt) User's Site/Location IEN.  If no DUZ2
"RTN","BIUTL1",339,0)
 ;                    provided, function will look for DUZ(2).
"RTN","BIUTL1",340,0)
 ;     3 - BIX  (opt) If BIX=1 return HRCN with no dashes.
"RTN","BIUTL1",341,0)
 ;
"RTN","BIUTL1",342,0)
 ;  vvv83
"RTN","BIUTL1",343,0)
 S:'$G(DUZ2) DUZ2=$G(DUZ(2))
"RTN","BIUTL1",344,0)
 Q:'$G(DFN)!('$G(DUZ2)) "No Value"
"RTN","BIUTL1",345,0)
 Q:'$D(^AUPNPAT(DFN,41,DUZ2,0)) "Not Here"
"RTN","BIUTL1",346,0)
 Q:'+$P(^AUPNPAT(DFN,41,DUZ2,0),"^",2) "No Rec#"
"RTN","BIUTL1",347,0)
 N Y S Y=$P(^AUPNPAT(DFN,41,DUZ2,0),"^",2)
"RTN","BIUTL1",348,0)
 Q:$G(BIX) Y
"RTN","BIUTL1",349,0)
 Q:'+Y Y
"RTN","BIUTL1",350,0)
 Q:'$$DASH(DUZ2) Y
"RTN","BIUTL1",351,0)
 I $L(Y)=7 D  Q Y
"RTN","BIUTL1",352,0)
 .S Y=$TR("123-45-67",1234567,Y)
"RTN","BIUTL1",353,0)
 S Y=$E("00000",0,6-$L(Y))_Y
"RTN","BIUTL1",354,0)
 S Y=$TR("12-34-56",123456,Y)
"RTN","BIUTL1",355,0)
 Q Y
"RTN","BIUTL1",356,0)
 ;
"RTN","BIUTL1",357,0)
 ;
"RTN","BIUTL1",358,0)
 ;----------
"RTN","BIUTL1",359,0)
DASH(BIDUZ2) ;EP
"RTN","BIUTL1",360,0)
 ;---> Return 1 if Site Parameter says return Chart#s with dashes.
"RTN","BIUTL1",361,0)
 ;---> Parameters:
"RTN","BIUTL1",362,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL1",363,0)
 ;
"RTN","BIUTL1",364,0)
 Q +$P($G(^BISITE(+$G(BIDUZ2),0)),U,12)
"RTN","BIUTL1",365,0)
 ;
"RTN","BIUTL1",366,0)
 ;
"RTN","BIUTL1",367,0)
 ;----------
"RTN","BIUTL1",368,0)
HPHONE(DFN) ;EP
"RTN","BIUTL1",369,0)
 ;---> Return patient's home phone number.
"RTN","BIUTL1",370,0)
 ;---> Parameters:
"RTN","BIUTL1",371,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",372,0)
 ;
"RTN","BIUTL1",373,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",374,0)
 Q:'$D(^DPT(DFN,.13)) "Unknown"
"RTN","BIUTL1",375,0)
 Q:$P(^DPT(DFN,.13),U)="" "Unknown"
"RTN","BIUTL1",376,0)
 Q $P(^DPT(DFN,.13),U)
"RTN","BIUTL1",377,0)
 ;
"RTN","BIUTL1",378,0)
 ;
"RTN","BIUTL1",379,0)
 ;********** PATCH 1, SEP 21,2006, IHS/CMI/MWR
"RTN","BIUTL1",380,0)
 ;---> Add ability to retrieve 2nd and 3rd Street Address lines.
"RTN","BIUTL1",381,0)
 ;----------
"RTN","BIUTL1",382,0)
STREET(DFN,Z) ;EP
"RTN","BIUTL1",383,0)
 ;---> Return patient's street address.
"RTN","BIUTL1",384,0)
 ;---> Parameters:
"RTN","BIUTL1",385,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",386,0)
 ;     2 - Z    (opt) If Z=2 return Line 2 of patient's address.
"RTN","BIUTL1",387,0)
 ;                    If Z=3 return Line 3 of patient's address.
"RTN","BIUTL1",388,0)
 ;
"RTN","BIUTL1",389,0)
 N X S X=$S($G(Z)=2:2,$G(Z)=3:3,1:1)
"RTN","BIUTL1",390,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",391,0)
 Q:'$D(^DPT(DFN,.11)) "Unknown"
"RTN","BIUTL1",392,0)
 ;---> Only return "Unknown" for the first line.
"RTN","BIUTL1",393,0)
 Q:$P(^DPT(DFN,.11),U,X)="" $S(X=1:"Unknown",1:"")
"RTN","BIUTL1",394,0)
 Q $P(^DPT(DFN,.11),U,X)
"RTN","BIUTL1",395,0)
 ;
"RTN","BIUTL1",396,0)
 ;
"RTN","BIUTL1",397,0)
 ;----------
"RTN","BIUTL1",398,0)
CITY(DFN) ;EP
"RTN","BIUTL1",399,0)
 ;---> Return patient's city.
"RTN","BIUTL1",400,0)
 ;---> Parameters:
"RTN","BIUTL1",401,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",402,0)
 ;
"RTN","BIUTL1",403,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",404,0)
 Q:'$D(^DPT(DFN,.11)) "Unknown"
"RTN","BIUTL1",405,0)
 Q:$P(^DPT(DFN,.11),U,4)="" "Unknown"
"RTN","BIUTL1",406,0)
 Q $P(^DPT(DFN,.11),U,4)
"RTN","BIUTL1",407,0)
 ;
"RTN","BIUTL1",408,0)
 ;
"RTN","BIUTL1",409,0)
 ;----------
"RTN","BIUTL1",410,0)
STATE(DFN) ;EP
"RTN","BIUTL1",411,0)
 ;---> Return patient's state.
"RTN","BIUTL1",412,0)
 ;---> Parameters:
"RTN","BIUTL1",413,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",414,0)
 ;
"RTN","BIUTL1",415,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",416,0)
 Q:'$D(^DPT(DFN,.11)) "No State"
"RTN","BIUTL1",417,0)
 Q:$P(^DPT(DFN,.11),U,5)="" "No State"
"RTN","BIUTL1",418,0)
 Q $P(^DIC(5,$P(^DPT(DFN,.11),U,5),0),U,2)
"RTN","BIUTL1",419,0)
 ;
"RTN","BIUTL1",420,0)
 ;
"RTN","BIUTL1",421,0)
 ;----------
"RTN","BIUTL1",422,0)
ZIP(DFN) ;EP
"RTN","BIUTL1",423,0)
 ;---> Return patient's zipcode.
"RTN","BIUTL1",424,0)
 ;---> Parameters:
"RTN","BIUTL1",425,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",426,0)
 ;
"RTN","BIUTL1",427,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",428,0)
 Q:'$D(^DPT(DFN,.11)) "No Zip"
"RTN","BIUTL1",429,0)
 Q:$P(^DPT(DFN,.11),U,6)="" "No Zip"
"RTN","BIUTL1",430,0)
 Q $P(^DPT(DFN,.11),U,6)
"RTN","BIUTL1",431,0)
 ;
"RTN","BIUTL1",432,0)
 ;
"RTN","BIUTL1",433,0)
 ;----------
"RTN","BIUTL1",434,0)
CTYSTZ(DFN) ;EP
"RTN","BIUTL1",435,0)
 ;---> Return patient's city, state zip.
"RTN","BIUTL1",436,0)
 ;---> Parameters:
"RTN","BIUTL1",437,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",438,0)
 ;
"RTN","BIUTL1",439,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",440,0)
 Q $$CITY(DFN)_", "_$$STATE(DFN)_"  "_$$ZIP(DFN)
"RTN","BIUTL1",441,0)
 ;
"RTN","BIUTL1",442,0)
 ;
"RTN","BIUTL1",443,0)
 ;----------
"RTN","BIUTL1",444,0)
CMGR(DFN,TEXT,ORDER) ;EP
"RTN","BIUTL1",445,0)
 ;---> Return patient's Case Manager.
"RTN","BIUTL1",446,0)
 ;---> Parameters:
"RTN","BIUTL1",447,0)
 ;     1 - DFN   (req) Patient's IEN (DFN).
"RTN","BIUTL1",448,0)
 ;     2 - TEXT  (opt) If TEXT=1, return text of Case Manager.
"RTN","BIUTL1",449,0)
 ;     3 - ORDER (opt) ""/0=Last,First  1=First Last
"RTN","BIUTL1",450,0)
 ;
"RTN","BIUTL1",451,0)
 N Y
"RTN","BIUTL1",452,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",453,0)
 Q:'$D(^BIP(DFN,0)) "Unknown"
"RTN","BIUTL1",454,0)
 S Y=$P(^BIP(DFN,0),U,10)
"RTN","BIUTL1",455,0)
 Q:'$G(TEXT) Y
"RTN","BIUTL1",456,0)
 Q $$PERSON(Y,$G(ORDER))
"RTN","BIUTL1",457,0)
 ;
"RTN","BIUTL1",458,0)
 ;
"RTN","BIUTL1",459,0)
 ;----------
"RTN","BIUTL1",460,0)
DPRV(DFN,TEXT,ORDER) ;EP
"RTN","BIUTL1",461,0)
 ;---> Return patient's Designated Provider.
"RTN","BIUTL1",462,0)
 ;---> Parameters:
"RTN","BIUTL1",463,0)
 ;     1 - DFN   (req) Patient's IEN (DFN).
"RTN","BIUTL1",464,0)
 ;     2 - TEXT  (opt) If TEXT=1, return text of Case Manager.
"RTN","BIUTL1",465,0)
 ;     3 - ORDER (opt) ""/0=Last,First  1=First Last
"RTN","BIUTL1",466,0)
 ;
"RTN","BIUTL1",467,0)
 N Y,Z
"RTN","BIUTL1",468,0)
 Q:'$G(DFN) "No Patient"
"RTN","BIUTL1",469,0)
 Q:'$D(^BIP(DFN,0)) "Unknown"
"RTN","BIUTL1",470,0)
 Q:'$L($T(^BDPAPI)) "No BDP Pkg"
"RTN","BIUTL1",471,0)
 D ALLDP^BDPAPI(DFN,"DESIGNATED PRIMARY PROVIDER",.Y)
"RTN","BIUTL1",472,0)
 S Z=$P($G(Y("DESIGNATED PRIMARY PROVIDER")),U,2)
"RTN","BIUTL1",473,0)
 Q:'$G(TEXT) Z
"RTN","BIUTL1",474,0)
 Q $$PERSON(Z,$G(ORDER))
"RTN","BIUTL1",475,0)
 ;
"RTN","BIUTL1",476,0)
 ;
"RTN","BIUTL1",477,0)
 ;----------
"RTN","BIUTL1",478,0)
PERSON(X,ORDER) ;EP
"RTN","BIUTL1",479,0)
 ;---> Return person's name from File #200.
"RTN","BIUTL1",480,0)
 ;---> Parameters:
"RTN","BIUTL1",481,0)
 ;     1 - X     (req) Person's IEN in New Person File #200.
"RTN","BIUTL1",482,0)
 ;     2 - ORDER (opt) ""/0=Last,First   1=First Last
"RTN","BIUTL1",483,0)
 ;
"RTN","BIUTL1",484,0)
 Q:'X "Unknown"
"RTN","BIUTL1",485,0)
 Q:'$D(^VA(200,X,0)) "Unknown"
"RTN","BIUTL1",486,0)
 N Y S Y=$P(^VA(200,X,0),U)
"RTN","BIUTL1",487,0)
 Q:'$G(ORDER) Y
"RTN","BIUTL1",488,0)
 Q $$FL(Y)
"RTN","BIUTL1",489,0)
 ;
"RTN","BIUTL1",490,0)
 ;
"RTN","BIUTL1",491,0)
 ;----------
"RTN","BIUTL1",492,0)
PARENT(DFN,BIX) ;EP
"RTN","BIUTL1",493,0)
 ;---> Return Patient's Parent/Guardian name as stored in the
"RTN","BIUTL1",494,0)
 ;---> Immunization database.
"RTN","BIUTL1",495,0)
 ;---> Parameters:
"RTN","BIUTL1",496,0)
 ;     1 - DFN (req) Patient's IEN (DFN).
"RTN","BIUTL1",497,0)
 ;     2 - BIX (opt) If BIX=1, return text for letter address
"RTN","BIUTL1",498,0)
 ;                   (return text "Parent/Guardian of" if no data).
"RTN","BIUTL1",499,0)
 N Y
"RTN","BIUTL1",500,0)
 D
"RTN","BIUTL1",501,0)
 .I '$G(DFN) S Y="" Q
"RTN","BIUTL1",502,0)
 .S Y=$P($G(^BIP(DFN,0)),U,9)
"RTN","BIUTL1",503,0)
 ;---> If no Parent/Guardian in Immunization, check Patient Reg.
"RTN","BIUTL1",504,0)
 ;S:Y="" Y=?
"RTN","BIUTL1",505,0)
 Q:'$G(BIX) Y
"RTN","BIUTL1",506,0)
 Q:Y="" "Parent/Guardian of"
"RTN","BIUTL1",507,0)
 Q Y_", for"
"RTN","BIUTL1",508,0)
 ;
"RTN","BIUTL1",509,0)
 ;
"RTN","BIUTL1",510,0)
 ;----------
"RTN","BIUTL1",511,0)
INELIG(BIDFN) ;EP
"RTN","BIUTL1",512,0)
 ;---> Return 1 if patient is Ineligible in RPMS Patient Registration.
"RTN","BIUTL1",513,0)
 ;---> Parameters:
"RTN","BIUTL1",514,0)
 ;     1 - BIDFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",515,0)
 ;
"RTN","BIUTL1",516,0)
 Q:'$G(BIDFN) 0
"RTN","BIUTL1",517,0)
 Q:$P($G(^AUPNPAT(BIDFN,11)),"^",12)="I" 1
"RTN","BIUTL1",518,0)
 Q 0
"RTN","BIUTL1",519,0)
 ;
"RTN","BIUTL1",520,0)
 ;
"RTN","BIUTL1",521,0)
 ;----------
"RTN","BIUTL1",522,0)
CONSENT(BIDFN) ;EP
"RTN","BIUTL1",523,0)
 ;---> Return 1 if patient or guardian consented to participation in the state
"RTN","BIUTL1",524,0)
 ;---> registry.
"RTN","BIUTL1",525,0)
 ;---> Parameters:
"RTN","BIUTL1",526,0)
 ;     1 - BIDFN  (req) Patient's IEN (DFN).
"RTN","BIUTL1",527,0)
 ;
"RTN","BIUTL1",528,0)
 Q:'$G(BIDFN) ""
"RTN","BIUTL1",529,0)
 Q $P($G(^BIP(BIDFN,0)),"^",24)
"RTN","BIUTL11")
0^150^B120337184
"RTN","BIUTL11",1,0)
BIUTL11 ;IHS/CMI/MWR - UTIL: PATIENT INFO; AUG 10,2010
"RTN","BIUTL11",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIUTL11",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL11",4,0)
 ;;  UTILITY: PATIENT FUNCTIONS: CONTRAS, INPATIENT, HIDOSE.
"RTN","BIUTL11",5,0)
 ;;  PATCH 1: Correct typo "Q", so that unmatched CVX returns 0 (zero),
"RTN","BIUTL11",6,0)
 ;;           not "Q".  LASTIMM+17
"RTN","BIUTL11",7,0)
 ;;  PATCH 3: Append date to Hx of Chickenpox Reason.  CONTRA+45
"RTN","BIUTL11",8,0)
 ;;  PATCH 5: Unused call, was never a P.E.P..  CONTR+0
"RTN","BIUTL11",9,0)
 ;;  PATCH 8: For Hx of Chicken Pox, do NOT contraindicate Zoster (CVX=121). CONTRA+62
"RTN","BIUTL11",10,0)
 ;;  PATCH 9: Add GOTDOSE call: check if patient received a dose.  GOTDOSE+0
"RTN","BIUTL11",11,0)
 ;
"RTN","BIUTL11",12,0)
 ;
"RTN","BIUTL11",13,0)
 ;----------
"RTN","BIUTL11",14,0)
CONTRA(BIDFN,A,BIREF,BIDATE) ;EP
"RTN","BIUTL11",15,0)
 ;---> Return an array of a patient's ImmServe Contraindications.
"RTN","BIUTL11",16,0)
 ;---> Called by IMMSERV^BIEXPRT5.
"RTN","BIUTL11",17,0)
 ;---> Parameters:
"RTN","BIUTL11",18,0)
 ;     1 - BIDFN (req)  Patient's IEN in VA PATIENT File #2.
"RTN","BIUTL11",19,0)
 ;     2 - A     (ret)  Array with subscripts=HL7 CVX Codes of vaccines
"RTN","BIUTL11",20,0)
 ;                      contraindicated for this patient.
"RTN","BIUTL11",21,0)
 ;                      Each node A(CVX)=IEN of the Reason in ^BICONT(
"RTN","BIUTL11",22,0)
 ;     3 - BIREF (opt)  If BIREF=1, return only Vaccines contraindicated
"RTN","BIUTL11",23,0)
 ;                      because they were refused, i.e., Refusals.
"RTN","BIUTL11",24,0)
 ;                      If BIREF=2, return only Vaccines contraindicated
"RTN","BIUTL11",25,0)
 ;                      because of Hx of Chicken Pox.
"RTN","BIUTL11",26,0)
 ;     4 - BIDATE (opt) If BIDATE=1, append Date of contra to Refusals.
"RTN","BIUTL11",27,0)
 ;
"RTN","BIUTL11",28,0)
 Q:'$G(BIDFN)
"RTN","BIUTL11",29,0)
 ;---> Quit if there are no contraindications for this patient.
"RTN","BIUTL11",30,0)
 Q:'$D(^BIPC("B",BIDFN))
"RTN","BIUTL11",31,0)
 ;
"RTN","BIUTL11",32,0)
 N N,U S N=0,U="^"
"RTN","BIUTL11",33,0)
 F  S N=$O(^BIPC("B",BIDFN,N)) Q:'N  D
"RTN","BIUTL11",34,0)
 .;---> If bad xref, kill it and quit.
"RTN","BIUTL11",35,0)
 .I '$D(^BIPC(N,0)) K ^BIPC("B",BIDFN,N) Q
"RTN","BIUTL11",36,0)
 .N BIPC,X,Y
"RTN","BIUTL11",37,0)
 .;---> BIPC=zero node of a Patient's Contraindication.
"RTN","BIUTL11",38,0)
 .S BIPC=^BIPC(N,0)
"RTN","BIUTL11",39,0)
 .;
"RTN","BIUTL11",40,0)
 .;---> Set X=Reason pointer (to ^BICONT), Y=Date of Contraindication.
"RTN","BIUTL11",41,0)
 .S X=$P(BIPC,U,3),Y=$P(BIPC,U,4)
"RTN","BIUTL11",42,0)
 .;
"RTN","BIUTL11",43,0)
 .;---> If the call is to return an array of Refusals, do so and quit.
"RTN","BIUTL11",44,0)
 .I $G(BIREF)=1 D  Q
"RTN","BIUTL11",45,0)
 ..;---> 11 & 16 are IENs of BI TABLE CONTRA REASONS ^BICONT( that are REFUSALS.
"RTN","BIUTL11",46,0)
 ..I (X=11)!(X=16) D  Q
"RTN","BIUTL11",47,0)
 ...;---> Set array node A(CVX)=IEN of Refusal Contra Reason.
"RTN","BIUTL11",48,0)
 ...N Z S Z=$P(BIPC,U,2) I Z S Z=$G(^AUTTIMM(Z,0)),Z=$P(Z,U,3)
"RTN","BIUTL11",49,0)
 ...I Z S A(Z)=X S:$G(BIDATE) A(Z)=A(Z)_U_Y
"RTN","BIUTL11",50,0)
 .;
"RTN","BIUTL11",51,0)
 .;
"RTN","BIUTL11",52,0)
 .;---> If the call is to return an array of Hx of Chicken Pox, do so and quit.
"RTN","BIUTL11",53,0)
 .I $G(BIREF)=2 D  Q
"RTN","BIUTL11",54,0)
 ..;---> 12 is the IEN of BI TABLE CONTRA REASONS that is Hx of Chicken Pox.
"RTN","BIUTL11",55,0)
 ..I X=12 D  Q
"RTN","BIUTL11",56,0)
 ...;---> Set array node A(CVX)=IEN of Hx of Chicken Pox Reason.
"RTN","BIUTL11",57,0)
 ...;
"RTN","BIUTL11",58,0)
 ...;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIUTL11",59,0)
 ...;---> Append date to Hx of Chickenpox Reason.
"RTN","BIUTL11",60,0)
 ...N Z S Z=$P(BIPC,U,2) I Z S Z=$G(^AUTTIMM(Z,0)),Z=$P(Z,U,3)
"RTN","BIUTL11",61,0)
 ...I Z S A(Z)=X S:$G(BIDATE) A(Z)=A(Z)_U_Y
"RTN","BIUTL11",62,0)
 ...;**********
"RTN","BIUTL11",63,0)
 .;
"RTN","BIUTL11",64,0)
 .;---> Continue in order to return an array of contra'd vaccines by CVX Code.
"RTN","BIUTL11",65,0)
 .;
"RTN","BIUTL11",66,0)
 .;---> Quit if the Reason for this contraindication is one that
"RTN","BIUTL11",67,0)
 .;---> still allows forecasting of the vaccine.  For example,
"RTN","BIUTL11",68,0)
 .;---> if the reason is "Patient Refusal", then the vaccine should
"RTN","BIUTL11",69,0)
 .;---> still be forecast as due.
"RTN","BIUTL11",70,0)
 .I X Q:$P($G(^BICONT(X,0)),U,2)
"RTN","BIUTL11",71,0)
 .;
"RTN","BIUTL11",72,0)
 .;---> For this Vaccine IEN contraindication, get Related Contraindcated CVX Codes.
"RTN","BIUTL11",73,0)
 .;---> (Call below also sets A(CVX) of THIS Vaccine IEN in the A(CVX) array.)
"RTN","BIUTL11",74,0)
 .D CONTRHL7($P(BIPC,U,2),.A)
"RTN","BIUTL11",75,0)
 .;
"RTN","BIUTL11",76,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIUTL11",77,0)
 .;---> If the vaccine is Varicella (CVX=21) and Reason is Hx of Chicken Pox,
"RTN","BIUTL11",78,0)
 .;---> do NOT contraindicate Zoster (CVX=121).
"RTN","BIUTL11",79,0)
 .I $P(BIPC,U,2)=132,$P(BIPC,U,3)=12 K A(121)
"RTN","BIUTL11",80,0)
 .;**********
"RTN","BIUTL11",81,0)
 ;
"RTN","BIUTL11",82,0)
 Q
"RTN","BIUTL11",83,0)
 ;
"RTN","BIUTL11",84,0)
 ;
"RTN","BIUTL11",85,0)
 ;----------
"RTN","BIUTL11",86,0)
CONTRHL7(BIVAC,A) ;EP
"RTN","BIUTL11",87,0)
 ;---> Return an array of Related Contraindcated HL7 Codes for
"RTN","BIUTL11",88,0)
 ;---> this vaccine.
"RTN","BIUTL11",89,0)
 ;---> Parameters:
"RTN","BIUTL11",90,0)
 ;     1 - BIVAC (req) IEN of Vaccine.
"RTN","BIUTL11",91,0)
 ;     2 - A     (ret) Array with subscripts=HL7 Codes of vaccines
"RTN","BIUTL11",92,0)
 ;                     contraindicated that relate to this vaccine.
"RTN","BIUTL11",93,0)
 ;
"RTN","BIUTL11",94,0)
 Q:'$G(BIVAC)  Q:'$D(^AUTTIMM(BIVAC,0))
"RTN","BIUTL11",95,0)
 ;
"RTN","BIUTL11",96,0)
 ;---> Set X=data for this vaccine.
"RTN","BIUTL11",97,0)
 N X S X=^AUTTIMM(BIVAC,0)
"RTN","BIUTL11",98,0)
 ;
"RTN","BIUTL11",99,0)
 ;---> Set HL7 Code for this contraindicated vaccine in A() array
"RTN","BIUTL11",100,0)
 ;---> as a subscript.
"RTN","BIUTL11",101,0)
 Q:'$P(X,U,3)
"RTN","BIUTL11",102,0)
 S A($P(X,U,3))=""
"RTN","BIUTL11",103,0)
 ;
"RTN","BIUTL11",104,0)
 ;---> Set X=string of Related Contraindicated HL7 Codes for this
"RTN","BIUTL11",105,0)
 ;---> vaccine.
"RTN","BIUTL11",106,0)
 S X=$P(X,U,12)
"RTN","BIUTL11",107,0)
 ;
"RTN","BIUTL11",108,0)
 ;---> Now piece out Contraindicated HL7 Codes (comma delimited)
"RTN","BIUTL11",109,0)
 ;---> and set in A() array as subscripts.
"RTN","BIUTL11",110,0)
 N I,Y F I=1:1 S Y=$P(X,",",I) Q:'Y  S A(Y)=""
"RTN","BIUTL11",111,0)
 Q
"RTN","BIUTL11",112,0)
 ;
"RTN","BIUTL11",113,0)
 ;
"RTN","BIUTL11",114,0)
 ;----------
"RTN","BIUTL11",115,0)
CONTR(BIDFN,BIVAC) ;EP
"RTN","BIUTL11",116,0)
 ;
"RTN","BIUTL11",117,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTL11",118,0)
 ;---> REMOVED. Was never a P.E.P.
"RTN","BIUTL11",119,0)
 Q
"RTN","BIUTL11",120,0)
 ;
"RTN","BIUTL11",121,0)
 ;
"RTN","BIUTL11",122,0)
 ;----------
"RTN","BIUTL11",123,0)
INPT(BIDFN,BIDATE) ;EP
"RTN","BIUTL11",124,0)
 ;---> Return 1 if patient was an inpatient on BIDATE.
"RTN","BIUTL11",125,0)
 ;---> Called by +84^BIVISIT to correct Category.
"RTN","BIUTL11",126,0)
 ;---> Parameters:
"RTN","BIUTL11",127,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIUTL11",128,0)
 ;     2 - BIDATE (req) Date to check if patient was inpatient.
"RTN","BIUTL11",129,0)
 ;
"RTN","BIUTL11",130,0)
 ; VEN/SMH: ^AUPNVINP (V INPATIENT) is only in RPMS.
"RTN","BIUTL11",131,0)
 ; VISTA API is EN^DGPMSTAT
"RTN","BIUTL11",132,0)
 ;
"RTN","BIUTL11",133,0)
 Q:'$G(BIDFN) 0  Q:'$G(BIDATE) 0
"RTN","BIUTL11",134,0)
 ;
"RTN","BIUTL11",135,0)
 I '$$RPMS^BIUTL9() N VISTAIP D  QUIT VISTAIP
"RTN","BIUTL11",136,0)
 . N DFN S DFN=BIDFN
"RTN","BIUTL11",137,0)
 . N DGT S DGT=BIDATE
"RTN","BIUTL11",138,0)
 . N DGA1,DG1,DGXFR0
"RTN","BIUTL11",139,0)
 . D EN^DGPMSTAT ; IA 2464
"RTN","BIUTL11",140,0)
 . S VISTAIP=''$G(DGA1)  ; not not the IEN of the Inpatient Entry in ^DGPM
"RTN","BIUTL11",141,0)
 ;
"RTN","BIUTL11",142,0)
 ;---> Get last discharge previous to BIDATE.
"RTN","BIUTL11",143,0)
 N X,Y S BIDATE=9999999.9999999-BIDATE
"RTN","BIUTL11",144,0)
 S X=$O(^AUPNVINP("AA",BIDFN,BIDATE))
"RTN","BIUTL11",145,0)
 ;
"RTN","BIUTL11",146,0)
 ;---> Now check to see if patient has been admitted since
"RTN","BIUTL11",147,0)
 ;---> that discharge date.
"RTN","BIUTL11",148,0)
 S X=$O(^AUPNVSIT("AAH",BIDFN,X),-1)
"RTN","BIUTL11",149,0)
 ;
"RTN","BIUTL11",150,0)
 ;---> If patient not admitted since last discharge, quit 0.
"RTN","BIUTL11",151,0)
 Q:'X 0
"RTN","BIUTL11",152,0)
 ;
"RTN","BIUTL11",153,0)
 ;---> If Visit is for Contract Care, quit 0 (not an inpatient).
"RTN","BIUTL11",154,0)
 ;---> Next line v8.1 fix: Use X (inv date) to get Y (IEN).
"RTN","BIUTL11",155,0)
 S Y=+$O(^AUPNVSIT("AAH",BIDFN,X,0))
"RTN","BIUTL11",156,0)
 Q:$P($G(^AUPNVSIT(Y,0)),U,3)="C" 0
"RTN","BIUTL11",157,0)
 ;
"RTN","BIUTL11",158,0)
 ;---> If last admission was after BIDATE (inverse), quit 0.
"RTN","BIUTL11",159,0)
 Q:X<BIDATE 0
"RTN","BIUTL11",160,0)
 ;
"RTN","BIUTL11",161,0)
 ;---> Patient was an inpatient on BIDATE, quit 1.
"RTN","BIUTL11",162,0)
 Q 1
"RTN","BIUTL11",163,0)
 ;
"RTN","BIUTL11",164,0)
 ;
"RTN","BIUTL11",165,0)
 ;----------
"RTN","BIUTL11",166,0)
INFL(BIDFN,TEXT) ;EP
"RTN","BIUTL11",167,0)
 ;---> Return value of Patient's Forecast Influ/Pneumo field.
"RTN","BIUTL11",168,0)
 ;---> 0=Normal, 1=Influenza, 2=Pneumococcal, 3=Both, 4=Disregard Risk Factors.
"RTN","BIUTL11",169,0)
 ;---> Parameters:
"RTN","BIUTL11",170,0)
 ;     1 - BIDFN  (req) Patient's IEN (BIDFN).
"RTN","BIUTL11",171,0)
 ;     2 - TEXT (opt) If TEXT=1, return text of the field.
"RTN","BIUTL11",172,0)
 ;
"RTN","BIUTL11",173,0)
 Q:'$G(BIDFN) 0
"RTN","BIUTL11",174,0)
 Q:'$D(^BIP(BIDFN,0)) 0
"RTN","BIUTL11",175,0)
 N X S X=+$P(^BIP(BIDFN,0),U,15)
"RTN","BIUTL11",176,0)
 Q:'$G(TEXT) X
"RTN","BIUTL11",177,0)
 Q:X=4 "Disregard Risk Factors"
"RTN","BIUTL11",178,0)
 Q:X=3 "Influenza and Pneumo"
"RTN","BIUTL11",179,0)
 Q:X=2 "Pneumococcal"
"RTN","BIUTL11",180,0)
 Q:X=1 "Influenza"
"RTN","BIUTL11",181,0)
 Q "Normal"
"RTN","BIUTL11",182,0)
 ;
"RTN","BIUTL11",183,0)
 ;
"RTN","BIUTL11",184,0)
 ;----------
"RTN","BIUTL11",185,0)
MOTHER(BIDFN,BITEXT) ;EP
"RTN","BIUTL11",186,0)
 ;---> Return mother's HBsAg Status Code.
"RTN","BIUTL11",187,0)
 ;---> Parameters:
"RTN","BIUTL11",188,0)
 ;     1 - BIDFN    (req) Patient's IEN (BIDFN).
"RTN","BIUTL11",189,0)
 ;     2 - BITEXT (opt) If BITEXT=1 return full text.
"RTN","BIUTL11",190,0)
 N X
"RTN","BIUTL11",191,0)
 D
"RTN","BIUTL11",192,0)
 .I '$G(BIDFN) S X="U" Q
"RTN","BIUTL11",193,0)
 .I '$D(^BIP(BIDFN,0)) S X="U" Q
"RTN","BIUTL11",194,0)
 .S X=$P(^BIP(BIDFN,0),U,11)
"RTN","BIUTL11",195,0)
 S:X="" X="U"
"RTN","BIUTL11",196,0)
 Q:'$G(BITEXT) X
"RTN","BIUTL11",197,0)
 Q $S(X="P":"POSITIVE",X="N":"NEGATIVE",1:"UNKNOWN")
"RTN","BIUTL11",198,0)
 ;
"RTN","BIUTL11",199,0)
 ;
"RTN","BIUTL11",200,0)
 ;----------
"RTN","BIUTL11",201,0)
BENTYP(BIDFN,TEXT) ;EP
"RTN","BIUTL11",202,0)
 ;---> Return IEN of Patient's Beneficiary Type.
"RTN","BIUTL11",203,0)
 ;---> This is the CLASSIFICATION/BENEFICIARY Code (Item 2 on page 2
"RTN","BIUTL11",204,0)
 ;---> of Registration).
"RTN","BIUTL11",205,0)
 ;---> Parameters:
"RTN","BIUTL11",206,0)
 ;     1 - BIDFN (req) Patient's IEN (DFN).
"RTN","BIUTL11",207,0)
 ;---> Text parameter added.
"RTN","BIUTL11",208,0)
 ;     2 - TEXT  (opt) If TEXT=1, return text of Beneficiary Type.
"RTN","BIUTL11",209,0)
 ;                     If text=2, return Code of Beneficiary Type.  vvv83
"RTN","BIUTL11",210,0)
 ;
"RTN","BIUTL11",211,0)
 N Y
"RTN","BIUTL11",212,0)
 Q:'$G(BIDFN) 0
"RTN","BIUTL11",213,0)
 S Y=+$P($G(^AUPNPAT(BIDFN,11)),U,11)
"RTN","BIUTL11",214,0)
 Q:'$G(TEXT) Y
"RTN","BIUTL11",215,0)
 Q:$G(TEXT)=2 $P($G(^AUTTBEN(Y,0)),U,2)  ;vvv83
"RTN","BIUTL11",216,0)
 Q $P($G(^AUTTBEN(Y,0)),U)
"RTN","BIUTL11",217,0)
 ;
"RTN","BIUTL11",218,0)
 ;
"RTN","BIUTL11",219,0)
 ;----------
"RTN","BIUTL11",220,0)
OTHERIN(BIDFN) ;EP
"RTN","BIUTL11",221,0)
 ;---> Return Patient's Other Info.
"RTN","BIUTL11",222,0)
 ;---> Parameters:
"RTN","BIUTL11",223,0)
 ;     1 - BIDFN  (req) Patient's IEN (BIDFN).
"RTN","BIUTL11",224,0)
 ;
"RTN","BIUTL11",225,0)
 Q:'$G(BIDFN) ""
"RTN","BIUTL11",226,0)
 Q $P($G(^BIP(BIDFN,0)),U,13)
"RTN","BIUTL11",227,0)
 ;
"RTN","BIUTL11",228,0)
 ;
"RTN","BIUTL11",229,0)
 ;----------
"RTN","BIUTL11",230,0)
MAYEDIT() ;EP
"RTN","BIUTL11",231,0)
 ;---> Return 1 if User has Immunization Edit Patients Key; 0 if not.
"RTN","BIUTL11",232,0)
 Q:'$D(DUZ) 0
"RTN","BIUTL11",233,0)
 Q:$D(^XUSEC("BIZ EDIT PATIENTS",DUZ)) 1
"RTN","BIUTL11",234,0)
 Q:$D(^XUSEC("BIZ MANAGER",DUZ)) 1
"RTN","BIUTL11",235,0)
 Q 0
"RTN","BIUTL11",236,0)
 ;
"RTN","BIUTL11",237,0)
 ;
"RTN","BIUTL11",238,0)
 ;----------
"RTN","BIUTL11",239,0)
MAYMANAG() ;EP
"RTN","BIUTL11",240,0)
 ;---> Return 1 if User has Immunization Manager Key; 0 if not.
"RTN","BIUTL11",241,0)
 Q:'$D(DUZ) 0
"RTN","BIUTL11",242,0)
 Q:$D(^XUSEC("BIZ MANAGER",DUZ)) 1
"RTN","BIUTL11",243,0)
 Q 0
"RTN","BIUTL11",244,0)
 ;
"RTN","BIUTL11",245,0)
 ;
"RTN","BIUTL11",246,0)
 ;----------
"RTN","BIUTL11",247,0)
CURCOM(BIDFN,TEXT) ;EP
"RTN","BIUTL11",248,0)
 ;---> Return patient's Current Community IEN or Text.
"RTN","BIUTL11",249,0)
 ;---> (Item 6 on page 1 of Registration).
"RTN","BIUTL11",250,0)
 ;---> Parameters:
"RTN","BIUTL11",251,0)
 ;     1 - BIDFN  (req) Patient's IEN (BIDFN).
"RTN","BIUTL11",252,0)
 ;     2 - TEXT (opt) If TEXT=1, return text of Current Community.
"RTN","BIUTL11",253,0)
 ;
"RTN","BIUTL11",254,0)
 Q:'$G(BIDFN) "No Patient"
"RTN","BIUTL11",255,0)
 ;
"RTN","BIUTL11",256,0)
 I '$$RPMS^BIUTL9() QUIT $$GET1^DIQ(2,BIDFN,"ZIP CODE")  ; for VISTA
"RTN","BIUTL11",257,0)
 ;
"RTN","BIUTL11",258,0)
 Q:'$D(^AUPNPAT(BIDFN,11)) "Unknown1"
"RTN","BIUTL11",259,0)
 ;
"RTN","BIUTL11",260,0)
 N X,Y,Z
"RTN","BIUTL11",261,0)
 S X=^AUPNPAT(BIDFN,11)
"RTN","BIUTL11",262,0)
 ;---> Set Y=Pointer (IEN in ^AUTTCOM, piece 17), Z=Text (piece 18).
"RTN","BIUTL11",263,0)
 S Y=$P(X,U,17),Z=$P(X,U,18)
"RTN","BIUTL11",264,0)
 ;---> If both Pointer and Text are null, return "Unknown2".
"RTN","BIUTL11",265,0)
 Q:('Y&(Z="")) "Unknown2"
"RTN","BIUTL11",266,0)
 ;
"RTN","BIUTL11",267,0)
 ;---> If Y is null or a bad pointer, set Y="".
"RTN","BIUTL11",268,0)
 I Y<1!('$D(^AUTTCOM(+Y,0))) S Y=""
"RTN","BIUTL11",269,0)
 ;
"RTN","BIUTL11",270,0)
 ;---> If no valid pointer and if Text (pc 18) exists in the
"RTN","BIUTL11",271,0)
 ;---> Community file, then set Y=IEN in ^AUTTCOM(, and fix it.
"RTN","BIUTL11",272,0)
 I Y<1,$D(^AUTTCOM("B",Z)) S Y=$O(^AUTTCOM("B",Z,0)) D
"RTN","BIUTL11",273,0)
 .N BIFLD S BIFLD(1117)=Y D FDIE^BIFMAN(9000001,BIDFN,.BIFLD)
"RTN","BIUTL11",274,0)
 ;
"RTN","BIUTL11",275,0)
 Q:'$D(^AUTTCOM(+Y,0)) "Unknown3"
"RTN","BIUTL11",276,0)
 ;
"RTN","BIUTL11",277,0)
 N BITEXT S BITEXT=$P(^AUTTCOM(Y,0),U)
"RTN","BIUTL11",278,0)
 ;---> If text field is off, fix it.
"RTN","BIUTL11",279,0)
 I Z'=BITEXT D
"RTN","BIUTL11",280,0)
 .N BIFLD S BIFLD(1118)=BITEXT D FDIE^BIFMAN(9000001,BIDFN,.BIFLD)
"RTN","BIUTL11",281,0)
 Q:'$G(TEXT) Y
"RTN","BIUTL11",282,0)
 Q $P(^AUTTCOM(Y,0),U)
"RTN","BIUTL11",283,0)
 ;
"RTN","BIUTL11",284,0)
 ;
"RTN","BIUTL11",285,0)
 ;----------
"RTN","BIUTL11",286,0)
ISGPRA(BIDFN,BISITE,BINOCOM,BIERR) ;PEP - Return 1 if Pt's Current Community is in Imm GPRA Set.
"RTN","BIUTL11",287,0)
 ;---> Return 1 if Patient's Current Community is in the Immunization GPRA Set
"RTN","BIUTL11",288,0)
 ;---> of Communities as defined in the BI Site Parameters File.
"RTN","BIUTL11",289,0)
 ;---> Parameters:
"RTN","BIUTL11",290,0)
 ;     1 - BIDFN   (req) Patient's IEN (BIDFN).
"RTN","BIUTL11",291,0)
 ;     2 - BISITE  (req) IEN of Site (often the user's DUZ(2)).
"RTN","BIUTL11",292,0)
 ;
"RTN","BIUTL11",293,0)
 N BIPCC,BIGPRA,BIERR S BIERR=""
"RTN","BIUTL11",294,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q 0
"RTN","BIUTL11",295,0)
 S:'$G(BISITE) BISITE=$G(DUZ(2))
"RTN","BIUTL11",296,0)
 I '$G(BISITE) D ERRCD^BIUTL2(109,.BIERR) Q 0
"RTN","BIUTL11",297,0)
 S BIPCC=+$$CURCOM(BIDFN)
"RTN","BIUTL11",298,0)
 Q:'BIPCC 0
"RTN","BIUTL11",299,0)
 D GETGPRA^BISITE4(.BIGPRA,BISITE,.BIERR)
"RTN","BIUTL11",300,0)
 I BIERR]"" Q 0
"RTN","BIUTL11",301,0)
 Q:$D(BIGPRA(BIPCC)) 1
"RTN","BIUTL11",302,0)
 Q 0
"RTN","BIUTL11",303,0)
 ;
"RTN","BIUTL11",304,0)
 ;
"RTN","BIUTL11",305,0)
 ;----------
"RTN","BIUTL11",306,0)
NEXTAPPT(BIDFN) ;EP
"RTN","BIUTL11",307,0)
 ;---> Return patient's next appointment from Scheduling Package.
"RTN","BIUTL11",308,0)
 ;---> Parameters:
"RTN","BIUTL11",309,0)
 ;     1 - BIDFN  (req) Patient's IEN (BIDFN).
"RTN","BIUTL11",310,0)
 ;
"RTN","BIUTL11",311,0)
 Q:'$G(BIDFN) ""
"RTN","BIUTL11",312,0)
 Q:'$D(^DPT(BIDFN)) ""
"RTN","BIUTL11",313,0)
 ;
"RTN","BIUTL11",314,0)
 N BIAPPT,BIDT,BIYES
"RTN","BIUTL11",315,0)
 S BIDT=DT+.2400,BIYES=0
"RTN","BIUTL11",316,0)
 F  S BIDT=$O(^DPT(BIDFN,"S",BIDT)) Q:'BIDT!(BIYES)  D
"RTN","BIUTL11",317,0)
 .N BIDATA,BIOI,X
"RTN","BIUTL11",318,0)
 .S BIDATA=$G(^DPT(BIDFN,"S",BIDT,0))
"RTN","BIUTL11",319,0)
 .Q:BIDATA=""
"RTN","BIUTL11",320,0)
 .;
"RTN","BIUTL11",321,0)
 .;---> Quit if appointment is cancelled.
"RTN","BIUTL11",322,0)
 .Q:$P(BIDATA,U,2)["C"
"RTN","BIUTL11",323,0)
 .;
"RTN","BIUTL11",324,0)
 .S X=0 F  S X=$O(^SC(+BIDATA,"S",BIDT,1,X)) Q:'X  D
"RTN","BIUTL11",325,0)
 ..Q:+$G(^SC(+BIDATA,"S",BIDT,1,X,0))'=BIDFN
"RTN","BIUTL11",326,0)
 ..S BIYES=BIDT_U_+BIDATA
"RTN","BIUTL11",327,0)
 ;
"RTN","BIUTL11",328,0)
 Q:'BIYES "None"
"RTN","BIUTL11",329,0)
 ;
"RTN","BIUTL11",330,0)
 S BIAPPT=$$FMTE^XLFDT(+BIYES,"1P")_" with "
"RTN","BIUTL11",331,0)
 S BIAPPT=BIAPPT_$P($G(^SC($P(BIYES,U,2),0)),U)
"RTN","BIUTL11",332,0)
 Q BIAPPT
"RTN","BIUTL11",333,0)
 ;
"RTN","BIUTL11",334,0)
 ;
"RTN","BIUTL11",335,0)
 ;----------
"RTN","BIUTL11",336,0)
LASTIMM(BIDFN,BICVXS,BIQDT,BIALL) ;PEP - Return latest date patient received CVX vaccine(s).
"RTN","BIUTL11",337,0)
 ;---> Return the latest Fileman date on which any one of the CVX's in the
"RTN","BIUTL11",338,0)
 ;---> string BICVXS was received.  Return 0 (zero) if none received.
"RTN","BIUTL11",339,0)
 ;---> Parameters:
"RTN","BIUTL11",340,0)
 ;     1 - BIDFN  (req) IEN of Patient in ^DPT.
"RTN","BIUTL11",341,0)
 ;     2 - BICVXS (req) String of CVX Codes to check, delimited by comma.
"RTN","BIUTL11",342,0)
 ;     3 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date).
"RTN","BIUTL11",343,0)
 ;     4 - BIALL  (opt) If BIALL=1 return string of dates (comma delim) before BIQDT.
"RTN","BIUTL11",344,0)
 ;     5 - BIVG   (opt) *NOT USED* Vaccine Group (if BIVG=IEN of Vaccine Group, check that way).
"RTN","BIUTL11",345,0)
 ;
"RTN","BIUTL11",346,0)
 Q:'$G(BIDFN) 0
"RTN","BIUTL11",347,0)
 Q:'$G(BICVXS) 0
"RTN","BIUTL11",348,0)
 N BICVX,BIDATE,I S BIDATE=0
"RTN","BIUTL11",349,0)
 ;
"RTN","BIUTL11",350,0)
 F I=1:1 S BICVX=$P(BICVXS,",",I) Q:BICVX=""  D
"RTN","BIUTL11",351,0)
 .N BIIEN S BIIEN=$$HL7TX^BIUTL2(BICVX)
"RTN","BIUTL11",352,0)
 .;---> Quit if CVX Code does not exist in Vaccine Table (or=OTHER).
"RTN","BIUTL11",353,0)
 .Q:('BIIEN!(BIIEN=137))
"RTN","BIUTL11",354,0)
 .N N S N=0
"RTN","BIUTL11",355,0)
 .F  S N=$O(^AUPNVIMM("AC",BIDFN,N)) Q:'N  D
"RTN","BIUTL11",356,0)
 ..N X,Y S X=$G(^AUPNVIMM(N,0))
"RTN","BIUTL11",357,0)
 ..;---> Quit if this visit doesn't match the desired CVX Code.
"RTN","BIUTL11",358,0)
 ..Q:(+X'=BIIEN)
"RTN","BIUTL11",359,0)
 ..;
"RTN","BIUTL11",360,0)
 ..;---> Get pointer to Visit (to get date of visit).
"RTN","BIUTL11",361,0)
 ..S Y=$P(X,U,3)
"RTN","BIUTL11",362,0)
 ..Q:'Y
"RTN","BIUTL11",363,0)
 ..S Y=$P(+$G(^AUPNVSIT(Y,0)),".")
"RTN","BIUTL11",364,0)
 ..Q:'Y
"RTN","BIUTL11",365,0)
 ..;---> Quit if this Visit was after the Quarter Ending Date.
"RTN","BIUTL11",366,0)
 ..I $G(BIQDT) Q:(Y>BIQDT)
"RTN","BIUTL11",367,0)
 ..;
"RTN","BIUTL11",368,0)
 ..;---> If returning all dates, concat string and quit.
"RTN","BIUTL11",369,0)
 ..I $G(BIALL) D  Q
"RTN","BIUTL11",370,0)
 ...I BIDATE S BIDATE=BIDATE_","_Y Q
"RTN","BIUTL11",371,0)
 ...S BIDATE=Y
"RTN","BIUTL11",372,0)
 ..;
"RTN","BIUTL11",373,0)
 ..;---> If only returning last date, reset BIDATE if this is later than any prior BIDATE.
"RTN","BIUTL11",374,0)
 ..S:(Y>BIDATE) BIDATE=Y
"RTN","BIUTL11",375,0)
 ;
"RTN","BIUTL11",376,0)
 ;---> Return the latest Visit Date for this set of CVX Codes.
"RTN","BIUTL11",377,0)
 Q BIDATE
"RTN","BIUTL11",378,0)
 ;
"RTN","BIUTL11",379,0)
 ;
"RTN","BIUTL11",380,0)
 ;----------
"RTN","BIUTL11",381,0)
LASTCPT(BIDFN,BICPTS,BIQDT,BIALL) ;EP
"RTN","BIUTL11",382,0)
 ;---> Return the latest Fileman date on which any one of the CPT's in the
"RTN","BIUTL11",383,0)
 ;---> string BICPTS was received.  Return 0 (zero) if none received.
"RTN","BIUTL11",384,0)
 ;---> Parameters:
"RTN","BIUTL11",385,0)
 ;     1 - BIDFN  (req) Patient DFN
"RTN","BIUTL11",386,0)
 ;     2 - BICPTS (req) String of CPT Codes to check, delimited by comma.
"RTN","BIUTL11",387,0)
 ;     3 - BIQDT  (opt) Quarter Ending Date (ignore Visits after this date).
"RTN","BIUTL11",388,0)
 ;     4 - BIALL  (opt) If BIALL=1 return string of dates (comma delim) before BIQDT.
"RTN","BIUTL11",389,0)
 ;
"RTN","BIUTL11",390,0)
 Q:'$G(BIDFN) 0
"RTN","BIUTL11",391,0)
 Q:'$G(BICPTS) 0
"RTN","BIUTL11",392,0)
 N BICPT,BIDATE,I S BIDATE=0
"RTN","BIUTL11",393,0)
 F I=1:1 S BICPT=$P(BICPTS,",",I) Q:BICPT=""  D
"RTN","BIUTL11",394,0)
 .N N S N=0
"RTN","BIUTL11",395,0)
 .F  S N=$O(^AUPNVCPT("AA",BIDFN,BICPT,N)) Q:'N  D
"RTN","BIUTL11",396,0)
 ..N BIDATE1 S BIDATE1=9999999-N
"RTN","BIUTL11",397,0)
 ..I $G(BIQDT) Q:(BIDATE1>BIQDT)
"RTN","BIUTL11",398,0)
 ..;
"RTN","BIUTL11",399,0)
 ..;---> If returning all dates, concat string and quit.
"RTN","BIUTL11",400,0)
 ..I $G(BIALL) D  Q
"RTN","BIUTL11",401,0)
 ...I BIDATE S BIDATE=BIDATE_","_BIDATE1 Q
"RTN","BIUTL11",402,0)
 ...S BIDATE=BIDATE1
"RTN","BIUTL11",403,0)
 ..;
"RTN","BIUTL11",404,0)
 ..;---> If only returning last date, reset BIDATE if this is later than any prior BIDATE.
"RTN","BIUTL11",405,0)
 ..S:(BIDATE1>BIDATE) BIDATE=BIDATE1
"RTN","BIUTL11",406,0)
 ;
"RTN","BIUTL11",407,0)
 ;---> Return the latest Visit Date for this set of CPT Codes.
"RTN","BIUTL11",408,0)
 Q BIDATE
"RTN","BIUTL11",409,0)
 ;
"RTN","BIUTL11",410,0)
 ;
"RTN","BIUTL11",411,0)
 ;----------
"RTN","BIUTL11",412,0)
MOTHMAID(DFN) ;EP
"RTN","BIUTL11",413,0)
 ;---> CodeChange for v7.1 - IHS/CMI/MWR 12/01/2000:
"RTN","BIUTL11",414,0)
 ;---> This is a new call added.
"RTN","BIUTL11",415,0)
 ;---> Return patient's mother's maiden name.
"RTN","BIUTL11",416,0)
 ;---> Parameters:
"RTN","BIUTL11",417,0)
 ;     1 - DFN  (req) Patient's IEN (DFN).
"RTN","BIUTL11",418,0)
 ;
"RTN","BIUTL11",419,0)
 Q:'$G(DFN) "No DFN"
"RTN","BIUTL11",420,0)
 Q $P($G(^DPT(DFN,.24)),U,3)
"RTN","BIUTL11",421,0)
 ;
"RTN","BIUTL11",422,0)
 ;
"RTN","BIUTL11",423,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL11",424,0)
 ;---> Call to limit export of imms to specific vaccines within a date range.
"RTN","BIUTL11",425,0)
 ;----------
"RTN","BIUTL11",426,0)
GOTDOSE(BIDFN,BIVIEN,BIRDT) ;EP
"RTN","BIUTL11",427,0)
 ;---> Return 1 if patient received one or more doses of the input vaccine
"RTN","BIUTL11",428,0)
 ;--->  within the givin date range; otherwise return 0.
"RTN","BIUTL11",429,0)
 ;---> Parameters:
"RTN","BIUTL11",430,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BIUTL11",431,0)
 ;     2 - BIVIEN (req) IEN of Vaccine.
"RTN","BIUTL11",432,0)
 ;     3 - BIRDT  (opt) Date range in Fileman format YYYMMDD:YYYMMDD
"RTN","BIUTL11",433,0)
 ;
"RTN","BIUTL11",434,0)
 Q:'$G(BIDFN) 0
"RTN","BIUTL11",435,0)
 Q:'$G(BIVIEN) 0  Q:'$D(^AUTTIMM(BIVIEN,0)) 0
"RTN","BIUTL11",436,0)
 ;
"RTN","BIUTL11",437,0)
 N BISDT,BIEDT
"RTN","BIUTL11",438,0)
 S BISDT=+$P($G(BIRDT),":")
"RTN","BIUTL11",439,0)
 S BIEDT=+$P($G(BIRDT),":",2) I BIEDT=0 S BIEDT=9999999
"RTN","BIUTL11",440,0)
 ;
"RTN","BIUTL11",441,0)
 N N,Z S N=0,Z=0
"RTN","BIUTL11",442,0)
 F  S N=$O(^AUPNVIMM("AC",BIDFN,N)) Q:'N  Q:Z  D
"RTN","BIUTL11",443,0)
 .N X,Y S X=$G(^AUPNVIMM(N,0))
"RTN","BIUTL11",444,0)
 .;---> Quit if this visit doesn't match the desired vaccine.
"RTN","BIUTL11",445,0)
 .Q:(+X'=BIVIEN)
"RTN","BIUTL11",446,0)
 .;
"RTN","BIUTL11",447,0)
 .;---> Get pointer to Visit (to get date of visit).
"RTN","BIUTL11",448,0)
 .S Y=$P(X,U,3)
"RTN","BIUTL11",449,0)
 .Q:'Y
"RTN","BIUTL11",450,0)
 .S Y=$P(+$G(^AUPNVSIT(Y,0)),".")
"RTN","BIUTL11",451,0)
 .Q:'Y
"RTN","BIUTL11",452,0)
 .;---> Quit if this Visit was before the Start Date.
"RTN","BIUTL11",453,0)
 .Q:(Y<BISDT)
"RTN","BIUTL11",454,0)
 .;---> Quit if this Visit was after the End Date.
"RTN","BIUTL11",455,0)
 .Q:(Y>BIEDT)
"RTN","BIUTL11",456,0)
 .;---> Got a dose.
"RTN","BIUTL11",457,0)
 .S Z=1
"RTN","BIUTL11",458,0)
 ;
"RTN","BIUTL11",459,0)
 Q Z
"RTN","BIUTL2")
0^151^B77876709
"RTN","BIUTL2",1,0)
BIUTL2 ;IHS/CMI/MWR - UTIL: ZIS, PATH, ERRCODE; MAY 10, 2010
"RTN","BIUTL2",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIUTL2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL2",4,0)
 ;;  UTILITY: ZIS, ERROR CODE, VACCINE NAME & GROUP,
"RTN","BIUTL2",5,0)
 ;;           MAX SERIES#, LOT DFLT, CASE MGR DFLT, VIS DATE DFLT.
"RTN","BIUTL2",6,0)
 ;;  PATCH 1: Do not provide default Lot Number if Lot Number is restricted
"RTN","BIUTL2",7,0)
 ;;           to a site and user's DUZ(2) does not match the site.  LOTDEF+19
"RTN","BIUTL2",8,0)
 ;;  PATCH 7: Changes to accommodate new TCH Forecaster   HL7TX+16
"RTN","BIUTL2",9,0)
 ;;  PATCH 8: Changes to accommodate new TCH Forecaster   HL7TX+16, MINAGE+6
"RTN","BIUTL2",10,0)
 ;
"RTN","BIUTL2",11,0)
 ;
"RTN","BIUTL2",12,0)
 ;----------
"RTN","BIUTL2",13,0)
ERRCD(BIIEN,BITEXT,BIDISPL,BIABBRV) ;EP
"RTN","BIUTL2",14,0)
 ;---> Display Error Code from BI TABLE ERROR CODE File.
"RTN","BIUTL2",15,0)
 ;---> Parameters:
"RTN","BIUTL2",16,0)
 ;     1 - BIIEN   (req) IEN of Error Code in ^BIERR(.
"RTN","BIUTL2",17,0)
 ;     2 - BITEXT  (ret) Text of Error Code.
"RTN","BIUTL2",18,0)
 ;     3 - BIDISPL (opt) BIDISPL=1 if Error Code Text SHOULD BE displayed here.
"RTN","BIUTL2",19,0)
 ;     4 - BIABBRV (opt) BIABBRV=1 return Abbreviated Error Text (<20 chars).
"RTN","BIUTL2",20,0)
 ;
"RTN","BIUTL2",21,0)
 ;---> Set BITEXT=Text of Error Code.
"RTN","BIUTL2",22,0)
 D
"RTN","BIUTL2",23,0)
 .I '$G(BIIEN) D  Q
"RTN","BIUTL2",24,0)
 ..I $G(BIABBRV) S BITEXT="No Error Code" Q
"RTN","BIUTL2",25,0)
 ..S BITEXT="Error Code not provided by software."
"RTN","BIUTL2",26,0)
 .;
"RTN","BIUTL2",27,0)
 .I '$D(^BIERR(BIIEN,0)) D  Q
"RTN","BIUTL2",28,0)
 ..I $G(BIABBRV) S BITEXT="No Error Code" Q
"RTN","BIUTL2",29,0)
 ..S BITEXT="Error Code does not exist in BI TABLE ERROR CODE File."
"RTN","BIUTL2",30,0)
 .;
"RTN","BIUTL2",31,0)
 .I $G(BIABBRV) S BITEXT=$P(^BIERR(BIIEN,0),"^",3) Q
"RTN","BIUTL2",32,0)
 .S BITEXT=$P(^BIERR(BIIEN,0),"^",2)_" #"_BIIEN
"RTN","BIUTL2",33,0)
 ;
"RTN","BIUTL2",34,0)
 ;---> Display Error Code Text.
"RTN","BIUTL2",35,0)
 ; ZEXCEPT: IOF,IOST
"RTN","BIUTL2",36,0)
 D:$G(BIDISPL)
"RTN","BIUTL2",37,0)
 .N BICRT S BICRT=$S(($E($G(IOST))="C")!($G(IOST)["BROWSER"):1,1:0)
"RTN","BIUTL2",38,0)
 .W !!?3,BITEXT
"RTN","BIUTL2",39,0)
 .W:'BICRT @IOF D:BICRT DIRZ^BIUTL3()
"RTN","BIUTL2",40,0)
 ;
"RTN","BIUTL2",41,0)
 ;---> Not used for now.
"RTN","BIUTL2",42,0)
 ;D EN^DDIOL("* "_BITEXT,"","!!?3"),DIRZ^BIUTL3()
"RTN","BIUTL2",43,0)
 Q
"RTN","BIUTL2",44,0)
 ;
"RTN","BIUTL2",45,0)
 ;
"RTN","BIUTL2",46,0)
 ;----------
"RTN","BIUTL2",47,0)
VNAME(IEN,LONG) ;EP
"RTN","BIUTL2",48,0)
 ;---> Return the Short, Long, or Full Name for a Vaccine.
"RTN","BIUTL2",49,0)
 ;---> Parameters:
"RTN","BIUTL2",50,0)
 ;     1 - IEN  (req) IEN of Vaccine.
"RTN","BIUTL2",51,0)
 ;     2 - LONG (opt) 0/null=Short Name; 1=Long Name; 2=Full Name;
"RTN","BIUTL2",52,0)
 ;                    3="ShortName  (LongName)."
"RTN","BIUTL2",53,0)
 ;
"RTN","BIUTL2",54,0)
 Q:'$G(IEN) "NO IEN"
"RTN","BIUTL2",55,0)
 Q:'$D(^AUTTIMM(IEN,0)) "UNKNOWN"
"RTN","BIUTL2",56,0)
 Q:$G(LONG)=1 $P(^AUTTIMM(IEN,0),"^")
"RTN","BIUTL2",57,0)
 Q:$G(LONG)=2 $P($G(^AUTTIMM(IEN,1)),"^",14)
"RTN","BIUTL2",58,0)
 Q:$G(LONG)=3 " "_$P(^AUTTIMM(IEN,0),"^",2)_"  ("_$P(^AUTTIMM(IEN,0),"^")_") "
"RTN","BIUTL2",59,0)
 ; ven/smh - VISTA doesn't necessarily have the short name filled.
"RTN","BIUTL2",60,0)
 ; ---> so return it only if it exists.
"RTN","BIUTL2",61,0)
 I $L($P(^AUTTIMM(IEN,0),"^",2)) QUIT $P(^(0),"^",2)
"RTN","BIUTL2",62,0)
 QUIT $P(^AUTTIMM(IEN,0),"^")
"RTN","BIUTL2",63,0)
 ;
"RTN","BIUTL2",64,0)
 ;
"RTN","BIUTL2",65,0)
 ;----------
"RTN","BIUTL2",66,0)
MNAME(IEN,MVX) ;EP
"RTN","BIUTL2",67,0)
 ;---> Return Manufacturer Name or MVX Code.
"RTN","BIUTL2",68,0)
 ;---> Parameters:
"RTN","BIUTL2",69,0)
 ;     1 - IEN (req) IEN of Manufacturer.
"RTN","BIUTL2",70,0)
 ;     2 - MVX (opt) If MVX=1, return MVX Code
"RTN","BIUTL2",71,0)
 ;
"RTN","BIUTL2",72,0)
 Q:'$G(IEN) "NO IEN"
"RTN","BIUTL2",73,0)
 Q:'$D(^AUTTIMAN(IEN,0)) $S($G(MVX):"UNK",1:"UNKNOWN")
"RTN","BIUTL2",74,0)
 Q:$G(MVX)=1 $P(^AUTTIMAN(IEN,0),"^",2)
"RTN","BIUTL2",75,0)
 Q $P(^AUTTIMAN(IEN,0),"^")
"RTN","BIUTL2",76,0)
 ;
"RTN","BIUTL2",77,0)
 ;
"RTN","BIUTL2",78,0)
 ;----------
"RTN","BIUTL2",79,0)
CODE(IEN,TYPE) ;EP
"RTN","BIUTL2",80,0)
 ;---> Return the HL7-CVX, CPT, ICD Diagnosis, or ICD Procedure Code
"RTN","BIUTL2",81,0)
 ;---> for a Vaccine.
"RTN","BIUTL2",82,0)
 ;---> Parameters:
"RTN","BIUTL2",83,0)
 ;     1 - IEN  (req) IEN of Vaccine.
"RTN","BIUTL2",84,0)
 ;     2 - TYPE (opt) TYPE of Code to return:
"RTN","BIUTL2",85,0)
 ;                        1=HL7-CVX (also default)
"RTN","BIUTL2",86,0)
 ;                        2=CPT
"RTN","BIUTL2",87,0)
 ;                        3=ICD Diagnosis
"RTN","BIUTL2",88,0)
 ;                        4=ICD Procedure
"RTN","BIUTL2",89,0)
 ;                        5=Volume Default
"RTN","BIUTL2",90,0)
 ;                        6=HL7-CVX w/leading zero
"RTN","BIUTL2",91,0)
 ;
"RTN","BIUTL2",92,0)
 Q:'$G(IEN) "NO IEN"
"RTN","BIUTL2",93,0)
 Q:'$D(^AUTTIMM(IEN,0)) "UNKNOWN"
"RTN","BIUTL2",94,0)
 ;
"RTN","BIUTL2",95,0)
 Q:$G(TYPE)=2 $P(^AUTTIMM(IEN,0),"^",11)
"RTN","BIUTL2",96,0)
 Q:$G(TYPE)=3 $P(^AUTTIMM(IEN,0),"^",14)
"RTN","BIUTL2",97,0)
 Q:$G(TYPE)=4 $P(^AUTTIMM(IEN,0),"^",15)
"RTN","BIUTL2",98,0)
 Q:$G(TYPE)=5 $P(^AUTTIMM(IEN,0),"^",18)
"RTN","BIUTL2",99,0)
 N X S X=$P(^AUTTIMM(IEN,0),"^",3)
"RTN","BIUTL2",100,0)
 I $G(TYPE)=6,$L(X)=1 S X=0_X
"RTN","BIUTL2",101,0)
 Q X
"RTN","BIUTL2",102,0)
 ;
"RTN","BIUTL2",103,0)
 ;
"RTN","BIUTL2",104,0)
 ;----------
"RTN","BIUTL2",105,0)
IMMVG(BIIEN,Z) ;EP
"RTN","BIUTL2",106,0)
 ;---> For a particular Vaccine, return its Vaccine Group Information.
"RTN","BIUTL2",107,0)
 ;---> (Note: Vaccine Group is also called "Series Type."
"RTN","BIUTL2",108,0)
 ;---> .
"RTN","BIUTL2",109,0)
 ;---> Parameters:
"RTN","BIUTL2",110,0)
 ;     1 - BIIEN  (req) IEN in of Vaccine in IMMUNIZATION File #9999999.14.
"RTN","BIUTL2",111,0)
 ;     2 - Z      (opt) If Z=1, return Vaccine Group FULL NAME.
"RTN","BIUTL2",112,0)
 ;                      If Z=2, return Vaccine Group IEN (default if no Z).
"RTN","BIUTL2",113,0)
 ;                      If Z=3, return Vaccine Group Forecast indicator:
"RTN","BIUTL2",114,0)
 ;                              1=ON, 0=OFF
"RTN","BIUTL2",115,0)
 ;                      If Z=4, return Display Order for reports.
"RTN","BIUTL2",116,0)
 ;                      If Z=5, return SHORT NAME of Vaccine Group.
"RTN","BIUTL2",117,0)
 ;
"RTN","BIUTL2",118,0)
 ;---> Default: Return IEN of Vaccine Group.
"RTN","BIUTL2",119,0)
 S:'$G(Z) Z=2
"RTN","BIUTL2",120,0)
 N BIVG,BIVG0
"RTN","BIUTL2",121,0)
 ;
"RTN","BIUTL2",122,0)
 ;---> If any values or pointers are null, set Vaccine Group IEN=12: "Other".
"RTN","BIUTL2",123,0)
 D
"RTN","BIUTL2",124,0)
 .I '$G(BIIEN) S BIVG=12 Q
"RTN","BIUTL2",125,0)
 .I '$D(^AUTTIMM(BIIEN,0)) S BIVG=12 Q
"RTN","BIUTL2",126,0)
 .S BIVG=$P(^AUTTIMM(BIIEN,0),U,9)
"RTN","BIUTL2",127,0)
 .S:'BIVG BIVG=12
"RTN","BIUTL2",128,0)
 ;
"RTN","BIUTL2",129,0)
 I Z=2 Q BIVG
"RTN","BIUTL2",130,0)
 Q $$VGROUP(BIVG,Z)
"RTN","BIUTL2",131,0)
 ;
"RTN","BIUTL2",132,0)
 ;
"RTN","BIUTL2",133,0)
 ;----------
"RTN","BIUTL2",134,0)
VGROUP(BIVG,Z) ;EP
"RTN","BIUTL2",135,0)
 ;---> Return Vaccine Group or ("Series Type") or Information
"RTN","BIUTL2",136,0)
 ;---> for a particular Vaccine Group.
"RTN","BIUTL2",137,0)
 ;---> Parameters:
"RTN","BIUTL2",138,0)
 ;     1 - BIVG  (req) IEN in BI TABLE VACCINE GROUP File #9002084.93.
"RTN","BIUTL2",139,0)
 ;     2 - Z     (opt) If Z=1, return Vaccine Group FULL NAME (default if no Z).
"RTN","BIUTL2",140,0)
 ;                     If Z=3, return Vaccine Group Forecast indicator:
"RTN","BIUTL2",141,0)
 ;                             1=ON, 0=OFF
"RTN","BIUTL2",142,0)
 ;                     If Z=4, return Display Order for reports.
"RTN","BIUTL2",143,0)
 ;                     If Z=5, return SHORT NAME of Vaccine Group.
"RTN","BIUTL2",144,0)
 ;                     If Z=6, return max doses in Quarterly/Two-Yr-Old Reports.
"RTN","BIUTL2",145,0)
 ;                     If Z=7, return max doses in Adolescent Report.
"RTN","BIUTL2",146,0)
 ;                     If Z=8, return Vaccine Group Two-Yr-Old Report indicator:
"RTN","BIUTL2",147,0)
 ;                             1=Yes,include; 0=No, exclude.
"RTN","BIUTL2",148,0)
 ;
"RTN","BIUTL2",149,0)
 ;---> If null, set Vaccine Group IEN=12: "Other".
"RTN","BIUTL2",150,0)
 S:'$G(BIVG) BIVG=12
"RTN","BIUTL2",151,0)
 N BIVG0 S BIVG0=$G(^BISERT(BIVG,0))
"RTN","BIUTL2",152,0)
 S:BIVG0="" BIVG=12,BIVG0=$G(^BISERT(BIVG,0))
"RTN","BIUTL2",153,0)
 ;
"RTN","BIUTL2",154,0)
 S:('$G(Z)) Z=1
"RTN","BIUTL2",155,0)
 I Z=3 Q +$P(BIVG0,U,5)
"RTN","BIUTL2",156,0)
 I Z=4 Q +$P(BIVG0,U,2)
"RTN","BIUTL2",157,0)
 I Z=5 Q $P(BIVG0,U,3)
"RTN","BIUTL2",158,0)
 I Z=6 Q $P(BIVG0,U,4)
"RTN","BIUTL2",159,0)
 I Z=7 Q $P(BIVG0,U,7)
"RTN","BIUTL2",160,0)
 I Z=8 Q $P(BIVG0,U,8)
"RTN","BIUTL2",161,0)
 Q $P(BIVG0,U)
"RTN","BIUTL2",162,0)
 ;
"RTN","BIUTL2",163,0)
 ;
"RTN","BIUTL2",164,0)
 ;----------
"RTN","BIUTL2",165,0)
HL7TX(BICVX,BIGRP) ;EP
"RTN","BIUTL2",166,0)
 ;---> Return the IEN of a Vaccine, given its HL7 Code.
"RTN","BIUTL2",167,0)
 ;---> If lookup fails, return 137 for "OTHER".
"RTN","BIUTL2",168,0)
 ;---> Parameters:
"RTN","BIUTL2",169,0)
 ;     1 - BICVX  (req) CVX Code for this vaccine.
"RTN","BIUTL2",170,0)
 ;     2 - BIGRP  (opt) If BIGRP=1, return Vaccine Group IEN for this CVX.
"RTN","BIUTL2",171,0)
 ;
"RTN","BIUTL2",172,0)
 ;
"RTN","BIUTL2",173,0)
 I '$G(BICVX) S BICVX=999
"RTN","BIUTL2",174,0)
 ;
"RTN","BIUTL2",175,0)
 ;---> In VISTA, the HL7 codes for single numbers is "03" etc per CDC.
"RTN","BIUTL2",176,0)
 ;---> In RPMS, the HL7 codes are coerced into M style numbers.
"RTN","BIUTL2",177,0)
 ;---> From BIRPC4, we are passed 3 (MMR). We need to make sure that we can
"RTN","BIUTL2",178,0)
 ;---> translate that into either form.
"RTN","BIUTL2",179,0)
 ;
"RTN","BIUTL2",180,0)
 I '$D(^AUTTIMM("C",BICVX)) D
"RTN","BIUTL2",181,0)
 . I $L(BICVX)=1,$D(^AUTTIMM("C","0"_BICVX)) S BICVX="0"_BICVX
"RTN","BIUTL2",182,0)
 . E  S BICVX=999
"RTN","BIUTL2",183,0)
 ;
"RTN","BIUTL2",184,0)
 N BIVIEN S BIVIEN=$O(^AUTTIMM("C",BICVX,0))
"RTN","BIUTL2",185,0)
 S:'BIVIEN BIVIEN=137
"RTN","BIUTL2",186,0)
 ;---> Return Vaccine IEN for this CVX.
"RTN","BIUTL2",187,0)
 Q:'$G(BIGRP) BIVIEN
"RTN","BIUTL2",188,0)
 ;---> Return Vaccine Group for this CVX.
"RTN","BIUTL2",189,0)
 ;
"RTN","BIUTL2",190,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIUTL2",191,0)
 ;---> If the Vaccine Group is null, return IEN for Group "OTHER".
"RTN","BIUTL2",192,0)
 ;Q $P(^AUTTIMM(BIVIEN,0),"^",9)
"RTN","BIUTL2",193,0)
 N X S X=$P(^AUTTIMM(BIVIEN,0),"^",9)
"RTN","BIUTL2",194,0)
 S:'X X=12
"RTN","BIUTL2",195,0)
 Q X
"RTN","BIUTL2",196,0)
 ;**********
"RTN","BIUTL2",197,0)
 ;
"RTN","BIUTL2",198,0)
 ;
"RTN","BIUTL2",199,0)
 ;----------
"RTN","BIUTL2",200,0)
VCOMPS(IEN) ;EP v8.0
"RTN","BIUTL2",201,0)
 ;---> Return string of components IEN's for a Vaccine.
"RTN","BIUTL2",202,0)
 ;---> Parameters:
"RTN","BIUTL2",203,0)
 ;     1 - IEN  (req) IEN of Vaccine.
"RTN","BIUTL2",204,0)
 ;
"RTN","BIUTL2",205,0)
 Q:'$G(IEN) ""
"RTN","BIUTL2",206,0)
 Q:'$D(^AUTTIMM(IEN,0)) ""
"RTN","BIUTL2",207,0)
 N X S X=$P(^AUTTIMM(IEN,0),"^",21,26)
"RTN","BIUTL2",208,0)
 S X=$TR(X,"^",";")
"RTN","BIUTL2",209,0)
 Q X
"RTN","BIUTL2",210,0)
 ;
"RTN","BIUTL2",211,0)
 ;
"RTN","BIUTL2",212,0)
 ;----------
"RTN","BIUTL2",213,0)
VMAX(IEN) ;EP
"RTN","BIUTL2",214,0)
 ;---> Return the Maximum Dose# for a Vaccine.
"RTN","BIUTL2",215,0)
 ;---> Parameters:
"RTN","BIUTL2",216,0)
 ;     1 - IEN  (req) IEN of Vaccine.
"RTN","BIUTL2",217,0)
 ;
"RTN","BIUTL2",218,0)
 Q:'$G(IEN) ""
"RTN","BIUTL2",219,0)
 Q:'$D(^AUTTIMM(IEN,0)) ""
"RTN","BIUTL2",220,0)
 Q $P(^AUTTIMM(IEN,0),"^",5)
"RTN","BIUTL2",221,0)
 ;
"RTN","BIUTL2",222,0)
 ;
"RTN","BIUTL2",223,0)
 ;----------
"RTN","BIUTL2",224,0)
LOTDEF(IEN) ;EP
"RTN","BIUTL2",225,0)
 ;---> Return the IEN of the Default Lot# for a Vaccine.
"RTN","BIUTL2",226,0)
 ;---> Parameters:
"RTN","BIUTL2",227,0)
 ;     1 - IEN  (req) IEN of Vaccine in IMMUNIZATION File (9999999.14).
"RTN","BIUTL2",228,0)
 ;
"RTN","BIUTL2",229,0)
 Q:'$G(IEN) ""
"RTN","BIUTL2",230,0)
 Q:'$D(^AUTTIMM(IEN,0)) ""
"RTN","BIUTL2",231,0)
 N X,Y S X=$P(^AUTTIMM(IEN,0),"^",4)
"RTN","BIUTL2",232,0)
 ;
"RTN","BIUTL2",233,0)
 ;---> Quit if no Default Lot# stored.
"RTN","BIUTL2",234,0)
 Q:'X ""
"RTN","BIUTL2",235,0)
 ;---> Quit if pointed to Lot# does not exist.
"RTN","BIUTL2",236,0)
 S Y=$G(^AUTTIML(X,0))
"RTN","BIUTL2",237,0)
 Q:Y="" ""
"RTN","BIUTL2",238,0)
 ;---> Quit if this Lot# does NOT point back to this Vaccine.
"RTN","BIUTL2",239,0)
 Q:$P(Y,U,4)'=IEN ""
"RTN","BIUTL2",240,0)
 ;---> Quit if this Lot# is INACTIVE.
"RTN","BIUTL2",241,0)
 Q:$P(Y,U,3) ""
"RTN","BIUTL2",242,0)
 ;
"RTN","BIUTL2",243,0)
 ;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIUTL2",244,0)
 ;---> Quit if this Lot# has a Facility and User's DUZ(2) does not match.
"RTN","BIUTL2",245,0)
 Q:(($P(Y,U,14))&($P(Y,U,14)'=$G(DUZ(2)))) ""
"RTN","BIUTL2",246,0)
 ;**********
"RTN","BIUTL2",247,0)
 ;
"RTN","BIUTL2",248,0)
 ;---> Return Default Lot# IEN.
"RTN","BIUTL2",249,0)
 Q X
"RTN","BIUTL2",250,0)
 ;
"RTN","BIUTL2",251,0)
 ;
"RTN","BIUTL2",252,0)
 ;----------
"RTN","BIUTL2",253,0)
LOTREQ(BIDUZ2) ;EP
"RTN","BIUTL2",254,0)
 ;---> Return 1 if Lot#'s are required, 0 if not.
"RTN","BIUTL2",255,0)
 ;---> Parameters:
"RTN","BIUTL2",256,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",257,0)
 ;
"RTN","BIUTL2",258,0)
 Q $P($G(^BISITE(+$G(BIDUZ2),0)),U,9)
"RTN","BIUTL2",259,0)
 ;
"RTN","BIUTL2",260,0)
 ;
"RTN","BIUTL2",261,0)
 ;----------
"RTN","BIUTL2",262,0)
LOTLOW(BILIEN,BIDUZ2) ;EP
"RTN","BIUTL2",263,0)
 ;---> Return the number of (remaining) doses of a Lot Number
"RTN","BIUTL2",264,0)
 ;---> that will trigger a Low Supply Alert.
"RTN","BIUTL2",265,0)
 ;---> If not set for this site, 50 will be returned.
"RTN","BIUTL2",266,0)
 ;---> Parameters:
"RTN","BIUTL2",267,0)
 ;     1 - BILIEN  (req) IEN of Lot Number in ^AUTTIML.
"RTN","BIUTL2",268,0)
 ;     2 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",269,0)
 ;                                         vvv83
"RTN","BIUTL2",270,0)
 N X
"RTN","BIUTL2",271,0)
 D
"RTN","BIUTL2",272,0)
 .S X=$P($G(^AUTTIML(+BILIEN,0)),U,15)  Q:X
"RTN","BIUTL2",273,0)
 .S X=$P($G(^BISITE(+$G(BIDUZ2),0)),U,25)
"RTN","BIUTL2",274,0)
 S:(X="") X=50
"RTN","BIUTL2",275,0)
 Q X
"RTN","BIUTL2",276,0)
 ;
"RTN","BIUTL2",277,0)
 ;
"RTN","BIUTL2",278,0)
 ;----------
"RTN","BIUTL2",279,0)
FORECAS(BIDUZ2) ;EP
"RTN","BIUTL2",280,0)
 ;---> Return 1 if Forecasting is enabled.
"RTN","BIUTL2",281,0)
 ;---> Parameters:
"RTN","BIUTL2",282,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",283,0)
 ;
"RTN","BIUTL2",284,0)
 Q $P($G(^BISITE(+$G(BIDUZ2),0)),U,11)
"RTN","BIUTL2",285,0)
 ;
"RTN","BIUTL2",286,0)
 ;
"RTN","BIUTL2",287,0)
 ;----------
"RTN","BIUTL2",288,0)
INPTCHK(BIDUZ2) ;EP
"RTN","BIUTL2",289,0)
 ;---> Return 1 if Inpatient Visit Check is enabled.
"RTN","BIUTL2",290,0)
 ;---> Parameters:
"RTN","BIUTL2",291,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",292,0)
 ;
"RTN","BIUTL2",293,0)
 Q $P($G(^BISITE(+$G(BIDUZ2),0)),U,23)
"RTN","BIUTL2",294,0)
 ;
"RTN","BIUTL2",295,0)
 ;
"RTN","BIUTL2",296,0)
 ;----------
"RTN","BIUTL2",297,0)
RISKP(BIDUZ2) ;EP - Risk Factor check (and smoking).
"RTN","BIUTL2",298,0)
 ;---> Risk Parameter: Return 0 if disabled, 1 if enabled,
"RTN","BIUTL2",299,0)
 ;---> 3 to include smoking in pneumo.
"RTN","BIUTL2",300,0)
 ;---> Parameters:
"RTN","BIUTL2",301,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",302,0)
 ;
"RTN","BIUTL2",303,0)
 Q +$P($G(^BISITE(+$G(BIDUZ2),0)),U,19)
"RTN","BIUTL2",304,0)
 ;
"RTN","BIUTL2",305,0)
 ;
"RTN","BIUTL2",306,0)
 ;----------
"RTN","BIUTL2",307,0)
IMPCPT(BIDUZ2) ;EP
"RTN","BIUTL2",308,0)
 ;---> Return 1 if Import of CPT-coded Visits is enabled.
"RTN","BIUTL2",309,0)
 ;---> Parameters:
"RTN","BIUTL2",310,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",311,0)
 ;
"RTN","BIUTL2",312,0)
 Q $P($G(^BISITE(+$G(BIDUZ2),0)),U,20)
"RTN","BIUTL2",313,0)
 ;
"RTN","BIUTL2",314,0)
 ;
"RTN","BIUTL2",315,0)
 ;----------
"RTN","BIUTL2",316,0)
VISMNU(BIDUZ2) ;EP
"RTN","BIUTL2",317,0)
 ;---> Visit Selection Menu Parameter: Return 1 to display a menu of matching
"RTN","BIUTL2",318,0)
 ;---> Visits, if any; return 0 to automatically create or link Visits.
"RTN","BIUTL2",319,0)
 ;---> Parameters:
"RTN","BIUTL2",320,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",321,0)
 ;
"RTN","BIUTL2",322,0)
 Q +$P($G(^BISITE(+$G(BIDUZ2),0)),U,28)
"RTN","BIUTL2",323,0)
 ;
"RTN","BIUTL2",324,0)
 ;
"RTN","BIUTL2",325,0)
 ;----------
"RTN","BIUTL2",326,0)
CMGRACT(BICMGR) ;EP
"RTN","BIUTL2",327,0)
 ;---> Return 1 if the Case Manager is INACTIVE.
"RTN","BIUTL2",328,0)
 ;---> Parameters:
"RTN","BIUTL2",329,0)
 ;     1 - BICMGR (req) IEN of Case Manager.
"RTN","BIUTL2",330,0)
 ;
"RTN","BIUTL2",331,0)
 Q:'$G(BICMGR) 1
"RTN","BIUTL2",332,0)
 Q:'$D(^BIMGR(BICMGR,0)) 1
"RTN","BIUTL2",333,0)
 Q $P(^BIMGR(BICMGR,0),U,2)
"RTN","BIUTL2",334,0)
 ;
"RTN","BIUTL2",335,0)
 ;
"RTN","BIUTL2",336,0)
 ;----------
"RTN","BIUTL2",337,0)
CMGRDEF(DUZ2,X) ;EP
"RTN","BIUTL2",338,0)
 ;---> Return Default Case Manager for this site.
"RTN","BIUTL2",339,0)
 ;---> Parameters:
"RTN","BIUTL2",340,0)
 ;     1 - DUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",341,0)
 ;     2 - X    (opt) X=1 to return TEXT of default Case Manager name.
"RTN","BIUTL2",342,0)
 ;
"RTN","BIUTL2",343,0)
 Q:'$G(DUZ2) ""
"RTN","BIUTL2",344,0)
 N Y S Y=$P($G(^BISITE(DUZ2,0)),U,2)
"RTN","BIUTL2",345,0)
 Q:'Y ""
"RTN","BIUTL2",346,0)
 Q:'$D(^BIMGR(Y,0)) ""
"RTN","BIUTL2",347,0)
 Q:'$G(X) Y
"RTN","BIUTL2",348,0)
 Q:$$CMGRACT(Y) $E($$PERSON^BIUTL1(Y),1,20)_" * INACTIVE!"
"RTN","BIUTL2",349,0)
 Q $$PERSON^BIUTL1(Y)
"RTN","BIUTL2",350,0)
 ;
"RTN","BIUTL2",351,0)
 ;
"RTN","BIUTL2",352,0)
 ;----------
"RTN","BIUTL2",353,0)
DEFLET(DUZ2,X,Z) ;EP
"RTN","BIUTL2",354,0)
 ;---> Return Default Letters (Standard Due Letter,
"RTN","BIUTL2",355,0)
 ;---> Official Imm Record).
"RTN","BIUTL2",356,0)
 ;---> Parameters:
"RTN","BIUTL2",357,0)
 ;     1 - DUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",358,0)
 ;     2 - X    (opt) X=1 to return TEXT of default Due Letter.
"RTN","BIUTL2",359,0)
 ;     3 - Z    (opt) Z="" returns Standard Due Letter.
"RTN","BIUTL2",360,0)
 ;                    Z=1 returns Official Immunization Record.
"RTN","BIUTL2",361,0)
 ;
"RTN","BIUTL2",362,0)
 Q:'$G(DUZ2) ""
"RTN","BIUTL2",363,0)
 N Y S Y=$P($G(^BISITE(DUZ2,0)),U,$S($G(Z):13,1:4))
"RTN","BIUTL2",364,0)
 Q:'$G(X) Y
"RTN","BIUTL2",365,0)
 Q:'Y ""
"RTN","BIUTL2",366,0)
 Q $P($G(^BILET(Y,0)),U)
"RTN","BIUTL2",367,0)
 ;
"RTN","BIUTL2",368,0)
 ;
"RTN","BIUTL2",369,0)
 ;----------
"RTN","BIUTL2",370,0)
MINDAYS(DUZ2) ;EP
"RTN","BIUTL2",371,0)
 ;---> Return Default Minimum Days Since Last Letter sent
"RTN","BIUTL2",372,0)
 ;---> for this site.
"RTN","BIUTL2",373,0)
 ;---> Parameters:
"RTN","BIUTL2",374,0)
 ;     1 - DUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",375,0)
 ;
"RTN","BIUTL2",376,0)
 Q:'$G(DUZ2) 60
"RTN","BIUTL2",377,0)
 N Y S Y=$P($G(^BISITE(DUZ2,0)),U,5)
"RTN","BIUTL2",378,0)
 Q:Y="" 60
"RTN","BIUTL2",379,0)
 Q Y
"RTN","BIUTL2",380,0)
 ;
"RTN","BIUTL2",381,0)
 ;
"RTN","BIUTL2",382,0)
 ;----------
"RTN","BIUTL2",383,0)
MINAGE(DUZ2) ;EP
"RTN","BIUTL2",384,0)
 ;---> Return parameter to forecast immunizations due at either the
"RTN","BIUTL2",385,0)
 ;---> Minimum Acceptable Age or at the Recommended Age for this site.
"RTN","BIUTL2",386,0)
 ;---> Parameters:
"RTN","BIUTL2",387,0)
 ;     1 - DUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",388,0)
 ;
"RTN","BIUTL2",389,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIUTL2",390,0)
 ;---> Change returned value to 1 or 0 to accommodate new forecaster.
"RTN","BIUTL2",391,0)
 Q:'$G(DUZ2) 0
"RTN","BIUTL2",392,0)
 Q:($P($G(^BISITE(DUZ2,0)),U,7)="A") 1
"RTN","BIUTL2",393,0)
 Q 0
"RTN","BIUTL2",394,0)
 ;**********
"RTN","BIUTL2",395,0)
 ;
"RTN","BIUTL2",396,0)
 ;
"RTN","BIUTL2",397,0)
 ;----------
"RTN","BIUTL2",398,0)
RULES(DUZ2) ;EP
"RTN","BIUTL2",399,0)
 ;---> Return parameter indicating which set of Immserve Forecasting
"RTN","BIUTL2",400,0)
 ;---> Rules is being used (passed to Immserve).
"RTN","BIUTL2",401,0)
 ;---> Parameters:
"RTN","BIUTL2",402,0)
 ;     1 - DUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",403,0)
 ;
"RTN","BIUTL2",404,0)
 N Y S Y=$$VALIDRUL(DUZ2)
"RTN","BIUTL2",405,0)
 Q:'Y "IHS_1m18"
"RTN","BIUTL2",406,0)
 Q "IHS_"_Y
"RTN","BIUTL2",407,0)
 ;
"RTN","BIUTL2",408,0)
 ;
"RTN","BIUTL2",409,0)
 ;----------
"RTN","BIUTL2",410,0)
VALIDRUL(DUZ2) ;EP - Return 0 if not a valid choice of Immserve Rules.
"RTN","BIUTL2",411,0)
 ;---> Return whether current Immserve Site Parameter is a valid choice.
"RTN","BIUTL2",412,0)
 ;---> Return 0 is NOT a valid choice; otherwise return the numeric choice.
"RTN","BIUTL2",413,0)
 ;---> Parameters:
"RTN","BIUTL2",414,0)
 ;     1 - DUZ2 (req) User's DUZ(2)
"RTN","BIUTL2",415,0)
 ;
"RTN","BIUTL2",416,0)
 Q:'$G(DUZ2) 0
"RTN","BIUTL2",417,0)
 N X,Y
"RTN","BIUTL2",418,0)
 S Y=$G(^BISITE(DUZ(2),0)),X=$P(Y,U,8)
"RTN","BIUTL2",419,0)
 ;---> For a new set of Immserve Rules, change here below and $$RULES+10^BISITE2.
"RTN","BIUTL2",420,0)
 ;---> Current valid choices are 1,2,3,4,5,11.
"RTN","BIUTL2",421,0)
 Q:((X<1)!(X>11)) 0
"RTN","BIUTL2",422,0)
 Q:((X>7)&(X<11)) 0
"RTN","BIUTL2",423,0)
 Q X_$S($P(Y,U,21):"g",1:"")_$S($P(Y,U,24)=2:"m26",1:"m18")
"RTN","BIUTL2",424,0)
 ;
"RTN","BIUTL2",425,0)
 ;
"RTN","BIUTL2",426,0)
 ;----------
"RTN","BIUTL2",427,0)
VISDEF(IEN) ;EP
"RTN","BIUTL2",428,0)
 ;---> Return the Default Date of the Vaccine Information Statement
"RTN","BIUTL2",429,0)
 ;---> (VIS) for this vaccine (Fileman format).
"RTN","BIUTL2",430,0)
 ;---> Parameters:
"RTN","BIUTL2",431,0)
 ;     1 - IEN  (req) IEN of Vaccine in IMMUNIZATION File (9999999.14).
"RTN","BIUTL2",432,0)
 ;
"RTN","BIUTL2",433,0)
 Q:'$G(IEN) ""
"RTN","BIUTL2",434,0)
 Q:'$D(^AUTTIMM(IEN,0)) ""
"RTN","BIUTL2",435,0)
 Q $P(^AUTTIMM(IEN,0),"^",13)
"RTN","BIUTL2",436,0)
 ;
"RTN","BIUTL2",437,0)
 ;
"RTN","BIUTL2",438,0)
 ;----------
"RTN","BIUTL2",439,0)
ZIS(BIPOP,BIQUE,BIDEF,BIPRMPT,BIMES) ;EP
"RTN","BIUTL2",440,0)
 ;---> Call to ^%ZIS
"RTN","BIUTL2",441,0)
 ;---> Parameters:
"RTN","BIUTL2",442,0)
 ;     1 - BIPOP         (ret) BIPOP=1 if POP=1 (fail or quit).
"RTN","BIUTL2",443,0)
 ;     2 - BIQUE=1       (opt) SET=1 if job should be queueable.
"RTN","BIUTL2",444,0)
 ;     3 - BIDEF=DEFAULT (opt) If exists, equals Default DEVICE.
"RTN","BIUTL2",445,0)
 ;     4 - BIPRMPT       (opt) If exists, equals PROMPT.
"RTN","BIUTL2",446,0)
 ;     5 - BIMES         (opt) A message to display if QUEUED.
"RTN","BIUTL2",447,0)
 ;
"RTN","BIUTL2",448,0)
 ;---> Example: D ZIS^BIUTL2(.BIPOP,1,"HOME")
"RTN","BIUTL2",449,0)
 ;
"RTN","BIUTL2",450,0)
ZIS1 ;EP for loop back from failed BIQUE.
"RTN","BIUTL2",451,0)
 ; ZEXCEPT:%ZIS,IOM,ION,IOSL,IOST
"RTN","BIUTL2",452,0)
 ; ZEXCEPT:ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","BIUTL2",453,0)
 S BIPOP=0
"RTN","BIUTL2",454,0)
 ;
"RTN","BIUTL2",455,0)
 ;---> BIPRMPT=BIPRMPT.
"RTN","BIUTL2",456,0)
 S %ZIS("A")=$S($D(BIPRMPT):BIPRMPT,1:"   Select DEVICE: ")
"RTN","BIUTL2",457,0)
 ;
"RTN","BIUTL2",458,0)
 ;---> BIDEF=DEFAULT PRINTER.
"RTN","BIUTL2",459,0)
 ;---> IF NO BIDEF, SET BIDEF="P" FOR CLOSEST PRINTER.
"RTN","BIUTL2",460,0)
 D
"RTN","BIUTL2",461,0)
 .I '$D(BIDEF) S %ZIS="P" Q
"RTN","BIUTL2",462,0)
 .S %ZIS("B")=BIDEF,%ZIS=""
"RTN","BIUTL2",463,0)
 ;
"RTN","BIUTL2",464,0)
 ;---> If BIQUE=1,job may be queued.
"RTN","BIUTL2",465,0)
 I $G(BIQUE)]"" I BIQUE S %ZIS=%ZIS_"Q"
"RTN","BIUTL2",466,0)
 ;
"RTN","BIUTL2",467,0)
 W ! D ^%ZIS S:POP BIPOP=1
"RTN","BIUTL2",468,0)
 ;---> Quit if BIPOP (DUOUT or DTOUT) or if not queued.
"RTN","BIUTL2",469,0)
 G:BIPOP!('$D(IO("Q"))) ZISEXIT
"RTN","BIUTL2",470,0)
 ;
"RTN","BIUTL2",471,0)
 I IO=IO(0) W !?5,"Cannot queue to screen or slave printer!",! G ZIS1
"RTN","BIUTL2",472,0)
 ;
"RTN","BIUTL2",473,0)
 ;---> NEXT LINE: Line Label "ZISQ" added for entry where Device
"RTN","BIUTL2",474,0)
 ;---> Info has already been adked and User queued output.
"RTN","BIUTL2",475,0)
ZISQ ;EP
"RTN","BIUTL2",476,0)
 ;---> NEXT LINES: Job was queued, therefore set BIPOP=1 so that the
"RTN","BIUTL2",477,0)
 ;---> calling routine will quit (and let Taskman finish this job).
"RTN","BIUTL2",478,0)
 S BIPOP=1
"RTN","BIUTL2",479,0)
 I '$D(ZTRTN) D  G ZISEXIT
"RTN","BIUTL2",480,0)
 .W !?5,*7,"NO ROUTINE NAMED FOR QUEUEING -- CONTACT PROGRAMMER."
"RTN","BIUTL2",481,0)
 I '$D(ZTDESC) S ZTDESC=ZTRTN
"RTN","BIUTL2",482,0)
 S BIMES=$S($D(BIMES):BIMES,1:"W !?5,""Request Queued."",!")
"RTN","BIUTL2",483,0)
 ;
"RTN","BIUTL2",484,0)
 S ZTIO=$S($D(ION):ION,1:"")
"RTN","BIUTL2",485,0)
 I ZTIO]"" D
"RTN","BIUTL2",486,0)
 .I $D(IO("DOC")) S ZTIO=ZTIO_";"_IOST_";"_IO("DOC") Q
"RTN","BIUTL2",487,0)
 .S ZTIO=ZTIO_";"_IOST_";"_IOM_";"_IOSL
"RTN","BIUTL2",488,0)
 ;
"RTN","BIUTL2",489,0)
 ;---> Uncomment next line to suppress "Requested Start Time" question.
"RTN","BIUTL2",490,0)
 ;S ZTDTH=$H
"RTN","BIUTL2",491,0)
 D ^%ZTLOAD,^%ZISC
"RTN","BIUTL2",492,0)
 X:$D(ZTQUEUED) BIMES H 2
"RTN","BIUTL2",493,0)
 ;
"RTN","BIUTL2",494,0)
ZISEXIT ;EP
"RTN","BIUTL2",495,0)
 K BIMES,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","BIUTL2",496,0)
 Q
"RTN","BIUTL2",497,0)
 ;
"RTN","BIUTL2",498,0)
 ;
"RTN","BIUTL2",499,0)
 ;----------
"RTN","BIUTL2",500,0)
DFNCHECK() ;EP
"RTN","BIUTL2",501,0)
 ;---> If BIDFN not supplied, set Error Code and quit.
"RTN","BIUTL2",502,0)
 ; ZEXCEPT: BIDFN
"RTN","BIUTL2",503,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(201,,1) Q 1
"RTN","BIUTL2",504,0)
 Q 0
"RTN","BIUTL2",505,0)
 ;
"RTN","BIUTL2",506,0)
 ;
"RTN","BIUTL2",507,0)
 ;----------
"RTN","BIUTL2",508,0)
DUZCHECK() ;EP
"RTN","BIUTL2",509,0)
 ; ZEXCEPT: BIDUZ2
"RTN","BIUTL2",510,0)
 ;---> If no BIDUZ2 (Site IEN), Set it equal to User's DUZ(2).
"RTN","BIUTL2",511,0)
 ;---> If User's DUZ(2) fails, set Error Code and quit.
"RTN","BIUTL2",512,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIUTL2",513,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q 1
"RTN","BIUTL2",514,0)
 Q 0
"RTN","BIUTL3")
0^152^B21545278
"RTN","BIUTL3",1,0)
BIUTL3 ;IHS/CMI/MWR - UTIL: ZTSAVE, ASKDATE, DIRZ.; MAY 10, 2010
"RTN","BIUTL3",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIUTL3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL3",4,0)
 ;;  UTILITY: SAVE ANY AND ALL BI VARIABLES FOR QUEUEING TO TASKMAN,
"RTN","BIUTL3",5,0)
 ;;  ASK DATE RANGE, DIRZ (PROMPT TO CONTINUE).
"RTN","BIUTL3",6,0)
 ;;  PATCH 2: Add more variables to save: BIDELIM, BIU19.
"RTN","BIUTL3",7,0)
 ;;  PATCH 5: Add more variables to save: BITOTPTS, BITOTFPT, BITOTMPT ZSAVES+77
"RTN","BIUTL3",8,0)
 ;
"RTN","BIUTL3",9,0)
 ;
"RTN","BIUTL3",10,0)
 ;----------
"RTN","BIUTL3",11,0)
ZSAVES ;EP
"RTN","BIUTL3",12,0)
 ;---> Single central calling point for saving BI local
"RTN","BIUTL3",13,0)
 ;---> variables and arrays in ZTSAVE for queuing to Taskman.
"RTN","BIUTL3",14,0)
 ;---> Any of the BI variables listed below, if defined,
"RTN","BIUTL3",15,0)
 ;---> will be stored in the ZTSAVE array.
"RTN","BIUTL3",16,0)
 ;---> To add additional variables or arrays, simply document
"RTN","BIUTL3",17,0)
 ;---> in the list and add to appropriate FOR loop below.
"RTN","BIUTL3",18,0)
 ;
"RTN","BIUTL3",19,0)
 ;---> Variables:
"RTN","BIUTL3",20,0)
 ;
"RTN","BIUTL3",21,0)
 ;        ZTSAVE  (ret) Taskman array of saved variables and arrays.
"RTN","BIUTL3",22,0)
 ;
"RTN","BIUTL3",23,0)
 ;     Single:
"RTN","BIUTL3",24,0)
 ;     -------
"RTN","BIUTL3",25,0)
 ;        BIACT   (opt) All or ACTIVE Only in Patient Errors.
"RTN","BIUTL3",26,0)
 ;        BIAG    (opt) Age Range in months.
"RTN","BIUTL3",27,0)
 ;        BIAGRP  (opt) Node/number for this Age Group.
"RTN","BIUTL3",28,0)
 ;        BIAGRPS (opt) Age Groups in Two-Year-Old Report.
"RTN","BIUTL3",29,0)
 ;        BIBEGDT (opt) Begin date of report.
"RTN","BIUTL3",30,0)
 ;        BICOLL  (opt) Order of Lot Number listing, 1-4.
"RTN","BIUTL3",31,0)
 ;        BICPTI  (opt) 1=Include CPT Coded Visits, 0=Ignore CPT (default).
"RTN","BIUTL3",32,0)
 ;        BIDAR   (opt) Adolescent Report Age Range: "11-18^1" (years).
"RTN","BIUTL3",33,0)
 ;        BIDED   (opt) Include Deceased Patients (0=no, 1=yes).
"RTN","BIUTL3",34,0)
 ;        BIDELIM (opt) Delimiter (1="^", 2="2 spaces").
"RTN","BIUTL3",35,0)
 ;        BIDFN   (opt) Patient's IEN in VA PATIENT File #2.
"RTN","BIUTL3",36,0)
 ;        BIDLOC  (opt) Date-Location Line of letter.
"RTN","BIUTL3",37,0)
 ;        BIDLOT  (opt) Display report by Lot Number (VAC).
"RTN","BIUTL3",38,0)
 ;        BIENDDT (opt) End date of report.
"RTN","BIUTL3",39,0)
 ;        BIFDT   (opt) Forecast/Clinic date.
"RTN","BIUTL3",40,0)
 ;        BIFH    (opt) F=report on Flu Vaccine Group, H=H1N1 group.
"RTN","BIUTL3",41,0)
 ;        BIHIST  (opt) Include Historical (Vac Acct Report).
"RTN","BIUTL3",42,0)
 ;        BIHPV   (opt) 1=include HepA, Pneumo & Var, 0=exclude.
"RTN","BIUTL3",43,0)
 ;        BILET   (opt) IEN of Letter in BI LETTER File.
"RTN","BIUTL3",44,0)
 ;        BIMD    (opt) Minimum Interval days since last letter.
"RTN","BIUTL3",45,0)
 ;        BINFO   (opt) Additional Information for each patient (no longer used).
"RTN","BIUTL3",46,0)
 ;        BIORD   (opt) Order of listing.
"RTN","BIUTL3",47,0)
 ;        BIPG    (opt) Patient Group (see calling routine).
"RTN","BIUTL3",48,0)
 ;        BIQDT   (opt) Quarter Ending Date.
"RTN","BIUTL3",49,0)
 ;        BIRDT   (opt) Date Range for Received Imms (form BEGDATE:ENDDATE).
"RTN","BIUTL3",50,0)
 ;        BIRPDT  (opt) Report Date in View List (if passed from reports).
"RTN","BIUTL3",51,0)
 ;        BISITE  (opt) IEN of Site.
"RTN","BIUTL3",52,0)
 ;        BISUBT  (opt) Subtitle String for Lot Order in BILOT.
"RTN","BIUTL3",53,0)
 ;        BITAR   (opt) Two-Yr-Old Report Age Range.
"RTN","BIUTL3",54,0)
 ;        BITOTPTS(opt) Total Number of Patients.
"RTN","BIUTL3",55,0)
 ;        BITOTFPT(opt) Total Number of Female Patients.
"RTN","BIUTL3",56,0)
 ;        BITOTMPT(opt) Total Number of Male Patients.
"RTN","BIUTL3",57,0)
 ;        BIU19   (opt) Include Adults (19 yrs & over).
"RTN","BIUTL3",58,0)
 ;        BIUP    (opt) User Population/Group (Registered, User, Active).
"RTN","BIUTL3",59,0)
 ;        BIVFC   (opt) VFC Eligibility for Imm Visits.
"RTN","BIUTL3",60,0)
 ;        BIYEAR  (opt) Report Year.
"RTN","BIUTL3",61,0)
 ;
"RTN","BIUTL3",62,0)
 ;     Arrays:
"RTN","BIUTL3",63,0)
 ;     -------
"RTN","BIUTL3",64,0)
 ;        BIBEN   (opt) Beneficiary Type array.
"RTN","BIUTL3",65,0)
 ;        BICC    (opt) Current Community array.
"RTN","BIUTL3",66,0)
 ;        BICM    (opt) Case Manager array.
"RTN","BIUTL3",67,0)
 ;        BIDPRV  (opt) Designated Provider array.
"RTN","BIUTL3",68,0)
 ;        BIHCF   (opt) Health Care Facility array.
"RTN","BIUTL3",69,0)
 ;        BILOT   (opt) Lot Number array.
"RTN","BIUTL3",70,0)
 ;        BIMMD   (opt) Immunization Due array.
"RTN","BIUTL3",71,0)
 ;        BIMMR   (opt) Immunization Received array.
"RTN","BIUTL3",72,0)
 ;        BIMMRF  (opt) Immunization Received Filter array.
"RTN","BIUTL3",73,0)
 ;        BIMMLF  (opt) Lot Number Filter array.
"RTN","BIUTL3",74,0)
 ;        BINFO   (opt) Additional Information for each patient.
"RTN","BIUTL3",75,0)
 ;        BIVT    (opt) Visit Type array.
"RTN","BIUTL3",76,0)
 ;
"RTN","BIUTL3",77,0)
 ;---> Save local variables for queueing Due List/Letters.
"RTN","BIUTL3",78,0)
 K ZTSAVE N BISV
"RTN","BIUTL3",79,0)
 ;
"RTN","BIUTL3",80,0)
 F BISV="ACT","AG","AGRP","AGRPS","BEGDT","COLL","CPTI","DAR","DED","DELIM","DFN" D
"RTN","BIUTL3",81,0)
 .S BISV="BI"_BISV
"RTN","BIUTL3",82,0)
 .I $D(@(BISV)) S ZTSAVE(BISV)=""
"RTN","BIUTL3",83,0)
 ;
"RTN","BIUTL3",84,0)
 F BISV="DLOC","DLOT","ENDDT","FDT","FH","HIST","HPV","LET","MD","NFO","ORD" D
"RTN","BIUTL3",85,0)
 .S BISV="BI"_BISV
"RTN","BIUTL3",86,0)
 .I $D(@(BISV)) S ZTSAVE(BISV)=""
"RTN","BIUTL3",87,0)
 ;
"RTN","BIUTL3",88,0)
 F BISV="PG","QDT","RDT","RPDT","SITE","SUBT","T","TAR","TOTPTS","TOTFPT","TOTFMPT" D
"RTN","BIUTL3",89,0)
 .S BISV="BI"_BISV
"RTN","BIUTL3",90,0)
 .I $D(@(BISV)) S ZTSAVE(BISV)=""
"RTN","BIUTL3",91,0)
 ;
"RTN","BIUTL3",92,0)
 F BISV="U19","UP","VFC","YEAR" D
"RTN","BIUTL3",93,0)
 .S BISV="BI"_BISV
"RTN","BIUTL3",94,0)
 .I $D(@(BISV)) S ZTSAVE(BISV)=""
"RTN","BIUTL3",95,0)
 ;
"RTN","BIUTL3",96,0)
 ;---> Save local arrays for queueing Due List/Letters.
"RTN","BIUTL3",97,0)
 F BISV="BEN","CC","CM","DPRV","HCF","LOT","MMD","MMLF","MMR","MMRF","VT" D
"RTN","BIUTL3",98,0)
 .S BISV="BI"_BISV
"RTN","BIUTL3",99,0)
 .D:$D(@BISV)
"RTN","BIUTL3",100,0)
 ..N N S N=0 F  S N=$O(@(BISV_"("""_N_""")")) Q:N=""  D
"RTN","BIUTL3",101,0)
 ...S ZTSAVE(BISV_"("""_N_""")")=""
"RTN","BIUTL3",102,0)
 Q
"RTN","BIUTL3",103,0)
 ;
"RTN","BIUTL3",104,0)
 ;
"RTN","BIUTL3",105,0)
 ;----------
"RTN","BIUTL3",106,0)
ASKDATES(BIB,BIE,BIPOP,BIBDF,BIEDF,BISAME,BITIME) ;EP
"RTN","BIUTL3",107,0)
 ;---> Ask date range.
"RTN","BIUTL3",108,0)
 ;---> Parameters:
"RTN","BIUTL3",109,0)
 ;     1 - BIB    (ret) Begin Date, Fileman format.
"RTN","BIUTL3",110,0)
 ;     2 - BIE    (ret) End Date, Fileman format.
"RTN","BIUTL3",111,0)
 ;     3 - BIPOP  (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BIUTL3",112,0)
 ;     4 - BIBDF  (opt) Begin Date default, Fileman format.
"RTN","BIUTL3",113,0)
 ;     5 - BIEDF  (opt) End Date default, Fileman format.
"RTN","BIUTL3",114,0)
 ;     6 - BISAME (opt) Force End Date default=Begin Date.
"RTN","BIUTL3",115,0)
 ;     7 - BITIME (opt) Ask times.
"RTN","BIUTL3",116,0)
 ;
"RTN","BIUTL3",117,0)
 ;---> Example:
"RTN","BIUTL3",118,0)
 ;        D ASKDATES^BIUTL3(.BIBEGDT,.BIENDDT,.BIPOP,"T-365","T")
"RTN","BIUTL3",119,0)
 ;
"RTN","BIUTL3",120,0)
 S BIPOP=0 N %DT,Y
"RTN","BIUTL3",121,0)
 W !!,"   *** Date Range Selection ***"
"RTN","BIUTL3",122,0)
 ;
"RTN","BIUTL3",123,0)
 ;---> Begin Date.
"RTN","BIUTL3",124,0)
 S %DT="APEX"_$S($G(BITIME):"T",1:"")
"RTN","BIUTL3",125,0)
 S %DT("A")="   Begin with DATE: "
"RTN","BIUTL3",126,0)
 I $G(BIBDF)]"" S Y=BIBDF D DD^%DT S %DT("B")=Y
"RTN","BIUTL3",127,0)
 D ^%DT K %DT
"RTN","BIUTL3",128,0)
 I Y<0 S BIPOP=1 Q
"RTN","BIUTL3",129,0)
 ;
"RTN","BIUTL3",130,0)
 ;---> End Date.
"RTN","BIUTL3",131,0)
 S (%DT(0),BIB)=Y K %DT("B")
"RTN","BIUTL3",132,0)
 S %DT="APEX"_$S($D(BITIME):"T",1:"")
"RTN","BIUTL3",133,0)
 S %DT("A")="   End with DATE:   "
"RTN","BIUTL3",134,0)
 I $G(BIEDF)]"" S Y=BIEDF D DD^%DT S %DT("B")=Y
"RTN","BIUTL3",135,0)
 I $D(BISAME) S Y=BIB D DD^%DT S %DT("B")=Y
"RTN","BIUTL3",136,0)
 D ^%DT K %DT
"RTN","BIUTL3",137,0)
 I Y<0 S BIPOP=1 Q
"RTN","BIUTL3",138,0)
 S BIE=Y
"RTN","BIUTL3",139,0)
 Q
"RTN","BIUTL3",140,0)
 ;
"RTN","BIUTL3",141,0)
 ;
"RTN","BIUTL3",142,0)
 ;----------
"RTN","BIUTL3",143,0)
DATE(BIDT,BIPOP,BIDFLT,BIPRMPT,BITIME) ;EP
"RTN","BIUTL3",144,0)
 ;---> Ask Date.
"RTN","BIUTL3",145,0)
 ;---> Parameters:
"RTN","BIUTL3",146,0)
 ;     1 - BIDT    (ret) Selected Date, Fileman format.
"RTN","BIUTL3",147,0)
 ;     2 - BIPOP   (ret) BIPOP=1 If quit, fail, DTOUT, DUOUT.
"RTN","BIUTL3",148,0)
 ;     3 - BIDFLT  (opt) Default, Fileman format.
"RTN","BIUTL3",149,0)
 ;     4 - BIPRMPT (opt) Prompt.
"RTN","BIUTL3",150,0)
 ;     5 - BITIME  (opt) Ask times.
"RTN","BIUTL3",151,0)
 ;
"RTN","BIUTL3",152,0)
 ;---> EXAMPLE:
"RTN","BIUTL3",153,0)
 ;        D DATE^BIUTL3(.BIDT,.BIPOP,DT)
"RTN","BIUTL3",154,0)
 ;
"RTN","BIUTL3",155,0)
 S BIPOP=0 N %DT,Y
"RTN","BIUTL3",156,0)
 S %DT="APEX"_$S($G(BITIME):"T",1:"")
"RTN","BIUTL3",157,0)
 S:$G(BIPRMPT)="" BIPRMPT="   Enter DATE: "
"RTN","BIUTL3",158,0)
 S %DT("A")=BIPRMPT
"RTN","BIUTL3",159,0)
 I $G(BIDFLT)]"" S Y=BIDFLT D DD^%DT S %DT("B")=Y
"RTN","BIUTL3",160,0)
 D ^%DT K %DT
"RTN","BIUTL3",161,0)
 I Y<0 S BIPOP=1 Q
"RTN","BIUTL3",162,0)
 S BIDT=Y
"RTN","BIUTL3",163,0)
 Q
"RTN","BIUTL3",164,0)
 ;
"RTN","BIUTL3",165,0)
 ;
"RTN","BIUTL3",166,0)
 ;----------
"RTN","BIUTL3",167,0)
LOCKED ;EP
"RTN","BIUTL3",168,0)
 D EN^DDIOL("Another user is editing this entry.  Please, try again later.",,"!?5")
"RTN","BIUTL3",169,0)
 D DIRZ()
"RTN","BIUTL3",170,0)
 Q
"RTN","BIUTL3",171,0)
 ;
"RTN","BIUTL3",172,0)
 ;
"RTN","BIUTL3",173,0)
 ;----------
"RTN","BIUTL3",174,0)
DIRZ(BIPOP,BIPRMT,BIPRMT1,BIPRMT2,BIPRMTQ) ;EP - Press RETURN to continue.
"RTN","BIUTL3",175,0)
 ;---> Call to ^DIR, to Press RETURN to continue.
"RTN","BIUTL3",176,0)
 ;---> Parameters:
"RTN","BIUTL3",177,0)
 ;     1 - BIPOP   (ret) BIPOP=1 if DTOUT or DUOUT
"RTN","BIUTL3",178,0)
 ;     2 - BIPRMT  (opt) Prompt other than "Press RETURN..."
"RTN","BIUTL3",179,0)
 ;     3 - BIPRMT1 (opt) Prompt other than "Press RETURN..."
"RTN","BIUTL3",180,0)
 ;     4 - BIPRMT2 (opt) Prompt other than "Press RETURN..."
"RTN","BIUTL3",181,0)
 ;     5 - BIPRMTQ (opt) Response to "?" other than standard
"RTN","BIUTL3",182,0)
 ;
"RTN","BIUTL3",183,0)
 ;---> Example: D DIRZ^BIUTL3(.BIPOP)
"RTN","BIUTL3",184,0)
 ;
"RTN","BIUTL3",185,0)
 N DDS,DIR,DIRUT,X,Y,Z
"RTN","BIUTL3",186,0)
 D
"RTN","BIUTL3",187,0)
 .I $G(BIPRMT)="" D  Q
"RTN","BIUTL3",188,0)
 ..S DIR("A")="   Press ENTER/RETURN to continue or ""^"" to exit"
"RTN","BIUTL3",189,0)
 .S DIR("A")=BIPRMT
"RTN","BIUTL3",190,0)
 .I $G(BIPRMT1)]"" S DIR("A",1)=BIPRMT1
"RTN","BIUTL3",191,0)
 .I $G(BIPRMT2)]"" S DIR("A",2)=BIPRMT2
"RTN","BIUTL3",192,0)
 I $G(BIPRMTQ)]"" S DIR("?")=BIPRMTQ
"RTN","BIUTL3",193,0)
 S DIR(0)="E" W ! D ^DIR W !
"RTN","BIUTL3",194,0)
 S BIPOP=$S($D(DIRUT):1,Y<1:1,1:0)
"RTN","BIUTL3",195,0)
 Q
"RTN","BIUTL3",196,0)
 ;
"RTN","BIUTL3",197,0)
 ;
"RTN","BIUTL3",198,0)
 ;----------
"RTN","BIUTL3",199,0)
NOW1 ;EP
"RTN","BIUTL3",200,0)
 ;---> S BITTTS=Start time.
"RTN","BIUTL3",201,0)
 N %,Y,X D NOW^%DTC S BITTTS=%
"RTN","BIUTL3",202,0)
 Q
"RTN","BIUTL3",203,0)
 ;
"RTN","BIUTL3",204,0)
 ;
"RTN","BIUTL3",205,0)
 ;----------
"RTN","BIUTL3",206,0)
NOW2 ;EP
"RTN","BIUTL3",207,0)
 ;---> S BITTTE=End time.
"RTN","BIUTL3",208,0)
 N %,Y,X D NOW^%DTC S BITTTE=%
"RTN","BIUTL3",209,0)
 ;
"RTN","BIUTL3",210,0)
 ;---> Compare times.
"RTN","BIUTL3",211,0)
 S Y=BITTTE X ^DD("DD") W !!?5,"End  : ",$P(Y,"@",2)
"RTN","BIUTL3",212,0)
 S Y=BITTTS X ^DD("DD") W !?5,"Begin: ",$P(Y,"@",2)
"RTN","BIUTL3",213,0)
 D DIRZ()
"RTN","BIUTL3",214,0)
 K BITTTE,BITTTS
"RTN","BIUTL3",215,0)
 Q
"RTN","BIUTL4")
0^153^B143400322
"RTN","BIUTL4",1,0)
BIUTL4 ;IHS/CMI/MWR - UTIL: SCREENMAN CODE; OCT 15, 2010
"RTN","BIUTL4",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIUTL4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL4",4,0)
 ;;  UTILITY: SCREENMAN CODE: VAC SELECT ACTIONS, SERIES VALID,
"RTN","BIUTL4",5,0)
 ;;           LOC BRANCHING LOGIC, VISIT LOC DEF, SKIN TEST READ MM.
"RTN","BIUTL4",6,0)
 ;;  PATCH 2: Comment out code that would disable VFC Elig field for
"RTN","BIUTL4",7,0)
 ;            patients >19yrs.  OLDDATE+15
"RTN","BIUTL4",8,0)
 ;;  PATCH 5: Add NDC to reset fields when vaccine is changed.  VACCHG+14
"RTN","BIUTL4",9,0)
 ;;  PATCH 5: Add leading zero to default volume if less than 1.  VISVOL+21
"RTN","BIUTL4",10,0)
 ;;  PATCH 9: Make VIS Presented Date default to Visit Date (when changed).  OLDATE+9
"RTN","BIUTL4",11,0)
 ;
"RTN","BIUTL4",12,0)
 ;----------
"RTN","BIUTL4",13,0)
VACSCR ;EP
"RTN","BIUTL4",14,0)
 ;ZEXCEPT:DIR
"RTN","BIUTL4",15,0)
 ;---> Set Screen for vaccine selection in Screen field of
"RTN","BIUTL4",16,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL4",17,0)
 ;---> when selecting vaccine.
"RTN","BIUTL4",18,0)
 ;---> Screen: If this vaccine is Active OR if this is an Historical Event
"RTN","BIUTL4",19,0)
 ;--->         AND this is NOT a Skin Test.
"RTN","BIUTL4",20,0)
 ;
"RTN","BIUTL4",21,0)
 S DIR("S")="I ('$P(^AUTTIMM(Y,0),U,7)!($G(BI(""I""))=""E""))"
"RTN","BIUTL4",22,0)
 S DIR("S")=DIR("S")_"&('$P(^AUTTIMM(Y,0),U,8))"
"RTN","BIUTL4",23,0)
 Q
"RTN","BIUTL4",24,0)
 ;
"RTN","BIUTL4",25,0)
 ;
"RTN","BIUTL4",26,0)
 ;----------
"RTN","BIUTL4",27,0)
VACSEL(BIVAC) ;EP
"RTN","BIUTL4",28,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",29,0)
 ;---> For IMMUNIZATIONS:
"RTN","BIUTL4",30,0)
 ;---> Actions to take in Screenman when Vaccine is selected.
"RTN","BIUTL4",31,0)
 ;---> Called by the POST ACTION of Field 2, Vaccine
"RTN","BIUTL4",32,0)
 ;---> of the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",33,0)
 ;---> Parameters:
"RTN","BIUTL4",34,0)
 ;     1 - BIVAC (req) IEN of Vaccine in IMM File (9999999.14).
"RTN","BIUTL4",35,0)
 ;
"RTN","BIUTL4",36,0)
 ;---> Display Vaccine Short Name below Vaccine Name.
"RTN","BIUTL4",37,0)
 Q:('$G(BIVAC))
"RTN","BIUTL4",38,0)
 S BI("B")=BIVAC
"RTN","BIUTL4",39,0)
 D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(BIVAC)_")")
"RTN","BIUTL4",40,0)
 Q
"RTN","BIUTL4",41,0)
 ;
"RTN","BIUTL4",42,0)
 ;
"RTN","BIUTL4",43,0)
 ;----------
"RTN","BIUTL4",44,0)
VACSELC(BIVAC) ;EP
"RTN","BIUTL4",45,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",46,0)
 ;---> For CONTRAINDICATIONS:
"RTN","BIUTL4",47,0)
 ;---> Actions to take in Screenman when Vaccine is selected.
"RTN","BIUTL4",48,0)
 ;---> Called by the POST ACTION of Field 2, Vaccine
"RTN","BIUTL4",49,0)
 ;---> of the Form BI FORM-CONTRAINDICATION ADD.
"RTN","BIUTL4",50,0)
 ;---> Parameters:
"RTN","BIUTL4",51,0)
 ;     1 - BIVAC (req) IEN of Vaccine in IMM File (9999999.14).
"RTN","BIUTL4",52,0)
 ;
"RTN","BIUTL4",53,0)
 ;---> If a vaccine has not been chosen, then disable the Reason field.
"RTN","BIUTL4",54,0)
 I '$G(BIVAC) D  Q
"RTN","BIUTL4",55,0)
 .D HLP^DDSUTL("You must first choose a vaccine."),HLP^DDSUTL("$$EOP")
"RTN","BIUTL4",56,0)
 .;---> Make Reason uneditable.
"RTN","BIUTL4",57,0)
 .D UNED^DDSUTL(4,,,1)
"RTN","BIUTL4",58,0)
 ;
"RTN","BIUTL4",59,0)
 ;---> Make Reason editable.
"RTN","BIUTL4",60,0)
 D UNED^DDSUTL(4,,,0)
"RTN","BIUTL4",61,0)
 ;---> Display Vaccine Short Name below Vaccine Name.
"RTN","BIUTL4",62,0)
 S BI("B")=BIVAC
"RTN","BIUTL4",63,0)
 D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(BIVAC)_")")
"RTN","BIUTL4",64,0)
 Q
"RTN","BIUTL4",65,0)
 ;
"RTN","BIUTL4",66,0)
 ;
"RTN","BIUTL4",67,0)
 ;----------
"RTN","BIUTL4",68,0)
VACCHG(BIVAC) ;EP
"RTN","BIUTL4",69,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",70,0)
 ;---> Actions to take in Screenman when the Vaccine is selected
"RTN","BIUTL4",71,0)
 ;---> or changed.
"RTN","BIUTL4",72,0)
 ;---> Called by the POST ACTION ON CHANGE of Field 2, Vaccine"
"RTN","BIUTL4",73,0)
 ;---> of the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",74,0)
 ;---> Parameters:
"RTN","BIUTL4",75,0)
 ;     1 - BIVAC  (req) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIUTL4",76,0)
 ;
"RTN","BIUTL4",77,0)
 Q:'$G(BIVAC)
"RTN","BIUTL4",78,0)
 ;
"RTN","BIUTL4",79,0)
 ;---> If this is NOT a new visit, inform user that Dose#, Lot#,
"RTN","BIUTL4",80,0)
 ;---> Reaction, and VIS will be deleted and replaced.
"RTN","BIUTL4",81,0)
 D:$G(BI("K"))
"RTN","BIUTL4",82,0)
 .N BIMSG
"RTN","BIUTL4",83,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTL4",84,0)
 .;---> Add NDC to reset fields when vaccine is changed.
"RTN","BIUTL4",85,0)
 .S BIMSG="* NOTE: Because you have changed the vaccine, Dose Override,"
"RTN","BIUTL4",86,0)
 .;S BIMSG=BIMSG_"Lot#, and any Reaction and VIS will be removed or replaced"
"RTN","BIUTL4",87,0)
 .S BIMSG=BIMSG_"Lot#, NDC, and any Reaction and VIS will be removed or replaced"
"RTN","BIUTL4",88,0)
 .S BIMSG=BIMSG_" with defaults for the new vaccine."
"RTN","BIUTL4",89,0)
 .D HLP^DDSUTL(BIMSG),HLP^DDSUTL("$$EOP")
"RTN","BIUTL4",90,0)
 ;
"RTN","BIUTL4",91,0)
 ;---> Clear data relating to previous Vaccine (if any).
"RTN","BIUTL4",92,0)
 D PUT^DDSVALF(3) S BI("D")=""    ;Lot# IEN
"RTN","BIUTL4",93,0)
 D PUT^DDSVALF(13) S BI("O")=""   ;Reaction
"RTN","BIUTL4",94,0)
 D PUT^DDSVALF(10) S BI("Q")=""   ;VIS
"RTN","BIUTL4",95,0)
 D PUT^DDSVALF(14) S BI("S")=""   ;Dose Override
"RTN","BIUTL4",96,0)
 D PUT^DDSVALF(5) S BI("W")=""    ;Volume
"RTN","BIUTL4",97,0)
 D PUT^DDSVALF(3.8) S BI("H")=""  ;NDC
"RTN","BIUTL4",98,0)
 ;**********
"RTN","BIUTL4",99,0)
 ;
"RTN","BIUTL4",100,0)
 ;---> If Category is Historical Event, do not stuff Lot# and VIS defaults.
"RTN","BIUTL4",101,0)
 Q:$G(BI("I"))="E"
"RTN","BIUTL4",102,0)
 ;
"RTN","BIUTL4",103,0)
 ;---> If this Vaccine has a Default ("Current") Lot#, then stuff it.
"RTN","BIUTL4",104,0)
 N BIX
"RTN","BIUTL4",105,0)
 I '$G(BI("D")) D
"RTN","BIUTL4",106,0)
 .S BIX=$$LOTDEF^BIUTL2(BIVAC)
"RTN","BIUTL4",107,0)
 .I BIX D PUT^DDSVALF(3,,,BIX,"I") S BI("D")=BIX
"RTN","BIUTL4",108,0)
 ;
"RTN","BIUTL4",109,0)
 D VISVOL(BIVAC)
"RTN","BIUTL4",110,0)
 Q
"RTN","BIUTL4",111,0)
 ;
"RTN","BIUTL4",112,0)
 ;
"RTN","BIUTL4",113,0)
 ;----------
"RTN","BIUTL4",114,0)
VISVOL(BIVAC) ;EP
"RTN","BIUTL4",115,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",116,0)
 ;---> Stuff VIS and Volume defaults for a Lot Number on
"RTN","BIUTL4",117,0)
 ;---> the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",118,0)
 ;---> Parameters:
"RTN","BIUTL4",119,0)
 ;     1 - BIVAC (req) IEN of Vaccine in IMM File (9999999.14).
"RTN","BIUTL4",120,0)
 ;
"RTN","BIUTL4",121,0)
 Q:'$G(BIVAC)
"RTN","BIUTL4",122,0)
 N BIX
"RTN","BIUTL4",123,0)
 ;---> If this Vaccine has a Default VIS, stuff it.
"RTN","BIUTL4",124,0)
 D:'$G(BI("Q"))
"RTN","BIUTL4",125,0)
 .S BIX=$$VISDEF^BIUTL2(BIVAC)
"RTN","BIUTL4",126,0)
 .I BIX D PUT^DDSVALF(10,,,BIX,"I") S BI("Q")=BIX
"RTN","BIUTL4",127,0)
 ;
"RTN","BIUTL4",128,0)
 ;---> If this is a new visit, stuff Volume Default.
"RTN","BIUTL4",129,0)
 D:'$G(BI("K"))
"RTN","BIUTL4",130,0)
 .N X S X=$$CODE^BIUTL2(BIVAC,5)
"RTN","BIUTL4",131,0)
 .Q:'X
"RTN","BIUTL4",132,0)
 .;---> For Influenza CVX 15, if patient is <36 mths change default=.25 ml.
"RTN","BIUTL4",133,0)
 .D:BIVAC=148
"RTN","BIUTL4",134,0)
 ..Q:'$G(BIDFN)  S:$$AGE^BIUTL1(BIDFN)<36 X=".25"
"RTN","BIUTL4",135,0)
 .;
"RTN","BIUTL4",136,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTL4",137,0)
 .;---> Add leading zero to default volume if less than 1.
"RTN","BIUTL4",138,0)
 .S:(X<1) X="0"_X
"RTN","BIUTL4",139,0)
 .;**********
"RTN","BIUTL4",140,0)
 .S BI("W")=X D PUT^DDSVALF(5,,,BI("W"),"I")
"RTN","BIUTL4",141,0)
 ;
"RTN","BIUTL4",142,0)
 Q
"RTN","BIUTL4",143,0)
 ;
"RTN","BIUTL4",144,0)
 ;
"RTN","BIUTL4",145,0)
 ;----------
"RTN","BIUTL4",146,0)
LOTDUP(BILIEN) ;EP
"RTN","BIUTL4",147,0)
 ;---> Return 1 if the Lot# has a duplicate in the IMMUNIZATION LOT
"RTN","BIUTL4",148,0)
 ;---> File; 0 if it is unique.
"RTN","BIUTL4",149,0)
 ;---> Parameters:
"RTN","BIUTL4",150,0)
 ;     1 - BILIEN  (req) IEN of Lot# in IMMUNIZATION LOT File.
"RTN","BIUTL4",151,0)
 ;
"RTN","BIUTL4",152,0)
 Q:'$G(BILIEN) 0
"RTN","BIUTL4",153,0)
 Q:'$D(^AUTTIML(BILIEN,0)) 0
"RTN","BIUTL4",154,0)
 ;
"RTN","BIUTL4",155,0)
 ;---> If Lot# is duplicated in the IMM LOT File, return 1.
"RTN","BIUTL4",156,0)
 N Y,Z S Y=$P(^AUTTIML(BILIEN,0),U) S Z=$O(^AUTTIML("B",Y,0))
"RTN","BIUTL4",157,0)
 Q:$O(^AUTTIML("B",Y,Z)) 1
"RTN","BIUTL4",158,0)
 ;---> Lot# is unique, return 0.
"RTN","BIUTL4",159,0)
 Q 0
"RTN","BIUTL4",160,0)
 ;
"RTN","BIUTL4",161,0)
 ;
"RTN","BIUTL4",162,0)
 ;----------
"RTN","BIUTL4",163,0)
LOTHELP(BILIEN) ;EP
"RTN","BIUTL4",164,0)
 ;ZEXCEPT:BI,DDSBR
"RTN","BIUTL4",165,0)
 ;---> If chosen Lot# is a duplicate, provide help message.
"RTN","BIUTL4",166,0)
 ;---> Parameters:
"RTN","BIUTL4",167,0)
 ;     1 - BILIEN  (req) IEN of Lot# in IMMUNIZATION LOT File.
"RTN","BIUTL4",168,0)
 N BIPOP,X
"RTN","BIUTL4",169,0)
 Q:'$$LOTDUP(BILIEN)
"RTN","BIUTL4",170,0)
 ;
"RTN","BIUTL4",171,0)
 D TITLE^BIUTL5("DUPLICATE LOT NUMBERS")
"RTN","BIUTL4",172,0)
 S X="--> Lot# "_$$LOTTX^BIUTL6(BILIEN)_" <--" D CENTERT^BIUTL5(.X)
"RTN","BIUTL4",173,0)
 W X,!
"RTN","BIUTL4",174,0)
 D
"RTN","BIUTL4",175,0)
 .I $$MAYMANAG^BIUTL11 D  Q
"RTN","BIUTL4",176,0)
 ..D TEXT2^BIUTL6,DIRZ^BIUTL3(.BIPOP)
"RTN","BIUTL4",177,0)
 ..Q:$G(BIPOP)
"RTN","BIUTL4",178,0)
 ..D TITLE^BIUTL5("DUPLICATE LOT NUMBERS"),TEXT3^BIUTL6
"RTN","BIUTL4",179,0)
 .D TEXT1^BIUTL6
"RTN","BIUTL4",180,0)
 D:'$G(BIPOP) DIRZ^BIUTL3()
"RTN","BIUTL4",181,0)
 D REFRESH^DDSUTL
"RTN","BIUTL4",182,0)
 S BI("D")="",DDSBR=3 D PUT^DDSVALF(3)
"RTN","BIUTL4",183,0)
 Q
"RTN","BIUTL4",184,0)
 ;
"RTN","BIUTL4",185,0)
 ;
"RTN","BIUTL4",186,0)
 ;----------
"RTN","BIUTL4",187,0)
LOTSCR ;EP
"RTN","BIUTL4",188,0)
 ;ZEXCEPT:BI,DIR,Y
"RTN","BIUTL4",189,0)
 ;---> Set Screen for Lot Number selection in Screen field of
"RTN","BIUTL4",190,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL4",191,0)
 ;---> when selecting Lot Number.
"RTN","BIUTL4",192,0)
 ;---> Screen: If this Lot Number is Active, AND if no Vaccine has been selected OR
"RTN","BIUTL4",193,0)
 ;--->         this Lot Number is assigned to the selected Vaccine,
"RTN","BIUTL4",194,0)
 ;--->         AND if EITHER [it has no specific Location] OR
"RTN","BIUTL4",195,0)
 ;--->         [its Location matches the user's Location (DUZ(2))].
"RTN","BIUTL4",196,0)
 ;
"RTN","BIUTL4",197,0)
 N BILOC S BILOC=$P($G(^AUTTIML(+Y,0)),U,14)
"RTN","BIUTL4",198,0)
 ;
"RTN","BIUTL4",199,0)
 ;---> Next line: Concat to avoid suspected naked ref.
"RTN","BIUTL4",200,0)
 S DIR("S")="I $P(^"_"(0),U,3)=0,($G(BI(""B""))=""""!$D(^AUTTIML(""C"",+$G(BI(""B"")),Y)))"
"RTN","BIUTL4",201,0)
 S DIR("S")=DIR("S")_",(('$P($G(^AUTTIML(Y,0)),U,14))!($P($G(^AUTTIML(Y,0)),U,14)=$G(DUZ(2))))"
"RTN","BIUTL4",202,0)
 Q
"RTN","BIUTL4",203,0)
 ;
"RTN","BIUTL4",204,0)
 ;
"RTN","BIUTL4",205,0)
 ;----------
"RTN","BIUTL4",206,0)
LOTSEL(BIX) ;EP
"RTN","BIUTL4",207,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",208,0)
 ;---> Action to take after Lot Number has been selected.
"RTN","BIUTL4",209,0)
 ;---> Parameters:
"RTN","BIUTL4",210,0)
 ;     1 - BIX (req) X=Internal Value of Lot Number selected.
"RTN","BIUTL4",211,0)
 ;
"RTN","BIUTL4",212,0)
 ;---> Executed from the "POST ACTION ON CHANGE" field of the
"RTN","BIUTL4",213,0)
 ;---> "Form ONly Field Properties" of the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",214,0)
 ;
"RTN","BIUTL4",215,0)
 ;---> Action: If a Vaccine was not chosen, but instead a Lot Number was entered first,
"RTN","BIUTL4",216,0)
 ;---> then populate the Vaccine field on the form (which triggers VACCHG above).
"RTN","BIUTL4",217,0)
 ;
"RTN","BIUTL4",218,0)
 Q:'BIX
"RTN","BIUTL4",219,0)
 ;
"RTN","BIUTL4",220,0)
 D
"RTN","BIUTL4",221,0)
 .;---> Don't change the Vaccine if it has already been selected.
"RTN","BIUTL4",222,0)
 .Q:(+$G(BI("B")))
"RTN","BIUTL4",223,0)
 .;---> Stuff Vaccine IEN for this Lot Number.
"RTN","BIUTL4",224,0)
 .N BIVAC S BIVAC=$$LOTTX^BIUTL6(BIX,1)
"RTN","BIUTL4",225,0)
 .D PUT^DDSVALF(2,,,BIVAC,"I")
"RTN","BIUTL4",226,0)
 .D VACSEL(BIVAC)
"RTN","BIUTL4",227,0)
 .D LOTWARN^BIUTL7($G(BI("D")),$G(BI("E")),$G(BI("F")))
"RTN","BIUTL4",228,0)
 .D VISVOL(BIVAC)
"RTN","BIUTL4",229,0)
 ;
"RTN","BIUTL4",230,0)
 D
"RTN","BIUTL4",231,0)
 .;---> Stuff default NDC IEN for this Lot Number.
"RTN","BIUTL4",232,0)
 .Q:(+$G(BI("H")))
"RTN","BIUTL4",233,0)
 .N BINDC S BINDC=$$LOTTX^BIUTL6(BIX,3)
"RTN","BIUTL4",234,0)
 .I BINDC D PUT^DDSVALF(3.8,,,BINDC,"I")
"RTN","BIUTL4",235,0)
 ;
"RTN","BIUTL4",236,0)
 Q
"RTN","BIUTL4",237,0)
 ;
"RTN","BIUTL4",238,0)
 ;
"RTN","BIUTL4",239,0)
 ;----------
"RTN","BIUTL4",240,0)
NDCSCR ;EP
"RTN","BIUTL4",241,0)
 ;ZEXCEPT:BI,DIR
"RTN","BIUTL4",242,0)
 ;---> Set Screen for NDC Code selection in Screen field of
"RTN","BIUTL4",243,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL4",244,0)
 ;---> when selecting NDC Code.
"RTN","BIUTL4",245,0)
 ;---> Screen: If this NDC is Active, AND this NDC is assigned to the selected
"RTN","BIUTL4",246,0)
 ;---> vaccine in BI("B").
"RTN","BIUTL4",247,0)
 ;
"RTN","BIUTL4",248,0)
 ;W !!,"This screen in NDCSCR^BIUTL4",! X ^O
"RTN","BIUTL4",249,0)
 S DIR("S")="I $P(^BINDC(Y,0),U,6)'=1,$D(^BINDC(""C"",+$G(BI(""B"")),Y))"
"RTN","BIUTL4",250,0)
 Q
"RTN","BIUTL4",251,0)
 ;
"RTN","BIUTL4",252,0)
 ;
"RTN","BIUTL4",253,0)
 ;----------
"RTN","BIUTL4",254,0)
CREASCR() ;EP
"RTN","BIUTL4",255,0)
 ;ZEXCEPT:BI,Y
"RTN","BIUTL4",256,0)
 ;---> Set Screen for Contraindication Reason selection in Reason field
"RTN","BIUTL4",257,0)
 ;---> VEN/SMH - All of this is changed now. We now will point to 920.4 for
"RTN","BIUTL4",258,0)
 ;--->           both VISTA and RPMS.
"RTN","BIUTL4",259,0)
 ;--->           Rather than setting DIC("S") here, we will become DIC("S"),
"RTN","BIUTL4",260,0)
 ;--->           such that the form will S DIR("S")="I $$CREASCR^BIUTL4()"
"RTN","BIUTL4",261,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-CONTRAINDICATION ADD.
"RTN","BIUTL4",262,0)
 ;---> Screen: If this Reason is Active AND if this Reason is Skin Test
"RTN","BIUTL4",263,0)
 ;--->         related AND this Vaccine is a Skin Test.
"RTN","BIUTL4",264,0)
 ;
"RTN","BIUTL4",265,0)
 ; OLD RPMS CODE
"RTN","BIUTL4",266,0)
 ;---> If no vaccine chosen, then screen says all reasons are invalid.
"RTN","BIUTL4",267,0)
 ; I '$G(BI("B")) S DIR("S")="I 0" Q
"RTN","BIUTL4",268,0)
 ;
"RTN","BIUTL4",269,0)
 ; S DIR("S")="I ($P(^BICONT(Y,0),U,3))&(+$P(^BICONT(Y,0),U,4)"
"RTN","BIUTL4",270,0)
 ; S DIR("S")=DIR("S")_"=+$P(^AUTTIMM(BI(""B""),0),U,8))"
"RTN","BIUTL4",271,0)
 ;
"RTN","BIUTL4",272,0)
 ;---> If no vaccine chosen, then screen says all reasons are invalid.
"RTN","BIUTL4",273,0)
 I '$G(BI("B")) Q 0
"RTN","BIUTL4",274,0)
 ;
"RTN","BIUTL4",275,0)
 ;---> if not active, quit
"RTN","BIUTL4",276,0)
 I $$GET1^DIQ(920.4,Y,"INACTIVE") Q 0
"RTN","BIUTL4",277,0)
 ;
"RTN","BIUTL4",278,0)
 ;---> Vaccine must be associated with this contraindication
"RTN","BIUTL4",279,0)
 I '$DATA(^PXV(920.4,"D",BI("B"),Y)) QUIT 0
"RTN","BIUTL4",280,0)
 ;
"RTN","BIUTL4",281,0)
 QUIT 1
"RTN","BIUTL4",282,0)
 ;
"RTN","BIUTL4",283,0)
 Q
"RTN","BIUTL4",284,0)
 ;
"RTN","BIUTL4",285,0)
 ;
"RTN","BIUTL4",286,0)
 ;----------
"RTN","BIUTL4",287,0)
HISTORY(X) ;EP
"RTN","BIUTL4",288,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",289,0)
 ;---> Add/Edit Screenman actions to take ON POST-CHANGE of Category Field.
"RTN","BIUTL4",290,0)
 ;---> Parameters:
"RTN","BIUTL4",291,0)
 ;     1 - X (opt) X=Internal Value of Category Field ("E"=Historical Event).
"RTN","BIUTL4",292,0)
 ;
"RTN","BIUTL4",293,0)
 ;---> If this is an Historical Event, then set Lot#="" and not required.
"RTN","BIUTL4",294,0)
 I X="E" D
"RTN","BIUTL4",295,0)
 .S BI("D")=""
"RTN","BIUTL4",296,0)
 .D PUT^DDSVALF(3,"","",""),REQ^DDSUTL(3,"","",0)
"RTN","BIUTL4",297,0)
 .D PUT^DDSVALF(9,,,) S BI("R")=""
"RTN","BIUTL4",298,0)
 Q
"RTN","BIUTL4",299,0)
 ;
"RTN","BIUTL4",300,0)
 ;
"RTN","BIUTL4",301,0)
 ;----------
"RTN","BIUTL4",302,0)
OLDDATE(X) ;EP
"RTN","BIUTL4",303,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",304,0)
 ;---> Add/Edit Screenman actions to take ON POST-CHANGE of Date Field.
"RTN","BIUTL4",305,0)
 ;---> If date entered is earlier than today, Category default changes to
"RTN","BIUTL4",306,0)
 ;---> Historical.  If the date is more than 5 days earlier than today,
"RTN","BIUTL4",307,0)
 ;---> user as default Provider is removed.
"RTN","BIUTL4",308,0)
 ;---> Parameters:
"RTN","BIUTL4",309,0)
 ;     1 - X (opt) X=Internal Value of Date of Visit entered.
"RTN","BIUTL4",310,0)
 ;
"RTN","BIUTL4",311,0)
 ;
"RTN","BIUTL4",312,0)
 N BIDATEE S BIDATEE=X
"RTN","BIUTL4",313,0)
 ;
"RTN","BIUTL4",314,0)
 I '$G(BI("K"))&($P(X,".")'=DT) D
"RTN","BIUTL4",315,0)
 .D PUT^DDSVALF(11,,,"E","I") S BI("I")="E"
"RTN","BIUTL4",316,0)
 .I ($G(DT)-X)>5 D NOPROV^BIUTL7("E")
"RTN","BIUTL4",317,0)
 ;
"RTN","BIUTL4",318,0)
 I $G(BIVTYPE)="I" D PUT^DDSVALF(10.2,,,BIDATEE,"E") S BI("QQ")=BIDATEE
"RTN","BIUTL4",319,0)
 QUIT
"RTN","BIUTL4",320,0)
 ;**********
"RTN","BIUTL4",321,0)
 ;
"RTN","BIUTL4",322,0)
 ;
"RTN","BIUTL4",323,0)
 ;----------
"RTN","BIUTL4",324,0)
SKINCHG(BISKIEN) ;EP
"RTN","BIUTL4",325,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",326,0)
 ;---> Actions to take in Screenman when the Skin Test is selected
"RTN","BIUTL4",327,0)
 ;---> or changed.
"RTN","BIUTL4",328,0)
 ;---> Called by the POST ACTION ON CHANGE of Field 2, Skin Test"
"RTN","BIUTL4",329,0)
 ;---> of the Form BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL4",330,0)
 ;---> Parameters:
"RTN","BIUTL4",331,0)
 ;     1 - BISKIEN  (opt) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIUTL4",332,0)
 ;                        (Not used for now.)
"RTN","BIUTL4",333,0)
 Q:'$G(BISKIEN)
"RTN","BIUTL4",334,0)
 ;
"RTN","BIUTL4",335,0)
 ;---> If this is NOT a new visit, inform user that Dose#, Lot#,
"RTN","BIUTL4",336,0)
 ;---> Reaction, and VIS will be deleted and replaced.
"RTN","BIUTL4",337,0)
 D:$G(BI("K"))
"RTN","BIUTL4",338,0)
 .N BIMSG
"RTN","BIUTL4",339,0)
 .S BIMSG="* NOTE: Because you have changed the Skin Test, the Result,"
"RTN","BIUTL4",340,0)
 .S BIMSG=BIMSG_" Reading, Date of Reading, and Reader will be removed."
"RTN","BIUTL4",341,0)
 .D HLP^DDSUTL(BIMSG),HLP^DDSUTL("$$EOP")
"RTN","BIUTL4",342,0)
 ;
"RTN","BIUTL4",343,0)
 ;---> Clear data relating to previous Skin Test (if any).
"RTN","BIUTL4",344,0)
 D PUT^DDSVALF(3) S BI("L")=""   ;Result
"RTN","BIUTL4",345,0)
 D PUT^DDSVALF(4) S BI("M")=""   ;Reading
"RTN","BIUTL4",346,0)
 D PUT^DDSVALF(5) S BI("N")=""   ;Date of Reading
"RTN","BIUTL4",347,0)
 D PUT^DDSVALF(10) S BI("X")=""  ;Reader
"RTN","BIUTL4",348,0)
 Q
"RTN","BIUTL4",349,0)
 ;
"RTN","BIUTL4",350,0)
 ;
"RTN","BIUTL4",351,0)
 ;----------
"RTN","BIUTL4",352,0)
SERVAL(BIDOSE,BIVAC) ;EP
"RTN","BIUTL4",353,0)
 ; ZEXCEPT: DDSERROR
"RTN","BIUTL4",354,0)
 ;---> Validate Dose# for this Immunization Visit.
"RTN","BIUTL4",355,0)
 ;---> Parameters:
"RTN","BIUTL4",356,0)
 ;     1 - BIDOSE (req) Dose# entered by the user.
"RTN","BIUTL4",357,0)
 ;     2 - BIVAC  (req) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIUTL4",358,0)
 ;
"RTN","BIUTL4",359,0)
 Q:'BIDOSE  Q:'BIVAC
"RTN","BIUTL4",360,0)
 N BIMAX S BIMAX=$$VMAX^BIUTL2(BIVAC)
"RTN","BIUTL4",361,0)
 ;
"RTN","BIUTL4",362,0)
 ;---> If Dose# entered is greater than Max Dose# for this Vaccine,
"RTN","BIUTL4",363,0)
 ;---> reject value and display help text.
"RTN","BIUTL4",364,0)
 I BIDOSE>BIMAX S DDSERROR=1 D
"RTN","BIUTL4",365,0)
 .N Z
"RTN","BIUTL4",366,0)
 .S Z="The Maximum Dose# for "_$$VNAME^BIUTL2(BIVAC)_" is "_BIMAX
"RTN","BIUTL4",367,0)
 .S Z=Z_".  Please enter a number between 1 and "_BIMAX_"."
"RTN","BIUTL4",368,0)
 .D HLP^DDSUTL(Z)
"RTN","BIUTL4",369,0)
 Q
"RTN","BIUTL4",370,0)
 ;
"RTN","BIUTL4",371,0)
 ;
"RTN","BIUTL4",372,0)
 ;----------
"RTN","BIUTL4",373,0)
INACTV(X) ;EP
"RTN","BIUTL4",374,0)
 ;ZEXCEPT:BI
"RTN","BIUTL4",375,0)
 ;---> Called by the POST ACTION of Field 4, "Inactive Date"
"RTN","BIUTL4",376,0)
 ;---> of the Form BI FORM-CASE DATA EDIT.
"RTN","BIUTL4",377,0)
 ;---> Actions to take in Screenman when Patient is made Inactive
"RTN","BIUTL4",378,0)
 ;---> by adding a date to Field 4, Inactive Date, of the Form.
"RTN","BIUTL4",379,0)
 ;---> Parameters:
"RTN","BIUTL4",380,0)
 ;     1 - X (req) Internal value of the date entered.
"RTN","BIUTL4",381,0)
 ;
"RTN","BIUTL4",382,0)
 ;---> If no Inactive Date entered, set Reason="" and "Moved to"=""
"RTN","BIUTL4",383,0)
 ;---> and disable navigation to and editing of the fields.
"RTN","BIUTL4",384,0)
 I '$G(X) D  Q
"RTN","BIUTL4",385,0)
 .D PUT^DDSVALF(5),PUT^DDSVALF(5.5)
"RTN","BIUTL4",386,0)
 .D UNED^DDSUTL(5,,,1),UNED^DDSUTL(5.5,,,1)
"RTN","BIUTL4",387,0)
 .S (BI("F"),BI("I"))="@"
"RTN","BIUTL4",388,0)
 ;---> A date has been entered, so enable edit and navigation.
"RTN","BIUTL4",389,0)
 D UNED^DDSUTL(5,,,0),UNED^DDSUTL(5.5,,,0)
"RTN","BIUTL4",390,0)
 Q
"RTN","BIUTL4",391,0)
 ;
"RTN","BIUTL4",392,0)
 ;
"RTN","BIUTL4",393,0)
 ;----------
"RTN","BIUTL4",394,0)
LOCBR ;EP
"RTN","BIUTL4",395,0)
 ;ZEXCEPT:BI,X,DDSOLD
"RTN","BIUTL4",396,0)
 ;---> Location Type branching logic for Add/Edit Imm Visit Form:
"RTN","BIUTL4",397,0)
 ;---> "Location" field.
"RTN","BIUTL4",398,0)
 ;
"RTN","BIUTL4",399,0)
 ;---> If Location Type is "Other":
"RTN","BIUTL4",400,0)
 I (X="O")&($G(DDSOLD)'="O") D
"RTN","BIUTL4",401,0)
 .;
"RTN","BIUTL4",402,0)
 .;---> Disable IHS Loc (7) and put a null value in IHS Loc (7).
"RTN","BIUTL4",403,0)
 .D UNED^DDSUTL(7,,,1),PUT^DDSVALF(7)
"RTN","BIUTL4",404,0)
 .;
"RTN","BIUTL4",405,0)
 .;---> Set IHS Location IEN in BI array =null (ADD+18^BIVISIT).
"RTN","BIUTL4",406,0)
 .S BI("F")=""
"RTN","BIUTL4",407,0)
 .;
"RTN","BIUTL4",408,0)
 .;---> Enable Other Loc (8).
"RTN","BIUTL4",409,0)
 .D UNED^DDSUTL(8,,,0)
"RTN","BIUTL4",410,0)
 .;
"RTN","BIUTL4",411,0)
 .;---> Make Other Loc required, and IHS Loc not required.
"RTN","BIUTL4",412,0)
 .D REQ^DDSUTL(8,,,1),REQ^DDSUTL(7,,,0)
"RTN","BIUTL4",413,0)
 ;
"RTN","BIUTL4",414,0)
 ;
"RTN","BIUTL4",415,0)
 ;---> If Location Type is "IHS":
"RTN","BIUTL4",416,0)
 I (X="I")&($G(DDSOLD)'="I") D
"RTN","BIUTL4",417,0)
 .;
"RTN","BIUTL4",418,0)
 .;---> Disable Other Loc (8) and put a null value in Other Loc (8).
"RTN","BIUTL4",419,0)
 .D UNED^DDSUTL(8,,,1),PUT^DDSVALF(8)
"RTN","BIUTL4",420,0)
 .;
"RTN","BIUTL4",421,0)
 .;---> Set Outside Location text in BI array =null (ADD+19^BIVISIT).
"RTN","BIUTL4",422,0)
 .S BI("G")=""
"RTN","BIUTL4",423,0)
 .;
"RTN","BIUTL4",424,0)
 .;---> Enable IHS Loc (7).
"RTN","BIUTL4",425,0)
 .D UNED^DDSUTL(7,,,0)
"RTN","BIUTL4",426,0)
 .;
"RTN","BIUTL4",427,0)
 .;---> Make IHS Loc required, and Other Loc not required.
"RTN","BIUTL4",428,0)
 .D REQ^DDSUTL(7,,,1),REQ^DDSUTL(8,,,0),DEFSITE
"RTN","BIUTL4",429,0)
 Q
"RTN","BIUTL4",430,0)
 ;
"RTN","BIUTL4",431,0)
 ;
"RTN","BIUTL4",432,0)
 ;----------
"RTN","BIUTL4",433,0)
VISDATE ;EP
"RTN","BIUTL4",434,0)
 ;ZEXCEPT:BI,X
"RTN","BIUTL4",435,0)
 ;---> Enable/disable and if necessary clear VIS Date, based on
"RTN","BIUTL4",436,0)
 ;---> YES/NO answer of VIS Given question.
"RTN","BIUTL4",437,0)
 ;
"RTN","BIUTL4",438,0)
 ;---> If VIS Given=YES (1), then enable editing of VIS Date.
"RTN","BIUTL4",439,0)
 I X=1 D  Q
"RTN","BIUTL4",440,0)
 .D UNED^DDSUTL(13,,,0)
"RTN","BIUTL4",441,0)
 .;---> If no VIS Date present, get default from IMMUNIZATION File.
"RTN","BIUTL4",442,0)
 .Q:$$GET^DDSVALF(13)
"RTN","BIUTL4",443,0)
 .N BIY S BIY=$$GET^DDSVALF(2)
"RTN","BIUTL4",444,0)
 .D PUT^DDSVALF(13,,,$$VISDEF^BIUTL2(BIY))
"RTN","BIUTL4",445,0)
 ;
"RTN","BIUTL4",446,0)
 ;---> Otherwise, stuff null in VIS Date and make it uneditable.
"RTN","BIUTL4",447,0)
 D PUT^DDSVALF(13) S BI("Q")=""
"RTN","BIUTL4",448,0)
 D UNED^DDSUTL(13,,,1)
"RTN","BIUTL4",449,0)
 Q
"RTN","BIUTL4",450,0)
 ;
"RTN","BIUTL4",451,0)
 ;
"RTN","BIUTL4",452,0)
 ;----------
"RTN","BIUTL4",453,0)
DEFSITE ;EP
"RTN","BIUTL4",454,0)
 ;---> Code to stuff default Location of Visit in Add/Edit Imm Visit
"RTN","BIUTL4",455,0)
 ;---> form.  If Location Type is IHS and current value is null,
"RTN","BIUTL4",456,0)
 ;---> stuff user's DUZ(2) as default.
"RTN","BIUTL4",457,0)
 ;
"RTN","BIUTL4",458,0)
 Q:$$GET^DDSVALF(6)'="I"
"RTN","BIUTL4",459,0)
 Q:$$GET^DDSVALF(7)]""
"RTN","BIUTL4",460,0)
 D PUT^DDSVALF(7,"","",DUZ(2),"I")
"RTN","BIUTL4",461,0)
 Q
"RTN","BIUTL4",462,0)
 ;
"RTN","BIUTL4",463,0)
 ;
"RTN","BIUTL4",464,0)
 ;----------
"RTN","BIUTL4",465,0)
BADREAD ;EP
"RTN","BIUTL4",466,0)
 ;ZEXCEPT:DDSERROR
"RTN","BIUTL4",467,0)
 ;---> Code to check Skin Test results: If the result is Negative,
"RTN","BIUTL4",468,0)
 ;---> the Reading must be less than 15 millimeters; in that case,
"RTN","BIUTL4",469,0)
 ;---> display help message and reject value.
"RTN","BIUTL4",470,0)
 ;
"RTN","BIUTL4",471,0)
 N X
"RTN","BIUTL4",472,0)
 S X="If the result is NEGATIVE, the Reading must be less than 15 millimeters."
"RTN","BIUTL4",473,0)
 D HLP^DDSUTL(X)
"RTN","BIUTL4",474,0)
 S DDSERROR=""
"RTN","BIUTL4",475,0)
 Q
"RTN","BIUTL4",476,0)
 ;
"RTN","BIUTL4",477,0)
 ;
"RTN","BIUTL4",478,0)
 ;----------
"RTN","BIUTL4",479,0)
BADRDAT ;EP
"RTN","BIUTL4",480,0)
 ;ZEXCEPT:DDSERROR,Y
"RTN","BIUTL4",481,0)
 ;---> If the Read Date is earlier than the initial visit date or later
"RTN","BIUTL4",482,0)
 ;---> than today, advise and return to Read Date field.
"RTN","BIUTL4",483,0)
 ;
"RTN","BIUTL4",484,0)
 I Y<$$GET^DDSVALF(1) S DDSERROR="" D  Q
"RTN","BIUTL4",485,0)
 .D HLP^DDSUTL(" * Date of Reading may not be prior to date of initial visit.")
"RTN","BIUTL4",486,0)
 I Y>DT S DDSERROR="" D  Q
"RTN","BIUTL4",487,0)
 .D HLP^DDSUTL(" * Date of Reading may not be later than today.")
"RTN","BIUTL4",488,0)
 Q
"RTN","BIUTL4",489,0)
 ;
"RTN","BIUTL4",490,0)
 ; VEN/SMH - HAND EDIT IMMUN CONTRAINDICATIONS (920.4) file
"RTN","BIUTL4",491,0)
 ; NB: This is just one time use code. No need to run again.
"RTN","BIUTL4",492,0)
 ; This is written to port the VISTA CI data from VISTA to RPMS.
"RTN","BIUTL4",493,0)
 ; Kept here for reference.
"RTN","BIUTL4",494,0)
KILLALL ; [Private] Delete all entries
"RTN","BIUTL4",495,0)
 N I F I=0:0 S I=$O(^PXV(920.4,I)) Q:'I  D
"RTN","BIUTL4",496,0)
 . N J F J=0:0 S J=$O(^PXV(920.4,I,3,J)) Q:'J  D
"RTN","BIUTL4",497,0)
 .. N DA,DIK S DA(1)=I,DA=J,DIK=$$OREF^DILF($NA(^PXV(920.4,I,3))) D ^DIK
"RTN","BIUTL4",498,0)
 QUIT
"RTN","BIUTL4",499,0)
 ;
"RTN","BIUTL4",500,0)
EDIT2 ; [Private] Get entries from VISTA and file them.
"RTN","BIUTL4",501,0)
 ; ZEXCEPT: AUTTIMM,PXV
"RTN","BIUTL4",502,0)
 N FDA,DIERR
"RTN","BIUTL4",503,0)
 N CNT S CNT=0
"RTN","BIUTL4",504,0)
 N VISTA S VISTA="/var/local/foia201502/mumps.gld"
"RTN","BIUTL4",505,0)
 N VGLOCI S VGLOCI=$NA(^|VISTA|PXV(920.4)) ; exteneded ref to VISTA
"RTN","BIUTL4",506,0)
 N VGLOIMM S VGLOIMM=$NA(^|VISTA|AUTTIMM)  ; ditto
"RTN","BIUTL4",507,0)
 N BII F BII=0:0 S BII=$O(^PXV(920.4,BII)) Q:'BII  D
"RTN","BIUTL4",508,0)
 . W $P(^PXV(920.4,BII,0),U),!
"RTN","BIUTL4",509,0)
 . N BIJ F BIJ=0:0 S BIJ=$O(@VGLOCI@(BII,3,BIJ)) Q:'BIJ  D
"RTN","BIUTL4",510,0)
 .. S CNT=CNT+1
"RTN","BIUTL4",511,0)
 .. N IMM S IMM=$P(@VGLOCI@(BII,3,BIJ,0),U)
"RTN","BIUTL4",512,0)
 .. N VIMM S VIMM=$P(@VGLOIMM@(IMM,0),U)
"RTN","BIUTL4",513,0)
 .. N CVX S CVX=$P(@VGLOIMM@(IMM,0),U,3)
"RTN","BIUTL4",514,0)
 .. ; W ?3,VIMM,?40,CVX,!
"RTN","BIUTL4",515,0)
 .. N RPMSIEN S RPMSIEN=$$FIND1^DIC(9999999.14,,"QX",+CVX,"C")
"RTN","BIUTL4",516,0)
 .. W ?3,CVX," ",$$GET1^DIQ(9999999.14,RPMSIEN,.01),!
"RTN","BIUTL4",517,0)
 .. N C S C=","
"RTN","BIUTL4",518,0)
 .. N P S P="+"
"RTN","BIUTL4",519,0)
 .. S FDA(920.43,P_CNT_C_BII_C,.01)=RPMSIEN
"RTN","BIUTL4",520,0)
 .. ; N DIE,DR,DA S DIE=$$OREF^DILF($NA(^PXV(920.4))),DR="3//CVX",DA=BII D ^DIE
"RTN","BIUTL4",521,0)
 ;
"RTN","BIUTL4",522,0)
 D UPDATE^DIE(,$NA(FDA))
"RTN","BIUTL4",523,0)
 ;i $d(DIERR) break
"RTN","BIUTL4",524,0)
 QUIT
"RTN","BIUTL5")
0^154^B31996793
"RTN","BIUTL5",1,0)
BIUTL5 ;IHS/CMI/MWR - UTIL: MENU TITLS, DATE FORMAT; MAY 10, 2010
"RTN","BIUTL5",2,0)
 ;;8.5;IMMUNIZATION;**8**;MAR 15,2014;Build 2
"RTN","BIUTL5",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL5",4,0)
 ;;  UTILITY: SETVARS, MENUT, TITLE, CENTERT, COPYLET,
"RTN","BIUTL5",5,0)
 ;;           UPPERCASE XREFS, DATE FORMATS, PADS/SPACES.
"RTN","BIUTL5",6,0)
 ;;  PATCH 4: Call to add a leading zero left of the decimal point. LEADZ+0
"RTN","BIUTL5",7,0)
 ;;  PATCH 5: Ensure that only one leading zero is displayed. LEADZ+8
"RTN","BIUTL5",8,0)
 ;;  PATCH 7: Changes to accommodate new TCH Forecaster. TCHFMDT+0, FMTCHDT+0
"RTN","BIUTL5",9,0)
 ;;  PATCH 8: New date format linelabels for TCH Forecaster.  IMMSDT+9
"RTN","BIUTL5",10,0)
 ;
"RTN","BIUTL5",11,0)
 ;
"RTN","BIUTL5",12,0)
 ;----------
"RTN","BIUTL5",13,0)
SETVARS ;EP
"RTN","BIUTL5",14,0)
 ; ZEXCEPT: IOF
"RTN","BIUTL5",15,0)
 ;---> Set standard variables.
"RTN","BIUTL5",16,0)
 I $T(^XBKVAR)]"" D ^XBKVAR
"RTN","BIUTL5",17,0)
 S:'$D(IOF) IOF="#"
"RTN","BIUTL5",18,0)
 Q
"RTN","BIUTL5",19,0)
 ;
"RTN","BIUTL5",20,0)
 ;
"RTN","BIUTL5",21,0)
 ;----------
"RTN","BIUTL5",22,0)
MENUT(TITLE) ;EP
"RTN","BIUTL5",23,0)
 ; ZEXCEPT:ITTAB,IOF
"RTN","BIUTL5",24,0)
 ;---> Display menu title from BI Menu options.
"RTN","BIUTL5",25,0)
 ;---> REQUIRED VARIABLES: TITLE=TEXT TO BE CENTERED AND DISPLAYED.
"RTN","BIUTL5",26,0)
 ;--->                     DUZ(2)=CURRENT LOCATION TO BE DISPLAYED.
"RTN","BIUTL5",27,0)
 N BITTAB,BIFAC,BIUNL,I
"RTN","BIUTL5",28,0)
 S:'$D(TITLE) TITLE="* NO TITLE SUPPLIED *"
"RTN","BIUTL5",29,0)
 S TITLE="*  "_TITLE_"  *"
"RTN","BIUTL5",30,0)
 S BITTAB=39-($L(TITLE)/2)
"RTN","BIUTL5",31,0)
 W:$D(IOF) @IOF
"RTN","BIUTL5",32,0)
 W !?3,"IMMUNIZATION v"_$$VER^BILOGO
"RTN","BIUTL5",33,0)
 W ?BITTAB,TITLE
"RTN","BIUTL5",34,0)
 W ?53,"Site: ",$E($$INSTTX^BIUTL6(DUZ(2)),1,20)
"RTN","BIUTL5",35,0)
 S BIUNL="" F I=1:1:$L(TITLE) S BIUNL=BIUNL_"="
"RTN","BIUTL5",36,0)
 S BIUNL=$$SP(BITTAB)_BIUNL
"RTN","BIUTL5",37,0)
 S BIUNL=$$PAD(.BIUNL,53)_"User: "_$E($$PERSON^BIUTL1($G(DUZ)),1,20)
"RTN","BIUTL5",38,0)
 W !,BIUNL
"RTN","BIUTL5",39,0)
 Q
"RTN","BIUTL5",40,0)
 ;
"RTN","BIUTL5",41,0)
 ;
"RTN","BIUTL5",42,0)
 ;----------
"RTN","BIUTL5",43,0)
TITLE(BITL,BIONE) ;EP
"RTN","BIUTL5",44,0)
 ; ZEXCEPT: IOF
"RTN","BIUTL5",45,0)
 ;---> Clear screen and display BITL (Immunization_version# prepended).
"RTN","BIUTL5",46,0)
 ;---> Parameters:
"RTN","BIUTL5",47,0)
 ;     1 - BITL  (req) Text to be centered and displayed.
"RTN","BIUTL5",48,0)
 ;     2 - BIONE (opt) If BIONE=1 then return only ONE linefeed after title.
"RTN","BIUTL5",49,0)
 ;
"RTN","BIUTL5",50,0)
 S:'$D(BITL) BITL="NO BITL SUPPLIED"
"RTN","BIUTL5",51,0)
 S BITL="*  "_BITL_"  *" D CENTERT(.BITL)
"RTN","BIUTL5",52,0)
 W:$D(IOF) @IOF
"RTN","BIUTL5",53,0)
 W " "_$$LMVER^BILOGO,!,BITL,!
"RTN","BIUTL5",54,0)
 W:'$G(BIONE) !
"RTN","BIUTL5",55,0)
 Q
"RTN","BIUTL5",56,0)
 ;
"RTN","BIUTL5",57,0)
 ;
"RTN","BIUTL5",58,0)
 ;----------
"RTN","BIUTL5",59,0)
CENTERT(TEXT,X) ;EP
"RTN","BIUTL5",60,0)
 ;---> Pad TEXT with leading spaces to center in 80 columns.
"RTN","BIUTL5",61,0)
 ;---> Parameters:
"RTN","BIUTL5",62,0)
 ;     1 - TEXT (req) Text to be centered.
"RTN","BIUTL5",63,0)
 ;     2 - X    (opt) Columns to adjust to the right.
"RTN","BIUTL5",64,0)
 ;
"RTN","BIUTL5",65,0)
 S:$G(TEXT)="" TEXT="* NO TEXT SUPPLIED *"
"RTN","BIUTL5",66,0)
 S:'$G(X) X=39
"RTN","BIUTL5",67,0)
 N I
"RTN","BIUTL5",68,0)
 F I=1:1:(X-($L(TEXT)/2)) S TEXT=" "_TEXT
"RTN","BIUTL5",69,0)
 Q
"RTN","BIUTL5",70,0)
 ;
"RTN","BIUTL5",71,0)
 ;
"RTN","BIUTL5",72,0)
 ;----------
"RTN","BIUTL5",73,0)
UPPER(X,L) ;EP
"RTN","BIUTL5",74,0)
 ;---> Translate X to all uppercase.
"RTN","BIUTL5",75,0)
 ;---> Parameters:
"RTN","BIUTL5",76,0)
 ;     1 - X  (req) Value to be translated into all uppercase.
"RTN","BIUTL5",77,0)
 ;     2 - L  (opt) If L=1, translate to all lowercase.
"RTN","BIUTL5",78,0)
 ;
"RTN","BIUTL5",79,0)
 I $G(L) S X=$TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz") Q X
"RTN","BIUTL5",80,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BIUTL5",81,0)
 Q X
"RTN","BIUTL5",82,0)
 ;
"RTN","BIUTL5",83,0)
 ;
"RTN","BIUTL5",84,0)
 ;----------
"RTN","BIUTL5",85,0)
UPXREF(X,BIGBL,Z) ;EP
"RTN","BIUTL5",86,0)
 ;---> Set uppercase xref for X.  Called from M xrefs on mixed case
"RTN","BIUTL5",87,0)
 ;---> fields where an all uppercase lookup is needed.
"RTN","BIUTL5",88,0)
 ;---> Parameters:
"RTN","BIUTL5",89,0)
 ;     1 - X     (req) The value that should be xrefed in uppercase.
"RTN","BIUTL5",90,0)
 ;     2 - BIGBL (req) The global root of the file.
"RTN","BIUTL5",91,0)
 ;
"RTN","BIUTL5",92,0)
 ;---> Variables:
"RTN","BIUTL5",93,0)
 ;     1 - DA    (req) IEN of the entry being xrefed.
"RTN","BIUTL5",94,0)
 S:$G(Z)="" Z="U"
"RTN","BIUTL5",95,0)
 Q:'$D(BIGBL)  Q:$G(X)=""  Q:'$G(DA)
"RTN","BIUTL5",96,0)
 S @(BIGBL_"""""_Z_"""",$E($$UPPER(X),1,30),DA)")=""
"RTN","BIUTL5",97,0)
 ;
"RTN","BIUTL5",98,0)
 Q
"RTN","BIUTL5",99,0)
 ;
"RTN","BIUTL5",100,0)
 ;
"RTN","BIUTL5",101,0)
 ;----------
"RTN","BIUTL5",102,0)
KUPXREF(X,BIGBL) ;EP
"RTN","BIUTL5",103,0)
 ;---> Kill uppercase xref for X.  Called from M xrefs on mixed case
"RTN","BIUTL5",104,0)
 ;---> fields where an all uppercase lookup is needed.
"RTN","BIUTL5",105,0)
 ;---> Parameters:
"RTN","BIUTL5",106,0)
 ;     1 - X     (req) The value that should be xrefed in uppercase.
"RTN","BIUTL5",107,0)
 ;     2 - BIGBL (req) The global root of the file.
"RTN","BIUTL5",108,0)
 ;
"RTN","BIUTL5",109,0)
 ;---> Variables:
"RTN","BIUTL5",110,0)
 ;     1 - DA    (req) IEN of the entry being xrefed.
"RTN","BIUTL5",111,0)
 ;
"RTN","BIUTL5",112,0)
 Q:'$D(BIGBL)  Q:$G(X)=""  Q:'$G(DA)
"RTN","BIUTL5",113,0)
 K @(BIGBL_"""U"",$E($$UPPER(X),1,30),DA)")
"RTN","BIUTL5",114,0)
 Q
"RTN","BIUTL5",115,0)
 ;
"RTN","BIUTL5",116,0)
 ;
"RTN","BIUTL5",117,0)
 ;----------
"RTN","BIUTL5",118,0)
SLDT2(DATE,YY) ;EP
"RTN","BIUTL5",119,0)
 ;---> Convert Fileman Internal Date to "slash" format: MM/DD/YYYY.
"RTN","BIUTL5",120,0)
 ;---> Parameters:
"RTN","BIUTL5",121,0)
 ;     1 - DATE (req) The date in Fileman format.
"RTN","BIUTL5",122,0)
 ;     2 - YY   (opt) If YY=1, return 2-digit year: MM/DD/YY.
"RTN","BIUTL5",123,0)
 ;
"RTN","BIUTL5",124,0)
 ;---> DATE=DATE IN FILEMAN FORMAT.
"RTN","BIUTL5",125,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIUTL5",126,0)
 S DATE=$P(DATE,".")
"RTN","BIUTL5",127,0)
 Q:$L(DATE)'=7 DATE
"RTN","BIUTL5",128,0)
 Q:'$E(DATE,4,5) $E(DATE,1,3)+1700
"RTN","BIUTL5",129,0)
 Q:'$E(DATE,6,7) $E(DATE,4,5)_"/"_$E(DATE,2,3)
"RTN","BIUTL5",130,0)
 Q:($G(YY)=1) $E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(($E(DATE,1,3)+1700),3,4)
"RTN","BIUTL5",131,0)
 Q $E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)
"RTN","BIUTL5",132,0)
 ;
"RTN","BIUTL5",133,0)
 ;
"RTN","BIUTL5",134,0)
 ;----------
"RTN","BIUTL5",135,0)
SLDT1(DATE) ;EP
"RTN","BIUTL5",136,0)
 ;---> CONVERT FILEMAN INTERNAL DATE TO "SLASH" FORMAT:
"RTN","BIUTL5",137,0)
 ;---> MM/DD/YYYY @TIME
"RTN","BIUTL5",138,0)
 N Y,BITIME S BITIME=""
"RTN","BIUTL5",139,0)
 Q:'$D(DATE) "NO DATE"
"RTN","BIUTL5",140,0)
 S Y=DATE,DATE=$P(DATE,".")
"RTN","BIUTL5",141,0)
 Q:'DATE "NO DATE"
"RTN","BIUTL5",142,0)
 Q:$L(DATE)'=7 DATE
"RTN","BIUTL5",143,0)
 Q:'$E(DATE,4,5) $E(DATE,1,3)+1700
"RTN","BIUTL5",144,0)
 Q:'$E(DATE,6,7) $E(DATE,4,5)_"/"_$E(DATE,2,3)
"RTN","BIUTL5",145,0)
 D DD^%DT
"RTN","BIUTL5",146,0)
 S:Y["@" BITIME=" @ "_$P($P(Y,"@",2),":",1,2)
"RTN","BIUTL5",147,0)
 Q $E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)_BITIME
"RTN","BIUTL5",148,0)
 ;
"RTN","BIUTL5",149,0)
 ;
"RTN","BIUTL5",150,0)
 ;----------
"RTN","BIUTL5",151,0)
NOSLDT(DATE) ;EP
"RTN","BIUTL5",152,0)
 ;---> CONVERT FILEMAN INTERNAL DATE TO "NO SLASH" FORMAT: MMDDYYYY.
"RTN","BIUTL5",153,0)
 ;---> DATE=DATE IN FILEMAN FORMAT.
"RTN","BIUTL5",154,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIUTL5",155,0)
 S DATE=$P(DATE,".")
"RTN","BIUTL5",156,0)
 Q:$L(DATE)'=7 DATE
"RTN","BIUTL5",157,0)
 Q $E(DATE,4,5)_$E(DATE,6,7)_($E(DATE,1,3)+1700)
"RTN","BIUTL5",158,0)
 ;
"RTN","BIUTL5",159,0)
 ;
"RTN","BIUTL5",160,0)
 ;----------
"RTN","BIUTL5",161,0)
IMMSDT(DATE) ;EP
"RTN","BIUTL5",162,0)
 ;---> Convert Immserve Date (format MMDDYYYY) TO FILEMAN
"RTN","BIUTL5",163,0)
 ;---> Internal format.
"RTN","BIUTL5",164,0)
 ;---> NOTE: This code is copied into routine ^BIPATUP1 for speed.
"RTN","BIUTL5",165,0)
 ;---> Any changes here should also be made to the call in ^BIPATUP1.
"RTN","BIUTL5",166,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIUTL5",167,0)
 Q ($E(DATE,5,9)-1700)_$E(DATE,1,2)_$E(DATE,3,4)
"RTN","BIUTL5",168,0)
 ;
"RTN","BIUTL5",169,0)
 ;
"RTN","BIUTL5",170,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIUTL5",171,0)
 ;---> Next two linelabels are new to accommodate TCH Forecaster.
"RTN","BIUTL5",172,0)
 ;
"RTN","BIUTL5",173,0)
 ;----------
"RTN","BIUTL5",174,0)
TCHFMDT(DATE) ;EP
"RTN","BIUTL5",175,0)
 ;---> Convert TCH Date (format YYYYMMDD) TO FILEMAN Internal format.
"RTN","BIUTL5",176,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIUTL5",177,0)
 Q ($E(DATE,1,4)-1700)_$E(DATE,5,6)_$E(DATE,7,8)
"RTN","BIUTL5",178,0)
 ;
"RTN","BIUTL5",179,0)
 ;
"RTN","BIUTL5",180,0)
 ;----------
"RTN","BIUTL5",181,0)
FMTCHDT(DATE) ;EP
"RTN","BIUTL5",182,0)
 ;---> Convert FILEMAN Date to TCH (format YYYYMMDD).
"RTN","BIUTL5",183,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIUTL5",184,0)
 Q ($E(DATE,1,3)+1700)_$E(DATE,4,5)_$E(DATE,6,7)
"RTN","BIUTL5",185,0)
 ;**********
"RTN","BIUTL5",186,0)
 ;
"RTN","BIUTL5",187,0)
 ;
"RTN","BIUTL5",188,0)
 ;----------
"RTN","BIUTL5",189,0)
TXDT1(DATE,TIME) ;EP
"RTN","BIUTL5",190,0)
 ;---> Return external date in format: DD-Mmm-YYYY@HH:MM, from Fileman
"RTN","BIUTL5",191,0)
 ;---> internal YYYMMDD.HHMM
"RTN","BIUTL5",192,0)
 ;---> Parameters:
"RTN","BIUTL5",193,0)
 ;     1 - DATE  (req) Internal Fileman date.
"RTN","BIUTL5",194,0)
 ;     2 - TIME  (opt)
"RTN","BIUTL5",195,0)
 ;
"RTN","BIUTL5",196,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIUTL5",197,0)
 N X,Y,Z
"RTN","BIUTL5",198,0)
 S X="Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec"
"RTN","BIUTL5",199,0)
 S Y=$E(DATE,6,7)_"-"_$P(X,U,$E(DATE,4,5))_"-"_($E(DATE,1,3)+1700)
"RTN","BIUTL5",200,0)
 S:'$E(DATE,6,7) Y=$E(Y,4,99)
"RTN","BIUTL5",201,0)
 S:'$E(DATE,4,5) Y=$E(DATE,1,3)+1700
"RTN","BIUTL5",202,0)
 Q:'$G(TIME) Y
"RTN","BIUTL5",203,0)
 S Z=$P(DATE,".",2)
"RTN","BIUTL5",204,0)
 Q:'Z Y
"RTN","BIUTL5",205,0)
 Q Y_" @"_$E(Z,1,2)_":"_$$PAD($E(Z,3,4),2,"0")
"RTN","BIUTL5",206,0)
 ;
"RTN","BIUTL5",207,0)
 ;
"RTN","BIUTL5",208,0)
 ;----------
"RTN","BIUTL5",209,0)
TXDT(DATE) ;EP
"RTN","BIUTL5",210,0)
 ;---> Return external date in format: MMM DD,YYYY
"RTN","BIUTL5",211,0)
 ;---> Parameters:
"RTN","BIUTL5",212,0)
 ;     1 - DATE  (req) Internal Fileman date (DT).
"RTN","BIUTL5",213,0)
 ;
"RTN","BIUTL5",214,0)
 N X,Y
"RTN","BIUTL5",215,0)
 Q:'$D(DATE) "NO DATE"
"RTN","BIUTL5",216,0)
 S Y=DATE D DD^%DT
"RTN","BIUTL5",217,0)
 I Y[", " S Y=$P(Y,", ")_","_$P(Y,", ",2)
"RTN","BIUTL5",218,0)
 I Y["@" S Y=$P(Y,"@")_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","BIUTL5",219,0)
 Q Y
"RTN","BIUTL5",220,0)
 ;
"RTN","BIUTL5",221,0)
 ;
"RTN","BIUTL5",222,0)
 ;----------
"RTN","BIUTL5",223,0)
NOW() ;EP
"RTN","BIUTL5",224,0)
 ;---> Return Current Date and Time in external format.
"RTN","BIUTL5",225,0)
 N %H,X,Y,Z
"RTN","BIUTL5",226,0)
 S %H=$H
"RTN","BIUTL5",227,0)
 D YX^%DTC
"RTN","BIUTL5",228,0)
 I Y["@" S Y=$P($P(Y,"@",2),":",1,2)
"RTN","BIUTL5",229,0)
 S Z=$$TXDT1(X)
"RTN","BIUTL5",230,0)
 S:Y]"" Z=Z_" @"_Y
"RTN","BIUTL5",231,0)
 Q Z
"RTN","BIUTL5",232,0)
 ;
"RTN","BIUTL5",233,0)
 ;
"RTN","BIUTL5",234,0)
 ;----------
"RTN","BIUTL5",235,0)
PAD(D,L,C) ;EP
"RTN","BIUTL5",236,0)
 ;---> Pad the length of data to a total of L characters
"RTN","BIUTL5",237,0)
 ;---> by adding spaces to the end of the data.
"RTN","BIUTL5",238,0)
 ;     Example: S X=$$PAD("MIKE",7)  X="MIKE   " (Added 3 spaces.)
"RTN","BIUTL5",239,0)
 ;---> Parameters:
"RTN","BIUTL5",240,0)
 ;     1 - D  (req) Data to be padded.
"RTN","BIUTL5",241,0)
 ;     2 - L  (req) Total length of resulting data.
"RTN","BIUTL5",242,0)
 ;     3 - C  (opt) Character to pad with (default=space).
"RTN","BIUTL5",243,0)
 ;
"RTN","BIUTL5",244,0)
 Q:'$D(D) ""
"RTN","BIUTL5",245,0)
 S:'$G(L) L=$L(D)
"RTN","BIUTL5",246,0)
 S:$G(C)="" C=" "
"RTN","BIUTL5",247,0)
 Q $E(D_$$REPEAT^XLFSTR(C,L),1,L)
"RTN","BIUTL5",248,0)
 ;
"RTN","BIUTL5",249,0)
 ;
"RTN","BIUTL5",250,0)
 ;----------
"RTN","BIUTL5",251,0)
SP(N,C) ;EP
"RTN","BIUTL5",252,0)
 ;---> Return N spaces or other character.
"RTN","BIUTL5",253,0)
 ;     Example: S X=$$SP(5)_X  Pads the front of X with 5 spaces.
"RTN","BIUTL5",254,0)
 ;---> Parameters:
"RTN","BIUTL5",255,0)
 ;     1 - N  (req) Number of spaces to be returned as extrinsic var.
"RTN","BIUTL5",256,0)
 ;     2 - C  (opt) Character to pad with (default=space).
"RTN","BIUTL5",257,0)
 ;
"RTN","BIUTL5",258,0)
 Q:$G(N)<1 ""
"RTN","BIUTL5",259,0)
 S:$G(C)="" C=" "
"RTN","BIUTL5",260,0)
 Q $$PAD(C,N,C)
"RTN","BIUTL5",261,0)
 ;
"RTN","BIUTL5",262,0)
 ;
"RTN","BIUTL5",263,0)
 ;----------
"RTN","BIUTL5",264,0)
STRIP(X) ;EP
"RTN","BIUTL5",265,0)
 ;---> Strip any punctuation characters from the beginning of X,
"RTN","BIUTL5",266,0)
 ;---> including spaces.
"RTN","BIUTL5",267,0)
 ;---> Parameters:
"RTN","BIUTL5",268,0)
 ;     1 - X  (req) String of characters.
"RTN","BIUTL5",269,0)
 ;
"RTN","BIUTL5",270,0)
 Q:$G(X)="" ""
"RTN","BIUTL5",271,0)
 F  Q:$E(X)'?1P  S X=$E(X,2,99)
"RTN","BIUTL5",272,0)
 Q X
"RTN","BIUTL5",273,0)
 ;
"RTN","BIUTL5",274,0)
 ;
"RTN","BIUTL5",275,0)
 ;----------
"RTN","BIUTL5",276,0)
COPYLET ;EP
"RTN","BIUTL5",277,0)
 ;---> COPY TEXT OF GENERIC SAMPLE LETTER TO ONE OR MORE BI PURPOSES.
"RTN","BIUTL5",278,0)
 ;---> EDIT NEXT LINE TO INCLUDE IENS OF BI PURPOSES TO BE CHANGED.
"RTN","BIUTL5",279,0)
 ;F DA=15,16,18,19 D
"RTN","BIUTL5",280,0)
 N DA,N
"RTN","BIUTL5",281,0)
 S DA=0
"RTN","BIUTL5",282,0)
 F  S DA=$O(^BINOTP(DA)) Q:'DA  D
"RTN","BIUTL5",283,0)
 .K ^BINOTP(DA,1)
"RTN","BIUTL5",284,0)
 .S N=0
"RTN","BIUTL5",285,0)
 .F  S N=$O(^BILET(1,1,N)) Q:'N  D
"RTN","BIUTL5",286,0)
 ..S ^BINOTP(DA,1,N,0)=^BILET(1,1,N,0)
"RTN","BIUTL5",287,0)
 .S ^BINOTP(DA,1,0)=^BILET(1,1,0)
"RTN","BIUTL5",288,0)
 Q
"RTN","BIUTL5",289,0)
 ;
"RTN","BIUTL5",290,0)
 ;
"RTN","BIUTL5",291,0)
 ;********** PATCH 4, v8.5, DEC 01,2012, IHS/CMI/MWR
"RTN","BIUTL5",292,0)
 ;---> New call to add leading zero.
"RTN","BIUTL5",293,0)
 ;----------
"RTN","BIUTL5",294,0)
LEADZ(X) ;EP
"RTN","BIUTL5",295,0)
 ;---> Add a leading zero left of the decimal point if this value is
"RTN","BIUTL5",296,0)
 ;---> less than 1 and greater than -1 and not equal to zero.
"RTN","BIUTL5",297,0)
 ;---> Parameters:
"RTN","BIUTL5",298,0)
 ;     1 - X  (req) Number to be evaulated and given a leading zero.
"RTN","BIUTL5",299,0)
 ;
"RTN","BIUTL5",300,0)
 Q:(+X=0) X
"RTN","BIUTL5",301,0)
 ;
"RTN","BIUTL5",302,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTL5",303,0)
 ;---> Ensure that only one leading zero is displayed.
"RTN","BIUTL5",304,0)
 Q:($E(X,1)=0) X
"RTN","BIUTL5",305,0)
 ;**********
"RTN","BIUTL5",306,0)
 I ((X<1)&(X>0)) S X="0"_X
"RTN","BIUTL5",307,0)
 I ((X>-1)&(X<0)) S X="-0"_-X
"RTN","BIUTL5",308,0)
 Q X
"RTN","BIUTL5",309,0)
 ;**********
"RTN","BIUTL6")
0^155^B178534121
"RTN","BIUTL6",1,0)
BIUTL6 ;IHS/CMI/MWR - UTIL: TEXT FOR POINTERS; MAY 10, 2010
"RTN","BIUTL6",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIUTL6",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL6",4,0)
 ;;  UTILITY: TEXT FOR PROVIDER, HOSP LOC, INSTIT, OTHER LOC,
"RTN","BIUTL6",5,0)
 ;;           TRANSLATIONS, REACTION, CONTRA, SITE HDR, CUR COM TXT.
"RTN","BIUTL6",6,0)
 ;;  PATCH 3: Add call to return Imm Date if 1201 Event Date is populated  IMMDT
"RTN","BIUTL6",7,0)
 ;;  PATCH 9: Allow return of 1201 Event or NULL, by not passing BIVPTR.  IMMDT+12
"RTN","BIUTL6",8,0)
 ;
"RTN","BIUTL6",9,0)
 ;
"RTN","BIUTL6",10,0)
 ;----------
"RTN","BIUTL6",11,0)
USERPOP(BIDFN,BIEDATE) ;EP - Return 1 if Patient is in User Population as of BIEDATE.
"RTN","BIUTL6",12,0)
 ;---> Code from Lori Butcher, CMI, Feb 2010.
"RTN","BIUTL6",13,0)
 ;---> Return 1 if Patient is in User Population; otherwise return 0.
"RTN","BIUTL6",14,0)
 ;---> Parameters:
"RTN","BIUTL6",15,0)
 ;     1 - BIDFN   (req) Patient DFN.
"RTN","BIUTL6",16,0)
 ;     2 - BIEDATE (req) Date as of which Patient is an in User Population.
"RTN","BIUTL6",17,0)
 ;                       User Population = 1 or more qualifying visits in last 3 years.
"RTN","BIUTL6",18,0)
 ;
"RTN","BIUTL6",19,0)
 I '$D(^AUPNPAT(BIDFN,0)) Q 0      ;invalid patient
"RTN","BIUTL6",20,0)
 I '$D(^AUPNVSIT("AC",BIDFN)) Q 0  ;patient has no visits
"RTN","BIUTL6",21,0)
 ;
"RTN","BIUTL6",22,0)
 NEW A,B,E,G,X,BIBDATE,UP,V
"RTN","BIUTL6",23,0)
 S BIBDATE=$$FMADD^XLFDT(BIEDATE,-1096)  ;get beginning date for search, 3 yrs ago (1096 days)
"RTN","BIUTL6",24,0)
 K ^TMP($J,"ALL VISITS")
"RTN","BIUTL6",25,0)
 S A="^TMP($J,""ALL VISITS"","
"RTN","BIUTL6",26,0)
 S B=BIDFN_"^ALL VISITS;DURING "_$$FMTE^XLFDT(BIBDATE)_"-"_$$FMTE^XLFDT(BIEDATE)
"RTN","BIUTL6",27,0)
 S E=$$START1^APCLDF(B,A)
"RTN","BIUTL6",28,0)
 I '$D(^TMP($J,"ALL VISITS",1)) Q 0
"RTN","BIUTL6",29,0)
 S (X,UP)=0
"RTN","BIUTL6",30,0)
 F  S X=$O(^TMP($J,"ALL VISITS",X)) Q:((X'=+X)!(UP))  S V=$P(^TMP($J,"ALL VISITS",X),U,5) D
"RTN","BIUTL6",31,0)
 .Q:'$D(^AUPNVSIT(V,0))
"RTN","BIUTL6",32,0)
 .Q:'$P(^AUPNVSIT(V,0),U,9)
"RTN","BIUTL6",33,0)
 .Q:$P(^AUPNVSIT(V,0),U,11)
"RTN","BIUTL6",34,0)
 .Q:'$D(^AUPNVPRV("AD",V))          ;MUST BE A COMPLETE VISIT
"RTN","BIUTL6",35,0)
 .Q:"SAHO"'[$P(^AUPNVSIT(V,0),U,7)  ;must be ambulatory, hosp, day surgery or obervation
"RTN","BIUTL6",36,0)
 .Q:"V"[$P(^AUPNVSIT(V,0),U,3)      ;can't be a VA type visit
"RTN","BIUTL6",37,0)
 .Q:$P(^AUPNVSIT(V,0),U,6)=""
"RTN","BIUTL6",38,0)
 .S UP=1                            ;has at least one visit so in user pop
"RTN","BIUTL6",39,0)
 Q UP
"RTN","BIUTL6",40,0)
 ;
"RTN","BIUTL6",41,0)
 ;
"RTN","BIUTL6",42,0)
 ;----------
"RTN","BIUTL6",43,0)
ACTCLIN(BIDFN,BIEDATE) ;EP - Return 1 if Patient is Active Clinical User as of BIEDATE.
"RTN","BIUTL6",44,0)
 ;---> Code from Lori Butcher, CMI, Feb 2010.
"RTN","BIUTL6",45,0)
 ;---> Return 1 if Patient is Active Clinical; otherwise return 0.
"RTN","BIUTL6",46,0)
 ;---> Parameters:
"RTN","BIUTL6",47,0)
 ;     1 - BIDFN   (req) Patient DFN.
"RTN","BIUTL6",48,0)
 ;     2 - BIEDATE (req) Date as of which Patient is an Active Clinical User.
"RTN","BIUTL6",49,0)
 ;                       Active Clinical = 2 or more qualifying visits in last 3 years.
"RTN","BIUTL6",50,0)
 ;
"RTN","BIUTL6",51,0)
 I '$D(^AUPNPAT(BIDFN,0)) Q 0      ;invalid patient
"RTN","BIUTL6",52,0)
 I '$D(^AUPNVSIT("AC",BIDFN)) Q 0  ;patient has no visits
"RTN","BIUTL6",53,0)
 ;
"RTN","BIUTL6",54,0)
 NEW A,B,E,G,X,BIBDATE,AC,S,F,BIGPRAYR,V
"RTN","BIUTL6",55,0)
 S BIBDATE=$$FMADD^XLFDT(BIEDATE,-1096)  ;get begin date for search, 3 yrs ago (1096 days)
"RTN","BIUTL6",56,0)
 K ^TMP($J,"ALL VISITS")
"RTN","BIUTL6",57,0)
 ;
"RTN","BIUTL6",58,0)
 ;---> Get IEN of GPRA Control File entry.
"RTN","BIUTL6",59,0)
 S BIGPRAYR=$$GPRAIEN
"RTN","BIUTL6",60,0)
 I 'BIGPRAYR Q 0
"RTN","BIUTL6",61,0)
 ;
"RTN","BIUTL6",62,0)
 S A="^TMP($J,""ALL VISITS"","
"RTN","BIUTL6",63,0)
 S B=BIDFN_"^ALL VISITS;DURING "_$$FMTE^XLFDT(BIBDATE)_"-"_$$FMTE^XLFDT(BIEDATE)
"RTN","BIUTL6",64,0)
 S E=$$START1^APCLDF(B,A)
"RTN","BIUTL6",65,0)
 ;
"RTN","BIUTL6",66,0)
 I '$D(^TMP($J,"ALL VISITS",1)) Q 0
"RTN","BIUTL6",67,0)
 S (X,G,AC,S,F)=0
"RTN","BIUTL6",68,0)
 F  S X=$O(^TMP($J,"ALL VISITS",X)) Q:((X'=+X)!(AC))  S V=$P(^TMP($J,"ALL VISITS",X),U,5) D
"RTN","BIUTL6",69,0)
 .Q:'$D(^AUPNVSIT(V,0))
"RTN","BIUTL6",70,0)
 .Q:'$P(^AUPNVSIT(V,0),U,9)
"RTN","BIUTL6",71,0)
 .Q:$P(^AUPNVSIT(V,0),U,11)
"RTN","BIUTL6",72,0)
 .Q:'$D(^AUPNVPRV("AD",V))          ;MUST BE A COMPLETE VISIT
"RTN","BIUTL6",73,0)
 .Q:"SAHO"'[$P(^AUPNVSIT(V,0),U,7)  ;must be ambulatory, hosp, day surgery or obervation
"RTN","BIUTL6",74,0)
 .Q:"V"[$P(^AUPNVSIT(V,0),U,3)      ;can't be a VA type visit
"RTN","BIUTL6",75,0)
 .Q:$P(^AUPNVSIT(V,0),U,6)=""
"RTN","BIUTL6",76,0)
 .S B=$$CLINIC^APCLV(V,"C")         ;get clinic for active clinical check
"RTN","BIUTL6",77,0)
 .Q:B=""
"RTN","BIUTL6",78,0)
 .I 'G,$D(^BGPCTRL(BIGPRAYR,11,"B",B)) S G=V          ;must be a primary clinic
"RTN","BIUTL6",79,0)
 .I V'=G,$D(^BGPCTRL(BIGPRAYR,12,"B",B)) S S=1        ;has a secondary type of clinic
"RTN","BIUTL6",80,0)
 .I G,S S AC=1                      ;if have both then they are active clinical
"RTN","BIUTL6",81,0)
 .Q
"RTN","BIUTL6",82,0)
 Q AC
"RTN","BIUTL6",83,0)
 ;
"RTN","BIUTL6",84,0)
 ;
"RTN","BIUTL6",85,0)
 ;----------
"RTN","BIUTL6",86,0)
GPRAIEN() ;EP
"RTN","BIUTL6",87,0)
 ;---> Return GPRA Control File IEN
"RTN","BIUTL6",88,0)
 ;
"RTN","BIUTL6",89,0)
 ;---> Get the most recent GPRA Year Control file entry.
"RTN","BIUTL6",90,0)
 N BIYR,BIGPIEN
"RTN","BIUTL6",91,0)
 S BIYR=$O(^BGPCTRL("B",""),-1)
"RTN","BIUTL6",92,0)
 Q:'BIYR 0
"RTN","BIUTL6",93,0)
 S BIGPIEN=$O(^BGPCTRL("B",BIYR,0))
"RTN","BIUTL6",94,0)
 Q:'BIGPIEN 0
"RTN","BIUTL6",95,0)
 Q:('$G(^BGPCTRL(BIGPIEN,0))) 0
"RTN","BIUTL6",96,0)
 Q BIGPIEN
"RTN","BIUTL6",97,0)
 ;
"RTN","BIUTL6",98,0)
 ;
"RTN","BIUTL6",99,0)
 ;----------
"RTN","BIUTL6",100,0)
PROV200(X) ;EP
"RTN","BIUTL6",101,0)
 ;---> Given PROVIDER's IEN in File #3, return the IEN in File #200.
"RTN","BIUTL6",102,0)
 ;---> Parameters:
"RTN","BIUTL6",103,0)
 ;     1 - X  (req) =IEN in old PROVIDER File #6.
"RTN","BIUTL6",104,0)
 ;
"RTN","BIUTL6",105,0)
 Q:'$G(X) ""
"RTN","BIUTL6",106,0)
 Q $G(^DIC(16,X,"A3"))
"RTN","BIUTL6",107,0)
 ;
"RTN","BIUTL6",108,0)
 ;
"RTN","BIUTL6",109,0)
 ;----------
"RTN","BIUTL6",110,0)
PROVIDER(X) ;EP
"RTN","BIUTL6",111,0)
 ;---> Code to check whether to return File 6 or File 200 for
"RTN","BIUTL6",112,0)
 ;---> Provider.  ** Not used so far. **
"RTN","BIUTL6",113,0)
 ;
"RTN","BIUTL6",114,0)
 Q:'X ""
"RTN","BIUTL6",115,0)
 ;---> IF PCC WANTS A FILE 6 POINTER FOR PROVIDER, RESET X.
"RTN","BIUTL6",116,0)
 I '$P(^AUTTSITE(1,0),U,22) D
"RTN","BIUTL6",117,0)
 .I $P($G(^VA(200,X,0)),U,16) S X=$P(^(0),U,16) Q
"RTN","BIUTL6",118,0)
 .S X=$P($G(^DIC(3,X,0)),U,16)
"RTN","BIUTL6",119,0)
 Q X
"RTN","BIUTL6",120,0)
 ;
"RTN","BIUTL6",121,0)
 ;
"RTN","BIUTL6",122,0)
 ;----------
"RTN","BIUTL6",123,0)
REACTXT(X) ;EP
"RTN","BIUTL6",124,0)
 ;---> Return text of Reaction to Immunization.
"RTN","BIUTL6",125,0)
 ;---> Parameters:
"RTN","BIUTL6",126,0)
 ;     1 - X  (req) =IEN in IMMUNIZATION File #9002084.8.
"RTN","BIUTL6",127,0)
 ;
"RTN","BIUTL6",128,0)
 Q:'$G(X) ""
"RTN","BIUTL6",129,0)
 Q:'$D(^BIREC(X,0)) ""
"RTN","BIUTL6",130,0)
 Q $P(^BIREC(X,0),U)
"RTN","BIUTL6",131,0)
 ;
"RTN","BIUTL6",132,0)
 ;
"RTN","BIUTL6",133,0)
 ;----------
"RTN","BIUTL6",134,0)
CONTXT(X) ;EP
"RTN","BIUTL6",135,0)
 ;---> VEN/SMH - changed for VISTA; RPMS to be the same as VISTA
"RTN","BIUTL6",136,0)
 ;--->           File 920.4 much better than 9002084.81
"RTN","BIUTL6",137,0)
 ;---> Return text of a Contraindication Reason.
"RTN","BIUTL6",138,0)
 ;---> Parameters:
"RTN","BIUTL6",139,0)
 ;     1 - X  (req) =IEN in BI TABLE CONTRA REASON File #9002084.81.
"RTN","BIUTL6",140,0)
 ;
"RTN","BIUTL6",141,0)
 Q $$GET1^DIQ(920.4,X,.01)
"RTN","BIUTL6",142,0)
 ;
"RTN","BIUTL6",143,0)
 ;
"RTN","BIUTL6",144,0)
 ;----------
"RTN","BIUTL6",145,0)
SKNAME(X) ;EP
"RTN","BIUTL6",146,0)
 ;---> Return text of Skin Test name.
"RTN","BIUTL6",147,0)
 ;---> Parameters:
"RTN","BIUTL6",148,0)
 ;     1 - X  (req) =IEN in IMMUNIZATION File #9999999.14.
"RTN","BIUTL6",149,0)
 ;
"RTN","BIUTL6",150,0)
 Q:'$G(X) "NO SKIN TEST"
"RTN","BIUTL6",151,0)
 Q:'$D(^AUTTSK(X,0)) "UNK POINTER"
"RTN","BIUTL6",152,0)
 Q $P(^AUTTSK(X,0),U)
"RTN","BIUTL6",153,0)
 ;
"RTN","BIUTL6",154,0)
 ;
"RTN","BIUTL6",155,0)
 ;----------
"RTN","BIUTL6",156,0)
SKRESLT(X) ;EP
"RTN","BIUTL6",157,0)
 ;---> Return text of Skin Test Result.
"RTN","BIUTL6",158,0)
 ;---> Parameters:
"RTN","BIUTL6",159,0)
 ;     1 - X  (req) = Code for Skin Test Result.
"RTN","BIUTL6",160,0)
 ;
"RTN","BIUTL6",161,0)
 Q:$G(X)="" ""
"RTN","BIUTL6",162,0)
 Q:X="P" "Positive"
"RTN","BIUTL6",163,0)
 Q:X="N" "Negative"
"RTN","BIUTL6",164,0)
 Q:X="D" "Doubtful"
"RTN","BIUTL6",165,0)
 Q:X="O" "No Take"
"RTN","BIUTL6",166,0)
 Q "Unknown"
"RTN","BIUTL6",167,0)
 ;
"RTN","BIUTL6",168,0)
 ;
"RTN","BIUTL6",169,0)
 ;----------
"RTN","BIUTL6",170,0)
HOSPLC() ;EP
"RTN","BIUTL6",171,0)
 ;---> RETURN TEXT OF HOSPITAL LOCATION NAME.
"RTN","BIUTL6",172,0)
 ;---> REQUIRED VARIABLE: X=IEN IN HOSPITAL LOCATION FILE #44.
"RTN","BIUTL6",173,0)
 ; ZEXCEPT: X
"RTN","BIUTL6",174,0)
 Q:'$D(X) ""
"RTN","BIUTL6",175,0)
 Q:'X "UNKNOWN"
"RTN","BIUTL6",176,0)
 Q:'$D(^SC(X,0)) "UNKNOWN POINTER"
"RTN","BIUTL6",177,0)
 Q $P(^SC(X,0),U)
"RTN","BIUTL6",178,0)
 ;
"RTN","BIUTL6",179,0)
 ;
"RTN","BIUTL6",180,0)
 ;----------
"RTN","BIUTL6",181,0)
INSTIT() ;EP
"RTN","BIUTL6",182,0)
 ;---> RETURN IEN OF INSTITUTION (FACILITY) FILE 4, FOR THIS HOSPITAL
"RTN","BIUTL6",183,0)
 ;---> LOCATION ENTRY IN HOSPITAL LOCATION FILE 44.
"RTN","BIUTL6",184,0)
 ;---> ALSO CONCATENATE "`" TO THE FRONT OF IEN FOR USE IN DR STRINGS.
"RTN","BIUTL6",185,0)
 ; ZEXCEPT: X
"RTN","BIUTL6",186,0)
 Q:'$D(X) ""
"RTN","BIUTL6",187,0)
 Q:X="" ""
"RTN","BIUTL6",188,0)
 Q:'$D(^SC(X,0)) ""
"RTN","BIUTL6",189,0)
 Q:$P(^SC(X,0),U,4)']"" ""
"RTN","BIUTL6",190,0)
 Q "`"_$P(^SC(X,0),U,4)
"RTN","BIUTL6",191,0)
 ;
"RTN","BIUTL6",192,0)
 ;
"RTN","BIUTL6",193,0)
 ;----------
"RTN","BIUTL6",194,0)
INSTTX(FACILITY) ;EP
"RTN","BIUTL6",195,0)
 ;---> Return text of Institution (Facility) Name.
"RTN","BIUTL6",196,0)
 ;---> Parameters:
"RTN","BIUTL6",197,0)
 ;     1 - FACILITY  (req) IEN in INSTITUTION File #4.
"RTN","BIUTL6",198,0)
 ;
"RTN","BIUTL6",199,0)
 Q:'$G(FACILITY) ""
"RTN","BIUTL6",200,0)
 Q:'$D(^DIC(4,FACILITY,0)) "Unknown facility"
"RTN","BIUTL6",201,0)
 Q $P(^DIC(4,FACILITY,0),U)
"RTN","BIUTL6",202,0)
 ;
"RTN","BIUTL6",203,0)
 ;
"RTN","BIUTL6",204,0)
 ;----------
"RTN","BIUTL6",205,0)
LOCABBR(FACILITY) ;EP
"RTN","BIUTL6",206,0)
 ;---> Return text of Institution/Location Abbreviated Name.
"RTN","BIUTL6",207,0)
 ;---> Parameters:
"RTN","BIUTL6",208,0)
 ;     1 - FACILITY  (req) IEN in INSTITUTION File #4.
"RTN","BIUTL6",209,0)
 ;
"RTN","BIUTL6",210,0)
 Q:'$G(FACILITY) ""
"RTN","BIUTL6",211,0)
 Q:'$D(^AUTTLOC(FACILITY,0)) "UNKN"
"RTN","BIUTL6",212,0)
 Q $P(^AUTTLOC(FACILITY,0),U,7)
"RTN","BIUTL6",213,0)
 ;
"RTN","BIUTL6",214,0)
 ;
"RTN","BIUTL6",215,0)
 ;----------
"RTN","BIUTL6",216,0)
INSTTX1(BIVPTR,BIMX,BIIHS) ;EP
"RTN","BIUTL6",217,0)
 ;---> Return text of Other Location if it exists (for this Visit);
"RTN","BIUTL6",218,0)
 ;---> otherwise, return text of IHS Location.
"RTN","BIUTL6",219,0)
 ;---> Parameters:
"RTN","BIUTL6",220,0)
 ;     1 - BIVPTR  (req) IEN of Visit in VISIT File.
"RTN","BIUTL6",221,0)
 ;     2 - BIMX    (opt) BIMX=1 to return text in mixed case.
"RTN","BIUTL6",222,0)
 ;     3 - BIIHS   (opt) BIIHS=1 to force IHS LOCATION (ignore OTHER).
"RTN","BIUTL6",223,0)
 ;                       BIIHS>1 to force OTHER LOCATION.
"RTN","BIUTL6",224,0)
 ;                       BIIHS<1 Look first for OTHER LOCATION;
"RTN","BIUTL6",225,0)
 ;                               if null, then return IHS LOCATION.
"RTN","BIUTL6",226,0)
 ;
"RTN","BIUTL6",227,0)
 Q:'$G(BIVPTR) "No Visit Pointer."
"RTN","BIUTL6",228,0)
 Q:'$D(^AUPNVSIT(BIVPTR,0)) "Visit does not exist."
"RTN","BIUTL6",229,0)
 ;
"RTN","BIUTL6",230,0)
 N Y
"RTN","BIUTL6",231,0)
 S:'$G(BIMX) BIMX=0
"RTN","BIUTL6",232,0)
 S:'$G(BIIHS) BIIHS=0
"RTN","BIUTL6",233,0)
 ;
"RTN","BIUTL6",234,0)
 D
"RTN","BIUTL6",235,0)
 .;---> If this Visit has an OTHER LOCATION and IHS LOCATION
"RTN","BIUTL6",236,0)
 .;---> is not forced, return OUTSIDE LOCATION text.
"RTN","BIUTL6",237,0)
 .I BIIHS<1 I $P($G(^AUPNVSIT(BIVPTR,21)),U)]"" D  Q
"RTN","BIUTL6",238,0)
 ..S Y=$P(^AUPNVSIT(BIVPTR,21),U)
"RTN","BIUTL6",239,0)
 .;
"RTN","BIUTL6",240,0)
 .;---> If OTHER LOCATION is forced, return it (even if null).
"RTN","BIUTL6",241,0)
 .I BIIHS>1 S Y=$P($G(^AUPNVSIT(BIVPTR,21)),U) Q
"RTN","BIUTL6",242,0)
 .;
"RTN","BIUTL6",243,0)
 .;---> If IHS Location is forced (or if neither IHS nor OTHER was
"RTN","BIUTL6",244,0)
 .;---> forced, but OTHER is null), return the IHS LOCATION
"RTN","BIUTL6",245,0)
 .;---> (.06 of VISIT File).
"RTN","BIUTL6",246,0)
 .S Y=$P(^AUPNVSIT(BIVPTR,0),U,6)
"RTN","BIUTL6",247,0)
 .I Y<1 S Y="Location not entered." Q
"RTN","BIUTL6",248,0)
 .S Y=$E($$INSTTX(Y),1,20)
"RTN","BIUTL6",249,0)
 ;
"RTN","BIUTL6",250,0)
 Q:BIMX $$T^BITRS(Y)
"RTN","BIUTL6",251,0)
 Q Y
"RTN","BIUTL6",252,0)
 ;
"RTN","BIUTL6",253,0)
 ;
"RTN","BIUTL6",254,0)
 ;----------
"RTN","BIUTL6",255,0)
OTHERLOC(BIDUZ2,Z) ;PEP - Return IEN of the "OTHER" Location.
"RTN","BIUTL6",256,0)
 ;---> Return IEN of the "OTHER" Location, as selected in the
"RTN","BIUTL6",257,0)
 ;---> BI SITE PARAMETER File.  (For use with Outside Locations
"RTN","BIUTL6",258,0)
 ;---> in PCC Visit entries.)
"RTN","BIUTL6",259,0)
 ;---> Parameters:
"RTN","BIUTL6",260,0)
 ;     1 - BIDUZ2 (req) IEN of "OTHER" in LOCATION File.
"RTN","BIUTL6",261,0)
 ;     2 - Z      (opt) If Z=1 return text of "OTHER" Location.
"RTN","BIUTL6",262,0)
 ;
"RTN","BIUTL6",263,0)
 S:'$G(Z) Z=0
"RTN","BIUTL6",264,0)
 Q:'$G(BIDUZ2) $S(Z:"OTHER NOT DEFINED",1:"")
"RTN","BIUTL6",265,0)
 Q:'$D(^BISITE(BIDUZ2,0)) $S(Z:"SITE PARAMETERS NOT SET.",1:"")
"RTN","BIUTL6",266,0)
 I $$RPMS^BIUTL9() Q $$RPMSOTH(BIDUZ2,Z)
"RTN","BIUTL6",267,0)
 E  Q $$VISTAOTH(BIDUZ2)
"RTN","BIUTL6",268,0)
 ;
"RTN","BIUTL6",269,0)
 ;
"RTN","BIUTL6",270,0)
 ;----------
"RTN","BIUTL6",271,0)
RPMSOTH(BIDUZ2,Z) ; [Called only from OTHERLOC] Return IEN or text for Other Location for RPMS
"RTN","BIUTL6",272,0)
 N X
"RTN","BIUTL6",273,0)
 S X=$P(^BISITE(BIDUZ2,0),U,3)
"RTN","BIUTL6",274,0)
 Q:'X $S(Z:"OTHER not set in BI SITE PARAMETERS.",1:"")
"RTN","BIUTL6",275,0)
 Q:'$D(^DIC(4,X,0)) $S(Z:"UNKNOWN FACILITY",1:"")
"RTN","BIUTL6",276,0)
 Q:'Z X
"RTN","BIUTL6",277,0)
 Q $$INSTTX(X)
"RTN","BIUTL6",278,0)
 ;
"RTN","BIUTL6",279,0)
VISTAOTH(BIDUZ2) ; [Called only from OTHERLOC]  Retrun text for Other Location in VISTA
"RTN","BIUTL6",280,0)
 Q $$GET1^DIQ(9002084.02,BIDUZ2,"VISTA OTHER LOCATION")
"RTN","BIUTL6",281,0)
 ;
"RTN","BIUTL6",282,0)
 ;----------
"RTN","BIUTL6",283,0)
DEFPROV(BIDUZ2) ;EP
"RTN","BIUTL6",284,0)
 ;---> Return 1 if Site Parameter says User should be the Default
"RTN","BIUTL6",285,0)
 ;---> Provider for a new Visit.
"RTN","BIUTL6",286,0)
 ;---> Parameters:
"RTN","BIUTL6",287,0)
 ;     1 - BIDUZ2 (req) User's DUZ(2)
"RTN","BIUTL6",288,0)
 ;
"RTN","BIUTL6",289,0)
 Q +$P($G(^BISITE(+$G(BIDUZ2),0)),U,16)
"RTN","BIUTL6",290,0)
 ;
"RTN","BIUTL6",291,0)
 ;
"RTN","BIUTL6",292,0)
 ;----------
"RTN","BIUTL6",293,0)
REPHDR(BISITE) ;EP
"RTN","BIUTL6",294,0)
 ;---> Return text of Record/Report Header for this Site.
"RTN","BIUTL6",295,0)
 ;---> This is the free text full name of the site as it should
"RTN","BIUTL6",296,0)
 ;---> appear at the top of records and reports.
"RTN","BIUTL6",297,0)
 ;---> Parameters:
"RTN","BIUTL6",298,0)
 ;     1 - BISITE  (req) IEN in BI SITE PARAMETERS File,
"RTN","BIUTL6",299,0)
 ;                         the user's DUZ(2) (INSTITUTION File #4).
"RTN","BIUTL6",300,0)
 ;
"RTN","BIUTL6",301,0)
 Q:'$G(BISITE) "No Facility IEN passed."
"RTN","BIUTL6",302,0)
 Q:'$D(^BISITE(BISITE,0)) "Report Header not set."
"RTN","BIUTL6",303,0)
 N X S X=$P(^BISITE(BISITE,0),U,6)
"RTN","BIUTL6",304,0)
 S:X="" X=$$INSTTX(BISITE)
"RTN","BIUTL6",305,0)
 Q X
"RTN","BIUTL6",306,0)
 ;
"RTN","BIUTL6",307,0)
 ;
"RTN","BIUTL6",308,0)
 ;----------
"RTN","BIUTL6",309,0)
CCTX(X) ;EP
"RTN","BIUTL6",310,0)
 ;---> Return text of Current Community Name.
"RTN","BIUTL6",311,0)
 ;---> Parameters:
"RTN","BIUTL6",312,0)
 ;     1 - X  (req) IEN in COMMUNITY File #9999999.05.
"RTN","BIUTL6",313,0)
 ;
"RTN","BIUTL6",314,0)
 Q:'$G(X) ""
"RTN","BIUTL6",315,0)
 Q:'$D(^AUTTCOM(X,0)) "BAD POINTER"
"RTN","BIUTL6",316,0)
 Q $P(^AUTTCOM(X,0),U)
"RTN","BIUTL6",317,0)
 ;
"RTN","BIUTL6",318,0)
 ;
"RTN","BIUTL6",319,0)
 ;----------
"RTN","BIUTL6",320,0)
BENTX(X) ;EP
"RTN","BIUTL6",321,0)
 ;---> Return text of Beneficiary Type.
"RTN","BIUTL6",322,0)
 ;---> Parameters:
"RTN","BIUTL6",323,0)
 ;     1 - X  (req) IEN in BENEFICIARY File #9999999.25.
"RTN","BIUTL6",324,0)
 ;
"RTN","BIUTL6",325,0)
 Q:'$G(X) ""
"RTN","BIUTL6",326,0)
 Q:'$D(^AUTTBEN(X,0)) "BAD POINTER"
"RTN","BIUTL6",327,0)
 Q $P(^AUTTBEN(X,0),U)
"RTN","BIUTL6",328,0)
 ;
"RTN","BIUTL6",329,0)
 ;
"RTN","BIUTL6",330,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIUTL6",331,0)
 ;---> New line accounting for Event Date and Time.
"RTN","BIUTL6",332,0)
 ;----------
"RTN","BIUTL6",333,0)
IMMDTT(BIVPTR,BI012,BIFORM) ;EP
"RTN","BIUTL6",334,0)
 ;---> Return Immunization Date and Time from V Immunizations file.
"RTN","BIUTL6",335,0)
 ;---> If 1201 Event Date and Time field is populated, return that.
"RTN","BIUTL6",336,0)
 ;---> Parameters:
"RTN","BIUTL6",337,0)
 ;     1 - BIVPTR  (req) IEN in VISIT File.
"RTN","BIUTL6",338,0)
 ;     2 - BI012   (opt) 12-node of V IMM File entry.
"RTN","BIUTL6",339,0)
 ;     3 - BIFORM  (opt) Date Format: null default=MM/DD/YY, 1=(DD-Mmm-YYYY
"RTN","BIUTL6",340,0)
 ;                                    2=YYYMMDD
"RTN","BIUTL6",341,0)
 ;
"RTN","BIUTL6",342,0)
 N BIY D
"RTN","BIUTL6",343,0)
 .I $P($G(BI012),U) S BIY=$P(BI012,U) Q
"RTN","BIUTL6",344,0)
 .;--->
"RTN","BIUTL6",345,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL6",346,0)
 .;---> Allow return of 1201 Event or NULL, by not passing BIVPTR.
"RTN","BIUTL6",347,0)
 .I '$G(BIVPTR) S BIY="" Q
"RTN","BIUTL6",348,0)
 .;
"RTN","BIUTL6",349,0)
 .S BIY=$P($P($G(^AUPNVSIT($G(BIVPTR),0)),U),".")
"RTN","BIUTL6",350,0)
 Q:'BIY ""
"RTN","BIUTL6",351,0)
 ;**********
"RTN","BIUTL6",352,0)
 Q:($G(BIFORM)=2) BIY
"RTN","BIUTL6",353,0)
 Q:($G(BIFORM)=1) $$TXDT1^BIUTL5(BIY,1)
"RTN","BIUTL6",354,0)
 Q $$SLDT2^BIUTL5(BIY,1)
"RTN","BIUTL6",355,0)
 ;---> Old line stored in ^BIEXPDD(29,0)=S Y=$P($G(~AUPNVSIT(+BIVPTR,0)),U),Y=$$TXDT1~BIUTL5(Y,1)
"RTN","BIUTL6",356,0)
 ;**********
"RTN","BIUTL6",357,0)
 ;
"RTN","BIUTL6",358,0)
 ;----------
"RTN","BIUTL6",359,0)
BIUPTX(X,Y) ;EP
"RTN","BIUTL6",360,0)
 ;---> Return text of Patient Group.
"RTN","BIUTL6",361,0)
 ;---> Parameters:
"RTN","BIUTL6",362,0)
 ;     1 - X  (req) Code for Patient Group.
"RTN","BIUTL6",363,0)
 ;     2 - Y  (opt) If Y=1 return the long form.
"RTN","BIUTL6",364,0)
 ;
"RTN","BIUTL6",365,0)
 Q:X="r" $S($G(Y):"Registered",1:"Registered Patients (All)")
"RTN","BIUTL6",366,0)
 Q:X="i" $S($G(Y):"Imm Register",1:"Immunization Register Patients (Active)")
"RTN","BIUTL6",367,0)
 Q:X="u" $S($G(Y):"User Population",1:"User Population (1 visit, 3 yrs)")
"RTN","BIUTL6",368,0)
 Q:X="a" $S($G(Y):"Active Users",1:"Active Users (2+ visits, 3 yrs)")
"RTN","BIUTL6",369,0)
 Q $S($G(Y):"Error",1:"Error (Unknown Patient Group)")
"RTN","BIUTL6",370,0)
 ;
"RTN","BIUTL6",371,0)
 ;
"RTN","BIUTL6",372,0)
 ;----------
"RTN","BIUTL6",373,0)
LOTTX(X,Y) ;EP
"RTN","BIUTL6",374,0)
 ;---> Return text or vaccine of a Lot Number.
"RTN","BIUTL6",375,0)
 ;---> Parameters:
"RTN","BIUTL6",376,0)
 ;     1 - X  (req) =IEN in IMMUNIZATION LOT File #9999999.41.
"RTN","BIUTL6",377,0)
 ;     2 - Y  (opt) If Y=1, return the Vaccine IEN associated with
"RTN","BIUTL6",378,0)
 ;                  this Lot Number.  If Y=2, return text of Vaccine Name.
"RTN","BIUTL6",379,0)
 ;                  If Y=3 return default NDC for this Lot Number.
"RTN","BIUTL6",380,0)
 ;
"RTN","BIUTL6",381,0)
 Q:'$G(X) ""
"RTN","BIUTL6",382,0)
 Q:'$D(^AUTTIML(X,0)) ""
"RTN","BIUTL6",383,0)
 ;---> Return Lot Number text.
"RTN","BIUTL6",384,0)
 Q:'$G(Y) $P(^AUTTIML(X,0),U)
"RTN","BIUTL6",385,0)
 I Y=1 Q $P(^AUTTIML(X,0),U,4)
"RTN","BIUTL6",386,0)
 I Y=2 Q $$VNAME^BIUTL2(Z)  ; TODO(VEN/SMH): What the HELL is Z??? This looks like a bug.
"RTN","BIUTL6",387,0)
 I Y=3 Q $P(^AUTTIML(X,0),U,17)
"RTN","BIUTL6",388,0)
 Q ""
"RTN","BIUTL6",389,0)
 ;
"RTN","BIUTL6",390,0)
 ;
"RTN","BIUTL6",391,0)
 ;----------
"RTN","BIUTL6",392,0)
DETX(X) ;EP
"RTN","BIUTL6",393,0)
 ;---> Return text of a Data Element name.
"RTN","BIUTL6",394,0)
 ;---> Parameters:
"RTN","BIUTL6",395,0)
 ;     1 - X  (req) =IEN in BI TABLE DATA ELEMENT File 9002084.91.
"RTN","BIUTL6",396,0)
 ;
"RTN","BIUTL6",397,0)
 Q:'$G(X) ""
"RTN","BIUTL6",398,0)
 Q:'$D(^BIEXPDD(X,0)) ""
"RTN","BIUTL6",399,0)
 Q $P(^BIEXPDD(X,0),U)
"RTN","BIUTL6",400,0)
 ;
"RTN","BIUTL6",401,0)
 ;
"RTN","BIUTL6",402,0)
 ;----------
"RTN","BIUTL6",403,0)
TEXT1 ;EP
"RTN","BIUTL6",404,0)
 ;;You have selected a "Duplicate Lot Number."  This means that this
"RTN","BIUTL6",405,0)
 ;;Lot Number exists at least one other time in the Lot Number file,
"RTN","BIUTL6",406,0)
 ;;and the Immunization visit you are entering cannot be stored until
"RTN","BIUTL6",407,0)
 ;;the duplicate has been resolved.
"RTN","BIUTL6",408,0)
 ;;
"RTN","BIUTL6",409,0)
 ;;Only a person with access to the Immunization Manager's Menu can
"RTN","BIUTL6",410,0)
 ;;resolve duplicate Lot Numbers.  Since you do not have this access,
"RTN","BIUTL6",411,0)
 ;;you should contact your Immunization Program Manager or your
"RTN","BIUTL6",412,0)
 ;;Computer Site Manager for support with this problem.
"RTN","BIUTL6",413,0)
 ;;
"RTN","BIUTL6",414,0)
 ;;In the meantime, you can either finish entering the Immunization
"RTN","BIUTL6",415,0)
 ;;visit without a Lot Number, and come back to add the Lot Number to
"RTN","BIUTL6",416,0)
 ;;this visit later, after the duplicate has been resolved.
"RTN","BIUTL6",417,0)
 ;;Or you can simply quit without adding this visit at this time.
"RTN","BIUTL6",418,0)
 ;;
"RTN","BIUTL6",419,0)
 D PRINTX("TEXT1")
"RTN","BIUTL6",420,0)
 Q
"RTN","BIUTL6",421,0)
 ;
"RTN","BIUTL6",422,0)
 ;
"RTN","BIUTL6",423,0)
 ;----------
"RTN","BIUTL6",424,0)
TEXT2 ;EP
"RTN","BIUTL6",425,0)
 ;;You have selected a "Duplicate Lot Number."  This means that this
"RTN","BIUTL6",426,0)
 ;;Lot Number exists at least one other time in the Lot Number file,
"RTN","BIUTL6",427,0)
 ;;and the Immunization visit you are entering cannot be stored until
"RTN","BIUTL6",428,0)
 ;;the duplicate has been resolved.
"RTN","BIUTL6",429,0)
 ;;
"RTN","BIUTL6",430,0)
 ;;Two steps should be taken to resolve duplicate Lot Numbers:
"RTN","BIUTL6",431,0)
 ;;
"RTN","BIUTL6",432,0)
 ;;STEP 1
"RTN","BIUTL6",433,0)
 ;;------
"RTN","BIUTL6",434,0)
 ;;Duplicate Lot Numbers are resolved under the Manager Menu, "Lot
"RTN","BIUTL6",435,0)
 ;;Number Add/Edit" (MGR-->LOT).  Go to this option and enter the Lot
"RTN","BIUTL6",436,0)
 ;;Number in question.  Two or more choices will be presented.  Select
"RTN","BIUTL6",437,0)
 ;;one of the choices to be the valid Lot Number.  Edit this Lot Number,
"RTN","BIUTL6",438,0)
 ;;making sure it is Active and that all relevant vaccines are listed
"RTN","BIUTL6",439,0)
 ;;under it.
"RTN","BIUTL6",440,0)
 D PRINTX("TEXT2")
"RTN","BIUTL6",441,0)
 Q
"RTN","BIUTL6",442,0)
 ;
"RTN","BIUTL6",443,0)
 ;
"RTN","BIUTL6",444,0)
 ;----------
"RTN","BIUTL6",445,0)
TEXT3 ;EP
"RTN","BIUTL6",446,0)
 ;;STEP 2
"RTN","BIUTL6",447,0)
 ;;------
"RTN","BIUTL6",448,0)
 ;;Select and edit each of the duplicate Lot Numbers.
"RTN","BIUTL6",449,0)
 ;;
"RTN","BIUTL6",450,0)
 ;;Edit the Lot Number itself by placing  "z" at the beginning
"RTN","BIUTL6",451,0)
 ;;(e.g, 483-116 --> z483-116).  If there is a second duplicate, add
"RTN","BIUTL6",452,0)
 ;;"zz" to the beginning of that Lot Number; for a third duplicate,
"RTN","BIUTL6",453,0)
 ;;add "zzz", and so on.  The adding of leading "z"s to the duplicates
"RTN","BIUTL6",454,0)
 ;;will make them distinguishable from the valid Lot Number.  This
"RTN","BIUTL6",455,0)
 ;;method will also make the old duplicate Lot Numbers recognizable on
"RTN","BIUTL6",456,0)
 ;;pre-existing visits.
"RTN","BIUTL6",457,0)
 ;;
"RTN","BIUTL6",458,0)
 ;;The duplicate Lot Numbers should also be made INACTIVE.
"RTN","BIUTL6",459,0)
 ;;If an old Visit is to be edited and it has one of the old duplicate
"RTN","BIUTL6",460,0)
 ;;Lot Numbers, the old duplicate should be replaced with the current
"RTN","BIUTL6",461,0)
 ;;valid Lot Number (easily recognized by ignoring the leading "z"s).
"RTN","BIUTL6",462,0)
 D PRINTX("TEXT3")
"RTN","BIUTL6",463,0)
 Q
"RTN","BIUTL6",464,0)
 ;
"RTN","BIUTL6",465,0)
 ;
"RTN","BIUTL6",466,0)
 ;----------
"RTN","BIUTL6",467,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIUTL6",468,0)
 Q:$G(BILINL)=""
"RTN","BIUTL6",469,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIUTL6",470,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIUTL6",471,0)
 Q
"RTN","BIUTL7")
0^156^B135015819
"RTN","BIUTL7",1,0)
BIUTL7 ;IHS/CMI/MWR - UTIL: SCREENMAN CODE; MAY 10, 2010
"RTN","BIUTL7",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIUTL7",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL7",4,0)
 ;;  SCREENMAN RELATED CODE TO LOAD & SAVE: VISIT, CASE DATA, CONTRAS.
"RTN","BIUTL7",5,0)
 ;;  PATCH 9: Added Preload of Admin Date and VIS Presented Date. LOADVIS+70
"RTN","BIUTL7",6,0)
 ;;           Added save of Admin Date and VIS Presented Date. SAVISIT+41
"RTN","BIUTL7",7,0)
 ;
"RTN","BIUTL7",8,0)
 ;
"RTN","BIUTL7",9,0)
 ;----------
"RTN","BIUTL7",10,0)
LOADVIS(BIVTYPE) ;EP
"RTN","BIUTL7",11,0)
 ;---> Code to load Visit data for ScreenMan Edit form.
"RTN","BIUTL7",12,0)
 ;---> Called by Pre Action of Block BI BLK-IMM VISIT ADD/EDIT or
"RTN","BIUTL7",13,0)
 ;---> BI BLK-SKIN VISIT ADD/EDIT of Forms BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL7",14,0)
 ;---> or BI FORM-SKIN VISIT ADD/EDIT, respectively.
"RTN","BIUTL7",15,0)
 ;---> Parameters:
"RTN","BIUTL7",16,0)
 ;     1 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIUTL7",17,0)
 ;
"RTN","BIUTL7",18,0)
 ;---> If BIVTYPE does not="I" (Imm Visit) and it does
"RTN","BIUTL7",19,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIUTL7",20,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D ERRCD^BIUTL2(410,,1) Q
"RTN","BIUTL7",21,0)
 ;
"RTN","BIUTL7",22,0)
 ;
"RTN","BIUTL7",23,0)
 ;---> If this is an old Visit, load data for Screenman.
"RTN","BIUTL7",24,0)
 D:$G(BI("K"))
"RTN","BIUTL7",25,0)
 .;
"RTN","BIUTL7",26,0)
 .;---> IMMUNIZATIONS *
"RTN","BIUTL7",27,0)
 .D:BIVTYPE="I"
"RTN","BIUTL7",28,0)
 ..;
"RTN","BIUTL7",29,0)
 ..;---> Load the Vaccine.
"RTN","BIUTL7",30,0)
 ..D:$G(BI("B"))
"RTN","BIUTL7",31,0)
 ...;---> Load Vaccine Name and display Short Name below (if different).
"RTN","BIUTL7",32,0)
 ...D PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BIUTL7",33,0)
 ...D VSHORT(BI("B"))
"RTN","BIUTL7",34,0)
 ..;
"RTN","BIUTL7",35,0)
 ..;---> Load Lot Number IEN, and display Lot data (Amount and Exp Date).
"RTN","BIUTL7",36,0)
 ..I $G(BI("D")) D
"RTN","BIUTL7",37,0)
 ...D PUT^DDSVALF(3,,,BI("D"),"I")
"RTN","BIUTL7",38,0)
 ...D LOTDAT(BI("D"))
"RTN","BIUTL7",39,0)
 ..;
"RTN","BIUTL7",40,0)
 ..;---> Make Dose Override editable (Screenman Field "Disable Editing"
"RTN","BIUTL7",41,0)
 ..;---> is set to "YES" by default when the form is loaded.)
"RTN","BIUTL7",42,0)
 ..D UNED^DDSUTL(14,,,0)
"RTN","BIUTL7",43,0)
 ..;---> Load Dose Override if there is one.
"RTN","BIUTL7",44,0)
 ..I $G(BI("S")) D PUT^DDSVALF(14,,,BI("S"),"I")
"RTN","BIUTL7",45,0)
 ..;
"RTN","BIUTL7",46,0)
 ..;
"RTN","BIUTL7",47,0)
 ..;---> Make Reaction editable (Screenman Field "Disable Editing"
"RTN","BIUTL7",48,0)
 ..;---> is set to "YES" by default when the form is loaded.)
"RTN","BIUTL7",49,0)
 ..D UNED^DDSUTL(13,,,0)
"RTN","BIUTL7",50,0)
 ..;---> Load Immunization Reaction.
"RTN","BIUTL7",51,0)
 ..I $G(BI("O")) D PUT^DDSVALF(13,,,BI("O"),"I")
"RTN","BIUTL7",52,0)
 ..;
"RTN","BIUTL7",53,0)
 ..;---> Load the Injection Site.
"RTN","BIUTL7",54,0)
 ..I $G(BI("T"))]"" D PUT^DDSVALF(4,,,BI("T"),"I")
"RTN","BIUTL7",55,0)
 ..;
"RTN","BIUTL7",56,0)
 ..;---> Release/Rev Date of VIS (DD-Mmm-YYYY).
"RTN","BIUTL7",57,0)
 ..I $G(BI("Q"))>1 D PUT^DDSVALF(10,,,BI("Q"),"E")
"RTN","BIUTL7",58,0)
 ..;
"RTN","BIUTL7",59,0)
 ..;---> Load the Volume, add leading zero to Volume if necessary.
"RTN","BIUTL7",60,0)
 ..I $G(BI("W")) D PUT^DDSVALF(5,,,$$LEADZ^BIUTL5(BI("W")),"E")
"RTN","BIUTL7",61,0)
 ..;
"RTN","BIUTL7",62,0)
 ..;---> Load Imported from Outside Source, if=1 (display "edited" if=2).
"RTN","BIUTL7",63,0)
 ..I $G(BI("Y")) D PUT^DDSVALF(15,,,"*Imported"_$S(BI("Y")=2:" (edited)*",1:"*"))
"RTN","BIUTL7",64,0)
 ..;
"RTN","BIUTL7",65,0)
 ..;---> Load VFC Elig if Native and <19.
"RTN","BIUTL7",66,0)
 ..D VFCSET^BIUTL8
"RTN","BIUTL7",67,0)
 ..;
"RTN","BIUTL7",68,0)
 ..;---> Load NDC Code.
"RTN","BIUTL7",69,0)
 ..I $G(BI("H"))]"" D PUT^DDSVALF(3.8,,,BI("H"),"I")
"RTN","BIUTL7",70,0)
 ..;
"RTN","BIUTL7",71,0)
 ..;
"RTN","BIUTL7",72,0)
 ..;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL7",73,0)
 ..;---> Preload Admin Date and Date VIS Presented.
"RTN","BIUTL7",74,0)
 ..I $G(BI("EE"))>1 D PUT^DDSVALF(1.5,,,BI("EE"),"E")
"RTN","BIUTL7",75,0)
 ..I $G(BI("QQ"))>1 D PUT^DDSVALF(10.2,,,BI("QQ"),"E")
"RTN","BIUTL7",76,0)
 ..;**********
"RTN","BIUTL7",77,0)
 .;
"RTN","BIUTL7",78,0)
 .;---> SKIN TESTS *
"RTN","BIUTL7",79,0)
 .D:BIVTYPE="S"
"RTN","BIUTL7",80,0)
 ..;
"RTN","BIUTL7",81,0)
 ..;---> Load the Skin Test.
"RTN","BIUTL7",82,0)
 ..D:$G(BI("B")) PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BIUTL7",83,0)
 ..;
"RTN","BIUTL7",84,0)
 ..;---> Load Skin Test Result.
"RTN","BIUTL7",85,0)
 ..I $G(BI("L"))]"" D PUT^DDSVALF(3,,,$E(BI("L")),"I")
"RTN","BIUTL7",86,0)
 ..;
"RTN","BIUTL7",87,0)
 ..;---> Load Skin Test Reading.
"RTN","BIUTL7",88,0)
 ..I $G(BI("M"))'="" D PUT^DDSVALF(4,,,BI("M"),"I")
"RTN","BIUTL7",89,0)
 ..;
"RTN","BIUTL7",90,0)
 ..;---> Load Skin Test Date Read.
"RTN","BIUTL7",91,0)
 ..I $D(BI("N")) D PUT^DDSVALF(5,,,BI("N"),"E")
"RTN","BIUTL7",92,0)
 ..;
"RTN","BIUTL7",93,0)
 ..;---> If Reader already stored previously, load it.
"RTN","BIUTL7",94,0)
 ..I $G(BI("X")) D PUT^DDSVALF(10,,,BI("X"),"I")
"RTN","BIUTL7",95,0)
 ..;
"RTN","BIUTL7",96,0)
 ..;---> Load the Injection Site.
"RTN","BIUTL7",97,0)
 ..I $G(BI("T"))]"" D PUT^DDSVALF(2.4,,,BI("T"),"I")
"RTN","BIUTL7",98,0)
 ..;
"RTN","BIUTL7",99,0)
 ..;---> Load the Volume.
"RTN","BIUTL7",100,0)
 ..I $G(BI("W"))]"" D PUT^DDSVALF(2.8,,,BI("W"),"I")
"RTN","BIUTL7",101,0)
 .;
"RTN","BIUTL7",102,0)
 .;
"RTN","BIUTL7",103,0)
 .;---> If there is text for Other Location:
"RTN","BIUTL7",104,0)
 .D:$G(BI("G"))]""
"RTN","BIUTL7",105,0)
 ..;---> Set Location Type to Other.
"RTN","BIUTL7",106,0)
 ..D PUT^DDSVALF(6,,,"O","I")
"RTN","BIUTL7",107,0)
 ..;---> Make IHS Loc uneditable and null (ADD+12^BIVISIT will handle).
"RTN","BIUTL7",108,0)
 ..D UNED^DDSUTL(7,,,1),PUT^DDSVALF(7)
"RTN","BIUTL7",109,0)
 ..;---> Load Other Loc text and make editable.
"RTN","BIUTL7",110,0)
 ..D PUT^DDSVALF(8,,,BI("G")),UNED^DDSUTL(8,,,0)
"RTN","BIUTL7",111,0)
 ..;---> Make Other Loc required, IHS Loc not required.
"RTN","BIUTL7",112,0)
 ..D REQ^DDSUTL(8,,,1),REQ^DDSUTL(7,,,0)
"RTN","BIUTL7",113,0)
 .;
"RTN","BIUTL7",114,0)
 .;---> If Other Loc is null and IHS Loc is set, load it.
"RTN","BIUTL7",115,0)
 .I $G(BI("G"))="" I $G(BI("F")) D
"RTN","BIUTL7",116,0)
 ..D PUT^DDSVALF(7,,,BI("F"),"I")
"RTN","BIUTL7",117,0)
 .;
"RTN","BIUTL7",118,0)
 .;---> Load Category.
"RTN","BIUTL7",119,0)
 .I $G(BI("I"))]"" D PUT^DDSVALF(11,,,BI("I"),"I")
"RTN","BIUTL7",120,0)
 ;
"RTN","BIUTL7",121,0)
 ;---> Load default date.
"RTN","BIUTL7",122,0)
 D
"RTN","BIUTL7",123,0)
 .N X S X=$G(BI("E"))
"RTN","BIUTL7",124,0)
 .Q:X=""
"RTN","BIUTL7",125,0)
 .S:X[" @12:00" X=$P(X," @")
"RTN","BIUTL7",126,0)
 .D PUT^DDSVALF(1,,,X,"E")
"RTN","BIUTL7",127,0)
 ;
"RTN","BIUTL7",128,0)
 ;---> Load default site.
"RTN","BIUTL7",129,0)
 D DEFSITE^BIUTL4
"RTN","BIUTL7",130,0)
 S BI("F")=$$GET^DDSVALF(7),BI("I")=$$GET^DDSVALF(11)
"RTN","BIUTL7",131,0)
 ;
"RTN","BIUTL7",132,0)
 ;---> If this is an Immunization, load VFC Eligibility and Local Text.
"RTN","BIUTL7",133,0)
 I BIVTYPE="I",$G(BI("P"))]"" D PUT^DDSVALF(10.5,,,BI("P"),"I"),ELIGLAB^BIUTL8(BI("P"))
"RTN","BIUTL7",134,0)
 ;
"RTN","BIUTL7",135,0)
 ;---> If Provider already stored previously, load it and quit.
"RTN","BIUTL7",136,0)
 I $G(BI("R")) D PUT^DDSVALF(9,,,BI("R"),"I") Q
"RTN","BIUTL7",137,0)
 ;
"RTN","BIUTL7",138,0)
 ;---> If this is a new Skin Test, load default volume of .1 ml.
"RTN","BIUTL7",139,0)
 I BIVTYPE="S",'$G(BI("K")) S BI("W")=.1 D PUT^DDSVALF(2.8,,,BI("W"),"I")
"RTN","BIUTL7",140,0)
 ;
"RTN","BIUTL7",141,0)
 ;---> If this is a new Visit, and if Site Parameter is yes, and
"RTN","BIUTL7",142,0)
 ;---> if the User is a provider, then load User as default Provider.
"RTN","BIUTL7",143,0)
 I '$G(BI("K")),$$DEFPROV^BIUTL6($G(DUZ(2))) D
"RTN","BIUTL7",144,0)
 .I $D(^XUSEC("PROVIDER",DUZ)) D
"RTN","BIUTL7",145,0)
 ..;
"RTN","BIUTL7",146,0)
 ..;---> Same as NOPROV (see below).
"RTN","BIUTL7",147,0)
 ..Q:('$G(BI("K"))&($G(BI("I"))="E"))
"RTN","BIUTL7",148,0)
 ..;
"RTN","BIUTL7",149,0)
 ..;---> To set default provider into local BI array, even if the
"RTN","BIUTL7",150,0)
 ..;---> user doesn't <return> past the provider field on the screen.
"RTN","BIUTL7",151,0)
 ..D PUT^DDSVALF(9,,,$G(DUZ),"I") S BI("R")=$G(DUZ)
"RTN","BIUTL7",152,0)
 ;
"RTN","BIUTL7",153,0)
 Q
"RTN","BIUTL7",154,0)
 ;
"RTN","BIUTL7",155,0)
 ;
"RTN","BIUTL7",156,0)
 ;----------
"RTN","BIUTL7",157,0)
NOPROV(X) ;EP
"RTN","BIUTL7",158,0)
 ;---> Called by Post Action field of Field 11 on BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL7",159,0)
 ;---> and BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL7",160,0)
 ;---> If adding a new immunization and user changes Category to
"RTN","BIUTL7",161,0)
 ;---> "E" (Hist Event), then remove default user/provider from Field 9.
"RTN","BIUTL7",162,0)
 ;---> Parameters:
"RTN","BIUTL7",163,0)
 ;     1 - X  Value of Field 11, Category (A, E or I).
"RTN","BIUTL7",164,0)
 I X="E" I '$G(BI("K")) D PUT^DDSVALF(9,,,"") S BI("R")=""
"RTN","BIUTL7",165,0)
 Q
"RTN","BIUTL7",166,0)
 ;
"RTN","BIUTL7",167,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL7",168,0)
 ;---> Next 4 calls moved to BIUTL9 for space (<15000k).
"RTN","BIUTL7",169,0)
 ;
"RTN","BIUTL7",170,0)
 ;----------
"RTN","BIUTL7",171,0)
REASCHK ;EP
"RTN","BIUTL7",172,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",173,0)
 D REASCHK^BIUTL9
"RTN","BIUTL7",174,0)
 Q
"RTN","BIUTL7",175,0)
 ;
"RTN","BIUTL7",176,0)
 ;
"RTN","BIUTL7",177,0)
 ;----------
"RTN","BIUTL7",178,0)
READCHK ;EP
"RTN","BIUTL7",179,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",180,0)
 D READCHK^BIUTL9
"RTN","BIUTL7",181,0)
 Q
"RTN","BIUTL7",182,0)
 ;
"RTN","BIUTL7",183,0)
 ;
"RTN","BIUTL7",184,0)
 ;----------
"RTN","BIUTL7",185,0)
READCH6 ;EP
"RTN","BIUTL7",186,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",187,0)
 D READCH6^BIUTL9
"RTN","BIUTL7",188,0)
 Q
"RTN","BIUTL7",189,0)
 ;
"RTN","BIUTL7",190,0)
 ;
"RTN","BIUTL7",191,0)
 ;----------
"RTN","BIUTL7",192,0)
CREASCHK ;EP
"RTN","BIUTL7",193,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",194,0)
 D CREASCHK^BIUTL9
"RTN","BIUTL7",195,0)
 Q
"RTN","BIUTL7",196,0)
 ;**********
"RTN","BIUTL7",197,0)
 ;
"RTN","BIUTL7",198,0)
 ;
"RTN","BIUTL7",199,0)
 ;----------
"RTN","BIUTL7",200,0)
LOTDAT(X) ;EP
"RTN","BIUTL7",201,0)
 ;---> Called by Post Action field of Field 3 on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL7",202,0)
 ;---> Display Lot Exp Date and Remaining Balance (if tracked).
"RTN","BIUTL7",203,0)
 ;---> Parameters:
"RTN","BIUTL7",204,0)
 ;     1 - X (req) IEN of Lot Number in ^AUTTIML.
"RTN","BIUTL7",205,0)
 ;
"RTN","BIUTL7",206,0)
 Q:'$G(X)
"RTN","BIUTL7",207,0)
 D PUT^DDSVALF(3.4,,," Exp Date: "_$$LOTEXP^BIRPC3(X,1))
"RTN","BIUTL7",208,0)
 D PUT^DDSVALF(3.5,,,"Remaining: "_$$LOTRBAL^BIRPC3(X))
"RTN","BIUTL7",209,0)
 Q
"RTN","BIUTL7",210,0)
 ;
"RTN","BIUTL7",211,0)
 ;
"RTN","BIUTL7",212,0)
 ;----------
"RTN","BIUTL7",213,0)
LOTWARN(BILIEN,BIVDATE,BILOC) ;EP
"RTN","BIUTL7",214,0)
 ;---> Called by Branching Logic field of Field 3 on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL7",215,0)
 ;---> Display Lot Exp Date and Remaining Balance (if tracked).
"RTN","BIUTL7",216,0)
 ;---> Parameters:
"RTN","BIUTL7",217,0)
 ;     1 - BILIEN  (req) IEN of Lot Number in ^AUTTIML.
"RTN","BIUTL7",218,0)
 ;     2 - BIVDATE (req) Date of Imm Visit.
"RTN","BIUTL7",219,0)
 ;     3 - BILOC   (req) Location of Encounter.
"RTN","BIUTL7",220,0)
 ;
"RTN","BIUTL7",221,0)
 Q:'$G(BILIEN)  Q:'$D(^AUTTIML(BILIEN,0))
"RTN","BIUTL7",222,0)
 N BIEXP,BILOW S (BIEXP,BILOW)=0
"RTN","BIUTL7",223,0)
 ;
"RTN","BIUTL7",224,0)
 D
"RTN","BIUTL7",225,0)
 .N X S X=$$LOTRBAL^BIRPC3(BILIEN)
"RTN","BIUTL7",226,0)
 .;---> Do not alert if this Lot is not tracked.   vvv83
"RTN","BIUTL7",227,0)
 .Q:(X="Not tracked")
"RTN","BIUTL7",228,0)
 .I X<$$LOTLOW^BIUTL2(BILIEN,BILOC) S BILOW=1
"RTN","BIUTL7",229,0)
 ;
"RTN","BIUTL7",230,0)
 D
"RTN","BIUTL7",231,0)
 .N X S X=$$LOTEXP^BIRPC3(BILIEN,2)
"RTN","BIUTL7",232,0)
 .;---> Do not warn if this Lot has no expiration date.
"RTN","BIUTL7",233,0)
 .Q:('X)
"RTN","BIUTL7",234,0)
 .I BIVDATE>X S BIEXP=1
"RTN","BIUTL7",235,0)
 ;
"RTN","BIUTL7",236,0)
 I (BILOW&BIEXP) S DDSSTACK="BI PAGE-EXPIRED AND LOW" Q
"RTN","BIUTL7",237,0)
 I BILOW S DDSSTACK="BI PAGE-LOW SUPPLY ALERT"
"RTN","BIUTL7",238,0)
 I BIEXP S DDSSTACK="BI PAGE-LOT EXPIRED"
"RTN","BIUTL7",239,0)
 Q
"RTN","BIUTL7",240,0)
 ;
"RTN","BIUTL7",241,0)
 ;
"RTN","BIUTL7",242,0)
 ;----------
"RTN","BIUTL7",243,0)
VSHORT(X) ;EP
"RTN","BIUTL7",244,0)
 ;---> Called by LOADVIS above and by Post Action field of Field 2
"RTN","BIUTL7",245,0)
 ;---> on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL7",246,0)
 ;---> Display Short Name below Vaccine Name if different.
"RTN","BIUTL7",247,0)
 ;---> Parameters:
"RTN","BIUTL7",248,0)
 ;     1 - X (req) IEN of Vaccine in ^AUTTIMM.
"RTN","BIUTL7",249,0)
 ;
"RTN","BIUTL7",250,0)
 Q:'$G(X)  Q:($$VNAME^BIUTL2(X)=$$VNAME^BIUTL2(X,1))
"RTN","BIUTL7",251,0)
 D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(X)_")")
"RTN","BIUTL7",252,0)
 Q
"RTN","BIUTL7",253,0)
 ;
"RTN","BIUTL7",254,0)
 ;
"RTN","BIUTL7",255,0)
 ;----------
"RTN","BIUTL7",256,0)
SAVISIT(BIVTYPE,BI) ;EP
"RTN","BIUTL7",257,0)
 ;---> Called by BIPATVW2 to save data after exiting Screenman Forms
"RTN","BIUTL7",258,0)
 ;---> BI FORM-IMM VISIT ADD/EDIT and BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL7",259,0)
 ;---> Parameters:
"RTN","BIUTL7",260,0)
 ;     1 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIUTL7",261,0)
 ;     2 - BI      (req) Local array of data elements for this visit.
"RTN","BIUTL7",262,0)
 ;
"RTN","BIUTL7",263,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL7",264,0)
 ;
"RTN","BIUTL7",265,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIUTL7",266,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIUTL7",267,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D ERRCD^BIUTL2(410,,1) Q
"RTN","BIUTL7",268,0)
 ;
"RTN","BIUTL7",269,0)
 N A,B,BIDATA,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,V,W,X,Y,Z,EE,QQ S V="|"
"RTN","BIUTL7",270,0)
 ;
"RTN","BIUTL7",271,0)
 S A=$G(BI("A"))      ;Patient DFN.
"RTN","BIUTL7",272,0)
 S B=$G(BI("B"))      ;Vaccine or Skin Test IEN.
"RTN","BIUTL7",273,0)
 S C=$G(BI("C"))      ;Dose Override.
"RTN","BIUTL7",274,0)
 S D=$G(BI("D"))      ;Lot Number IEN.
"RTN","BIUTL7",275,0)
 S E=$G(BI("E"))      ;Date of Visit.
"RTN","BIUTL7",276,0)
 S F=$G(BI("F"))      ;Location of Encounter IEN.
"RTN","BIUTL7",277,0)
 S G=$G(BI("G"))      ;Other Location of Encounter Text.
"RTN","BIUTL7",278,0)
 S H=$G(BI("H"))      ;NDC Code Pointer.
"RTN","BIUTL7",279,0)
 S I=$G(BI("I"))      ;Catgegory of Visit (A,E,I).
"RTN","BIUTL7",280,0)
 S J=$G(BI("J"))      ;Visit IEN
"RTN","BIUTL7",281,0)
 S K=$G(BI("K"))      ;Old Visit IEN (for edits).
"RTN","BIUTL7",282,0)
 S L=$G(BI("L"))      ;Skin Test Result.
"RTN","BIUTL7",283,0)
 S M=$G(BI("M"))      ;Skin Test Reading (mm).
"RTN","BIUTL7",284,0)
 S N=$G(BI("N"))      ;Skin Test Date Read.
"RTN","BIUTL7",285,0)
 S O=$G(BI("O"))      ;Immunization Reaction
"RTN","BIUTL7",286,0)
 S P=$G(BI("P"))      ;VFC Elilgibility
"RTN","BIUTL7",287,0)
 S Q=$G(BI("Q"))      ;Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIUTL7",288,0)
 S R=$G(BI("R"))      ;IEN of Provider of Imm/Skin Test.
"RTN","BIUTL7",289,0)
 S S=$G(BI("S"))      ;Dose Override.
"RTN","BIUTL7",290,0)
 S T=$G(BI("T"))      ;Injection Site.
"RTN","BIUTL7",291,0)
 S W=$G(BI("W"))      ;Volume.
"RTN","BIUTL7",292,0)
 S X=$G(BI("X"))      ;IEN of Reader (Provider) of Skin Test.
"RTN","BIUTL7",293,0)
 S Z=$G(BI("Z"))      ;DUZ(2) for Site Parameters.
"RTN","BIUTL7",294,0)
 S Y=$G(BI("Y"))      ;If Y=1, this was a previously imported Imm;
"RTN","BIUTL7",295,0)
 ;                     now it needs to =2 ("Imported (edited)").
"RTN","BIUTL7",296,0)
 ;
"RTN","BIUTL7",297,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL7",298,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIUTL7",299,0)
 S EE=$G(BI("EE"))     ;Admin Date (Date shot admin'd to patient.
"RTN","BIUTL7",300,0)
 S QQ=$G(BI("QQ"))     ;Date VIS Presented to Patient.
"RTN","BIUTL7",301,0)
 ;
"RTN","BIUTL7",302,0)
 ;
"RTN","BIUTL7",303,0)
 ;---> Check Site IEN for parameters.
"RTN","BIUTL7",304,0)
 S:'$G(Z) Z=$G(DUZ(2))
"RTN","BIUTL7",305,0)
 I '$G(Z) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIUTL7",306,0)
 ;---> Piece:       2   3   4   5   6   7   8   9   10  11
"RTN","BIUTL7",307,0)
 S BIDATA=BIVTYPE_V_A_V_B_V_C_V_D_V_E_V_F_V_G_V_I_V_J_V_K
"RTN","BIUTL7",308,0)
 ;---> NOTE: Y will be pc 25 (not 24) because BIRPC6 feeds CPT Import to pc 24.
"RTN","BIUTL7",309,0)
 ;---> Add pieces 27-29.
"RTN","BIUTL7",310,0)
 ;---> Piece:     12  13  14  15  16  17  18  19  20  21  22  23 24 25  26 27  28   29
"RTN","BIUTL7",311,0)
 S BIDATA=BIDATA_V_L_V_M_V_N_V_O_V_P_V_Q_V_R_V_S_V_T_V_W_V_X_V_Z_V_V_Y_V_H_V_V_EE_V_QQ
"RTN","BIUTL7",312,0)
 ;
"RTN","BIUTL7",313,0)
 ;**********
"RTN","BIUTL7",314,0)
 ;
"RTN","BIUTL7",315,0)
 ;---> Call RPC to save visit to PCC Files.
"RTN","BIUTL7",316,0)
 D ADDEDIT^BIRPC3(.BIERR,BIDATA)
"RTN","BIUTL7",317,0)
 ;
"RTN","BIUTL7",318,0)
 ;---> If an error is passed back, display it.
"RTN","BIUTL7",319,0)
 S BIERR=$P(BIERR,BI31,2)
"RTN","BIUTL7",320,0)
 D:BIERR]""
"RTN","BIUTL7",321,0)
 .W !!," * ",BIERR,!?3,"NO Changes made! (Visit NOT added/edited.)"
"RTN","BIUTL7",322,0)
 .D DIRZ^BIUTL3()
"RTN","BIUTL7",323,0)
 ;
"RTN","BIUTL7",324,0)
 Q
"RTN","BIUTL7",325,0)
 ;
"RTN","BIUTL7",326,0)
 ;
"RTN","BIUTL7",327,0)
 ;----------
"RTN","BIUTL7",328,0)
SAVCONTR(BI,BIERR) ;EP
"RTN","BIUTL7",329,0)
 ;---> Called by BIPATCO2 to save data after exiting Screenman Form
"RTN","BIUTL7",330,0)
 ;---> BI FORM-CONTRAINDICATION ADD/EDIT.
"RTN","BIUTL7",331,0)
 ;---> Parameters:
"RTN","BIUTL7",332,0)
 ;     1 - BI    (req) Local array of data elements for this contra.
"RTN","BIUTL7",333,0)
 ;     1 - BIERR (ret) Text of Error Code if any, otherwise null.
"RTN","BIUTL7",334,0)
 ;
"RTN","BIUTL7",335,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL7",336,0)
 N A,B,C,D,N,V S V="|"
"RTN","BIUTL7",337,0)
 ;
"RTN","BIUTL7",338,0)
 S A=$G(BI("A"))      ;Patient DFN.
"RTN","BIUTL7",339,0)
 S B=$G(BI("B"))      ;Vaccine IEN (^AUTTIMM).
"RTN","BIUTL7",340,0)
 S C=$G(BI("C"))      ;Contra Reason IEN (^BICONT).
"RTN","BIUTL7",341,0)
 S D=$G(BI("D"))      ;Date Noted.
"RTN","BIUTL7",342,0)
 S N=$G(BI("N"))      ;If this was an Edit, N=1 (otherwise null/0).
"RTN","BIUTL7",343,0)
 ;
"RTN","BIUTL7",344,0)
 D ADDCONT^BIRPC4(.BIERR,A_V_B_V_C_V_D_V_N)
"RTN","BIUTL7",345,0)
 ;
"RTN","BIUTL7",346,0)
 ;---> If an error is passed back, display it.
"RTN","BIUTL7",347,0)
 S BIERR=$P(BIERR,BI31,2)
"RTN","BIUTL7",348,0)
 D:BIERR]""
"RTN","BIUTL7",349,0)
 .W !!," * ",BIERR,!?3,"Contraindication NOT added!" D DIRZ^BIUTL3()
"RTN","BIUTL7",350,0)
 ;
"RTN","BIUTL7",351,0)
 Q
"RTN","BIUTL7",352,0)
 ;
"RTN","BIUTL7",353,0)
 ;
"RTN","BIUTL7",354,0)
 ;----------
"RTN","BIUTL7",355,0)
LDCONTR ;EP
"RTN","BIUTL7",356,0)
 ;---> Code to load Contraindication data for ScreenMan Edit form.
"RTN","BIUTL7",357,0)
 ;---> Called by Pre Action of Block BI BLK-CONTRAINDICATION ADD
"RTN","BIUTL7",358,0)
 ;---> of Form BI FORM-CONTRAIND ADD/EDIT
"RTN","BIUTL7",359,0)
 ;
"RTN","BIUTL7",360,0)
 ;
"RTN","BIUTL7",361,0)
 Q:'$G(BIDFN)
"RTN","BIUTL7",362,0)
 Q:'$G(BI("N"))
"RTN","BIUTL7",363,0)
 ;
"RTN","BIUTL7",364,0)
 ;---> Load Vaccine Name.
"RTN","BIUTL7",365,0)
 I $G(BI("B"))]"" D PUT^DDSVALF(1,,,BI("B"),"I")
"RTN","BIUTL7",366,0)
 ;
"RTN","BIUTL7",367,0)
 ;---> Make Vaccine Name uneditable.
"RTN","BIUTL7",368,0)
 D UNED^DDSUTL(1,,,1)
"RTN","BIUTL7",369,0)
 ;
"RTN","BIUTL7",370,0)
 ;---> Load Reaspm.
"RTN","BIUTL7",371,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(4,,,BI("C"),"E")
"RTN","BIUTL7",372,0)
 ;
"RTN","BIUTL7",373,0)
 ;---> Load Date.
"RTN","BIUTL7",374,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(5,,,BI("D"),"E")
"RTN","BIUTL7",375,0)
 ;
"RTN","BIUTL7",376,0)
 Q
"RTN","BIUTL7",377,0)
 ;
"RTN","BIUTL7",378,0)
 ;
"RTN","BIUTL7",379,0)
 ;----------
"RTN","BIUTL7",380,0)
LOADCAS ;EP
"RTN","BIUTL7",381,0)
 ;---> Code to load Case Data for a patient for ScreenMan Edit form.
"RTN","BIUTL7",382,0)
 ;---> Called by Pre Action of Block BI BLK-CASE DATE EDIT on
"RTN","BIUTL7",383,0)
 ;---> Form BI FORM-CASE DATA EDIT.
"RTN","BIUTL7",384,0)
 ;
"RTN","BIUTL7",385,0)
 Q:'$G(BIDFN)
"RTN","BIUTL7",386,0)
 ;
"RTN","BIUTL7",387,0)
 ;---> Load Patient's Case Manager or default Case Manager.
"RTN","BIUTL7",388,0)
 D
"RTN","BIUTL7",389,0)
 .I $G(BI("B"))]"" D PUT^DDSVALF(1,,,BI("B"),"E") Q
"RTN","BIUTL7",390,0)
 .Q:'$G(DUZ(2))
"RTN","BIUTL7",391,0)
 .N BIX S BIX=$$CMGRDEF^BIUTL2(DUZ(2))
"RTN","BIUTL7",392,0)
 .D:BIX PUT^DDSVALF(1,,,BIX,"I")
"RTN","BIUTL7",393,0)
 ;
"RTN","BIUTL7",394,0)
 ;---> Load Parent/Guardian.
"RTN","BIUTL7",395,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(2,,,BI("C"),"E")
"RTN","BIUTL7",396,0)
 ;
"RTN","BIUTL7",397,0)
 ;---> Load Mother's HBsAG Status.
"RTN","BIUTL7",398,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(7,,,BI("D"),"I")
"RTN","BIUTL7",399,0)
 ;
"RTN","BIUTL7",400,0)
 ;---> Load Date Patient became Inactive.
"RTN","BIUTL7",401,0)
 I $G(BI("E"))]"" D PUT^DDSVALF(4,,,BI("E"),"E")
"RTN","BIUTL7",402,0)
 ;
"RTN","BIUTL7",403,0)
 ;---> Load Reason for Inactive.
"RTN","BIUTL7",404,0)
 I $G(BI("F"))]"" D PUT^DDSVALF(5,,,BI("F"),"I")
"RTN","BIUTL7",405,0)
 ;
"RTN","BIUTL7",406,0)
 ;---> Load Other Info.
"RTN","BIUTL7",407,0)
 I $G(BI("G"))]"" D PUT^DDSVALF(3,,,BI("G"),"E")
"RTN","BIUTL7",408,0)
 ;
"RTN","BIUTL7",409,0)
 ;---> Load Forecast Influ/Pneumo.
"RTN","BIUTL7",410,0)
 I $G(BI("H"))]"" D PUT^DDSVALF(6,,,BI("H"),"I")
"RTN","BIUTL7",411,0)
 ;
"RTN","BIUTL7",412,0)
 ;---> Load Moved to/Tx Elsewhere.
"RTN","BIUTL7",413,0)
 I $G(BI("I"))]"" D PUT^DDSVALF(5.5,,,BI("I"),"E")
"RTN","BIUTL7",414,0)
 ;
"RTN","BIUTL7",415,0)
 ;---> Load Consent State Registry.
"RTN","BIUTL7",416,0)
 I $G(BI("K"))]"" D PUT^DDSVALF(8,,,BI("K"),"E")
"RTN","BIUTL7",417,0)
 Q
"RTN","BIUTL7",418,0)
 ;
"RTN","BIUTL7",419,0)
 ;
"RTN","BIUTL7",420,0)
 ;----------
"RTN","BIUTL7",421,0)
SAVCAS ;EP
"RTN","BIUTL7",422,0)
 ;---> Code to save Case Data exiting from Screenman.
"RTN","BIUTL7",423,0)
 ;---> Called by Post Save Action of Form BI FORM-CASE DATA EDIT.
"RTN","BIUTL7",424,0)
 ;
"RTN","BIUTL7",425,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL7",426,0)
 N A,B,C,D,DATA,E,F,G,H,I,J,K,U S U="^"
"RTN","BIUTL7",427,0)
 ;
"RTN","BIUTL7",428,0)
 S A=$G(BI("A"))      ;Patient DFN.
"RTN","BIUTL7",429,0)
 S B=$G(BI("B"))      ;Case Manager's name, text.
"RTN","BIUTL7",430,0)
 S C=$G(BI("C"))      ;Parent or Guardian, text.
"RTN","BIUTL7",431,0)
 S D=$G(BI("D"))      ;Mother's HBsAG Status (P,N,A,U).
"RTN","BIUTL7",432,0)
 S E=$G(BI("E"))      ;Date Pat became Inactive (ext format).
"RTN","BIUTL7",433,0)
 S F=$G(BI("F"))      ;Reason for Inactive.
"RTN","BIUTL7",434,0)
 S G=$G(BI("G"))      ;Other Info.
"RTN","BIUTL7",435,0)
 S H=$G(BI("H"))      ;Forecast Influ/Pneumo.
"RTN","BIUTL7",436,0)
 S I=$G(BI("I"))      ;Location Moved or Tx Elsewhere.
"RTN","BIUTL7",437,0)
 S K=$G(BI("K"))      ;State Registry Consent.
"RTN","BIUTL7",438,0)
 ;
"RTN","BIUTL7",439,0)
 I E]"" S J=$G(DUZ)   ;IEN of User who Inactivated this patient.
"RTN","BIUTL7",440,0)
 ;
"RTN","BIUTL7",441,0)
 S DATA=A_U_B_U_C_U_D_U_E_U_F_U_G_U_H_U_I_U_$G(J)_U_K
"RTN","BIUTL7",442,0)
 ;
"RTN","BIUTL7",443,0)
 ;---> Store edits to database.
"RTN","BIUTL7",444,0)
 D EDITCAS^BIRPC4(.BIERR,DATA)
"RTN","BIUTL7",445,0)
 ;
"RTN","BIUTL7",446,0)
 ;---> If an error is passed back, display it.
"RTN","BIUTL7",447,0)
 S BIERR=$P(BIERR,BI31,2)
"RTN","BIUTL7",448,0)
 D:BIERR]""
"RTN","BIUTL7",449,0)
 .W !!," * ",BIERR,!?3,"Edits to Patient Case Data not saved!"
"RTN","BIUTL7",450,0)
 .D DIRZ^BIUTL3()
"RTN","BIUTL7",451,0)
 ;
"RTN","BIUTL7",452,0)
 Q
"RTN","BIUTL8")
0^157^B65044050
"RTN","BIUTL8",1,0)
BIUTL8 ;IHS/CMI/MWR - UTIL: PATLKUP, PRTLST, ZGBL; MAY 10, 2010
"RTN","BIUTL8",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIUTL8",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL8",4,0)
 ;;  UTILITY: PATIENT LOOKUP, DUPTEST, PRINT LIST, K/ZGBL, KILLALL.
"RTN","BIUTL8",5,0)
 ;;           HFSPATH, IMMSVDIR.
"RTN","BIUTL8",6,0)
 ;;  PATCH 2: Correct 19yrs and older logic.  VFCSET+7
"RTN","BIUTL8",7,0)
 ;;  PATCH 3: Display Elig Code Local Text.  ELIGLAB+0
"RTN","BIUTL8",8,0)
 ;;  PATCH 8: Problem Dose changes to accommodate new forecaster.  PDSS+11
"RTN","BIUTL8",9,0)
 ;;  PATCH 9: Fix so that TAB key will not skip Eligibility.  ELIGLAB+10
"RTN","BIUTL8",10,0)
 ;;           Return the IP Address used for the TCH Forecaster.  IPTCH
"RTN","BIUTL8",11,0)
 ;;           Add default of V01 (Ineligible) for patients 19 and over.  VFCSET+14
"RTN","BIUTL8",12,0)
 ;
"RTN","BIUTL8",13,0)
 ;
"RTN","BIUTL8",14,0)
 ;----------
"RTN","BIUTL8",15,0)
PATLKUP(BIDFN,BIADD,DUZ2,BIPOP) ;EP
"RTN","BIUTL8",16,0)
 ;---> BI Patient Lookup.
"RTN","BIUTL8",17,0)
 ;---> Parameters:
"RTN","BIUTL8",18,0)
 ;     1 - BIDFN       (ret) Patient DFN or -1 if failed.
"RTN","BIUTL8",19,0)
 ;     2 - BIADD       (opt) ="ADD" If ADD capability during lookup.
"RTN","BIUTL8",20,0)
 ;     3 - DUZ2=DUZ(2) (opt) If not set, will=User's DUZ(2).
"RTN","BIUTL8",21,0)
 ;     4 - BIPOP       (ret) BIPOP=1 If DTOUT or DUOUT.
"RTN","BIUTL8",22,0)
 ;
"RTN","BIUTL8",23,0)
 ;---> Example: D PATLKUP^BIUTL8(.BIDFN)
"RTN","BIUTL8",24,0)
 ;              D PATLKUP^BIUTL8(.BIDFN,"ADD") - May ADD Patient to IMM
"RTN","BIUTL8",25,0)
 ;
"RTN","BIUTL8",26,0)
 N DFN,DIC,X,Y,DIRUT,DTOUT,DUOUT
"RTN","BIUTL8",27,0)
 S (BIDFN,BIPOP)=0 D SETVARS^BIUTL5
"RTN","BIUTL8",28,0)
 S:$G(DUZ2)]"" DUZ(2)=DUZ2
"RTN","BIUTL8",29,0)
 S DIC="^AUPNPAT(",DIC(0)="AEMQ"
"RTN","BIUTL8",30,0)
 S DIC("A")="   Select Patient Name or Chart#: "
"RTN","BIUTL8",31,0)
 D ^DIC
"RTN","BIUTL8",32,0)
 I $D(DUOUT)!($D(DTOUT)) S BIPOP=1 Q
"RTN","BIUTL8",33,0)
 S BIDFN=+Y
"RTN","BIUTL8",34,0)
 ;---> Lookup unsuccessful or aborted.
"RTN","BIUTL8",35,0)
 Q:Y<0
"RTN","BIUTL8",36,0)
 ;
"RTN","BIUTL8",37,0)
 ;---> If Patient does not exist in BI PATIENT File, add.
"RTN","BIUTL8",38,0)
 I '$D(^BIP(BIDFN,0)) D  Q
"RTN","BIUTL8",39,0)
 .;
"RTN","BIUTL8",40,0)
 .;---> If patient is deceased, add as Inactive, Deceased, and quit.
"RTN","BIUTL8",41,0)
 .I $$DECEASED^BIUTL1(BIDFN) D ADDPAT^BIPATE(BIDFN,DUZ(2),,$G(DT),"d") Q
"RTN","BIUTL8",42,0)
 .N BIERR
"RTN","BIUTL8",43,0)
 .;
"RTN","BIUTL8",44,0)
 .;---> If patient is over 18, or if user does not have BIZ EDIT PATIENTS Key,
"RTN","BIUTL8",45,0)
 .;---> then add as Inactive, "Never Activated," and quit.
"RTN","BIUTL8",46,0)
 .I ($$AGE^BIUTL1(BIDFN,1)>18)!($G(BIADD)'="ADD") D  Q
"RTN","BIUTL8",47,0)
 ..D ADDPAT^BIPATE(BIDFN,DUZ(2),.BIERR,$G(DT),"n")
"RTN","BIUTL8",48,0)
 ..I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIUTL8",49,0)
 .;
"RTN","BIUTL8",50,0)
 .;---> User may edit.
"RTN","BIUTL8",51,0)
 .W !!?3,$$NAME^BIUTL1(BIDFN)
"RTN","BIUTL8",52,0)
 .W " is being added to the Immunization Database",!,"for the first time."
"RTN","BIUTL8",53,0)
 .W !!?3,"Should this patient be added as Active or Inactive?"
"RTN","BIUTL8",54,0)
 .N DIR
"RTN","BIUTL8",55,0)
 .S DIR("?")="     Enter A for Active or I for Inactive."
"RTN","BIUTL8",56,0)
 .S DIR(0)="SM^A:Active;I:Inactive"
"RTN","BIUTL8",57,0)
 .S DIR("A")="   Enter A (Active) or I (Inactive)"
"RTN","BIUTL8",58,0)
 .S DIR("B")="A"
"RTN","BIUTL8",59,0)
 .;S DIR("B")=$S($$AGE^BIUTL1(BIDFN,1)<19:"A",1:"I")
"RTN","BIUTL8",60,0)
 .D ^DIR W !
"RTN","BIUTL8",61,0)
 .I $D(DIRUT) S BIPOP=1 Q
"RTN","BIUTL8",62,0)
 .N BINACT S BINACT=$S(Y="I":$G(DT),1:"")
"RTN","BIUTL8",63,0)
 .N BINACTR S BINACTR=$S(BINACT:"n",1:"")
"RTN","BIUTL8",64,0)
 .D ADDPAT^BIPATE(BIDFN,DUZ(2),.BIERR,BINACT,BINACTR)
"RTN","BIUTL8",65,0)
 .I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIUTL8",66,0)
 ;
"RTN","BIUTL8",67,0)
 ;
"RTN","BIUTL8",68,0)
 ;---> If this Patient is already in the Imm Database and <36 months
"RTN","BIUTL8",69,0)
 ;---> but is Inactive, query.
"RTN","BIUTL8",70,0)
 Q:$$AGE^BIUTL1(BIDFN,2,$G(DT))>35
"RTN","BIUTL8",71,0)
 ;Q:'$$INACT^BIUTL1(BIDFN)   ;vvv83
"RTN","BIUTL8",72,0)
 Q:($$INACT^BIUTL1(BIDFN)="")
"RTN","BIUTL8",73,0)
 Q:($G(BIADD)'="ADD")
"RTN","BIUTL8",74,0)
 ;
"RTN","BIUTL8",75,0)
 W !!?3,"This patient is less than 36 months old and ",$$SEX^BIUTL1(BIDFN,3)
"RTN","BIUTL8",76,0)
 W !?3,"Immunization Status is INACTIVE."
"RTN","BIUTL8",77,0)
 W !!?3,"Should this patient's Status be changed to ACTIVE?",!
"RTN","BIUTL8",78,0)
 N DIR
"RTN","BIUTL8",79,0)
 S DIR(0)="YA",DIR("A")="   Enter Yes or No: "
"RTN","BIUTL8",80,0)
 S DIR("?",1)="     Enter YES to change this patient's Status to Active."
"RTN","BIUTL8",81,0)
 S DIR("?")="     Enter No to leave it Inactive."
"RTN","BIUTL8",82,0)
 D ^DIR W !
"RTN","BIUTL8",83,0)
 D:Y=1
"RTN","BIUTL8",84,0)
 .N BIFLD,BIERR S BIFLD(.08)="",BIFLD(.16)=""
"RTN","BIUTL8",85,0)
 .D FDIE^BIFMAN(9002084,BIDFN,.BIFLD,.BIERR,1)
"RTN","BIUTL8",86,0)
 .I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIUTL8",87,0)
 Q
"RTN","BIUTL8",88,0)
 ;
"RTN","BIUTL8",89,0)
 ;
"RTN","BIUTL8",90,0)
 ;----------
"RTN","BIUTL8",91,0)
VFCSET ;EP
"RTN","BIUTL8",92,0)
 ;---> Load Vaccine Eligibility.  Called by LOADVIS^BIUTL7.
"RTN","BIUTL8",93,0)
 ;---> If Patient Ben Type is 01 (Am Indian/AK Native), set VFC default=4.
"RTN","BIUTL8",94,0)
 ;ZEXCEPT: BI,BIDFN
"RTN","BIUTL8",95,0)
 ;
"RTN","BIUTL8",96,0)
 Q:$G(BI("P"))]""
"RTN","BIUTL8",97,0)
 Q:'$G(BIDFN)
"RTN","BIUTL8",98,0)
 Q:$$BENTYP^BIUTL11(BIDFN,2)'="01"
"RTN","BIUTL8",99,0)
 ;
"RTN","BIUTL8",100,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BIUTL8",101,0)
 ;--->Correct 19yrs and older logic.
"RTN","BIUTL8",102,0)
 N BIDATE,X,Y S X=$P($G(BI("E"))," ")
"RTN","BIUTL8",103,0)
 D ^%DT S BIDATE=Y
"RTN","BIUTL8",104,0)
 Q:'BIDATE
"RTN","BIUTL8",105,0)
 ;
"RTN","BIUTL8",106,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL8",107,0)
 ;---> Add default of V01 (Ineligible) for patients 19 and over.
"RTN","BIUTL8",108,0)
 ;
"RTN","BIUTL8",109,0)
 ;--> If patient was less than 19yrs set default=V01 and quit.
"RTN","BIUTL8",110,0)
 ;Q:($$AGE^BIUTL1(BIDFN,1,BIDATE)>18)
"RTN","BIUTL8",111,0)
 I ($$AGE^BIUTL1(BIDFN,1,BIDATE)<19) S BI("P")=4 Q
"RTN","BIUTL8",112,0)
 ;---> Otherwise patient is adult, set default="V01".
"RTN","BIUTL8",113,0)
 S BI("P")=1
"RTN","BIUTL8",114,0)
 ;
"RTN","BIUTL8",115,0)
 ;********** 9/2012: CHANGE HERE TO MAKE DEFAULT CONDITIONAL UPON ACTIVE STATUS.
"RTN","BIUTL8",116,0)
 Q
"RTN","BIUTL8",117,0)
 ;
"RTN","BIUTL8",118,0)
 ;
"RTN","BIUTL8",119,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIUTL8",120,0)
 ;---> Display Elig Code Label Text.
"RTN","BIUTL8",121,0)
 ;----------
"RTN","BIUTL8",122,0)
ELIGLAB(X) ;EP
"RTN","BIUTL8",123,0)
 ;---> Called by Post Action field of Field 10.5 on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL8",124,0)
 ;---> Display Elibigility Code Local Text besind Elig Code.
"RTN","BIUTL8",125,0)
 ;---> Parameters:
"RTN","BIUTL8",126,0)
 ;     1 - X (req) IEN of Elig Code in ^BIELIG.
"RTN","BIUTL8",127,0)
 ;
"RTN","BIUTL8",128,0)
 Q:'$G(X)
"RTN","BIUTL8",129,0)
 N Y S Y=$G(^BIELIG(+X,0))
"RTN","BIUTL8",130,0)
 Q:(Y="")
"RTN","BIUTL8",131,0)
 ;
"RTN","BIUTL8",132,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL8",133,0)
 ;---> Fix so that TAB key will not skip Eligibility.
"RTN","BIUTL8",134,0)
 ;D PUT^DDSVALF(10.6,,,$P(Y,U)_" - "_$P(Y,U,4))
"RTN","BIUTL8",135,0)
 D PUT^DDSVALF(10.6,,," - "_$P(Y,U,4))
"RTN","BIUTL8",136,0)
 Q
"RTN","BIUTL8",137,0)
 ;**********
"RTN","BIUTL8",138,0)
 ;
"RTN","BIUTL8",139,0)
 ;----------
"RTN","BIUTL8",140,0)
DUPTEST(BIERR,BIDATA,BIOIEN) ;EP
"RTN","BIUTL8",141,0)
 ;---> Test to be sure a duplicate Immunization  or Skin Test
"RTN","BIUTL8",142,0)
 ;---> is not being added.
"RTN","BIUTL8",143,0)
 ;---> Parameters:
"RTN","BIUTL8",144,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIUTL8",145,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIUTL8",146,0)
 ;     3 - BIOIEN (opt) IEN of V IMM or V SKIN being edited (if
"RTN","BIUTL8",147,0)
 ;                      not new).
"RTN","BIUTL8",148,0)
 ;
"RTN","BIUTL8",149,0)
 ;---> Pieces of BIDATA:
"RTN","BIUTL8",150,0)
 ;     -----------------
"RTN","BIUTL8",151,0)
 ;     1 - A  (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIUTL8",152,0)
 ;     2 - B  (req) DFN of patient.
"RTN","BIUTL8",153,0)
 ;     3 - C  (req) Vaccine or Skin Test .01 pointer.
"RTN","BIUTL8",154,0)
 ;     6 - D  (req) Date of Visit.
"RTN","BIUTL8",155,0)
 ;
"RTN","BIUTL8",156,0)
 N A,B,BI31,C,D,V,X S BI31=$C(31)_$C(31),V="|",X=""
"RTN","BIUTL8",157,0)
 S A=$P(BIDATA,V,1)
"RTN","BIUTL8",158,0)
 S B=$P(BIDATA,V,2) Q:'B
"RTN","BIUTL8",159,0)
 S C=$P(BIDATA,V,3) Q:'C
"RTN","BIUTL8",160,0)
 S D=9999999-$P($P(BIDATA,V,6),".") Q:'D
"RTN","BIUTL8",161,0)
 ;
"RTN","BIUTL8",162,0)
 ;---> Check for duplicate visit.
"RTN","BIUTL8",163,0)
 D
"RTN","BIUTL8",164,0)
 .;---> If this is a new Immunization or Skin Test,
"RTN","BIUTL8",165,0)
 .;---> and there exists a duplicate, report the error.
"RTN","BIUTL8",166,0)
 .I '$G(BIOIEN),A="I",$D(^AUPNVIMM("AA",B,C,D)) S X=423 Q
"RTN","BIUTL8",167,0)
 .I '$G(BIOIEN),A="S",$D(^AUPNVSK("AA",B,C,D)) S X=424 Q
"RTN","BIUTL8",168,0)
 .;
"RTN","BIUTL8",169,0)
 .;---> If the existing xref is not that of the edited visit,
"RTN","BIUTL8",170,0)
 .;---> and there exists a duplicate, report the error.
"RTN","BIUTL8",171,0)
 .;---> For an Immunization.
"RTN","BIUTL8",172,0)
 .I A="I" D  Q
"RTN","BIUTL8",173,0)
 ..N N S N=0
"RTN","BIUTL8",174,0)
 ..F  S N=$O(^AUPNVIMM("AA",B,C,D,N)) Q:'N  I N,N'=BIOIEN S X=423
"RTN","BIUTL8",175,0)
 .;
"RTN","BIUTL8",176,0)
 .;---> For a Skin Test.
"RTN","BIUTL8",177,0)
 .I A="S" D  Q
"RTN","BIUTL8",178,0)
 ..N N S N=0
"RTN","BIUTL8",179,0)
 ..F  S N=$O(^AUPNVSK("AA",B,C,D,N)) Q:'N  I N,N'=BIOIEN S X=424
"RTN","BIUTL8",180,0)
 ;
"RTN","BIUTL8",181,0)
 I X D ERRCD^BIUTL2(X,.BIERR) S BIERR=BI31_BIERR
"RTN","BIUTL8",182,0)
 Q
"RTN","BIUTL8",183,0)
 ;
"RTN","BIUTL8",184,0)
 ;
"RTN","BIUTL8",185,0)
 ;----------
"RTN","BIUTL8",186,0)
PRTLST(BITNOD) ;EP
"RTN","BIUTL8",187,0)
 ;---> Print Listman list instead of displaying it.
"RTN","BIUTL8",188,0)
 ;---> Parameters:
"RTN","BIUTL8",189,0)
 ;     1 - BITNOD (req) Node in ^TMP global where list is stored.
"RTN","BIUTL8",190,0)
 ;
"RTN","BIUTL8",191,0)
 ;---> Variables:
"RTN","BIUTL8",192,0)
 ;     1 - VALMHDR (req) Array containing header code.
"RTN","BIUTL8",193,0)
 ;
"RTN","BIUTL8",194,0)
 ; ZEXCEPT:IOF,IOSL,IOST
"RTN","BIUTL8",195,0)
 ;
"RTN","BIUTL8",196,0)
 N BICRT S BICRT=$S(($E(IOST)="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIUTL8",197,0)
 N BIPAGE,BIPOP S BIPAGE=0,BIPOP=0
"RTN","BIUTL8",198,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL8",199,0)
 U IO
"RTN","BIUTL8",200,0)
 ;---> To eliminate control chars from printouts.
"RTN","BIUTL8",201,0)
 I BICRT D FULL^VALM1 W @IOF
"RTN","BIUTL8",202,0)
 D PHEADER(.BIPAGE)
"RTN","BIUTL8",203,0)
 ;
"RTN","BIUTL8",204,0)
 ;---> Loop through ^TMP, writing lines of report.
"RTN","BIUTL8",205,0)
 N N S N=0
"RTN","BIUTL8",206,0)
 F  S N=$O(^TMP(BITNOD,$J,N)) Q:'N  D  Q:BIPOP
"RTN","BIUTL8",207,0)
 .N BITEXT S BITEXT=^TMP(BITNOD,$J,N,0)
"RTN","BIUTL8",208,0)
 .;---> Set BIN=number of lines in this record (=number of $C(30)'s).
"RTN","BIUTL8",209,0)
 .N BIN S BIN=$P(BITEXT,BI31,2)
"RTN","BIUTL8",210,0)
 .S BIN=$L(BIN,$C(30))-1
"RTN","BIUTL8",211,0)
 .;
"RTN","BIUTL8",212,0)
 .;---> If this is not the very first line, and if this record
"RTN","BIUTL8",213,0)
 .;---> won't fit on the bottom of this page, do formfeed and header.
"RTN","BIUTL8",214,0)
 .I N>1 I $Y+BIN+3>IOSL D  Q:BIPOP  W @IOF D PHEADER(.BIPAGE)
"RTN","BIUTL8",215,0)
 ..D:BICRT DIRZ^BIUTL3(.BIPOP)
"RTN","BIUTL8",216,0)
 .;
"RTN","BIUTL8",217,0)
 .W !,$P(BITEXT,BI31)
"RTN","BIUTL8",218,0)
 ;
"RTN","BIUTL8",219,0)
 W:'BICRT @IOF D:(BICRT&('BIPOP)) DIRZ^BIUTL3()
"RTN","BIUTL8",220,0)
 D ^%ZISC
"RTN","BIUTL8",221,0)
 Q
"RTN","BIUTL8",222,0)
 ;
"RTN","BIUTL8",223,0)
 ;
"RTN","BIUTL8",224,0)
 ;----------
"RTN","BIUTL8",225,0)
PHEADER(BIPAGE) ;EP
"RTN","BIUTL8",226,0)
 ;---> Print header for PRTLST above.
"RTN","BIUTL8",227,0)
 ;---> Parameters:
"RTN","BIUTL8",228,0)
 ;     1 - BIPAGE (req) Last page# printed.
"RTN","BIUTL8",229,0)
 ; ZEXCEPT:VALMHDR
"RTN","BIUTL8",230,0)
 ;
"RTN","BIUTL8",231,0)
 S:'$G(BIPAGE) BIPAGE=0 S BIPAGE=BIPAGE+1
"RTN","BIUTL8",232,0)
 N N S N=0
"RTN","BIUTL8",233,0)
 F  S N=$O(VALMHDR(N)) Q:'N  D
"RTN","BIUTL8",234,0)
 .;---> If this is line 2 of the header, append page#.
"RTN","BIUTL8",235,0)
 .I N=2 S $E(VALMHDR(2),70,79)=" page "_BIPAGE
"RTN","BIUTL8",236,0)
 .W !,VALMHDR(N)
"RTN","BIUTL8",237,0)
 W !,$$SP^BIUTL5(79,"=")
"RTN","BIUTL8",238,0)
 Q
"RTN","BIUTL8",239,0)
 ;
"RTN","BIUTL8",240,0)
 ;
"RTN","BIUTL8",241,0)
 ;----------
"RTN","BIUTL8",242,0)
KGBL(BIGBL) ;EP
"RTN","BIUTL8",243,0)
 ;---> Kill a global.  Global should include leading "^".
"RTN","BIUTL8",244,0)
 ;---> Parameters:
"RTN","BIUTL8",245,0)
 ;     1 - BIGBL  (req) Global to be zeroed out (must include "^").
"RTN","BIUTL8",246,0)
 ;
"RTN","BIUTL8",247,0)
 S:BIGBL["(" BIGBL=$P(BIGBL,"(")
"RTN","BIUTL8",248,0)
 F  S BIGBL=$Q(@BIGBL) Q:BIGBL=""  K @BIGBL
"RTN","BIUTL8",249,0)
 Q
"RTN","BIUTL8",250,0)
 ;
"RTN","BIUTL8",251,0)
 ;
"RTN","BIUTL8",252,0)
 ;----------
"RTN","BIUTL8",253,0)
ZGBL(BIGBL) ;EP
"RTN","BIUTL8",254,0)
 ;---> Zero out (delete ALL DATA) in a Fileman file.
"RTN","BIUTL8",255,0)
 ;---> Parameters:
"RTN","BIUTL8",256,0)
 ;     1 - BIGBL  (req) Global to be zeroed out.
"RTN","BIUTL8",257,0)
 ;
"RTN","BIUTL8",258,0)
 Q:$G(BIGBL)=""
"RTN","BIUTL8",259,0)
 N N,X S U="^"
"RTN","BIUTL8",260,0)
 S:$E(BIGBL)'=U BIGBL=U_BIGBL
"RTN","BIUTL8",261,0)
 S:BIGBL["(" BIGBL=$P(BIGBL,"(")
"RTN","BIUTL8",262,0)
 Q:'$D(@(BIGBL_"(0)"))
"RTN","BIUTL8",263,0)
 S N=-1,X=$P(@(BIGBL_"(0)"),U,1,2)
"RTN","BIUTL8",264,0)
 F  S N=$O(@(BIGBL_"("""_N_""")")) Q:N=""  K @(BIGBL_"("""_N_""")")
"RTN","BIUTL8",265,0)
 S @(BIGBL_"(0)")=X
"RTN","BIUTL8",266,0)
 Q
"RTN","BIUTL8",267,0)
 ;
"RTN","BIUTL8",268,0)
 ;
"RTN","BIUTL8",269,0)
 ;----------
"RTN","BIUTL8",270,0)
KILLALL(BIGLOBS) ;EP
"RTN","BIUTL8",271,0)
 ;---> Clean up local variables.
"RTN","BIUTL8",272,0)
 ;---> Parameters:
"RTN","BIUTL8",273,0)
 ;     1 - BIGLOBS  (opt) If BIGLOBS=1 kill temp globals too.
"RTN","BIUTL8",274,0)
 ;
"RTN","BIUTL8",275,0)
 ;---> XB call to kill local variables on RPMS
"RTN","BIUTL8",276,0)
 I $T(^XBVK)]"" D
"RTN","BIUTL8",277,0)
 . D EN^XBVK("BI")
"RTN","BIUTL8",278,0)
 . D EN^XBVK("DI")
"RTN","BIUTL8",279,0)
 ; E  D  ; works in GT.M and Cache for VISTA (NB: This is a standards extension to MUMPS.)
"RTN","BIUTL8",280,0)
 ; . S X="BI" F  S X=$O(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",281,0)
 ; . S X="DI" F  S X=$O(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",282,0)
 E  D  ; way to do it w/o exclusive kills
"RTN","BIUTL8",283,0)
 . N X,Y,KBI
"RTN","BIUTL8",284,0)
 . S Y="BI*",X="KBI(" D ORDER^%ZOSV
"RTN","BIUTL8",285,0)
 . N I S I=""
"RTN","BIUTL8",286,0)
 . F  S I=$O(KBI(I)) Q:I=""  K @I
"RTN","BIUTL8",287,0)
 QUIT
"RTN","BIUTL8",288,0)
 ;
"RTN","BIUTL8",289,0)
 ;---> FILEMAN KILLS.
"RTN","BIUTL8",290,0)
 D DKILLS^BIFMAN
"RTN","BIUTL8",291,0)
 D CLEAN^DILF
"RTN","BIUTL8",292,0)
 K I,M,N,X,Y,Z,ZTRTN,ZTSAVE
"RTN","BIUTL8",293,0)
 ;
"RTN","BIUTL8",294,0)
 Q:'$G(BIGLOBS)
"RTN","BIUTL8",295,0)
 ;---> Clean up temp globals.
"RTN","BIUTL8",296,0)
 K ^BITMP($J)
"RTN","BIUTL8",297,0)
 ;
"RTN","BIUTL8",298,0)
 Q
"RTN","BIUTL8",299,0)
 ;
"RTN","BIUTL8",300,0)
 ;---> Other ways:
"RTN","BIUTL8",301,0)
 ;---> MSM
"RTN","BIUTL8",302,0)
 ;S X="BI" F  S X=$O(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",303,0)
 ;S X="DI" F  S X=$O(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",304,0)
 ;---> DSM
"RTN","BIUTL8",305,0)
 ;S X="BI" F  S X=$ZSORT(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",306,0)
 ;S X="DI" F  S X=$ZSORT(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",307,0)
 Q
"RTN","BIUTL8",308,0)
 ;
"RTN","BIUTL8",309,0)
 ;
"RTN","BIUTL8",310,0)
 ;----------
"RTN","BIUTL8",311,0)
HFSPATH(DUZ2) ;EP
"RTN","BIUTL8",312,0)
 ;---> Return the Host File Path (directory) as set in the
"RTN","BIUTL8",313,0)
 ;---> in the BI SITE PARAMETERS File.
"RTN","BIUTL8",314,0)
 ;---> Parameters:
"RTN","BIUTL8",315,0)
 ;     1 - DUZ2  (opt) User's DUZ(2), otherwise IEN of Site in
"RTN","BIUTL8",316,0)
 ;                     RPMS SITE PARAMETERS File.
"RTN","BIUTL8",317,0)
 ;
"RTN","BIUTL8",318,0)
 S:'$G(DUZ2) DUZ2=$P($G(^AUTTSITE(1,0)),"^")
"RTN","BIUTL8",319,0)
 Q $P($G(^BISITE(+DUZ2,0)),"^",14)
"RTN","BIUTL8",320,0)
 ;
"RTN","BIUTL8",321,0)
 ;
"RTN","BIUTL8",322,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL8",323,0)
 ;---> IP Address for TCH Forecaster.
"RTN","BIUTL8",324,0)
 ;----------
"RTN","BIUTL8",325,0)
IPTCH(DUZ2) ;EP
"RTN","BIUTL8",326,0)
 ;---> Return the IP Address used for the TCH Forecaster
"RTN","BIUTL8",327,0)
 ;---> in the BI SITE PARAMETERS File.
"RTN","BIUTL8",328,0)
 ;---> Parameters:
"RTN","BIUTL8",329,0)
 ;     1 - DUZ2  (opt) User's DUZ(2), otherwise IEN of Site in
"RTN","BIUTL8",330,0)
 ;                     RPMS SITE PARAMETERS File.
"RTN","BIUTL8",331,0)
 ;
"RTN","BIUTL8",332,0)
 S:'$G(DUZ2) DUZ2=$P($G(^AUTTSITE(1,0)),"^")
"RTN","BIUTL8",333,0)
 N BIIP S BIIP=$P($G(^BISITE(+DUZ2,0)),"^",30)
"RTN","BIUTL8",334,0)
 S:'BIIP BIIP="127.0.0.1"
"RTN","BIUTL8",335,0)
 Q BIIP
"RTN","BIUTL8",336,0)
 ;**********
"RTN","BIUTL8",337,0)
 ;
"RTN","BIUTL8",338,0)
 ;----------
"RTN","BIUTL8",339,0)
IMMSVDIR(DUZ2) ;EP
"RTN","BIUTL8",340,0)
 ;---> Return the MSM Home Directory as set in the
"RTN","BIUTL8",341,0)
 ;---> in the BI SITE PARAMETERS File.
"RTN","BIUTL8",342,0)
 ;---> Parameters:
"RTN","BIUTL8",343,0)
 ;     1 - DUZ2  (opt) User's DUZ(2), otherwise IEN of Site in
"RTN","BIUTL8",344,0)
 ;                     RPMS SITE PARAMETERS File.
"RTN","BIUTL8",345,0)
 ;
"RTN","BIUTL8",346,0)
 S:'$G(DUZ2) DUZ2=$P($G(^AUTTSITE(1,0)),"^")
"RTN","BIUTL8",347,0)
 Q $P($G(^BISITE(+DUZ2,0)),"^",18)
"RTN","BIUTL8",348,0)
 ;
"RTN","BIUTL8",349,0)
 ;
"RTN","BIUTL8",350,0)
 ;----------
"RTN","BIUTL8",351,0)
PDSS(BIVIEN,BICOMP,BIPDSS) ;EP
"RTN","BIUTL8",352,0)
 ;---> Return 1 if this V Imm IEN is contained in the ImmServe
"RTN","BIUTL8",353,0)
 ;---> Problem Dose IEN string; return 0 if not.
"RTN","BIUTL8",354,0)
 ;---> Parameters:
"RTN","BIUTL8",355,0)
 ;     1 - BIVIEN (req) Visit IEN of this immunization.
"RTN","BIUTL8",356,0)
 ;     2 - BICOMP (req) Vaccine Component CVX Code.
"RTN","BIUTL8",357,0)
 ;     2 - BIPDSS (req) String of ImmServe Problem Dose IENs.
"RTN","BIUTL8",358,0)
 ;
"RTN","BIUTL8",359,0)
 Q:'$G(BIVIEN) 0
"RTN","BIUTL8",360,0)
 Q:'$G(BICOMP) 0
"RTN","BIUTL8",361,0)
 Q:'$D(BIPDSS) 0
"RTN","BIUTL8",362,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIUTL8",363,0)
 ;---> Concat leading zero if single digit.
"RTN","BIUTL8",364,0)
 ;I $L(BICOMP)=1 S BICOMP="0"_BICOMP
"RTN","BIUTL8",365,0)
 N I,X,Y,Z S X=0
"RTN","BIUTL8",366,0)
 ;
"RTN","BIUTL8",367,0)
 ;---> Ignore component CVX for now.
"RTN","BIUTL8",368,0)
 S Y=BIVIEN_"%"_BICOMP
"RTN","BIUTL8",369,0)
 F I=1:1 S Z=$P(BIPDSS,U,I) Q:Z=""  I Y=Z S X=1 Q
"RTN","BIUTL8",370,0)
 ;---> Just check for V Imm IEN.
"RTN","BIUTL8",371,0)
 ;F I=1:1 S Z=$P(BIPDSS,U,I) Q:Z=""  I BIVIEN=Z S X=1 Q
"RTN","BIUTL8",372,0)
 ;**********
"RTN","BIUTL8",373,0)
 ;
"RTN","BIUTL8",374,0)
 Q X
"RTN","BIUTL8",375,0)
 ;
"RTN","BIUTL8",376,0)
 ;
"RTN","BIUTL8",377,0)
 ;----------
"RTN","BIUTL8",378,0)
DOVER(X,Z) ;EP
"RTN","BIUTL8",379,0)
 ;---> Return text of Dose Override Code.
"RTN","BIUTL8",380,0)
 ;---> Parameters:
"RTN","BIUTL8",381,0)
 ;     1 - X (req) Code for Dose Override text.
"RTN","BIUTL8",382,0)
 ;     2 - Z (opt) If Z=1 return Short form (remove "INVALID--" from text).
"RTN","BIUTL8",383,0)
 ;
"RTN","BIUTL8",384,0)
 Q:'$G(X) ""
"RTN","BIUTL8",385,0)
 Q:$G(Z) $P($P($P($G(^DD(9000010.11,.08,0)),X_":",2),";"),"--",2)
"RTN","BIUTL8",386,0)
 Q $P($P($G(^DD(9000010.11,.08,0)),X_":",2),";")
"RTN","BIUTL9")
0^158^B2779619
"RTN","BIUTL9",1,0)
BIUTL9 ;IHS/CMI/MWR - UTIL: OVERFLOW CODE FROM OTHER BIUTL RTNS; MAY 10, 2010
"RTN","BIUTL9",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIUTL9",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL9",4,0)
 ;;  OVERFLOW CODE FROM OTHER BIUTL RTNS.
"RTN","BIUTL9",5,0)
 ;;  PATCH 9: All EP's below are moved from BIUTL7 for space (<15000k).  REASCHK+0
"RTN","BIUTL9",6,0)
 ;
"RTN","BIUTL9",7,0)
 ; VEN/SMH - Use this routine to add my own VISTA Porting Utility Routines ***
"RTN","BIUTL9",8,0)
 ;
"RTN","BIUTL9",9,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL9",10,0)
 ;---> All EP's below are moved from BIUTL7 for space (<15000k).
"RTN","BIUTL9",11,0)
 ;
"RTN","BIUTL9",12,0)
 ;----------
"RTN","BIUTL9",13,0)
REASCHK ;EP
"RTN","BIUTL9",14,0)
 ;---> Called by Post Action field of Field 5 on BI FORM-CASE DATA EDIT.
"RTN","BIUTL9",15,0)
 ;---> If Date Inactive in Field 4, then a Reason is req'd in Field 5.
"RTN","BIUTL9",16,0)
 ;
"RTN","BIUTL9",17,0)
 I (BI("E")]"")&(BI("F")="") D
"RTN","BIUTL9",18,0)
 .D HLP^DDSUTL("*** NOTE! An Inactive Date REQUIRES an Inactive Reason! ***")
"RTN","BIUTL9",19,0)
 .S DDSBR=4
"RTN","BIUTL9",20,0)
 Q
"RTN","BIUTL9",21,0)
 ;
"RTN","BIUTL9",22,0)
 ;
"RTN","BIUTL9",23,0)
 ;----------
"RTN","BIUTL9",24,0)
READCHK ;EP
"RTN","BIUTL9",25,0)
 ;---> Called by Post Action field of Field 4 on BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL9",26,0)
 ;---> If user entered a Result in Field 3, then a Reading is req'd in Field 4.
"RTN","BIUTL9",27,0)
 I $G(BI("L"))]"",$G(BI("M"))="",$G(BI("I"))'="E" D
"RTN","BIUTL9",28,0)
 .;
"RTN","BIUTL9",29,0)
 .D HLP^DDSUTL("*** NOTE! If you enter a Result you MUST enter a Reading! ***")
"RTN","BIUTL9",30,0)
 .S DDSBR=3
"RTN","BIUTL9",31,0)
 Q
"RTN","BIUTL9",32,0)
 ;
"RTN","BIUTL9",33,0)
 ;
"RTN","BIUTL9",34,0)
 ;----------
"RTN","BIUTL9",35,0)
READCH6 ;EP
"RTN","BIUTL9",36,0)
 ;---> Called by Post Action field of Field 4 on BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL9",37,0)
 ;
"RTN","BIUTL9",38,0)
 D READCHK
"RTN","BIUTL9",39,0)
 I $G(DDSBR)=3 D  Q
"RTN","BIUTL9",40,0)
 .S X=$G(DDSOLD) D PUT^DDSVALF(6,,,X)
"RTN","BIUTL9",41,0)
 D LOCBR^BIUTL4
"RTN","BIUTL9",42,0)
 Q
"RTN","BIUTL9",43,0)
 ;
"RTN","BIUTL9",44,0)
 ;
"RTN","BIUTL9",45,0)
 ;----------
"RTN","BIUTL9",46,0)
CREASCHK ;EP
"RTN","BIUTL9",47,0)
 ;---> Called by Post Action of Field 4 on BI FORM-CONTRAIND ADD/EDIT.
"RTN","BIUTL9",48,0)
 ;---> If user entered a Contra in Field 1, then a Reason is req'd in Field 4.
"RTN","BIUTL9",49,0)
 ;
"RTN","BIUTL9",50,0)
 I (BI("B")]"")&(BI("C")="") D
"RTN","BIUTL9",51,0)
 .D HLP^DDSUTL("*** NOTE! A Reason for the contraindication is required! ***")
"RTN","BIUTL9",52,0)
 .S DDSBR=1
"RTN","BIUTL9",53,0)
 Q
"RTN","BIUTL9",54,0)
 ;**********
"RTN","BIUTL9",55,0)
 ;
"RTN","BIUTL9",56,0)
RPMS() ; [Public $$] Are we running on RPMS??
"RTN","BIUTL9",57,0)
 ; Try to do a heuristic determination
"RTN","BIUTL9",58,0)
 ; Just fiddling with this for now since I don't know the best way yet
"RTN","BIUTL9",59,0)
 ; I don't want to do this with DUZ("AG") (Agency) since many people may
"RTN","BIUTL9",60,0)
 ; run RPMS as agency of "Other". Let's hope at least that somebody gets the
"RTN","BIUTL9",61,0)
 ; right idea and runs RPMS rather than VISTA in ambulatory settings.
"RTN","BIUTL9",62,0)
 if $data(^AUTTSITE(0)) quit 1
"RTN","BIUTL9",63,0)
 quit 0
"RTN","BIUTLFIX")
0^159^B72577217
"RTN","BIUTLFIX",1,0)
BIUTLFIX ;IHS/CMI/MWR - UTIL: FIX STUFF.; MAY 10, 2010
"RTN","BIUTLFIX",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIUTLFIX",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTLFIX",4,0)
 ;;  UTILITY: FIXES: LISTMAN HIDDEN MENUS.
"RTN","BIUTLFIX",5,0)
 ;;  PATCH 1: UPDATE VACCINE TABLE: ADD "INFLUENZA, 1203" CVX=123
"RTN","BIUTLFIX",6,0)
 ;;  PATCH 5: Back-populate SNOMED Codes to all Contraindications.  SNOMED+0
"RTN","BIUTLFIX",7,0)
 ;
"RTN","BIUTLFIX",8,0)
 ;
"RTN","BIUTLFIX",9,0)
 ;
"RTN","BIUTLFIX",10,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTLFIX",11,0)
SNOMED ;PEP - Back-populate SNOMED Codes to all Contraindications.
"RTN","BIUTLFIX",12,0)
 ;
"RTN","BIUTLFIX",13,0)
 N BIIEN S BIIEN=0 F  S BIIEN=$O(^BIPC(BIIEN)) Q:'BIIEN  D
"RTN","BIUTLFIX",14,0)
 .Q:'$D(^BIPC(BIIEN,0))
"RTN","BIUTLFIX",15,0)
 .N BICRIEN,BIVIEN,BIY
"RTN","BIUTLFIX",16,0)
 .S BIY=^BIPC(BIIEN,0)
"RTN","BIUTLFIX",17,0)
 .S BIVIEN=$P(BIY,U,2)  ;Vaccine IEN.
"RTN","BIUTLFIX",18,0)
 .S BICRIEN=$P(BIY,U,3) ;Contraindication Reason IEN.
"RTN","BIUTLFIX",19,0)
 .N I,X,Y
"RTN","BIUTLFIX",20,0)
 .;---> Get string of Vaccine Component IEN's.
"RTN","BIUTLFIX",21,0)
 .S X=$$VCOMPS^BIUTL2(BIVIEN)
"RTN","BIUTLFIX",22,0)
 .;---> If no components process the vaccine itself.
"RTN","BIUTLFIX",23,0)
 .S:('+X) X=BIVIEN
"RTN","BIUTLFIX",24,0)
 .;
"RTN","BIUTLFIX",25,0)
 .F I=1:1:6 S Y=$P(X,";",I) Q:'Y  D
"RTN","BIUTLFIX",26,0)
 ..;---> Get Vaccine Group IEN of this vaccine.
"RTN","BIUTLFIX",27,0)
 ..N BIVGRP S BIVGRP=$$IMMVG^BIUTL2(Y)
"RTN","BIUTLFIX",28,0)
 ..;---> Quit if Vaccine Group is Other, Skin Test, or Combo.
"RTN","BIUTLFIX",29,0)
 ..Q:((BIVGRP=12)!(BIVGRP=13)!(BIVGRP=14)!(BIVGRP<1))
"RTN","BIUTLFIX",30,0)
 ..;---> Call Lori's Magic Mapper to get SNOMED Code.
"RTN","BIUTLFIX",31,0)
 ..D SNOMED^BIRPC4(BIVGRP,BICRIEN,BIIEN)
"RTN","BIUTLFIX",32,0)
 Q
"RTN","BIUTLFIX",33,0)
 ;**********
"RTN","BIUTLFIX",34,0)
 ;
"RTN","BIUTLFIX",35,0)
 ;
"RTN","BIUTLFIX",36,0)
 ;----------
"RTN","BIUTLFIX",37,0)
LISTMENU ;EP
"RTN","BIUTLFIX",38,0)
 ;---> Fix/update Listmanager hidden menus.
"RTN","BIUTLFIX",39,0)
 ;---> This will go through all of the BI PROTOCOLS and update
"RTN","BIUTLFIX",40,0)
 ;---> any hidden menus.
"RTN","BIUTLFIX",41,0)
 ;
"RTN","BIUTLFIX",42,0)
 D ^XBKVAR
"RTN","BIUTLFIX",43,0)
 D LISTQUIT
"RTN","BIUTLFIX",44,0)
 N N S N="BI"
"RTN","BIUTLFIX",45,0)
 F  S N=$O(^ORD(101,"B",N)) Q:N=""  Q:N]"BIZZZ"  D
"RTN","BIUTLFIX",46,0)
 .Q:N'["HIDDEN"
"RTN","BIUTLFIX",47,0)
 .N BIIEN S BIIEN=$O(^ORD(101,"B",N,0))
"RTN","BIUTLFIX",48,0)
 .D:BIIEN FIX(BIIEN)
"RTN","BIUTLFIX",49,0)
 Q
"RTN","BIUTLFIX",50,0)
 ;
"RTN","BIUTLFIX",51,0)
 ;
"RTN","BIUTLFIX",52,0)
 ;----------
"RTN","BIUTLFIX",53,0)
FIX(BIIEN) ;EP
"RTN","BIUTLFIX",54,0)
 Q:'BIIEN  Q:'$D(^ORD(101,+BIIEN,0))
"RTN","BIUTLFIX",55,0)
 S XQORM=+BIIEN_";ORD(101,"
"RTN","BIUTLFIX",56,0)
 D XREF^XQORM
"RTN","BIUTLFIX",57,0)
 Q
"RTN","BIUTLFIX",58,0)
 ;
"RTN","BIUTLFIX",59,0)
 ;
"RTN","BIUTLFIX",60,0)
 ;----------
"RTN","BIUTLFIX",61,0)
LISTQUIT ;EP
"RTN","BIUTLFIX",62,0)
 ;---> Set Quit synonym to "Q" on VALM HIDDEN ACTIONS Protocol.
"RTN","BIUTLFIX",63,0)
 ;---> Get IEN of VALM HIDDEN ACTIONS Protocol.
"RTN","BIUTLFIX",64,0)
 N BIN S BIN=$O(^ORD(101,"B","VALM HIDDEN ACTIONS",0))
"RTN","BIUTLFIX",65,0)
 Q:'BIN
"RTN","BIUTLFIX",66,0)
 Q:$P(^ORD(101,BIN,0),U)'="VALM HIDDEN ACTIONS"
"RTN","BIUTLFIX",67,0)
 ;
"RTN","BIUTLFIX",68,0)
 ;---> Find "VALM QUIT" Item.
"RTN","BIUTLFIX",69,0)
 N N S N=0
"RTN","BIUTLFIX",70,0)
 F  S N=$O(^ORD(101,BIN,10,N)) Q:'N  D
"RTN","BIUTLFIX",71,0)
 .N X,Y
"RTN","BIUTLFIX",72,0)
 .S X=$P(^ORD(101,BIN,10,N,0),U)
"RTN","BIUTLFIX",73,0)
 .S Y=$P($G(^ORD(101,X,0)),U)
"RTN","BIUTLFIX",74,0)
 .Q:Y'="VALM QUIT"
"RTN","BIUTLFIX",75,0)
 .S $P(^ORD(101,BIN,10,N,0),U,2)="Q"
"RTN","BIUTLFIX",76,0)
 D FIX(BIN)
"RTN","BIUTLFIX",77,0)
 Q
"RTN","BIUTLFIX",78,0)
 ;
"RTN","BIUTLFIX",79,0)
 ;
"RTN","BIUTLFIX",80,0)
 ;----------
"RTN","BIUTLFIX",81,0)
ONE ;EP
"RTN","BIUTLFIX",82,0)
 ;---> Individual Hidden Menu lookup.
"RTN","BIUTLFIX",83,0)
 W !!,"Select the Protocol you wish to fix.",!
"RTN","BIUTLFIX",84,0)
 D DIC^BIFMAN(101,"QEMA",.Y)
"RTN","BIUTLFIX",85,0)
 Q:Y<0
"RTN","BIUTLFIX",86,0)
 D FIX(+Y)
"RTN","BIUTLFIX",87,0)
 Q
"RTN","BIUTLFIX",88,0)
 ;
"RTN","BIUTLFIX",89,0)
 ;
"RTN","BIUTLFIX",90,0)
 ;----------
"RTN","BIUTLFIX",91,0)
BADPATS ;EP
"RTN","BIUTLFIX",92,0)
 ;---> Look for BI PATIENTS with no data in ^BIP(BIDFN,0) node.
"RTN","BIUTLFIX",93,0)
 ;
"RTN","BIUTLFIX",94,0)
 S N=0
"RTN","BIUTLFIX",95,0)
 F  S N=$O(^BIP(N)) Q:'N  D
"RTN","BIUTLFIX",96,0)
 .W:'$P(^BIP(N,0),"^") !,N,": ",^(0)
"RTN","BIUTLFIX",97,0)
 Q
"RTN","BIUTLFIX",98,0)
 ;
"RTN","BIUTLFIX",99,0)
 ;
"RTN","BIUTLFIX",100,0)
 ;----------
"RTN","BIUTLFIX",101,0)
ACTIVE ;EP
"RTN","BIUTLFIX",102,0)
 ;---> Fix patients whose "Date Inactive" was erroneously converted.
"RTN","BIUTLFIX",103,0)
 ;---> 1=Active, 0=Inactive.
"RTN","BIUTLFIX",104,0)
 ;
"RTN","BIUTLFIX",105,0)
 N BITOTN,BITOTY
"RTN","BIUTLFIX",106,0)
 S N=0
"RTN","BIUTLFIX",107,0)
 S BITOTN=0,BITOTY=0
"RTN","BIUTLFIX",108,0)
 F  S N=$O(^BIP(N)) Q:'N  D
"RTN","BIUTLFIX",109,0)
 .I $P(^BIP(N,0),"^",8)=0 S $P(^(0),U,8)=DT S BITOTN=BITOTN+1 Q
"RTN","BIUTLFIX",110,0)
 .I $P(^BIP(N,0),"^",8)=1 S $P(^(0),U,8)="" S BITOTY=BITOTY+1
"RTN","BIUTLFIX",111,0)
 W !,"NO : ",BITOTN
"RTN","BIUTLFIX",112,0)
 W !,"YES: ",BITOTY
"RTN","BIUTLFIX",113,0)
 Q
"RTN","BIUTLFIX",114,0)
 ;
"RTN","BIUTLFIX",115,0)
 ;
"RTN","BIUTLFIX",116,0)
 ;----------
"RTN","BIUTLFIX",117,0)
BUILD ;EP
"RTN","BIUTLFIX",118,0)
 ;---> STEPS TO ADD NEW VACCINE TO VACCINE TABLE/IMMUNIZATION FILE:
"RTN","BIUTLFIX",119,0)
 ;
"RTN","BIUTLFIX",120,0)
 ;---> 1) Use Fileman to add new vaccine to the BI IMMUNIZATION TABLE
"RTN","BIUTLFIX",121,0)
 ;--->    HL7/CVX STANDARD File #9002084.94.
"RTN","BIUTLFIX",122,0)
 ;
"RTN","BIUTLFIX",123,0)
 ;---> 2) Execute line listed below to update ^BITN routine.
"RTN","BIUTLFIX",124,0)
 ;--->         (At programmer prompt, D BUILD^BIUTLFIX ZR  X BIX0.)
"RTN","BIUTLFIX",125,0)
 ;
"RTN","BIUTLFIX",126,0)
 ;---> 3) Load BITN2 into an editor and trim the entire BITN routine
"RTN","BIUTLFIX",127,0)
 ;--->         that gets tacked onto the end of BITN2 during compilation.
"RTN","BIUTLFIX",128,0)
 ;
"RTN","BIUTLFIX",129,0)
 ;---> 4) Restandardize the Vaccine Table D RESTAND^BIRESTD().
"RTN","BIUTLFIX",130,0)
 ;--->                        (Or under Manager Menu do MGR-->RES.)
"RTN","BIUTLFIX",131,0)
 ;
"RTN","BIUTLFIX",132,0)
 ;---> Build routine ^BITN.
"RTN","BIUTLFIX",133,0)
 ;---> Not called by any option or User action.  Used by package
"RTN","BIUTLFIX",134,0)
 ;---> programmer to create routine BITN, which in turn is used
"RTN","BIUTLFIX",135,0)
 ;---> to build ^BITN global during installation.
"RTN","BIUTLFIX",136,0)
 ;---> To use: At programmer prompt, D BUILD^BIUTLFIX ZR  X BIX0.
"RTN","BIUTLFIX",137,0)
 ;
"RTN","BIUTLFIX",138,0)
 D SETVARS^BIUTL5
"RTN","BIUTLFIX",139,0)
 K BIXDT S BIXDT=$$TXDT^BIUTL5(DT)
"RTN","BIUTLFIX",140,0)
 S BIX0="N I F I=1:1 Q:'$D(@(""BIX""_I))  X @(""BIX""_I)"
"RTN","BIUTLFIX",141,0)
 ;
"RTN","BIUTLFIX",142,0)
 ;---> build first routine for nodes <200.
"RTN","BIUTLFIX",143,0)
 S BIX1="ZI ""BITN ;IHS/CMI/MWR - BUILD ^BITN GLOBAL."""
"RTN","BIUTLFIX",144,0)
 S BIX2="ZI "" ;;8.5;IMMUNIZATION;;""_BIXDT"
"RTN","BIUTLFIX",145,0)
 S BIX3="ZI "" ;;* MICHAEL REMILLARD, DDS"
"RTN","BIUTLFIX",146,0)
 S BIX3=BIX3_" * CIMARRON MEDICAL INFORMATICS, FOR IHS *"""
"RTN","BIUTLFIX",147,0)
 S BIX4="ZI "" ;;  UTILITY: BUILD STANDARD ^BITN GLOBAL."""
"RTN","BIUTLFIX",148,0)
 S BIX5="ZI "" ;"","" ;"","" ;----------"",""START ;EP"""
"RTN","BIUTLFIX",149,0)
 S BIX6="ZI "" D KGBL^BIUTL8(""""^BITN"""")"""
"RTN","BIUTLFIX",150,0)
 S BIX7="ZI "" S ^BITN(0)=""""BI IMMUNIZATION TABLE HL7 STANDARD"
"RTN","BIUTLFIX",151,0)
 S BIX7=BIX7_"^9002084.94I"""""""
"RTN","BIUTLFIX",152,0)
 ;
"RTN","BIUTLFIX",153,0)
 S BIX8="ZI "" N I,X,Y,Z"""
"RTN","BIUTLFIX",154,0)
 S BIX9="ZI "" F I=1:2 S X=$T(@""""TABLE""""+I) Q:X'["""";;""""  D"""
"RTN","BIUTLFIX",155,0)
 S BIX10="ZI "" .S Y=$P(X,"""";;"""",2),Z=$P(X,"""";;"""",3)"""
"RTN","BIUTLFIX",156,0)
 S BIX11="ZI "" .S ^BITN(Y,0)=Z""  ZI "" .S X=$T(@""""TABLE""""+(I+1))"
"RTN","BIUTLFIX",157,0)
 S BIX11=BIX11_",Z=$P(X,"""";;"""",3),^BITN(Y,1)=Z"","" ;"""
"RTN","BIUTLFIX",158,0)
 ;
"RTN","BIUTLFIX",159,0)
 ;---> Next node for future inserts.
"RTN","BIUTLFIX",160,0)
 S BIX12=""
"RTN","BIUTLFIX",161,0)
 ;
"RTN","BIUTLFIX",162,0)
 S BIX13="ZI "" F I=1:2 S X=$T(@""""TABLE""""+I^BITN2) Q:X'["""";;""""  D"""
"RTN","BIUTLFIX",163,0)
 S BIX14="ZI "" .S Y=$P(X,"""";;"""",2),Z=$P(X,"""";;"""",3)"""
"RTN","BIUTLFIX",164,0)
 S BIX15="ZI "" .S ^BITN(Y,0)=Z""  ZI "" .S X=$T(@""""TABLE""""+(I+1)^BITN2)"
"RTN","BIUTLFIX",165,0)
 S BIX15=BIX15_",Z=$P(X,"""";;"""",3),^BITN(Y,1)=Z"","" ;"""
"RTN","BIUTLFIX",166,0)
 ;
"RTN","BIUTLFIX",167,0)
 S BIX16="ZI "" N DIK S DIK=""""^BITN("""" D IXALL^DIK"""
"RTN","BIUTLFIX",168,0)
 S BIX17="ZI "" Q"","" ;"","" ;"","" ;----------"",""TABLE ; EP"""
"RTN","BIUTLFIX",169,0)
 S BIX18="N N S N=0 F  S N=$O(^BITN(N)) Q:'N  Q:(N>199)  "
"RTN","BIUTLFIX",170,0)
 ;S BIX18="N N S N=0 F  S N=$O(^AUTTIMM(N)) Q:'N  "
"RTN","BIUTLFIX",171,0)
 S BIX18=BIX18_"ZI "" ;;""_N_"";;""_^BITN(N,0)"
"RTN","BIUTLFIX",172,0)
 S BIX18=BIX18_" ZI "" ;;""_N_""a;;""_^BITN(N,1)"
"RTN","BIUTLFIX",173,0)
 S BIX19="ZS BITN ZR  "
"RTN","BIUTLFIX",174,0)
 ;
"RTN","BIUTLFIX",175,0)
 ;---> Now build second routine for nodes >199.
"RTN","BIUTLFIX",176,0)
 S BIX20="ZI ""BITN2 ;IHS/CMI/MWR - BUILD ^BITN GLOBAL SECOND HALF."""
"RTN","BIUTLFIX",177,0)
 S BIX21="ZI "" ;;8.5;IMMUNIZATION;;""_BIXDT"
"RTN","BIUTLFIX",178,0)
 S BIX22="ZI "" ;;* MICHAEL REMILLARD, DDS"
"RTN","BIUTLFIX",179,0)
 S BIX22=BIX22_" * CIMARRON MEDICAL INFORMATICS, FOR IHS *"""
"RTN","BIUTLFIX",180,0)
 S BIX23="ZI "" ;;  UTILITY: BUILD STANDARD ^BITN GLOBAL."""
"RTN","BIUTLFIX",181,0)
 S BIX24="ZI "" ;"","" ;"","" ;----------"",""TABLE ; EP"""
"RTN","BIUTLFIX",182,0)
 S BIX25="N N S N=199 F  S N=$O(^BITN(N)) Q:'N  "
"RTN","BIUTLFIX",183,0)
 S BIX25=BIX25_"ZI "" ;;""_N_"";;""_^BITN(N,0)"
"RTN","BIUTLFIX",184,0)
 S BIX25=BIX25_" ZI "" ;;""_N_""a;;""_^BITN(N,1)"
"RTN","BIUTLFIX",185,0)
 S BIX26="ZI "" Q"""
"RTN","BIUTLFIX",186,0)
 S BIX27="ZS BITN2"
"RTN","BIUTLFIX",187,0)
 S BIX28="W !,""DONE.  Load and trim BITN2"""
"RTN","BIUTLFIX",188,0)
 Q
"RTN","BIUTLFIX",189,0)
 ;
"RTN","BIUTLFIX",190,0)
 ;
"RTN","BIUTLFIX",191,0)
 ;----------
"RTN","BIUTLFIX",192,0)
CHGPTR(BICHG) ;EP
"RTN","BIUTLFIX",193,0)
 ;---> Change all records with one vaccine pointer to a different one.
"RTN","BIUTLFIX",194,0)
 ;---> Parameters:
"RTN","BIUTLFIX",195,0)
 ;     1 - BICHG   (opt) IF BICHG=1 then change entries from 214 to 235.
"RTN","BIUTLFIX",196,0)
 ;
"RTN","BIUTLFIX",197,0)
 D SETVARS^BIUTL5
"RTN","BIUTLFIX",198,0)
 D KGBL^BIUTL8("^MIKE") S ^MIKE(0)=^AUPNVIMM(0)
"RTN","BIUTLFIX",199,0)
 N BICOUNT,BIECOUNT,BIN S BIN=0,BICOUNT=0,BIECOUNT=0
"RTN","BIUTLFIX",200,0)
 F  S BIN=$O(^AUPNVIMM(BIN)) Q:'BIN  D
"RTN","BIUTLFIX",201,0)
 .N BIERR S BIERR=0
"RTN","BIUTLFIX",202,0)
 .Q:($P(^AUPNVIMM(BIN,0),U)'=214)
"RTN","BIUTLFIX",203,0)
 .S BICOUNT=BICOUNT+1
"RTN","BIUTLFIX",204,0)
 .Q:('$G(BICHG))
"RTN","BIUTLFIX",205,0)
 .S ^MIKE(BIN,0)=^AUPNVIMM(BIN,0)
"RTN","BIUTLFIX",206,0)
 .;
"RTN","BIUTLFIX",207,0)
 .;---> Change .01 pointer to VAccine Table.
"RTN","BIUTLFIX",208,0)
 .N BIFLD S BIFLD(.01)=235
"RTN","BIUTLFIX",209,0)
 .D FDIE^BIFMAN(9000010.11,BIN,.BIFLD,.BIERR)
"RTN","BIUTLFIX",210,0)
 .I BIERR=1 S BIECOUNT=BIECOUNT+1,^MIKE("ERR",N)=""  Q
"RTN","BIUTLFIX",211,0)
 ;
"RTN","BIUTLFIX",212,0)
 W !!,"COUNT: ",BICOUNT
"RTN","BIUTLFIX",213,0)
 W !,"ERRORS: ",BIECOUNT
"RTN","BIUTLFIX",214,0)
 Q
"RTN","BIUTLFIX",215,0)
 ;
"RTN","BIUTLFIX",216,0)
 ;
"RTN","BIUTLFIX",217,0)
 ;----------
"RTN","BIUTLFIX",218,0)
CURCOM ;EP
"RTN","BIUTLFIX",219,0)
 ;---> Utility to update Patients' Curren Community pointer, piece 17,
"RTN","BIUTLFIX",220,0)
 ;---> based on text of Community in piece 18 of ^AUPNPAT(DFN,11).
"RTN","BIUTLFIX",221,0)
 ;
"RTN","BIUTLFIX",222,0)
 N DFN,TOTAL
"RTN","BIUTLFIX",223,0)
 S DFN=0,TOTAL=0,U="^"
"RTN","BIUTLFIX",224,0)
 F  S DFN=$O(^AUPNPAT(DFN)) Q:'DFN  D
"RTN","BIUTLFIX",225,0)
 .N X,Y
"RTN","BIUTLFIX",226,0)
 .Q:'$D(^AUPNPAT(DFN,11))
"RTN","BIUTLFIX",227,0)
 .;
"RTN","BIUTLFIX",228,0)
 .;---> Quit if piece 17 is already set.
"RTN","BIUTLFIX",229,0)
 .Q:$P(^AUPNPAT(DFN,11),U,17)
"RTN","BIUTLFIX",230,0)
 .;
"RTN","BIUTLFIX",231,0)
 .;---> First try to get Current Community pointer from the last
"RTN","BIUTLFIX",232,0)
 .;---> "Community of Residence" Subfield of "Previous Community"
"RTN","BIUTLFIX",233,0)
 .;---> (Field .03 of the last/latest 51 subnode).
"RTN","BIUTLFIX",234,0)
 .N CC,N S CC="",N=0
"RTN","BIUTLFIX",235,0)
 .F  S N=$O(^AUPNPAT(DFN,51,N)) Q:'N  D
"RTN","BIUTLFIX",236,0)
 ..S CC=$P($G(^AUPNPAT(DFN,51,N,0)),U,3)
"RTN","BIUTLFIX",237,0)
 .;
"RTN","BIUTLFIX",238,0)
 .;---> If the last Previous Community is a good pointer, use it & quit.
"RTN","BIUTLFIX",239,0)
 .I CC I $D(^AUTTCOM(CC,0)) D  Q
"RTN","BIUTLFIX",240,0)
 ..;---> Set the "CURRENT RESIDENCE PTR" Field #1117.
"RTN","BIUTLFIX",241,0)
 ..S $P(^AUPNPAT(DFN,11),U,17)=CC
"RTN","BIUTLFIX",242,0)
 ..;---> Set the "CURRENT COMMUNITY" Field #1118 (text).
"RTN","BIUTLFIX",243,0)
 ..S $P(^AUPNPAT(DFN,11),U,18)=$P(^AUTTCOM(CC,0),U)
"RTN","BIUTLFIX",244,0)
 ..S TOTAL=TOTAL+1
"RTN","BIUTLFIX",245,0)
 .;
"RTN","BIUTLFIX",246,0)
 .;---> If Previous Comm failed, get text of Community from piece 18.
"RTN","BIUTLFIX",247,0)
 .S X=$P(^AUPNPAT(DFN,11),U,18)
"RTN","BIUTLFIX",248,0)
 .Q:X=""
"RTN","BIUTLFIX",249,0)
 .;
"RTN","BIUTLFIX",250,0)
 .;---> If text of piece 18 exists in Community file, get IEN and
"RTN","BIUTLFIX",251,0)
 .;---> set patient's piece 17=IEN in Community File.
"RTN","BIUTLFIX",252,0)
 .D:$D(^AUTTCOM("B",X))
"RTN","BIUTLFIX",253,0)
 ..S Y=$O(^AUTTCOM("B",X,0))
"RTN","BIUTLFIX",254,0)
 ..;---> Quit if there are other instances of this name.
"RTN","BIUTLFIX",255,0)
 ..Q:$O(AUTTCOM("B",X,Y))
"RTN","BIUTLFIX",256,0)
 ..;---> Quit if the pointer is bad.
"RTN","BIUTLFIX",257,0)
 ..Q:'$D(^AUTTCOM(+Y,0))
"RTN","BIUTLFIX",258,0)
 ..S $P(^AUPNPAT(DFN,11),U,17)=Y
"RTN","BIUTLFIX",259,0)
 ..S TOTAL=TOTAL+1
"RTN","BIUTLFIX",260,0)
 ;
"RTN","BIUTLFIX",261,0)
 W !!?5,"Total changed: ",TOTAL,!?5,"Done.",!
"RTN","BIUTLFIX",262,0)
 Q
"RTN","BIUTLFIX",263,0)
 ;
"RTN","BIUTLFIX",264,0)
 ;
"RTN","BIUTLFIX",265,0)
 ;----------
"RTN","BIUTLFIX",266,0)
BADINACT ; EP
"RTN","BIUTLFIX",267,0)
 ;---> Correct any bad Inactive Dates, that were 1 or 0 from earLier
"RTN","BIUTLFIX",268,0)
 ;---> version.
"RTN","BIUTLFIX",269,0)
 D ^XBKVAR
"RTN","BIUTLFIX",270,0)
 N M,N,P
"RTN","BIUTLFIX",271,0)
 S M=0,P=0
"RTN","BIUTLFIX",272,0)
 S N=0
"RTN","BIUTLFIX",273,0)
 F  S N=$O(^BIP(N)) Q:'N  D
"RTN","BIUTLFIX",274,0)
 .I $P(^BIP(N,0),"^",8)=1 S $P(^(0),U,8)=2990507 S M=M+1 Q
"RTN","BIUTLFIX",275,0)
 .I $P(^BIP(N,0),"^",8)=0 S $P(^(0),U,8)="" S P=P+1 Q
"RTN","BIUTLFIX",276,0)
 ;
"RTN","BIUTLFIX",277,0)
 W !,"BAD DATES: ",M
"RTN","BIUTLFIX",278,0)
 W !,"ZERO ACTIVE: ",P
"RTN","BIUTLFIX",279,0)
 Q
"RTN","BIUTLFIX",280,0)
 ;
"RTN","BIUTLFIX",281,0)
 ;
"RTN","BIUTLFIX",282,0)
 ;----------
"RTN","BIUTLFIX",283,0)
LOTNUM ;EP
"RTN","BIUTLFIX",284,0)
 ;---> Inactivate all Lot Numbers.
"RTN","BIUTLFIX",285,0)
 D ^XBKVAR
"RTN","BIUTLFIX",286,0)
 N N S N=0
"RTN","BIUTLFIX",287,0)
 F  S N=$O(^AUTTIML(N)) Q:'N  D
"RTN","BIUTLFIX",288,0)
 .Q:'$D(^AUTTIML(N,0))
"RTN","BIUTLFIX",289,0)
 .;---> Do not Inactivate if Exp Date is later than Today.
"RTN","BIUTLFIX",290,0)
 .Q:($P(^AUTTIML(N,0),"^",9)>$G(DT))
"RTN","BIUTLFIX",291,0)
 .;---> Inactivate this Lot Number.
"RTN","BIUTLFIX",292,0)
 .S $P(^AUTTIML(N,0),"^",3)=1
"RTN","BIUTLFIX",293,0)
 W !!,"All Lot Numbers have been Inactivated.",!
"RTN","BIUTLFIX",294,0)
 Q
"RTN","BIVACED")
0^160^B46685781
"RTN","BIVACED",1,0)
BIVACED ;IHS/CMI/MWR - EDIT VACCINES.; MAY 10, 2010
"RTN","BIVACED",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIVACED",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVACED",4,0)
 ;;  EDIT VACCINE FIELDS: CURRENT LOT, ACTIVE, VIS DATE DEFAULT.
"RTN","BIVACED",5,0)
 ;
"RTN","BIVACED",6,0)
 ;
"RTN","BIVACED",7,0)
 ;
"RTN","BIVACED",8,0)
 ;----------
"RTN","BIVACED",9,0)
START ;EP
"RTN","BIVACED",10,0)
 ;---> Lookup Vaccines and edit their fields.
"RTN","BIVACED",11,0)
 D SETVARS^BIUTL5 K ^TMP("BILMVA",$J) N BITMP
"RTN","BIVACED",12,0)
 ;
"RTN","BIVACED",13,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIVACED",14,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIVACED",15,0)
 ;
"RTN","BIVACED",16,0)
 D EN
"RTN","BIVACED",17,0)
 D EXIT
"RTN","BIVACED",18,0)
 Q
"RTN","BIVACED",19,0)
 ;
"RTN","BIVACED",20,0)
 ;
"RTN","BIVACED",21,0)
 ;----------
"RTN","BIVACED",22,0)
EN ;EP
"RTN","BIVACED",23,0)
 D EN^VALM("BI VACCINE TABLE EDIT")
"RTN","BIVACED",24,0)
 Q
"RTN","BIVACED",25,0)
 ;
"RTN","BIVACED",26,0)
 ;
"RTN","BIVACED",27,0)
 ;----------
"RTN","BIVACED",28,0)
PRINT ;EP
"RTN","BIVACED",29,0)
 ;---> Print Vaccine Table.
"RTN","BIVACED",30,0)
 ;---> Called by Protocol BI VACCINE TABLE PRINT, which is the
"RTN","BIVACED",31,0)
 ;---> Print List Protocol for the List: BI VACCINE TABLE EDIT.
"RTN","BIVACED",32,0)
 ;
"RTN","BIVACED",33,0)
 D DEVICE(.BIPOP)
"RTN","BIVACED",34,0)
 I $G(BIPOP) D RESET Q
"RTN","BIVACED",35,0)
 ;
"RTN","BIVACED",36,0)
 D HDR(1),INIT^BIVACED1
"RTN","BIVACED",37,0)
 D PRTLST^BIUTL8("BILMVA")
"RTN","BIVACED",38,0)
 D RESET
"RTN","BIVACED",39,0)
 Q
"RTN","BIVACED",40,0)
 ;
"RTN","BIVACED",41,0)
 ;
"RTN","BIVACED",42,0)
 ;----------
"RTN","BIVACED",43,0)
HDR(BIPRT) ;EP
"RTN","BIVACED",44,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BIVACED",45,0)
 ;---> Parameters:
"RTN","BIVACED",46,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Change column
"RTN","BIVACED",47,0)
 ;                      header line and add Site Header line.
"RTN","BIVACED",48,0)
 ;
"RTN","BIVACED",49,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BIVACED",50,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIVACED",51,0)
 ;
"RTN","BIVACED",52,0)
 D WH^BIW(.BILINE)
"RTN","BIVACED",53,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIVACED",54,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVACED",55,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIVACED",56,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVACED",57,0)
 ;
"RTN","BIVACED",58,0)
 S X="VACCINE TABLE" S:'$G(BIPRT) X="EDIT "_X D CENTERT^BIUTL5(.X)
"RTN","BIVACED",59,0)
 S:BICRT X=IOINHI_X_IOINORM
"RTN","BIVACED",60,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVACED",61,0)
 ;
"RTN","BIVACED",62,0)
 D:$G(BIPRT)
"RTN","BIVACED",63,0)
 .S X=$$SP^BIUTL5(51)_"Printed: "_$$NOW^BIUTL5()
"RTN","BIVACED",64,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BIVACED",65,0)
 .S X="    #  Vaccine      HL7    Active      Default Lot#"
"RTN","BIVACED",66,0)
 .S X=X_"    VIS Default    Forecast"
"RTN","BIVACED",67,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIVACED",68,0)
 Q
"RTN","BIVACED",69,0)
 ;
"RTN","BIVACED",70,0)
 ;
"RTN","BIVACED",71,0)
 ;----------
"RTN","BIVACED",72,0)
INIT ;EP
"RTN","BIVACED",73,0)
 ;---> Initialize variables and list array.
"RTN","BIVACED",74,0)
 D INIT^BIVACED1
"RTN","BIVACED",75,0)
 Q
"RTN","BIVACED",76,0)
 ;
"RTN","BIVACED",77,0)
 ;
"RTN","BIVACED",78,0)
 ;----------
"RTN","BIVACED",79,0)
RESET ;EP
"RTN","BIVACED",80,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIVACED",81,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIVACED",82,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIVACED",83,0)
 D INIT,HDR() Q
"RTN","BIVACED",84,0)
 ;
"RTN","BIVACED",85,0)
 ;
"RTN","BIVACED",86,0)
 ;----------
"RTN","BIVACED",87,0)
DEVICE(BIPOP) ;EP
"RTN","BIVACED",88,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIVACED",89,0)
 ;---> Parameters:
"RTN","BIVACED",90,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIVACED",91,0)
 ;
"RTN","BIVACED",92,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIVACED",93,0)
 S ZTRTN="DEQUEUE^BIVACED"
"RTN","BIVACED",94,0)
 D ZSAVES^BIUTL3
"RTN","BIVACED",95,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIVACED",96,0)
 Q
"RTN","BIVACED",97,0)
 ;
"RTN","BIVACED",98,0)
 ;
"RTN","BIVACED",99,0)
 ;----------
"RTN","BIVACED",100,0)
DEQUEUE ;EP
"RTN","BIVACED",101,0)
 ;---> Print Patient Data screen.
"RTN","BIVACED",102,0)
 D HDR(1),INIT^BIVACED1
"RTN","BIVACED",103,0)
 D PRTLST^BIUTL8("BILMVA"),EXIT
"RTN","BIVACED",104,0)
 Q
"RTN","BIVACED",105,0)
 ;
"RTN","BIVACED",106,0)
 ;
"RTN","BIVACED",107,0)
 ;----------
"RTN","BIVACED",108,0)
HELP ;EP
"RTN","BIVACED",109,0)
 ;---> Help code.
"RTN","BIVACED",110,0)
 N BIX S BIX=X
"RTN","BIVACED",111,0)
 D FULL^VALM1
"RTN","BIVACED",112,0)
 W !!?5,"Enter ""E"" to edit a Vaccine, enter ""C"" to change the order of"
"RTN","BIVACED",113,0)
 W !?5,"the list, ""H"" to view the full help text for the vaccine list and"
"RTN","BIVACED",114,0)
 W !?5,"its parameters, ""F"" to turn on/off the forecasting of vaccines"
"RTN","BIVACED",115,0)
 W !?5,"and enter ""P"" to print the list."
"RTN","BIVACED",116,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIVACED",117,0)
 D:BIX'="??" RE^VALM4
"RTN","BIVACED",118,0)
 Q
"RTN","BIVACED",119,0)
 ;
"RTN","BIVACED",120,0)
 ;
"RTN","BIVACED",121,0)
 ;----------
"RTN","BIVACED",122,0)
HELP1 ;EP
"RTN","BIVACED",123,0)
 ;----> Explanation of this report.
"RTN","BIVACED",124,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIVACED",125,0)
 D START^BIHELP("EDIT VACCINE TABLE - HELP",.BITEXT)
"RTN","BIVACED",126,0)
 Q
"RTN","BIVACED",127,0)
 ;
"RTN","BIVACED",128,0)
 ;
"RTN","BIVACED",129,0)
 ;----------
"RTN","BIVACED",130,0)
TEXT1(BITEXT) ;EP
"RTN","BIVACED",131,0)
 ;;
"RTN","BIVACED",132,0)
 ;;This screen allows you to edit five fields of each Vaccine.
"RTN","BIVACED",133,0)
 ;;To Edit a particular Vaccine, type "E", then select the left
"RTN","BIVACED",134,0)
 ;;column number that corresponds to the Vaccine you wish to edit.
"RTN","BIVACED",135,0)
 ;;
"RTN","BIVACED",136,0)
 ;;* Active/Inactive - If a Vaccine is set to "Inactive", users will
"RTN","BIVACED",137,0)
 ;;     not be able to enter NEW patient immunizations for this vaccine.
"RTN","BIVACED",138,0)
 ;;     However, previous immunizations with this Vaccine will continue
"RTN","BIVACED",139,0)
 ;;     to show up on the patient histories.
"RTN","BIVACED",140,0)
 ;;
"RTN","BIVACED",141,0)
 ;;* Default Lot# - This is that Lot# that will be automatically
"RTN","BIVACED",142,0)
 ;;     entered in the Lot# field for this Vaccine when users are
"RTN","BIVACED",143,0)
 ;;     adding new immunizations for patients.  The user will be able
"RTN","BIVACED",144,0)
 ;;     to change or delete the default if it is not correct.
"RTN","BIVACED",145,0)
 ;;
"RTN","BIVACED",146,0)
 ;;* VIS Default - This is the Vaccine Information Statement (VIS)
"RTN","BIVACED",147,0)
 ;;     Date (Date of publication--not date given to patient).
"RTN","BIVACED",148,0)
 ;;     It gets entered automatically as in the VIS Date field
"RTN","BIVACED",149,0)
 ;;     when users are adding new immunizations for this Vaccine.
"RTN","BIVACED",150,0)
 ;;
"RTN","BIVACED",151,0)
 ;;* Volume Default - This is the default Volume of the injection for the
"RTN","BIVACED",152,0)
 ;;     given vaccine.  It gets entered automatically as in the Volume
"RTN","BIVACED",153,0)
 ;;     field when users are adding new immunizations for this Vaccine.
"RTN","BIVACED",154,0)
 ;;
"RTN","BIVACED",155,0)
 ;;* Forecasting - The Forecast column indicates whether a vaccine will
"RTN","BIVACED",156,0)
 ;;     be forecast (listed as due for patients) or not.  Each vaccine
"RTN","BIVACED",157,0)
 ;;     belongs to a VACCINE GROUP, for example, the HEP A GROUP.
"RTN","BIVACED",158,0)
 ;;     Turning OFF forecasting for the HEP A Vaccine Group will block
"RTN","BIVACED",159,0)
 ;;     all forecasting of any vaccines that contain Hep A vaccine.
"RTN","BIVACED",160,0)
 ;;     To change forecasting for a Vaccine Group, select the "Forecasting"
"RTN","BIVACED",161,0)
 ;;     Action at the bottom of the screen.
"RTN","BIVACED",162,0)
 ;;     NOTE: Combination vaccines will not be forecast specifically --
"RTN","BIVACED",163,0)
 ;;           their component vaccines will be forecast (if the patient
"RTN","BIVACED",164,0)
 ;;           is due).  Use of the combination vaccines is an option open
"RTN","BIVACED",165,0)
 ;;           to the provider.  Inputting combination vaccines into the
"RTN","BIVACED",166,0)
 ;;           patient's history will satisfy the requirements of the
"RTN","BIVACED",167,0)
 ;;           component vaccines.
"RTN","BIVACED",168,0)
 ;;
"RTN","BIVACED",169,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIVACED",170,0)
 Q
"RTN","BIVACED",171,0)
 ;
"RTN","BIVACED",172,0)
 ;
"RTN","BIVACED",173,0)
 ;----------
"RTN","BIVACED",174,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIVACED",175,0)
 Q:$G(BILINL)=""
"RTN","BIVACED",176,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIVACED",177,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIVACED",178,0)
 Q
"RTN","BIVACED",179,0)
 ;
"RTN","BIVACED",180,0)
 ;
"RTN","BIVACED",181,0)
 ;----------
"RTN","BIVACED",182,0)
EXIT ;EP
"RTN","BIVACED",183,0)
 ;---> End of job cleanup.
"RTN","BIVACED",184,0)
 D KILLALL^BIUTL8()
"RTN","BIVACED",185,0)
 K ^TMP("BILMVA",$J)
"RTN","BIVACED",186,0)
 D CLEAR^VALM1
"RTN","BIVACED",187,0)
 D FULL^VALM1
"RTN","BIVACED",188,0)
 Q
"RTN","BIVACED1")
0^161^B22682484
"RTN","BIVACED1",1,0)
BIVACED1 ;IHS/CMI/MWR - EDIT VACCINES.; MAY 10, 2010
"RTN","BIVACED1",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIVACED1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVACED1",4,0)
 ;;  EDIT VACCINE FIELDS: CURRENT LOT, ACTIVE, VIS DATE DEFAULT.
"RTN","BIVACED1",5,0)
 ;;  PATCH 1: Comment out unnecessary forecast check.  EDIT+34
"RTN","BIVACED1",6,0)
 ;;  PATCH 5: Display leading zero if default volume is less than 1.  INIT+53
"RTN","BIVACED1",7,0)
 ;
"RTN","BIVACED1",8,0)
 ;
"RTN","BIVACED1",9,0)
 ;----------
"RTN","BIVACED1",10,0)
INIT ;EP
"RTN","BIVACED1",11,0)
 ;---> Initialize variables and list array.
"RTN","BIVACED1",12,0)
 ;
"RTN","BIVACED1",13,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BIVACED1",14,0)
 S VALM("TITLE")=$$LMVER^BILOGO
"RTN","BIVACED1",15,0)
 ;
"RTN","BIVACED1",16,0)
 ;---> Build Listmanager array.
"RTN","BIVACED1",17,0)
 K ^TMP("BILMVA",$J),BIVAC
"RTN","BIVACED1",18,0)
 ;
"RTN","BIVACED1",19,0)
 N BILINE,BIENT,BIN,BIVAC1,I
"RTN","BIVACED1",20,0)
 S BILINE=0,BIENT=0,BIN=0
"RTN","BIVACED1",21,0)
 D
"RTN","BIVACED1",22,0)
 .;I '$D(BICVXD) S BIXREF="AC" Q
"RTN","BIVACED1",23,0)
 .I '$D(BICVXD) S BIXREF="U" Q
"RTN","BIVACED1",24,0)
 .S BIXREF="C"
"RTN","BIVACED1",25,0)
 ;
"RTN","BIVACED1",26,0)
 F  S BIN=$O(^AUTTIMM(BIXREF,BIN)) Q:BIN=""  D
"RTN","BIVACED1",27,0)
 .N BI0,BIIEN,X,Y
"RTN","BIVACED1",28,0)
 .S BIIEN=$O(^AUTTIMM(BIXREF,BIN,0))
"RTN","BIVACED1",29,0)
 .Q:$D(BIVAC1(BIIEN))
"RTN","BIVACED1",30,0)
 .S BIVAC1(BIIEN)="",BI0=^AUTTIMM(BIIEN,0)
"RTN","BIVACED1",31,0)
 .;
"RTN","BIVACED1",32,0)
 .;---> Set Item# and build Item# array=IEN of Vaccine.
"RTN","BIVACED1",33,0)
 .S BIENT=BIENT+1,BIVAC(BIENT)=BIIEN
"RTN","BIVACED1",34,0)
 .;
"RTN","BIVACED1",35,0)
 .;---> Item#.
"RTN","BIVACED1",36,0)
 .S X=" "_$S(BIENT<10:" "_BIENT,1:BIENT)
"RTN","BIVACED1",37,0)
 .;
"RTN","BIVACED1",38,0)
 .;---> Vaccine (Short) Name.
"RTN","BIVACED1",39,0)
 .S X=X_"  "_$P(BI0,U,2)
"RTN","BIVACED1",40,0)
 .S X=$$PAD^BIUTL5(X,17,".")
"RTN","BIVACED1",41,0)
 .;
"RTN","BIVACED1",42,0)
 .;---> HL7 Code.
"RTN","BIVACED1",43,0)
 .S X=X_"("_$P(BI0,U,3)_")"
"RTN","BIVACED1",44,0)
 .S X=$$PAD^BIUTL5(X,24,".")
"RTN","BIVACED1",45,0)
 .;
"RTN","BIVACED1",46,0)
 .;---> Active/Inactive.
"RTN","BIVACED1",47,0)
 .S X=X_$S($P(BI0,U,7)=1:"Inactive",$P(BI0,U,7)=0:"Active",1:"")
"RTN","BIVACED1",48,0)
 .;
"RTN","BIVACED1",49,0)
 .;---> Default Lot#.
"RTN","BIVACED1",50,0)
 .D:$P(BI0,U,4)
"RTN","BIVACED1",51,0)
 ..S X=$$PAD^BIUTL5(X,35,".")
"RTN","BIVACED1",52,0)
 ..S X=X_$$LOTTX^BIUTL6($P(BI0,U,4))
"RTN","BIVACED1",53,0)
 .;
"RTN","BIVACED1",54,0)
 .;---> VIS Default Date.
"RTN","BIVACED1",55,0)
 .D:$P(BI0,U,13)
"RTN","BIVACED1",56,0)
 ..S X=$$PAD^BIUTL5(X,50,".")
"RTN","BIVACED1",57,0)
 ..S X=X_$$SLDT2^BIUTL5($P(BI0,U,13),1)
"RTN","BIVACED1",58,0)
 .;
"RTN","BIVACED1",59,0)
 .;---> Volume Default.
"RTN","BIVACED1",60,0)
 .D:$P(BI0,U,18)
"RTN","BIVACED1",61,0)
 ..S X=$$PAD^BIUTL5(X,60,".")
"RTN","BIVACED1",62,0)
 ..;
"RTN","BIVACED1",63,0)
 ..;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVACED1",64,0)
 ..;---> Display leading zero if default volume is less than 1.
"RTN","BIVACED1",65,0)
 ..N Y S Y=$P(BI0,U,18) S:(Y<1) Y="0"_Y
"RTN","BIVACED1",66,0)
 ..S X=X_"  "_Y_" ml "
"RTN","BIVACED1",67,0)
 ..;S X=X_"  "_$P(BI0,U,18)_" ml "
"RTN","BIVACED1",68,0)
 ..;**********
"RTN","BIVACED1",69,0)
 .;
"RTN","BIVACED1",70,0)
 .;---> Forecast On/Off.
"RTN","BIVACED1",71,0)
 .S X=$$PAD^BIUTL5(X,72,".")
"RTN","BIVACED1",72,0)
 .S X=X_$S($$IMMVG^BIUTL2(BIIEN,3):"YES",1:"NO")
"RTN","BIVACED1",73,0)
 .;
"RTN","BIVACED1",74,0)
 .;---> Set this Vaccine display row and index in ^TMP.
"RTN","BIVACED1",75,0)
 .D WRITE(.BILINE,X,,BIENT)
"RTN","BIVACED1",76,0)
 .;D WRITE(.BILINE,,,BIENT)
"RTN","BIVACED1",77,0)
 ;
"RTN","BIVACED1",78,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIVACED1",79,0)
 S VALMCNT=BILINE
"RTN","BIVACED1",80,0)
 I VALMCNT>12 D
"RTN","BIVACED1",81,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIVACED1",82,0)
 Q
"RTN","BIVACED1",83,0)
 ;
"RTN","BIVACED1",84,0)
 ;
"RTN","BIVACED1",85,0)
 ;----------
"RTN","BIVACED1",86,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIVACED1",87,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIVACED1",88,0)
 ;---> Parameters:
"RTN","BIVACED1",89,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIVACED1",90,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIVACED1",91,0)
 ;
"RTN","BIVACED1",92,0)
 Q:'$D(BILINE)
"RTN","BIVACED1",93,0)
 D WL^BIW(.BILINE,"BILMVA",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BIVACED1",94,0)
 Q
"RTN","BIVACED1",95,0)
 ;
"RTN","BIVACED1",96,0)
 ;
"RTN","BIVACED1",97,0)
 ;----------
"RTN","BIVACED1",98,0)
EDIT ;EP
"RTN","BIVACED1",99,0)
 ;---> Edit a Vaccine.
"RTN","BIVACED1",100,0)
 ;---> Steps:
"RTN","BIVACED1",101,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIVACED1",102,0)
 ;               BI VACCINE EDIT, an action on the
"RTN","BIVACED1",103,0)
 ;               List Manager menu protocol: BI MENU VACCINE EDIT.
"RTN","BIVACED1",104,0)
 ;
"RTN","BIVACED1",105,0)
 ;            2) This code calls ScreenMan form:
"RTN","BIVACED1",106,0)
 ;               BI FORM-VACCINE EDIT to build BI local array
"RTN","BIVACED1",107,0)
 ;               of data for add/edit of a Vaccine.
"RTN","BIVACED1",108,0)
 ;               Data already stored in the BI local array is loaded
"RTN","BIVACED1",109,0)
 ;               into the form by LOADVAC^BIVACED1, which is called
"RTN","BIVACED1",110,0)
 ;               by the Pre-Action of Block for Vaccine Edit.
"RTN","BIVACED1",111,0)
 ;
"RTN","BIVACED1",112,0)
 ;            3) Use BI local array to send data to FDIE^BIFMAN.
"RTN","BIVACED1",113,0)
 ;
"RTN","BIVACED1",114,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BIVACED1",115,0)
 N VALMY
"RTN","BIVACED1",116,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIVACED1",117,0)
 ;
"RTN","BIVACED1",118,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIVACED1",119,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIVACED1",120,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BIVACED1",121,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIVACED1",122,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIVACED1",123,0)
 I $G(BIVAC(Y))="" D ERRCD^BIUTL2(502,,1) D RESET Q
"RTN","BIVACED1",124,0)
 N BIDA S BIDA=+BIVAC(Y)
"RTN","BIVACED1",125,0)
 I $G(^AUTTIMM(BIDA,0))="" D ERRCD^BIUTL2(502,,1) D RESET Q
"RTN","BIVACED1",126,0)
 D EDITSCR(BIDA)
"RTN","BIVACED1",127,0)
 D FULL^VALM1
"RTN","BIVACED1",128,0)
 D RESET
"RTN","BIVACED1",129,0)
 Q
"RTN","BIVACED1",130,0)
 ;
"RTN","BIVACED1",131,0)
 ;
"RTN","BIVACED1",132,0)
 ;----------
"RTN","BIVACED1",133,0)
EDITSCR(BIVAC) ;EP
"RTN","BIVACED1",134,0)
 ;---> Edit the fields of a vaccine.
"RTN","BIVACED1",135,0)
 ;---> Parameters:
"RTN","BIVACED1",136,0)
 ;     1 - BIVAC (req) Vaccine IEN.
"RTN","BIVACED1",137,0)
 ;
"RTN","BIVACED1",138,0)
 ;---> Check that IEN of vaccine is present.
"RTN","BIVACED1",139,0)
 I '$G(BIVAC) D ERRCD^BIUTL2(441,,1) Q
"RTN","BIVACED1",140,0)
 N Y S Y=^AUTTIMM(BIVAC,0)
"RTN","BIVACED1",141,0)
 N BI
"RTN","BIVACED1",142,0)
 S BI("A")=$P(Y,U,4)      ;Default Lot Number IEN.
"RTN","BIVACED1",143,0)
 S BI("B")=$P(Y,U,7)      ;Active/Inactive.
"RTN","BIVACED1",144,0)
 S BI("C")=$P(Y,U,13)     ;VIS Default Date.
"RTN","BIVACED1",145,0)
 S BI("D")=$P(Y,U,18)     ;Default Volume.
"RTN","BIVACED1",146,0)
 ;
"RTN","BIVACED1",147,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIVACED1",148,0)
 N BISAVE
"RTN","BIVACED1",149,0)
 N DR S DR="[BI FORM-VACCINE EDIT]"
"RTN","BIVACED1",150,0)
 D DDS^BIFMAN(9999999.14,DR,BIVAC,"S",.BISAVE,.BIPOP)
"RTN","BIVACED1",151,0)
 ;
"RTN","BIVACED1",152,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIVACED1",153,0)
 Q:('$G(BISAVE))
"RTN","BIVACED1",154,0)
 ;
"RTN","BIVACED1",155,0)
 ;---> Update data for this vaccine.  (Make this an RPC in the future?)
"RTN","BIVACED1",156,0)
 ;---> Add contraindication with a reason of Immune Deficiency.
"RTN","BIVACED1",157,0)
 N BIERR,BIFLD
"RTN","BIVACED1",158,0)
 S BIFLD(.04)=BI("A"),BIFLD(.07)=BI("B")
"RTN","BIVACED1",159,0)
 S BIFLD(.13)=BI("C"),BIFLD(.18)=BI("D")
"RTN","BIVACED1",160,0)
 D FDIE^BIFMAN(9999999.14,BIVAC,.BIFLD,.BIERR)
"RTN","BIVACED1",161,0)
 ;
"RTN","BIVACED1",162,0)
 ;---> If there was an error, display it.
"RTN","BIVACED1",163,0)
 D:$G(BIERR)]""
"RTN","BIVACED1",164,0)
 .D CLEAR^VALM1,FULL^VALM1,TITLE^BIUTL5("EDIT VACCINE FIELDS")
"RTN","BIVACED1",165,0)
 .W !!?3,BIERR D DIRZ^BIUTL3()
"RTN","BIVACED1",166,0)
 ;
"RTN","BIVACED1",167,0)
 Q
"RTN","BIVACED1",168,0)
 ;
"RTN","BIVACED1",169,0)
 ;
"RTN","BIVACED1",170,0)
 ;----------
"RTN","BIVACED1",171,0)
LOADVAC ;EP
"RTN","BIVACED1",172,0)
 ;---> Code to load Vaccine data for ScreenMan Edit form.
"RTN","BIVACED1",173,0)
 ;---> Called by Pre Action of Block BI BLK-VACCINE EDIT on
"RTN","BIVACED1",174,0)
 ;---> Form BI FORM-VACCINE EDIT.
"RTN","BIVACED1",175,0)
 ;
"RTN","BIVACED1",176,0)
 ;---> Load Parent/Guardian.
"RTN","BIVACED1",177,0)
 I $G(BI("A"))]"" D PUT^DDSVALF(1,,,BI("A"),"I")
"RTN","BIVACED1",178,0)
 ;
"RTN","BIVACED1",179,0)
 ;---> Load Active status.
"RTN","BIVACED1",180,0)
 I $G(BI("B"))]"" D PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BIVACED1",181,0)
 ;
"RTN","BIVACED1",182,0)
 ;---> Load VIS Default Date.
"RTN","BIVACED1",183,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(3,,,BI("C"),"I")
"RTN","BIVACED1",184,0)
 ;
"RTN","BIVACED1",185,0)
 ;---> Load Mother's HBsAG Status.
"RTN","BIVACED1",186,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(4,,,BI("D"),"I")
"RTN","BIVACED1",187,0)
 ;
"RTN","BIVACED1",188,0)
 Q
"RTN","BIVACED1",189,0)
 ;
"RTN","BIVACED1",190,0)
 ;
"RTN","BIVACED1",191,0)
 ;----------
"RTN","BIVACED1",192,0)
RESET ;EP
"RTN","BIVACED1",193,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIVACED1",194,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIVACED1",195,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIVACED1",196,0)
 D INIT^BIVACED,HDR^BIVACED()
"RTN","BIVACED1",197,0)
 Q
"RTN","BIVACED1",198,0)
 ;
"RTN","BIVACED1",199,0)
 ;
"RTN","BIVACED1",200,0)
 ;----------
"RTN","BIVACED1",201,0)
CHGORDR ;EP
"RTN","BIVACED1",202,0)
 ;---> Change order of display of Vaccine Table (by Short Name or CVX).
"RTN","BIVACED1",203,0)
 D
"RTN","BIVACED1",204,0)
 .I '$D(BICVXD) S BICVXD="" Q
"RTN","BIVACED1",205,0)
 .K BICVXD
"RTN","BIVACED1",206,0)
 D RESET
"RTN","BIVACED1",207,0)
 Q
"RTN","BIVGRP")
0^162^B14770178
"RTN","BIVGRP",1,0)
BIVGRP ;IHS/CMI/MWR - EDIT VACCINE GROUPS.; MAY 10, 2010
"RTN","BIVGRP",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIVGRP",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVGRP",4,0)
 ;;  EDIT VACCINE GROUPS TO TURN ON/OFF FORECASTING FOR EACH GROUP.
"RTN","BIVGRP",5,0)
 ;
"RTN","BIVGRP",6,0)
 ;
"RTN","BIVGRP",7,0)
 ;
"RTN","BIVGRP",8,0)
 ;----------
"RTN","BIVGRP",9,0)
START ;EP
"RTN","BIVGRP",10,0)
 ;---> Lookup Vaccines and edit their fields.
"RTN","BIVGRP",11,0)
 D SETVARS^BIUTL5 K ^TMP("BIVGRP",$J) N BITMP
"RTN","BIVGRP",12,0)
 ;
"RTN","BIVGRP",13,0)
 ;---> If Vaccine Table is not standard, display Error Text and quit.
"RTN","BIVGRP",14,0)
 I $D(^BISITE(-1)) D ERRCD^BIUTL2(503,,1) Q
"RTN","BIVGRP",15,0)
 ;
"RTN","BIVGRP",16,0)
 D EN
"RTN","BIVGRP",17,0)
 D EXIT
"RTN","BIVGRP",18,0)
 Q
"RTN","BIVGRP",19,0)
 ;
"RTN","BIVGRP",20,0)
 ;
"RTN","BIVGRP",21,0)
 ;----------
"RTN","BIVGRP",22,0)
EN ;EP
"RTN","BIVGRP",23,0)
 D EN^VALM("BI VACCINE GROUP TABLE EDIT")
"RTN","BIVGRP",24,0)
 Q
"RTN","BIVGRP",25,0)
 ;
"RTN","BIVGRP",26,0)
 ;
"RTN","BIVGRP",27,0)
 ;----------
"RTN","BIVGRP",28,0)
PRINT ;EP
"RTN","BIVGRP",29,0)
 ;---> Print Vaccine Table.
"RTN","BIVGRP",30,0)
 ;---> Called by Protocol BI VACCINE TABLE PRINT, which is the
"RTN","BIVGRP",31,0)
 ;---> Print List Protocol for the List: BI VACCINE TABLE EDIT.
"RTN","BIVGRP",32,0)
 ;
"RTN","BIVGRP",33,0)
 D DEVICE(.BIPOP)
"RTN","BIVGRP",34,0)
 I $G(BIPOP) D RESET Q
"RTN","BIVGRP",35,0)
 ;
"RTN","BIVGRP",36,0)
 D HDR(1),INIT^BIVGRP1
"RTN","BIVGRP",37,0)
 D PRTLST^BIUTL8("BIVGRP")
"RTN","BIVGRP",38,0)
 D RESET
"RTN","BIVGRP",39,0)
 Q
"RTN","BIVGRP",40,0)
 ;
"RTN","BIVGRP",41,0)
 ;
"RTN","BIVGRP",42,0)
 ;----------
"RTN","BIVGRP",43,0)
HDR(BIPRT) ;EP
"RTN","BIVGRP",44,0)
 ;---> Header code for both Listman Screen and Print List.
"RTN","BIVGRP",45,0)
 ;---> Parameters:
"RTN","BIVGRP",46,0)
 ;     1 - BIPRT  (opt) If BIPRT=1 array is for print: Change column
"RTN","BIVGRP",47,0)
 ;                      header line and add Site Header line.
"RTN","BIVGRP",48,0)
 ;
"RTN","BIVGRP",49,0)
 N BILINE,X,Y S BILINE=0 K VALMHDR
"RTN","BIVGRP",50,0)
 N BICRT S BICRT=$S(($E($G(IOST))="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIVGRP",51,0)
 ;
"RTN","BIVGRP",52,0)
 D WH^BIW(.BILINE)
"RTN","BIVGRP",53,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIVGRP",54,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVGRP",55,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIVGRP",56,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVGRP",57,0)
 ;
"RTN","BIVGRP",58,0)
 S X="VACCINE GROUP FORCASTING" S:'$G(BIPRT) X="EDIT "_X D CENTERT^BIUTL5(.X)
"RTN","BIVGRP",59,0)
 S:BICRT X=IOINHI_X_IOINORM
"RTN","BIVGRP",60,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVGRP",61,0)
 ;
"RTN","BIVGRP",62,0)
 D:$G(BIPRT)
"RTN","BIVGRP",63,0)
 .S X=$$SP^BIUTL5(51)_"Printed: "_$$NOW^BIUTL5()
"RTN","BIVGRP",64,0)
 .D WH^BIW(.BILINE,X,1)
"RTN","BIVGRP",65,0)
 .S X="    #  Vaccine Group      Forecast"
"RTN","BIVGRP",66,0)
 .D WH^BIW(.BILINE,X)
"RTN","BIVGRP",67,0)
 Q
"RTN","BIVGRP",68,0)
 ;
"RTN","BIVGRP",69,0)
 ;
"RTN","BIVGRP",70,0)
 ;----------
"RTN","BIVGRP",71,0)
INIT ;EP
"RTN","BIVGRP",72,0)
 ;---> Initialize variables and list array.
"RTN","BIVGRP",73,0)
 D INIT^BIVGRP1
"RTN","BIVGRP",74,0)
 Q
"RTN","BIVGRP",75,0)
 ;
"RTN","BIVGRP",76,0)
 ;
"RTN","BIVGRP",77,0)
 ;----------
"RTN","BIVGRP",78,0)
RESET ;EP
"RTN","BIVGRP",79,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIVGRP",80,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIVGRP",81,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIVGRP",82,0)
 D INIT,HDR() Q
"RTN","BIVGRP",83,0)
 ;
"RTN","BIVGRP",84,0)
 ;
"RTN","BIVGRP",85,0)
 ;----------
"RTN","BIVGRP",86,0)
DEVICE(BIPOP) ;EP
"RTN","BIVGRP",87,0)
 ;---> Get Device and possibly queue to Taskman.
"RTN","BIVGRP",88,0)
 ;---> Parameters:
"RTN","BIVGRP",89,0)
 ;     1 - BIPOP (ret) If error or Queue, BIPOP=1
"RTN","BIVGRP",90,0)
 ;
"RTN","BIVGRP",91,0)
 K %ZIS,IOP S BIPOP=0
"RTN","BIVGRP",92,0)
 S ZTRTN="DEQUEUE^BIVGRP"
"RTN","BIVGRP",93,0)
 D ZSAVES^BIUTL3
"RTN","BIVGRP",94,0)
 D ZIS^BIUTL2(.BIPOP,1)
"RTN","BIVGRP",95,0)
 Q
"RTN","BIVGRP",96,0)
 ;
"RTN","BIVGRP",97,0)
 ;
"RTN","BIVGRP",98,0)
 ;----------
"RTN","BIVGRP",99,0)
DEQUEUE ;EP
"RTN","BIVGRP",100,0)
 ;---> Print Patient Data screen.
"RTN","BIVGRP",101,0)
 D HDR(1),INIT^BIVGRP1
"RTN","BIVGRP",102,0)
 D PRTLST^BIUTL8("BIVGRP"),EXIT
"RTN","BIVGRP",103,0)
 Q
"RTN","BIVGRP",104,0)
 ;
"RTN","BIVGRP",105,0)
 ;
"RTN","BIVGRP",106,0)
 ;----------
"RTN","BIVGRP",107,0)
HELP ;EP
"RTN","BIVGRP",108,0)
 ;---> Help code.
"RTN","BIVGRP",109,0)
 N BIX S BIX=X
"RTN","BIVGRP",110,0)
 D FULL^VALM1
"RTN","BIVGRP",111,0)
 W !!?5,"To turn On or Off forecasting for a Vaccine Group, enter ""C"" then enter"
"RTN","BIVGRP",112,0)
 W !?5,"the left column number of the Vaccine Group you wish to change."
"RTN","BIVGRP",113,0)
 D DIRZ^BIUTL3("","     Press ENTER/RETURN to continue")
"RTN","BIVGRP",114,0)
 D:BIX'="??" RE^VALM4
"RTN","BIVGRP",115,0)
 Q
"RTN","BIVGRP",116,0)
 ;
"RTN","BIVGRP",117,0)
 ;
"RTN","BIVGRP",118,0)
 ;----------
"RTN","BIVGRP",119,0)
EXPL ;EP
"RTN","BIVGRP",120,0)
 ;----> Explanation of this report.
"RTN","BIVGRP",121,0)
 N BITEXT D TEXT1(.BITEXT)
"RTN","BIVGRP",122,0)
 D START^BIHELP("EDIT VACCINE GROUP TABLE - HELP",.BITEXT)
"RTN","BIVGRP",123,0)
 Q
"RTN","BIVGRP",124,0)
 ;
"RTN","BIVGRP",125,0)
 ;
"RTN","BIVGRP",126,0)
 ;----------
"RTN","BIVGRP",127,0)
TEXT1(BITEXT) ;EP
"RTN","BIVGRP",128,0)
 ;;
"RTN","BIVGRP",129,0)
 ;;This screen allows you to turn on or off forecasting for a particular
"RTN","BIVGRP",130,0)
 ;;Vaccine Group.
"RTN","BIVGRP",131,0)
 ;;
"RTN","BIVGRP",132,0)
 ;;* CHANGE ALL THIS...IF USED.  FOR NOW, NO "EXPLANATION" ON THIS LIST TEMPLATE.
"RTN","BIVGRP",133,0)
 ;;
"RTN","BIVGRP",134,0)
 D LOADTX("TEXT1",,.BITEXT)
"RTN","BIVGRP",135,0)
 Q
"RTN","BIVGRP",136,0)
 ;
"RTN","BIVGRP",137,0)
 ;
"RTN","BIVGRP",138,0)
 ;----------
"RTN","BIVGRP",139,0)
LOADTX(BILINL,BITAB,BITEXT) ;EP
"RTN","BIVGRP",140,0)
 Q:$G(BILINL)=""
"RTN","BIVGRP",141,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIVGRP",142,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  S BITEXT(I)=T_$P(X,";;",2)
"RTN","BIVGRP",143,0)
 Q
"RTN","BIVGRP",144,0)
 ;
"RTN","BIVGRP",145,0)
 ;
"RTN","BIVGRP",146,0)
 ;----------
"RTN","BIVGRP",147,0)
EXIT ;EP
"RTN","BIVGRP",148,0)
 ;---> End of job cleanup.
"RTN","BIVGRP",149,0)
 D KILLALL^BIUTL8()
"RTN","BIVGRP",150,0)
 K ^TMP("BIVGRP",$J)
"RTN","BIVGRP",151,0)
 D CLEAR^VALM1
"RTN","BIVGRP",152,0)
 D FULL^VALM1
"RTN","BIVGRP",153,0)
 ;---> Update the Vaccine Edit Screen with any Vaccine Group changes.
"RTN","BIVGRP",154,0)
 D RESET^BIVACED
"RTN","BIVGRP",155,0)
 Q
"RTN","BIVGRP1")
0^163^B11417238
"RTN","BIVGRP1",1,0)
BIVGRP1 ;IHS/CMI/MWR - EDIT VACCINES.; MAY 10, 2010
"RTN","BIVGRP1",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIVGRP1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVGRP1",4,0)
 ;;  EDIT VACCINE FIELDS: CURRENT LOT, ACTIVE, VIS DATE DEFAULT.
"RTN","BIVGRP1",5,0)
 ;
"RTN","BIVGRP1",6,0)
 ;
"RTN","BIVGRP1",7,0)
 ;----------
"RTN","BIVGRP1",8,0)
INIT ;EP
"RTN","BIVGRP1",9,0)
 ;---> Initialize variables and list array.
"RTN","BIVGRP1",10,0)
 ;
"RTN","BIVGRP1",11,0)
 S VALMSG="Enter ""C"" to Change a Vaccine Group."
"RTN","BIVGRP1",12,0)
 S VALM("TITLE")=" Immunization v"_$$VER^BILOGO
"RTN","BIVGRP1",13,0)
 ;
"RTN","BIVGRP1",14,0)
 ;---> Build Listmanager array.
"RTN","BIVGRP1",15,0)
 K ^TMP("BIVGRP",$J),BIVAC
"RTN","BIVGRP1",16,0)
 ;
"RTN","BIVGRP1",17,0)
 N BILINE,BIENT,BIN,BIVAC1,I
"RTN","BIVGRP1",18,0)
 S BILINE=0,BIENT=0,BIN=0
"RTN","BIVGRP1",19,0)
 S BIXREF="B"
"RTN","BIVGRP1",20,0)
 ;
"RTN","BIVGRP1",21,0)
 F  S BIN=$O(^BISERT(BIXREF,BIN)) Q:BIN=""  D
"RTN","BIVGRP1",22,0)
 .N BI0,BIIEN,X,Y
"RTN","BIVGRP1",23,0)
 .S BIIEN=$O(^BISERT(BIXREF,BIN,0))
"RTN","BIVGRP1",24,0)
 .Q:$D(BIVAC1(BIIEN))
"RTN","BIVGRP1",25,0)
 .S BIVAC1(BIIEN)="",BI0=^BISERT(BIIEN,0)
"RTN","BIVGRP1",26,0)
 .;--->Quit if this group should not be displayed.
"RTN","BIVGRP1",27,0)
 .Q:'$P(BI0,U,6)
"RTN","BIVGRP1",28,0)
 .;
"RTN","BIVGRP1",29,0)
 .;---> Set Item# and build Item# array=IEN of Vaccine.
"RTN","BIVGRP1",30,0)
 .S BIENT=BIENT+1,BIVAC(BIENT)=BIIEN
"RTN","BIVGRP1",31,0)
 .;
"RTN","BIVGRP1",32,0)
 .;---> Item#.
"RTN","BIVGRP1",33,0)
 .S X="   "_$S(BIENT<10:" "_BIENT,1:BIENT)
"RTN","BIVGRP1",34,0)
 .;
"RTN","BIVGRP1",35,0)
 .;---> Vaccine (Short) Name.
"RTN","BIVGRP1",36,0)
 .S X=X_"  "_$P(BI0,U)
"RTN","BIVGRP1",37,0)
 .S X=$$PAD^BIUTL5(X,24,".")
"RTN","BIVGRP1",38,0)
 .;
"RTN","BIVGRP1",39,0)
 .;---> Forecast Exclude/Include.
"RTN","BIVGRP1",40,0)
 .S X=X_$S($P(BI0,U,5):"YES",1:"NO")
"RTN","BIVGRP1",41,0)
 .;
"RTN","BIVGRP1",42,0)
 .;---> Set this Vaccine display row and index in ^TMP.
"RTN","BIVGRP1",43,0)
 .D WRITE(.BILINE,X,,BIENT)
"RTN","BIVGRP1",44,0)
 .;D WRITE(.BILINE,,,BIENT)
"RTN","BIVGRP1",45,0)
 ;
"RTN","BIVGRP1",46,0)
 ;---> Finish up Listmanager List Count.
"RTN","BIVGRP1",47,0)
 S VALMCNT=BILINE
"RTN","BIVGRP1",48,0)
 I VALMCNT>12 D
"RTN","BIVGRP1",49,0)
 .S VALMSG="Scroll down to view more. Type ?? for more actions."
"RTN","BIVGRP1",50,0)
 Q
"RTN","BIVGRP1",51,0)
 ;
"RTN","BIVGRP1",52,0)
 ;
"RTN","BIVGRP1",53,0)
 ;----------
"RTN","BIVGRP1",54,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIVGRP1",55,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIVGRP1",56,0)
 ;---> Parameters:
"RTN","BIVGRP1",57,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIVGRP1",58,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIVGRP1",59,0)
 ;
"RTN","BIVGRP1",60,0)
 Q:'$D(BILINE)
"RTN","BIVGRP1",61,0)
 D WL^BIW(.BILINE,"BIVGRP",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BIVGRP1",62,0)
 Q
"RTN","BIVGRP1",63,0)
 ;
"RTN","BIVGRP1",64,0)
 ;
"RTN","BIVGRP1",65,0)
 ;----------
"RTN","BIVGRP1",66,0)
EDIT ;EP
"RTN","BIVGRP1",67,0)
 ;---> Edit a Vaccine.
"RTN","BIVGRP1",68,0)
 ;---> Call the Listmanager Generic Selector of items displayed.
"RTN","BIVGRP1",69,0)
 N VALMY
"RTN","BIVGRP1",70,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIVGRP1",71,0)
 ;
"RTN","BIVGRP1",72,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIVGRP1",73,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIVGRP1",74,0)
 ;---> Now set Y=Item# selected from the list.
"RTN","BIVGRP1",75,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIVGRP1",76,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIVGRP1",77,0)
 I $G(BIVAC(Y))="" D ERRCD^BIUTL2(510,,1) D RESET Q
"RTN","BIVGRP1",78,0)
 N BIDA S BIDA=+BIVAC(Y)
"RTN","BIVGRP1",79,0)
 I $G(^BISERT(BIDA,0))="" D ERRCD^BIUTL2(510,,1) D RESET Q
"RTN","BIVGRP1",80,0)
 ;
"RTN","BIVGRP1",81,0)
 ;---> Save previous setting of Forecast Yes/No (0=YES,1=NO).
"RTN","BIVGRP1",82,0)
 N BIFORC S BIFORC=$P(^BISERT(BIDA,0),U,5)
"RTN","BIVGRP1",83,0)
 D
"RTN","BIVGRP1",84,0)
 .I BIFORC=1 S $P(^BISERT(BIDA,0),U,5)=0 Q
"RTN","BIVGRP1",85,0)
 .S $P(^BISERT(BIDA,0),U,5)=1
"RTN","BIVGRP1",86,0)
 D RESET
"RTN","BIVGRP1",87,0)
 Q
"RTN","BIVGRP1",88,0)
 ;
"RTN","BIVGRP1",89,0)
 ;
"RTN","BIVGRP1",90,0)
 ;----------
"RTN","BIVGRP1",91,0)
DISPLAY ;EP
"RTN","BIVGRP1",92,0)
 I $G(BIPOP) D FULL^VALM1,RESET Q
"RTN","BIVGRP1",93,0)
 ;
"RTN","BIVGRP1",94,0)
 ;---> *** THE FOLLOWING CODE COULD BE USED TO DISPLAY WHICH VACCINES ARE
"RTN","BIVGRP1",95,0)
 ;--->     AFFECTED BY TURNING ON/OFF A VACCINE GROUP.  NOT USED FOR NOW. ***
"RTN","BIVGRP1",96,0)
 D
"RTN","BIVGRP1",97,0)
 .Q
"RTN","BIVGRP1",98,0)
 .;
"RTN","BIVGRP1",99,0)
 .N BINF D CONTRHL7^BIUTL11(BIDA,.BINF)
"RTN","BIVGRP1",100,0)
 .Q:'$D(BINF)
"RTN","BIVGRP1",101,0)
 .;
"RTN","BIVGRP1",102,0)
 .N N,BIHDR S N=0
"RTN","BIVGRP1",103,0)
 .F  S N=$O(BINF(N)) Q:'N  D
"RTN","BIVGRP1",104,0)
 ..N BIIEN S BIIEN=$$HL7TX^BIUTL2(N)
"RTN","BIVGRP1",105,0)
 ..Q:'BIIEN
"RTN","BIVGRP1",106,0)
 ..Q:BIIEN=BIDA
"RTN","BIVGRP1",107,0)
 ..D:'$G(BIHDR)  S BIHDR=1
"RTN","BIVGRP1",108,0)
 ...W !!?5,"The following related Vaccines will also change:"
"RTN","BIVGRP1",109,0)
 ...W !!?5,"VACCINE        FORECAST",!?5,"-----------------------"
"RTN","BIVGRP1",110,0)
 ..S $P(^AUTTIMM(BIIEN,0),U,16)=BIFORC1
"RTN","BIVGRP1",111,0)
 ..W !?5,$$VNAME^BIUTL2(BIIEN),?20,$S(BIFORC1:"NO",1:"YES")
"RTN","BIVGRP1",112,0)
 ;
"RTN","BIVGRP1",113,0)
 D DIRZ^BIUTL3()
"RTN","BIVGRP1",114,0)
 D FULL^VALM1
"RTN","BIVGRP1",115,0)
 D RESET
"RTN","BIVGRP1",116,0)
 Q
"RTN","BIVGRP1",117,0)
 ;
"RTN","BIVGRP1",118,0)
 ;
"RTN","BIVGRP1",119,0)
 ;----------
"RTN","BIVGRP1",120,0)
RESET ;EP
"RTN","BIVGRP1",121,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIVGRP1",122,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIVGRP1",123,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIVGRP1",124,0)
 D INIT^BIVGRP,HDR^BIVGRP()
"RTN","BIVGRP1",125,0)
 Q
"RTN","BIVISIT")
0^164^B112358141
"RTN","BIVISIT",1,0)
BIVISIT ;IHS/CMI/MWR - ADD/EDIT IMM/SKIN VISITS.; MAY 10, 2010
"RTN","BIVISIT",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIVISIT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVISIT",4,0)
 ;;  CODE TO ADD V IMMUNIZATION AND V SKIN TEST VISITS.  CALLED BY BIRPC3.
"RTN","BIVISIT",5,0)
 ;;  PATCH 3: Set DATE/TIME LAST MODIFIED  VFILE+155, +192
"RTN","BIVISIT",6,0)
 ;;  PATCH 5: Added BINOM parameter to ADDEDIT P.E.P. for Visit Selection Menu. ADDV+0
"RTN","BIVISIT",7,0)
 ;;           Added Admin Note, piece 27.  PARSE+36,+66, ADDV+16, VFILE+13,+184
"RTN","BIVISIT",8,0)
 ;;           Moved TRIGADD to rtn BIVISIT2 for RSIZE.  TRIGADD+0
"RTN","BIVISIT",9,0)
 ;;  PATCH 9: Added save of Admin Date and VIS Presented Date.  VFILE+200
"RTN","BIVISIT",10,0)
 ;;           If >19yrs on date of immunization and Elig="", set Elig-V01.  VFILE+188
"RTN","BIVISIT",11,0)
 ;
"RTN","BIVISIT",12,0)
 ;
"RTN","BIVISIT",13,0)
 ;----------
"RTN","BIVISIT",14,0)
PARSE(Y,Z) ;EP
"RTN","BIVISIT",15,0)
 ;---> Parse out passed Visit and V File data into local variables.
"RTN","BIVISIT",16,0)
 ;---> Parameters:
"RTN","BIVISIT",17,0)
 ;     1 - Y (req) String of data for the Visit to be added.
"RTN","BIVISIT",18,0)
 ;     2 - Z (opt) If Z=1 do NOT set BIVSIT (call from VFILE below must
"RTN","BIVISIT",19,0)
 ;                 preserve new Visit IEN sent to it).
"RTN","BIVISIT",20,0)
 ;
"RTN","BIVISIT",21,0)
 ;---> Pieces of Y delimited by "|":
"RTN","BIVISIT",22,0)
 ;     -----------------------------
"RTN","BIVISIT",23,0)
 ;     1 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIVISIT",24,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIVISIT",25,0)
 ;     3 - BIPTR   (req) Vaccine or Skin Test .01 pointer.
"RTN","BIVISIT",26,0)
 ;     4 - BIDOSE  (opt) Dose# number for this Immunization.
"RTN","BIVISIT",27,0)
 ;     5 - BILOT   (opt) Lot Number IEN for this Immunization.
"RTN","BIVISIT",28,0)
 ;     6 - BIDATE  (req) Date.Time of Visit.
"RTN","BIVISIT",29,0)
 ;     7 - BILOC   (req) Location of encounter IEN.
"RTN","BIVISIT",30,0)
 ;     8 - BIOLOC  (opt) Other Location of encounter.
"RTN","BIVISIT",31,0)
 ;     9 - BICAT   (req) Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIVISIT",32,0)
 ;    10 - BIVSIT  (opt) Visit IEN.
"RTN","BIVISIT",33,0)
 ;    11 - BIOIEN  (opt) Old V File IEN (for edits).
"RTN","BIVISIT",34,0)
 ;    12 - BIRES   (req) Skin Test Result: P,N,D,O.
"RTN","BIVISIT",35,0)
 ;    13 - BIREA   (req) Skin Test Reading: 0-40.
"RTN","BIVISIT",36,0)
 ;    14 - BIDTR   (req) Skin Test Date Read.
"RTN","BIVISIT",37,0)
 ;    15 - BIREC   (opt) Vaccine Reaction.
"RTN","BIVISIT",38,0)
 ;    16 - BIVFC   (opt) VFC Eligibility.  vvv83
"RTN","BIVISIT",39,0)
 ;    17 - BIVISD  (opt) Release/Revision Date of VIS (YYYMMDD).
"RTN","BIVISIT",40,0)
 ;    18 - BIPROV  (opt) IEN of Provider of Immunization/Skin Test.
"RTN","BIVISIT",41,0)
 ;    19 - BIOVRD  (opt) Dose Override.
"RTN","BIVISIT",42,0)
 ;    20 - BIINJS  (opt) Injection Site.
"RTN","BIVISIT",43,0)
 ;    21 - BIVOL   (opt) Volume.
"RTN","BIVISIT",44,0)
 ;    22 - BIREDR  (opt) IEN of Reader of Skin Test.
"RTN","BIVISIT",45,0)
 ;    23 - BISITE  (opt) Passed DUZ(2) for Site Parameters.
"RTN","BIVISIT",46,0)
 ;    24 - BICCPT  (opt) If created from CPT ^DD BICCPT=1 or IEN; otherwise=""
"RTN","BIVISIT",47,0)
 ;                       (called from BIRPC6
"RTN","BIVISIT",48,0)
 ;    25 - BIMPRT  (opt) If =1 it was imported.
"RTN","BIVISIT",49,0)
 ;    26 - BINDC   (opt) NDC Code IEN pointer to file #9002084.95.
"RTN","BIVISIT",50,0)
 ;    27 - BIANOT  (opt) Administrative Note (<161 chars).
"RTN","BIVISIT",51,0)
 ;
"RTN","BIVISIT",52,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIVISIT",53,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIVISIT",54,0)
 ;    28 - BIADMIN (opt) Admin Date (Date shot admin'd to patient.
"RTN","BIVISIT",55,0)
 ;    29 - BIVPRES (opt) Date VIS Presented to Patient.
"RTN","BIVISIT",56,0)
 ;
"RTN","BIVISIT",57,0)
 N V S V="|"
"RTN","BIVISIT",58,0)
 ;
"RTN","BIVISIT",59,0)
 S BIVTYPE=$P(Y,V,1)
"RTN","BIVISIT",60,0)
 S BIDFN=$P(Y,V,2)
"RTN","BIVISIT",61,0)
 S BIPTR=$P(Y,V,3)
"RTN","BIVISIT",62,0)
 S BIDOSE=$P(Y,V,4)
"RTN","BIVISIT",63,0)
 S BILOT=$P(Y,V,5)
"RTN","BIVISIT",64,0)
 S BIDATE=$P(Y,V,6) S:$P(BIDATE,".",2)="" BIDATE=BIDATE_".12"
"RTN","BIVISIT",65,0)
 S BILOC=$P(Y,V,7)
"RTN","BIVISIT",66,0)
 S BIOLOC=$P(Y,V,8)
"RTN","BIVISIT",67,0)
 S BICAT=$P(Y,V,9)
"RTN","BIVISIT",68,0)
 S:'$G(Z) BIVSIT=$P(Y,V,10)
"RTN","BIVISIT",69,0)
 S BIOIEN=$P(Y,V,11)
"RTN","BIVISIT",70,0)
 S BIRES=$P(Y,V,12)
"RTN","BIVISIT",71,0)
 S BIREA=$P(Y,V,13)
"RTN","BIVISIT",72,0)
 S BIDTR=$P(Y,V,14) S:BIDTR<1 BIDTR=""
"RTN","BIVISIT",73,0)
 S BIREC=$P(Y,V,15)
"RTN","BIVISIT",74,0)
 S BIVFC=$P(Y,V,16)  ;vvv83
"RTN","BIVISIT",75,0)
 S BIVISD=$P(Y,V,17)
"RTN","BIVISIT",76,0)
 S BIPROV=$P(Y,V,18)
"RTN","BIVISIT",77,0)
 S BIOVRD=$P(Y,V,19)
"RTN","BIVISIT",78,0)
 S BIINJS=$P(Y,V,20)
"RTN","BIVISIT",79,0)
 S BIVOL=$P(Y,V,21)
"RTN","BIVISIT",80,0)
 S BIREDR=$P(Y,V,22)
"RTN","BIVISIT",81,0)
 S BISITE=$P(Y,V,23)
"RTN","BIVISIT",82,0)
 S BICCPT=$P(Y,V,24)
"RTN","BIVISIT",83,0)
 S BIMPRT=$P(Y,V,25)
"RTN","BIVISIT",84,0)
 S BINDC=$P(Y,V,26)
"RTN","BIVISIT",85,0)
 S BIANOT=$P(Y,V,27)
"RTN","BIVISIT",86,0)
 S BIADMIN=$P(Y,V,28)
"RTN","BIVISIT",87,0)
 S BIVPRES=$P(Y,V,29)
"RTN","BIVISIT",88,0)
 ;**********
"RTN","BIVISIT",89,0)
 Q
"RTN","BIVISIT",90,0)
 ;
"RTN","BIVISIT",91,0)
 ;
"RTN","BIVISIT",92,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",93,0)
 ;---> Added BINOM parameter to control Visit Menu display.
"RTN","BIVISIT",94,0)
 ;----------
"RTN","BIVISIT",95,0)
ADDV(BIERR,BIDATA,BIOIEN,BINOM) ;EP
"RTN","BIVISIT",96,0)
 ;---> Add a Visit (if necessary) and V FILE entry for this patient.
"RTN","BIVISIT",97,0)
 ;---> Called exclusively by ^BIRPC3.
"RTN","BIVISIT",98,0)
 ;---> Parameters:
"RTN","BIVISIT",99,0)
 ;     1 - BIERR  (ret) 1^Text of Error Code if any, otherwise null.
"RTN","BIVISIT",100,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIVISIT",101,0)
 ;                      See BIDATA definition at linelabel PARSE (above).
"RTN","BIVISIT",102,0)
 ;     3 - BIOIEN (opt) IEN of V IMM or V SKIN being edited (if
"RTN","BIVISIT",103,0)
 ;                      not new).
"RTN","BIVISIT",104,0)
 ;     4 - BINOM  (opt) 0=Allow display of Visit Selection Menu if site
"RTN","BIVISIT",105,0)
 ;                       parameter is set. 1=No display (for export).
"RTN","BIVISIT",106,0)
 ;
"RTN","BIVISIT",107,0)
 I BIDATA="" D ERRCD^BIUTL2(437,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT",108,0)
 ;
"RTN","BIVISIT",109,0)
 N BIVTYPE,BIDFN,BIPTR,BIDOSE,BILOT,BIDATE,BILOC,BIOLOC,BICAT,BIVSIT
"RTN","BIVISIT",110,0)
 N BIOIEN,BIRES,BIREA,BIDTR,BIREC,BIVISD,BIPROV,BIOVRD,BIINJS,BIVOL
"RTN","BIVISIT",111,0)
 N BIREDR,BISITE,BICCPT,BIMPRT,BIANOT
"RTN","BIVISIT",112,0)
 ;
"RTN","BIVISIT",113,0)
 ;---> See BIDATA definition at linelabel PARSE.
"RTN","BIVISIT",114,0)
 D PARSE(BIDATA)
"RTN","BIVISIT",115,0)
 ;
"RTN","BIVISIT",116,0)
 N APCDALVR,APCDANE,AUPNTALK,BITEST,DLAYGO,X
"RTN","BIVISIT",117,0)
 S BIERR=0
"RTN","BIVISIT",118,0)
 ;
"RTN","BIVISIT",119,0)
 ;---> Set BITEST=1 To display VISIT and V IMM pointers after sets.
"RTN","BIVISIT",120,0)
 ;---> NOTE: This will write directly to IO.  Should be turned OFF
"RTN","BIVISIT",121,0)
 ;---> (BITEST=0) when not testing in M Programmer mode.
"RTN","BIVISIT",122,0)
 S BITEST=0
"RTN","BIVISIT",123,0)
 ;
"RTN","BIVISIT",124,0)
 ;---> If this is an edit, check or set BIVSIT=IEN of Parent Visit.
"RTN","BIVISIT",125,0)
 D:$G(BIOIEN)
"RTN","BIVISIT",126,0)
 .I (BIVTYPE'="I"&(BIVTYPE'="S")) D  Q
"RTN","BIVISIT",127,0)
 ..D ERRCD^BIUTL2(410,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",128,0)
 .;
"RTN","BIVISIT",129,0)
 .;---> Quit if valid Visit IEN passed.
"RTN","BIVISIT",130,0)
 .Q:$G(^AUPNVSIT(+$G(BIVSIT),0))
"RTN","BIVISIT",131,0)
 .;
"RTN","BIVISIT",132,0)
 .;---> Get Visit IEN from V File entry (and set in BIDATA).
"RTN","BIVISIT",133,0)
 .N BIGBL S BIGBL=$S(BIVTYPE="I":"^AUPNVIMM(",1:"^AUPNVSK(")
"RTN","BIVISIT",134,0)
 .S BIGBL=BIGBL_BIOIEN_",0)"
"RTN","BIVISIT",135,0)
 .;---> Get IEN of VISIT.
"RTN","BIVISIT",136,0)
 .S BIVSIT=$P($G(@BIGBL),U,3)
"RTN","BIVISIT",137,0)
 Q:BIERR
"RTN","BIVISIT",138,0)
 ;
"RTN","BIVISIT",139,0)
 ;---> Create or edit Visit if necessary.
"RTN","BIVISIT",140,0)
 ;---> NOTE: BIVSIT, even if sent, might come backed changed (due to
"RTN","BIVISIT",141,0)
 ;---> change in Date, Category, etc.)
"RTN","BIVISIT",142,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",143,0)
 ;---> Added BINOM parameter to control Visit Menu display.
"RTN","BIVISIT",144,0)
 S:($G(BINOM)="") BINOM=0
"RTN","BIVISIT",145,0)
 ;D VISIT^BIVISIT1(BIDFN,BIDATE,BICAT,BILOC,BIOLOC,BISITE,.BIVSIT,.BIERR)
"RTN","BIVISIT",146,0)
 D VISIT^BIVISIT1(BIDFN,BIDATE,BICAT,BILOC,BIOLOC,BISITE,.BIVSIT,.BIERR,BINOM)
"RTN","BIVISIT",147,0)
 ;**********
"RTN","BIVISIT",148,0)
 Q:BIERR
"RTN","BIVISIT",149,0)
 ;
"RTN","BIVISIT",150,0)
 ;---> Create V FILE entry.
"RTN","BIVISIT",151,0)
 D VFILE($G(BIVSIT),BIDATA,.BIERR)
"RTN","BIVISIT",152,0)
 Q:BIERR
"RTN","BIVISIT",153,0)
 ;
"RTN","BIVISIT",154,0)
 ;---> If this was a mod to an existing Visit, update VISIT Field .13.
"RTN","BIVISIT",155,0)
 I $$RPMS^BIUTL9() D:($G(BIOIEN)&($G(BIVSIT)))
"RTN","BIVISIT",156,0)
 .N AUPNVSIT,DA,DIE,DLAYGO
"RTN","BIVISIT",157,0)
 .S AUPNVSIT=BIVSIT,DLAYGO=9000010
"RTN","BIVISIT",158,0)
 .D MOD^AUPNVSIT
"RTN","BIVISIT",159,0)
 ;
"RTN","BIVISIT",160,0)
 Q
"RTN","BIVISIT",161,0)
 ;
"RTN","BIVISIT",162,0)
 ;
"RTN","BIVISIT",163,0)
 ;----------
"RTN","BIVISIT",164,0)
VFILE(BIVSIT,BIDATA,BIERR) ;EP
"RTN","BIVISIT",165,0)
 ;---> Add (create) V IMMUNIZATION or V SKIN TEST entry for this Visit.
"RTN","BIVISIT",166,0)
 ;---> Parameters:
"RTN","BIVISIT",167,0)
 ;     1 - BIVSIT (req) IEN of Parent Visit.
"RTN","BIVISIT",168,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIVISIT",169,0)
 ;                      See BIDATA definition at linelabel PARSE.
"RTN","BIVISIT",170,0)
 ;     3 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIVISIT",171,0)
 ;
"RTN","BIVISIT",172,0)
 ;---> if we are on VISTA, do the VISTA V File update.
"RTN","BIVISIT",173,0)
 I '$$RPMS^BIUTL9() D VFILE^PXVVISIT(BIVSIT,BIDATA,.BIERR) QUIT
"RTN","BIVISIT",174,0)
 ;
"RTN","BIVISIT",175,0)
 I BIDATA="" D ERRCD^BIUTL2(437,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT",176,0)
 ;
"RTN","BIVISIT",177,0)
 N BIVTYPE,BIDFN,BIPTR,BIDOSE,BILOT,BIDATE,BILOC,BIOLOC,BICAT
"RTN","BIVISIT",178,0)
 N BIOIEN,BIRES,BIREA,BIDTR,BIREC,BIVISD,BIPROV,BIOVRD,BIINJS,BIVOL
"RTN","BIVISIT",179,0)
 N BIREDR,BISITE,BICCPT,BIMPRT,BIANOT
"RTN","BIVISIT",180,0)
 ;
"RTN","BIVISIT",181,0)
 ;---> See BIDATA definition at linelabel PARSE (above).
"RTN","BIVISIT",182,0)
 D PARSE(BIDATA,1)
"RTN","BIVISIT",183,0)
 ;
"RTN","BIVISIT",184,0)
 ;---> Fields in V IMMUNIZATION File are as follows:
"RTN","BIVISIT",185,0)
 ;
"RTN","BIVISIT",186,0)
 ;       .01 APCDTIMM  Pointer to IMMUNIZATION File (Vaccine)
"RTN","BIVISIT",187,0)
 ;       .02 APCDPAT   Patient
"RTN","BIVISIT",188,0)
 ;       .03 APCDVSIT  IEN of Visit
"RTN","BIVISIT",189,0)
 ;       .04 APCDTSER  Dose# (Series#)
"RTN","BIVISIT",190,0)
 ;       .05 APCDTLOT  Lot# IEN, Pointer to IMMUNIZATION LOT File
"RTN","BIVISIT",191,0)
 ;       .06 APCDTREC  Reaction
"RTN","BIVISIT",192,0)
 ;
"RTN","BIVISIT",193,0)
 ;       This will no longer be used:
"RTN","BIVISIT",194,0)
 ;       .07 APCDTCON  Contraindication (Stored in ^BIP.)
"RTN","BIVISIT",195,0)
 ;
"RTN","BIVISIT",196,0)
 ;       .12 APCDTVSD  VIS Date (Lori will put in a future template.)
"RTN","BIVISIT",197,0)
 ;      1204 APCDTEPR  Immunization Provider
"RTN","BIVISIT",198,0)
 ;
"RTN","BIVISIT",199,0)
 ;---> Fields in V SKIN TEST File are as follows:
"RTN","BIVISIT",200,0)
 ;
"RTN","BIVISIT",201,0)
 ;       .01 APCDTSK   Pointer to IMMUNIZATION File
"RTN","BIVISIT",202,0)
 ;       .02 APCDPAT   Patient
"RTN","BIVISIT",203,0)
 ;       .03 APCDVSIT  IEN of Visit
"RTN","BIVISIT",204,0)
 ;       .04 APCDTRES  Result
"RTN","BIVISIT",205,0)
 ;       .05 APCDTREA  Reading
"RTN","BIVISIT",206,0)
 ;       .06 APCDTDR   Date read
"RTN","BIVISIT",207,0)
 ;      1204 APCDTEPR  Skin Test Provider
"RTN","BIVISIT",208,0)
 ;
"RTN","BIVISIT",209,0)
 ;---> Check that a Parent VISIT exists.
"RTN","BIVISIT",210,0)
 I '$D(^AUPNVSIT(+$G(BIVSIT),0)) D  Q
"RTN","BIVISIT",211,0)
 .D ERRCD^BIUTL2(432,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",212,0)
 ;
"RTN","BIVISIT",213,0)
 N APCDALVR
"RTN","BIVISIT",214,0)
 ;
"RTN","BIVISIT",215,0)
 ;---> Set Visit pointer.
"RTN","BIVISIT",216,0)
 S APCDALVR("APCDVSIT")=BIVSIT
"RTN","BIVISIT",217,0)
 ;
"RTN","BIVISIT",218,0)
 ;---> Set Patient.
"RTN","BIVISIT",219,0)
 S APCDALVR("APCDPAT")=BIDFN
"RTN","BIVISIT",220,0)
 ;
"RTN","BIVISIT",221,0)
 ;
"RTN","BIVISIT",222,0)
 ;
"RTN","BIVISIT",223,0)
 ;---> * * * If this is an IMMUNIZATION, set APCD array for Immunizations. * * *
"RTN","BIVISIT",224,0)
 ;
"RTN","BIVISIT",225,0)
 I BIVTYPE="I" D
"RTN","BIVISIT",226,0)
 .;
"RTN","BIVISIT",227,0)
 .;---> Set permission override for this file.
"RTN","BIVISIT",228,0)
 .S DLAYGO=9000010.11
"RTN","BIVISIT",229,0)
 .;
"RTN","BIVISIT",230,0)
 .;---> Immunization/vaccine name.
"RTN","BIVISIT",231,0)
 .S APCDALVR("APCDTIMM")="`"_BIPTR
"RTN","BIVISIT",232,0)
 .;
"RTN","BIVISIT",233,0)
 .;---> Dose# for this immunization.
"RTN","BIVISIT",234,0)
 .;S:'$G(BIDOSE) BIDOSE=""
"RTN","BIVISIT",235,0)
 .;S APCDALVR("APCDTSER")=BIDOSE
"RTN","BIVISIT",236,0)
 .;
"RTN","BIVISIT",237,0)
 .;---> Lot Number IEN for this immunization.
"RTN","BIVISIT",238,0)
 .S:'$G(BILOT) BILOT=""
"RTN","BIVISIT",239,0)
 .;---> Lot Number passed to PCC more reliably if prepend "`". ;MWRZZZ 10/30/06
"RTN","BIVISIT",240,0)
 .;---> Imm v8.5: Handle Lot Number below
"RTN","BIVISIT",241,0)
 .;S:BILOT BILOT="`"_BILOT
"RTN","BIVISIT",242,0)
 .;S APCDALVR("APCDTLOT")=BILOT
"RTN","BIVISIT",243,0)
 .;
"RTN","BIVISIT",244,0)
 .;---> Reaction to this vaccine on this Visit.
"RTN","BIVISIT",245,0)
 .S:'$G(BIREC) BIREC=""
"RTN","BIVISIT",246,0)
 .S APCDALVR("APCDTREC")=BIREC
"RTN","BIVISIT",247,0)
 .;
"RTN","BIVISIT",248,0)
 .;---> Immunization Provider ("Shot giver").
"RTN","BIVISIT",249,0)
 .S:$G(BIPROV) APCDALVR("APCDTEPR")="`"_BIPROV
"RTN","BIVISIT",250,0)
 .;
"RTN","BIVISIT",251,0)
 .;---> User who last edited this Immunization.  ;MWR New for v8.2.
"RTN","BIVISIT",252,0)
 .S:$G(DUZ) APCDALVR("APCDTULU")="`"_DUZ
"RTN","BIVISIT",253,0)
 .;
"RTN","BIVISIT",254,0)
 .;---> Template to add encounter to V IMMUNIZATION File.
"RTN","BIVISIT",255,0)
 .S APCDALVR("APCDATMP")="[APCDALVR 9000010.11 (ADD)]"
"RTN","BIVISIT",256,0)
 ;
"RTN","BIVISIT",257,0)
 ;
"RTN","BIVISIT",258,0)
 ;
"RTN","BIVISIT",259,0)
 ;---> * * * If this is a SKIN TEST, set APCD array for Skin Tests.  * * *
"RTN","BIVISIT",260,0)
 ;
"RTN","BIVISIT",261,0)
 I BIVTYPE="S" D
"RTN","BIVISIT",262,0)
 .;
"RTN","BIVISIT",263,0)
 .;---> Set permission override for this file.
"RTN","BIVISIT",264,0)
 .S DLAYGO=9000010.12
"RTN","BIVISIT",265,0)
 .;
"RTN","BIVISIT",266,0)
 .;---> Skin Test name.
"RTN","BIVISIT",267,0)
 .S APCDALVR("APCDTSK")="`"_BIPTR
"RTN","BIVISIT",268,0)
 .;
"RTN","BIVISIT",269,0)
 .;---> Skin Test Result.
"RTN","BIVISIT",270,0)
 .S APCDALVR("APCDTRES")=BIRES
"RTN","BIVISIT",271,0)
 .;
"RTN","BIVISIT",272,0)
 .;---> Skin Test Reading (mm).
"RTN","BIVISIT",273,0)
 .S APCDALVR("APCDTREA")=BIREA
"RTN","BIVISIT",274,0)
 .;
"RTN","BIVISIT",275,0)
 .;---> Skin Test Date Read.
"RTN","BIVISIT",276,0)
 .S APCDALVR("APCDTDR")=BIDTR
"RTN","BIVISIT",277,0)
 .;
"RTN","BIVISIT",278,0)
 .;---> Skin Test Provider (Person who administered the test).
"RTN","BIVISIT",279,0)
 .S:$G(BIPROV) APCDALVR("APCDTEPR")="`"_BIPROV
"RTN","BIVISIT",280,0)
 .;
"RTN","BIVISIT",281,0)
 .;---> Template to add encounter to V SKIN TEST File.
"RTN","BIVISIT",282,0)
 .S APCDALVR("APCDATMP")="[APCDALVR 9000010.12 (ADD)]"
"RTN","BIVISIT",283,0)
 ;
"RTN","BIVISIT",284,0)
 ;
"RTN","BIVISIT",285,0)
 ;---> * * *  CALL TO APCDALVR.  * * *
"RTN","BIVISIT",286,0)
 D EN^APCDALVR
"RTN","BIVISIT",287,0)
 D:$G(BITEST) DISPLAY2^BIPCC
"RTN","BIVISIT",288,0)
 ;
"RTN","BIVISIT",289,0)
 ;---> Quit if a V File entry was not created.
"RTN","BIVISIT",290,0)
 I '$G(APCDALVR("APCDADFN"))!($D(APCDALVR("APCDAFLG"))) D  Q
"RTN","BIVISIT",291,0)
 .I BIVTYPE="I" D ERRCD^BIUTL2(402,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT",292,0)
 .I BIVTYPE="S" D ERRCD^BIUTL2(413,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",293,0)
 ;
"RTN","BIVISIT",294,0)
 ;Returns:  APCDADFN - IEN of V IMMUNIZATION File entry.
"RTN","BIVISIT",295,0)
 ;          APCDAFLG - =2 If FAILED to create a V FILE entry.
"RTN","BIVISIT",296,0)
 ;
"RTN","BIVISIT",297,0)
 ;
"RTN","BIVISIT",298,0)
 ;---> Save IEN of V IMMUNIZATION just created.
"RTN","BIVISIT",299,0)
 N BIADFN S BIADFN=APCDALVR("APCDADFN")
"RTN","BIVISIT",300,0)
 ;
"RTN","BIVISIT",301,0)
 ;
"RTN","BIVISIT",302,0)
 ;---> ADD OTHER V SKIN TEST FIELDS:
"RTN","BIVISIT",303,0)
 ;---> If this is a Skin Test, add Skin Test Reader and Quit.
"RTN","BIVISIT",304,0)
 I BIVTYPE="S" D  Q
"RTN","BIVISIT",305,0)
 .;---> Store Additional data.
"RTN","BIVISIT",306,0)
 .N BIFLD
"RTN","BIVISIT",307,0)
 .S BIFLD(.08)=BIREDR,BIFLD(.09)=BIINJS,BIFLD(.11)=BIVOL
"RTN","BIVISIT",308,0)
 .;
"RTN","BIVISIT",309,0)
 .;---> Set DATE/TIME LAST MODIFIED, per Lori Butcher, 5/26/12
"RTN","BIVISIT",310,0)
 .S:$G(BIOIEN) BIFLD(1218)=$$NOW^XLFDT
"RTN","BIVISIT",311,0)
 .;
"RTN","BIVISIT",312,0)
 .D FDIE^BIFMAN(9000010.12,BIADFN,.BIFLD,.BIERR)
"RTN","BIVISIT",313,0)
 .I BIERR=1 D ERRCD^BIUTL2(421,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",314,0)
 .;
"RTN","BIVISIT",315,0)
 .;---> If Skin Test is a PPD and result is Positive, add Contraindication
"RTN","BIVISIT",316,0)
 .;---> to further TST-PPD tests.
"RTN","BIVISIT",317,0)
 .I $$SKNAME^BIUTL6($G(BIPTR))="PPD",$E($G(BIRES))="P" D
"RTN","BIVISIT",318,0)
 ..;---> Set date equal to either Date Read, or Date of Visit, or Today.
"RTN","BIVISIT",319,0)
 ..N BIDTC S BIDTC=$S($G(BIDTR):BIDTR,$G(BIDATE):$P(BIDATE,"."),1:$G(DT))
"RTN","BIVISIT",320,0)
 ..S BIDATA=BIDFN_"|"_203_"|"_17_"|"_BIDTC
"RTN","BIVISIT",321,0)
 ..D ADDCONT^BIRPC4(,BIDATA)
"RTN","BIVISIT",322,0)
 ;
"RTN","BIVISIT",323,0)
 ;
"RTN","BIVISIT",324,0)
 ;---> ADD OTHER V IMMUNIZATION FIELDS:
"RTN","BIVISIT",325,0)
 ;---> Quit if this is not an Immunization.
"RTN","BIVISIT",326,0)
 Q:BIVTYPE'="I"
"RTN","BIVISIT",327,0)
 ;
"RTN","BIVISIT",328,0)
 ;---> Add VIS, Dose Override, Injection Site and Volume data.
"RTN","BIVISIT",329,0)
 ;---> Build DR string.
"RTN","BIVISIT",330,0)
 ;
"RTN","BIVISIT",331,0)
 S:(BIVISD<1) BIVISD="@" S:BIOVRD="" BIOVRD="@"
"RTN","BIVISIT",332,0)
 ;
"RTN","BIVISIT",333,0)
 S:BIINJS="" BIINJS="@" S:BIVOL="" BIVOL="@"
"RTN","BIVISIT",334,0)
 S:BILOT="" BIILOT="@" S:BINDC="" BINDC="@"
"RTN","BIVISIT",335,0)
 ;
"RTN","BIVISIT",336,0)
 ;---> Store Additional data.
"RTN","BIVISIT",337,0)
 N BIFLD
"RTN","BIVISIT",338,0)
 S BIFLD(.05)=BILOT
"RTN","BIVISIT",339,0)
 S BIFLD(.08)=BIOVRD,BIFLD(.09)=BIINJS
"RTN","BIVISIT",340,0)
 S BIFLD(.11)=BIVOL,BIFLD(.12)=BIVISD,BIFLD(.13)=BICCPT
"RTN","BIVISIT",341,0)
 ;
"RTN","BIVISIT",342,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIVISIT",343,0)
 ;---> If patient is 19yrs or older at the time of the immunization,
"RTN","BIVISIT",344,0)
 ;---> and Eligibility is null, set Eligibility=V01.
"RTN","BIVISIT",345,0)
 D
"RTN","BIVISIT",346,0)
 .Q:(BIVFC]"")
"RTN","BIVISIT",347,0)
 .N BIAGDT S BIAGDT=$S($G(BIADMIN):BIADMIN,1:BIDATE)
"RTN","BIVISIT",348,0)
 .I $$AGE^BIUTL1(BIDFN,1,BIAGDT)>18 S BIVFC=$O(^BIELIG("B","V01",0))
"RTN","BIVISIT",349,0)
 ;**********
"RTN","BIVISIT",350,0)
 ;
"RTN","BIVISIT",351,0)
 S BIFLD(.14)=BIVFC
"RTN","BIVISIT",352,0)
 S BIFLD(.15)=$S(BIMPRT>0:2,1:"")
"RTN","BIVISIT",353,0)
 S BIFLD(.16)=BINDC
"RTN","BIVISIT",354,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",355,0)
 ;---> Added Admin Note, piece 27.
"RTN","BIVISIT",356,0)
 S:($G(BIANOT)]"") BIFLD(1)=BIANOT
"RTN","BIVISIT",357,0)
 ;**********
"RTN","BIVISIT",358,0)
 ;
"RTN","BIVISIT",359,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIVISIT",360,0)
 ;---> Set DATE/TIME LAST MODIFIED, per Lori Butcher, 5/26/12
"RTN","BIVISIT",361,0)
 S:$G(BIOIEN) BIFLD(1218)=$$NOW^XLFDT
"RTN","BIVISIT",362,0)
 ;**********
"RTN","BIVISIT",363,0)
 ;
"RTN","BIVISIT",364,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIVISIT",365,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIVISIT",366,0)
 ;    28 - BIADMIN  Admin Date (Date shot admin'd to patient.
"RTN","BIVISIT",367,0)
 ;    29 - BIVPRES  Date VIS Presented to Patient.
"RTN","BIVISIT",368,0)
 ;
"RTN","BIVISIT",369,0)
 S BIFLD(1201)=BIADMIN
"RTN","BIVISIT",370,0)
 S BIFLD(.17)=BIVPRES
"RTN","BIVISIT",371,0)
 ;**********
"RTN","BIVISIT",372,0)
 ;
"RTN","BIVISIT",373,0)
 D FDIE^BIFMAN(9000010.11,BIADFN,.BIFLD,.BIERR)
"RTN","BIVISIT",374,0)
 I BIERR=1 D  Q
"RTN","BIVISIT",375,0)
 .D ERRCD^BIUTL2(421,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",376,0)
 ;
"RTN","BIVISIT",377,0)
 ;
"RTN","BIVISIT",378,0)
 ;---> If there was an anaphylactic reaction to this vaccine,
"RTN","BIVISIT",379,0)
 ;---> add it as a contraindication for this patient.
"RTN","BIVISIT",380,0)
 D:BIREC=9
"RTN","BIVISIT",381,0)
 .Q:'$G(BIDFN)  Q:'$G(BIPTR)  Q:'$G(BIDATE)
"RTN","BIVISIT",382,0)
 .N BIREAS S BIREAS=$O(^BICONT("B","Anaphylaxis",0))
"RTN","BIVISIT",383,0)
 .Q:'BIREAS
"RTN","BIVISIT",384,0)
 .;
"RTN","BIVISIT",385,0)
 .N BIADD,N,V S N=0,BIADD=1,V="|"
"RTN","BIVISIT",386,0)
 .;---> Loop through patient's existing contraindications.
"RTN","BIVISIT",387,0)
 .F  S N=$O(^BIPC("B",BIDFN,N)) Q:'N  Q:'BIADD  D
"RTN","BIVISIT",388,0)
 ..N X S X=$G(^BIPC(N,0))
"RTN","BIVISIT",389,0)
 ..Q:'X
"RTN","BIVISIT",390,0)
 ..;---> Quit (BIADD=0) if this contra/reason/date already exists.
"RTN","BIVISIT",391,0)
 ..I $P(X,U,2)=BIPTR&($P(X,U,3)=BIREAS)&($P(X,U,4)=BIDATE) S BIADD=0
"RTN","BIVISIT",392,0)
 .Q:'BIADD
"RTN","BIVISIT",393,0)
 .;
"RTN","BIVISIT",394,0)
 .D ADDCONT^BIRPC4(.BIERR,BIDFN_V_BIPTR_V_BIREAS_V_BIDATE)
"RTN","BIVISIT",395,0)
 .I $G(BIERR)]"" S BIERR="1^"_BIERR
"RTN","BIVISIT",396,0)
 ;
"RTN","BIVISIT",397,0)
 ;---> Now trigger New Immunization Trigger Event.
"RTN","BIVISIT",398,0)
 D TRIGADD
"RTN","BIVISIT",399,0)
 Q
"RTN","BIVISIT",400,0)
 ;
"RTN","BIVISIT",401,0)
 ;
"RTN","BIVISIT",402,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",403,0)
 ;---> Moved TRIGADD to rtn BIVISIT2 for RSIZE.
"RTN","BIVISIT",404,0)
 ;----------
"RTN","BIVISIT",405,0)
TRIGADD ;EP
"RTN","BIVISIT",406,0)
 ;---> Immunization Added Trigger Event call to Protocol File.
"RTN","BIVISIT",407,0)
 D TRIGADD^BIVISIT2
"RTN","BIVISIT",408,0)
 Q
"RTN","BIVISIT",409,0)
 ;**********
"RTN","BIVISIT",410,0)
 ;
"RTN","BIVISIT",411,0)
 ;
"RTN","BIVISIT",412,0)
 ;----------
"RTN","BIVISIT",413,0)
VFILE1 ;EP
"RTN","BIVISIT",414,0)
 ;---> Add (create) V IMMUNIZATION from ^DD of V CPT.
"RTN","BIVISIT",415,0)
 ;---> Called from EN^XBNEW, from CPTIMM^BIRPC6
"RTN","BIVISIT",416,0)
 ;---> Local Variables:
"RTN","BIVISIT",417,0)
 ;     1 - BIVSIT (req) IEN of Parent Visit.
"RTN","BIVISIT",418,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIVISIT",419,0)
 ;                      See BIDATA definition at linelabel PARSE.
"RTN","BIVISIT",420,0)
 ;
"RTN","BIVISIT",421,0)
 Q:'$G(BIVSIT)  Q:'$D(BIDATA)
"RTN","BIVISIT",422,0)
 D VFILE(BIVSIT,BIDATA)
"RTN","BIVISIT",423,0)
 Q
"RTN","BIVISIT",424,0)
 ;
"RTN","BIVISIT",425,0)
 ;
"RTN","BIVISIT",426,0)
 ;----------
"RTN","BIVISIT",427,0)
IMPORT(APCDALVR) ;PEP - Code to flag V Imm as "Imported."
"RTN","BIVISIT",428,0)
 ;---> Code for Tom Love to flag entry as Imported From Outside Registry.
"RTN","BIVISIT",429,0)
 ;---> Parameters:
"RTN","BIVISIT",430,0)
 ;     1 - APCDALVR (req) Array returned from call to EN^APCDALVR.
"RTN","BIVISIT",431,0)
 ;                   APCDALVR("APCDADFN") - IEN of V IMMUNIZATION File entry.
"RTN","BIVISIT",432,0)
 ;                   APCDALVR("APCDAFLG") - =2 If FAILED to create a V FILE entry.
"RTN","BIVISIT",433,0)
 ;
"RTN","BIVISIT",434,0)
 Q:($G(APCDALVR("APCDAFLG")))
"RTN","BIVISIT",435,0)
 Q:('$G(APCDALVR("APCDADFN")))
"RTN","BIVISIT",436,0)
 N BIADFN S BIADFN=APCDALVR("APCDADFN")
"RTN","BIVISIT",437,0)
 ;
"RTN","BIVISIT",438,0)
 ;---> Add Import From Outside.
"RTN","BIVISIT",439,0)
 N BIFLD S BIFLD(.15)=1
"RTN","BIVISIT",440,0)
 D FDIE^BIFMAN(9000010.11,BIADFN,.BIFLD,.BIERR)
"RTN","BIVISIT",441,0)
 Q
"RTN","BIVISIT1")
0^165^B43286157
"RTN","BIVISIT1",1,0)
BIVISIT1 ;IHS/CMI/MWR - CREATE/EDIT VISITS.; MAY 10, 2010
"RTN","BIVISIT1",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIVISIT1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVISIT1",4,0)
 ;;  CODE TO CREATE OR EDIT VISITS FOR IMMUNIZATIONS AND SKIN TESTS.
"RTN","BIVISIT1",5,0)
 ;;  PATCH 1: Allow for negative values of Y (time difference).  CREATE+91
"RTN","BIVISIT1",6,0)
 ;;           Correct "Other" Location not getting set during edits.  VISIT+14
"RTN","BIVISIT1",7,0)
 ;;  PATCH 5: Added BINOM parameter to ADDEDIT P.E.P. for Visit Selection Menu.
"RTN","BIVISIT1",8,0)
 ;;                                                    VISIT+0
"RTN","BIVISIT1",9,0)
 ;
"RTN","BIVISIT1",10,0)
 ;
"RTN","BIVISIT1",11,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT1",12,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIVISIT1",13,0)
 ;----------
"RTN","BIVISIT1",14,0)
VISIT(BIDFN,BIDATE,BICAT,BILOC,BIOLOC,BISITE,BIVSIT,BIERR,BINOM) ;EP
"RTN","BIVISIT1",15,0)
 ;---> Create or edit a Visit for this patient's Immunization or
"RTN","BIVISIT1",16,0)
 ;---> Skin Test.  Called by BIVISIT.
"RTN","BIVISIT1",17,0)
 ;---> Parameters:
"RTN","BIVISIT1",18,0)
 ;     1 - BIDFN   (req) DFN of patient.
"RTN","BIVISIT1",19,0)
 ;     2 - BIDATE  (req) Date.Time of Visit.
"RTN","BIVISIT1",20,0)
 ;     3 - BILOC   (req) Location of encounter IEN.
"RTN","BIVISIT1",21,0)
 ;     4 - BIOLOC  (opt) Other Location of encounter.
"RTN","BIVISIT1",22,0)
 ;     5 - BICAT   (req) Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIVISIT1",23,0)
 ;     6 - BISITE  (req) DUZ(2) for Site Parameters.
"RTN","BIVISIT1",24,0)
 ;     7 - BIVSIT  (ret) IEN of Visit (may exist already or be new).
"RTN","BIVISIT1",25,0)
 ;     8 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIVISIT1",26,0)
 ;     9 - BINOM   (opt) 0=Allow display of Visit Selection Menu if site
"RTN","BIVISIT1",27,0)
 ;                       parameter is set. 1=No display (for export).
"RTN","BIVISIT1",28,0)
 ;
"RTN","BIVISIT1",29,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT1",30,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIVISIT1",31,0)
 S:($G(BINOM)="") BINOM=0
"RTN","BIVISIT1",32,0)
 ;
"RTN","BIVISIT1",33,0)
 ;---> First, determine Location.
"RTN","BIVISIT1",34,0)
 ;---> If BILOC<1 or if Outside Location is not null set BILOC equal
"RTN","BIVISIT1",35,0)
 ;---> to "OTHER" entry in Location File by checking BI SITE Parameter.
"RTN","BIVISIT1",36,0)
 S:('$G(BILOC)!($G(BIOLOC)]"")) BILOC=$$OTHERLOC^BIUTL6(DUZ(2))
"RTN","BIVISIT1",37,0)
 ;
"RTN","BIVISIT1",38,0)
 ;---> Quit if "OTHER" Location has not been selected in Site Parameters.
"RTN","BIVISIT1",39,0)
 I BILOC="" S BIERR="1^"_$$OTHERLOC^BIUTL6(DUZ(2),1) Q
"RTN","BIVISIT1",40,0)
 ;
"RTN","BIVISIT1",41,0)
 ;---> Create Visit if necessary.
"RTN","BIVISIT1",42,0)
 ;
"RTN","BIVISIT1",43,0)
 ;---> If no Parent Visit EIN, create a new Visit.
"RTN","BIVISIT1",44,0)
 I '$G(BIVSIT) D CREATE(.BIVSIT,.BIERR,BINOM) Q
"RTN","BIVISIT1",45,0)
 ;
"RTN","BIVISIT1",46,0)
 ;---> If Parent Visit doesn't really exist, create a new Visit.
"RTN","BIVISIT1",47,0)
 I '$G(^AUPNVSIT(+BIVSIT,0)) D CREATE(.BIVSIT,.BIERR,BINOM) Q
"RTN","BIVISIT1",48,0)
 ;
"RTN","BIVISIT1",49,0)
 ;---> If edit of old VISIT changed Date.Time, create a new Visit.
"RTN","BIVISIT1",50,0)
 I $P(^AUPNVSIT(+BIVSIT,0),U)'=BIDATE D CREATE(.BIVSIT,.BIERR,BINOM) Q
"RTN","BIVISIT1",51,0)
 ;
"RTN","BIVISIT1",52,0)
 ;---> If edit of old VISIT changed Category, create a new Visit.
"RTN","BIVISIT1",53,0)
 I $P(^AUPNVSIT(+BIVSIT,0),U,7)'=BICAT D CREATE(.BIVSIT,.BIERR,BINOM) Q
"RTN","BIVISIT1",54,0)
 ;
"RTN","BIVISIT1",55,0)
 ;
"RTN","BIVISIT1",56,0)
 ;---> If Outside Location was deleted, set it ="@".
"RTN","BIVISIT1",57,0)
 S:$G(BIOLOC)="" BIOLOC="@"
"RTN","BIVISIT1",58,0)
 ;
"RTN","BIVISIT1",59,0)
 ;---> If edit of old VISIT changed Location, edit Visit.
"RTN","BIVISIT1",60,0)
 I $P(^AUPNVSIT(+BIVSIT,0),U,6)'=BILOC D  Q
"RTN","BIVISIT1",61,0)
 .N BIFLD S BIFLD(.06)=BILOC,BIFLD(2101)=BIOLOC
"RTN","BIVISIT1",62,0)
 .D FDIE^BIFMAN(9000010,BIVSIT,.BIFLD,.BIERR)
"RTN","BIVISIT1",63,0)
 .I $G(BIERR) D ERRCD^BIUTL2(433,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT1",64,0)
 ;
"RTN","BIVISIT1",65,0)
 ;---> If edit of old VISIT changed Outside Location, edit Visit.
"RTN","BIVISIT1",66,0)
 ;---> In old code, edit from default location to outside location failed. vvv83
"RTN","BIVISIT1",67,0)
 I $P($G(^AUPNVSIT(+BIVSIT,21)),U)'=BIOLOC D  Q
"RTN","BIVISIT1",68,0)
 .N BIFLD S BIFLD(.06)=BILOC,BIFLD(2101)=BIOLOC
"RTN","BIVISIT1",69,0)
 .D FDIE^BIFMAN(9000010,BIVSIT,.BIFLD,.BIERR)
"RTN","BIVISIT1",70,0)
 .I $G(BIERR) D ERRCD^BIUTL2(434,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT1",71,0)
 ;
"RTN","BIVISIT1",72,0)
 Q
"RTN","BIVISIT1",73,0)
 ;
"RTN","BIVISIT1",74,0)
 ;
"RTN","BIVISIT1",75,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT1",76,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIVISIT1",77,0)
 ;----------
"RTN","BIVISIT1",78,0)
CREATE(BIVSIT,BIERR,BINOM) ;EP
"RTN","BIVISIT1",79,0)
 ;---> Create a new Visit OR match on an existing Visit in VISIT File.
"RTN","BIVISIT1",80,0)
 ;---> Parameters:
"RTN","BIVISIT1",81,0)
 ;     1 - BIVSIT (ret) IEN of newly created Parent Visit.
"RTN","BIVISIT1",82,0)
 ;     2 - BIERR  (ret) 1^Text of Error Code if any, otherwise null.
"RTN","BIVISIT1",83,0)
 ;     3 - BINOM  (opt) 0=Allow display of Visit Selection Menu if site
"RTN","BIVISIT1",84,0)
 ;                      parameter is set. 1=No display (for export).
"RTN","BIVISIT1",85,0)
 ;
"RTN","BIVISIT1",86,0)
 ;
"RTN","BIVISIT1",87,0)
 ;---> For VISTA, run another routine
"RTN","BIVISIT1",88,0)
 I '$$RPMS^BIUTL9() D CREATE^PXVVISIT(.BIVSIT,.BIERR,BINOM) QUIT
"RTN","BIVISIT1",89,0)
 ;
"RTN","BIVISIT1",90,0)
 ;---> Set permission override for this file.
"RTN","BIVISIT1",91,0)
 S DLAYGO=9000010
"RTN","BIVISIT1",92,0)
 ;
"RTN","BIVISIT1",93,0)
 ;---> Patient.
"RTN","BIVISIT1",94,0)
 S APCDALVR("APCDPAT")=BIDFN
"RTN","BIVISIT1",95,0)
 ;
"RTN","BIVISIT1",96,0)
 ;---> PCC Date/Time; If no time, 12 noon will be attached.
"RTN","BIVISIT1",97,0)
 S APCDALVR("APCDDATE")=BIDATE
"RTN","BIVISIT1",98,0)
 ;
"RTN","BIVISIT1",99,0)
 ;---> If Visit Selection Menu is Disabled, create/link automatically:
"RTN","BIVISIT1",100,0)
 ;---> Linking/Adding PCC Visits:
"RTN","BIVISIT1",101,0)
 ;--->    1) If no Visit exists on this date, create one silently.
"RTN","BIVISIT1",102,0)
 ;--->    2) If a Visit exists with exact time match, append to it.
"RTN","BIVISIT1",103,0)
 ;--->    3) If a Visit exists for this date but a different time,
"RTN","BIVISIT1",104,0)
 ;--->          add a new Visit.
"RTN","BIVISIT1",105,0)
 ;
"RTN","BIVISIT1",106,0)
 ;---> If site param says do NOT display Visit Selection Menu, then
"RTN","BIVISIT1",107,0)
 ;---> link or create automatically.
"RTN","BIVISIT1",108,0)
 D
"RTN","BIVISIT1",109,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT1",110,0)
 .;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIVISIT1",111,0)
 .I $G(BINOM) S APCDALVR("APCDAUTO")="" Q
"RTN","BIVISIT1",112,0)
 .;**********
"RTN","BIVISIT1",113,0)
 .I '$$VISMNU^BIUTL2(BISITE) S APCDALVR("APCDAUTO")="" Q
"RTN","BIVISIT1",114,0)
 .K APCDALVR("APCDAUTO")
"RTN","BIVISIT1",115,0)
 ;
"RTN","BIVISIT1",116,0)
 ;---> No interaction, no Fileman echoing.  Archaic?
"RTN","BIVISIT1",117,0)
 S APCDALVR("AUPNTALK")="",APCDALVR("APCDANE")=""
"RTN","BIVISIT1",118,0)
 ;
"RTN","BIVISIT1",119,0)
 S APCDALVR("APCDLOC")=BILOC
"RTN","BIVISIT1",120,0)
 ;
"RTN","BIVISIT1",121,0)
 ;---> Other Location (Text if Location="OTHER").
"RTN","BIVISIT1",122,0)
 S APCDALVR("APCDOLOC")=$G(BIOLOC)
"RTN","BIVISIT1",123,0)
 ;
"RTN","BIVISIT1",124,0)
 ;---> Set Type of Visit from PCC MASTER CONTROL File. (I,C,T,6,V)
"RTN","BIVISIT1",125,0)
 N BITYPE D
"RTN","BIVISIT1",126,0)
 .D:'$G(BISITE) SETVARS^BIUTL5 S BISITE=DUZ(2)
"RTN","BIVISIT1",127,0)
 .I $G(^APCCCTRL(BISITE,0))="" S BITYPE="I" Q
"RTN","BIVISIT1",128,0)
 .S BITYPE=$P(^APCCCTRL(BISITE,0),U,4)
"RTN","BIVISIT1",129,0)
 .S:BITYPE="" BITYPE="I"
"RTN","BIVISIT1",130,0)
 S APCDALVR("APCDTYPE")=BITYPE
"RTN","BIVISIT1",131,0)
 ;
"RTN","BIVISIT1",132,0)
 ;---> Category.  A=Ambulatory, I=Inpatient, E=Event/Historical.
"RTN","BIVISIT1",133,0)
 ;---> If User said this was an Ambulatory Visit, and if the Inpatient Visit
"RTN","BIVISIT1",134,0)
 ;---> Check Site Parameter is enabled, check to see if patient was an
"RTN","BIVISIT1",135,0)
 ;---> Inpatient on BIDATE; if so, change Category to "I",Inpatient.
"RTN","BIVISIT1",136,0)
 ;
"RTN","BIVISIT1",137,0)
 I BICAT="A",$$INPTCHK^BIUTL2(BISITE),$$INPT^BIUTL11(BIDFN,BIDATE) S BICAT="I"
"RTN","BIVISIT1",138,0)
 S APCDALVR("APCDCAT")=BICAT
"RTN","BIVISIT1",139,0)
 ;
"RTN","BIVISIT1",140,0)
 ;---> Call to add (create) Visit.
"RTN","BIVISIT1",141,0)
 ;---> NOTE: $G(BICAT)="E" (Historical) will override Active/Inactive
"RTN","BIVISIT1",142,0)
 ;---> selection screen on .01 Field of Immunization File #9999999.14.
"RTN","BIVISIT1",143,0)
 ;
"RTN","BIVISIT1",144,0)
 ;---> If PIMS is loaded, call new API.
"RTN","BIVISIT1",145,0)
 ;---> *** Use this below to test version of BSDAPI4?:
"RTN","BIVISIT1",146,0)
 ;---> I $P($T(BSDAPI4+1^BSDAPI4),"**",2)>1002
"RTN","BIVISIT1",147,0)
 D
"RTN","BIVISIT1",148,0)
 .;---> Check for PIMS (following lines from bottom of APCDAPI4).
"RTN","BIVISIT1",149,0)
 .;I $L($T(^APCDAPI4)),$L($T(VISIT^BSDV)),$L($T(GETVISIT^BSDAPI4)) D NEWCALL Q
"RTN","BIVISIT1",150,0)
 .D OLDCALL
"RTN","BIVISIT1",151,0)
 ;
"RTN","BIVISIT1",152,0)
 Q:$G(BIERR)
"RTN","BIVISIT1",153,0)
 ;
"RTN","BIVISIT1",154,0)
 ;S BITEST=1
"RTN","BIVISIT1",155,0)
 D:$G(BITEST) DISPLAY1^BIPCC
"RTN","BIVISIT1",156,0)
 ;
"RTN","BIVISIT1",157,0)
 ;---> Quit if Visit was not created.
"RTN","BIVISIT1",158,0)
 I '$G(APCDALVR("APCDVSIT"))!($D(APCDALVR("APCDAFLG"))) D  Q
"RTN","BIVISIT1",159,0)
 .D ERRCD^BIUTL2(401,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT1",160,0)
 ;
"RTN","BIVISIT1",161,0)
 ;Returns:  APCDVSIT - Pointer to Visit just selected or created.
"RTN","BIVISIT1",162,0)
 ;          APCDVSIT("NEW") - If ^APCDALVR created a new Visit.
"RTN","BIVISIT1",163,0)
 ;          APCDAFLG - =2 If FAILED to select or create a Visit.
"RTN","BIVISIT1",164,0)
 ;
"RTN","BIVISIT1",165,0)
 ;---> Save IEN of Visit just created.
"RTN","BIVISIT1",166,0)
 S BIVSIT=APCDALVR("APCDVSIT")
"RTN","BIVISIT1",167,0)
 Q
"RTN","BIVISIT1",168,0)
 ;
"RTN","BIVISIT1",169,0)
 ;
"RTN","BIVISIT1",170,0)
 ;----------
"RTN","BIVISIT1",171,0)
OLDCALL ;EP
"RTN","BIVISIT1",172,0)
 ;---> Create a Visit in VISIT File using APCDALV.
"RTN","BIVISIT1",173,0)
 ;---> Parameters per above.
"RTN","BIVISIT1",174,0)
 ;---> No new PIMS, call Lori's older API.
"RTN","BIVISIT1",175,0)
 I '$D(APCDALVR("APCDAUTO")) D FULL^VALM1 W:$D(IOF) @IOF
"RTN","BIVISIT1",176,0)
 D EN^APCDALV
"RTN","BIVISIT1",177,0)
 Q
"RTN","BIVISIT1",178,0)
 ;
"RTN","BIVISIT1",179,0)
 ;
"RTN","BIVISIT1",180,0)
 ;----------
"RTN","BIVISIT1",181,0)
NEWCALL ;EP
"RTN","BIVISIT1",182,0)
 ;---> Create a Visit in VISIT File using new PIMS 5.3+.
"RTN","BIVISIT1",183,0)
 ;---> Parameters per above.
"RTN","BIVISIT1",184,0)
 ;---> No new PIMS, call Lori's older API.
"RTN","BIVISIT1",185,0)
 ;
"RTN","BIVISIT1",186,0)
 ;W !,"IN NEWCALL." R ZZZ
"RTN","BIVISIT1",187,0)
 N APCDIN,APCDOUT
"RTN","BIVISIT1",188,0)
 ;S APCDIN("ANCILLARY")=1
"RTN","BIVISIT1",189,0)
 S APCDIN("SHOW VISITS")=1
"RTN","BIVISIT1",190,0)
 S APCDIN("PAT")=APCDALVR("APCDPAT")
"RTN","BIVISIT1",191,0)
 S APCDIN("VISIT DATE")=APCDALVR("APCDDATE")
"RTN","BIVISIT1",192,0)
 S APCDIN("SITE")=APCDALVR("APCDLOC")
"RTN","BIVISIT1",193,0)
 S APCDIN("VISIT TYPE")=APCDALVR("APCDTYPE")
"RTN","BIVISIT1",194,0)
 S APCDIN("SRV CAT")=APCDALVR("APCDCAT")
"RTN","BIVISIT1",195,0)
 S APCDIN("TIME RANGE")=60
"RTN","BIVISIT1",196,0)
 S APCDIN("USR")=$S($G(DUZ):DUZ,1:1)
"RTN","BIVISIT1",197,0)
 S APCDIN("APCDLOC")=APCDALVR("APCDLOC")
"RTN","BIVISIT1",198,0)
 S:($G(APCDALVR("APCDOLOC"))]"") APCDIN("APCDOLOC")=APCDALVR("APCDOLOC")
"RTN","BIVISIT1",199,0)
 ;
"RTN","BIVISIT1",200,0)
 ;---> Go get or create a Visit.
"RTN","BIVISIT1",201,0)
 D
"RTN","BIVISIT1",202,0)
 .;---> If Visit Selection Menu is disabled, make an automated call.
"RTN","BIVISIT1",203,0)
 .;---> Link to a Visit within 30 minutes.
"RTN","BIVISIT1",204,0)
 .I '$$VISMNU^BIUTL2(BISITE) D GETVISIT^APCDAPI4(.APCDIN,.APCDOUT) Q
"RTN","BIVISIT1",205,0)
 .;
"RTN","BIVISIT1",206,0)
 .;---> Okay, Visit Selection Menu is enabled.
"RTN","BIVISIT1",207,0)
 .;---> Don't match on time.
"RTN","BIVISIT1",208,0)
 .S APCDIN("TIME RANGE")=-1
"RTN","BIVISIT1",209,0)
 .S APCDIN("NEVER ADD")=1
"RTN","BIVISIT1",210,0)
 .D GETVISIT^APCDAPI4(.APCDIN,.APCDOUT)
"RTN","BIVISIT1",211,0)
 .N BIPAT S BIPAT("PAT")=BIDFN
"RTN","BIVISIT1",212,0)
 .D FULL^VALM1 W:$D(IOF) @IOF
"RTN","BIVISIT1",213,0)
 .D SELECT^BSDAPI5(.BIPAT,.APCDOUT) ;THIS IS NOT A P.E.P. (CANNOT CALL IT).
"RTN","BIVISIT1",214,0)
 .;
"RTN","BIVISIT1",215,0)
 ;
"RTN","BIVISIT1",216,0)
 ;X ^O
"RTN","BIVISIT1",217,0)
 ;
"RTN","BIVISIT1",218,0)
 ;---> Variable containing parent IEN does not exist, so error out.
"RTN","BIVISIT1",219,0)
 I '$D(APCDOUT(0)) D ERRCD^BIUTL2(435,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT1",220,0)
 ;
"RTN","BIVISIT1",221,0)
 ;---> No Visits matching and none created, so error out.
"RTN","BIVISIT1",222,0)
 I $P(APCDOUT(0),U)=0 S BIERR="1^"_$P(APCDOUT(0),U,2) Q
"RTN","BIVISIT1",223,0)
 ;
"RTN","BIVISIT1",224,0)
 ;---> One Visit (matched or created), so set Visit IEN.
"RTN","BIVISIT1",225,0)
 S:APCDOUT(0)=1 APCDALVR("APCDVSIT")=$O(APCDOUT(0))
"RTN","BIVISIT1",226,0)
 ;
"RTN","BIVISIT1",227,0)
 ;---> If more than one Visit matches within 60 minutes, choose
"RTN","BIVISIT1",228,0)
 ;---> the closest in time.
"RTN","BIVISIT1",229,0)
 D:APCDOUT(0)>1
"RTN","BIVISIT1",230,0)
 .;---> Creat array based on time difference.
"RTN","BIVISIT1",231,0)
 .N A,X,Y S X=0
"RTN","BIVISIT1",232,0)
 .F  S X=$O(APCDOUT(X)) Q:'X  D
"RTN","BIVISIT1",233,0)
 ..;
"RTN","BIVISIT1",234,0)
 ..;---> Allow for negative values of Y (in time difference).
"RTN","BIVISIT1",235,0)
 ..S Y=APCDOUT(X) I Y]"" S:Y<0 Y=-Y S A(Y)=X
"RTN","BIVISIT1",236,0)
 .;
"RTN","BIVISIT1",237,0)
 .;X ^O
"RTN","BIVISIT1",238,0)
 .;---> Now grab the IEN of the closest Visit in time.
"RTN","BIVISIT1",239,0)
 .S Y="",X=""
"RTN","BIVISIT1",240,0)
 .F  S Y=$O(A(Y)) Q:Y=""  Q:$G(APCDALVR("APCDVSIT"))  D
"RTN","BIVISIT1",241,0)
 ..I ((Y=0)!(Y>0)),A(Y)>0 S APCDALVR("APCDVSIT")=A(Y) Q
"RTN","BIVISIT1",242,0)
 ;
"RTN","BIVISIT1",243,0)
 ;---> Got a valid Visit IEN, so quit.
"RTN","BIVISIT1",244,0)
 Q:$G(APCDALVR("APCDVSIT"))
"RTN","BIVISIT1",245,0)
 ;
"RTN","BIVISIT1",246,0)
 ;---> None of the above cases match, so error out.
"RTN","BIVISIT1",247,0)
 D ERRCD^BIUTL2(438,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT1",248,0)
 ;
"RTN","BIVISIT1",249,0)
 Q
"RTN","BIVISIT2")
0^166^B25663423
"RTN","BIVISIT2",1,0)
BIVISIT2 ;IHS/CMI/MWR - DELETE VISITS; MAY 10, 2010
"RTN","BIVISIT2",2,0)
 ;;8.5;IMMUNIZATION;**5**;JUL 01,2013;Build 2
"RTN","BIVISIT2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVISIT2",4,0)
 ;;  CODE TO DELETE V FILE VISITS, TRIGGER EVENT FOR DELETE IMM.
"RTN","BIVISIT2",5,0)
 ;;  PATCH 5: TRIGADD EP moved from rtn BIVISIT for Rsize.  TRIGADD+0
"RTN","BIVISIT2",6,0)
 ;
"RTN","BIVISIT2",7,0)
 ;
"RTN","BIVISIT2",8,0)
 ;----------
"RTN","BIVISIT2",9,0)
DELETE(BIDA,BIVTYPE,BIERR) ;EP
"RTN","BIVISIT2",10,0)
 ;---> Delete a V IMMUNIZATION File entry.
"RTN","BIVISIT2",11,0)
 ;---> Called exclusively by ^BIRPC3.
"RTN","BIVISIT2",12,0)
 ;---> Parameters:
"RTN","BIVISIT2",13,0)
 ;     1 - BIDA    (req) IEN of V File entry to be deleted.
"RTN","BIVISIT2",14,0)
 ;     2 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIVISIT2",15,0)
 ;     3 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIVISIT2",16,0)
 ;
"RTN","BIVISIT2",17,0)
 ;---> If DA not passed, set Error Code and quit.
"RTN","BIVISIT2",18,0)
 I '$G(BIDA) D ERRCD^BIUTL2(404,.BIERR) Q
"RTN","BIVISIT2",19,0)
 ;
"RTN","BIVISIT2",20,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIVISIT2",21,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIVISIT2",22,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIVISIT2",23,0)
 .D ERRCD^BIUTL2(410,.BIERR)
"RTN","BIVISIT2",24,0)
 ;
"RTN","BIVISIT2",25,0)
 ;---> DIK kills D.
"RTN","BIVISIT2",26,0)
 N BIGBL,BIGBLK
"RTN","BIVISIT2",27,0)
 S BIGBLK=$S(BIVTYPE="I":"^AUPNVIMM(",1:"^AUPNVSK(")
"RTN","BIVISIT2",28,0)
 S BIGBL=BIGBLK_BIDA_",0)"
"RTN","BIVISIT2",29,0)
 ;
"RTN","BIVISIT2",30,0)
 ;---> If V File Visit doesn't exist, set Error and quit.
"RTN","BIVISIT2",31,0)
 I '$D(@BIGBL) D ERRCD^BIUTL2(411,.BIERR) Q
"RTN","BIVISIT2",32,0)
 ;
"RTN","BIVISIT2",33,0)
 ;---> Save VISIT pointer for this V File entry.
"RTN","BIVISIT2",34,0)
 N APCDVDLT S APCDVDLT=$P(@BIGBL,U,3)
"RTN","BIVISIT2",35,0)
 ;
"RTN","BIVISIT2",36,0)
 ;---> Store Immunization Visit data for Trigger Event in BIDATA.
"RTN","BIVISIT2",37,0)
 N BIDATA
"RTN","BIVISIT2",38,0)
 D:BIVTYPE="I" SAVEDATA(BIDA,.BIDATA)
"RTN","BIVISIT2",39,0)
 ;
"RTN","BIVISIT2",40,0)
 ;
"RTN","BIVISIT2",41,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT2",42,0)
 ;---> Switch to logical deletion of V Immunizations.
"RTN","BIVISIT2",43,0)
 ;---> Note: Edits are also stored and can be reviewed.
"RTN","BIVISIT2",44,0)
 ;
"RTN","BIVISIT2",45,0)
 D:BIVTYPE="I"
"RTN","BIVISIT2",46,0)
 .N BINODE S BINODE=@BIGBL
"RTN","BIVISIT2",47,0)
 .;---> Create an entry in BI PATIENT CONTRAINDICATION DELETED File.
"RTN","BIVISIT2",48,0)
 .N BIERR,BIIEN,BIFLD
"RTN","BIVISIT2",49,0)
 .S BIFLD(.01)=$P(BINODE,U,1)
"RTN","BIVISIT2",50,0)
 .S BIFLD(.02)=$P(BINODE,U,2)
"RTN","BIVISIT2",51,0)
 .S BIFLD(.03)=$P(BINODE,U,3)
"RTN","BIVISIT2",52,0)
 .S BIFLD(2.01)=+$G(DUZ)
"RTN","BIVISIT2",53,0)
 .D NOW^%DTC S BIFLD(2.02)=%
"RTN","BIVISIT2",54,0)
 .D UPDATE^BIFMAN(9002084.118,.BIIEN,.BIFLD,.BIERR)
"RTN","BIVISIT2",55,0)
 .;---> Quit if new entry failed.
"RTN","BIVISIT2",56,0)
 .I BIERR]"" S BIERR=BI31_BIERR Q
"RTN","BIVISIT2",57,0)
 .;---> Quit if new entry IEN bad.
"RTN","BIVISIT2",58,0)
 .I '$D(^BIVIMMD(+BIIEN(1),0)) D  Q
"RTN","BIVISIT2",59,0)
 ..D ERRCD^BIUTL2(450,.BIERR) S BIERR=BI31_BIERR
"RTN","BIVISIT2",60,0)
 .;---> Now copy the rest of the Imm data.
"RTN","BIVISIT2",61,0)
 .S ^BIVIMMD(+BIIEN(1),0)=^AUPNVIMM(BIDA,0)
"RTN","BIVISIT2",62,0)
 .S:($D(^AUPNVIMM(BIDA,1))) ^BIVIMMD(+BIIEN(1),1)=^AUPNVIMM(BIDA,1)
"RTN","BIVISIT2",63,0)
 .S:($D(^AUPNVIMM(BIDA,12))) ^BIVIMMD(+BIIEN(1),12)=^AUPNVIMM(BIDA,12)
"RTN","BIVISIT2",64,0)
 ;
"RTN","BIVISIT2",65,0)
 Q:(BIERR]"")
"RTN","BIVISIT2",66,0)
 ;**********
"RTN","BIVISIT2",67,0)
 ;
"RTN","BIVISIT2",68,0)
 ;---> Delete the V File entry (and decrement the
"RTN","BIVISIT2",69,0)
 ;---> Dependent Entry Count of the parent Visit).
"RTN","BIVISIT2",70,0)
 N D,DA,DIK S DA=BIDA,DIK=BIGBLK
"RTN","BIVISIT2",71,0)
 D ^DIK
"RTN","BIVISIT2",72,0)
 ;
"RTN","BIVISIT2",73,0)
 ;---> If deletion of the V File Visit failed, set Error and quit.
"RTN","BIVISIT2",74,0)
 I $D(@BIGBL) D ERRCD^BIUTL2(428,.BIERR) Q
"RTN","BIVISIT2",75,0)
 ;
"RTN","BIVISIT2",76,0)
 ;---> If the DEPENDENT ENTRY COUNT for parent Visit is 0, then
"RTN","BIVISIT2",77,0)
 ;---> delete the Visit, too.
"RTN","BIVISIT2",78,0)
 S DLAYGO=9000010
"RTN","BIVISIT2",79,0)
 D:'$P(^AUPNVSIT(APCDVDLT,0),U,9) ^APCDVDLT
"RTN","BIVISIT2",80,0)
 ;
"RTN","BIVISIT2",81,0)
 ;---> Trigger Event, call Protocol: BI DELETE IMMUNIZATION.
"RTN","BIVISIT2",82,0)
 D:BIVTYPE="I" TRIGDEL($G(BIDATA))
"RTN","BIVISIT2",83,0)
 ;
"RTN","BIVISIT2",84,0)
 Q
"RTN","BIVISIT2",85,0)
 ;
"RTN","BIVISIT2",86,0)
 ;
"RTN","BIVISIT2",87,0)
 ;----------
"RTN","BIVISIT2",88,0)
SAVEDATA(BIDA,BIDATA) ;EP
"RTN","BIVISIT2",89,0)
 ;---> Save V Immunization data for Trigger Event, return in BIDATA.
"RTN","BIVISIT2",90,0)
 ;---> Parameters:
"RTN","BIVISIT2",91,0)
 ;     1 - BIDA   (req) IEN of V IMMUNIZATION entry.
"RTN","BIVISIT2",92,0)
 ;     2 - BIDATA (ret) String of data returned.
"RTN","BIVISIT2",93,0)
 ;
"RTN","BIVISIT2",94,0)
 Q:'$G(BIDA)
"RTN","BIVISIT2",95,0)
 ;
"RTN","BIVISIT2",96,0)
 ;---> Specify Data Elements to collect.
"RTN","BIVISIT2",97,0)
 ;
"RTN","BIVISIT2",98,0)
 ;---> IEN PC  DATA
"RTN","BIVISIT2",99,0)
 ;---> --- --  ----
"RTN","BIVISIT2",100,0)
 ;---> 4   2 = Vaccine Name, Short.
"RTN","BIVISIT2",101,0)
 ;---> 6   3 = Dose#.
"RTN","BIVISIT2",102,0)
 ;---> 25  4 = Vaccine Code, HL7.
"RTN","BIVISIT2",103,0)
 ;---> 30  5 = Vaccine IEN.
"RTN","BIVISIT2",104,0)
 ;---> 33  6 = Vaccine Lot Number (text).
"RTN","BIVISIT2",105,0)
 ;---> 34  7 = Location IEN.
"RTN","BIVISIT2",106,0)
 ;---> 35  8 = Category of Visit (A,E, or I)
"RTN","BIVISIT2",107,0)
 ;---> 36  9 = Location Other (text).
"RTN","BIVISIT2",108,0)
 ;---> 44 10 = Vaccine Reaction (text).
"RTN","BIVISIT2",109,0)
 ;---> 56 11 = Date of Immunization (Fileman format).
"RTN","BIVISIT2",110,0)
 ;---> 58 12 = Patient DFN.
"RTN","BIVISIT2",111,0)
 ;---> 59 13 = Visit, PCC Type (I,C,6).
"RTN","BIVISIT2",112,0)
 ;
"RTN","BIVISIT2",113,0)
 N BIDE,I
"RTN","BIVISIT2",114,0)
 F I=4,6,25,30,33,34,35,36,44,56,58,59 S BIDE(I)=""
"RTN","BIVISIT2",115,0)
 D GET^BIRPC1(.BIDATA,BIDA,"I",.BIDE)
"RTN","BIVISIT2",116,0)
 ;
"RTN","BIVISIT2",117,0)
 ;---> If an error is passed back, set BIDATA="".
"RTN","BIVISIT2",118,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIVISIT2",119,0)
 I $P(BIDATA,BI31,2)]"" S BIDATA="" Q
"RTN","BIVISIT2",120,0)
 S BIDATA=$P(BIDATA,BI31)
"RTN","BIVISIT2",121,0)
 Q
"RTN","BIVISIT2",122,0)
 ;
"RTN","BIVISIT2",123,0)
 ;
"RTN","BIVISIT2",124,0)
 ;----------
"RTN","BIVISIT2",125,0)
TRIGDEL(BIDATA) ;EP
"RTN","BIVISIT2",126,0)
 ;---> Immunization Deleted Trigger Event call to Protocol File.
"RTN","BIVISIT2",127,0)
 ;---> V Immunization data of just deleted visit is saved in BIDATA.
"RTN","BIVISIT2",128,0)
 ;---> (Note: Trigger Event for ADD Immunization is in rtn BIVISIT.)
"RTN","BIVISIT2",129,0)
 ;---> Parameters:
"RTN","BIVISIT2",130,0)
 ;     1 - BIDATA (req) String of V Imm data.
"RTN","BIVISIT2",131,0)
 ;
"RTN","BIVISIT2",132,0)
 Q:$G(BIDATA)=""
"RTN","BIVISIT2",133,0)
 ;
"RTN","BIVISIT2",134,0)
 ;---> Local variables available when Delete Event is triggered:
"RTN","BIVISIT2",135,0)
 ;
"RTN","BIVISIT2",136,0)
 ;     BICAT  -  Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIVISIT2",137,0)
 ;     BIDATE -  Date of Visit (Fileman format).
"RTN","BIVISIT2",138,0)
 ;     BIDFN  -  DFN of patient.
"RTN","BIVISIT2",139,0)
 ;     BIDOSE -  Dose# number for this Immunization.
"RTN","BIVISIT2",140,0)
 ;     BILOC  -  Location of encounter (IEN).
"RTN","BIVISIT2",141,0)
 ;     BILOT  -  Lot number for this Immunization (text).
"RTN","BIVISIT2",142,0)
 ;     BIOLOC -  Other Location of encounter (text).
"RTN","BIVISIT2",143,0)
 ;     BIPTR  -  Vaccine (IEN in IMMUNIZATION File).
"RTN","BIVISIT2",144,0)
 ;     BIREC  -  Vaccine Reaction (text).
"RTN","BIVISIT2",145,0)
 ;     BITYPE -  Type of Visit (PCC Master Control File I,C,6).
"RTN","BIVISIT2",146,0)
 ;     BIVHL7 -  Vaccine HL7 Code.
"RTN","BIVISIT2",147,0)
 ;     BIVISD -  Release/Revision Date of VIS (YYYMMDD).
"RTN","BIVISIT2",148,0)
 ;     BIVNAM -  Vaccine Name, short form.
"RTN","BIVISIT2",149,0)
 ;
"RTN","BIVISIT2",150,0)
 ;---> Parse out Immunization Visit data in local variables.
"RTN","BIVISIT2",151,0)
 N V S V="|"
"RTN","BIVISIT2",152,0)
 ;
"RTN","BIVISIT2",153,0)
 S BICAT=$P(BIDATA,V,8)
"RTN","BIVISIT2",154,0)
 S BIDATE=$P(BIDATA,V,11)
"RTN","BIVISIT2",155,0)
 S BIDFN=$P(BIDATA,V,12)
"RTN","BIVISIT2",156,0)
 S BIDOSE=$P(BIDATA,V,3)
"RTN","BIVISIT2",157,0)
 S BILOC=$P(BIDATA,V,7)
"RTN","BIVISIT2",158,0)
 S BILOT=$P(BIDATA,V,6)
"RTN","BIVISIT2",159,0)
 S BIOLOC=$P(BIDATA,V,9)
"RTN","BIVISIT2",160,0)
 S BIPTR=$P(BIDATA,V,5)
"RTN","BIVISIT2",161,0)
 S BIREC=$P(BIDATA,V,10)
"RTN","BIVISIT2",162,0)
 S BITYPE=$P(BIDATA,V,13)
"RTN","BIVISIT2",163,0)
 S BIVHL7=$P(BIDATA,V,4)
"RTN","BIVISIT2",164,0)
 S BIVNAM=$P(BIDATA,V,2)
"RTN","BIVISIT2",165,0)
 S DIC=101,X="BI IMMUNIZATION DELETED"
"RTN","BIVISIT2",166,0)
 ;
"RTN","BIVISIT2",167,0)
 N BISAVE
"RTN","BIVISIT2",168,0)
 S BISAVE="BICAT;BIDATE;BIDFN;BIDOSE;BILOC;BILOT;BIOLOC;BIPTR;BIREC;BITYPE;BIVHL7;BIVNAM;DIC;X;XQORS"
"RTN","BIVISIT2",169,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTUCI,ZTCPU,ZTPRI,ZTSAVE,ZTKIL,ZTSYNC,ZTSK
"RTN","BIVISIT2",170,0)
 S ZTRTN="EN^XQOR"
"RTN","BIVISIT2",171,0)
 S ZTDESC="Immunization Deleted Trigger Event"
"RTN","BIVISIT2",172,0)
 S ZTDTH=$H
"RTN","BIVISIT2",173,0)
 S ZTIO="NULL"
"RTN","BIVISIT2",174,0)
 N V,I F I=1:1:$L(BISAVE,";") S V=$P(BISAVE,";",I) S ZTSAVE(V)=""
"RTN","BIVISIT2",175,0)
 ;
"RTN","BIVISIT2",176,0)
 D ^%ZTLOAD
"RTN","BIVISIT2",177,0)
 Q
"RTN","BIVISIT2",178,0)
 ;
"RTN","BIVISIT2",179,0)
 ;
"RTN","BIVISIT2",180,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT2",181,0)
 ;---> TRIGADD EP moved from rtn BIVISIT for Rsize.
"RTN","BIVISIT2",182,0)
 ;----------
"RTN","BIVISIT2",183,0)
TRIGADD ;EP
"RTN","BIVISIT2",184,0)
 ;---> Exclusively called from VFILE+216^BIVISIT.
"RTN","BIVISIT2",185,0)
 ;---> Immunization Added Trigger Event call to Protocol File.
"RTN","BIVISIT2",186,0)
 ;---> Called at the end/bottom of BIVISIT, after new V IMM created.
"RTN","BIVISIT2",187,0)
 ;---> (Note: Trigger Event for DELETE Immunization is in rtn BIVISIT2.)
"RTN","BIVISIT2",188,0)
 ;---> Local variables available when Event is triggered:
"RTN","BIVISIT2",189,0)
 ;
"RTN","BIVISIT2",190,0)
 ;     BIADFN -  IEN of V IMMUNIZATION just created.
"RTN","BIVISIT2",191,0)
 ;     BICAT  -  Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIVISIT2",192,0)
 ;     BIDATE -  Date of Visit (Fileman format).
"RTN","BIVISIT2",193,0)
 ;     BIDFN  -  DFN of patient.
"RTN","BIVISIT2",194,0)
 ;     BILOC  -  Location of encounter (IEN).
"RTN","BIVISIT2",195,0)
 ;     BILOT  -  Lot Number IEN for this Immunization (text).
"RTN","BIVISIT2",196,0)
 ;     BIOLOC -  Other Location of encounter (text).
"RTN","BIVISIT2",197,0)
 ;     BIPTR  -  Vaccine (IEN in IMMUNIZATION File).
"RTN","BIVISIT2",198,0)
 ;     BIREC  -  Vaccine Reaction (text).
"RTN","BIVISIT2",199,0)
 ;     BITYPE -  Type of Visit (PCC Master Control File I,C,6).
"RTN","BIVISIT2",200,0)
 ;     BIVHL7 -  Vaccine HL7 Code.
"RTN","BIVISIT2",201,0)
 ;     BIVNAM -  Vaccine Name, short form.
"RTN","BIVISIT2",202,0)
 ;     BIVSIT -  IEN of Visit.
"RTN","BIVISIT2",203,0)
 ;
"RTN","BIVISIT2",204,0)
 ;
"RTN","BIVISIT2",205,0)
 N BIVNAM,BIVHL7,BISAVE
"RTN","BIVISIT2",206,0)
 S BIVNAM=$$VNAME^BIUTL2(BIPTR)
"RTN","BIVISIT2",207,0)
 S BIVHL7=$$CODE^BIUTL2(BIPTR,1)
"RTN","BIVISIT2",208,0)
 S BIREC=$$REACTXT^BIUTL6(BIREC)
"RTN","BIVISIT2",209,0)
 S BILOT=$$LOTTX^BIUTL6(BILOT)
"RTN","BIVISIT2",210,0)
 S DIC=101,X="BI IMMUNIZATION ADDED"
"RTN","BIVISIT2",211,0)
 ;
"RTN","BIVISIT2",212,0)
 S BISAVE="BIADFN;BICAT;BIDATE;BIDFN;BILOC;BILOT;BIOLOC;BIPTR;BIREC;BITYPE;BIVHL7;BIVNAM;BIVSIT;DIC;X;XQORS"
"RTN","BIVISIT2",213,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTUCI,ZTCPU,ZTPRI,ZTSAVE,ZTKIL,ZTSYNC,ZTSK
"RTN","BIVISIT2",214,0)
 S ZTRTN="EN^XQOR"
"RTN","BIVISIT2",215,0)
 S ZTDESC="Immunization Added Trigger Event"
"RTN","BIVISIT2",216,0)
 S ZTDTH=$H
"RTN","BIVISIT2",217,0)
 S ZTIO="NULL"
"RTN","BIVISIT2",218,0)
 N V,I F I=1:1:$L(BISAVE,";") S V=$P(BISAVE,";",I) S ZTSAVE(V)=""
"RTN","BIVISIT2",219,0)
 ;
"RTN","BIVISIT2",220,0)
 D ^%ZTLOAD
"RTN","BIVISIT2",221,0)
 ;
"RTN","BIVISIT2",222,0)
 Q
"RTN","BIVISIT2",223,0)
 ;**********
"RTN","BIVT100")
0^167^B11189202
"RTN","BIVT100",1,0)
BIVT100 ;IHS/CMI/MWR - UPDATE CODES FOR VT100; MAY 10, 2010
"RTN","BIVT100",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIVT100",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVT100",4,0)
 ;;  UPDATE SCREEN HANDLING CODES FOR C-VT100 IN TERMINAL TYPE FILE.
"RTN","BIVT100",5,0)
 ;;  NOT CALLED FROM ANY MENU.
"RTN","BIVT100",6,0)
 ;
"RTN","BIVT100",7,0)
 ;---> Running this routine from START will update the Terminal Type
"RTN","BIVT100",8,0)
 ;---> File entry for C-VT100.
"RTN","BIVT100",9,0)
 ;---> Following the instructions at BUILD will store the C-VT100
"RTN","BIVT100",10,0)
 ;---> Codes from the local ^%ZIS(2,9) entry into this routine.
"RTN","BIVT100",11,0)
 ;
"RTN","BIVT100",12,0)
 ;----------
"RTN","BIVT100",13,0)
START ;EP
"RTN","BIVT100",14,0)
 ;
"RTN","BIVT100",15,0)
 Q:('$G(DT))
"RTN","BIVT100",16,0)
 Q:(DT>3100101)
"RTN","BIVT100",17,0)
 ;W !?3,"This step will update your VT100 Codes for Listmanager display"
"RTN","BIVT100",18,0)
 N BITT,Y
"RTN","BIVT100",19,0)
 ;D DIC^BIFMAN(3.2,"QEMA",.Y,"   Select VT100 Device: ","C-VT100")
"RTN","BIVT100",20,0)
 ;Q:'Y
"RTN","BIVT100",21,0)
 ;S BITT=+Y
"RTN","BIVT100",22,0)
 S BITT=$O(^%ZIS(2,"B","C-VT100",0))
"RTN","BIVT100",23,0)
 Q:'BITT  Q:$P($G(^%ZIS(2,BITT,0)),"^")'="C-VT100"
"RTN","BIVT100",24,0)
 ;
"RTN","BIVT100",25,0)
 ;---> Update C-VT100 Terminal Type entry.
"RTN","BIVT100",26,0)
 N BIDONE S BIDONE=0
"RTN","BIVT100",27,0)
 N I,X,Y,Z F I=1:1 S X=$T(@"CODES"+I) Q:X'[";;"  D
"RTN","BIVT100",28,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BIVT100",29,0)
 .N BIX S BIX="^%"_$C(90)_$C(73)_"S(2,BITT,Y)",@BIX=Z,BIDONE=1
"RTN","BIVT100",30,0)
 Q
"RTN","BIVT100",31,0)
 ;
"RTN","BIVT100",32,0)
 D
"RTN","BIVT100",33,0)
 .I $G(BIDONE) W !!?3,"C-VT100 UPDATED!" Q
"RTN","BIVT100",34,0)
 .W !!?3,"* NO CHANGES MADE!  (You must uncomment the ^%ZIS line.)"
"RTN","BIVT100",35,0)
 D DIRZ^BIUTL3()
"RTN","BIVT100",36,0)
 Q
"RTN","BIVT100",37,0)
 ;
"RTN","BIVT100",38,0)
 ;
"RTN","BIVT100",39,0)
 ;
"RTN","BIVT100",40,0)
 ;----------
"RTN","BIVT100",41,0)
BUILD ;EP
"RTN","BIVT100",42,0)
 ;---> Build routine rest of this routine, containing current
"RTN","BIVT100",43,0)
 ;---> C-VT100 screen handling codes for updating the Terminal
"RTN","BIVT100",44,0)
 ;---> Type File.
"RTN","BIVT100",45,0)
 ;---> Used by package programmer only.  Not called by any option
"RTN","BIVT100",46,0)
 ;---> or User action.
"RTN","BIVT100",47,0)
 ;---> To use: 1) Load this routine and delete all lines after
"RTN","BIVT100",48,0)
 ;--->            line label CODES, including the line label.
"RTN","BIVT100",49,0)
 ;--->         2) At programmer prompt type:
"RTN","BIVT100",50,0)
 ;--->            ZL BIVT100 D BUILD^BIVT100  X BIX0.
"RTN","BIVT100",51,0)
 ;
"RTN","BIVT100",52,0)
 D SETVARS^BIUTL5
"RTN","BIVT100",53,0)
 S BIX0="N I F I=1:1 Q:'$D(@(""BIX""_I))  X @(""BIX""_I)"
"RTN","BIVT100",54,0)
 S BIX1="ZI "" ;"","" ;"","" ;----------"",""CODES ;EP"""
"RTN","BIVT100",55,0)
 S BIX2="N N S N=-1 F  S N=$O(^%ZIS(2,9,N)) Q:N=""""  "
"RTN","BIVT100",56,0)
 S BIX2=BIX2_"ZI "" ;;""_N_"";;""_^(N)"
"RTN","BIVT100",57,0)
 S BIX3="ZS BIVT100"
"RTN","BIVT100",58,0)
 Q
"RTN","BIVT100",59,0)
 ;
"RTN","BIVT100",60,0)
 ;
"RTN","BIVT100",61,0)
 ;----------
"RTN","BIVT100",62,0)
CODES ;EP
"RTN","BIVT100",63,0)
 ;;0;;C-VT100^1
"RTN","BIVT100",64,0)
 ;;1;;80^$C(27,91,50,74,27,91,72),#^24^$C(8)^W $C(27,91)_((DY+1))_$C(59)_((DX+1))_$C(72)
"RTN","BIVT100",65,0)
 ;;5;;^^$C(27,91,72)^$C(27,91,55,109)^$C(27,91,109)^$C(27,91,75)^$C(27,91,74)^$C(27,91,53,109)^$C(27,91,109)
"RTN","BIVT100",66,0)
 ;;6;;$C(27,99)^^^$C(27,91,52,109)^$C(27,91,109)^^^$C(27,91,109)
"RTN","BIVT100",67,0)
 ;;7;;$C(27,91,49,109)^$C(27,91,109)^$C(27,91,109)
"RTN","BIVT100",68,0)
 ;;8;;$C(27)_"[A"^$C(27)_"[B"^$C(27)_"[C"^$C(27)_"[D"^3^^$C(27,91)_"1L"
"RTN","BIVT100",69,0)
 ;;8.1;;$C(27)_"[?25h"^$C(27)_"[?25l"
"RTN","BIVT100",70,0)
 ;;9;;Digital Equipment Corporation VT-100 video
"RTN","BIVT100",71,0)
 ;;10;;W *27,"[5i"
"RTN","BIVT100",72,0)
 ;;11;;H 1 W *27,"[4i"
"RTN","BIVT100",73,0)
 ;;13;;$C(27,91,49,74)^$C(27,91,50,74)^$C(27,91,49,75)^$C(27,91,50,75)^^$C(27)_"7"_$J("",X)_$C(27)_"8"
"RTN","BIVT100",74,0)
 ;;14;;$C(27)_"D"^$C(27)_"M"^$C(27,55)^$C(27,56)^$C(27)_"E"
"RTN","BIVT100",75,0)
 ;;15;;$C(27,91,63,55,104)^$C(27,91,63,55,108)^$C(27,91,63,56,104)^$C(27,91,63,56,108)^$C(27,61)^$C(27,62)
"RTN","BIVT100",76,0)
 ;;16;;$C(27,72)^$C(27,91,103)^$C(27,91,51,103)^$C(27,91)_(+IOTM)_$C(59)_(+IOBM)_$C(114)
"RTN","BIVT100",77,0)
 ;;17;;$C(27,35,51)^$C(27,35,52)^$C(27,35,54)^$C(27,35,53)
"RTN","BIVT100",78,0)
 ;;18;;$C(27)_"Op"^$C(27)_"Oq"^$C(27)_"Or"^$C(27)_"Os"^$C(27)_"Ot"^$C(27)_"Ou"^$C(27)_"Ov"^$C(27)_"Ow"^$C(27)_"Ox"^$C(27)_"Oy"
"RTN","BIVT100",79,0)
 ;;19;;$C(27)_"OP"^$C(27)_"OQ"^$C(27)_"OR"^$C(27)_"OS"^$C(27)_"Om"^$C(27)_"Ol"^$C(27)_"OM"^$C(27)_"On"
"RTN","BIVT100",80,0)
 ;;G;;"l"^"m"^"k"^"j"^"n"^"w"^"v"^"t"^"u"^"x"^"q"
"RTN","BIVT100",81,0)
 ;;G0;;$C(27)_"(B"
"RTN","BIVT100",82,0)
 ;;G1;;$C(27)_"(0"
"RTN","BIVT100",83,0)
 ;;SY;;VT
"RTN","BIVT100",84,0)
 ;;XY;;W $C(27,91)_((DY+1))_$C(59)_((DX+1))_$C(72)
"RTN","BIVTAB")
0^168^B20875514
"RTN","BIVTAB",1,0)
BIVTAB ;IHS/CMI/MWR - VIEW VACCINE TRANSLATION TABLE; MAY 10, 2010
"RTN","BIVTAB",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIVTAB",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVTAB",4,0)
 ;;  VIEW VACCINE TRANSLATION TABLE THROUGH LISTMANAGER.
"RTN","BIVTAB",5,0)
 ;
"RTN","BIVTAB",6,0)
 ;----------
"RTN","BIVTAB",7,0)
START ;EP
"RTN","BIVTAB",8,0)
 D SETVARS^BIUTL5 K ^TMP("BIVTAB",$J) N BITMP,DIR
"RTN","BIVTAB",9,0)
 D EN
"RTN","BIVTAB",10,0)
 D FULL^VALM1
"RTN","BIVTAB",11,0)
 Q
"RTN","BIVTAB",12,0)
 ;
"RTN","BIVTAB",13,0)
 ;
"RTN","BIVTAB",14,0)
 ;----------
"RTN","BIVTAB",15,0)
EN ;EP
"RTN","BIVTAB",16,0)
 ;---> Main entry point for option BI REPORT VACCINE TRANSLAT.
"RTN","BIVTAB",17,0)
 D EN^VALM("BI VACCINE TRANS TABLE VIEW")
"RTN","BIVTAB",18,0)
 Q
"RTN","BIVTAB",19,0)
 ;
"RTN","BIVTAB",20,0)
 ;
"RTN","BIVTAB",21,0)
 ;----------
"RTN","BIVTAB",22,0)
HDR ;EP
"RTN","BIVTAB",23,0)
 ;---> Header code
"RTN","BIVTAB",24,0)
 N BIDASH,BILINE,X,Y S BILINE=0
"RTN","BIVTAB",25,0)
 D WH^BIW(.BILINE)
"RTN","BIVTAB",26,0)
 S X=$$REPHDR^BIUTL6(DUZ(2)),BIDASH=$L(X)+2 D CENTERT^BIUTL5(.X)
"RTN","BIVTAB",27,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVTAB",28,0)
 S X=$$SP^BIUTL5(BIDASH,"-") D CENTERT^BIUTL5(.X)
"RTN","BIVTAB",29,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVTAB",30,0)
 S X="VACCINE TRANSLATION TABLE" D CENTERT^BIUTL5(.X)
"RTN","BIVTAB",31,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVTAB",32,0)
 S X="  OLD"
"RTN","BIVTAB",33,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVTAB",34,0)
 S X="  IHS   OLD            NEW HL7      HL7"
"RTN","BIVTAB",35,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVTAB",36,0)
 S X="  CODE  SHORT NAME     SHORT NAME   CODE   NEW HL7 LONG NAME"
"RTN","BIVTAB",37,0)
 D WH^BIW(.BILINE,X)
"RTN","BIVTAB",38,0)
 Q
"RTN","BIVTAB",39,0)
 ;
"RTN","BIVTAB",40,0)
 ;
"RTN","BIVTAB",41,0)
 ;----------
"RTN","BIVTAB",42,0)
INIT ;EP
"RTN","BIVTAB",43,0)
 ;---> Initialize variables and list array.
"RTN","BIVTAB",44,0)
 ;
"RTN","BIVTAB",45,0)
 S VALMSG="Enter ?? for more actions."
"RTN","BIVTAB",46,0)
 S VALM("TITLE")=" (Immunization v"_$$VER^BILOGO_")"
"RTN","BIVTAB",47,0)
 ;
"RTN","BIVTAB",48,0)
 N BIN,I
"RTN","BIVTAB",49,0)
 ;
"RTN","BIVTAB",50,0)
 S BIN=0
"RTN","BIVTAB",51,0)
 F  S BIN=$O(^BITO(BIN)) Q:'BIN  D
"RTN","BIVTAB",52,0)
 .N BI0,BIY S BI0=^BITO(BIN,0)
"RTN","BIVTAB",53,0)
 .;---> Old IHS Code.
"RTN","BIVTAB",54,0)
 .S BI0(1)=$P(BI0,U,3)
"RTN","BIVTAB",55,0)
 .;---> Old Short Name.
"RTN","BIVTAB",56,0)
 .S BI0(2)=$P(BI0,U,2)
"RTN","BIVTAB",57,0)
 .;---> Get pointer to new HL7 Vaccine entry.
"RTN","BIVTAB",58,0)
 .S BI0(3)=$P(BI0,U,20)
"RTN","BIVTAB",59,0)
 .;---> New HL7 Short Name.
"RTN","BIVTAB",60,0)
 .S BI0(4)=$$VNAME^BIUTL2(BI0(3))
"RTN","BIVTAB",61,0)
 .;---> New HL7 Code.
"RTN","BIVTAB",62,0)
 .S BI0(5)=$$CODE^BIUTL2(BI0(3))
"RTN","BIVTAB",63,0)
 .;---> New HL7 Long Name.
"RTN","BIVTAB",64,0)
 .S BI0(6)=$$VNAME^BIUTL2(BI0(3),1)
"RTN","BIVTAB",65,0)
 .;
"RTN","BIVTAB",66,0)
 .;---> Set formatted line in ^TMP for Listman to display.
"RTN","BIVTAB",67,0)
 .S BIY="   "_BI0(1)_"   "_$$PAD^BIUTL5(BI0(2),15,".")
"RTN","BIVTAB",68,0)
 .S BIY=BIY_$$PAD^BIUTL5(BI0(4),13,".")_$J(BI0(5),3)
"RTN","BIVTAB",69,0)
 .S BIY=BIY_"    "_$E(BI0(6),1,36)
"RTN","BIVTAB",70,0)
 .;
"RTN","BIVTAB",71,0)
 .S BITMP("BIVTAB",BI0(2))=BIY
"RTN","BIVTAB",72,0)
 ;
"RTN","BIVTAB",73,0)
 S BIN=0
"RTN","BIVTAB",74,0)
 F I=1:1 S BIN=$O(BITMP("BIVTAB",BIN)) Q:BIN=""  D
"RTN","BIVTAB",75,0)
 .S ^TMP("BIVTAB",$J,I,0)=BITMP("BIVTAB",BIN)
"RTN","BIVTAB",76,0)
 ;
"RTN","BIVTAB",77,0)
 S VALMCNT=I-1
"RTN","BIVTAB",78,0)
 Q
"RTN","BIVTAB",79,0)
 ;
"RTN","BIVTAB",80,0)
 ;
"RTN","BIVTAB",81,0)
 ;----------
"RTN","BIVTAB",82,0)
RESET ;EP
"RTN","BIVTAB",83,0)
 ;---> Update partition for return to Listmanager.
"RTN","BIVTAB",84,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIVTAB",85,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIVTAB",86,0)
 D INIT,HDR Q
"RTN","BIVTAB",87,0)
 ;
"RTN","BIVTAB",88,0)
 ;
"RTN","BIVTAB",89,0)
 ;----------
"RTN","BIVTAB",90,0)
HELP ;EP
"RTN","BIVTAB",91,0)
 ;---> Help code.
"RTN","BIVTAB",92,0)
 N BIX S BIX=X
"RTN","BIVTAB",93,0)
 D FULL^VALM1
"RTN","BIVTAB",94,0)
 D TITLE^BIUTL5("VACCINE TRANSLATION TABLE - HELP")
"RTN","BIVTAB",95,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIVTAB",96,0)
 D:BIX'="??" RE^VALM4
"RTN","BIVTAB",97,0)
 Q
"RTN","BIVTAB",98,0)
 ;
"RTN","BIVTAB",99,0)
 ;
"RTN","BIVTAB",100,0)
 ;----------
"RTN","BIVTAB",101,0)
TEXT1 ;EP
"RTN","BIVTAB",102,0)
 ;;With the installation of Immunization v7.0, new vaccines were
"RTN","BIVTAB",103,0)
 ;;added to the Vaccine Table and several non-standard vaccines were
"RTN","BIVTAB",104,0)
 ;;translated to new standard names.  More importantly, the old IHS
"RTN","BIVTAB",105,0)
 ;;Codes for vaccines were translated to their equivalent HL7 Codes.
"RTN","BIVTAB",106,0)
 ;;
"RTN","BIVTAB",107,0)
 ;;This list, the Vaccine Translation Table, shows how the old IHS
"RTN","BIVTAB",108,0)
 ;;Vaccine Table on your computer was converted to the new HL7 Table.
"RTN","BIVTAB",109,0)
 ;;The list DOES NOT contain all of the new vaccines that are now
"RTN","BIVTAB",110,0)
 ;;in your Vaccine Table--it only shows how the old Vaccines were
"RTN","BIVTAB",111,0)
 ;;translated to the new HL7 Vaccine Table.  (The entire new Vaccine
"RTN","BIVTAB",112,0)
 ;;Table may be viewed/printed under the Manager Menu, MGR-->VAC.)
"RTN","BIVTAB",113,0)
 ;;
"RTN","BIVTAB",114,0)
 ;;It may be helpful to print this list, initially, for people who
"RTN","BIVTAB",115,0)
 ;;were previously using the old IHS Codes for Data Entry.  This will
"RTN","BIVTAB",116,0)
 ;;show them which HL7 Codes should now be used instead.
"RTN","BIVTAB",117,0)
 ;
"RTN","BIVTAB",118,0)
 D PRINTX("TEXT1")
"RTN","BIVTAB",119,0)
 Q
"RTN","BIVTAB",120,0)
 ;
"RTN","BIVTAB",121,0)
 ;
"RTN","BIVTAB",122,0)
 ;----------
"RTN","BIVTAB",123,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIVTAB",124,0)
 Q:$G(BILINL)=""
"RTN","BIVTAB",125,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIVTAB",126,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIVTAB",127,0)
 Q
"RTN","BIVTAB",128,0)
 ;
"RTN","BIVTAB",129,0)
 ;
"RTN","BIVTAB",130,0)
 ;----------
"RTN","BIVTAB",131,0)
EXIT ;EP
"RTN","BIVTAB",132,0)
 ;---> End of job cleanup.
"RTN","BIVTAB",133,0)
 K ^TMP("BIVTAB",$J)
"RTN","BIVTAB",134,0)
 D CLEAR^VALM1
"RTN","BIVTAB",135,0)
 D FULL^VALM1
"RTN","BIVTAB",136,0)
 Q
"RTN","BIW")
0^169^B4799995
"RTN","BIW",1,0)
BIW ;IHS/CMI/MWR - WRITE LINES TO ^TMP.; MAY 10, 2010
"RTN","BIW",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIW",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIW",4,0)
 ;;  WRITE LINES TO ^TMP AND VALMHDR FOR LISTMAN DISPLAYS & REPORTS.
"RTN","BIW",5,0)
 ;
"RTN","BIW",6,0)
 ;
"RTN","BIW",7,0)
 ;----------
"RTN","BIW",8,0)
WH(BILINE,BIVAL,BIBLNK) ;EP
"RTN","BIW",9,0)
 ;---> Write a Header line to the VALMHDR array (Listman Header).
"RTN","BIW",10,0)
 ;---> Parameters:
"RTN","BIW",11,0)
 ;     1 - BILINE (ret) Last line# in the Header array.
"RTN","BIW",12,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIW",13,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIW",14,0)
 ;
"RTN","BIW",15,0)
 Q:'$D(BILINE)
"RTN","BIW",16,0)
 S:$G(BIVAL)="" BIVAL=" "
"RTN","BIW",17,0)
 S BILINE=BILINE+1,VALMHDR(BILINE)=BIVAL
"RTN","BIW",18,0)
 ;
"RTN","BIW",19,0)
 ;---> Write as many blank line after as specified by parameter 3.
"RTN","BIW",20,0)
 N I F I=1:1:+$G(BIBLNK) S BILINE=BILINE+1,VALMHDR(BILINE)=" "
"RTN","BIW",21,0)
 Q
"RTN","BIW",22,0)
 ;
"RTN","BIW",23,0)
 ;
"RTN","BIW",24,0)
 ;----------
"RTN","BIW",25,0)
WL(BILINE,BINOD,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIW",26,0)
 ;---> Write a line to the ^TMP global for WP or Listman.
"RTN","BIW",27,0)
 ;---> Parameters:
"RTN","BIW",28,0)
 ;     1 - BILINE (ret) Last line# in the WP ^TMP global.
"RTN","BIW",29,0)
 ;     2 - BINOD  (req) Node in ^TMP to store lines under.
"RTN","BIW",30,0)
 ;     3 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIW",31,0)
 ;     4 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIW",32,0)
 ;     5 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BIW",33,0)
 ;
"RTN","BIW",34,0)
 Q:$G(BINOD)=""
"RTN","BIW",35,0)
 S:'$G(BILINE) BILINE=0
"RTN","BIW",36,0)
 S:$G(BIVAL)="" BIVAL=" "
"RTN","BIW",37,0)
 ;
"RTN","BIW",38,0)
 S BILINE=BILINE+1
"RTN","BIW",39,0)
 S ^TMP(BINOD,$J,BILINE,0)=BIVAL
"RTN","BIW",40,0)
 S:$G(BIENT) ^TMP(BINOD,$J,"IDX",BILINE,BIENT)=""
"RTN","BIW",41,0)
 ;
"RTN","BIW",42,0)
 ;---> Write as many blank lines after as specified by parameter 4.
"RTN","BIW",43,0)
 N I F I=1:1:+$G(BIBLNK) D
"RTN","BIW",44,0)
 .S BILINE=BILINE+1,^TMP(BINOD,$J,BILINE,0)=" "
"RTN","BIW",45,0)
 .S:$G(BIENT) ^TMP(BINOD,$J,"IDX",BILINE,BIENT)=""
"RTN","BIW",46,0)
 Q
"RTN","BIW",47,0)
 ;
"RTN","BIW",48,0)
 ;
"RTN","BIW",49,0)
 ;;*** BELOW IS A STANDARD "WRITE" CALL THAT CAN BE PASTED INTO
"RTN","BIW",50,0)
 ;;*** A ROUTINE FOR MULTIPLE CALLS FROM THAT ROUTINE TO THE ABOVE
"RTN","BIW",51,0)
 ;;*** SUBROUTINE. NOTE: THE NODE PASSED MUST BE EDITED AS APPROPRIATE.
"RTN","BIW",52,0)
 ;----------
"RTN","BIW",53,0)
WRITE(BILINE,BIVAL,BIBLNK,BIENT) ;EP
"RTN","BIW",54,0)
 ;---> Write lines to ^TMP (see documentation in ^BIW).
"RTN","BIW",55,0)
 ;---> Parameters:
"RTN","BIW",56,0)
 ;     1 - BILINE (ret) Last line# written.
"RTN","BIW",57,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BIW",58,0)
 ;     3 - BIBLNK (opt) Number of blank lines to add after line sent.
"RTN","BIW",59,0)
 ;     4 - BIENT  (opt) Entry Number for LM selection in VALMY
"RTN","BIW",60,0)
 ;
"RTN","BIW",61,0)
 Q:'$D(BILINE)
"RTN","BIW",62,0)
 D WL^BIW(.BILINE,"BIREPA1",$G(BIVAL),$G(BIBLNK),$G(BIENT))
"RTN","BIW",63,0)
 Q
"RTN","BIW",64,0)
 ;
"RTN","BIW",65,0)
 ;
"RTN","BIW",66,0)
 ;----------
"RTN","BIW",67,0)
MARK(BILINE,BILNS,BINODE) ;EP
"RTN","BIW",68,0)
 ;---> Mark the top line of a record (or node in a Listman TMP global
"RTN","BIW",69,0)
 ;---> with the number of lines in that record.
"RTN","BIW",70,0)
 ;---> This utility enables one to avoid splitting records with
"RTN","BIW",71,0)
 ;---> formfeeds when printing.
"RTN","BIW",72,0)
 ;---> The number of lines in a record is stored by appending a number
"RTN","BIW",73,0)
 ;---> of $C(30)'s equal to the number of lines, delimited by $C(31).
"RTN","BIW",74,0)
 ;---> Note that $(30) and $C(31) are not visible characters on screen.
"RTN","BIW",75,0)
 ;---> This code is picked up by line label PRTLST, just below,
"RTN","BIW",76,0)
 ;---> when printing a Listman TMP global.
"RTN","BIW",77,0)
 ;---> Parameters:
"RTN","BIW",78,0)
 ;     1 - BILINE (ret) Top line of the record to be marked.
"RTN","BIW",79,0)
 ;     2 - BILNS  (req) Number of lines in the record.
"RTN","BIW",80,0)
 ;     3 - BINODE (req) The node in ^TMP storing the text,
"RTN","BIW",81,0)
 ;                      e.g., "BIDULV" in  ^TMP("BIDULV",$J,BILINE,0).
"RTN","BIW",82,0)
 ;
"RTN","BIW",83,0)
 Q:'$G(BILINE)  Q:'$G(BILNS)  Q:$G(BINODE)=""
"RTN","BIW",84,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIW",85,0)
 N BILNS1,I S BILNS1=""
"RTN","BIW",86,0)
 F I=1:1:BILNS S BILNS1=BILNS1_$C(30)
"RTN","BIW",87,0)
 S $P(^TMP(BINODE,$J,BILINE,0),BI31,2)=BILNS1
"RTN","BIW",88,0)
 Q
"RTN","BIXCALL")
0^170^B46799525
"RTN","BIXCALL",1,0)
BIXCALL ;IHS/CMI/MWR - XCALL TO IMMSERVE LIBRARY; MAY 10, 2010
"RTN","BIXCALL",2,0)
 ;;8.5;IMMUNIZATION;**2**;MAY 15,2012;Build 2
"RTN","BIXCALL",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIXCALL",4,0)
 ;;  XCALL TO IMMSERVE LIBRARY FOR FORCASTING IMMUNIZATIONS.
"RTN","BIXCALL",5,0)
 ;;  Called from ^BIPATUP.
"RTN","BIXCALL",6,0)
 ;;  PATCH 1: Change Immserve host file names to "06".  RUN+46
"RTN","BIXCALL",7,0)
 ;
"RTN","BIXCALL",8,0)
 ;
"RTN","BIXCALL",9,0)
 ;----------
"RTN","BIXCALL",10,0)
RUN(BIHX,BIRPT,BIDATA,BIERR) ;EP
"RTN","BIXCALL",11,0)
 ;---> Entry point for XCALL to Immserve Forecast Library.
"RTN","BIXCALL",12,0)
 ;---> Patient's Immunization History is supplied; ImmServe Forecast
"RTN","BIXCALL",13,0)
 ;---> is returned as text profile (BIRPT) and as data string (BIDATA).
"RTN","BIXCALL",14,0)
 ;---> Parameters:
"RTN","BIXCALL",15,0)
 ;     1 - BIHX   (req) String containing Patient's Immunization History.
"RTN","BIXCALL",16,0)
 ;     2 - BIRPT  (ret) String returning text version of forcast.
"RTN","BIXCALL",17,0)
 ;     3 - BIDATA (ret) String returning data version of forcast.
"RTN","BIXCALL",18,0)
 ;     4 - BIERR  (ret) String returning text of error code.
"RTN","BIXCALL",19,0)
 ;
"RTN","BIXCALL",20,0)
 ;---> Quit if Patient IMM Hx not provided.
"RTN","BIXCALL",21,0)
 I $G(BIHX)="" S (BIRPT,BIDATA,BIERR)=$$ERROR(999) Q
"RTN","BIXCALL",22,0)
 ;
"RTN","BIXCALL",23,0)
 ;---> Uncomment to see Patient History sent to ImmServe.
"RTN","BIXCALL",24,0)
 ;W !,"BIHX: ",BIHX R ZZZ
"RTN","BIXCALL",25,0)
 ;
"RTN","BIXCALL",26,0)
 S BIERR="",BIRPT="",BIDATA=""
"RTN","BIXCALL",27,0)
 S BIHX=BIHX_$C(10)
"RTN","BIXCALL",28,0)
 ;
"RTN","BIXCALL",29,0)
 ;---> BIDLLPROG is special variable--stored locally, not passed--for speed.
"RTN","BIXCALL",30,0)
 I $G(BIDLLPROG)="" D
"RTN","BIXCALL",31,0)
 .S:'$D(BISITE) BISITE=+$G(DUZ(2))
"RTN","BIXCALL",32,0)
 .N BIDLLPATH
"RTN","BIXCALL",33,0)
 .S BIDLLPATH=$$IMMSVDIR^BIUTL8(BISITE)
"RTN","BIXCALL",34,0)
 .I $G(BIDLLPATH)="" S BIERR=119 Q
"RTN","BIXCALL",35,0)
 .;
"RTN","BIXCALL",36,0)
 .;---> SAC Exemption from 2.2.3.3.2
"RTN","BIXCALL",37,0)
 .;---> Purpose: Cache proprietary call to check/set Immserve directory.
"RTN","BIXCALL",38,0)
 .;---> SAC Exemption Memo dated Feb 2004.
"RTN","BIXCALL",39,0)
 .S $ZT="ERRTRAP^BIXCALL"
"RTN","BIXCALL",40,0)
 .I $ZU(168,BIDLLPATH)
"RTN","BIXCALL",41,0)
 .I $G(BIERR)]"" Q
"RTN","BIXCALL",42,0)
 .;
"RTN","BIXCALL",43,0)
 .;---> Set ImmServe Program call.
"RTN","BIXCALL",44,0)
 .;W !!,"BUILDING CALL" R ZZZ  ;Uncomment for testing.
"RTN","BIXCALL",45,0)
 .;
"RTN","BIXCALL",46,0)
 .;---> Patch to flag whether system is 32-bit or 64-bit.
"RTN","BIXCALL",47,0)
 .D
"RTN","BIXCALL",48,0)
 ..N Y,BIT S Y=$$VERSION^%ZOSV(1)
"RTN","BIXCALL",49,0)
 ..;
"RTN","BIXCALL",50,0)
 ..;---> SAC Exemption from 2.2.6.2.3
"RTN","BIXCALL",51,0)
 ..;---> This command from Intersystems is necessary to determine whether
"RTN","BIXCALL",52,0)
 ..;---> the operating system is 32-bit or 64-bit. (Request made to VA
"RTN","BIXCALL",53,0)
 ..;---> for future %ZOSV call.)  Returns 4 for 32-bit and 8 for 64-bit.
"RTN","BIXCALL",54,0)
 ..S BIT=$ZU(40,0,4)
"RTN","BIXCALL",55,0)
 ..;
"RTN","BIXCALL",56,0)
 ..;********** VERSION 8.4, v8.4, APR 15,2010, IHS/CMI/MWR
"RTN","BIXCALL",57,0)
 ..;---> Change to "02" for new Immserve, e.g., biwin3202 instead of biwin3201.
"RTN","BIXCALL",58,0)
 ..;---> Change to "04" for new Immserve, e.g., biwin3204 instead of biwin3202.
"RTN","BIXCALL",59,0)
 ..;********** VERSION 8.5, JUL 01,2011, IHS/CMI/MWR
"RTN","BIXCALL",60,0)
 ..;---> Change to "05" for new Immserve, e.g., biwin3205 instead of biwin3204.
"RTN","BIXCALL",61,0)
 ..;********** VERSION 8.52, MAY 15,2012, IHS/CMI/MWR
"RTN","BIXCALL",62,0)
 ..;---> Change to "06" for new Immserve, e.g., biwin3206 instead of biwin3205.
"RTN","BIXCALL",63,0)
 ..;
"RTN","BIXCALL",64,0)
 ..I ((Y["Windows")&(BIT=8)) S BIDLLPROG="biwin6406.dll" Q
"RTN","BIXCALL",65,0)
 ..I Y["Windows" S BIDLLPROG="biwin3206.dll" Q
"RTN","BIXCALL",66,0)
 ..I ((Y["Linux")&(BIT=8)) S BIDLLPROG="bilin6406.so" Q
"RTN","BIXCALL",67,0)
 ..I Y["Linux" S BIDLLPROG="bilin3206.so" Q
"RTN","BIXCALL",68,0)
 ..I ((Y["Solaris")&(BIT=8)) S BIDLLPROG="bisol6406.so" Q
"RTN","BIXCALL",69,0)
 ..I ((Y["UNIX")&(BIT=8)) S BIDLLPROG="biaix6406.so" Q
"RTN","BIXCALL",70,0)
 ..I Y["UNIX" S BIDLLPROG="biaix3206.so" Q
"RTN","BIXCALL",71,0)
 ..;---> NEXT LINE: Good for calling a new version conditional upon Immserve path.
"RTN","BIXCALL",72,0)
 ..;I ((Y["UNIX")&(BIT=8)) S BIDLLPROG="biaix6403.so" S:BIDLLPATH["84a" BIDLLPROG="biaix6404.so" Q
"RTN","BIXCALL",73,0)
 ..;**********
"RTN","BIXCALL",74,0)
 ..;
"RTN","BIXCALL",75,0)
 ..I $G(BIDLLPROG)="" S BIERR=120 Q
"RTN","BIXCALL",76,0)
 .;---> Now prepend the path.
"RTN","BIXCALL",77,0)
 .S BIDLLPROG=BIDLLPATH_BIDLLPROG
"RTN","BIXCALL",78,0)
 I $G(BIERR)]"" Q
"RTN","BIXCALL",79,0)
 ;
"RTN","BIXCALL",80,0)
 ;---> SAC Exemption from 2.2.3.3.2
"RTN","BIXCALL",81,0)
 ;---> Purpose: To trap error during Cache proprietary call to Immserve library.
"RTN","BIXCALL",82,0)
 ;---> SAC Exemption Memo dated Feb 2004.
"RTN","BIXCALL",83,0)
 S $ZT="ERRTRAP1^BIXCALL"
"RTN","BIXCALL",84,0)
 ;
"RTN","BIXCALL",85,0)
 ;---> Load the DLL if it is not already in the partition.
"RTN","BIXCALL",86,0)
 I '$G(BIDLLID)!('$G(BIDLLRUN)) D LOAD(BIDLLPROG,.BIDLLID,.BIDLLRUN,.BIERR)
"RTN","BIXCALL",87,0)
 I BIERR S (BIRPT,BIDATA,BIERR)=$$ERROR^BIXCALL(BIERR) Q
"RTN","BIXCALL",88,0)
 ;
"RTN","BIXCALL",89,0)
 S BIHX=BIHX_$C(10)
"RTN","BIXCALL",90,0)
 ;
"RTN","BIXCALL",91,0)
 ;---> SAC Exemption from 2.2.6.2.3
"RTN","BIXCALL",92,0)
 ;---> Purpose: Cache proprietary call to Immserve commercial forecasting
"RTN","BIXCALL",93,0)
 ;---> software.  This applies to all $ZF calls in this routine.
"RTN","BIXCALL",94,0)
 ;---> SAC Exemption Memo dated Feb 2004.
"RTN","BIXCALL",95,0)
 ;---> Dimitri Fane's ZF call to Fred Sayward's library.
"RTN","BIXCALL",96,0)
 S BIRESULT=$ZF(-5,BIDLLID,BIDLLRUN,"",BIHX,"",8192,"",8192)
"RTN","BIXCALL",97,0)
 ;
"RTN","BIXCALL",98,0)
 ;---> For Testing, uncomment next line to see the raw data returned
"RTN","BIXCALL",99,0)
 ;---> from ImmServe:
"RTN","BIXCALL",100,0)
 ;W !!!,BIRESULT R ZZZ
"RTN","BIXCALL",101,0)
 ;
"RTN","BIXCALL",102,0)
 S BIERR=$P(BIRESULT,"&&&,",1)
"RTN","BIXCALL",103,0)
 I BIERR S (BIRPT,BIDATA,BIERR)=$$ERROR^BIXCALL(BIERR) Q
"RTN","BIXCALL",104,0)
 S BIDATA=$P(BIRESULT,"&&&,",2)
"RTN","BIXCALL",105,0)
 S BIRPT=$P(BIRESULT,"&&&,",3)
"RTN","BIXCALL",106,0)
 S:BIERR=0 BIERR=""
"RTN","BIXCALL",107,0)
 ;
"RTN","BIXCALL",108,0)
 ;N X,Y
"RTN","BIXCALL",109,0)
 ;S X=$P(BIDATA,"Female"),Y=$P(BIDATA,"Female",2)
"RTN","BIXCALL",110,0)
 ;S BIDATA=X_"Female^"_Y
"RTN","BIXCALL",111,0)
 ;
"RTN","BIXCALL",112,0)
 Q
"RTN","BIXCALL",113,0)
 ;
"RTN","BIXCALL",114,0)
 ;
"RTN","BIXCALL",115,0)
 ;----------
"RTN","BIXCALL",116,0)
LOAD(BIDLLPROG,BIDLLID,BIDLLRUN,BIERR) ;EP
"RTN","BIXCALL",117,0)
 ;W !,"LOADING..." R ZZZ  ;Uncomment for testing.
"RTN","BIXCALL",118,0)
 ;---> Cache Load and initialize Immserve Forecast Library.
"RTN","BIXCALL",119,0)
 ;---> This load may be run repeatedly in the same partition, however
"RTN","BIXCALL",120,0)
 ;---> for the sake of performance it should only be called the
"RTN","BIXCALL",121,0)
 ;---> first time.  Test for BIDLLID and BIDLLRUN determines whether
"RTN","BIXCALL",122,0)
 ;---> this gets called or not.
"RTN","BIXCALL",123,0)
 ;---> Parameters:
"RTN","BIXCALL",124,0)
 ;     1 - BIDLLPROG (req) Path and name of ImmServe Program call.
"RTN","BIXCALL",125,0)
 ;     2 - BIDLLID   (ret) Index number to the DLL.
"RTN","BIXCALL",126,0)
 ;     3 - BIDLLRUN  (ret) Index number to the RUN function of the DLL.
"RTN","BIXCALL",127,0)
 ;     4 - BIERR     (ret) Error code if DLL not loaded successfully.
"RTN","BIXCALL",128,0)
 ;
"RTN","BIXCALL",129,0)
 ;---> $ZF(-4,1,path) loads a DLL and returns the index number to the DLL.
"RTN","BIXCALL",130,0)
 S BIDLLID=$ZF(-4,1,BIDLLPROG)
"RTN","BIXCALL",131,0)
 I '$G(BIDLLID) S BIERR=997 Q
"RTN","BIXCALL",132,0)
 ;
"RTN","BIXCALL",133,0)
 ;---> $ZF(-4,3,BIDLLID,function) returns the index number of the function
"RTN","BIXCALL",134,0)
 ;---> in the DLL described by BIDLLID.
"RTN","BIXCALL",135,0)
 ;---> Next line: IMM_IHS (load and run in one call) not used.
"RTN","BIXCALL",136,0)
 ;S BIDLLRUN=$ZF(-4,3,BIDLLID,"IMM_ASCII")
"RTN","BIXCALL",137,0)
 N BILOAD
"RTN","BIXCALL",138,0)
 S BILOAD=$ZF(-4,3,BIDLLID,"IMM_ASCII_LOAD")
"RTN","BIXCALL",139,0)
 S BIDLLRUN=$ZF(-4,3,BIDLLID,"IMM_ASCII_RUN")
"RTN","BIXCALL",140,0)
 I '$G(BIDLLRUN) S BIERR=996 Q
"RTN","BIXCALL",141,0)
 S BIERR=$P($ZF(-5,BIDLLID,BILOAD,""),"&&&")
"RTN","BIXCALL",142,0)
 Q
"RTN","BIXCALL",143,0)
 ;
"RTN","BIXCALL",144,0)
 ;
"RTN","BIXCALL",145,0)
 ;----------
"RTN","BIXCALL",146,0)
ERROR(BIERRNUM) ;EP
"RTN","BIXCALL",147,0)
 ;---> Return text of error, based on number passed.
"RTN","BIXCALL",148,0)
 ;---> Parameters:
"RTN","BIXCALL",149,0)
 ;     1 - BIERRNUM (req) Numeric value of error.
"RTN","BIXCALL",150,0)
 ;
"RTN","BIXCALL",151,0)
 Q "BICALL Error: "_$$ERRMSG(BIERRNUM)
"RTN","BIXCALL",152,0)
 ;
"RTN","BIXCALL",153,0)
 ;
"RTN","BIXCALL",154,0)
 ;----------
"RTN","BIXCALL",155,0)
ERRMSG(X) ;EP
"RTN","BIXCALL",156,0)
 ;---> Error messages.
"RTN","BIXCALL",157,0)
 Q:X=1 "1;Some cases could not be processed."
"RTN","BIXCALL",158,0)
 Q:X=-1 "-1;Cannot find, open, load the Versions/Variants file."
"RTN","BIXCALL",159,0)
 Q:X=-2 "-2;Cannot find, open, load Imm/Def table file."
"RTN","BIXCALL",160,0)
 Q:X=-3 "-3;Cannot find, open, load Screening table file."
"RTN","BIXCALL",161,0)
 Q:X=-4 "-4;Cannot find, open, load Live Vaccine Table file."
"RTN","BIXCALL",162,0)
 Q:X=-5 "-5;Cannot find, open, load Facts defining constants file."
"RTN","BIXCALL",163,0)
 Q:X=-6 "-6;Cannot find, open, load VFC eligibility file."
"RTN","BIXCALL",164,0)
 Q:X=-7 "-7;Cannot find, open, load Knowledge Base file."
"RTN","BIXCALL",165,0)
 Q:X=-8 "-8;Cannot initialize time tables."
"RTN","BIXCALL",166,0)
 Q:X=-9 "-9;Cannot initialize timeline."
"RTN","BIXCALL",167,0)
 Q:X=-10 "-10;Input carot string is empty."
"RTN","BIXCALL",168,0)
 Q:X=-11 "-11;Input case not terminated with new line."
"RTN","BIXCALL",169,0)
 Q:X=-12 "-12;Cannot convert a carot notation input case."
"RTN","BIXCALL",170,0)
 Q:X=-13 "-13;Cannot initialize global data structures."
"RTN","BIXCALL",171,0)
 Q:X=-14 "-14;Internal report writer buffer overflow."
"RTN","BIXCALL",172,0)
 Q:X=-15 "-15;Internal report writer fatal error."
"RTN","BIXCALL",173,0)
 Q:X=-16 "-16;Interface report buffer overflow."
"RTN","BIXCALL",174,0)
 Q:X=-17 "-17;Cannot convert to carot notation output."
"RTN","BIXCALL",175,0)
 Q:X=-18 "-18;Interface output buffer overflow."
"RTN","BIXCALL",176,0)
 Q:X=-19 "-19;Fatal runtime error."
"RTN","BIXCALL",177,0)
 Q:X=-99 "-99;Immserve not loaded into memory.  D LOAD^BIXCALL."
"RTN","BIXCALL",178,0)
 Q:X=100 "100;Report Buffer must be at least 80."
"RTN","BIXCALL",179,0)
 Q:X=200 "200;Data Buffer must be at least 80."
"RTN","BIXCALL",180,0)
 Q:X=101 "101;Report buffer too small for report."
"RTN","BIXCALL",181,0)
 Q:X=201 "201;Data buffer too small for data."
"RTN","BIXCALL",182,0)
 Q:X=996 "996;Failure to obtain Immserve DLL RUN number."
"RTN","BIXCALL",183,0)
 Q:X=997 "997;Failure to obtain Immserve DLL ID number."
"RTN","BIXCALL",184,0)
 Q:X=998 "998;Immserve path not provided."
"RTN","BIXCALL",185,0)
 Q:X=999 "999;Patient Immunization History data not provided."
"RTN","BIXCALL",186,0)
 Q:X=9999 "9999;XCALL Failure (Immserve file not loaded)."
"RTN","BIXCALL",187,0)
 Q "99999;Unknown error"
"RTN","BIXCALL",188,0)
 ;
"RTN","BIXCALL",189,0)
 ;
"RTN","BIXCALL",190,0)
 ;----------
"RTN","BIXCALL",191,0)
ERRTRAP ;EP
"RTN","BIXCALL",192,0)
 ;---> Error trap for Invalid ImmServe Path.
"RTN","BIXCALL",193,0)
 ;---> Attempt to open Host File Server.
"RTN","BIXCALL",194,0)
 ;---> SAC Exemption from 2.4.3.1, 2.4.9.1, 2.4.11.1.
"RTN","BIXCALL",195,0)
 ;---> Purpose: to address HFS for forecasting without changing
"RTN","BIXCALL",196,0)
 ;---> the current display/print Device and its IO characteristics.
"RTN","BIXCALL",197,0)
 ;---> SAC Exemption Memo dated 1 Nov 99.
"RTN","BIXCALL",198,0)
 ;
"RTN","BIXCALL",199,0)
 D ERRCD^BIUTL2(118,.BIERR)
"RTN","BIXCALL",200,0)
 Q
"RTN","BIXCALL",201,0)
 ;
"RTN","BIXCALL",202,0)
 ;
"RTN","BIXCALL",203,0)
 ;----------
"RTN","BIXCALL",204,0)
ERRTRAP1 ;EP
"RTN","BIXCALL",205,0)
 ;---> Error trap for Invalid ImmServe library call.
"RTN","BIXCALL",206,0)
 D ERRCD^BIUTL2(122,.BIERR)
"RTN","BIXCALL",207,0)
 Q
"RTN","BIXRPC")
0^171^B13726940
"RTN","BIXRPC",1,0)
BIXRPC ;IHS/CMI/MWR - BI REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIXRPC",2,0)
 ;;8.5;IMMUNIZATION;;SEP 01,2011;Build 2
"RTN","BIXRPC",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIXRPC",4,0)
 ;;  GENERIC LOOKUP UTILITY FOR RETURNING MATCHING RECORDS
"RTN","BIXRPC",5,0)
 ;;  OR TABLES TO RPC'S.
"RTN","BIXRPC",6,0)
 ;
"RTN","BIXRPC",7,0)
 ; *** NOTE: I have discovered a number of cases where these calls
"RTN","BIXRPC",8,0)
 ;           produce errors (with error messages to IO) or simply
"RTN","BIXRPC",9,0)
 ;           do not work correctly.  ANY CALL to this utility
"RTN","BIXRPC",10,0)
 ;           should be thoroughly tested in the M environment
"RTN","BIXRPC",11,0)
 ;           before being used as an RPC.
"RTN","BIXRPC",12,0)
 ;
"RTN","BIXRPC",13,0)
 ;----------
"RTN","BIXRPC",14,0)
LOOKUP(BIGBL,BIFL,BIFLDS,BIFLG,BIIN,BIMX,BIIX,BISCR,BIMC) ;EP
"RTN","BIXRPC",15,0)
 ;---> Places matching records from requested file into a
"RTN","BIXRPC",16,0)
 ;---> result global, ^BITEMP($J).  The exact global name
"RTN","BIXRPC",17,0)
 ;---> is returned in the first parameter (BIGBL).
"RTN","BIXRPC",18,0)
 ;---> Records are returned one per node in the result global.
"RTN","BIXRPC",19,0)
 ;---> Each record is terminated with a $C(30), for parsing out
"RTN","BIXRPC",20,0)
 ;---> on the VB side, since the Broker concatenates all nodes
"RTN","BIXRPC",21,0)
 ;---> into a single string when passing the data out of M.
"RTN","BIXRPC",22,0)
 ;---> Requested fields within records are delimited by "^".
"RTN","BIXRPC",23,0)
 ;---> NOTE: The first "^"-piece of every node is the IEN of
"RTN","BIXRPC",24,0)
 ;---> that entry in its file; the requested fields follow.
"RTN","BIXRPC",25,0)
 ;---> The final record (node) contains Error Delimiter,
"RTN","BIXRPC",26,0)
 ;     $C(31)_$C(31), followed by error text, if any.
"RTN","BIXRPC",27,0)
 ;
"RTN","BIXRPC",28,0)
 ;---> Parameters:
"RTN","BIXRPC",29,0)
 ;     1 - BIGBL   (ret) Name of result global for Broker.
"RTN","BIXRPC",30,0)
 ;     2 - BIFL    (req) File for lookup.
"RTN","BIXRPC",31,0)
 ;     3 - BIFLDS  (opt) Fields to return w/each entry.
"RTN","BIXRPC",32,0)
 ;     4 - BIFLG   (opt) Flags in DIC(0); If null, "M" is sent.
"RTN","BIXRPC",33,0)
 ;     5 - BIIN    (opt) Input to match on (see Algorithm below).
"RTN","BIXRPC",34,0)
 ;     6 - BIMX    (opt) Maximum number of entries to return.
"RTN","BIXRPC",35,0)
 ;     7 - BIIX    (opt) Indexes to search.
"RTN","BIXRPC",36,0)
 ;     8 - BISCR   (opt) Screen/filter (M code).
"RTN","BIXRPC",37,0)
 ;     9 - BIMC    (opt) Mixed Case: 1=mixed case, 0=no change.
"RTN","BIXRPC",38,0)
 ;                        (Converts data in uppercase to mixed case.)
"RTN","BIXRPC",39,0)
 ;
"RTN","BIXRPC",40,0)
 ;---> Set variables, kill temp globals.
"RTN","BIXRPC",41,0)
 N (BIGBL,BIFL,BIFLDS,BIFLG,BIIN,BIMX,BIIX,BISCR,BIMC)
"RTN","BIXRPC",42,0)
 S BI31=$C(31)_$C(31)
"RTN","BIXRPC",43,0)
 S BIGBL="^BITEMP("_$J_")",BIERR="",U="^"
"RTN","BIXRPC",44,0)
 K ^BITMP($J),^BITEMP($J)
"RTN","BIXRPC",45,0)
 ;
"RTN","BIXRPC",46,0)
 ;---> If file number not provided, return error.
"RTN","BIXRPC",47,0)
 I '$G(BIFL) D ERROUT("File number not provided.",1) Q
"RTN","BIXRPC",48,0)
 ;
"RTN","BIXRPC",49,0)
 ;---> If no fields provided, pass .01.
"RTN","BIXRPC",50,0)
 ;---> IEN will always be the first piece of data returned.
"RTN","BIXRPC",51,0)
 ;---> NOTE: If .01 is NOT included, but the Index to lookup on is
"RTN","BIXRPC",52,0)
 ;--->       NOT on the .01, then the .01 will be returned
"RTN","BIXRPC",53,0)
 ;--->       automatically as the second ^-piece of data in the
"RTN","BIXRPC",54,0)
 ;--->       Result Global.
"RTN","BIXRPC",55,0)
 ;--->       So it would be: IEN^.01^requested fields...
"RTN","BIXRPC",56,0)
 I $G(BIFLDS)="" S BIFLDS=".01"
"RTN","BIXRPC",57,0)
 ;
"RTN","BIXRPC",58,0)
 ;---> If no index or flag provided, set flag="M".
"RTN","BIXRPC",59,0)
 I $G(BIFLG)="" D
"RTN","BIXRPC",60,0)
 .I $G(BIIX)="" S BIFLG="M" Q
"RTN","BIXRPC",61,0)
 .S BIFLG=""
"RTN","BIXRPC",62,0)
 ;
"RTN","BIXRPC",63,0)
 ;---> If no Maximum Number provided, set it to 200.
"RTN","BIXRPC",64,0)
 I '$G(BIMX) S BIMX=200
"RTN","BIXRPC",65,0)
 ;
"RTN","BIXRPC",66,0)
 ;---> Define index and screen.
"RTN","BIXRPC",67,0)
 S:'$D(BIIX) BIIX=""
"RTN","BIXRPC",68,0)
 S:'$D(BISCR) BISCR=""
"RTN","BIXRPC",69,0)
 ;
"RTN","BIXRPC",70,0)
 ;---> Set Target Global for output and errors.
"RTN","BIXRPC",71,0)
 S BIG="^BITMP($J)"
"RTN","BIXRPC",72,0)
 ;
"RTN","BIXRPC",73,0)
 ;---> If Mixed Case not set, set to No Change.
"RTN","BIXRPC",74,0)
 I '$D(BIMC) S BIMC=0
"RTN","BIXRPC",75,0)
 ;
"RTN","BIXRPC",76,0)
 ;---> Silent Fileman call.
"RTN","BIXRPC",77,0)
 D
"RTN","BIXRPC",78,0)
 .I $G(BIIN)="" D  Q
"RTN","BIXRPC",79,0)
 ..D LIST^DIC(BIFL,,BIFLDS,,BIMX,0,,BIIX,BISCR,,BIG,BIG)
"RTN","BIXRPC",80,0)
 .D FIND^DIC(BIFL,,BIFLDS,BIFLG,BIIN,BIMX,BIIX,BISCR,,BIG,BIG)
"RTN","BIXRPC",81,0)
 ;
"RTN","BIXRPC",82,0)
 D WRITE
"RTN","BIXRPC",83,0)
 Q
"RTN","BIXRPC",84,0)
 ;
"RTN","BIXRPC",85,0)
 ;
"RTN","BIXRPC",86,0)
 ;----------
"RTN","BIXRPC",87,0)
WRITE ;EP
"RTN","BIXRPC",88,0)
 ;---> Collect data for matching records and write in result global.
"RTN","BIXRPC",89,0)
 ;
"RTN","BIXRPC",90,0)
 ;---> First, check for errors.
"RTN","BIXRPC",91,0)
 ;---> If errors exist, write them and quit.
"RTN","BIXRPC",92,0)
 N I,N,X
"RTN","BIXRPC",93,0)
 I $D(^BITMP($J,"DIERR")) I $O(^("DIERR",0)) D  Q
"RTN","BIXRPC",94,0)
 .S N=0,X=""
"RTN","BIXRPC",95,0)
 .F  S N=$O(^BITMP($J,"DIERR",N)) Q:'N  D
"RTN","BIXRPC",96,0)
 ..N M S M=0
"RTN","BIXRPC",97,0)
 ..F  S M=$O(^BITMP($J,"DIERR",N,"TEXT",M)) Q:'M  D
"RTN","BIXRPC",98,0)
 ...S X=X_^BITMP($J,"DIERR",N,"TEXT",M)_"  "
"RTN","BIXRPC",99,0)
 .D ERROUT(X,1)
"RTN","BIXRPC",100,0)
 ;
"RTN","BIXRPC",101,0)
 ;
"RTN","BIXRPC",102,0)
 ;---> Write valid results.
"RTN","BIXRPC",103,0)
 ;---> Loop through the IEN node (...2,N) of the temp global.
"RTN","BIXRPC",104,0)
 N I,N,X S N=0
"RTN","BIXRPC",105,0)
 F I=1:1 S N=$O(^BITMP($J,"DILIST",2,N)) Q:'N  D
"RTN","BIXRPC",106,0)
 .;---> Always set first piece of X=IEN of entry.
"RTN","BIXRPC",107,0)
 .S X=^BITMP($J,"DILIST",2,N)
"RTN","BIXRPC",108,0)
 .;
"RTN","BIXRPC",109,0)
 .;---> Collect other fields and concatenate to X.
"RTN","BIXRPC",110,0)
 .N M S M=0
"RTN","BIXRPC",111,0)
 .F  S M=$O(^BITMP($J,"DILIST","ID",N,M)) Q:'M  D
"RTN","BIXRPC",112,0)
 ..S X=X_U_^BITMP($J,"DILIST","ID",N,M)
"RTN","BIXRPC",113,0)
 .;
"RTN","BIXRPC",114,0)
 .;---> Convert data to mixed case if BIMC=1.
"RTN","BIXRPC",115,0)
 .S:BIMC X=$$T^BITRS(X)
"RTN","BIXRPC",116,0)
 .;
"RTN","BIXRPC",117,0)
 .;---> Set data in result global.
"RTN","BIXRPC",118,0)
 .S ^BITEMP($J,I)=X_$C(30)
"RTN","BIXRPC",119,0)
 ;
"RTN","BIXRPC",120,0)
 ;---> If no results, report it as an error.
"RTN","BIXRPC",121,0)
 D:'$O(^BITEMP($J,0))
"RTN","BIXRPC",122,0)
 .I BIIN]"" S BIERR="No entry matches """_BIIN_"""." Q
"RTN","BIXRPC",123,0)
 .S BIERR="Either the lookup file is empty"
"RTN","BIXRPC",124,0)
 .S BIERR=BIERR_" or all entries are screened (software error)."
"RTN","BIXRPC",125,0)
 ;
"RTN","BIXRPC",126,0)
 ;---> Tack on Error Delimiter and any error.
"RTN","BIXRPC",127,0)
 S ^BITEMP($J,I)=BI31_BIERR
"RTN","BIXRPC",128,0)
 Q
"RTN","BIXRPC",129,0)
 ;
"RTN","BIXRPC",130,0)
 ;
"RTN","BIXRPC",131,0)
 ;----------
"RTN","BIXRPC",132,0)
ERROUT(BIERR,I) ;EP
"RTN","BIXRPC",133,0)
 ;---> Save next line for Error Code File if ever used.
"RTN","BIXRPC",134,0)
 ;---> If necessary, use I>1 to avoid overwriting valid data.
"RTN","BIXRPC",135,0)
 ;D ERRCD^BIUTL2(BIERR,.BIERR)
"RTN","BIXRPC",136,0)
 S:'$G(I) I=1
"RTN","BIXRPC",137,0)
 S ^BITEMP($J,I)=BI31_BIERR
"RTN","BIXRPC",138,0)
 Q
"RTN","BIXRPC",139,0)
 ;
"RTN","BIXRPC",140,0)
 ;
"RTN","BIXRPC",141,0)
PASSERR(BIGBL,BIERR) ;EP
"RTN","BIXRPC",142,0)
 ;---> If the RPC routine calling the BI Generic Lookup above
"RTN","BIXRPC",143,0)
 ;---> detects a specific error prior to the call and wants to pass
"RTN","BIXRPC",144,0)
 ;---> that error in the result global rather than a generic error,
"RTN","BIXRPC",145,0)
 ;---> then a call to this function (PASSERR) can be made.
"RTN","BIXRPC",146,0)
 ;---> This call will store the error text passed in the result global.
"RTN","BIXRPC",147,0)
 ;---> The calling routine should then quit (abort its call to the
"RTN","BIXRPC",148,0)
 ;---> BI Generic Lookup function above).
"RTN","BIXRPC",149,0)
 ;
"RTN","BIXRPC",150,0)
 ;---> Parameters:
"RTN","BIXRPC",151,0)
 ;     1 - BIGBL  (ret) Name of result global for Broker.
"RTN","BIXRPC",152,0)
 ;     2 - BIERR  (req) Text of error to be stored in result global.
"RTN","BIXRPC",153,0)
 ;
"RTN","BIXRPC",154,0)
 S:$G(BIERR)="" BIERR="Error not passed (software error)."
"RTN","BIXRPC",155,0)
 ;
"RTN","BIXRPC",156,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIXRPC",157,0)
 K ^BITMP($J),^BITEMP($J)
"RTN","BIXRPC",158,0)
 S BIGBL="^BITEMP("_$J_")"
"RTN","BIXRPC",159,0)
 S ^BITEMP($J,1)=BI31_BIERR
"RTN","BIXRPC",160,0)
 Q
"RTN","BIXTCH")
0^172^B22213527
"RTN","BIXTCH",1,0)
BIXTCH ;IHS/CMI/MWR - XCALL TO TCH FORECASTER;2015-04-02  6:12 PM
"RTN","BIXTCH",2,0)
 ;;8.5;IMMUNIZATION;**9**;OCT 01,2014;Build 2
"RTN","BIXTCH",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIXTCH",4,0)
 ;;  XCALL TO TCH FOR FORCASTING IMMUNIZATIONS.
"RTN","BIXTCH",5,0)
 ;;  Called from ^BIPATUP.
"RTN","BIXTCH",6,0)
 ;;  PATCH 8: New routine to accommodate new TCH Forecaster   RUN+0
"RTN","BIXTCH",7,0)
 ;;  PATCH 9: Add DUZ2 to retrieve IP address for call to TCH. RUN+0
"RTN","BIXTCH",8,0)
 ;
"RTN","BIXTCH",9,0)
SAMPLE ;
"RTN","BIXTCH",10,0)
 ;---> Sample Cache Device handling code to interact with TCH Java Forecaster.
"RTN","BIXTCH",11,0)
 ;---> 6708 is the TCH Forecaster default port (can change in the OS command).
"RTN","BIXTCH",12,0)
 ; START CHANGES: VEN/SMH - *** NON PORTABLE *** USE ^%ZISTCP.
"RTN","BIXTCH",13,0)
 ; O "|TCP|4":("127.0.0.1":6708::):10
"RTN","BIXTCH",14,0)
 ; U "|TCP|4"
"RTN","BIXTCH",15,0)
 ; W "Bonjour, Monsier le Monde",!
"RTN","BIXTCH",16,0)
 ; U "|TCP|4" R X:1
"RTN","BIXTCH",17,0)
 ; C "|TCP|4"
"RTN","BIXTCH",18,0)
 ; U 0 W !,X
"RTN","BIXTCH",19,0)
 N POP,X
"RTN","BIXTCH",20,0)
 D CALL^%ZISTCP("127.0.0.1",6708,10)
"RTN","BIXTCH",21,0)
 I $G(POP) W "I failed!!!" QUIT
"RTN","BIXTCH",22,0)
 USE IO
"RTN","BIXTCH",23,0)
 W "Bonjour, Monsier le Monde",$C(13,10),!
"RTN","BIXTCH",24,0)
 R X:1
"RTN","BIXTCH",25,0)
 D CLOSE^%ZISTCP
"RTN","BIXTCH",26,0)
 W !,X
"RTN","BIXTCH",27,0)
 QUIT
"RTN","BIXTCH",28,0)
 ; END CHANGES: VEN/SMH
"RTN","BIXTCH",29,0)
 ;
"RTN","BIXTCH",30,0)
 ;
"RTN","BIXTCH",31,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIXTCH",32,0)
 ;---> Add DUZ2 so that BIXTCH can retrieve IP address for TCH.
"RTN","BIXTCH",33,0)
 ;----------
"RTN","BIXTCH",34,0)
RUN(BIHX,BIDUZ2,BIRPT,BIDATA,BIERR) ;EP
"RTN","BIXTCH",35,0)
 ;---> Entry point for XCALL to Immserve Forecast Library.
"RTN","BIXTCH",36,0)
 ;---> Patient's Immunization History is supplied; ImmServe Forecast
"RTN","BIXTCH",37,0)
 ;---> is returned as text profile (BIRPT) and as data string (BIDATA).
"RTN","BIXTCH",38,0)
 ;---> Parameters:
"RTN","BIXTCH",39,0)
 ;     1 - BIHX   (req) String containing Patient's Immunization History.
"RTN","BIXTCH",40,0)
 ;     2 - BIDUZ2 (req) User's DUZ(2) to indicate IP address for TCH.
"RTN","BIXTCH",41,0)
 ;     3 - BIRPT  (ret) String returning text version of forcast.
"RTN","BIXTCH",42,0)
 ;     4 - BIDATA (ret) String returning data version of forcast.
"RTN","BIXTCH",43,0)
 ;     5 - BIERR  (ret) String returning text of error code.
"RTN","BIXTCH",44,0)
 ;
"RTN","BIXTCH",45,0)
 ;---> Quit if Patient IMM Hx not provided.
"RTN","BIXTCH",46,0)
 I $G(BIHX)="" S (BIRPT,BIDATA,BIERR)=$$ERROR(999) Q
"RTN","BIXTCH",47,0)
 ;
"RTN","BIXTCH",48,0)
 ;---> Uncomment to see Patient History sent to TCH Forecaster.
"RTN","BIXTCH",49,0)
 ; W !,"Full Input String: ",BIHX R ZZZ
"RTN","BIXTCH",50,0)
 ;
"RTN","BIXTCH",51,0)
 S BIERR="",BIRPT="",BIDATA=""
"RTN","BIXTCH",52,0)
 S BIHX=BIHX_$C(10)
"RTN","BIXTCH",53,0)
 N BIRESULT
"RTN","BIXTCH",54,0)
 ;
"RTN","BIXTCH",55,0)
 N $ET S $ET="GOTO ERRTRAP^BIXTCH"
"RTN","BIXTCH",56,0)
 ;
"RTN","BIXTCH",57,0)
 ;---> Preserve the current Device to return to after using TCP.
"RTN","BIXTCH",58,0)
 N BIDEVICE S BIDEVICE=$IO
"RTN","BIXTCH",59,0)
 ;
"RTN","BIXTCH",60,0)
 ;---> Open TCP in Streaming Mode (to accommodate greater data length.).
"RTN","BIXTCH",61,0)
 ;
"RTN","BIXTCH",62,0)
 ;---> Get IP address for TCH Forecaster.
"RTN","BIXTCH",63,0)
 I '$G(BIDUZ2) S (BIRPT,BIDATA,BIERR)=$$ERROR(124) Q
"RTN","BIXTCH",64,0)
 N BIIP S BIIP=$$IPTCH^BIUTL8(BIDUZ2)
"RTN","BIXTCH",65,0)
 I BIIP="" S (BIRPT,BIDATA,BIERR)=$$ERROR(125) Q
"RTN","BIXTCH",66,0)
 ;
"RTN","BIXTCH",67,0)
 ; VEN/SMH - REPLACE NON-PORTABLE CODE WITH PORTABLE CODE
"RTN","BIXTCH",68,0)
 ;O "|TCP|4":("127.0.0.1":6708:"S":):3 ;## demo code!!!
"RTN","BIXTCH",69,0)
 ;O "|TCP|4":(BIIP:6708:"S":):3
"RTN","BIXTCH",70,0)
 ;**********
"RTN","BIXTCH",71,0)
 ;
"RTN","BIXTCH",72,0)
 ;U "|TCP|4"
"RTN","BIXTCH",73,0)
 ;W BIHX,!
"RTN","BIXTCH",74,0)
 ;U "|TCP|4" R BIRESULT:1
"RTN","BIXTCH",75,0)
 ;C "|TCP|4"
"RTN","BIXTCH",76,0)
 ;
"RTN","BIXTCH",77,0)
 ; NB: From the Cache documentation regarding "S". In stream mode, Cach? does
"RTN","BIXTCH",78,0)
 ; not attempt to preserve TCP message boundaries in the data stream. On
"RTN","BIXTCH",79,0)
 ; sending, if the data does not fit in the message buffer, Cach? flushes the
"RTN","BIXTCH",80,0)
 ; buffer before placing the data in it.
"RTN","BIXTCH",81,0)
 ;
"RTN","BIXTCH",82,0)
 ; In of CONT^%ZISTCP, "S" mode is set with send/rec buffers of 512 bytes
"RTN","BIXTCH",83,0)
 ;
"RTN","BIXTCH",84,0)
 ; ZEXCEPT: BISIMERRTRAP - from the Unit Tester
"RTN","BIXTCH",85,0)
 N POP
"RTN","BIXTCH",86,0)
 D CALL^%ZISTCP(BIIP,6708,3)
"RTN","BIXTCH",87,0)
 I $G(POP) S $EC=",U-TCH-TCP-CXN-FAIL,"  ; Invoke the error trap
"RTN","BIXTCH",88,0)
 I $D(BISIMERRTRAP) S $EC=",U-SIMULATED-ERROR," ; for our unit tests
"RTN","BIXTCH",89,0)
 U IO ; Use TCP device
"RTN","BIXTCH",90,0)
 W BIHX,$C(13,10),! ; TCH Listener seems to use CR/LF as a delimiter.
"RTN","BIXTCH",91,0)
 R BIRESULT:1
"RTN","BIXTCH",92,0)
 D CLOSE^%ZISTCP
"RTN","BIXTCH",93,0)
 ;---> Return to using previous Device.
"RTN","BIXTCH",94,0)
 U BIDEVICE
"RTN","BIXTCH",95,0)
 ;
"RTN","BIXTCH",96,0)
 ;---> For Testing, uncomment next line to see the raw data returned from TCH:
"RTN","BIXTCH",97,0)
 ; W !,$L(BIRESULT) R ZZZ
"RTN","BIXTCH",98,0)
 ; W !!!,"Result directly back from forecaster (in BIXTCH): ",!,BIRESULT,!! R ZZZ
"RTN","BIXTCH",99,0)
 ;
"RTN","BIXTCH",100,0)
 S BIERR=$P(BIRESULT,"&&&",1)
"RTN","BIXTCH",101,0)
 I BIERR]"" S (BIRPT,BIDATA,BIERR)=BIERR Q
"RTN","BIXTCH",102,0)
 ;I BIERR]"" S (BIRPT,BIDATA,BIERR)=$$ERROR^BIXTCH(BIERR) Q
"RTN","BIXTCH",103,0)
 S BIDATA=$P(BIRESULT,"&&&",2)
"RTN","BIXTCH",104,0)
 S BIRPT=$P(BIRESULT,"&&&",3)
"RTN","BIXTCH",105,0)
 S:BIERR=0 BIERR=""
"RTN","BIXTCH",106,0)
 ;
"RTN","BIXTCH",107,0)
 Q
"RTN","BIXTCH",108,0)
 ;
"RTN","BIXTCH",109,0)
 ;
"RTN","BIXTCH",110,0)
 ;----------
"RTN","BIXTCH",111,0)
ERROR(BIERRNUM) ;EP
"RTN","BIXTCH",112,0)
 ;---> Return text of error, based on number passed.
"RTN","BIXTCH",113,0)
 ;---> Parameters:
"RTN","BIXTCH",114,0)
 ;     1 - BIERRNUM (req) Numeric value of error.
"RTN","BIXTCH",115,0)
 ;
"RTN","BIXTCH",116,0)
 Q "BIXTCH Error: "_$$ERRMSG(BIERRNUM)
"RTN","BIXTCH",117,0)
 ;
"RTN","BIXTCH",118,0)
 ;
"RTN","BIXTCH",119,0)
 ;----------
"RTN","BIXTCH",120,0)
ERRMSG(X) ;EP
"RTN","BIXTCH",121,0)
 ;---> Error messages.
"RTN","BIXTCH",122,0)
 Q:X=1 "1;Some cases could not be processed."
"RTN","BIXTCH",123,0)
 Q "99999;Unknown error"
"RTN","BIXTCH",124,0)
 ;
"RTN","BIXTCH",125,0)
 ;
"RTN","BIXTCH",126,0)
 ;----------
"RTN","BIXTCH",127,0)
ERRTRAP ;EP
"RTN","BIXTCH",128,0)
 ; ZEXCEPT: BIERR from above
"RTN","BIXTCH",129,0)
 ; Emergency Trap: (Replace newed trap; don't create another one)
"RTN","BIXTCH",130,0)
 S $ET="D ^%ZTER HALT"
"RTN","BIXTCH",131,0)
 ;
"RTN","BIXTCH",132,0)
 D ERRCD^BIUTL2(123,.BIERR)
"RTN","BIXTCH",133,0)
 D CLOSE^%ZISTCP ; close just in case the error happened when are still comm
"RTN","BIXTCH",134,0)
 ;
"RTN","BIXTCH",135,0)
 S $EC=""  ; clear error
"RTN","BIXTCH",136,0)
 ; no need in this code to unwind the stack since there is only a single stack
"RTN","BIXTCH",137,0)
 ; level
"RTN","BIXTCH",138,0)
 QUIT
"RTN","BIXTCH",139,0)
 ;
"RTN","BIXTCH",140,0)
 ;----------
"RTN","BIXTCH",141,0)
 ;
"RTN","BIXTCH",142,0)
 ;
"RTN","BIXTCH",143,0)
TEST D EN^%ut($T(+0),1) QUIT  ; ---> vide https://github.com/joelivey/M-Unit
"RTN","BIXTCH",144,0)
 ;
"RTN","BIXTCH",145,0)
 ; Expected Results:
"RTN","BIXTCH",146,0)
 ; FOIA 2015-02>D TEST^BIXTCH
"RTN","BIXTCH",147,0)
 ;
"RTN","BIXTCH",148,0)
 ; T1 - Run the sample data in the TCH Technical Manual.------------------  [OK]
"RTN","BIXTCH",149,0)
 ; T2 - Force an error to test the M error trap.--------------------------  [OK]
"RTN","BIXTCH",150,0)
 ;
"RTN","BIXTCH",151,0)
 ;
"RTN","BIXTCH",152,0)
T1 ; @TEST Run the sample data in the TCH Technical Manual
"RTN","BIXTCH",153,0)
 ; ---> vide http://www.ihs.gov/RPMS/PackageDocs/BI/TCH%20Forecaster%20Installation%20Instructions.pdf
"RTN","BIXTCH",154,0)
 N RPT,DATA,ERR
"RTN","BIXTCH",155,0)
 N S S S="20140424^0^0^0^0^TEST,PAIIENT  Chart#: 00-00-31^31^19830215^Male^U^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^~~~3484^03^20140414^0^0^0|||"
"RTN","BIXTCH",156,0)
 D RUN(S,DUZ(2),.RPT,.DATA,.ERR)
"RTN","BIXTCH",157,0)
 D CHKTF^%ut($L($G(RPT)),"No data was obtained")
"RTN","BIXTCH",158,0)
 QUIT
"RTN","BIXTCH",159,0)
 ;
"RTN","BIXTCH",160,0)
T2 ; @TEST Force an error to test the M error trap
"RTN","BIXTCH",161,0)
 N BISIMERRTRAP S BISIMERRTRAP=1
"RTN","BIXTCH",162,0)
 N RPT,DATA,ERR
"RTN","BIXTCH",163,0)
 N S S S="20140424^0^0^0^0^TEST,PATIENT  Chart#: 00-00-31^31^19830215^Male^U^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^~~~3484^03^20140414^0^0^0|||"
"RTN","BIXTCH",164,0)
 D RUN(S,DUZ(2),.RPT,.DATA,.ERR)
"RTN","BIXTCH",165,0)
 D CHKTF^%ut($L($G(ERR)),"An error was expected")
"RTN","BIXTCH",166,0)
 QUIT
"RTN","BIXTCH",167,0)
 ;
"RTN","BIXTCH",168,0)
T3 ; [Private; Standalone] Regular test of error trap. See what happens to us
"RTN","BIXTCH",169,0)
 ; ---> This entry point is just for the developer's use. Really!!!
"RTN","BIXTCH",170,0)
 ; ---> We are checking that we exit at the right stack level. In this case,
"RTN","BIXTCH",171,0)
 ; ---> we need to just see that the error message is printed on the screen.
"RTN","BIXTCH",172,0)
 ; ---> This way we know that we just poped the stack correctly. If we didn't
"RTN","BIXTCH",173,0)
 ; ---> the stack will keep poping and we won't see the ERR message
"RTN","BIXTCH",174,0)
 D
"RTN","BIXTCH",175,0)
 . N BISIMERRTRAP S BISIMERRTRAP=1
"RTN","BIXTCH",176,0)
 . N RPT,DATA,ERR
"RTN","BIXTCH",177,0)
 . N S S S="20140424^0^0^0^0^TEST,PATIENT  Chart#: 00-00-31^31^19830215^Male^U^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^~~~3484^03^20140414^0^0^0|||"
"RTN","BIXTCH",178,0)
 . D RUN(S,DUZ(2),.RPT,.DATA,.ERR)
"RTN","BIXTCH",179,0)
 . W ERR,!
"RTN","BIXTCH",180,0)
 QUIT
"RTN","PXVBIVD")
0^181^B2463834
"RTN","PXVBIVD",1,0)
PXVBIVD ;VEN/SMH - Elements to disable from IHS port;05/08/2015
"RTN","PXVBIVD",2,0)
 ;;1.0;VISTA IMMUNIZATIONS;;;Build 2
"RTN","PXVBIVD",3,0)
 ;
"RTN","PXVBIVD",4,0)
 ; ---> Don't Run on RPMS!!!
"RTN","PXVBIVD",5,0)
 QUIT:$$RPMS^BIUTL9()
"RTN","PXVBIVD",6,0)
 ;
"RTN","PXVBIVD",7,0)
POSTVIST ; [Public] KIDS POST Install
"RTN","PXVBIVD",8,0)
 ; ---> Options in the Site Manager menu BI MENU-MANAGER
"RTN","PXVBIVD",9,0)
 D OUT^XPDMENU("BI NDC ADD/EDIT","Not used in VISTA")    ; NDC Code Add/Edit
"RTN","PXVBIVD",10,0)
 D OUT^XPDMENU("BI VACCINE TABLE RESTAND","Not used in VISTA") ; Restandardize Vaccine Table
"RTN","PXVBIVD",11,0)
 D OUT^XPDMENU("BI VACCINE TABLE EDIT","Not used in VISTA") ; Vaccine Table Edit
"RTN","PXVBIVD",12,0)
 D OUT^XPDMENU("BI EXPORT VACCINE TABLE","Won't port. Not imporant") ; Export Vaccine Table to Excel File
"RTN","PXVBIVD",13,0)
 ;
"RTN","PXVBIVD",14,0)
 N % S %=$$DELETE^XPDMENU("BI MENU-MANAGER","BI NDC ADD/EDIT")
"RTN","PXVBIVD",15,0)
 N % S %=$$DELETE^XPDMENU("BI MENU-MANAGER","BI VACCINE TABLE RESTAND")
"RTN","PXVBIVD",16,0)
 N % S %=$$DELETE^XPDMENU("BI MENU-MANAGER","BI VACCINE TABLE EDIT")
"RTN","PXVBIVD",17,0)
 N % S %=$$DELETE^XPDMENU("BI MENU-MANAGER","BI EXPORT VACCINE TABLE")
"RTN","PXVBIVD",18,0)
 QUIT
"RTN","PXVVISIT")
0^180^B55427535
"RTN","PXVVISIT",1,0)
PXVVISIT ;VEN/SMH - Main VISTA Immunizations Visit Filer;7/2/2015
"RTN","PXVVISIT",2,0)
 ;;0.0;IMMUNIZATIONS VISTA PORT;;;Build 2
"RTN","PXVVISIT",3,0)
 ;
"RTN","PXVVISIT",4,0)
 ; This file contains the main code for interacting with the VISTA
"RTN","PXVVISIT",5,0)
 ; V files from the Ported RPMS Immunizations package
"RTN","PXVVISIT",6,0)
 ;
"RTN","PXVVISIT",7,0)
 ; The callers are BIVISIT and BIVISIT1
"RTN","PXVVISIT",8,0)
 ;
"RTN","PXVVISIT",9,0)
 ; The code here mirrors the RPMS code
"RTN","PXVVISIT",10,0)
 ;
"RTN","PXVVISIT",11,0)
CREATE(BIVSIT,BIERR,BINOM) ; [Private]. Mirror copy of CREATE^BIVISIT1. Called from there.
"RTN","PXVVISIT",12,0)
 ;---> Create a new Visit OR match on an existing Visit in VISIT File.
"RTN","PXVVISIT",13,0)
 ;---> Parameters:
"RTN","PXVVISIT",14,0)
 ;     1 - BIVSIT (ret) IEN of newly created Parent Visit.
"RTN","PXVVISIT",15,0)
 ;     2 - BIERR  (ret) 1^Text of Error Code if any, otherwise null.
"RTN","PXVVISIT",16,0)
 ;     3 - BINOM  (opt) 0=Allow display of Visit Selection Menu if site
"RTN","PXVVISIT",17,0)
 ;                      parameter is set. 1=No display (for export).
"RTN","PXVVISIT",18,0)
 ;
"RTN","PXVVISIT",19,0)
 ; ZEXCEPT: BICAT,BIDATE,BIDFN,BILOC,BIOLOC,BISITE
"RTN","PXVVISIT",20,0)
 ; All defined by the Imm package
"RTN","PXVVISIT",21,0)
 ;
"RTN","PXVVISIT",22,0)
 ;---> Visit creating package namespace
"RTN","PXVVISIT",23,0)
 N VSITPKG S VSITPKG="BIV" ; "IMMUNIZATIONS VISTA PORT"
"RTN","PXVVISIT",24,0)
 ;
"RTN","PXVVISIT",25,0)
 ;---> Make sure that the Imm package is allowed to create visits
"RTN","PXVVISIT",26,0)
 I $$PKGON^VSIT("BIV")=-1 N % S %=$$PKG^VSIT("BIV",1)
"RTN","PXVVISIT",27,0)
 ;
"RTN","PXVVISIT",28,0)
 ;---> Make sure we have a hospital location to use for Standalone Immunizations
"RTN","PXVVISIT",29,0)
 ;TODO: MAKE SURE THAT WHEN WE USE CPRS, WE HAVE AN ACTUAL HOSPITAL LOCATION
"RTN","PXVVISIT",30,0)
 ;
"RTN","PXVVISIT",31,0)
 ;
"RTN","PXVVISIT",32,0)
 ;---> Patient.
"RTN","PXVVISIT",33,0)
 ; ZEXCEPT: DFN
"RTN","PXVVISIT",34,0)
 S DFN=BIDFN
"RTN","PXVVISIT",35,0)
 ;
"RTN","PXVVISIT",36,0)
 ;---> PCC Date/Time; If no time, 12 noon will be attached.
"RTN","PXVVISIT",37,0)
 N VSIT
"RTN","PXVVISIT",38,0)
 S VSIT=BIDATE
"RTN","PXVVISIT",39,0)
 S VSIT(0)="EN"  ; Controller of how a visit is added on VISTA.
"RTN","PXVVISIT",40,0)
 ;                 N means okay to add a visit.
"RTN","PXVVISIT",41,0)
 ;                 E means use patient 1ry eligibility
"RTN","PXVVISIT",42,0)
 ;
"RTN","PXVVISIT",43,0)
 ;---> If Visit Selection Menu is Disabled, create/link automatically:
"RTN","PXVVISIT",44,0)
 ;---> Linking/Adding PCC Visits:
"RTN","PXVVISIT",45,0)
 ;--->    1) If no Visit exists on this date, create one silently.
"RTN","PXVVISIT",46,0)
 ;--->    2) If a Visit exists with exact time match, append to it.
"RTN","PXVVISIT",47,0)
 ;--->    3) If a Visit exists for this date but a different time,
"RTN","PXVVISIT",48,0)
 ;--->          add a new Visit.
"RTN","PXVVISIT",49,0)
 ;
"RTN","PXVVISIT",50,0)
 ;---> If site param says do NOT display Visit Selection Menu, then
"RTN","PXVVISIT",51,0)
 ;---> link or create automatically.
"RTN","PXVVISIT",52,0)
 ;---> Ditto for BINOM
"RTN","PXVVISIT",53,0)
 D
"RTN","PXVVISIT",54,0)
 . I '$$VISMNU^BIUTL2(BISITE) QUIT  ; No
"RTN","PXVVISIT",55,0)
 . I $G(BINOM) QUIT  ; No
"RTN","PXVVISIT",56,0)
 . S VSIT(0)=VSIT(0)_"I" ; interactive
"RTN","PXVVISIT",57,0)
 ;
"RTN","PXVVISIT",58,0)
 ; ZEXCEPT: PXVNOM Used internally for testing forcing interactiveness
"RTN","PXVVISIT",59,0)
 I $G(PXVNOM),VSIT(0)'["I" S VSIT(0)=VSIT(0)_"I"
"RTN","PXVVISIT",60,0)
 ;
"RTN","PXVVISIT",61,0)
 ;---> Institution (BILOC is really IHS Location, which is DINUMMED to file 4).
"RTN","PXVVISIT",62,0)
 S VSIT("INS")=$G(BILOC)
"RTN","PXVVISIT",63,0)
 ;
"RTN","PXVVISIT",64,0)
 ;---> Hospital Location
"RTN","PXVVISIT",65,0)
 ;XXX TODO XXX: This is hardcoded.
"RTN","PXVVISIT",66,0)
 I BICAT'="E" S VSIT("LOC")=2
"RTN","PXVVISIT",67,0)
 ;
"RTN","PXVVISIT",68,0)
 ;---> Other Location (Text if Location="OTHER").
"RTN","PXVVISIT",69,0)
 S VSIT("OUT")=$G(BIOLOC)
"RTN","PXVVISIT",70,0)
 ;
"RTN","PXVVISIT",71,0)
 ;---> Set Type of Visit from VISIT TRACK PARAMETERS file (VISTA copy of RPMS
"RTN","PXVVISIT",72,0)
 ;     PCC MASTER CONTROL FILE).
"RTN","PXVVISIT",73,0)
 S VSIT("TYP")=$$GET1^DIQ(150.9,1,.03,"I")
"RTN","PXVVISIT",74,0)
 I VSIT("TYP")="" S VSIT("TYP")="V"
"RTN","PXVVISIT",75,0)
 ;
"RTN","PXVVISIT",76,0)
 ;---> Category.  A=Ambulatory, I=Inpatient, E=Event/Historical.
"RTN","PXVVISIT",77,0)
 ;---> If User said this was an Ambulatory Visit, and if the Inpatient Visit
"RTN","PXVVISIT",78,0)
 ;---> Check Site Parameter is enabled, check to see if patient was an
"RTN","PXVVISIT",79,0)
 ;---> Inpatient on BIDATE; if so, change Category to "I",Inpatient.
"RTN","PXVVISIT",80,0)
 ;
"RTN","PXVVISIT",81,0)
 I BICAT="A",$$INPTCHK^BIUTL2(BISITE),$$INPT^BIUTL11(BIDFN,BIDATE) S BICAT="I"
"RTN","PXVVISIT",82,0)
 S VSIT("SVC")=BICAT
"RTN","PXVVISIT",83,0)
 ;
"RTN","PXVVISIT",84,0)
 ;*** DON'T THINK THIS APPLIES TO VISTA
"RTN","PXVVISIT",85,0)
 ;---> Call to add (create) Visit.
"RTN","PXVVISIT",86,0)
 ;---> NOTE: $G(BICAT)="E" (Historical) will override Active/Inactive
"RTN","PXVVISIT",87,0)
 ;---> selection screen on .01 Field of Immunization File #9999999.14.
"RTN","PXVVISIT",88,0)
 ;*** DON'T THINK THIS APPLIES TO VISTA
"RTN","PXVVISIT",89,0)
 ;
"RTN","PXVVISIT",90,0)
 D ^VSIT
"RTN","PXVVISIT",91,0)
 ;
"RTN","PXVVISIT",92,0)
 ; VSIT("IEN") = -1 -> can't make visit
"RTN","PXVVISIT",93,0)
 ; VSIT("IEN") = -2 -> package is inactive
"RTN","PXVVISIT",94,0)
 I +VSIT("IEN")<0 D ERRCD^BIUTL2(401,.BIERR) S BIERR="1^"_BIERR QUIT
"RTN","PXVVISIT",95,0)
 ;
"RTN","PXVVISIT",96,0)
 Q:$G(BIERR)
"RTN","PXVVISIT",97,0)
 ;
"RTN","PXVVISIT",98,0)
 S BIVSIT=+VSIT("IEN")
"RTN","PXVVISIT",99,0)
 ;
"RTN","PXVVISIT",100,0)
 QUIT
"RTN","PXVVISIT",101,0)
 ;
"RTN","PXVVISIT",102,0)
 ;
"RTN","PXVVISIT",103,0)
VFILE(BIVSIT,BIDATA,BIERR) ; [Private] File V data for VISTA. Called from VFILE^BIVISIT.
"RTN","PXVVISIT",104,0)
 ;---> Add (create) V IMMUNIZATION or V SKIN TEST entry for this Visit.
"RTN","PXVVISIT",105,0)
 ;---> Parameters:
"RTN","PXVVISIT",106,0)
 ;     1 - BIVSIT (req) IEN of Parent Visit.
"RTN","PXVVISIT",107,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","PXVVISIT",108,0)
 ;                      See BIDATA definition at linelabel PARSE.
"RTN","PXVVISIT",109,0)
 ;     3 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","PXVVISIT",110,0)
 ;
"RTN","PXVVISIT",111,0)
 ; *** VEN/SMH - THIS IS A FIRST DRAFT OF HOW THIS THING SHOULD WORK ***
"RTN","PXVVISIT",112,0)
 ; Some major differences between this and RPMS code in BIVISIT
"RTN","PXVVISIT",113,0)
 ; 1. There is not auto-contraindications filing. This happens when we document
"RTN","PXVVISIT",114,0)
 ;    the reaction to an immunization or to a PPD. I can't find where in the
"RTN","PXVVISIT",115,0)
 ;    software you enter a reaction at the same time as a an immunization; so
"RTN","PXVVISIT",116,0)
 ;    I am taking that out for auto-contraindications for Immunizations.
"RTN","PXVVISIT",117,0)
 ;    Adding a CI for a positive PPD is done in such an extremely sloppy way
"RTN","PXVVISIT",118,0)
 ;    in RPMS that I won't port this over. PPD is represented as an Immunization
"RTN","PXVVISIT",119,0)
 ;    not a skin test!
"RTN","PXVVISIT",120,0)
 ; 2. There is no representation currently of VFC eligibility for VISTA. This is
"RTN","PXVVISIT",121,0)
 ;    important and I would like to port that over. Thankfully, the field has
"RTN","PXVVISIT",122,0)
 ;    been brought over from RPMS in PX*1.0*201.
"RTN","PXVVISIT",123,0)
 ; 3. VISTA wants to store Lot, Manufacturer and Expiration Date; RPMS wants
"RTN","PXVVISIT",124,0)
 ;    to store Lot and NDC. Both are illogical since you really only need Lot.
"RTN","PXVVISIT",125,0)
 ;    Lot has information on the rest of the data.
"RTN","PXVVISIT",126,0)
 ; 4. The PXAPI code in VISTA wants you to file the data all at once via itself.
"RTN","PXVVISIT",127,0)
 ;    You are not given a handle back to the IEN of the V IMM or V SK to add
"RTN","PXVVISIT",128,0)
 ;    extra fields to the entry, which is what is done in BIVISIT.
"RTN","PXVVISIT",129,0)
 ; 5. RPMS does not require that you have a hospital location for an encounter.
"RTN","PXVVISIT",130,0)
 ;    VISTA seems to require it. I need to do some more research.
"RTN","PXVVISIT",131,0)
 ; 6. There are many todos for missing fields that I need to gradually bring
"RTN","PXVVISIT",132,0)
 ;    over:
"RTN","PXVVISIT",133,0)
 ;
"RTN","PXVVISIT",134,0)
 ; TODOs:
"RTN","PXVVISIT",135,0)
 ; - Three skin test fields are missing from VISTA. These need to be brought
"RTN","PXVVISIT",136,0)
 ;   over:
"RTN","PXVVISIT",137,0)
 ;   -> .08: Skin Test Reader
"RTN","PXVVISIT",138,0)
 ;   -> .09: Skin Test Site
"RTN","PXVVISIT",139,0)
 ;   -> .11: Volume
"RTN","PXVVISIT",140,0)
 ; - The VIS fields for VISTA don't have a way to file them right now. I may
"RTN","PXVVISIT",141,0)
 ;   have to change the PXA* routines to do that. And there are two different
"RTN","PXVVISIT",142,0)
 ;   VIS fields: Which VIS is it (Imm and Date) and when it was given to the
"RTN","PXVVISIT",143,0)
 ;   patient
"RTN","PXVVISIT",144,0)
 ; - Dose Overide field? I don't know whether I need that. I think it has to do
"RTN","PXVVISIT",145,0)
 ;   with overriding the forecaster, but I haven't seen where that is used.
"RTN","PXVVISIT",146,0)
 ; - Injection Site and Volume are stored in different places in VISTA. The
"RTN","PXVVISIT",147,0)
 ;   Form needs to be changed to point them. The VISTA stuff is brand new files.
"RTN","PXVVISIT",148,0)
 ; - RPMS has a field to say "this CPT created me". It something to look into,
"RTN","PXVVISIT",149,0)
 ;   but I don't think I will actually get to supporting it.
"RTN","PXVVISIT",150,0)
 ; - RPMS has a field in V IMM to say whether an Immunization was imported. I
"RTN","PXVVISIT",151,0)
 ;   think a useful thing to have.
"RTN","PXVVISIT",152,0)
 ; - Some random extra fields for RPMS:
"RTN","PXVVISIT",153,0)
 ;   -> Admin Note
"RTN","PXVVISIT",154,0)
 ;   -> Admin Date (seperate from Visit Date. Reason: In RPMS, they have V
"RTN","PXVVISIT",155,0)
 ;       INPATIENT, and an Inpatinent Visit can span many days; so a workaround
"RTN","PXVVISIT",156,0)
 ;       to say when something really took place is a seperate field for Admin
"RTN","PXVVISIT",157,0)
 ;       Date)
"RTN","PXVVISIT",158,0)
 ;
"RTN","PXVVISIT",159,0)
 ; - Edits for Immunizations doesn't work b/c of missing VFC field
"RTN","PXVVISIT",160,0)
 ; - Edits for Skin tests happened to delete my previous entry. Need to track down.
"RTN","PXVVISIT",161,0)
 ;
"RTN","PXVVISIT",162,0)
 I BIDATA="" D ERRCD^BIUTL2(437,.BIERR) S BIERR="1^"_BIERR Q
"RTN","PXVVISIT",163,0)
 ;
"RTN","PXVVISIT",164,0)
 N BIVTYPE,BIDFN,BIPTR,BIDOSE,BILOT,BIDATE,BILOC,BIOLOC,BICAT
"RTN","PXVVISIT",165,0)
 N BIOIEN,BIRES,BIREA,BIDTR,BIREC,BIVISD,BIPROV,BIOVRD,BIINJS,BIVOL
"RTN","PXVVISIT",166,0)
 N BIREDR,BISITE,BICCPT,BIMPRT,BIANOT
"RTN","PXVVISIT",167,0)
 ;
"RTN","PXVVISIT",168,0)
 ;---> See BIDATA definition at linelabel PARSE (above).
"RTN","PXVVISIT",169,0)
 D PARSE^BIVISIT(BIDATA,1)
"RTN","PXVVISIT",170,0)
 ;
"RTN","PXVVISIT",171,0)
 ;---> Check that a Parent VISIT exists.
"RTN","PXVVISIT",172,0)
 I '$D(^AUPNVSIT(+$G(BIVSIT),0)) D  Q
"RTN","PXVVISIT",173,0)
 .D ERRCD^BIUTL2(432,.BIERR) S BIERR="1^"_BIERR
"RTN","PXVVISIT",174,0)
 ;
"RTN","PXVVISIT",175,0)
 ;
"RTN","PXVVISIT",176,0)
 N PXVIMM
"RTN","PXVVISIT",177,0)
 ;
"RTN","PXVVISIT",178,0)
 S PXVIMM("PROVIDER",1,"NAME")=DUZ
"RTN","PXVVISIT",179,0)
 S PXVIMM("PROVIDER",1,"PRIMARY")=1
"RTN","PXVVISIT",180,0)
 ;
"RTN","PXVVISIT",181,0)
 ; Notes regarding port.
"RTN","PXVVISIT",182,0)
 ; Dose # in RPMS is disabled. Rm here.
"RTN","PXVVISIT",183,0)
 ; Last modified user in not an explicit field to be set here like in RPMS
"RTN","PXVVISIT",184,0)
 ;
"RTN","PXVVISIT",185,0)
 ; VISTA DEPRECATED/MISSING FIELDS
"RTN","PXVVISIT",186,0)
 ; +-------------------------------------------------------------------+
"RTN","PXVVISIT",187,0)
 ; | RPMS                |  VISTA                                      |
"RTN","PXVVISIT",188,0)
 ; | ------------------- | ------------------------------------------- |
"RTN","PXVVISIT",189,0)
 ; | #.08 DOSE OVERRIDE  |  Not used                                   |
"RTN","PXVVISIT",190,0)
 ; | #.09 INJECTION SITE |  #1302 ROUTE OF ADMINISTRATION  &           |
"RTN","PXVVISIT",191,0)
 ; |                     |  #1303 SITE OF ADMINISTRATION               |
"RTN","PXVVISIT",192,0)
 ; | #.11 VOLUME         |  #1312 DOSAGE                               |
"RTN","PXVVISIT",193,0)
 ; | #.12 DATE OF VIS    |  #2 (Multiple) VIS OFFERED/GIVEN TO PATIENT |
"RTN","PXVVISIT",194,0)
 ; | #.13 CREATED BY V CPT ENTRY | Not used                            |
"RTN","PXVVISIT",195,0)
 ; | #.14 VAC ELIGIBILITY|  Not used                                   |
"RTN","PXVVISIT",196,0)
 ; | #.15 IMPORT FROM... |  Not used                                   |
"RTN","PXVVISIT",197,0)
 ; | #.16 NDC            |  Not used                                   |
"RTN","PXVVISIT",198,0)
 ; | #1 ADMIN NOTES      |  Not used                                   |
"RTN","PXVVISIT",199,0)
 ; | #1201 EVENT DT/TM   |  Not used (says exact time of V Imm)        |
"RTN","PXVVISIT",200,0)
 ; | #.17 DATE VIS PRES  |  #2 (see above)                             |
"RTN","PXVVISIT",201,0)
 ; + ------------------- | ------------------------------------------- |
"RTN","PXVVISIT",202,0)
 ;
"RTN","PXVVISIT",203,0)
 I BIVTYPE="I" D
"RTN","PXVVISIT",204,0)
 . S PXVIMM("IMMUNIZATION",1,"IMMUN")=BIPTR              ; Immunization/vaccine name.
"RTN","PXVVISIT",205,0)
 . S PXVIMM("IMMUNIZATION",1,"LOT")=$G(BILOT)            ; Lot Number
"RTN","PXVVISIT",206,0)
 . S PXVIMM("IMMUNIZATION",1,"REACTION")=$G(BIREC)       ; Reaction XXX INVESTIGATE XXX
"RTN","PXVVISIT",207,0)
 . S PXVIMM("IMMUNIZATION",1,"ENC PROVIDER")=BIPROV      ; Shot provider
"RTN","PXVVISIT",208,0)
 . S PXVIMM("IMMUNIZATION",1,"DOSAGE")=BIVOL             ; Dosage (e.g. 0.5 mL) XXX Check Data
"RTN","PXVVISIT",209,0)
 . S PXVIMM("IMMUNIZATION",1,"ADMIN ROUTE")=BIINJS       ; Injection Site XXX Change Field
"RTN","PXVVISIT",210,0)
 . S PXVIMM("IMMUNIZATION",1,"ANATOMIC LOCATION")=BIINJS ; Injection Site XXX Change Form Field
"RTN","PXVVISIT",211,0)
 ;
"RTN","PXVVISIT",212,0)
 ; NB: RPMS has these extra fields, which are not in VISTA:
"RTN","PXVVISIT",213,0)
 ; .08: Skin Test Reader
"RTN","PXVVISIT",214,0)
 ; .09: Skin Test Site
"RTN","PXVVISIT",215,0)
 ; .11: Volume
"RTN","PXVVISIT",216,0)
 I BIVTYPE="S" D
"RTN","PXVVISIT",217,0)
 . S PXVIMM("SKIN TEST",1,"TEST")=BIPTR                  ; Skin Test
"RTN","PXVVISIT",218,0)
 . S PXVIMM("SKIN TEST",1,"RESULT")=BIRES                ; Result
"RTN","PXVVISIT",219,0)
 . S PXVIMM("SKIN TEST",1,"READING")=BIREA               ; Reading
"RTN","PXVVISIT",220,0)
 . S PXVIMM("SKIN TEST",1,"D/T READ")=BIDTR              ; Date Read
"RTN","PXVVISIT",221,0)
 . S PXVIMM("SKIN TEST",1,"ENC PROVIDER")=BIPROV         ; Skin test provider
"RTN","PXVVISIT",222,0)
 ;
"RTN","PXVVISIT",223,0)
 ; $$DATA2PCE^PXAPI(INPUTROOT,PKG,SOURCE,.VISIT,USER,ERRDISP,.ERRARRAY,PPEDIT,.ERRPROB, .ACCOUNT)
"RTN","PXVVISIT",224,0)
 N % S %=$$DATA2PCE^PXAPI($NAME(PXVIMM),"BIV","IMMUNIZATION PACKAGE",.BIVSIT,BIPROV,1)
"RTN","PXVVISIT",225,0)
 ;
"RTN","PXVVISIT",226,0)
 I %'=1 D  QUIT
"RTN","PXVVISIT",227,0)
 .I BIVTYPE="I" D ERRCD^BIUTL2(402,.BIERR) S BIERR="1^"_BIERR Q
"RTN","PXVVISIT",228,0)
 .I BIVTYPE="S" D ERRCD^BIUTL2(413,.BIERR) S BIERR="1^"_BIERR Q
"RTN","PXVVISIT",229,0)
 ;
"RTN","PXVVISIT",230,0)
 ;---> Save IEN of V IMMUNIZATION just created.
"RTN","PXVVISIT",231,0)
 ;XXX find how to get that for VISTA
"RTN","PXVVISIT",232,0)
 ;
"RTN","PXVVISIT",233,0)
 ;
"RTN","PXVVISIT",234,0)
 ;---> ADD OTHER V IMMUNIZATION FIELDS:
"RTN","PXVVISIT",235,0)
 ;---> Quit if this is not an Immunization.
"RTN","PXVVISIT",236,0)
 Q:BIVTYPE'="I"
"RTN","PXVVISIT",237,0)
 ;
"RTN","PXVVISIT",238,0)
 ; XXX VIS DATA MUST BE ENTERED INTO VISTA VIA FILEMAN! .12 and .17
"RTN","PXVVISIT",239,0)
 ;
"RTN","PXVVISIT",240,0)
 ;---> Now trigger New Immunization Trigger Event.
"RTN","PXVVISIT",241,0)
 D TRIGADD^BIVISIT2
"RTN","PXVVISIT",242,0)
 QUIT
"RTN","PXVVISIT",243,0)
 ;
"RTN","PXVVISIT",244,0)
 ;----------
"RTN","PXVVISIT",245,0)
TEST D EN^%ut($T(+0),1,1) QUIT
"RTN","PXVVISIT",246,0)
 ;
"RTN","PXVVISIT",247,0)
TCRREG ; @TEST Test Create Regular
"RTN","PXVVISIT",248,0)
 ; BICAT,BIDATE,BIDFN,BILOC,BIOLOC,BISITE
"RTN","PXVVISIT",249,0)
 N BISITE S BISITE=$O(^BISITE(0))
"RTN","PXVVISIT",250,0)
 N BIDFN S BIDFN=1
"RTN","PXVVISIT",251,0)
 N BIDATE S BIDATE=$$FMADD^XLFDT(DT,-$R(9999))
"RTN","PXVVISIT",252,0)
 N BILOC S BILOC=$P($$SITE^VASITE(),U,3)
"RTN","PXVVISIT",253,0)
 N BICAT S BICAT="E"
"RTN","PXVVISIT",254,0)
 N BIVST,BIERR
"RTN","PXVVISIT",255,0)
 ; S PXVNOM=1
"RTN","PXVVISIT",256,0)
 D CREATE(.BIVST,.BIERR)
"RTN","PXVVISIT",257,0)
 D ASSERT(BIVST>0,"Visit should be created.")
"RTN","PXVVISIT",258,0)
 D ASSERT('$D(BIERR),"No error expected")
"RTN","PXVVISIT",259,0)
 QUIT
"RTN","PXVVISIT",260,0)
 ;
"RTN","PXVVISIT",261,0)
TCRHX ; @TEST Test Create Historical
"RTN","PXVVISIT",262,0)
 ; BICAT,BIDATE,BIDFN,BILOC,BIOLOC,BISITE
"RTN","PXVVISIT",263,0)
 N BISITE S BISITE=$O(^BISITE(0))
"RTN","PXVVISIT",264,0)
 N BIDFN S BIDFN=1
"RTN","PXVVISIT",265,0)
 N BIDATE S BIDATE=$$FMADD^XLFDT(DT,-$R(9999))
"RTN","PXVVISIT",266,0)
 ;N BILOC S BILOC=$P($$SITE^VASITE(),U,3)
"RTN","PXVVISIT",267,0)
 N BIOLOC S BIOLOC="TEST OTHER LOCATION"
"RTN","PXVVISIT",268,0)
 N BICAT S BICAT="E"
"RTN","PXVVISIT",269,0)
 N BIVST,BIERR
"RTN","PXVVISIT",270,0)
 ; S PXVNOM=1
"RTN","PXVVISIT",271,0)
 D CREATE(.BIVST,.BIERR)
"RTN","PXVVISIT",272,0)
 D ASSERT(BIVST>0,"Visit should be created.")
"RTN","PXVVISIT",273,0)
 D ASSERT('$D(BIERR),"No error expected")
"RTN","PXVVISIT",274,0)
 D ASSERT($P(^AUPNVSIT(BIVST,0),U,7)="E","An event is expected.")
"RTN","PXVVISIT",275,0)
 D ASSERT(^AUPNVSIT(BIVST,21)=BIOLOC,"Outside location didn't get recorded")
"RTN","PXVVISIT",276,0)
 QUIT
"RTN","PXVVISIT",277,0)
 ;
"RTN","PXVVISIT",278,0)
TCRDUP ; @TEST Make sure we don't duplicate a visit
"RTN","PXVVISIT",279,0)
 ; BICAT,BIDATE,BIDFN,BILOC,BIOLOC,BISITE
"RTN","PXVVISIT",280,0)
 N BISITE S BISITE=$O(^BISITE(0))
"RTN","PXVVISIT",281,0)
 N BIDFN S BIDFN=1
"RTN","PXVVISIT",282,0)
 N BIDATE S BIDATE=$$FMADD^XLFDT(DT,-$R(9999))
"RTN","PXVVISIT",283,0)
 N BILOC S BILOC=$P($$SITE^VASITE(),U,3)
"RTN","PXVVISIT",284,0)
 N BICAT S BICAT="A"
"RTN","PXVVISIT",285,0)
 N BIVST,BIERR
"RTN","PXVVISIT",286,0)
 ; S PXVNOM=1
"RTN","PXVVISIT",287,0)
 D CREATE(.BIVST,.BIERR)
"RTN","PXVVISIT",288,0)
 D ASSERT('$D(BIERR),"No error expected")
"RTN","PXVVISIT",289,0)
 D ASSERT(BIVST>0,"Visit should be created.")
"RTN","PXVVISIT",290,0)
 N OLDVISIT S OLDVISIT=BIVST
"RTN","PXVVISIT",291,0)
 K BIVST
"RTN","PXVVISIT",292,0)
 ; S PXVNOM=1
"RTN","PXVVISIT",293,0)
 D CREATE(.BIVST,.BIERR)
"RTN","PXVVISIT",294,0)
 D ASSERT(BIVST=OLDVISIT,"A visit shouldn't be duplicated")
"RTN","PXVVISIT",295,0)
 QUIT
"RTN","PXVVISIT",296,0)
 ;
"RTN","PXVVISIT",297,0)
ASSERT(X,MSG) ; Primitive assertion engine.
"RTN","PXVVISIT",298,0)
 ; ZEXCEPT: %ut
"RTN","PXVVISIT",299,0)
 I $D(%ut) D CHKTF^%ut(X,$G(MSG)) QUIT
"RTN","PXVVISIT",300,0)
 I 'X S $EC=",U-ASSERTION-FAILED,"
"RTN","PXVVISIT",301,0)
 QUIT
"SEC","^DIC",9002084,9002084,0,"AUDIT")
M
"SEC","^DIC",9002084,9002084,0,"DD")
@
"SEC","^DIC",9002084,9002084,0,"DEL")
M
"SEC","^DIC",9002084,9002084,0,"LAYGO")
M
"SEC","^DIC",9002084,9002084,0,"RD")
M
"SEC","^DIC",9002084,9002084,0,"WR")
M
"SEC","^DIC",9002084.01,9002084.01,0,"AUDIT")
M
"SEC","^DIC",9002084.01,9002084.01,0,"DD")
@
"SEC","^DIC",9002084.01,9002084.01,0,"DEL")
M
"SEC","^DIC",9002084.01,9002084.01,0,"LAYGO")
M
"SEC","^DIC",9002084.01,9002084.01,0,"RD")
M
"SEC","^DIC",9002084.01,9002084.01,0,"WR")
M
"SEC","^DIC",9002084.02,9002084.02,0,"AUDIT")
M
"SEC","^DIC",9002084.02,9002084.02,0,"DD")
@
"SEC","^DIC",9002084.02,9002084.02,0,"DEL")
M
"SEC","^DIC",9002084.02,9002084.02,0,"LAYGO")
M
"SEC","^DIC",9002084.02,9002084.02,0,"RD")
M
"SEC","^DIC",9002084.02,9002084.02,0,"WR")
M
"SEC","^DIC",9002084.1,9002084.1,0,"AUDIT")
M
"SEC","^DIC",9002084.1,9002084.1,0,"DD")
@
"SEC","^DIC",9002084.1,9002084.1,0,"DEL")
M
"SEC","^DIC",9002084.1,9002084.1,0,"LAYGO")
M
"SEC","^DIC",9002084.1,9002084.1,0,"RD")
M
"SEC","^DIC",9002084.1,9002084.1,0,"WR")
M
"SEC","^DIC",9002084.11,9002084.11,0,"AUDIT")
M
"SEC","^DIC",9002084.11,9002084.11,0,"DD")
@
"SEC","^DIC",9002084.11,9002084.11,0,"DEL")
M
"SEC","^DIC",9002084.11,9002084.11,0,"LAYGO")
M
"SEC","^DIC",9002084.11,9002084.11,0,"RD")
M
"SEC","^DIC",9002084.11,9002084.11,0,"WR")
M
"SEC","^DIC",9002084.115,9002084.115,0,"AUDIT")
@
"SEC","^DIC",9002084.115,9002084.115,0,"DD")
@
"SEC","^DIC",9002084.115,9002084.115,0,"DEL")
@
"SEC","^DIC",9002084.115,9002084.115,0,"LAYGO")
@
"SEC","^DIC",9002084.115,9002084.115,0,"RD")
@
"SEC","^DIC",9002084.115,9002084.115,0,"WR")
@
"SEC","^DIC",9002084.12,9002084.12,0,"AUDIT")
M
"SEC","^DIC",9002084.12,9002084.12,0,"DD")
@
"SEC","^DIC",9002084.12,9002084.12,0,"DEL")
M
"SEC","^DIC",9002084.12,9002084.12,0,"LAYGO")
M
"SEC","^DIC",9002084.12,9002084.12,0,"RD")
M
"SEC","^DIC",9002084.12,9002084.12,0,"WR")
M
"SEC","^DIC",9002084.33,9002084.33,0,"AUDIT")
M
"SEC","^DIC",9002084.33,9002084.33,0,"DD")
@
"SEC","^DIC",9002084.33,9002084.33,0,"DEL")
M
"SEC","^DIC",9002084.33,9002084.33,0,"LAYGO")
M
"SEC","^DIC",9002084.33,9002084.33,0,"RD")
M
"SEC","^DIC",9002084.33,9002084.33,0,"WR")
M
"SEC","^DIC",9002084.4,9002084.4,0,"AUDIT")
M
"SEC","^DIC",9002084.4,9002084.4,0,"DD")
@
"SEC","^DIC",9002084.4,9002084.4,0,"DEL")
M
"SEC","^DIC",9002084.4,9002084.4,0,"LAYGO")
M
"SEC","^DIC",9002084.4,9002084.4,0,"RD")
M
"SEC","^DIC",9002084.4,9002084.4,0,"WR")
M
"SEC","^DIC",9002084.45,9002084.45,0,"AUDIT")
M
"SEC","^DIC",9002084.45,9002084.45,0,"DD")
@
"SEC","^DIC",9002084.45,9002084.45,0,"DEL")
M
"SEC","^DIC",9002084.45,9002084.45,0,"LAYGO")
M
"SEC","^DIC",9002084.45,9002084.45,0,"RD")
M
"SEC","^DIC",9002084.45,9002084.45,0,"WR")
M
"SEC","^DIC",9002084.81,9002084.81,0,"AUDIT")
M
"SEC","^DIC",9002084.81,9002084.81,0,"DD")
@
"SEC","^DIC",9002084.81,9002084.81,0,"DEL")
M
"SEC","^DIC",9002084.81,9002084.81,0,"LAYGO")
M
"SEC","^DIC",9002084.81,9002084.81,0,"RD")
M
"SEC","^DIC",9002084.81,9002084.81,0,"WR")
M
"SEC","^DIC",9002084.91,9002084.91,0,"AUDIT")
M
"SEC","^DIC",9002084.91,9002084.91,0,"DD")
@
"SEC","^DIC",9002084.91,9002084.91,0,"DEL")
M
"SEC","^DIC",9002084.91,9002084.91,0,"LAYGO")
M
"SEC","^DIC",9002084.91,9002084.91,0,"RD")
M
"SEC","^DIC",9002084.91,9002084.91,0,"WR")
M
"SEC","^DIC",9002084.93,9002084.93,0,"AUDIT")
M
"SEC","^DIC",9002084.93,9002084.93,0,"DD")
@
"SEC","^DIC",9002084.93,9002084.93,0,"DEL")
M
"SEC","^DIC",9002084.93,9002084.93,0,"LAYGO")
M
"SEC","^DIC",9002084.93,9002084.93,0,"RD")
M
"SEC","^DIC",9002084.93,9002084.93,0,"WR")
M
"VER")
8.0^22.0
"^DD",9002084,9002084,0)
FIELD^^.24^21
"^DD",9002084,9002084,0,"DDA")
N
"^DD",9002084,9002084,0,"DT")
3100307
"^DD",9002084,9002084,0,"IX","B",9002084,.01)

"^DD",9002084,9002084,0,"IX","C",9002084,.1)

"^DD",9002084,9002084,0,"NM","BI PATIENT")

"^DD",9002084,9002084,0,"PT",9002084.12,.01)

"^DD",9002084,9002084,0,"VRPK")
BIV
"^DD",9002084,9002084,.01,0)
NAME^RP9000001'X^AUPNPAT(^0;1^S:$D(X) DINUM=X
"^DD",9002084,9002084,.01,1,0)
^.1
"^DD",9002084,9002084,.01,1,1,0)
9002084^B
"^DD",9002084,9002084,.01,1,1,1)
S ^BIP("B",$E(X,1,30),DA)=""
"^DD",9002084,9002084,.01,1,1,2)
K ^BIP("B",$E(X,1,30),DA)
"^DD",9002084,9002084,.01,3)
Select the patient you wish to add to the Immunization Register.
"^DD",9002084,9002084,.01,"DT")
2960502
"^DD",9002084,9002084,.02,0)
MAILING ADDRESS-STREET^CJ25^^ ; ^X ^DD(9002084,.02,9.2) X $P(^DD(9000001,1602.2,0),U,5,99) S Y(9002084,.02,101)=X S X=Y(9002084,.02,101) S D0=Y(9002084,.02,80)
"^DD",9002084,9002084,.02,9)
^
"^DD",9002084,9002084,.02,9.01)
9000001^1602.2;9002084^.01
"^DD",9002084,9002084,.02,9.1)
NAME:MAILING ADDRESS-STREET
"^DD",9002084,9002084,.02,9.2)
S Y(9002084,.02,80)=$S($D(D0):D0,1:""),Y(9002084,.02,1)=$S($D(^BIP(D0,0)):^(0),1:""),D0=$P(Y(9002084,.02,1),U,1) S:'$D(^AUPNPAT(+D0,0)) D0=-1
"^DD",9002084,9002084,.03,0)
MAILING ADDRESS-CITY^CJ20^^ ; ^X ^DD(9002084,.03,9.2) X $P(^DD(9000001,1603.2,0),U,5,99) S Y(9002084,.03,101)=X S X=Y(9002084,.03,101) S D0=Y(9002084,.03,80)
"^DD",9002084,9002084,.03,9)
^
"^DD",9002084,9002084,.03,9.01)
9000001^1603.2;9002084^.01
"^DD",9002084,9002084,.03,9.1)
NAME:1603.2
"^DD",9002084,9002084,.03,9.2)
S Y(9002084,.03,80)=$S($D(D0):D0,1:""),Y(9002084,.03,1)=$S($D(^BIP(D0,0)):^(0),1:""),D0=$P(Y(9002084,.03,1),U,1) S:'$D(^AUPNPAT(+D0,0)) D0=-1
"^DD",9002084,9002084,.04,0)
MAILING ADDRESS-STATE^CJ2^^ ; ^X ^DD(9002084,.04,9.2) X $P(^DD(9000001,1604.2,0),U,5,99) S Y(9002084,.04,101)=X S X=Y(9002084,.04,101) S D0=Y(9002084,.04,80)
"^DD",9002084,9002084,.04,9)
^
"^DD",9002084,9002084,.04,9.01)
9000001^1604.2;9002084^.01
"^DD",9002084,9002084,.04,9.1)
NAME:1604.2
"^DD",9002084,9002084,.04,9.2)
S Y(9002084,.04,80)=$S($D(D0):D0,1:""),Y(9002084,.04,1)=$S($D(^BIP(D0,0)):^(0),1:""),D0=$P(Y(9002084,.04,1),U,1) S:'$D(^AUPNPAT(+D0,0)) D0=-1
"^DD",9002084,9002084,.04,"DT")
2960924
"^DD",9002084,9002084,.05,0)
MAILING ADDRESS-ZIP^CJ10^^ ; ^X ^DD(9002084,.05,9.2) X $P(^DD(9000001,1605.2,0),U,5,99) S Y(9002084,.05,101)=X S X=Y(9002084,.05,101) S D0=Y(9002084,.05,80)
"^DD",9002084,9002084,.05,9)
^
"^DD",9002084,9002084,.05,9.01)
9000001^1605.2;9002084^.01
"^DD",9002084,9002084,.05,9.1)
NAME:1605.2
"^DD",9002084,9002084,.05,9.2)
S Y(9002084,.05,80)=$S($D(D0):D0,1:""),Y(9002084,.05,1)=$S($D(^BIP(D0,0)):^(0),1:""),D0=$P(Y(9002084,.05,1),U,1) S:'$D(^AUPNPAT(+D0,0)) D0=-1
"^DD",9002084,9002084,.06,0)
CHART#^CJ8^^ ; ^Q:'$D(BIDFN)!('$D(DUZ(2)))  S X=$$HRCN^BIUTL1(BIDFN,DUZ(2))
"^DD",9002084,9002084,.06,9)
^
"^DD",9002084,9002084,.06,9.01)

"^DD",9002084,9002084,.06,9.1)
Q:'$D(BIDFN)!('$D(DUZ(2)))  S X=$$HRCN^BIUTL1(BIDFN,DUZ(2))
"^DD",9002084,9002084,.08,0)
INACTIVE DATE^D^^0;8^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084,9002084,.08,3)
Enter the date on which this patient became Inactive in the Immunization Register.  To RE-activate the patient, Type "@" (shift-2, no quotes); this will delete the Inactive Date.
"^DD",9002084,9002084,.08,"DT")
2960927
"^DD",9002084,9002084,.09,0)
PARENT OR GUARDIAN^F^^0;9^K:$L(X)>40!($L(X)<3) X
"^DD",9002084,9002084,.09,3)
If this patient is a child, enter the name of the parent or guardian of this child.  This should be the person who will be contacted for the patient's follow up.
"^DD",9002084,9002084,.09,"DT")
2960927
"^DD",9002084,9002084,.1,0)
CASE MANAGER^P9002084.01'^BIMGR(^0;10^Q
"^DD",9002084,9002084,.1,1,0)
^.1
"^DD",9002084,9002084,.1,1,1,0)
9002084^C
"^DD",9002084,9002084,.1,1,1,1)
S ^BIP("C",$E(X,1,30),DA)=""
"^DD",9002084,9002084,.1,1,1,2)
K ^BIP("C",$E(X,1,30),DA)
"^DD",9002084,9002084,.1,1,1,"DT")
2981010
"^DD",9002084,9002084,.1,3)
Select the person who is currently managing this patient's immunizations, letters, etc.
"^DD",9002084,9002084,.1,"DT")
2981010
"^DD",9002084,9002084,.11,0)
MOTHERS HBSAG STATUS^S^P:POSITIVE;N:NEGATIVE;U:UNKNOWN;^0;11^Q
"^DD",9002084,9002084,.11,3)
Select the patient's mother's HBsAg Status.
"^DD",9002084,9002084,.11,"DT")
2980305
"^DD",9002084,9002084,.12,0)
MOVED OR TX ELSEWHERE LOCATION^F^^0;12^K:$L(X)>55!($L(X)<1) X
"^DD",9002084,9002084,.12,3)
Enter the location where the patient moved or is receiving treatment.
"^DD",9002084,9002084,.12,"DT")
3050201
"^DD",9002084,9002084,.13,0)
OTHER INFO^F^^0;13^K:$L(X)>50!($L(X)<1) X
"^DD",9002084,9002084,.13,3)
Enter any small item of demographic patient information that is not tracked elsewhere in the software.  Answer must be 1-50 characters in length.
"^DD",9002084,9002084,.13,"DT")
2980505
"^DD",9002084,9002084,.14,0)
DATE OF LAST LETTER^D^^0;14^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084,9002084,.14,3)
Enter the date of the last letter sent to this patient.
"^DD",9002084,9002084,.14,"DT")
2980601
"^DD",9002084,9002084,.15,0)
FORECAST INFLUENZA/PNEUMO^S^0:Normal;1:Influenza;2:Pneumococcal;3:Both, Influ & Pneumo;4:Disregard Risk Factors;^0;15^Q
"^DD",9002084,9002084,.15,3)
Select whether Influenza, Pneumococcal, or Both vaccines should be forecast for this patient, regardless of age.  Leave blank or enter Normal to forecast these vaccines only in later life (>65yrs).
"^DD",9002084,9002084,.15,"DT")
3051213
"^DD",9002084,9002084,.16,0)
INACTIVE REASON^S^m:Moved Elsewhere;t:Treatment Elsewhere;d:Deceased;p:Previously Inactivated;n:Never Activated;i:Ineligible, non-Ben;^0;16^Q
"^DD",9002084,9002084,.16,3)
Select the reason this patient is being Inactivated.
"^DD",9002084,9002084,.16,"DT")
3051229
"^DD",9002084,9002084,.2,0)
FIRST ENTERED BY USER^P200'^VA(200,^0;20^Q
"^DD",9002084,9002084,.2,3)
Select the user who first entered this patient into the Immunization Database.
"^DD",9002084,9002084,.2,"DT")
2970418
"^DD",9002084,9002084,.21,0)
DATE FIRST ENTERED^D^^0;21^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084,9002084,.21,3)
Enter the date on which this patient was first added to the Immunization Database.
"^DD",9002084,9002084,.21,"DT")
2970418
"^DD",9002084,9002084,.22,0)
AUTOMATICALLY ACTIVATED^S^0:MANUALLY;1:AUTOMATICALLY;^0;22^Q
"^DD",9002084,9002084,.22,3)
Enter A if patient was Added Automatically during a Scan enter M if Manually.
"^DD",9002084,9002084,.22,"DT")
3050311
"^DD",9002084,9002084,.23,0)
INACTIVATED BY USER^P200'^VA(200,^0;23^Q
"^DD",9002084,9002084,.23,3)
Select the User who Inactivated this patient.
"^DD",9002084,9002084,.23,"DT")
3050322
"^DD",9002084,9002084,.24,0)
CONSENT FOR STATE REGISTRY^S^0:NO;1:YES;^0;24^Q
"^DD",9002084,9002084,.24,"DT")
3100307
"^DD",9002084,9002084,1.01,0)
IMM/SERVE TEXT^9002084.03^^1;0
"^DD",9002084,9002084.03,0)
IMM/SERVE TEXT SUB-FIELD^^.01^1
"^DD",9002084,9002084.03,0,"DT")
2970220
"^DD",9002084,9002084.03,0,"NM","IMM/SERVE TEXT")

"^DD",9002084,9002084.03,0,"UP")
9002084
"^DD",9002084,9002084.03,.01,0)
IMM/SERVE TEXT^WL^^0;1^Q
"^DD",9002084,9002084.03,.01,3)
Enter the text of the IMM/Serve Report.
"^DD",9002084,9002084.03,.01,"DT")
2970220
"^DD",9002084.01,9002084.01,0)
FIELD^^.02^2
"^DD",9002084.01,9002084.01,0,"DDA")
N
"^DD",9002084.01,9002084.01,0,"DT")
2960924
"^DD",9002084.01,9002084.01,0,"IX","B",9002084.01,.01)

"^DD",9002084.01,9002084.01,0,"NM","BI CASE MANAGER")

"^DD",9002084.01,9002084.01,0,"PT",9002084,.1)

"^DD",9002084.01,9002084.01,0,"PT",9002084.02,.02)

"^DD",9002084.01,9002084.01,0,"VRPK")
BIV
"^DD",9002084.01,9002084.01,.01,0)
CASE MANAGER^RP200'X^VA(200,^0;1^S:$D(X) DINUM=X
"^DD",9002084.01,9002084.01,.01,1,0)
^.1
"^DD",9002084.01,9002084.01,.01,1,1,0)
9002084.01^B
"^DD",9002084.01,9002084.01,.01,1,1,1)
S ^BIMGR("B",$E(X,1,30),DA)=""
"^DD",9002084.01,9002084.01,.01,1,1,2)
K ^BIMGR("B",$E(X,1,30),DA)
"^DD",9002084.01,9002084.01,.01,3)
Select the person who will be an Immunization Case Manager.
"^DD",9002084.01,9002084.01,.01,"DT")
2970418
"^DD",9002084.01,9002084.01,.02,0)
DATE INACTIVATED^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.01,9002084.01,.02,3)
Enter the date on which this Case Manager will be no longer active as an Immunization Case Manager.
"^DD",9002084.01,9002084.01,.02,"DT")
2960924
"^DD",9002084.02,9002084.02,0)
FIELD^^920001^34
"^DD",9002084.02,9002084.02,0,"DT")
3150504
"^DD",9002084.02,9002084.02,0,"IX","B",9002084.02,.01)

"^DD",9002084.02,9002084.02,0,"NM","BI SITE PARAMETER")

"^DD",9002084.02,9002084.02,0,"VRPK")
BIV
"^DD",9002084.02,9002084.02,.01,0)
SITE/FACILITY NAME^RP9999999.06'X^AUTTLOC(^0;1^S:$D(X) DINUM=X
"^DD",9002084.02,9002084.02,.01,1,0)
^.1
"^DD",9002084.02,9002084.02,.01,1,1,0)
9002084.02^B
"^DD",9002084.02,9002084.02,.01,1,1,1)
S ^BISITE("B",$E(X,1,30),DA)=""
"^DD",9002084.02,9002084.02,.01,1,1,2)
K ^BISITE("B",$E(X,1,30),DA)
"^DD",9002084.02,9002084.02,.01,3)
Select the Facility whose Immunization Site Parameters you which to set.
"^DD",9002084.02,9002084.02,.01,"DT")
2960507
"^DD",9002084.02,9002084.02,.02,0)
DEFAULT CASE MANAGER^P9002084.01^BIMGR(^0;2^Q
"^DD",9002084.02,9002084.02,.02,3)
Select the person who will be the Case Manger for most Immunization Database patients.
"^DD",9002084.02,9002084.02,.02,"DT")
2980312
"^DD",9002084.02,9002084.02,.03,0)
OTHER LOCATION^P9999999.06'^AUTTLOC(^0;3^Q
"^DD",9002084.02,9002084.02,.03,3)
Select the Location that will serve as OTHER when the Location of a Visit is not in the Location File. 
"^DD",9002084.02,9002084.02,.03,"DT")
2970929
"^DD",9002084.02,9002084.02,.04,0)
STANDARD DUE LETTER^P9002084.4'^BILET(^0;4^Q
"^DD",9002084.02,9002084.02,.04,3)
Select the letter that will be used when Immunizations Due letters are automatically printed.
"^DD",9002084.02,9002084.02,.04,"DT")
2990222
"^DD",9002084.02,9002084.02,.05,0)
MIMIMUM INTERVAL DAYS LAST LET^NJ4,0^^0;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002084.02,9002084.02,.05,3)
Enter the default minimum number of days since the last letter.  Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002084.02,9002084.02,.05,"DT")
2980817
"^DD",9002084.02,9002084.02,.06,0)
FACILITY RECORD/REPORT HEADER^F^^0;6^K:$L(X)>50!($L(X)<3) X
"^DD",9002084.02,9002084.02,.06,3)
Enter the full name of this facility as you wish it to appear at the top of records and reports.  Answer must be 3-50 characters in length.
"^DD",9002084.02,9002084.02,.06,"DT")
2980701
"^DD",9002084.02,9002084.02,.07,0)
MINIMUM VS RECOMMENDED AGE^S^A:MINIMUM ACCEPTABLE AGE;R:RECOMMENDED AGE;^0;7^Q
"^DD",9002084.02,9002084.02,.07,3)
Enter MINIMUM to have vaccines forecast as due at the Minimum Acceptable Age for each child.  Enter RECOMMENDED to have them forecast as due at the recommended age.
"^DD",9002084.02,9002084.02,.07,"DT")
2980917
"^DD",9002084.02,9002084.02,.08,0)
IMMSERVE FORECASTING RULES^S^1:IHS_1;2:IHS_2;3:IHS_3;4:IHS_4;5:IHS_5;6:IHS_6;7:IHS_7;8:IHS_8;9:IHS_9;10:IHS_10;11:IHS_11;^0;8^Q
"^DD",9002084.02,9002084.02,.08,3)
Select the version of forecasting rules you wish to have applied at this site when patient immunization forecasts are produced.
"^DD",9002084.02,9002084.02,.08,"DT")
3060725
"^DD",9002084.02,9002084.02,.09,0)
LOT NUMBER REQUIRED^S^1:YES;0:NO;^0;9^Q
"^DD",9002084.02,9002084.02,.09,3)
Enter YES if Lot Numbers should be required when entering Immunization visits.  Enter NO if Lot Number should not be required.
"^DD",9002084.02,9002084.02,.09,"DT")
2981102
"^DD",9002084.02,9002084.02,.1,0)
AGE FOR PNEUMO^NJ2,0^^0;10^K:+X'=X!(X>99)!(X<6)!(X?.E1"."1N.N) X
"^DD",9002084.02,9002084.02,.1,3)
Enter the age at which adults should be forecast to receive pneumococcal vaccines (usually 65 years old).
"^DD",9002084.02,9002084.02,.1,"DT")
2981220
"^DD",9002084.02,9002084.02,.11,0)
FORECASTING ENABLED^S^1:ENABLED;0:DISABLED;^0;11^Q
"^DD",9002084.02,9002084.02,.11,3)
Select ENABLED to turn on Immunization Forecasting.  If the Forecaster is unavailable, select DISABLED.
"^DD",9002084.02,9002084.02,.11,"DT")
2990125
"^DD",9002084.02,9002084.02,.12,0)
CHART# WITH DASHES^S^0:NO DASHES;1:DASHES INCLUDED;^0;12^Q
"^DD",9002084.02,9002084.02,.12,3)
Enter "NO DASHES" if Chart#s should NOT contain dashes, e.g., 12345.  Enter "DASHES" if Chart#s SHOULD include dashes, e.g., 01-23-45.
"^DD",9002084.02,9002084.02,.12,"DT")
2990225
"^DD",9002084.02,9002084.02,.13,0)
OFFICIAL IMM RECORD LETTER^P9002084.4'^BILET(^0;13^Q
"^DD",9002084.02,9002084.02,.13,3)
Select the letter that will be used when an a patient's Official Immunization Record is printed.
"^DD",9002084.02,9002084.02,.13,"DT")
2990428
"^DD",9002084.02,9002084.02,.14,0)
HOST FILE PATH^F^^0;14^K:$L(X)>30!($L(X)<1) X
"^DD",9002084.02,9002084.02,.14,3)
Enter the host file path for files to be imported and exported.  Include ALL necessary slashes, everything except the filename itself.
"^DD",9002084.02,9002084.02,.14,"DT")
2960507
"^DD",9002084.02,9002084.02,.15,0)
LAST VERSION FULLY INSTALLED^F^^0;15^K:$L(X)>10!($L(X)<1) X
"^DD",9002084.02,9002084.02,.15,3)
Answer must be 1-10 characters in length.
"^DD",9002084.02,9002084.02,.15,21,0)
^^2^2^2980402^
"^DD",9002084.02,9002084.02,.15,21,1,0)
This field should be updated only by the installation software at the end
"^DD",9002084.02,9002084.02,.15,21,2,0)
of a complete, successful installation of a version of Immunization.
"^DD",9002084.02,9002084.02,.15,"DT")
2980402
"^DD",9002084.02,9002084.02,.16,0)
USER AS DEFAULT PROVIDER^S^0:NO;1:YES;^0;16^Q
"^DD",9002084.02,9002084.02,.16,3)
Enter YES if the User should appear as the Default Provider when entering new Immunizations or Skin Tests.  Enter NO if the User should not appear as the Default Provider.
"^DD",9002084.02,9002084.02,.16,"DT")
2990708
"^DD",9002084.02,9002084.02,.17,0)
OP SYSTEM CALL^S^1:AIX;2:NT/XP;3:SCO;4:SUN;^0;17^Q
"^DD",9002084.02,9002084.02,.17,3)
Enter the ImmServe Operating System Call for this machine.
"^DD",9002084.02,9002084.02,.17,"DT")
3031030
"^DD",9002084.02,9002084.02,.18,0)
IMMSERVE PATH^F^^0;18^K:$L(X)>70!($L(X)<3) X
"^DD",9002084.02,9002084.02,.18,3)
Please enter the explicit name of the directory where the ImmServ Files will be stored.
"^DD",9002084.02,9002084.02,.18,"DT")
3031030
"^DD",9002084.02,9002084.02,.19,0)
INCLUDE RISK FACTORS^S^0:NONE;1:HEPB ONLY;2:PNEUMO ONLY;12:HEPB + PNEUMO;23:PNEUMO + SMOKING;123:ALL;^0;19^Q
"^DD",9002084.02,9002084.02,.19,3)
Choose whether or not Risk Factors should be included when considering the forecast of Flu and Pneumo vaccines.
"^DD",9002084.02,9002084.02,.19,"DT")
3100408
"^DD",9002084.02,9002084.02,.2,0)
IMPORT CPT-CODED VISITS^S^0:DISABLE IMPORT OF CPT-CODED VISITS;1:ENABLE IMPORT OF CPT-CODED VISITS;^0;20^Q
"^DD",9002084.02,9002084.02,.2,3)
Enter "Enable" to allow CPT-coded Immunizations not already in the Immunization database to be automatically imported.
"^DD",9002084.02,9002084.02,.2,"DT")
3051006
"^DD",9002084.02,9002084.02,.21,0)
GRACE PERIOD 4-DAY^S^1:YES, ALLOW 4-DAY GRACE PERIOD;0:NO GRACE PERIOD;^0;21^Q
"^DD",9002084.02,9002084.02,.21,3)
Enter Yes to allow a 4-day grace period.  Enter No disallow any grace period.
"^DD",9002084.02,9002084.02,.21,"DT")
3030501
"^DD",9002084.02,9002084.02,.22,0)
PNEUMO EVERY 6 YEARS^S^0:NO;1:YES;^0;22^Q
"^DD",9002084.02,9002084.02,.22,3)
Enter YES if Pneumo should be forecast every 6 yrs for older patients.
"^DD",9002084.02,9002084.02,.22,"DT")
3030919
"^DD",9002084.02,9002084.02,.23,0)
INPATIENT VISIT CHECK^S^0:DISABLE;1:ENABLE;^0;23^Q
"^DD",9002084.02,9002084.02,.23,3)
Check if this patient is/was an Inpatient during the time of this Immunization Visit.
"^DD",9002084.02,9002084.02,.23,"DT")
3050903
"^DD",9002084.02,9002084.02,.24,0)
HPV 18 OR 26^S^1:18;2:26;^0;24^Q
"^DD",9002084.02,9002084.02,.24,3)
Select whether HPV should be forecast to age 18 or 26.
"^DD",9002084.02,9002084.02,.24,"DT")
3070430
"^DD",9002084.02,9002084.02,.25,0)
DEFAULT LOW SUPPLY ALERT^NJ4,0^^0;25^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002084.02,9002084.02,.25,3)
Enter number of doses remaining that will trigger a Low Suppy Alert.  Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002084.02,9002084.02,.25,"DT")
3080630
"^DD",9002084.02,9002084.02,.26,0)
IMMSERVE ERROR LOGGING^S^1:LOG IMMSERVE ERRORS IN HOST FILE;0:DO NOT LOG IMMSERVE ERRORS;^0;26^Q
"^DD",9002084.02,9002084.02,.26,"DT")
3080523
"^DD",9002084.02,9002084.02,.27,0)
FORECAST FLU ALL AGES^S^1:YES;0:NO;^0;27^Q
"^DD",9002084.02,9002084.02,.27,3)
Enter YES if Influenza Vaccine should be forecast for all ages.
"^DD",9002084.02,9002084.02,.27,"DT")
3100118
"^DD",9002084.02,9002084.02,.28,0)
VISIT SELECTION MENU^S^0:DISABLE;1:ENABLE;^0;28^Q
"^DD",9002084.02,9002084.02,.28,3)
Enter OFF to turn of Visit Selection Menu; enter ON to display matching Visits.
"^DD",9002084.02,9002084.02,.28,"DT")
3100216
"^DD",9002084.02,9002084.02,.29,0)
ZOSTERVAX^S^1:YES;0:NO;^0;29^Q
"^DD",9002084.02,9002084.02,.29,3)
Enter YES if Zostervax should be forecast.
"^DD",9002084.02,9002084.02,.29,"DT")
3101215
"^DD",9002084.02,9002084.02,.3,0)
IP ADDRESS FOR TCH FORECASTER^F^^0;30^K:$L(X)>25!($L(X)<7) X
"^DD",9002084.02,9002084.02,.3,3)
Enter a valid IP address for the TCH Forecaster.
"^DD",9002084.02,9002084.02,.3,"DT")
3140829
"^DD",9002084.02,9002084.02,2.01,0)
GPRA COMMUNITIES^9002084.04PA^^2;0
"^DD",9002084.02,9002084.02,920000.01,0)
VISTA OTHER LOCATION^F^^920000;1^K:$L(X)>50!($L(X)<2) X
"^DD",9002084.02,9002084.02,920000.01,3)
Answer must be 2-50 characters in length.
"^DD",9002084.02,9002084.02,920000.01,21,0)
^^2^2^3150419^
"^DD",9002084.02,9002084.02,920000.01,21,1,0)
Enter the default location for patients who are not getting the 
"^DD",9002084.02,9002084.02,920000.01,21,2,0)
immunization in your hospital or clinic.
"^DD",9002084.02,9002084.02,920000.01,"DT")
3150504
"^DD",9002084.02,9002084.02,920000.02,0)
COMMUNITY LOCATION TYPE^S^Z:ZIP CODE;P:POSTAL CODE;^920000;2^Q
"^DD",9002084.02,9002084.02,920000.02,3)
Select an entry
"^DD",9002084.02,9002084.02,920000.02,21,0)
^^3^3^3150504^
"^DD",9002084.02,9002084.02,920000.02,21,1,0)
This field is used when statistics are requested on the patients. It will 
"^DD",9002084.02,9002084.02,920000.02,21,2,0)
decide how to treat the data stored in COMMUNITY:COMMUNITY CODE: Is it a 
"^DD",9002084.02,9002084.02,920000.02,21,3,0)
zip code or a postal code?
"^DD",9002084.02,9002084.02,920000.02,"DT")
3150504
"^DD",9002084.02,9002084.02,920001,0)
COMMUNITY^9002084.02920001A^^920001;0
"^DD",9002084.02,9002084.02920001,0)
COMMUNITY SUB-FIELD^^.01^1
"^DD",9002084.02,9002084.02920001,0,"DT")
3150504
"^DD",9002084.02,9002084.02920001,0,"IX","B",9002084.02920001,.01)

"^DD",9002084.02,9002084.02920001,0,"NM","COMMUNITY")

"^DD",9002084.02,9002084.02920001,0,"UP")
9002084.02
"^DD",9002084.02,9002084.02920001,.01,0)
COMMUNITY^MF^^0;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002084.02,9002084.02920001,.01,1,0)
^.1
"^DD",9002084.02,9002084.02920001,.01,1,1,0)
9002084.02920001^B
"^DD",9002084.02,9002084.02920001,.01,1,1,1)
S ^BISITE(DA(1),920001,"B",$E(X,1,30),DA)=""
"^DD",9002084.02,9002084.02920001,.01,1,1,2)
K ^BISITE(DA(1),920001,"B",$E(X,1,30),DA)
"^DD",9002084.02,9002084.02920001,.01,3)
Answer must be 1-15 characters in length.
"^DD",9002084.02,9002084.02920001,.01,21,0)
^^9^9^3150504^
"^DD",9002084.02,9002084.02920001,.01,21,1,0)
This field contains the ZIP code or postal code which you want to cover 
"^DD",9002084.02,9002084.02920001,.01,21,2,0)
in your statistics in the Immunization Package. The data here is free 
"^DD",9002084.02,9002084.02920001,.01,21,3,0)
text and will be used on the Patient file to do these statistics.
"^DD",9002084.02,9002084.02920001,.01,21,4,0)
 
"^DD",9002084.02,9002084.02920001,.01,21,5,0)
Whether you enter a ZIP code or a postal code depends on the value of 
"^DD",9002084.02,9002084.02920001,.01,21,6,0)
COMMUNITY LOCATION TYPE.
"^DD",9002084.02,9002084.02920001,.01,21,7,0)
 
"^DD",9002084.02,9002084.02920001,.01,21,8,0)
The field accomodates ZIP codes or postal codes in order to accomodate 
"^DD",9002084.02,9002084.02920001,.01,21,9,0)
users of VISTA outside of the US.
"^DD",9002084.02,9002084.02920001,.01,"DT")
3150504
"^DD",9002084.02,9002084.04,0)
GPRA COMMUNITIES SUB-FIELD^^.01^1
"^DD",9002084.02,9002084.04,0,"DT")
3050124
"^DD",9002084.02,9002084.04,0,"IX","B",9002084.04,.01)

"^DD",9002084.02,9002084.04,0,"NM","GPRA COMMUNITIES")

"^DD",9002084.02,9002084.04,0,"UP")
9002084.02
"^DD",9002084.02,9002084.04,.01,0)
GPRA COMMUNITIES^P9999999.05'X^AUTTCOM(^0;1^S:$D(X) DINUM=X
"^DD",9002084.02,9002084.04,.01,1,0)
^.1
"^DD",9002084.02,9002084.04,.01,1,1,0)
9002084.04^B
"^DD",9002084.02,9002084.04,.01,1,1,1)
S ^BISITE(DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002084.02,9002084.04,.01,1,1,2)
K ^BISITE(DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002084.02,9002084.04,.01,"DT")
3050124
"^DD",9002084.1,9002084.1,0)
FIELD^^.06^6
"^DD",9002084.1,9002084.1,0,"DT")
3081121
"^DD",9002084.1,9002084.1,0,"IX","B",9002084.1,.01)

"^DD",9002084.1,9002084.1,0,"IX","D",9002084.1,.04)

"^DD",9002084.1,9002084.1,0,"IX","DD",9002084.1,.05)

"^DD",9002084.1,9002084.1,0,"IX","E",9002084.1,.05)

"^DD",9002084.1,9002084.1,0,"NM","BI PATIENT IMMUNIZATIONS DUE")

"^DD",9002084.1,9002084.1,0,"VRPK")
BIV
"^DD",9002084.1,9002084.1,.01,0)
PATIENT NAME^RP9000001'X^AUPNPAT(^0;1^Q
"^DD",9002084.1,9002084.1,.01,1,0)
^.1
"^DD",9002084.1,9002084.1,.01,1,1,0)
9002084.1^B
"^DD",9002084.1,9002084.1,.01,1,1,1)
S ^BIPDUE("B",$E(X,1,30),DA)=""
"^DD",9002084.1,9002084.1,.01,1,1,2)
K ^BIPDUE("B",$E(X,1,30),DA)
"^DD",9002084.1,9002084.1,.01,3)
Select the patient for whom an Immunization is due.
"^DD",9002084.1,9002084.1,.01,"DT")
2970818
"^DD",9002084.1,9002084.1,.02,0)
IMMUNIZATION^P9999999.14'^AUTTIMM(^0;2^Q
"^DD",9002084.1,9002084.1,.02,3)
Select the Immunization due for this patient.
"^DD",9002084.1,9002084.1,.02,"DT")
2970818
"^DD",9002084.1,9002084.1,.03,0)
SERIES^NJ2,0^^0;3^K:+X'=X!(X>12)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002084.1,9002084.1,.03,3)
Enter the Series number for this Immunzation; enter a number between 0 and 12.
"^DD",9002084.1,9002084.1,.03,"DT")
2970818
"^DD",9002084.1,9002084.1,.04,0)
RECOMMENDED DATE DUE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.1,9002084.1,.04,1,0)
^.1
"^DD",9002084.1,9002084.1,.04,1,1,0)
9002084.1^D
"^DD",9002084.1,9002084.1,.04,1,1,1)
S ^BIPDUE("D",$E(X,1,30),DA)=""
"^DD",9002084.1,9002084.1,.04,1,1,2)
K ^BIPDUE("D",$E(X,1,30),DA)
"^DD",9002084.1,9002084.1,.04,1,1,"DT")
2970818
"^DD",9002084.1,9002084.1,.04,3)
Enter the date on which this Immunization is due.
"^DD",9002084.1,9002084.1,.04,"DT")
2970825
"^DD",9002084.1,9002084.1,.05,0)
DATE PAST DUE^D^^0;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.1,9002084.1,.05,1,0)
^.1
"^DD",9002084.1,9002084.1,.05,1,1,0)
9002084.1^DD^MUMPS
"^DD",9002084.1,9002084.1,.05,1,1,1)
S ^BIPDUE("D",$E(X,1,30),DA)=""
"^DD",9002084.1,9002084.1,.05,1,1,2)
K ^BIPDUE("D",$E(X,1,30),DA)
"^DD",9002084.1,9002084.1,.05,1,1,"DT")
2980606
"^DD",9002084.1,9002084.1,.05,1,2,0)
9002084.1^E^MUMPS
"^DD",9002084.1,9002084.1,.05,1,2,1)
S ^BIPDUE("E",$P(^BIPDUE(DA,0),U),X,DA)=""
"^DD",9002084.1,9002084.1,.05,1,2,2)
K ^BIPDUE("E",$P(^BIPDUE(DA,0),U),X,DA)
"^DD",9002084.1,9002084.1,.05,1,2,"DT")
2980629
"^DD",9002084.1,9002084.1,.05,3)
Enter the date at which this immunization will be past due.
"^DD",9002084.1,9002084.1,.05,"DT")
2980629
"^DD",9002084.1,9002084.1,.06,0)
DATE FORECAST CALCULATED^D^^0;6^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.1,9002084.1,.06,3)
Enter the date on which this forecast was calculated (not the date that the vaccine is due).
"^DD",9002084.1,9002084.1,.06,"DT")
3081121
"^DD",9002084.11,9002084.11,0)
FIELD^^1^9
"^DD",9002084.11,9002084.11,0,"DT")
3150605
"^DD",9002084.11,9002084.11,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^AUTTIMM(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(9999999.14,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",9002084.11,9002084.11,0,"IX","AC",9002084.11,.02)

"^DD",9002084.11,9002084.11,0,"IX","B",9002084.11,.01)

"^DD",9002084.11,9002084.11,0,"NM","BI PATIENT CONTRAINDICATIONS")

"^DD",9002084.11,9002084.11,0,"VRPK")
BIV
"^DD",9002084.11,9002084.11,.01,0)
PATIENT NAME^RP9000001'^AUPNPAT(^0;1^Q
"^DD",9002084.11,9002084.11,.01,1,0)
^.1
"^DD",9002084.11,9002084.11,.01,1,1,0)
9002084.11^B
"^DD",9002084.11,9002084.11,.01,1,1,1)
S ^BIPC("B",$E(X,1,30),DA)=""
"^DD",9002084.11,9002084.11,.01,1,1,2)
K ^BIPC("B",$E(X,1,30),DA)
"^DD",9002084.11,9002084.11,.01,3)
Select the patient whose contraindication you wish to enter.
"^DD",9002084.11,9002084.11,.01,"DT")
2980310
"^DD",9002084.11,9002084.11,.02,0)
VACCINE^P9999999.14'^AUTTIMM(^0;2^Q
"^DD",9002084.11,9002084.11,.02,1,0)
^.1
"^DD",9002084.11,9002084.11,.02,1,1,0)
9002084.11^AC^MUMPS
"^DD",9002084.11,9002084.11,.02,1,1,1)
S ^BIPC("AC",+^BIPC(DA,0),$E(X,1,30),DA)=""
"^DD",9002084.11,9002084.11,.02,1,1,2)
K ^BIPC("AC",+^BIPC(DA,0),$E(X,1,30),DA)
"^DD",9002084.11,9002084.11,.02,1,1,"DT")
2981223
"^DD",9002084.11,9002084.11,.02,3)
Select the vaccine for which this patient has a contraindication.
"^DD",9002084.11,9002084.11,.02,"DT")
2981223
"^DD",9002084.11,9002084.11,.03,0)
REASON FOR CONTRAINDICATION^P920.4'^PXV(920.4,^0;3^Q
"^DD",9002084.11,9002084.11,.03,3)
Select the reason this vaccine is contraindicated for this patient.
"^DD",9002084.11,9002084.11,.03,"DT")
3150605
"^DD",9002084.11,9002084.11,.04,0)
DATE NOTED^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.11,9002084.11,.04,3)
Enter the date on which this Contraindication was noted.
"^DD",9002084.11,9002084.11,.04,"DT")
2980227
"^DD",9002084.11,9002084.11,1,0)
SNOMED CODES^9002084.111A^^1;0
"^DD",9002084.11,9002084.11,2.01,0)
CONTRAINDICATION DELETED BY^P200'^VA(200,^2;1^Q
"^DD",9002084.11,9002084.11,2.01,"DT")
3130218
"^DD",9002084.11,9002084.11,2.02,0)
DATE/TIME CONTRAIND DELETED^D^^2;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.11,9002084.11,2.02,"DT")
3130218
"^DD",9002084.11,9002084.11,2.03,0)
REASON CONTRAIND DELETED^S^d:Duplicate;e:Entered in Error;o:Other;^2;3^Q
"^DD",9002084.11,9002084.11,2.03,"DT")
3130218
"^DD",9002084.11,9002084.11,2.04,0)
REASON IF OTHER^F^^2;4^K:$L(X)>100!($L(X)<2) X
"^DD",9002084.11,9002084.11,2.04,3)
Answer must be 2-100 characters in length.
"^DD",9002084.11,9002084.11,2.04,"DT")
3130218
"^DD",9002084.11,9002084.111,0)
SNOMED CODES SUB-FIELD^^.01^1
"^DD",9002084.11,9002084.111,0,"DT")
3130506
"^DD",9002084.11,9002084.111,0,"IX","B",9002084.111,.01)

"^DD",9002084.11,9002084.111,0,"NM","SNOMED CODES")

"^DD",9002084.11,9002084.111,0,"UP")
9002084.11
"^DD",9002084.11,9002084.111,.01,0)
SNOMED CODES^F^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002084.11,9002084.111,.01,1,0)
^.1^^-1
"^DD",9002084.11,9002084.111,.01,1,1,0)
9002084.111^B
"^DD",9002084.11,9002084.111,.01,1,1,1)
S ^BIPC(DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002084.11,9002084.111,.01,1,1,2)
K ^BIPC(DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002084.11,9002084.111,.01,3)
Answer must be 1-20 characters in length.
"^DD",9002084.11,9002084.111,.01,"DT")
3130506
"^DD",9002084.115,9002084.115,0)
FIELD^^2.04^8
"^DD",9002084.115,9002084.115,0,"DDA")
N
"^DD",9002084.115,9002084.115,0,"DT")
3150616
"^DD",9002084.115,9002084.115,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^AUTTIMM(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(9999999.14,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",9002084.115,9002084.115,0,"IX","AC",9002084.115,.02)

"^DD",9002084.115,9002084.115,0,"IX","B",9002084.115,.01)

"^DD",9002084.115,9002084.115,0,"NM","BI PATIENT CONTRAINDICATIONS DELETED")

"^DD",9002084.115,9002084.115,0,"VRPK")
BIV
"^DD",9002084.115,9002084.115,.01,0)
PATIENT NAME^RP9000001'^AUPNPAT(^0;1^Q
"^DD",9002084.115,9002084.115,.01,1,0)
^.1
"^DD",9002084.115,9002084.115,.01,1,1,0)
9002084.115^B
"^DD",9002084.115,9002084.115,.01,1,1,1)
S ^BIPCD("B",$E(X,1,30),DA)=""
"^DD",9002084.115,9002084.115,.01,1,1,2)
K ^BIPCD("B",$E(X,1,30),DA)
"^DD",9002084.115,9002084.115,.01,3)
Select the patient whose contraindication you wish to enter.
"^DD",9002084.115,9002084.115,.01,"DT")
2980310
"^DD",9002084.115,9002084.115,.02,0)
VACCINE^P9999999.14'^AUTTIMM(^0;2^Q
"^DD",9002084.115,9002084.115,.02,1,0)
^.1
"^DD",9002084.115,9002084.115,.02,1,1,0)
9002084.115^AC^MUMPS
"^DD",9002084.115,9002084.115,.02,1,1,1)
S ^BIPCD("AC",+^BIPCD(DA,0),$E(X,1,30),DA)=""
"^DD",9002084.115,9002084.115,.02,1,1,2)
K ^BIPCD("AC",+^BIPCD(DA,0),$E(X,1,30),DA)
"^DD",9002084.115,9002084.115,.02,1,1,"DT")
2981223
"^DD",9002084.115,9002084.115,.02,3)
Select the vaccine for which this patient has a contraindication.
"^DD",9002084.115,9002084.115,.02,"DT")
2981223
"^DD",9002084.115,9002084.115,.03,0)
REASON FOR CONTRAINDICATION^P920.4'^PXV(920.4,^0;3^Q
"^DD",9002084.115,9002084.115,.03,3)
Select the reason this vaccine is contraindicated for this patient.
"^DD",9002084.115,9002084.115,.03,"DT")
3150616
"^DD",9002084.115,9002084.115,.04,0)
DATE NOTED^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.115,9002084.115,.04,3)
Enter the date on which this Contraindication was noted.
"^DD",9002084.115,9002084.115,.04,"DT")
2980227
"^DD",9002084.115,9002084.115,2.01,0)
CONTRAINDICATION DELETED BY^P200'^VA(200,^2;1^Q
"^DD",9002084.115,9002084.115,2.01,"DT")
3130218
"^DD",9002084.115,9002084.115,2.02,0)
DATE/TIME CONTRAIND DELETED^D^^2;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",9002084.115,9002084.115,2.02,"DT")
3130218
"^DD",9002084.115,9002084.115,2.03,0)
REASON CONTRAIND DELETED^S^d:Duplicate;e:Entered in Error;o:Other;^2;3^Q
"^DD",9002084.115,9002084.115,2.03,"DT")
3130218
"^DD",9002084.115,9002084.115,2.04,0)
REASON IF OTHER^F^^2;4^K:$L(X)>100!($L(X)<2) X
"^DD",9002084.115,9002084.115,2.04,3)
Answer must be 2-100 characters in length.
"^DD",9002084.115,9002084.115,2.04,"DT")
3130218
"^DD",9002084.12,9002084.12,0)
FIELD^^.03^3
"^DD",9002084.12,9002084.12,0,"DDA")
N
"^DD",9002084.12,9002084.12,0,"DT")
2980923
"^DD",9002084.12,9002084.12,0,"IX","B",9002084.12,.01)

"^DD",9002084.12,9002084.12,0,"NM","BI PATIENT FORECAST ERRORS")

"^DD",9002084.12,9002084.12,0,"VRPK")
BIV
"^DD",9002084.12,9002084.12,.01,0)
PATIENT NAME^RP9002084'^BIP(^0;1^Q
"^DD",9002084.12,9002084.12,.01,1,0)
^.1
"^DD",9002084.12,9002084.12,.01,1,1,0)
9002084.12^B
"^DD",9002084.12,9002084.12,.01,1,1,1)
S ^BIPERR("B",$E(X,1,30),DA)=""
"^DD",9002084.12,9002084.12,.01,1,1,2)
K ^BIPERR("B",$E(X,1,30),DA)
"^DD",9002084.12,9002084.12,.01,3)
Select the patient who has a forecasting error.
"^DD",9002084.12,9002084.12,.01,"DT")
2980923
"^DD",9002084.12,9002084.12,.02,0)
ERROR^P9002084.33'^BIERR(^0;2^Q
"^DD",9002084.12,9002084.12,.02,3)
Select the error you wish to record for this patient.
"^DD",9002084.12,9002084.12,.02,"DT")
2980923
"^DD",9002084.12,9002084.12,.03,0)
VACCINE GROUP^F^^0;3^K:$L(X)>6!($L(X)<1) X
"^DD",9002084.12,9002084.12,.03,3)
Enter the Vaccine Group with which this error is associated.  Answer must be 1-6 characters in length.
"^DD",9002084.12,9002084.12,.03,"DT")
2980923
"^DD",9002084.33,9002084.33,0)
FIELD^^.03^3
"^DD",9002084.33,9002084.33,0,"DDA")
N
"^DD",9002084.33,9002084.33,0,"DT")
2990422
"^DD",9002084.33,9002084.33,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002084.33,9002084.33,0,"IX","B",9002084.33,.01)

"^DD",9002084.33,9002084.33,0,"IX","C",9002084.33,.02)

"^DD",9002084.33,9002084.33,0,"IX","U",9002084.33,.02)

"^DD",9002084.33,9002084.33,0,"NM","BI TABLE ERROR CODE")

"^DD",9002084.33,9002084.33,0,"PT",9002084.12,.02)

"^DD",9002084.33,9002084.33,0,"PT",9002084.35,.02)

"^DD",9002084.33,9002084.33,0,"VRPK")
BIV
"^DD",9002084.33,9002084.33,.01,0)
ERROR CODE#^RNJ4,0XI^^0;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X S:$G(X) DINUM=X
"^DD",9002084.33,9002084.33,.01,1,0)
^.1
"^DD",9002084.33,9002084.33,.01,1,1,0)
9002084.33^B
"^DD",9002084.33,9002084.33,.01,1,1,1)
S ^BIERR("B",$E(X,1,30),DA)=""
"^DD",9002084.33,9002084.33,.01,1,1,2)
K ^BIERR("B",$E(X,1,30),DA)
"^DD",9002084.33,9002084.33,.01,3)
Enter an Error Code number between 1 and 9999.
"^DD",9002084.33,9002084.33,.01,"DT")
2990131
"^DD",9002084.33,9002084.33,.02,0)
ERROR CODE TEXT^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002084.33,9002084.33,.02,1,0)
^.1
"^DD",9002084.33,9002084.33,.02,1,1,0)
9002084.33^C
"^DD",9002084.33,9002084.33,.02,1,1,1)
S ^BIERR("C",$E(X,1,30),DA)=""
"^DD",9002084.33,9002084.33,.02,1,1,2)
K ^BIERR("C",$E(X,1,30),DA)
"^DD",9002084.33,9002084.33,.02,1,1,"DT")
2970908
"^DD",9002084.33,9002084.33,.02,1,2,0)
9002084.33^U^MUMPS
"^DD",9002084.33,9002084.33,.02,1,2,1)
D UPXREF^BIUTL5(X,"^BIERR(")
"^DD",9002084.33,9002084.33,.02,1,2,2)
D KUPXREF^BIUTL5(X,"^BWERR(")
"^DD",9002084.33,9002084.33,.02,1,2,"DT")
2970908
"^DD",9002084.33,9002084.33,.02,3)
Enter the text of this Error Code (70 characters or less).
"^DD",9002084.33,9002084.33,.02,"DT")
2970908
"^DD",9002084.33,9002084.33,.03,0)
ERROR ABBREVIATED TEXT^F^^0;3^K:$L(X)>19!($L(X)<2) X
"^DD",9002084.33,9002084.33,.03,3)
Enter an abbreviated form of the Error Text.  Answer must be 2-19 characters in length.
"^DD",9002084.33,9002084.33,.03,"DT")
2990422
"^DD",9002084.4,9002084.4,0)
FIELD^^4.01^10
"^DD",9002084.4,9002084.4,0,"DT")
3050826
"^DD",9002084.4,9002084.4,0,"IX","B",9002084.4,.01)

"^DD",9002084.4,9002084.4,0,"IX","U",9002084.4,.01)

"^DD",9002084.4,9002084.4,0,"NM","BI LETTER")

"^DD",9002084.4,9002084.4,0,"PT",9002084.02,.04)

"^DD",9002084.4,9002084.4,0,"PT",9002084.02,.13)

"^DD",9002084.4,9002084.4,0,"VRPK")
BIV
"^DD",9002084.4,9002084.4,.01,0)
FORM LETTER NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002084.4,9002084.4,.01,1,0)
^.1
"^DD",9002084.4,9002084.4,.01,1,1,0)
9002084.4^B
"^DD",9002084.4,9002084.4,.01,1,1,1)
S ^BILET("B",$E(X,1,30),DA)=""
"^DD",9002084.4,9002084.4,.01,1,1,2)
K ^BILET("B",$E(X,1,30),DA)
"^DD",9002084.4,9002084.4,.01,1,2,0)
9002084.4^U^MUMPS
"^DD",9002084.4,9002084.4,.01,1,2,1)
D UPXREF^BIUTL5(X,"^BILET(")
"^DD",9002084.4,9002084.4,.01,1,2,2)
D KUPXREF^BIUTL5(X,"^BILET(")
"^DD",9002084.4,9002084.4,.01,1,2,"DT")
2980605
"^DD",9002084.4,9002084.4,.01,3)
Enter a name for this Form Letter.  Answer must be 3-30 characters in length.
"^DD",9002084.4,9002084.4,.01,"DT")
2980605
"^DD",9002084.4,9002084.4,.02,0)
INCLUDE IMM HISTORY^S^0:NO HISTORY;1:LISTED BY DATE;2:LISTED BY DATE W/LOT#S;3:LISTED BY VACCINE;4:LISTED BY VACCINE W/LOT#S;^0;2^Q
"^DD",9002084.4,9002084.4,.02,3)
Enter 1 to have Imm History listed by Date, 2 if by Date w/Lot#'s, 3 if by Vaccine, or 4 if by Vaccine w/Lot#'s.  Enter NO to exclude Imm History.
"^DD",9002084.4,9002084.4,.02,"DT")
2990128
"^DD",9002084.4,9002084.4,.03,0)
INCLUDE IMM FORECAST^S^0:NO;1:YES;^0;3^Q
"^DD",9002084.4,9002084.4,.03,3)
Enter YES if the patient's Immunization Forecast should be included in this Form Letter.
"^DD",9002084.4,9002084.4,.03,"DT")
2980529
"^DD",9002084.4,9002084.4,.04,0)
INCLUDE DATE/LOCATION^S^0:NO;1:YES;^0;4^Q
"^DD",9002084.4,9002084.4,.04,3)
Enter YES if a DATE/LOCATION line should be included in this Form Letter.
"^DD",9002084.4,9002084.4,.04,"DT")
2980601
"^DD",9002084.4,9002084.4,.05,0)
INCLUDE INVALID DOSES^S^0:YES, INCLUDE INVALID DOSES;1:NO, EXCLUDE INVALID DOSES;^0;5^Q
"^DD",9002084.4,9002084.4,.05,3)
Choose YES to INCLUDE Invalid Doses in this letter.  Choose NO to EXCLUDE Invalid Doses from this letter.
"^DD",9002084.4,9002084.4,.05,"DT")
3031212
"^DD",9002084.4,9002084.4,.06,0)
FORECAST FIRST, THEN HISTORY^S^1:YES;0:NO;^0;6^Q
"^DD",9002084.4,9002084.4,.06,"DT")
3050831
"^DD",9002084.4,9002084.4,1.01,0)
TOP SECTION^9002084.41^^1;0
"^DD",9002084.4,9002084.4,1.01,"DT")
2980528
"^DD",9002084.4,9002084.4,2.01,0)
MIDDLE SECTION^9002084.42^^2;0
"^DD",9002084.4,9002084.4,2.01,"DT")
2980528
"^DD",9002084.4,9002084.4,3.01,0)
BOTTOM SECTION^9002084.43^^3;0
"^DD",9002084.4,9002084.4,3.01,"DT")
2980528
"^DD",9002084.4,9002084.4,4.01,0)
CLOSING SECTION^9002084.44^^4;0
"^DD",9002084.4,9002084.41,0)
TOP SECTION SUB-FIELD^^.01^1
"^DD",9002084.4,9002084.41,0,"DT")
2980526
"^DD",9002084.4,9002084.41,0,"NM","TOP SECTION")

"^DD",9002084.4,9002084.41,0,"UP")
9002084.4
"^DD",9002084.4,9002084.41,.01,0)
TOP SECTION TEXT^WL^^0;1^Q
"^DD",9002084.4,9002084.41,.01,3)
Enter the top section of the letter (heading, greeting, first paragraph, etc.).
"^DD",9002084.4,9002084.41,.01,"DT")
2980601
"^DD",9002084.4,9002084.42,0)
MIDDLE SECTION SUB-FIELD^^.01^1
"^DD",9002084.4,9002084.42,0,"DT")
2980526
"^DD",9002084.4,9002084.42,0,"NM","MIDDLE SECTION")

"^DD",9002084.4,9002084.42,0,"UP")
9002084.4
"^DD",9002084.4,9002084.42,.01,0)
MIDDLE SECTION TEXT^WL^^0;1^Q
"^DD",9002084.4,9002084.42,.01,3)
Enter the middle section of the letter (after the history and before the forecast).
"^DD",9002084.4,9002084.42,.01,"DT")
2980601
"^DD",9002084.4,9002084.43,0)
BOTTOM SECTION SUB-FIELD^^.01^1
"^DD",9002084.4,9002084.43,0,"DT")
2980526
"^DD",9002084.4,9002084.43,0,"NM","BOTTOM SECTION")

"^DD",9002084.4,9002084.43,0,"UP")
9002084.4
"^DD",9002084.4,9002084.43,.01,0)
BOTTOM SECTION TEXT^WL^^0;1^Q
"^DD",9002084.4,9002084.43,.01,3)
Enter the bottom section of the letter (instructions, etc.).
"^DD",9002084.4,9002084.43,.01,"DT")
2980601
"^DD",9002084.4,9002084.44,0)
CLOSING SECTION SUB-FIELD^^.01^1
"^DD",9002084.4,9002084.44,0,"DT")
2980601
"^DD",9002084.4,9002084.44,0,"NM","CLOSING SECTION")

"^DD",9002084.4,9002084.44,0,"UP")
9002084.4
"^DD",9002084.4,9002084.44,.01,0)
CLOSING SECTION TEXT^WL^^0;1^Q
"^DD",9002084.4,9002084.44,.01,3)
Enter the closing section of the letter (signature, phone#, etc.).
"^DD",9002084.4,9002084.44,.01,"DT")
2980601
"^DD",9002084.45,9002084.45,0)
FIELD^^4.01^9
"^DD",9002084.45,9002084.45,0,"DT")
3050826
"^DD",9002084.45,9002084.45,0,"IX","B",9002084.45,.01)

"^DD",9002084.45,9002084.45,0,"NM","BI LETTER SAMPLE")

"^DD",9002084.45,9002084.45,0,"VRPK")
BIV
"^DD",9002084.45,9002084.45,.01,0)
FORM LETTER NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002084.45,9002084.45,.01,1,0)
^.1
"^DD",9002084.45,9002084.45,.01,1,1,0)
9002084.45^B
"^DD",9002084.45,9002084.45,.01,1,1,1)
S ^BILETS("B",$E(X,1,30),DA)=""
"^DD",9002084.45,9002084.45,.01,1,1,2)
K ^BILETS("B",$E(X,1,30),DA)
"^DD",9002084.45,9002084.45,.01,3)
Enter a name for this Form Letter.  Answer must be 3-30 characters in length.
"^DD",9002084.45,9002084.45,.01,"DT")
2980601
"^DD",9002084.45,9002084.45,.02,0)
INCLUDE IMM HISTORY^S^0:NO HISTORY;1:LISTED BY DATE;2:LISTED BY DATE W/LOT#S;3:LISTED BY VACCINE;4:LISTED BY VACCINE W/LOT#S;^0;2^Q
"^DD",9002084.45,9002084.45,.02,3)
Enter 1 to have Imm History listed by Date, 2 if by Date w/Lot#'s, 3 if by Vaccine, or 4 if by Vaccine w/Lot#'s.  Enter NO to exclude Imm History.
"^DD",9002084.45,9002084.45,.02,"DT")
2990428
"^DD",9002084.45,9002084.45,.03,0)
INCLUDE IMM FORECAST^S^0:NO;1:YES;^0;3^Q
"^DD",9002084.45,9002084.45,.03,3)
Enter YES if the patient's Immunization Forecast should be included in this Form Letter.
"^DD",9002084.45,9002084.45,.03,"DT")
2980601
"^DD",9002084.45,9002084.45,.04,0)
INCLUDE DATE/LOCATION^S^0:NO;1:YES;^0;4^Q
"^DD",9002084.45,9002084.45,.04,3)
Enter YES if a DATE/LOCATION line should be included in this Form Letter.
"^DD",9002084.45,9002084.45,.04,"DT")
2980601
"^DD",9002084.45,9002084.45,.06,0)
FORECAST FIRST, THEN HISTORY^S^1:YES;0:NO;^0;6^Q
"^DD",9002084.45,9002084.45,.06,"DT")
3050831
"^DD",9002084.45,9002084.45,1.01,0)
TOP SECTION^9002084.46^^1;0
"^DD",9002084.45,9002084.45,2.01,0)
MIDDLE SECTION^9002084.47^^2;0
"^DD",9002084.45,9002084.45,3.01,0)
BOTTOM SECTION^9002084.48^^3;0
"^DD",9002084.45,9002084.45,4.01,0)
CLOSING SECTION^9002084.49^^4;0
"^DD",9002084.45,9002084.46,0)
TOP SECTION SUB-FIELD^^.01^1
"^DD",9002084.45,9002084.46,0,"DT")
2980601
"^DD",9002084.45,9002084.46,0,"NM","TOP SECTION")

"^DD",9002084.45,9002084.46,0,"UP")
9002084.45
"^DD",9002084.45,9002084.46,.01,0)
TOP SECTION TEXT^W^^0;1^Q
"^DD",9002084.45,9002084.46,.01,3)
Enter the top section of the letter (heading, greeting, first paragraph, etc.).
"^DD",9002084.45,9002084.46,.01,"DT")
2980601
"^DD",9002084.45,9002084.47,0)
MIDDLE SECTION SUB-FIELD^^.01^1
"^DD",9002084.45,9002084.47,0,"DT")
2980601
"^DD",9002084.45,9002084.47,0,"NM","MIDDLE SECTION")

"^DD",9002084.45,9002084.47,0,"UP")
9002084.45
"^DD",9002084.45,9002084.47,.01,0)
MIDDLE SECTION^W^^0;1^Q
"^DD",9002084.45,9002084.47,.01,3)
Enter the middle section of the letter (after the history and before the forecast).
"^DD",9002084.45,9002084.47,.01,"DT")
2980601
"^DD",9002084.45,9002084.48,0)
BOTTOM SECTION SUB-FIELD^^.01^1
"^DD",9002084.45,9002084.48,0,"DT")
2980601
"^DD",9002084.45,9002084.48,0,"NM","BOTTOM SECTION")

"^DD",9002084.45,9002084.48,0,"UP")
9002084.45
"^DD",9002084.45,9002084.48,.01,0)
BOTTOM SECTION TEXT^W^^0;1^Q
"^DD",9002084.45,9002084.48,.01,3)
Enter the bottom section of the letter (instructions, etc.).
"^DD",9002084.45,9002084.48,.01,"DT")
2980601
"^DD",9002084.45,9002084.49,0)
CLOSING SECTION SUB-FIELD^^.01^1
"^DD",9002084.45,9002084.49,0,"DT")
2980601
"^DD",9002084.45,9002084.49,0,"NM","CLOSING SECTION")

"^DD",9002084.45,9002084.49,0,"UP")
9002084.45
"^DD",9002084.45,9002084.49,.01,0)
CLOSING SECTION TEXT^W^^0;1^Q
"^DD",9002084.45,9002084.49,.01,3)
Enter the closing section of the letter (signature, phone#, etc.).
"^DD",9002084.45,9002084.49,.01,"DT")
2980601
"^DD",9002084.81,9002084.81,0)
FIELD^^.04^4
"^DD",9002084.81,9002084.81,0,"DT")
3051018
"^DD",9002084.81,9002084.81,0,"IX","B",9002084.81,.01)

"^DD",9002084.81,9002084.81,0,"IX","U",9002084.81,.01)

"^DD",9002084.81,9002084.81,0,"NM","BI TABLE CONTRA REASON")

"^DD",9002084.81,9002084.81,0,"VRPK")
BIV
"^DD",9002084.81,9002084.81,.01,0)
CONTRAINDICATION REASON^RFI^^0;1^K:$L(X)>26!($L(X)<3)!'(X'?1P.E) X
"^DD",9002084.81,9002084.81,.01,1,0)
^.1
"^DD",9002084.81,9002084.81,.01,1,1,0)
9002084.81^B
"^DD",9002084.81,9002084.81,.01,1,1,1)
S ^BICONT("B",$E(X,1,30),DA)=""
"^DD",9002084.81,9002084.81,.01,1,1,2)
K ^BICONT("B",$E(X,1,30),DA)
"^DD",9002084.81,9002084.81,.01,1,2,0)
9002084.81^U^MUMPS
"^DD",9002084.81,9002084.81,.01,1,2,1)
D UPXREF^BIUTL5(X,"^BICONT(")
"^DD",9002084.81,9002084.81,.01,1,2,2)
D KUPXREF^BIUTL5(X,"^BICONT(")
"^DD",9002084.81,9002084.81,.01,1,2,"%D",0)
^^2^2^2980219^
"^DD",9002084.81,9002084.81,.01,1,2,"%D",1,0)
This xref simply provides an all-uppercase lookup on selections that are
"^DD",9002084.81,9002084.81,.01,1,2,"%D",2,0)
mixed case.
"^DD",9002084.81,9002084.81,.01,1,2,"DT")
2980219
"^DD",9002084.81,9002084.81,.01,3)
Answer must be 3-26 characters in length.
"^DD",9002084.81,9002084.81,.01,"DT")
3070530
"^DD",9002084.81,9002084.81,.02,0)
WITHOLD CONTRA FROM FORECAST^SI^1:YES, WITHHOLD FROM (DON'T PASS TO) IMMSERVE;0:NO, PASS TO IMMSERVE;^0;2^Q
"^DD",9002084.81,9002084.81,.02,3)
Enter 1 or YES if this reason for a contraindication should cause that contraindication to be witheld--not transmitted as a contraindication--to the forecasting utility (e.g., with "Patient Refusal").
"^DD",9002084.81,9002084.81,.02,"DT")
3070530
"^DD",9002084.81,9002084.81,.03,0)
ACTIVE^SI^0:INACTIVE;1:ACTIVE;^0;3^Q
"^DD",9002084.81,9002084.81,.03,3)
Selecet 0 or INACTIVE to prevent this Contraindication Reason from being selectable when entering new data.
"^DD",9002084.81,9002084.81,.03,"DT")
3070530
"^DD",9002084.81,9002084.81,.04,0)
SKIN TEST RELATED^SI^0:NOT SKIN TEST RELATED;1:SKIN TEST RELATED;^0;4^Q
"^DD",9002084.81,9002084.81,.04,3)
Enter 1 if this Reason is related to Skin Tests.
"^DD",9002084.81,9002084.81,.04,"DT")
3070530
"^DD",9002084.91,9002084.91,0)
FIELD^^.04^4
"^DD",9002084.91,9002084.91,0,"DDA")
N
"^DD",9002084.91,9002084.91,0,"DT")
2980205
"^DD",9002084.91,9002084.91,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",9002084.91,9002084.91,0,"IX","B",9002084.91,.01)

"^DD",9002084.91,9002084.91,0,"IX","C",9002084.91,.03)

"^DD",9002084.91,9002084.91,0,"NM","BI TABLE DATA ELEMENT")

"^DD",9002084.91,9002084.91,0,"VRPK")
BIV
"^DD",9002084.91,9002084.91,.01,0)
DATA ELEMENT NAME^RF^^0;1^K:$L(X)>35!($L(X)<3)!'(X'?1P.E) X
"^DD",9002084.91,9002084.91,.01,1,0)
^.1
"^DD",9002084.91,9002084.91,.01,1,1,0)
9002084.91^B
"^DD",9002084.91,9002084.91,.01,1,1,1)
S ^BIEXPDD("B",$E(X,1,30),DA)=""
"^DD",9002084.91,9002084.91,.01,1,1,2)
K ^BIEXPDD("B",$E(X,1,30),DA)
"^DD",9002084.91,9002084.91,.01,3)
Answer must be 3-35 characters in length.
"^DD",9002084.91,9002084.91,.01,"DT")
2971103
"^DD",9002084.91,9002084.91,.02,0)
DATA ELEMENT CODE^F^^0;2^K:$L(X)>120!($L(X)<1) X
"^DD",9002084.91,9002084.91,.02,3)
Answer must be 1-120 characters in length.
"^DD",9002084.91,9002084.91,.02,"DT")
2960507
"^DD",9002084.91,9002084.91,.03,0)
SYNONYM^F^^0;3^K:$L(X)>6!($L(X)<1) X
"^DD",9002084.91,9002084.91,.03,1,0)
^.1
"^DD",9002084.91,9002084.91,.03,1,1,0)
9002084.91^C
"^DD",9002084.91,9002084.91,.03,1,1,1)
S ^BIEXPDD("C",$E(X,1,30),DA)=""
"^DD",9002084.91,9002084.91,.03,1,1,2)
K ^BIEXPDD("C",$E(X,1,30),DA)
"^DD",9002084.91,9002084.91,.03,1,1,"DT")
2960521
"^DD",9002084.91,9002084.91,.03,3)
Enter a synonym for this Data Element, between 1 and 6 characters.
"^DD",9002084.91,9002084.91,.03,"DT")
2960521
"^DD",9002084.91,9002084.91,.04,0)
TYPE OF VISIT^S^I:IMMUNIZATION;S:SKIN TEST;A:ALL;^0;4^Q
"^DD",9002084.91,9002084.91,.04,3)
Select the Type of Visit this Data Element applies to (Immunization, Skin Test, of All).
"^DD",9002084.91,9002084.91,.04,"DT")
2980205
"^DD",9002084.93,9002084.93,0)
FIELD^^.08^8
"^DD",9002084.93,9002084.93,0,"DT")
3070423
"^DD",9002084.93,9002084.93,0,"IX","B",9002084.93,.01)

"^DD",9002084.93,9002084.93,0,"NM","BI TABLE VACCINE GROUP (SERIES TYPE)")

"^DD",9002084.93,9002084.93,0,"PT",9002084.94,.09)

"^DD",9002084.93,9002084.93,0,"PT",9999999.14,.09)

"^DD",9002084.93,9002084.93,0,"VRPK")
BIV
"^DD",9002084.93,9002084.93,.01,0)
VACCINE GROUP (SERIES TYPE)^RF^^0;1^K:$L(X)>10!($L(X)<1)!'(X'?1P.E) X
"^DD",9002084.93,9002084.93,.01,1,0)
^.1
"^DD",9002084.93,9002084.93,.01,1,1,0)
9002084.93^B
"^DD",9002084.93,9002084.93,.01,1,1,1)
S ^BISERT("B",$E(X,1,30),DA)=""
"^DD",9002084.93,9002084.93,.01,1,1,2)
K ^BISERT("B",$E(X,1,30),DA)
"^DD",9002084.93,9002084.93,.01,3)
Enter the Vaccine Group name (Type of Series) for the group of vaccines you wish to cluster on outputs.
"^DD",9002084.93,9002084.93,.01,"DT")
2980223
"^DD",9002084.93,9002084.93,.02,0)
DISPLAY ORDER^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002084.93,9002084.93,.02,3)
Enter a number corresponding to the order in which this Type of Series should be displayed.
"^DD",9002084.93,9002084.93,.02,"DT")
2970908
"^DD",9002084.93,9002084.93,.03,0)
SHORT NAME^F^^0;3^K:$L(X)>5!($L(X)<1) X
"^DD",9002084.93,9002084.93,.03,3)
Answer must be 1-5 characters in length.
"^DD",9002084.93,9002084.93,.03,"DT")
2980728
"^DD",9002084.93,9002084.93,.04,0)
MAX DOSES IN QUART/TWO REPORT^NJ1,0^^0;4^K:+X'=X!(X>6)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002084.93,9002084.93,.04,3)
Type a Number between 1 and 6, 0 Decimal Digits
"^DD",9002084.93,9002084.93,.04,"DT")
3070423
"^DD",9002084.93,9002084.93,.05,0)
FORECASTING ON/OFF^S^0:OFF;1:ON;^0;5^Q
"^DD",9002084.93,9002084.93,.05,3)
Enter "ON" to turn on Forecasting for this Vaccine Group.  Enter "OFF" to turn it off.
"^DD",9002084.93,9002084.93,.05,"DT")
3050204
"^DD",9002084.93,9002084.93,.06,0)
AVAILABLE ON FORECASTNG MENU^S^0:NO;1:YES;^0;6^Q
"^DD",9002084.93,9002084.93,.06,3)
Enter YES if this Vaccine Group should be available on the Forecasting ON/OFF Menu.  
"^DD",9002084.93,9002084.93,.06,"DT")
3050205
"^DD",9002084.93,9002084.93,.07,0)
MAX DOSES IN ADOLESCENT REPORT^NJ1,0^^0;7^K:+X'=X!(X>5)!(X<0)!(X?.E1"."1.N) X
"^DD",9002084.93,9002084.93,.07,3)
Type a number between 0 and 5, 0 Decimal Digits
"^DD",9002084.93,9002084.93,.07,"DT")
3070306
"^DD",9002084.93,9002084.93,.08,0)
INCLUDE IN TWO-YR-OLD REPORT^S^1:YES;0:NO;^0;8^Q
"^DD",9002084.93,9002084.93,.08,3)
 Answer YES if this Vaccine Group should be included in the Two-Yr-Old Report; answer NO if not.
"^DD",9002084.93,9002084.93,.08,"DT")
3070423
"^DIC",9002084,9002084,0)
BI PATIENT^9002084
"^DIC",9002084,9002084,0,"GL")
^BIP(
"^DIC",9002084,"B","BI PATIENT",9002084)

"^DIC",9002084.01,9002084.01,0)
BI CASE MANAGER^9002084.01
"^DIC",9002084.01,9002084.01,0,"GL")
^BIMGR(
"^DIC",9002084.01,"B","BI CASE MANAGER",9002084.01)

"^DIC",9002084.02,9002084.02,0)
BI SITE PARAMETER^9002084.02
"^DIC",9002084.02,9002084.02,0,"GL")
^BISITE(
"^DIC",9002084.02,"B","BI SITE PARAMETER",9002084.02)

"^DIC",9002084.1,9002084.1,0)
BI PATIENT IMMUNIZATIONS DUE^9002084.1
"^DIC",9002084.1,9002084.1,0,"GL")
^BIPDUE(
"^DIC",9002084.1,"B","BI PATIENT IMMUNIZATIONS DUE",9002084.1)

"^DIC",9002084.11,9002084.11,0)
BI PATIENT CONTRAINDICATIONS^9002084.11
"^DIC",9002084.11,9002084.11,0,"GL")
^BIPC(
"^DIC",9002084.11,"B","BI PATIENT CONTRAINDICATIONS",9002084.11)

"^DIC",9002084.115,9002084.115,0)
BI PATIENT CONTRAINDICATIONS DELETED^9002084.115
"^DIC",9002084.115,9002084.115,0,"GL")
^BIPCD(
"^DIC",9002084.115,"B","BI PATIENT CONTRAINDICATIONS DELETED",9002084.115)

"^DIC",9002084.12,9002084.12,0)
BI PATIENT FORECAST ERRORS^9002084.12
"^DIC",9002084.12,9002084.12,0,"GL")
^BIPERR(
"^DIC",9002084.12,"B","BI PATIENT FORECAST ERRORS",9002084.12)

"^DIC",9002084.33,9002084.33,0)
BI TABLE ERROR CODE^9002084.33
"^DIC",9002084.33,9002084.33,0,"GL")
^BIERR(
"^DIC",9002084.33,"B","BI TABLE ERROR CODE",9002084.33)

"^DIC",9002084.4,9002084.4,0)
BI LETTER^9002084.4
"^DIC",9002084.4,9002084.4,0,"GL")
^BILET(
"^DIC",9002084.4,"B","BI LETTER",9002084.4)

"^DIC",9002084.45,9002084.45,0)
BI LETTER SAMPLE^9002084.45
"^DIC",9002084.45,9002084.45,0,"GL")
^BILETS(
"^DIC",9002084.45,"B","BI LETTER SAMPLE",9002084.45)

"^DIC",9002084.81,9002084.81,0)
BI TABLE CONTRA REASON^9002084.81
"^DIC",9002084.81,9002084.81,0,"GL")
^BICONT(
"^DIC",9002084.81,"B","BI TABLE CONTRA REASON",9002084.81)

"^DIC",9002084.91,9002084.91,0)
BI TABLE DATA ELEMENT^9002084.91
"^DIC",9002084.91,9002084.91,0,"GL")
^BIEXPDD(
"^DIC",9002084.91,"B","BI TABLE DATA ELEMENT",9002084.91)

"^DIC",9002084.93,9002084.93,0)
BI TABLE VACCINE GROUP (SERIES TYPE)^9002084.93
"^DIC",9002084.93,9002084.93,0,"GL")
^BISERT(
"^DIC",9002084.93,"B","BI TABLE VACCINE GROUP (SERIES TYPE)",9002084.93)

**END**
**END**
